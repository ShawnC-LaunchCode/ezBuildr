npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[46m RUN [49m[22m [36mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764701309389,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764701312882,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764701312882,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764701312889,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764701312889,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764701312890,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764701312890,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764701313240,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764701313241,"env":"test","module":"auth","email":"testuser@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764701313291,"env":"test","module":"auth","userId":"google-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764701313394,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImYzYWQ0ZDliLWFhMjYtNDI2NC1hODRkLWNkMDUwNGUwY2ZlNyIsInJvbGUiOiJvd25lciIsImlhdCI6MTc2NDcwMTMxMywiZXhwIjoxNzY1MzA2MTEzfQ.f8eh4r62qy4hYJsLUKMw4oBWp7o5h1Ei6W_IYgyMlk8",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": "Test",
    "lastName": "User",
    "profileImageUrl": "https://example.com/avatar.jpg",
    "tenantId": "f3ad4d9b-aa26-4264-a84d-cd0504e0cfe7",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1764701313404,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1764701313404,"env":"test","module":"auth","email":"other@example.com","msg":"Token verified successfully"}
{"level":30,"time":1764701313458,"env":"test","module":"auth","userId":"other-user-id","msg":"User upserted successfully"}
{"level":30,"time":1764701313560,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mPOST permissions route entered for table: 48aa9087-14c9-4fb3-a2b2-2378bae214d3
Request body: {"userId":"other-user-id","role":"read"}
grantPermission called for table: 48aa9087-14c9-4fb3-a2b2-2378bae214d3 user: other-user-id data: {"tableId":"48aa9087-14c9-4fb3-a2b2-2378bae214d3","userId":"other-user-id","role":"read"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mupsert result: {"id":"725d6042-37fb-43a4-aad6-8d292e4c1cc0","tableId":"48aa9087-14c9-4fb3-a2b2-2378bae214d3","userId":"other-user-id","role":"read","createdAt":"2025-12-02T18:48:37.056Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould grant table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"725d6042-37fb-43a4-aad6-8d292e4c1cc0","tableId":"48aa9087-14c9-4fb3-a2b2-2378bae214d3","userId":"other-user-id","role":"read","createdAt":"2025-12-02T18:48:37.056Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mPOST permissions route entered for table: ee47e571-a9d5-4b1e-852d-ccb327fcc8e7
Request body: {"userId":"other-user-id","role":"read"}
grantPermission called for table: ee47e571-a9d5-4b1e-852d-ccb327fcc8e7 user: other-user-id data: {"tableId":"ee47e571-a9d5-4b1e-852d-ccb327fcc8e7","userId":"other-user-id","role":"read"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mupsert result: {"id":"c565c48d-c638-4b71-aac5-74da045b11ce","tableId":"ee47e571-a9d5-4b1e-852d-ccb327fcc8e7","userId":"other-user-id","role":"read","createdAt":"2025-12-02T18:48:37.627Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mGrant permission success, sending 201. Permission: {"id":"c565c48d-c638-4b71-aac5-74da045b11ce","tableId":"ee47e571-a9d5-4b1e-852d-ccb327fcc8e7","userId":"other-user-id","role":"read","createdAt":"2025-12-02T18:48:37.627Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mPOST permissions route entered for table: 399fc880-56ba-4acd-a545-e8bed3d6c649
Request body: {"userId":"other-user-id","role":"read"}
grantPermission called for table: 399fc880-56ba-4acd-a545-e8bed3d6c649 user: other-user-id data: {"tableId":"399fc880-56ba-4acd-a545-e8bed3d6c649","userId":"other-user-id","role":"read"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mupsert result: {"id":"fbe10e7e-743a-44da-9c7f-2d3dfa6f2a9f","tableId":"399fc880-56ba-4acd-a545-e8bed3d6c649","userId":"other-user-id","role":"read","createdAt":"2025-12-02T18:48:37.952Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mGrant permission success, sending 201. Permission: {"id":"fbe10e7e-743a-44da-9c7f-2d3dfa6f2a9f","tableId":"399fc880-56ba-4acd-a545-e8bed3d6c649","userId":"other-user-id","role":"read","createdAt":"2025-12-02T18:48:37.952Z"}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould revoke table permission
[22m[39mrevokePermission called for permission: fbe10e7e-743a-44da-9c7f-2d3dfa6f2a9f

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mPOST permissions route entered for table: e8b98823-20fc-4f54-a0e5-3799d6957f5e
Request body: {"userId":"some-user-id","role":"read"}
grantPermission called for table: e8b98823-20fc-4f54-a0e5-3799d6957f5e user: some-user-id data: {"tableId":"e8b98823-20fc-4f54-a0e5-3799d6957f5e","userId":"some-user-id","role":"read"}

{"level":50,"time":1764701315280,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould enforce RBAC - only owners can manage permissions
[22m[39mGrant permission catch block entered Error: Access denied - owner permission required
    at DatavaultTablePermissionsService.requirePermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:108:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablePermissionsService.grantPermission (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablePermissionsService.ts:139:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/datavault.routes.ts:1154:26
Grant permission error: Access denied - owner permission required Status: [33m403[39m

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m1 failed[39m[2m | [22m[33m22 skipped[39m[2m)[22m[33m 2454[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should create a select column with options
       [2m[90mÎ“Ã¥Ã´[39m[22m should create a multiselect column with options
       [2m[90mÎ“Ã¥Ã´[39m[22m should validate select value against options
       [2m[90mÎ“Ã¥Ã´[39m[22m should validate multiselect values as array
       [2m[90mÎ“Ã¥Ã´[39m[22m should create an autonumber column with sequence
       [2m[90mÎ“Ã¥Ã´[39m[22m should auto-increment autonumber on row creation
       [2m[90mÎ“Ã¥Ã´[39m[22m should format autonumber with prefix
       [2m[90mÎ“Ã¥Ã´[39m[22m should create a note for a row
       [2m[90mÎ“Ã¥Ã´[39m[22m should get all notes for a row
       [2m[90mÎ“Ã¥Ã´[39m[22m should delete a note
       [2m[90mÎ“Ã¥Ã´[39m[22m should not allow deleting notes by other users
       [2m[90mÎ“Ã¥Ã´[39m[22m should track row creation in history
       [2m[90mÎ“Ã¥Ã´[39m[22m should track value changes in history
       [2m[90mÎ“Ã¥Ã´[39m[22m should create an API token
       [2m[90mÎ“Ã¥Ã´[39m[22m should validate API token scopes
       [2m[90mÎ“Ã¥Ã´[39m[22m should revoke (delete) an API token
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny access with expired token
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 320[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should list table permissions[32m 263[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 621[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce RBAC - only owners can manage permissions[32m 202[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should paginate rows efficiently
       [2m[90mÎ“Ã¥Ã´[39m[22m should handle sorting efficiently
       [2m[90mÎ“Ã¥Ã´[39m[22m should return user-friendly error for invalid column type
       [2m[90mÎ“Ã¥Ã´[39m[22m should return user-friendly error for missing required fields
       [2m[90mÎ“Ã¥Ã´[39m[22m should handle network errors gracefully

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:707:37
    705|         console.log('Update permission failed:', updateResponse.body);
    706|       }
    707|       expect(updateResponse.status).toBe(200);
       |                                     ^
    708|       expect(updateResponse.body.role).toBe('write');
    709|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[2m | [22m[33m22 skipped[39m[90m (27)[39m
[2m   Start at [22m 12:48:27
[2m   Duration [22m 7.84s[2m (transform 2.14s, setup 63ms, collect 4.87s, tests 2.45s, environment 0ms, prepare 16ms)[22m

