npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

> ezbuildr@1.0.0 test
> cross-env VITEST_INTEGRATION=true vitest run --coverage


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w14_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w14_v3 (Reused: true)

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w6_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w6_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w0_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w0_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w8_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w2_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w8_v3 (Reused: true)

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w2_v3 (Reused: true)

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mğŸ“Š Schema test_schema_w14_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709523066,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709523067,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w14_v3\",public"}
{"level":30,"time":1768709523067,"env":"test","msg":"DB: Created pool for worker 14, schema=\"test_schema_w14_v3\", max connections=5"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mğŸ“Š Schema test_schema_w6_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709523113,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709523113,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w6_v3\",public"}
{"level":30,"time":1768709523114,"env":"test","msg":"DB: Created pool for worker 6, schema=\"test_schema_w6_v3\", max connections=5"}
{"level":30,"time":1768709523123,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w13_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mğŸ“Š Schema test_schema_w0_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709523162,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709523162,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w0_v3\",public"}
{"level":30,"time":1768709523163,"env":"test","msg":"DB: Created pool for worker 0, schema=\"test_schema_w0_v3\", max connections=5"}
{"level":30,"time":1768709523168,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w13_v3 (Reused: true)

{"level":30,"time":1768709523214,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w10_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w10_v3 (Reused: true)

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mğŸ“Š Schema test_schema_w2_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709523325,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709523326,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w2_v3\",public"}
{"level":30,"time":1768709523327,"env":"test","msg":"DB: Created pool for worker 2, schema=\"test_schema_w2_v3\", max connections=5"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mğŸ“Š Schema test_schema_w8_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709523380,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mğŸ“Š Schema test_schema_w13_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709523607,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709523607,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w13_v3\",public"}
{"level":30,"time":1768709523608,"env":"test","msg":"DB: Created pool for worker 13, schema=\"test_schema_w13_v3\", max connections=5"}
{"level":30,"time":1768709523659,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mğŸ“Š Schema test_schema_w10_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709523692,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709523693,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w10_v3\",public"}
{"level":30,"time":1768709523693,"env":"test","msg":"DB: Created pool for worker 10, schema=\"test_schema_w10_v3\", max connections=5"}
{"level":30,"time":1768709523746,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768709524472,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768709524473,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768709524474,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768709524474,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768709524474,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768709524473,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768709524474,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w9_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w4_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w5_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w7_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w1_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w3_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w11_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w9_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w4_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w7_v3 (Reused: true)

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w5_v3 (Reused: true)

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w1_v3 (Reused: true)

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w3_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w11_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mğŸ“Š Schema test_schema_w9_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709525479,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709525479,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w9_v3\",public"}
{"level":30,"time":1768709525480,"env":"test","msg":"DB: Created pool for worker 9, schema=\"test_schema_w9_v3\", max connections=5"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mğŸ“Š Schema test_schema_w5_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709525515,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709525515,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w5_v3\",public"}
{"level":30,"time":1768709525515,"env":"test","msg":"DB: Created pool for worker 5, schema=\"test_schema_w5_v3\", max connections=5"}
{"level":30,"time":1768709525529,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mğŸ“Š Schema test_schema_w1_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mğŸ“Š Schema test_schema_w4_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709525535,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709525535,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709525535,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w1_v3\",public"}
{"level":30,"time":1768709525536,"env":"test","msg":"DB: Created pool for worker 1, schema=\"test_schema_w1_v3\", max connections=5"}
{"level":30,"time":1768709525535,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w4_v3\",public"}
{"level":30,"time":1768709525536,"env":"test","msg":"DB: Created pool for worker 4, schema=\"test_schema_w4_v3\", max connections=5"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mğŸ“Š Schema test_schema_w7_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mğŸ“Š Schema test_schema_w3_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709525539,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709525540,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709525540,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w7_v3\",public"}
{"level":30,"time":1768709525540,"env":"test","msg":"DB: Created pool for worker 7, schema=\"test_schema_w7_v3\", max connections=5"}
{"level":30,"time":1768709525540,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w3_v3\",public"}
{"level":30,"time":1768709525540,"env":"test","msg":"DB: Created pool for worker 3, schema=\"test_schema_w3_v3\", max connections=5"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mğŸ“Š Schema test_schema_w11_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709525546,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709525546,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w11_v3\",public"}
{"level":30,"time":1768709525546,"env":"test","msg":"DB: Created pool for worker 11, schema=\"test_schema_w11_v3\", max connections=5"}
{"level":30,"time":1768709525563,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768709525583,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768709525583,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768709525588,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768709525586,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768709525592,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768709527169,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w12_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w12_v3 (Reused: true)

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mğŸ“Š Schema test_schema_w12_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768709530758,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768709530758,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w12_v3\",public"}
{"level":30,"time":1768709530758,"env":"test","msg":"DB: Created pool for worker 12, schema=\"test_schema_w12_v3\", max connections=5"}
{"level":30,"time":1768709530797,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768709822178,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709822240,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709822312,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709822470,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709822758,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709822830,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709824590,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709824604,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709824604,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768709824605,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768709824605,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709824605,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709824606,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768709829955,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/integration/ownershipAccess.test.ts [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should allow access to user-owned asset by owner
       [2m[90mâ†“[39m[22m should deny access to user-owned asset by non-owner
       [2m[90mâ†“[39m[22m should allow access to org-owned asset by org member
       [2m[90mâ†“[39m[22m should deny access to org-owned asset by non-member
       [2m[90mâ†“[39m[22m should allow access to null ownership (legacy data)
       [2m[90mâ†“[39m[22m should return true for org member
       [2m[90mâ†“[39m[22m should return false for non-member
       [2m[90mâ†“[39m[22m should return true for org admin
       [2m[90mâ†“[39m[22m should return true for org admin
       [2m[90mâ†“[39m[22m should return false for org member (non-admin)
       [2m[90mâ†“[39m[22m should return false for non-member
       [2m[90mâ†“[39m[22m should return all org IDs for a user
       [2m[90mâ†“[39m[22m should return empty array for user with no memberships
       [2m[90mâ†“[39m[22m should allow creating user-owned asset if ownerUuid matches userId
       [2m[90mâ†“[39m[22m should deny creating user-owned asset if ownerUuid does not match userId
       [2m[90mâ†“[39m[22m should allow creating org-owned asset if user is member
       [2m[90mâ†“[39m[22m should deny creating org-owned asset if user is not member
       [2m[90mâ†“[39m[22m should not allow member of org1 to access org2-owned assets
       [2m[90mâ†“[39m[22m should allow member of multiple orgs to access all their org assets
 [31mâ¯[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a workflow template mapping
       [2m[90mâ†“[39m[22m should create non-primary mapping by default
       [2m[90mâ†“[39m[22m should find all templates for a workflow version
       [2m[90mâ†“[39m[22m should return empty array for version with no templates
       [2m[90mâ†“[39m[22m should order by createdAt desc (newest first)
       [2m[90mâ†“[39m[22m should find mapping by workflow version and key
       [2m[90mâ†“[39m[22m should return undefined for non-existent key
       [2m[90mâ†“[39m[22m should find primary template for workflow version
       [2m[90mâ†“[39m[22m should return undefined when no primary template exists
       [2m[90mâ†“[39m[22m should set a template as primary and unset others
       [2m[90mâ†“[39m[22m should handle setting primary when none existed before
       [2m[90mâ†“[39m[22m should not delete mapping if workflow version does not match
       [2m[90mâ†“[39m[22m should return true if key exists in workflow version
       [2m[90mâ†“[39m[22m should return false if key does not exist
       [2m[90mâ†“[39m[22m should exclude specified id when checking existence
       [2m[90mâ†“[39m[22m should return true if key exists on different mapping
       [2m[90mâ†“[39m[22m should update mapping fields
       [2m[90mâ†“[39m[22m should find mapping by id
       [2m[90mâ†“[39m[22m should return undefined for non-existent id
 [31mâ¯[39m tests/unit/services/WorkflowTemplateService.test.ts [2m([22m[2m21 tests[22m[2m | [22m[33m21 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should throw error if template belongs to different project
       [2m[90mâ†“[39m[22m should automatically unset other primaries when setting new primary
         [2m[90mâ†“[39m[22m should list all templates for workflow version
         [2m[90mâ†“[39m[22m should return empty array for version with no templates
         [2m[90mâ†“[39m[22m should get template mapping by id and version
         [2m[90mâ†“[39m[22m should throw error if mapping not found
         [2m[90mâ†“[39m[22m should get template by key
         [2m[90mâ†“[39m[22m should throw error if key not found
         [2m[90mâ†“[39m[22m should get primary template for workflow version
         [2m[90mâ†“[39m[22m should return null when no primary template exists
         [2m[90mâ†“[39m[22m should update mapping key
         [2m[90mâ†“[39m[22m should update isPrimary flag
         [2m[90mâ†“[39m[22m should throw error if new key already exists
         [2m[90mâ†“[39m[22m should throw error if mapping not found
         [2m[90mâ†“[39m[22m should unset other primaries when setting isPrimary to true
         [2m[90mâ†“[39m[22m should detach template from workflow version
         [2m[90mâ†“[39m[22m should throw error if mapping not found
         [2m[90mâ†“[39m[22m should set template as primary
         [2m[90mâ†“[39m[22m should throw error if mapping not found
         [2m[90mâ†“[39m[22m should support operations within a transaction
         [2m[90mâ†“[39m[22m should rollback on transaction error
 [31mâ¯[39m tests/integration/organizationInvites.test.ts [2m([22m[2m17 tests[22m[2m | [22m[33m17 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create placeholder user for non-existent email
       [2m[90mâ†“[39m[22m should create invite for existing user without creating placeholder
       [2m[90mâ†“[39m[22m should prevent duplicate pending invites
       [2m[90mâ†“[39m[22m should prevent inviting existing members
       [2m[90mâ†“[39m[22m should require admin access to create invite
       [2m[90mâ†“[39m[22m should set expiry to 7 days from now
       [2m[90mâ†“[39m[22m should accept invite and create membership
       [2m[90mâ†“[39m[22m should convert placeholder user to real user on accept
       [2m[90mâ†“[39m[22m should reject expired invite
       [2m[90mâ†“[39m[22m should reject already accepted invite
       [2m[90mâ†“[39m[22m should verify email matches invite
       [2m[90mâ†“[39m[22m should reject invalid token
       [2m[90mâ†“[39m[22m should return pending invites for user email
       [2m[90mâ†“[39m[22m should not return expired invites
       [2m[90mâ†“[39m[22m should not return accepted invites
       [2m[90mâ†“[39m[22m should allow admin to revoke invite
       [2m[90mâ†“[39m[22m should prevent accepting revoked invite
 [31mâ¯[39m tests/unit/services/PdfQueueService.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should enqueue a PDF conversion job
       [2m[90mâ†“[39m[22m should create output with empty storagePath initially
       [2m[90mâ†“[39m[22m should return job status for pending job
       [2m[90mâ†“[39m[22m should return null for non-existent job
       [2m[90mâ†“[39m[22m should parse attempt count from error field
       [2m[90mâ†“[39m[22m should convert DOCX to PDF immediately
       [2m[90mâ†“[39m[22m should handle conversion errors gracefully
       [2m[90mâ†“[39m[22m should start and stop service
       [2m[90mâ†“[39m[22m should not start if already running
       [2m[90mâ†“[39m[22m should handle stop when not running
       [2m[90mâ†“[39m[22m should process pending jobs when queue is processed
       [2m[90mâ†“[39m[22m should process multiple jobs in batch
       [2m[90mâ†“[39m[22m should handle missing DOCX output gracefully
       [2m[90mâ†“[39m[22m should support enqueue within transaction
       [2m[90mâ†“[39m[22m should support convertImmediate within transaction
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [31mâ¯[39m tests/unit/engine/templateNode.test.ts [2m([22m[2m17 tests[22m[2m | [22m[33m17 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should resolve template by key from workflowTemplates mapping
       [2m[90mâ†“[39m[22m should throw error if template key not found
       [2m[90mâ†“[39m[22m should store output in runOutputs table
       [2m[90mâ†“[39m[22m should resolve template by templateId directly
       [2m[90mâ†“[39m[22m should throw error if templateId not found
       [2m[90mâ†“[39m[22m should use docxRenderer2 by default (v2 engine)
       [2m[90mâ†“[39m[22m should use legacy engine when engine="legacy"
       [2m[90mâ†“[39m[22m should generate PDF when toPdf=true
       [2m[90mâ†“[39m[22m should default to DOCX when toPdf=false
       [2m[90mâ†“[39m[22m should skip execution when condition evaluates to false
       [2m[90mâ†“[39m[22m should execute when condition evaluates to true
       [2m[90mâ†“[39m[22m should resolve simple bindings
       [2m[90mâ†“[39m[22m should handle binding resolution errors gracefully
       [2m[90mâ†“[39m[22m should record failed output in runOutputs table
       [2m[90mâ†“[39m[22m should not throw errors (should return error in result)
       [2m[90mâ†“[39m[22m should deny access to templates from different tenant
       [2m[90mâ†“[39m[22m should require either templateKey or templateId
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [31mâ¯[39m tests/integration/transferOwnership.test.ts [2m([22m[2m11 tests[22m[2m | [22m[33m11 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should transfer user-owned project to org
       [2m[90mâ†“[39m[22m should prevent transfer to org if user is not a member
       [2m[90mâ†“[39m[22m should allow org member to transfer org-owned project to another org they belong to
       [2m[90mâ†“[39m[22m should detach workflow from project when transferring to different owner
       [2m[90mâ†“[39m[22m should keep workflow in project when transferring to same owner
       [2m[90mâ†“[39m[22m should prevent non-member from transferring org workflow
       [2m[90mâ†“[39m[22m should transfer database ownership
       [2m[90mâ†“[39m[22m should allow org member to transfer org database
       [2m[90mâ†“[39m[22m should prevent transfer to org if user is not a member
       [2m[90mâ†“[39m[22m should only allow transfer to self when targetOwnerType is user
       [2m[90mâ†“[39m[22m should allow transfer from user to self (org member transferring org asset to themselves)
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w21_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w21_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w15_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w15_v3 (Reused: true)

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w16_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w16_v3 (Reused: true)

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mğŸ“Š Schema test_schema_w21_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mğŸ“Š Schema test_schema_w15_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710124417,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710124418,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w15_v3\",public"}
{"level":30,"time":1768710124418,"env":"test","msg":"DB: Created pool for worker 15, schema=\"test_schema_w15_v3\", max connections=5"}
{"level":30,"time":1768710124451,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w20_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w19_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w20_v3 (Reused: true)

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w19_v3 (Reused: true)

 [31mâ¯[39m tests/integration/auth/oauth2.sessions.test.ts [2m([22m[2m25 tests[22m[2m | [22m[33m25 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should list all active sessions for current user
       [2m[90mâ†“[39m[22m should mark current session as current
       [2m[90mâ†“[39m[22m should return empty array when user has no active sessions
       [2m[90mâ†“[39m[22m should not include expired sessions
       [2m[90mâ†“[39m[22m should not include revoked sessions
       [2m[90mâ†“[39m[22m should parse device name from user agent
       [2m[90mâ†“[39m[22m should return 401 for unauthenticated request
       [2m[90mâ†“[39m[22m should revoke a specific session
       [2m[90mâ†“[39m[22m should return 404 for non-existent session
       [2m[90mâ†“[39m[22m should prevent revoking current session
       [2m[90mâ†“[39m[22m should prevent revoking another user's session
       [2m[90mâ†“[39m[22m should return 401 for unauthenticated request
       [2m[90mâ†“[39m[22m should revoke all sessions except current
       [2m[90mâ†“[39m[22m should revoke all trusted devices
       [2m[90mâ†“[39m[22m should return 400 when no active session found
       [2m[90mâ†“[39m[22m should return 401 for unauthenticated request
         [2m[90mâ†“[39m[22m should mark current device as trusted
         [2m[90mâ†“[39m[22m should update existing trusted device expiry
         [2m[90mâ†“[39m[22m should list all trusted devices
         [2m[90mâ†“[39m[22m should not include revoked devices
         [2m[90mâ†“[39m[22m should revoke a trusted device
         [2m[90mâ†“[39m[22m should return 404 for non-existent device
       [2m[90mâ†“[39m[22m should track IP address for sessions
       [2m[90mâ†“[39m[22m should track user agent for sessions
       [2m[90mâ†“[39m[22m should update lastUsedAt on token refresh
 [31mâ¯[39m tests/integration/mfa.flow.real.test.ts [2m([22m[2m20 tests[22m[2m | [22m[33m20 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should complete full MFA setup flow
       [2m[90mâ†“[39m[22m should reject invalid TOTP code during setup
       [2m[90mâ†“[39m[22m should not allow MFA setup if already enabled
       [2m[90mâ†“[39m[22m should generate unique backup codes
       [2m[90mâ†“[39m[22m should store hashed backup codes
       [2m[90mâ†“[39m[22m should require MFA for enabled users
       [2m[90mâ†“[39m[22m should complete MFA login with valid TOTP
       [2m[90mâ†“[39m[22m should reject invalid TOTP during login
       [2m[90mâ†“[39m[22m should accept TOTP codes within 60-second window
       [2m[90mâ†“[39m[22m should login with valid backup code
       [2m[90mâ†“[39m[22m should mark backup code as used
       [2m[90mâ†“[39m[22m should prevent backup code reuse
       [2m[90mâ†“[39m[22m should try TOTP before backup code
       [2m[90mâ†“[39m[22m should return MFA status for user
       [2m[90mâ†“[39m[22m should return backup codes count for MFA users
       [2m[90mâ†“[39m[22m should disable MFA with password verification
       [2m[90mâ†“[39m[22m should require correct password to disable MFA
       [2m[90mâ†“[39m[22m should regenerate backup codes
       [2m[90mâ†“[39m[22m should return error if MFA not enabled
       [2m[90mâ†“[39m[22m should enforce MFA for tenant users when required by tenant
 [31mâ¯[39m tests/integration/auth/oauth2.token-refresh.test.ts [2m([22m[2m25 tests[22m[2m | [22m[33m25 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should refresh access token with valid refresh token
       [2m[90mâ†“[39m[22m should rotate refresh token after use
       [2m[90mâ†“[39m[22m should return 401 when refresh token is missing
       [2m[90mâ†“[39m[22m should return 401 for invalid refresh token
       [2m[90mâ†“[39m[22m should return 401 for expired refresh token
       [2m[90mâ†“[39m[22m should return 401 for revoked refresh token
       [2m[90mâ†“[39m[22m should return 401 when user is not found
       [2m[90mâ†“[39m[22m should update refresh token metadata on rotation
       [2m[90mâ†“[39m[22m should handle concurrent refresh token requests (token reuse detection)
       [2m[90mâ†“[39m[22m should set secure cookie in production
       [2m[90mâ†“[39m[22m should set proper cookie attributes
       [2m[90mâ†“[39m[22m should include user role information in response
       [2m[90mâ†“[39m[22m should create refresh token on login
       [2m[90mâ†“[39m[22m should revoke refresh token on logout
       [2m[90mâ†“[39m[22m should handle logout without refresh token gracefully
       [2m[90mâ†“[39m[22m should support multiple active refresh tokens per user
       [2m[90mâ†“[39m[22m should revoke all user tokens on password reset
       [2m[90mâ†“[39m[22m should use cryptographically strong random tokens
       [2m[90mâ†“[39m[22m should hash refresh tokens before storing in database
       [2m[90mâ†“[39m[22m should prevent refresh token reuse after rotation
       [2m[90mâ†“[39m[22m should validate token ownership
       [2m[90mâ†“[39m[22m should set HttpOnly flag to prevent XSS
       [2m[90mâ†“[39m[22m should set SameSite=Strict to prevent CSRF
       [2m[90mâ†“[39m[22m should set proper cookie path
       [2m[90mâ†“[39m[22m should set appropriate expiry (30 days)
 [31mâ¯[39m tests/integration/trusted.devices.real.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 600011[2mms[22m[39m
       [2m[90mâ†“[39m[22m should trust current device
       [2m[90mâ†“[39m[22m should set trust expiry to 30 days
       [2m[90mâ†“[39m[22m should update expiry if device already trusted
       [2m[90mâ†“[39m[22m should require authentication
       [2m[90mâ†“[39m[22m should list all trusted devices
       [2m[90mâ†“[39m[22m should mark current device
       [2m[90mâ†“[39m[22m should exclude revoked devices
       [2m[90mâ†“[39m[22m should exclude expired devices
       [2m[90mâ†“[39m[22m should revoke specific device
       [2m[90mâ†“[39m[22m should return 404 for non-existent device
       [2m[90mâ†“[39m[22m should prevent revoking other user's device
       [2m[90mâ†“[39m[22m should skip MFA for trusted device
       [2m[90mâ†“[39m[22m should require MFA for untrusted device
       [2m[90mâ†“[39m[22m should update lastUsedAt on trusted device login
 [31mâ¯[39m tests/integration/auth.routes.real.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m26 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should register a new user successfully
       [2m[90mâ†“[39m[22m should return 400 for invalid email format
       [2m[90mâ†“[39m[22m should return 400 for weak password
       [2m[90mâ†“[39m[22m should return 409 for duplicate email
       [2m[90mâ†“[39m[22m should set httpOnly refresh token cookie
       [2m[90mâ†“[39m[22m should login with valid credentials
       [2m[90mâ†“[39m[22m should return 401 for invalid password
       [2m[90mâ†“[39m[22m should return 401 for non-existent user
       [2m[90mâ†“[39m[22m should return 403 for unverified email
       [2m[90mâ†“[39m[22m should record failed login attempt
       [2m[90mâ†“[39m[22m should return requiresMfa=true for MFA-enabled users
       [2m[90mâ†“[39m[22m should lock account after 5 failed attempts
       [2m[90mâ†“[39m[22m should logout and clear refresh token cookie
       [2m[90mâ†“[39m[22m should refresh access token with valid refresh token
       [2m[90mâ†“[39m[22m should return 401 for missing refresh token
       [2m[90mâ†“[39m[22m should rotate refresh token after use
       [2m[90mâ†“[39m[22m should send password reset email for existing user
       [2m[90mâ†“[39m[22m should not reveal if email exists (security)
       [2m[90mâ†“[39m[22m should reset password with valid token
       [2m[90mâ†“[39m[22m should return 400 for invalid token
       [2m[90mâ†“[39m[22m should return 400 for weak new password
       [2m[90mâ†“[39m[22m should return current user for valid token
       [2m[90mâ†“[39m[22m should return 401 for missing token
       [2m[90mâ†“[39m[22m should return 401 for invalid token
         [2m[90mâ†“[39m[22m should complete MFA login with valid TOTP code
         [2m[90mâ†“[39m[22m should reject invalid MFA code
 [31mâ¯[39m tests/integration/session.management.real.test.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m[33m 600012[2mms[22m[39m
       [2m[90mâ†“[39m[22m should list all active sessions for current user
       [2m[90mâ†“[39m[22m should mark current session correctly
       [2m[90mâ†“[39m[22m should exclude revoked sessions
       [2m[90mâ†“[39m[22m should order sessions by last used (most recent first)
       [2m[90mâ†“[39m[22m should filter sessions by current user only
       [2m[90mâ†“[39m[22m should return 401 for unauthenticated request
       [2m[90mâ†“[39m[22m should revoke specific session
       [2m[90mâ†“[39m[22m should prevent revoking current session
       [2m[90mâ†“[39m[22m should return 404 for non-existent session
       [2m[90mâ†“[39m[22m should prevent revoking other user's session
       [2m[90mâ†“[39m[22m should revoke all other sessions
       [2m[90mâ†“[39m[22m should keep current session active
       [2m[90mâ†“[39m[22m should return 400 if no active session found
       [2m[90mâ†“[39m[22m should revoke all trusted devices
       [2m[90mâ†“[39m[22m should handle user with single session gracefully
       [2m[90mâ†“[39m[22m should include device metadata in sessions
       [2m[90mâ†“[39m[22m should not expose sensitive token data
       [2m[90mâ†“[39m[22m should track session activity timestamps
 [31mâ¯[39m tests/integration/auth.flows.real.test.ts [2m([22m[2m11 tests[22m[2m | [22m[33m11 skipped[39m[2m)[22m[33m 600012[2mms[22m[39m
       [2m[90mâ†“[39m[22m should complete registration, verify email, then login
       [2m[90mâ†“[39m[22m should lock account after 5 failed attempts, then unlock after waiting
       [2m[90mâ†“[39m[22m should record all login attempts
       [2m[90mâ†“[39m[22m should complete MFA setup and login with TOTP
       [2m[90mâ†“[39m[22m should login with backup code when TOTP unavailable
       [2m[90mâ†“[39m[22m should complete full password reset flow
       [2m[90mâ†“[39m[22m should invalidate all sessions after password reset
       [2m[90mâ†“[39m[22m should rotate refresh token on each use
       [2m[90mâ†“[39m[22m should detect and prevent refresh token reuse (token theft)
       [2m[90mâ†“[39m[22m should list all active sessions
       [2m[90mâ†“[39m[22m should revoke specific session
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mğŸ“Š Schema test_schema_w16_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstderr[2m | tests/unit/services/AuthService.test.ts
[22m[39mâš ï¸ Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "closeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:177:34
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w17_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w17_v3 (Reused: true)

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mğŸ“Š Schema test_schema_w19_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mğŸ“Š Schema test_schema_w20_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710124943,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710124945,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710124944,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w19_v3\",public"}
{"level":30,"time":1768710124944,"env":"test","msg":"DB: Created pool for worker 19, schema=\"test_schema_w19_v3\", max connections=5"}
{"level":30,"time":1768710124946,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w20_v3\",public"}
{"level":30,"time":1768710124946,"env":"test","msg":"DB: Created pool for worker 20, schema=\"test_schema_w20_v3\", max connections=5"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768710124956,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710124957,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w21_v3\",public"}
{"level":30,"time":1768710124957,"env":"test","msg":"DB: Created pool for worker 21, schema=\"test_schema_w21_v3\", max connections=5"}
{"level":30,"time":1768710124998,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710125004,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710125010,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mğŸ“Š Schema test_schema_w17_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710125162,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710125163,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w17_v3\",public"}
{"level":30,"time":1768710125164,"env":"test","msg":"DB: Created pool for worker 17, schema=\"test_schema_w17_v3\", max connections=5"}
{"level":30,"time":1768710125216,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w18_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w18_v3 (Reused: true)

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mğŸ“Š Schema test_schema_w18_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710125736,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710125736,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w18_v3\",public"}
{"level":30,"time":1768710125737,"env":"test","msg":"DB: Created pool for worker 18, schema=\"test_schema_w18_v3\", max connections=5"}
{"level":30,"time":1768710125786,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w23_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w23_v3 (Reused: true)

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w27_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w27_v3 (Reused: true)

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w25_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w25_v3 (Reused: true)

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mğŸ“Š Schema test_schema_w23_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710127029,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710127030,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w23_v3\",public"}
{"level":30,"time":1768710127030,"env":"test","msg":"DB: Created pool for worker 23, schema=\"test_schema_w23_v3\", max connections=5"}
{"level":30,"time":1768710127078,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mğŸ“Š Schema test_schema_w27_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710127247,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710127247,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w27_v3\",public"}
{"level":30,"time":1768710127248,"env":"test","msg":"DB: Created pool for worker 27, schema=\"test_schema_w27_v3\", max connections=5"}
{"level":30,"time":1768710127290,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mğŸ“Š Schema test_schema_w25_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710127353,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710127353,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w25_v3\",public"}
{"level":30,"time":1768710127354,"env":"test","msg":"DB: Created pool for worker 25, schema=\"test_schema_w25_v3\", max connections=5"}
{"level":30,"time":1768710127402,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/AuthService.test.ts[2m > [22m[2mAuthService[2m > [22m[2mJWT Token Management[2m > [22m[2mverifyToken()[2m > [22m[2mshould throw error for invalid token signature
[22m[39mDEBUG: verifyToken threw: Invalid or malformed token InvalidTokenError

{"level":30,"time":1768710129612,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768710129612,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768710129614,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768710129615,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [31mâ¯[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[33m23 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a select column with options
       [2m[90mâ†“[39m[22m should create a multiselect column with options
       [2m[90mâ†“[39m[22m should validate select value against options
       [2m[90mâ†“[39m[22m should validate multiselect values as array
       [2m[90mâ†“[39m[22m should create an autonumber column with sequence
       [2m[90mâ†“[39m[22m should format autonumber with prefix
       [2m[90mâ†“[39m[22m should create a note for a row
       [2m[90mâ†“[39m[22m should get all notes for a row
       [2m[90mâ†“[39m[22m should delete a note
       [2m[90mâ†“[39m[22m should not allow deleting notes by other users
       [2m[90mâ†“[39m[22m should create an API token
       [2m[90mâ†“[39m[22m should validate API token scopes
       [2m[90mâ†“[39m[22m should revoke (delete) an API token
       [2m[90mâ†“[39m[22m should deny access with expired token
       [2m[90mâ†“[39m[22m should grant table permission
       [2m[90mâ†“[39m[22m should list table permissions
       [2m[90mâ†“[39m[22m should update table permission role
       [2m[90mâ†“[39m[22m should revoke table permission
       [2m[90mâ†“[39m[22m should enforce RBAC - only owners can manage permissions
       [2m[90mâ†“[39m[22m should paginate rows efficiently
       [2m[90mâ†“[39m[22m should return user-friendly error for invalid column type
       [2m[90mâ†“[39m[22m should return user-friendly error for missing required fields
       [2m[90mâ†“[39m[22m should handle network errors gracefully
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w22_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w26_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w28_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w24_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w22_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w26_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w28_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w24_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 8251[2mms[22m[39m
         [32mâœ“[39m should hash a password using bcrypt with 12 rounds[32m 253[2mms[22m[39m
         [33m[2mâœ“[22m[39m should generate different hashes for same password [33m 479[2mms[22m[39m
         [32mâœ“[39m should handle empty passwords[32m 231[2mms[22m[39m
         [32mâœ“[39m should handle long passwords[32m 231[2mms[22m[39m
         [32mâœ“[39m should handle unicode characters in password[32m 231[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return true for correct password [33m 461[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return false for incorrect password [33m 452[2mms[22m[39m
         [33m[2mâœ“[22m[39m should be case-sensitive [33m 468[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle empty password comparison [33m 465[2mms[22m[39m
         [32mâœ“[39m should accept valid email addresses[32m 2[2mms[22m[39m
         [32mâœ“[39m should reject emails longer than 254 characters (RFC 5321)[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails shorter than 3 characters[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails with consecutive dots[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails without @ symbol[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails without domain[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails with spaces[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails without TLD[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject null or undefined[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails with local part longer than 64 characters[32m 2[2mms[22m[39m
         [32mâœ“[39m should accept valid strong passwords[32m 24[2mms[22m[39m
         [32mâœ“[39m should reject passwords shorter than 8 characters[32m 2[2mms[22m[39m
         [32mâœ“[39m should reject passwords longer than 128 characters[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject weak passwords with zxcvbn score < 3[32m 6[2mms[22m[39m
         [32mâœ“[39m should provide helpful feedback for weak passwords[32m 3[2mms[22m[39m
         [32mâœ“[39m should reject password containing user's email[32m 4[2mms[22m[39m
         [32mâœ“[39m should reject password containing user's name[32m 3[2mms[22m[39m
         [32mâœ“[39m should accept strong password even with user inputs provided[32m 7[2mms[22m[39m
         [32mâœ“[39m should accept password with exactly 8 characters if strong enough[32m 2[2mms[22m[39m
         [32mâœ“[39m should accept password with exactly 128 characters if strong[32m 124[2mms[22m[39m
         [32mâœ“[39m should return score in result object[32m 4[2mms[22m[39m
         [32mâœ“[39m should create a valid JWT token for a user[32m 6[2mms[22m[39m
         [32mâœ“[39m should include userId, email, tenantId, and role in token payload[32m 3[2mms[22m[39m
         [32mâœ“[39m should set token expiry to 15 minutes by default[32m 2[2mms[22m[39m
         [32mâœ“[39m should throw error if JWT_SECRET is not configured[32m 2[2mms[22m[39m
         [32mâœ“[39m should handle null tenantId and role[32m 2[2mms[22m[39m
         [32mâœ“[39m should verify and decode a valid token[32m 2[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error for expired token [33m 1104[2mms[22m[39m
         [32mâœ“[39m should throw error for invalid token signature[32m 4[2mms[22m[39m
         [32mâœ“[39m should throw error for malformed token[32m 2[2mms[22m[39m
         [32mâœ“[39m should throw error for invalid token[32m 1[2mms[22m[39m
         [32mâœ“[39m should extract token from Bearer authorization header[32m 1[2mms[22m[39m
         [32mâœ“[39m should return token if no Bearer prefix[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for undefined header[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for empty header[32m 1[2mms[22m[39m
         [32mâœ“[39m should handle Bearer with multiple spaces[32m 1[2mms[22m[39m
         [32mâœ“[39m should return true for JWT-like tokens[32m 1[2mms[22m[39m
         [32mâœ“[39m should return false for non-JWT tokens[32m 2[2mms[22m[39m
         [32mâœ“[39m should return false for empty token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return false for null/undefined[32m 1[2mms[22m[39m
         [32mâœ“[39m should create a valid portal token for an email[32m 2[2mms[22m[39m
         [32mâœ“[39m should include email and portal flag in token payload[32m 3[2mms[22m[39m
         [32mâœ“[39m should set token expiry to 24 hours[32m 2[2mms[22m[39m
         [32mâœ“[39m should verify and decode a valid portal token[32m 2[2mms[22m[39m
         [32mâœ“[39m should throw error for non-portal token[32m 2[2mms[22m[39m
         [32mâœ“[39m should throw error for token without email[32m 2[2mms[22m[39m
         [32mâœ“[39m should throw error for expired portal token[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should generate password reset token for existing user[39m[32m 228[2mms[22m[39m
         [32mâœ“[39m should return null for non-existent user[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should invalidate previous reset tokens[39m[32m 2[2mms[22m[39m
         [32mâœ“[39m should return userId for valid token[32m 2[2mms[22m[39m
         [32mâœ“[39m should return null for invalid token[32m 2[2mms[22m[39m
         [32mâœ“[39m should return null for expired token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for used token[32m 2[2mms[22m[39m
         [32mâœ“[39m should mark token as used[32m 2[2mms[22m[39m
         [32mâœ“[39m should generate verification token[32m 2[2mms[22m[39m
         [32mâœ“[39m should have 24 hour expiry[32m 2[2mms[22m[39m
         [32mâœ“[39m should verify email with valid token[32m 2[2mms[22m[39m
         [32mâœ“[39m should return false for invalid token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return false for expired token[32m 1[2mms[22m[39m
         [32mâœ“[39m should delete token after successful verification[32m 2[2mms[22m[39m
         [32mâœ“[39m should create refresh token with 30-day expiry[32m 3[2mms[22m[39m
         [32mâœ“[39m should store device metadata[32m 2[2mms[22m[39m
         [32mâœ“[39m should return userId for valid token[32m 2[2mms[22m[39m
         [32mâœ“[39m should return null for revoked token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for expired token[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should rotate valid token and return new one[39m[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should return null for unknown token[39m[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should revoke all tokens on reuse detection[39m[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should return null for expired token[39m[32m 3[2mms[22m[39m
         [32mâœ“[39m should revoke specific token[32m 2[2mms[22m[39m
         [32mâœ“[39m should revoke all tokens for user[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should cleanup expired refresh tokens[39m[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should cleanup expired password reset tokens[39m[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should cleanup expired email verification tokens[39m[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should cleanup old login attempts via accountLockoutService[39m[32m 1[2mms[22m[39m
         [32mâœ“[39m should use JWT_SECRET if provided[32m 1[2mms[22m[39m
         [32mâœ“[39m should warn if JWT_SECRET is less than 32 characters[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject token with modified payload[32m 2[2mms[22m[39m
         [32mâœ“[39m should reject token with valid structure but invalid signature[32m 2[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle password with special characters [33m 445[2mms[22m[39m
         [32mâœ“[39m should handle password with only spaces[32m 226[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle password with newlines and tabs [33m 446[2mms[22m[39m
         [33m[2mâœ“[22m[39m should reject password with null bytes (if validation exists) [33m 447[2mms[22m[39m
         [32mâœ“[39m should reject email with unicode domain (security fix)[32m 2[2mms[22m[39m
         [32mâœ“[39m should reject email starting with dot (security fix)[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject email ending with dot before @ (security fix)[32m 2[2mms[22m[39m
         [32mâœ“[39m should handle email with plus addressing[32m 1[2mms[22m[39m
         [32mâœ“[39m should handle email with subdomain[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject email with invalid TLD (single char)[32m 1[2mms[22m[39m
         [32mâœ“[39m should accept email with numeric TLD[32m 1[2mms[22m[39m
         [32mâœ“[39m should prevent timing attacks on token validation[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should support full user authentication lifecycle[39m[32m 230[2mms[22m[39m
[31m         [31mÃ—[31m should support complete password reset workflow[39m[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should prevent reuse of password reset tokens[39m[32m 2[2mms[22m[39m
         [32mâœ“[39m should support multiple valid refresh tokens per user[32m 2[2mms[22m[39m
         [32mâœ“[39m should revoke all user tokens on security event[32m 1[2mms[22m[39m
         [32mâœ“[39m should handle database connection failures gracefully[32m 3[2mms[22m[39m
         [32mâœ“[39m should handle transaction failures[32m 2[2mms[22m[39m
         [32mâœ“[39m should throw error if JWT signing fails[32m 2[2mms[22m[39m
         [32mâœ“[39m should hash password in reasonable time (< 500ms)[32m 223[2mms[22m[39m
         [33m[2mâœ“[22m[39m should compare password in reasonable time (< 500ms) [33m 452[2mms[22m[39m
         [32mâœ“[39m should create JWT token in < 10ms[32m 2[2mms[22m[39m
         [32mâœ“[39m should verify JWT token in < 50ms[32m 2[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mğŸ“Š Schema test_schema_w26_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710132269,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mğŸ“Š Schema test_schema_w28_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710132269,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w26_v3\",public"}
{"level":30,"time":1768710132270,"env":"test","msg":"DB: Created pool for worker 26, schema=\"test_schema_w26_v3\", max connections=5"}
{"level":30,"time":1768710132269,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710132270,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w28_v3\",public"}
{"level":30,"time":1768710132270,"env":"test","msg":"DB: Created pool for worker 28, schema=\"test_schema_w28_v3\", max connections=5"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mğŸ“Š Schema test_schema_w24_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710132275,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710132276,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w24_v3\",public"}
{"level":30,"time":1768710132276,"env":"test","msg":"DB: Created pool for worker 24, schema=\"test_schema_w24_v3\", max connections=5"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mğŸ“Š Schema test_schema_w22_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710132287,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710132288,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w22_v3\",public"}
{"level":30,"time":1768710132288,"env":"test","msg":"DB: Created pool for worker 22, schema=\"test_schema_w22_v3\", max connections=5"}
{"level":30,"time":1768710132316,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710132316,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710132321,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710132335,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768710134308,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768710136050,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w29_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w29_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mğŸ“Š Schema test_schema_w29_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710136727,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710136727,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w29_v3\",public"}
{"level":30,"time":1768710136727,"env":"test","msg":"DB: Created pool for worker 29, schema=\"test_schema_w29_v3\", max connections=5"}
{"level":30,"time":1768710136773,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w30_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w30_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mğŸ“Š Schema test_schema_w30_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710138254,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710138254,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w30_v3\",public"}
{"level":30,"time":1768710138254,"env":"test","msg":"DB: Created pool for worker 30, schema=\"test_schema_w30_v3\", max connections=5"}
{"level":30,"time":1768710138294,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710423451,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710423592,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710424094,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710424108,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710424340,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710424879,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710426173,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710426388,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710426532,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710431382,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710431391,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710431396,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768710431396,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710435903,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768710437457,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/middleware/auth.middleware.test.ts [2m([22m[2m22 tests[22m[2m | [22m[33m22 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should authenticate with valid JWT token
       [2m[90mâ†“[39m[22m should return 401 for missing token
       [2m[90mâ†“[39m[22m should return 401 for invalid token
       [2m[90mâ†“[39m[22m should return 401 for expired token
       [2m[90mâ†“[39m[22m should extract token without Bearer prefix
       [2m[90mâ†“[39m[22m should authenticate with valid token
       [2m[90mâ†“[39m[22m should proceed without auth when no token provided
       [2m[90mâ†“[39m[22m should proceed even with invalid token
       [2m[90mâ†“[39m[22m should authenticate with JWT Bearer token
       [2m[90mâ†“[39m[22m should authenticate with refresh token cookie for GET requests
       [2m[90mâ†“[39m[22m should reject cookie auth for POST requests
       [2m[90mâ†“[39m[22m should prioritize JWT over cookie when both present
       [2m[90mâ†“[39m[22m should allow cookie auth only for safe methods
       [2m[90mâ†“[39m[22m should return 401 when no auth provided
       [2m[90mâ†“[39m[22m should authenticate with JWT
       [2m[90mâ†“[39m[22m should authenticate with cookie for GET
       [2m[90mâ†“[39m[22m should proceed without auth when none provided
       [2m[90mâ†“[39m[22m should proceed even with invalid auth
       [2m[90mâ†“[39m[22m should not allow token tampering
       [2m[90mâ†“[39m[22m should not allow cookie auth for mutations (CSRF protection)
       [2m[90mâ†“[39m[22m should reject malformed JWT
       [2m[90mâ†“[39m[22m should handle missing authorization header gracefully
 [31mâ¯[39m tests/integration/organizationService.test.ts [2m([22m[2m13 tests[22m[2m | [22m[33m13 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create organization and auto-create admin membership
       [2m[90mâ†“[39m[22m should return all organizations for user
       [2m[90mâ†“[39m[22m should return empty array for user with no memberships
       [2m[90mâ†“[39m[22m should allow admin to update organization
       [2m[90mâ†“[39m[22m should deny non-admin from updating organization
       [2m[90mâ†“[39m[22m should return all members of organization
       [2m[90mâ†“[39m[22m should allow admin to promote member
       [2m[90mâ†“[39m[22m should allow admin to demote other admin
       [2m[90mâ†“[39m[22m should prevent self-demotion
       [2m[90mâ†“[39m[22m should allow admin to remove member
       [2m[90mâ†“[39m[22m should prevent self-removal
       [2m[90mâ†“[39m[22m should allow member to leave organization
       [2m[90mâ†“[39m[22m should allow admin to leave organization
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

 [31mâ¯[39m tests/integration/regression-REG-1.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should block Next when required visible question is empty
       [2m[90mâ†“[39m[22m should NOT block Next when required question is hidden
       [2m[90mâ†“[39m[22m should block when required becomes visible and is empty
       [2m[90mâ†“[39m[22m should skip hidden required page entirely
       [2m[90mâ†“[39m[22m should enforce required on visible page
       [2m[90mâ†“[39m[22m should evaluate visibility consistently across modes
       [2m[90mâ†“[39m[22m should handle malformed visibility expression gracefully
       [2m[90mâ†“[39m[22m should handle missing variable in visibility expression
 [31mâ¯[39m tests/integration/variableSafety.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m REPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided
     [2m[90mâ†“[39m[22m ScriptEngine resolves alias 'input_variable' when aliasMap is provided
     [2m[90mâ†“[39m[22m REPRO: BlockRunner fails to resolve alias in CreateRecordConfig
     [2m[90mâ†“[39m[22m BlockRunner logic resolves alias with aliasMap
 [31mâ¯[39m tests/integration/auth/oauth2.google.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 600005[2mms[22m[39m
       [2m[90mâ†“[39m[22m should successfully authenticate with valid Google ID token
       [2m[90mâ†“[39m[22m should return 400 when ID token is missing
       [2m[90mâ†“[39m[22m should return 403 when Origin header is invalid
       [2m[90mâ†“[39m[22m should return 401 when Google token verification fails
       [2m[90mâ†“[39m[22m should return 401 when email is not verified by Google
       [2m[90mâ†“[39m[22m should update existing user on subsequent logins
       [2m[90mâ†“[39m[22m should create refresh token record in database
       [2m[90mâ†“[39m[22m should support both "token" and "idToken" fields
       [2m[90mâ†“[39m[22m should respect rate limiting
       [2m[90mâ†“[39m[22m should handle missing profile information gracefully
       [2m[90mâ†“[39m[22m should verify valid Google ID token
       [2m[90mâ†“[39m[22m should throw error when token verification fails
       [2m[90mâ†“[39m[22m should throw error when email is not verified
       [2m[90mâ†“[39m[22m should throw error when payload is null
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [31mâ¯[39m tests/integration/workflows/runtime-pipelines.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create DataVault row on workflow completion
       [2m[90mâ†“[39m[22m should execute writebacks via RunService.completeRun()
       [2m[90mâ†“[39m[22m should skip document generation when visibleIf condition is false
       [2m[90mâ†“[39m[22m should generate document when visibleIf condition is true
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w34_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

 [31mâ¯[39m tests/integration/workflow_versioning.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should diff two versions correctly
     [2m[90mâ†“[39m[22m should create a version and populate changelog
     [2m[90mâ†“[39m[22m should track execution lineage via snapshot
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w34_v3 (Reused: true)

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

 [31mâ¯[39m tests/integration/organizations-audit-fixes.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should cascade ownership to workflow runs when project is transferred
       [2m[90mâ†“[39m[22m should prevent double-acceptance via transaction
       [2m[90mâ†“[39m[22m should not create invite if email fails
       [2m[90mâ†“[39m[22m should allow re-invite after invite expires
       [2m[90mâ†“[39m[22m should allow last admin to delete empty organization
       [2m[90mâ†“[39m[22m should prevent deletion if org owns assets
       [2m[90mâ†“[39m[22m should cleanup placeholder user when invite is revoked
       [2m[90mâ†“[39m[22m should fail fast on non-existent org
 [31mâ¯[39m tests/integration/externalSends.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m PREVIEW MODE: Should simulate send and NOT call fetch
     [2m[90mâ†“[39m[22m LIVE MODE: Should call fetch with mapped payload
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mğŸ“Š Schema test_schema_w34_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710726629,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710726630,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w34_v3\",public"}
{"level":30,"time":1768710726630,"env":"test","msg":"DB: Created pool for worker 34, schema=\"test_schema_w34_v3\", max connections=5"}
{"level":30,"time":1768710726680,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w35_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w35_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w32_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w32_v3 (Reused: true)

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mğŸ“Š Schema test_schema_w35_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710727370,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710727371,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w35_v3\",public"}
{"level":30,"time":1768710727371,"env":"test","msg":"DB: Created pool for worker 35, schema=\"test_schema_w35_v3\", max connections=5"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768710727421,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mğŸ“Š Schema test_schema_w32_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710727686,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710727686,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w32_v3\",public"}
{"level":30,"time":1768710727687,"env":"test","msg":"DB: Created pool for worker 32, schema=\"test_schema_w32_v3\", max connections=5"}
{"level":30,"time":1768710727737,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w37_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w37_v3 (Reused: true)

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768710728195,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mğŸ“Š Schema test_schema_w37_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710728319,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710728319,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w37_v3\",public"}
{"level":30,"time":1768710728319,"env":"test","msg":"DB: Created pool for worker 37, schema=\"test_schema_w37_v3\", max connections=5"}
{"level":30,"time":1768710728365,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710728882,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768710730040,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w31_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w31_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mğŸ“Š Schema test_schema_w31_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710730908,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710730908,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w31_v3\",public"}
{"level":30,"time":1768710730908,"env":"test","msg":"DB: Created pool for worker 31, schema=\"test_schema_w31_v3\", max connections=5"}
{"level":30,"time":1768710730960,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w33_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w33_v3 (Reused: true)

 [31mâ¯[39m tests/integration/api.projects.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new project
       [2m[90mâ†“[39m[22m should reject without authentication
       [2m[90mâ†“[39m[22m should reject with invalid data
       [2m[90mâ†“[39m[22m should list projects for tenant
       [2m[90mâ†“[39m[22m should support pagination
       [2m[90mâ†“[39m[22m should get project by ID
       [2m[90mâ†“[39m[22m should return 404 for non-existent project
       [2m[90mâ†“[39m[22m should update project
       [2m[90mâ†“[39m[22m should soft-delete project
       [2m[90mâ†“[39m[22m should not allow cross-tenant access
{"level":30,"time":1768710731391,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [31mâ¯[39m tests/integration/auth/session.management.integration.test.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create refresh token on login
       [2m[90mâ†“[39m[22m should track device metadata in session
       [2m[90mâ†“[39m[22m should create separate sessions for multiple device logins
       [2m[90mâ†“[39m[22m should list all active sessions for user
       [2m[90mâ†“[39m[22m should mark current session correctly
       [2m[90mâ†“[39m[22m should not include revoked sessions
       [2m[90mâ†“[39m[22m should order sessions by last used (most recent first)
       [2m[90mâ†“[39m[22m should require authentication
       [2m[90mâ†“[39m[22m should revoke specific session
       [2m[90mâ†“[39m[22m should prevent revoking current session
       [2m[90mâ†“[39m[22m should not allow revoking other users sessions
       [2m[90mâ†“[39m[22m should return 404 for non-existent session ID
       [2m[90mâ†“[39m[22m should revoke all sessions except current
       [2m[90mâ†“[39m[22m should revoke all trusted devices
       [2m[90mâ†“[39m[22m should require active session
       [2m[90mâ†“[39m[22m should reject refresh token after 30 days
       [2m[90mâ†“[39m[22m should handle multiple concurrent logins
       [2m[90mâ†“[39m[22m should handle concurrent token refreshes
 [31mâ¯[39m tests/integration/api.runs.graph.test.ts [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should list all runs with pagination
       [2m[90mâ†“[39m[22m should filter runs by status
       [2m[90mâ†“[39m[22m should filter runs by workflow
       [2m[90mâ†“[39m[22m should filter runs by project
       [2m[90mâ†“[39m[22m should filter runs by date range
       [2m[90mâ†“[39m[22m should search runs by query string
       [2m[90mâ†“[39m[22m should get run by ID with all details
       [2m[90mâ†“[39m[22m should return 404 for non-existent run
       [2m[90mâ†“[39m[22m should get logs for a run
       [2m[90mâ†“[39m[22m should re-run workflow with same inputs
       [2m[90mâ†“[39m[22m should re-run workflow with override inputs
       [2m[90mâ†“[39m[22m should return 404 for non-existent run
       [2m[90mâ†“[39m[22m should export runs to CSV
       [2m[90mâ†“[39m[22m should export runs with filters applied
       [2m[90mâ†“[39m[22m should compare two runs
       [2m[90mâ†“[39m[22m should identify changed input keys
       [2m[90mâ†“[39m[22m should return 404 if run A not found
       [2m[90mâ†“[39m[22m should return 404 if run B not found
       [2m[90mâ†“[39m[22m should enforce tenant isolation on runs list
 [31mâ¯[39m tests/integration/auth/protected.routes.test.ts [2m([22m[2m33 tests[22m[2m | [22m[33m33 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should allow access with valid Bearer token
       [2m[90mâ†“[39m[22m should reject access without Authorization header
       [2m[90mâ†“[39m[22m should reject access with empty Bearer token
       [2m[90mâ†“[39m[22m should reject access with malformed Authorization header
       [2m[90mâ†“[39m[22m should reject access with wrong token type
       [2m[90mâ†“[39m[22m should allow POST with valid Bearer token
       [2m[90mâ†“[39m[22m should reject POST without Bearer token
       [2m[90mâ†“[39m[22m should reject POST with invalid token
       [2m[90mâ†“[39m[22m should allow PUT with valid Bearer token
       [2m[90mâ†“[39m[22m should reject PUT without Bearer token
       [2m[90mâ†“[39m[22m should allow DELETE with valid Bearer token
       [2m[90mâ†“[39m[22m should reject DELETE without Bearer token
       [2m[90mâ†“[39m[22m should allow PATCH with valid Bearer token
       [2m[90mâ†“[39m[22m should reject PATCH without Bearer token
       [2m[90mâ†“[39m[22m should handle Bearer token with extra spaces
       [2m[90mâ†“[39m[22m should handle token with newlines
       [2m[90mâ†“[39m[22m should handle very long invalid token
       [2m[90mâ†“[39m[22m should handle empty Authorization header
       [2m[90mâ†“[39m[22m should handle Authorization header with only Bearer
       [2m[90mâ†“[39m[22m should handle multiple Authorization headers
       [2m[90mâ†“[39m[22m should reject token with SQL injection attempt
       [2m[90mâ†“[39m[22m should reject token with XSS attempt
       [2m[90mâ†“[39m[22m should reject token with missing userId
       [2m[90mâ†“[39m[22m should reject token with non-existent userId
       [2m[90mâ†“[39m[22m should not allow user to access another user's resources
       [2m[90mâ†“[39m[22m should inject userId into request context
       [2m[90mâ†“[39m[22m should inject tenantId into request context
       [2m[90mâ†“[39m[22m should inject role into request context
       [2m[90mâ†“[39m[22m should not apply general rate limiting to authenticated requests
       [2m[90mâ†“[39m[22m should handle request with both Bearer token and cookies
       [2m[90mâ†“[39m[22m should prioritize Bearer token over cookie when both present
       [2m[90mâ†“[39m[22m should allow unauthenticated access to optional auth routes
       [2m[90mâ†“[39m[22m should enhance optional auth routes with user context when authenticated
{"level":30,"time":1768710731524,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mğŸ“Š Schema test_schema_w33_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710731537,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710731538,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w33_v3\",public"}
{"level":30,"time":1768710731538,"env":"test","msg":"DB: Created pool for worker 33, schema=\"test_schema_w33_v3\", max connections=5"}
{"level":30,"time":1768710731603,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w36_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w36_v3 (Reused: true)

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mğŸ“Š Schema test_schema_w36_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710732833,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710732834,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w36_v3\",public"}
{"level":30,"time":1768710732834,"env":"test","msg":"DB: Created pool for worker 36, schema=\"test_schema_w36_v3\", max connections=5"}
{"level":30,"time":1768710732890,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w41_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w41_v3 (Reused: true)

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w38_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w38_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w39_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w39_v3 (Reused: true)

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w43_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w43_v3 (Reused: true)

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mğŸ“Š Schema test_schema_w41_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710734181,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710734182,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w41_v3\",public"}
{"level":30,"time":1768710734182,"env":"test","msg":"DB: Created pool for worker 41, schema=\"test_schema_w41_v3\", max connections=5"}
{"level":30,"time":1768710734231,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mğŸ“Š Schema test_schema_w38_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710734400,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710734401,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w38_v3\",public"}
{"level":30,"time":1768710734401,"env":"test","msg":"DB: Created pool for worker 38, schema=\"test_schema_w38_v3\", max connections=5"}
{"level":30,"time":1768710734451,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mğŸ“Š Schema test_schema_w39_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710734490,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710734490,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w39_v3\",public"}
{"level":30,"time":1768710734490,"env":"test","msg":"DB: Created pool for worker 39, schema=\"test_schema_w39_v3\", max connections=5"}
{"level":30,"time":1768710734539,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mğŸ“Š Schema test_schema_w43_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710734545,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710734546,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w43_v3\",public"}
{"level":30,"time":1768710734546,"env":"test","msg":"DB: Created pool for worker 43, schema=\"test_schema_w43_v3\", max connections=5"}
{"level":30,"time":1768710734586,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/api.dataSources.native.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 600006[2mms[22m[39m
     [2m[90mâ†“[39m[22m should list databases and databases' tables in the catalog
     [2m[90mâ†“[39m[22m should create a native_table data source
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768710736630,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768710736660,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

 [31mâ¯[39m tests/integration/api.runs.docx.test.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should execute workflow with template node and generate DOCX
       [2m[90mâ†“[39m[22m should handle missing template data gracefully
       [2m[90mâ†“[39m[22m should download DOCX output from successful run
       [2m[90mâ†“[39m[22m should return 404 for PDF when not generated
       [2m[90mâ†“[39m[22m should return 404 for non-existent run
       [2m[90mâ†“[39m[22m should extract placeholders from uploaded template
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w42_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w40_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w42_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w40_v3 (Reused: true)

[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mğŸ“Š Schema test_schema_w42_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710739126,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710739126,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w42_v3\",public"}
{"level":30,"time":1768710739127,"env":"test","msg":"DB: Created pool for worker 42, schema=\"test_schema_w42_v3\", max connections=5"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mğŸ“Š Schema test_schema_w40_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710739135,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710739136,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w40_v3\",public"}
{"level":30,"time":1768710739136,"env":"test","msg":"DB: Created pool for worker 40, schema=\"test_schema_w40_v3\", max connections=5"}
{"level":30,"time":1768710739170,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710739180,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768710740029,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768710741255,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w44_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w44_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mğŸ“Š Schema test_schema_w44_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710742206,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710742206,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w44_v3\",public"}
{"level":30,"time":1768710742206,"env":"test","msg":"DB: Created pool for worker 44, schema=\"test_schema_w44_v3\", max connections=5"}
{"level":30,"time":1768710742246,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w45_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w45_v3 (Reused: true)

[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mğŸ“Š Schema test_schema_w45_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768710743453,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768710743453,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w45_v3\",public"}
{"level":30,"time":1768710743454,"env":"test","msg":"DB: Created pool for worker 45, schema=\"test_schema_w45_v3\", max connections=5"}
{"level":30,"time":1768710743492,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768711025762,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711026550,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711026873,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711027491,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711030104,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711030743,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711031957,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711033356,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711033572,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711033658,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711033712,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711038299,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711038326,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711041419,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711042652,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/integration/auth/oauth2.callback.test.ts [2m([22m[2m16 tests[22m[2m | [22m[33m16 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should initiate OAuth2 3-legged flow and generate authorization URL
       [2m[90mâ†“[39m[22m should include optional scope in authorization URL
       [2m[90mâ†“[39m[22m should validate valid OAuth2 state token
       [2m[90mâ†“[39m[22m should reject invalid OAuth2 state token
       [2m[90mâ†“[39m[22m should reject expired OAuth2 state token
       [2m[90mâ†“[39m[22m should clean up OAuth2 state after use
       [2m[90mâ†“[39m[22m should handle callback with missing state parameter
       [2m[90mâ†“[39m[22m should handle callback with missing code parameter
       [2m[90mâ†“[39m[22m should handle OAuth2 provider error responses
       [2m[90mâ†“[39m[22m should track OAuth2 connection status
       [2m[90mâ†“[39m[22m should store OAuth2 state in connection metadata
       [2m[90mâ†“[39m[22m should use cryptographically secure random state
       [2m[90mâ†“[39m[22m should prevent state reuse after validation
       [2m[90mâ†“[39m[22m should include PKCE support metadata in state record
       [2m[90mâ†“[39m[22m should validate redirect URI matches allowed URIs
       [2m[90mâ†“[39m[22m should encode redirect URI in authorization URL
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

 [31mâ¯[39m tests/integration/analytics_service.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should generate events and metrics on run completion
 [31mâ¯[39m tests/integration/dataBlocks.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should write data to DataVault via WriteBlock
     [2m[90mâ†“[39m[22m should query data from DataVault via QueryBlock and use in Logic
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w46_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w46_v3 (Reused: true)

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mğŸ“Š Schema test_schema_w46_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768711327494,"env":"test","msg":"DB: initializing... Local"}
 [31mâ¯[39m tests/integration/collections.e2e.test.ts [2m([22m[2m22 tests[22m[2m | [22m[33m22 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a collection
       [2m[90mâ†“[39m[22m should list collections
       [2m[90mâ†“[39m[22m should get a collection by ID
       [2m[90mâ†“[39m[22m should update a collection
       [2m[90mâ†“[39m[22m should create text field
       [2m[90mâ†“[39m[22m should create email field
       [2m[90mâ†“[39m[22m should create number field
       [2m[90mâ†“[39m[22m should create select field with options
       [2m[90mâ†“[39m[22m should create boolean field
       [2m[90mâ†“[39m[22m should list all fields
       [2m[90mâ†“[39m[22m should update field
       [2m[90mâ†“[39m[22m should create a record
       [2m[90mâ†“[39m[22m should create multiple records
       [2m[90mâ†“[39m[22m should list records with pagination
       [2m[90mâ†“[39m[22m should get a single record
       [2m[90mâ†“[39m[22m should update a record
       [2m[90mâ†“[39m[22m should find records by filters
       [2m[90mâ†“[39m[22m should delete a record
       [2m[90mâ†“[39m[22m should list collections with stats
       [2m[90mâ†“[39m[22m should enforce required fields
       [2m[90mâ†“[39m[22m should validate field types
       [2m[90mâ†“[39m[22m should delete collection (cascade fields and records)
{"level":30,"time":1768711327495,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w46_v3\",public"}
{"level":30,"time":1768711327495,"env":"test","msg":"DB: Created pool for worker 46, schema=\"test_schema_w46_v3\", max connections=5"}
{"level":30,"time":1768711327538,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w47_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w47_v3 (Reused: true)

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mğŸ“Š Schema test_schema_w47_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768711328155,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711328156,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w47_v3\",public"}
{"level":30,"time":1768711328156,"env":"test","msg":"DB: Created pool for worker 47, schema=\"test_schema_w47_v3\", max connections=5"}
{"level":30,"time":1768711328183,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w48_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w48_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mğŸ“Š Schema test_schema_w48_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768711328689,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711328690,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w48_v3\",public"}
{"level":30,"time":1768711328690,"env":"test","msg":"DB: Created pool for worker 48, schema=\"test_schema_w48_v3\", max connections=5"}
{"level":30,"time":1768711328728,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/api.templates-runs.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
         [2m[90mâ†“[39m[22m should create template with file upload
         [2m[90mâ†“[39m[22m should reject non-docx files
         [2m[90mâ†“[39m[22m should reject without file
         [2m[90mâ†“[39m[22m should list templates
         [2m[90mâ†“[39m[22m should get template by ID
         [2m[90mâ†“[39m[22m should extract placeholders
         [2m[90mâ†“[39m[22m should update template name
         [2m[90mâ†“[39m[22m should delete template
         [2m[90mâ†“[39m[22m should execute workflow
         [2m[90mâ†“[39m[22m should include logs in debug mode
         [2m[90mâ†“[39m[22m should reject without required permission
         [2m[90mâ†“[39m[22m should list runs
         [2m[90mâ†“[39m[22m should filter by workflowId
         [2m[90mâ†“[39m[22m should get run by ID
         [2m[90mâ†“[39m[22m should get run logs
{"level":30,"time":1768711330428,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [31mâ¯[39m tests/integration/api.snapshots.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 600006[2mms[22m[39m
     [2m[90mâ†“[39m[22m should maintain immutability of runs across versions
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

 [31mâ¯[39m tests/integration/datavault.permissions.test.ts [2m([22m[2m22 tests[22m[2m | [22m[33m22 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should allow owner to read table
       [2m[90mâ†“[39m[22m should allow writer to read table
       [2m[90mâ†“[39m[22m should allow reader to read table
       [2m[90mâ†“[39m[22m should deny non-member from reading table
       [2m[90mâ†“[39m[22m should allow owner to update table
       [2m[90mâ†“[39m[22m should deny writer from updating table
       [2m[90mâ†“[39m[22m should deny reader from updating table
       [2m[90mâ†“[39m[22m should deny writer from deleting table
       [2m[90mâ†“[39m[22m should deny reader from deleting table
       [2m[90mâ†“[39m[22m should deny non-member from deleting table
       [2m[90mâ†“[39m[22m should allow owner to view permissions
       [2m[90mâ†“[39m[22m should deny writer from viewing permissions
       [2m[90mâ†“[39m[22m should deny reader from viewing permissions
       [2m[90mâ†“[39m[22m should allow owner to grant permissions
       [2m[90mâ†“[39m[22m should allow owner to update existing permission (upsert)
       [2m[90mâ†“[39m[22m should deny writer from granting permissions
       [2m[90mâ†“[39m[22m should prevent modifying table owner permissions
       [2m[90mâ†“[39m[22m should allow owner to revoke permissions
       [2m[90mâ†“[39m[22m should deny writer from revoking permissions
       [2m[90mâ†“[39m[22m should enforce owner includes write and read
       [2m[90mâ†“[39m[22m should enforce write includes read but not owner
       [2m[90mâ†“[39m[22m should enforce read is read-only
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w49_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w49_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mğŸ“Š Schema test_schema_w49_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768711332637,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711332637,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w49_v3\",public"}
{"level":30,"time":1768711332637,"env":"test","msg":"DB: Created pool for worker 49, schema=\"test_schema_w49_v3\", max connections=5"}
{"level":30,"time":1768711332679,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

 [31mâ¯[39m tests/integration/dynamic_options_workflow.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should successfully configure a workflow with Read Table -> Dynamic Choice
 [31mâ¯[39m tests/integration/intake.workflow.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should allow designating a workflow as Intake
     [2m[90mâ†“[39m[22m should allow linking a downstream workflow to an intake workflow
 [31mâ¯[39m tests/integration/auth/auth.middleware.integration.test.ts [2m([22m[2m27 tests[22m[2m | [22m[33m27 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should allow access with valid JWT Bearer token
       [2m[90mâ†“[39m[22m should return 401 when no token provided
       [2m[90mâ†“[39m[22m should return 401 with invalid token
       [2m[90mâ†“[39m[22m should return 401 with expired token
       [2m[90mâ†“[39m[22m should proceed without authentication if no token provided
       [2m[90mâ†“[39m[22m should authenticate with JWT Bearer token
       [2m[90mâ†“[39m[22m should authenticate with refresh token cookie (GET only)
       [2m[90mâ†“[39m[22m should reject cookie auth for POST requests (mutation-strict)
       [2m[90mâ†“[39m[22m should reject cookie auth for PUT requests
       [2m[90mâ†“[39m[22m should reject cookie auth for DELETE requests
       [2m[90mâ†“[39m[22m should allow cookie auth for HEAD requests
       [2m[90mâ†“[39m[22m should prioritize JWT over cookie when both present
       [2m[90mâ†“[39m[22m should return 401 when no auth provided
       [2m[90mâ†“[39m[22m should return 401 when both JWT and cookie are invalid
       [2m[90mâ†“[39m[22m should authenticate with JWT if provided
       [2m[90mâ†“[39m[22m should authenticate with cookie if JWT not provided
       [2m[90mâ†“[39m[22m should proceed anonymously if no auth provided
       [2m[90mâ†“[39m[22m should proceed anonymously if both JWT and cookie are invalid
       [2m[90mâ†“[39m[22m should only allow safe methods for cookie auth
       [2m[90mâ†“[39m[22m should ignore cookies when Bearer token present
       [2m[90mâ†“[39m[22m should attach userId to request
       [2m[90mâ†“[39m[22m should attach userEmail to request
       [2m[90mâ†“[39m[22m should return consistent error format for missing token
       [2m[90mâ†“[39m[22m should return consistent error format for invalid token
       [2m[90mâ†“[39m[22m should return consistent error format for expired token
       [2m[90mâ†“[39m[22m should handle malformed JWT gracefully
       [2m[90mâ†“[39m[22m should handle JWT with wrong algorithm
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [31mâ¯[39m tests/integration/ai/workflowEdit.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
     [2m[90mâ†“[39m[22m should create draft version on successful AI edit
     [2m[90mâ†“[39m[22m should enforce draft mode (revert active workflow to draft)
     [2m[90mâ†“[39m[22m should not create version when no changes detected (checksum match)
     [2m[90mâ†“[39m[22m should reject unauthorized access
     [2m[90mâ†“[39m[22m should reject unsafe DataVault operations
     [2m[90mâ†“[39m[22m should handle multi-operation edits with tempId resolution
     [2m[90mâ†“[39m[22m should create BEFORE and AFTER snapshots
     [2m[90mâ†“[39m[22m should rollback on validation failure
[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

{"level":30,"time":1768711334201,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w53_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w53_v3 (Reused: true)

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mğŸ“Š Schema test_schema_w53_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w54_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w54_v3 (Reused: true)

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w52_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w52_v3 (Reused: true)

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w56_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w56_v3 (Reused: true)

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mğŸ“Š Schema test_schema_w54_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768711335360,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mğŸ“Š Schema test_schema_w52_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711335443,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711335444,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w53_v3\",public"}
{"level":30,"time":1768711335444,"env":"test","msg":"DB: Created pool for worker 53, schema=\"test_schema_w53_v3\", max connections=5"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mğŸ“Š Schema test_schema_w56_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768711335499,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711335998,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711335998,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w54_v3\",public"}
{"level":30,"time":1768711335999,"env":"test","msg":"DB: Created pool for worker 54, schema=\"test_schema_w54_v3\", max connections=5"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768711336050,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711336230,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711336231,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w56_v3\",public"}
{"level":30,"time":1768711336231,"env":"test","msg":"DB: Created pool for worker 56, schema=\"test_schema_w56_v3\", max connections=5"}
{"level":30,"time":1768711336271,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711336423,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711336423,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w52_v3\",public"}
{"level":30,"time":1768711336424,"env":"test","msg":"DB: Created pool for worker 52, schema=\"test_schema_w52_v3\", max connections=5"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w50_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w50_v3 (Reused: true)

{"level":30,"time":1768711336472,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mğŸ“Š Schema test_schema_w50_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768711336872,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711336872,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w50_v3\",public"}
{"level":30,"time":1768711336872,"env":"test","msg":"DB: Created pool for worker 50, schema=\"test_schema_w50_v3\", max connections=5"}
{"level":30,"time":1768711336916,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768711337215,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768711337215,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768711337281,"env":"test","msg":"Master key validated successfully"}
{"level":30,"time":1768711337281,"env":"test","provider":"gemini","model":"gemini-2.0-flash","msg":"AI Service configured and ready"}
{"level":30,"time":1768711337281,"env":"test","msg":"Initializing database..."}
{"level":30,"time":1768711337281,"env":"test","msg":"Database initialized."}
{"level":30,"time":1768711337282,"env":"test","module":"email-queue","intervalMs":5000,"msg":"Starting email queue worker"}
Sourcemap for "C:/Users/scoot/poll/VaultLogic/node_modules/node-cron/dist/esm/node-cron.js" points to missing source files
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w55_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

{"level":30,"time":1768711337335,"env":"test","module":"cron","msg":"Initializing cron jobs..."}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w55_v3 (Reused: true)

{"level":30,"time":1768711337378,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39mğŸ“š API Documentation available at /api-docs

{"level":30,"time":1768711337359,"env":"test","module":"cron","msg":"Cron jobs initialized"}
{"level":30,"time":1768711337360,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768711337368,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768711337369,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768711337373,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768711337374,"env":"test","msg":"[Routes] E-Signature routes registered at /api/esign"}
{"level":30,"time":1768711337377,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768711337377,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768711337378,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768711337378,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768711337378,"env":"test","msg":"Loading Vite for development..."}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mğŸ“Š Schema test_schema_w55_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [31mâ¯[39m tests/integration/auth/jwt.authentication.test.ts [2m([22m[2m27 tests[22m[2m | [22m[33m27 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should generate valid JWT token on successful login
       [2m[90mâ†“[39m[22m should include correct payload in JWT token
       [2m[90mâ†“[39m[22m should set JWT expiry to 15 minutes
       [2m[90mâ†“[39m[22m should accept valid JWT token on protected routes
       [2m[90mâ†“[39m[22m should reject request without authorization header
       [2m[90mâ†“[39m[22m should reject request with malformed token
       [2m[90mâ†“[39m[22m should accept request with missing Bearer prefix (lenient)
       [2m[90mâ†“[39m[22m should reject token with invalid signature
       [2m[90mâ†“[39m[22m should reject expired JWT token
       [2m[90mâ†“[39m[22m should return token_expired error code for expired tokens
       [2m[90mâ†“[39m[22m should authenticate with Bearer token in Authorization header
       [2m[90mâ†“[39m[22m should work with Bearer token on POST requests
       [2m[90mâ†“[39m[22m should work with Bearer token on PUT requests
       [2m[90mâ†“[39m[22m should work with Bearer token on DELETE requests
       [2m[90mâ†“[39m[22m should exchange valid session cookie for JWT token
       [2m[90mâ†“[39m[22m should reject token exchange without valid cookie
       [2m[90mâ†“[39m[22m should prefer Bearer token over cookie when both present
       [2m[90mâ†“[39m[22m should fall back to cookie if Bearer token is invalid
       [2m[90mâ†“[39m[22m should allow GET requests with cookie auth only
       [2m[90mâ†“[39m[22m should reject POST requests with cookie auth only (mutation-strict)
       [2m[90mâ†“[39m[22m should allow anonymous access to public workflows
       [2m[90mâ†“[39m[22m should attach user info if authenticated on optional auth routes
       [2m[90mâ†“[39m[22m should refresh access token using refresh token
       [2m[90mâ†“[39m[22m should rotate refresh token on use
       [2m[90mâ†“[39m[22m should detect token reuse and revoke all user tokens
       [2m[90mâ†“[39m[22m should revoke refresh token on logout
       [2m[90mâ†“[39m[22m should clear refresh token cookie on logout
 [31mâ¯[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[33m17 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new draft workflow
       [2m[90mâ†“[39m[22m should reject without permission
       [2m[90mâ†“[39m[22m should list workflows
       [2m[90mâ†“[39m[22m should filter by status
       [2m[90mâ†“[39m[22m should search by name
       [2m[90mâ†“[39m[22m should update draft workflow
       [2m[90mâ†“[39m[22m should not allow editing published workflow
       [2m[90mâ†“[39m[22m should publish workflow
       [2m[90mâ†“[39m[22m should list workflow versions
       [2m[90mâ†“[39m[22m should move workflow to a project
       [2m[90mâ†“[39m[22m should move workflow to Main Folder (projectId = null)
       [2m[90mâ†“[39m[22m should reject move to non-existent project
       [2m[90mâ†“[39m[22m should reject move without authentication
       [2m[90mâ†“[39m[22m should reject move of workflow user does not own
       [2m[90mâ†“[39m[22m should reject move with invalid projectId format
       [2m[90mâ†“[39m[22m should reject move without projectId in body
       [2m[90mâ†“[39m[22m should reject move to project user does not have access to
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711338397,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711338397,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w55_v3\",public"}
{"level":30,"time":1768711338398,"env":"test","msg":"DB: Created pool for worker 55, schema=\"test_schema_w55_v3\", max connections=5"}
{"level":30,"time":1768711338442,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w57_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w57_v3 (Reused: true)

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w58_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w58_v3 (Reused: true)

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mğŸ“Š Schema test_schema_w57_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mğŸ“Š Schema test_schema_w58_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711340213,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711340214,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w57_v3\",public"}
{"level":30,"time":1768711340214,"env":"test","msg":"DB: Created pool for worker 57, schema=\"test_schema_w57_v3\", max connections=5"}
{"level":30,"time":1768711340241,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711340352,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711340352,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w58_v3\",public"}
{"level":30,"time":1768711340353,"env":"test","msg":"DB: Created pool for worker 58, schema=\"test_schema_w58_v3\", max connections=5"}
{"level":30,"time":1768711340379,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/api.expression-validation.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should validate a correct expression with valid variables
       [2m[90mâ†“[39m[22m should validate expression with string concatenation
       [2m[90mâ†“[39m[22m should reject expression with invalid syntax
       [2m[90mâ†“[39m[22m should reject without authentication
       [2m[90mâ†“[39m[22m should reject missing required fields
       [2m[90mâ†“[39m[22m should return available variables for a node
       [2m[90mâ†“[39m[22m should reject without authentication
       [2m[90mâ†“[39m[22m should reject non-existent workflow
       [2m[90mâ†“[39m[22m should return list of helper functions with metadata
       [2m[90mâ†“[39m[22m should reject without authentication
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768711342125,"env":"test","source":"express","msg":"ğŸ“¦ vite.ts module loaded successfully"}
{"level":30,"time":1768711342125,"env":"test","msg":"Vite module loaded, calling setupVite..."}
{"level":30,"time":1768711342126,"env":"test","source":"express","msg":"ğŸ“ setupVite: Starting Vite setup..."}
{"level":30,"time":1768711342126,"env":"test","source":"express","msg":"ğŸ“ setupVite: Resolving Vite config..."}
{"level":30,"time":1768711342131,"env":"test","source":"express","msg":"ğŸ“ setupVite: Vite config resolved"}
{"level":30,"time":1768711342131,"env":"test","source":"express","msg":"ğŸ“ setupVite: Server options prepared, creating Vite server..."}
{"level":30,"time":1768711342178,"env":"test","source":"express","msg":"ğŸ“ setupVite: Vite server created successfully"}
{"level":30,"time":1768711342178,"env":"test","source":"express","msg":"ğŸ“ setupVite: Mounting Vite middlewares..."}
{"level":30,"time":1768711342178,"env":"test","source":"express","msg":"ğŸ“ setupVite: Vite middlewares mounted"}
{"level":30,"time":1768711342178,"env":"test","source":"express","msg":"ğŸ“ setupVite: Vite setup complete!"}
{"level":30,"time":1768711342178,"env":"test","msg":"Vite setup complete"}
{"level":30,"time":1768711342181,"env":"test","source":"express","msg":"serving on port 5000"}
{"level":50,"time":1768711342282,"env":"test","module":"email-queue","error":{},"msg":"Error in email queue processor"}
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w59_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w59_v3 (Reused: true)

 [31mâ¯[39m tests/integration/lifecycle-hooks-execution.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should execute beforePage hook and capture console output
       [2m[90mâ†“[39m[22m should execute beforePage hook with mutation mode enabled
       [2m[90mâ†“[39m[22m should handle errors gracefully without breaking workflow
       [2m[90mâ†“[39m[22m should execute afterPage hook with user input data
       [2m[90mâ†“[39m[22m should execute Python afterPage hook
       [2m[90mâ†“[39m[22m should execute beforeFinalBlock hook before document generation
       [2m[90mâ†“[39m[22m should execute afterDocumentsGenerated hook for cleanup
       [2m[90mâ†“[39m[22m should timeout hook that exceeds timeoutMs limit
       [2m[90mâ†“[39m[22m should execute multiple hooks in correct order
       [2m[90mâ†“[39m[22m should list all hooks for a workflow
       [2m[90mâ†“[39m[22m should update a hook
       [2m[90mâ†“[39m[22m should delete a hook
       [2m[90mâ†“[39m[22m should test a hook with sample data
       [2m[90mâ†“[39m[22m should retrieve execution logs for a run
       [2m[90mâ†“[39m[22m should clear execution logs for a run
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mğŸ“Š Schema test_schema_w59_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711343279,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711343279,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w59_v3\",public"}
{"level":30,"time":1768711343280,"env":"test","msg":"DB: Created pool for worker 59, schema=\"test_schema_w59_v3\", max connections=5"}
{"level":30,"time":1768711343308,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w51_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w51_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w60_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w60_v3 (Reused: true)

[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39mğŸ“Š Schema test_schema_w51_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768711343820,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711343820,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w51_v3\",public"}
{"level":30,"time":1768711343820,"env":"test","msg":"DB: Created pool for worker 51, schema=\"test_schema_w51_v3\", max connections=5"}
{"level":30,"time":1768711343856,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mğŸ“Š Schema test_schema_w60_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711344464,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711344464,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w60_v3\",public"}
{"level":30,"time":1768711344464,"env":"test","msg":"DB: Created pool for worker 60, schema=\"test_schema_w60_v3\", max connections=5"}
{"level":30,"time":1768711344493,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768711626638,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711627367,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711627892,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711631816,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711633906,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711634395,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711634539,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711634648,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711636062,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711636904,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711637290,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api-docs.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711638958,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711639119,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711641958,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768711643253,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/integration/organizations-workflow.test.ts [2m([22m[2m23 tests[22m[2m | [22m[33m23 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m Step 1: Create organization
       [2m[90mâ†“[39m[22m Step 2: Invite member via email
       [2m[90mâ†“[39m[22m Step 3: Accept invite
       [2m[90mâ†“[39m[22m Step 4: Create workflow owned by user
       [2m[90mâ†“[39m[22m Step 5: Transfer workflow to organization
       [2m[90mâ†“[39m[22m Step 6: Org member (user2) can access workflow
       [2m[90mâ†“[39m[22m Step 7: Org member (user2) can update workflow
       [2m[90mâ†“[39m[22m Step 8: Org admin (user1) can still access workflow after transfer
       [2m[90mâ†“[39m[22m Step 9: Non-member (user3) CANNOT access org workflow
       [2m[90mâ†“[39m[22m Step 10: Non-member (user3) CANNOT update org workflow
       [2m[90mâ†“[39m[22m Step 11: Non-member (user3) CANNOT transfer org workflow
       [2m[90mâ†“[39m[22m Step 12: Org member can see workflow in list
       [2m[90mâ†“[39m[22m Step 13: Non-member CANNOT see workflow in list
       [2m[90mâ†“[39m[22m Step 14: Remove member from org
       [2m[90mâ†“[39m[22m Step 15: Removed member (user2) can no longer access workflow
       [2m[90mâ†“[39m[22m Step 16: Re-add member and verify access restored
       [2m[90mâ†“[39m[22m Cannot invite same email twice (pending invite exists)
       [2m[90mâ†“[39m[22m Cannot accept expired invite
       [2m[90mâ†“[39m[22m Cannot transfer workflow to org user is not a member of
       [2m[90mâ†“[39m[22m Member cannot promote themselves to admin
       [2m[90mâ†“[39m[22m Member cannot remove admin
       [2m[90mâ†“[39m[22m Only members can view organization details
       [2m[90mâ†“[39m[22m Only members can view organization members list
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w61_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

 [31mâ¯[39m tests/integration/analytics_preservation.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should preserve lifetime user count when a user is deleted
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w61_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mğŸ“Š Schema test_schema_w61_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [31mâ¯[39m tests/integration/datavault.autonumber.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should generate basic autonumber without prefix
     [2m[90mâ†“[39m[22m should generate autonumber with prefix
     [2m[90mâ†“[39m[22m should generate autonumber with yearly reset format
     [2m[90mâ†“[39m[22m should be atomic and prevent race conditions
     [2m[90mâ†“[39m[22m should prevent manual updates to autonumber values
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711928381,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711928382,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w61_v3\",public"}
{"level":30,"time":1768711928382,"env":"test","msg":"DB: Created pool for worker 61, schema=\"test_schema_w61_v3\", max connections=5"}
{"level":30,"time":1768711928414,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w62_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w62_v3 (Reused: true)

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mğŸ“Š Schema test_schema_w62_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w63_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w63_v3 (Reused: true)

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711930308,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711930308,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w62_v3\",public"}
{"level":30,"time":1768711930308,"env":"test","msg":"DB: Created pool for worker 62, schema=\"test_schema_w62_v3\", max connections=5"}
{"level":30,"time":1768711930335,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mğŸ“Š Schema test_schema_w63_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711931189,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711931189,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w63_v3\",public"}
{"level":30,"time":1768711931190,"env":"test","msg":"DB: Created pool for worker 63, schema=\"test_schema_w63_v3\", max connections=5"}
{"level":30,"time":1768711931228,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/api.ai.personalization.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should rewrite text based on user settings
       [2m[90mâ†“[39m[22m should generate help text
       [2m[90mâ†“[39m[22m should update user settings
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [31mâ¯[39m tests/unit/listPipeline.semantics.test.ts [2m([22m[2m70 tests[22m[2m | [22m[33m70 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should NOT coerce string "123" to equal number 123
       [2m[90mâ†“[39m[22m should NOT treat null == undefined (strict equality)
       [2m[90mâ†“[39m[22m should NOT coerce string "true" to boolean true
       [2m[90mâ†“[39m[22m should match exact values with strict equality
       [2m[90mâ†“[39m[22m should use strict equality when checking membership
       [2m[90mâ†“[39m[22m should match exact values in list
       [2m[90mâ†“[39m[22m should return false if compareValue is not an array
       [2m[90mâ†“[39m[22m should return true if compareValue is not an array
       [2m[90mâ†“[39m[22m should use strict equality
       [2m[90mâ†“[39m[22m should perform numeric comparison with proper types
       [2m[90mâ†“[39m[22m should coerce string numbers to numeric comparison
       [2m[90mâ†“[39m[22m should handle boundary conditions with gte/lte
       [2m[90mâ†“[39m[22m should catch null
       [2m[90mâ†“[39m[22m should catch undefined
       [2m[90mâ†“[39m[22m should catch empty string
       [2m[90mâ†“[39m[22m should NOT catch 0, false, [], or {}
       [2m[90mâ†“[39m[22m should exclude null, undefined, and empty string
       [2m[90mâ†“[39m[22m should include 0, false, [], and {}
       [2m[90mâ†“[39m[22m should return true for null (field exists with null value)
       [2m[90mâ†“[39m[22m should return false for undefined
       [2m[90mâ†“[39m[22m should return false for missing field
       [2m[90mâ†“[39m[22m should return undefined when accessing nested field on null
       [2m[90mâ†“[39m[22m should return undefined when accessing nested field on undefined
       [2m[90mâ†“[39m[22m should support dot notation for nested objects
       [2m[90mâ†“[39m[22m should be CASE-SENSITIVE
       [2m[90mâ†“[39m[22m should match with exact case
       [2m[90mâ†“[39m[22m should be CASE-SENSITIVE
       [2m[90mâ†“[39m[22m should be CASE-SENSITIVE
       [2m[90mâ†“[39m[22m should match case-insensitively
       [2m[90mâ†“[39m[22m should match with exact case
       [2m[90mâ†“[39m[22m should match uppercase vs lowercase
       [2m[90mâ†“[39m[22m should find substring case-insensitively
       [2m[90mâ†“[39m[22m should match partial strings with mixed case
       [2m[90mâ†“[39m[22m should exclude substring case-insensitively
       [2m[90mâ†“[39m[22m should return false if substring exists (any case)
       [2m[90mâ†“[39m[22m should match prefix case-insensitively
       [2m[90mâ†“[39m[22m should handle mixed case prefixes
       [2m[90mâ†“[39m[22m should match suffix case-insensitively
       [2m[90mâ†“[39m[22m should handle mixed case suffixes
       [2m[90mâ†“[39m[22m should maintain original order for equal values
       [2m[90mâ†“[39m[22m should sort by first key, then second key for ties
       [2m[90mâ†“[39m[22m should place nulls FIRST when sorting ascending
       [2m[90mâ†“[39m[22m should place nulls LAST when sorting descending
       [2m[90mâ†“[39m[22m should perform numeric comparison when values are numbers
       [2m[90mâ†“[39m[22m should perform lexicographic comparison when values are strings
       [2m[90mâ†“[39m[22m should return first N rows when limit is set
       [2m[90mâ†“[39m[22m should return EMPTY array when limit = 0
       [2m[90mâ†“[39m[22m should return all rows when limit is undefined
       [2m[90mâ†“[39m[22m should skip first N rows
       [2m[90mâ†“[39m[22m should return empty array when offset > total rows
       [2m[90mâ†“[39m[22m should skip N rows then take M rows (SQL-like pagination)
       [2m[90mâ†“[39m[22m should return partial result when limit exceeds remaining rows
       [2m[90mâ†“[39m[22m should return only selected columns
       [2m[90mâ†“[39m[22m should always preserve id field
       [2m[90mâ†“[39m[22m should silently ignore non-existent fields (SEMANTIC SURPRISE)
       [2m[90mâ†“[39m[22m should support nested field paths
       [2m[90mâ†“[39m[22m should keep first occurrence only
       [2m[90mâ†“[39m[22m should preserve order
       [2m[90mâ†“[39m[22m should keep ALL rows with null dedupe keys
       [2m[90mâ†“[39m[22m should keep ALL rows with undefined dedupe keys
       [2m[90mâ†“[39m[22m should still dedupe non-null values correctly
       [2m[90mâ†“[39m[22m should apply all transformations in correct order
       [2m[90mâ†“[39m[22m should apply pagination AFTER filtering
       [2m[90mâ†“[39m[22m should apply pagination AFTER sorting
       [2m[90mâ†“[39m[22m should apply dedupe AFTER select
     [2m[90mâ†“[39m[22m should resolve variable references from context
     [2m[90mâ†“[39m[22m should handle missing variables gracefully
     [2m[90mâ†“[39m[22m should require all conditions to be true with AND
     [2m[90mâ†“[39m[22m should return false if any condition fails with AND
     [2m[90mâ†“[39m[22m should return empty list for conflicting conditions
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [31mâ¯[39m tests/unit/shared/conditionEvaluator.test.ts [2m([22m[2m70 tests[22m[2m | [22m[33m70 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return true for null expression (always visible)
       [2m[90mâ†“[39m[22m should return true for undefined expression
       [2m[90mâ†“[39m[22m should evaluate simple condition
       [2m[90mâ†“[39m[22m should return true for empty conditions array
       [2m[90mâ†“[39m[22m should return detailed result with reason
       [2m[90mâ†“[39m[22m should count multiple evaluated conditions
       [2m[90mâ†“[39m[22m should return reason when conditions not satisfied
         [2m[90mâ†“[39m[22m should return true when all conditions are true
         [2m[90mâ†“[39m[22m should return false when any condition is false
         [2m[90mâ†“[39m[22m should return true when any condition is true
         [2m[90mâ†“[39m[22m should return false when all conditions are false
         [2m[90mâ†“[39m[22m should evaluate nested AND/OR groups
         [2m[90mâ†“[39m[22m should handle deeply nested groups
         [2m[90mâ†“[39m[22m should match equal strings (case-insensitive)
         [2m[90mâ†“[39m[22m should match equal numbers
         [2m[90mâ†“[39m[22m should match booleans
         [2m[90mâ†“[39m[22m should match boolean string representations
         [2m[90mâ†“[39m[22m should match arrays
         [2m[90mâ†“[39m[22m should match objects
         [2m[90mâ†“[39m[22m should handle null/undefined equality
         [2m[90mâ†“[39m[22m should coerce number strings
         [2m[90mâ†“[39m[22m should return true for different values
         [2m[90mâ†“[39m[22m should return false for equal values
         [2m[90mâ†“[39m[22m should find substring in string (case-insensitive)
         [2m[90mâ†“[39m[22m should return false when substring not found
         [2m[90mâ†“[39m[22m should return true when substring not found
         [2m[90mâ†“[39m[22m should match string prefix (case-insensitive)
         [2m[90mâ†“[39m[22m should match string suffix (case-insensitive)
         [2m[90mâ†“[39m[22m should compare numbers
         [2m[90mâ†“[39m[22m should parse string numbers
         [2m[90mâ†“[39m[22m should handle dates
         [2m[90mâ†“[39m[22m should convert booleans to numbers
         [2m[90mâ†“[39m[22m should compare numbers
         [2m[90mâ†“[39m[22m should return true for greater value
         [2m[90mâ†“[39m[22m should return true for equal value
         [2m[90mâ†“[39m[22m should return false for lesser value
         [2m[90mâ†“[39m[22m should compare numbers correctly
         [2m[90mâ†“[39m[22m should check if value is between min and max (inclusive)
         [2m[90mâ†“[39m[22m should return true for boolean true
         [2m[90mâ†“[39m[22m should return true for truthy strings
         [2m[90mâ†“[39m[22m should return false for falsy values
         [2m[90mâ†“[39m[22m should return true for boolean false
         [2m[90mâ†“[39m[22m should return true for null/undefined
         [2m[90mâ†“[39m[22m should return true for empty string
         [2m[90mâ†“[39m[22m should return true for empty array
         [2m[90mâ†“[39m[22m should return true for empty object
         [2m[90mâ†“[39m[22m should return false for non-empty values
         [2m[90mâ†“[39m[22m should return true for non-empty values
         [2m[90mâ†“[39m[22m should return false for empty values
         [2m[90mâ†“[39m[22m should check if array includes value
         [2m[90mâ†“[39m[22m should handle non-array values
         [2m[90mâ†“[39m[22m should return true when array does not include value
         [2m[90mâ†“[39m[22m should return true when array includes all required values
         [2m[90mâ†“[39m[22m should return true when array includes any of the values
         [2m[90mâ†“[39m[22m should default to true and log warning
       [2m[90mâ†“[39m[22m should resolve alias to step ID when resolver is provided
       [2m[90mâ†“[39m[22m should fall back to original key if not resolved
       [2m[90mâ†“[39m[22m should resolve variable references in value
       [2m[90mâ†“[39m[22m should skip conditions with no variable selected
       [2m[90mâ†“[39m[22m should evaluate visibility for all sections and steps
       [2m[90mâ†“[39m[22m should return 'Always visible' for null expression
       [2m[90mâ†“[39m[22m should describe simple condition
       [2m[90mâ†“[39m[22m should describe AND conditions
       [2m[90mâ†“[39m[22m should describe OR conditions
       [2m[90mâ†“[39m[22m should use variable labels when provided
       [2m[90mâ†“[39m[22m should describe between operator
       [2m[90mâ†“[39m[22m should describe operators without values
       [2m[90mâ†“[39m[22m should describe variable references
       [2m[90mâ†“[39m[22m should handle nested groups with parentheses
       [2m[90mâ†“[39m[22m should format array values
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w64_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

 [31mâ¯[39m tests/ui/datavault/EditableCell.test.tsx [2m([22m[2m29 tests[22m[2m | [22m[33m29 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m renders value in display mode initially
       [2m[90mâ†“[39m[22m shows double-click hint on hover
       [2m[90mâ†“[39m[22m does not show hint for read-only cells
       [2m[90mâ†“[39m[22m includes proper ARIA label with column name and value
       [2m[90mâ†“[39m[22m indicates read-only status in ARIA label
       [2m[90mâ†“[39m[22m is focusable when editable
       [2m[90mâ†“[39m[22m is not focusable when read-only
       [2m[90mâ†“[39m[22m enters edit mode on double-click
       [2m[90mâ†“[39m[22m enters edit mode on Enter key press
       [2m[90mâ†“[39m[22m enters edit mode on Space key press
       [2m[90mâ†“[39m[22m does not enter edit mode when read-only
       [2m[90mâ†“[39m[22m focuses and selects input text on edit mode entry
       [2m[90mâ†“[39m[22m saves on blur
       [2m[90mâ†“[39m[22m saves on Enter key press
       [2m[90mâ†“[39m[22m does not save if value unchanged
       [2m[90mâ†“[39m[22m cancels edit on Escape key press
       [2m[90mâ†“[39m[22m reverts value on save error
       [2m[90mâ†“[39m[22m displays error indicator on save failure
       [2m[90mâ†“[39m[22m renders checkbox for boolean type
       [2m[90mâ†“[39m[22m saves immediately on checkbox change
       [2m[90mâ†“[39m[22m disables checkbox when read-only
       [2m[90mâ†“[39m[22m shows loading spinner when saving checkbox
       [2m[90mâ†“[39m[22m renders number input for number type
       [2m[90mâ†“[39m[22m renders email input for email type
       [2m[90mâ†“[39m[22m renders url input for url type
       [2m[90mâ†“[39m[22m includes placeholder text in edit mode
       [2m[90mâ†“[39m[22m formats date values for display
       [2m[90mâ†“[39m[22m formats boolean values as Yes/No
       [2m[90mâ†“[39m[22m handles null values gracefully
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w64_v3 (Reused: true)

 [31mâ¯[39m tests/unit/shared/workflowLogic.test.ts [2m([22m[2m65 tests[22m[2m | [22m[33m65 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
         [2m[90mâ†“[39m[22m should show section when condition is met
         [2m[90mâ†“[39m[22m should hide section when hide action is triggered
         [2m[90mâ†“[39m[22m should set skip target when skip_to action is triggered
         [2m[90mâ†“[39m[22m should ignore rule with missing targetSectionId
         [2m[90mâ†“[39m[22m should show step when condition is met
         [2m[90mâ†“[39m[22m should hide step and remove from required when hide action is triggered
         [2m[90mâ†“[39m[22m should require step when require action is triggered
         [2m[90mâ†“[39m[22m should make step optional when make_optional action is triggered
         [2m[90mâ†“[39m[22m should ignore rule with missing targetStepId
           [2m[90mâ†“[39m[22m should handle string equality (case-insensitive)
           [2m[90mâ†“[39m[22m should handle boolean equality
           [2m[90mâ†“[39m[22m should handle array equality (order-independent)
           [2m[90mâ†“[39m[22m should handle numeric equality
           [2m[90mâ†“[39m[22m should return true when values are different
           [2m[90mâ†“[39m[22m should match substring in string (case-insensitive)
           [2m[90mâ†“[39m[22m should match item in array
           [2m[90mâ†“[39m[22m should return false for non-string, non-array values
           [2m[90mâ†“[39m[22m should return true when substring is not found
           [2m[90mâ†“[39m[22m should compare numeric values
           [2m[90mâ†“[39m[22m should parse string numbers
           [2m[90mâ†“[39m[22m should return false for invalid numbers
           [2m[90mâ†“[39m[22m should compare numeric values
           [2m[90mâ†“[39m[22m should check if value is between min and max (inclusive)
           [2m[90mâ†“[39m[22m should include boundary values
           [2m[90mâ†“[39m[22m should return false if value is outside range
           [2m[90mâ†“[39m[22m should return false for invalid range format
           [2m[90mâ†“[39m[22m should return false for non-numeric value
           [2m[90mâ†“[39m[22m should return true for null
           [2m[90mâ†“[39m[22m should return true for undefined
           [2m[90mâ†“[39m[22m should return true for empty string
           [2m[90mâ†“[39m[22m should return true for empty array
           [2m[90mâ†“[39m[22m should return true for empty object
           [2m[90mâ†“[39m[22m should return false for non-empty values
           [2m[90mâ†“[39m[22m should return true for non-empty string
           [2m[90mâ†“[39m[22m should return false for null
           [2m[90mâ†“[39m[22m should return false and log warning for unknown operator
         [2m[90mâ†“[39m[22m should handle empty rules array
         [2m[90mâ†“[39m[22m should handle empty data
         [2m[90mâ†“[39m[22m should handle missing condition value (undefined)
         [2m[90mâ†“[39m[22m should process multiple rules in order
       [2m[90mâ†“[39m[22m should return first visible section when currentSectionId is null
       [2m[90mâ†“[39m[22m should return next visible section
       [2m[90mâ†“[39m[22m should skip hidden sections
       [2m[90mâ†“[39m[22m should return null when no more visible sections
       [2m[90mâ†“[39m[22m should return null for non-existent current section
       [2m[90mâ†“[39m[22m should handle empty visible sections
       [2m[90mâ†“[39m[22m should handle sections in random order
       [2m[90mâ†“[39m[22m should use skipToSectionId when provided and visible
       [2m[90mâ†“[39m[22m should find next visible section when skip target is not visible
       [2m[90mâ†“[39m[22m should use normal next section when no skip target
       [2m[90mâ†“[39m[22m should return null when skip target has no visible sections after
       [2m[90mâ†“[39m[22m should return valid when all required steps have values
       [2m[90mâ†“[39m[22m should return invalid when required steps are missing
       [2m[90mâ†“[39m[22m should consider empty strings as missing
       [2m[90mâ†“[39m[22m should consider empty arrays as missing
       [2m[90mâ†“[39m[22m should consider null as missing
       [2m[90mâ†“[39m[22m should handle empty required steps set
       [2m[90mâ†“[39m[22m should not consider 0 or false as empty
       [2m[90mâ†“[39m[22m should return initial required steps when no rules apply
       [2m[90mâ†“[39m[22m should add steps when require rule is triggered
       [2m[90mâ†“[39m[22m should remove steps when make_optional rule is triggered
       [2m[90mâ†“[39m[22m should ignore rules that don't target requirements
       [2m[90mâ†“[39m[22m should ignore section-level rules
       [2m[90mâ†“[39m[22m should not modify original set
       [2m[90mâ†“[39m[22m should handle multiple rules modifying same step
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w65_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w65_v3 (Reused: true)

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mğŸ“Š Schema test_schema_w64_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mğŸ“Š Schema test_schema_w65_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w66_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w66_v3 (Reused: true)

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w67_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w68_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w67_v3 (Reused: true)

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w68_v3 (Reused: true)

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711935527,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711935528,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w64_v3\",public"}
{"level":30,"time":1768711935528,"env":"test","msg":"DB: Created pool for worker 64, schema=\"test_schema_w64_v3\", max connections=5"}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mğŸ“Š Schema test_schema_w66_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768711935572,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711935572,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w65_v3\",public"}
{"level":30,"time":1768711935572,"env":"test","msg":"DB: Created pool for worker 65, schema=\"test_schema_w65_v3\", max connections=5"}
{"level":30,"time":1768711935570,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768711935604,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mğŸ“Š Schema test_schema_w67_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mğŸ“Š Schema test_schema_w68_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711936036,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711936036,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w66_v3\",public"}
{"level":30,"time":1768711936037,"env":"test","msg":"DB: Created pool for worker 66, schema=\"test_schema_w66_v3\", max connections=5"}
 [31mâ¯[39m tests/integration/js_helpers.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 600006[2mms[22m[39m
     [2m[90mâ†“[39m[22m should execute a JS block that uses helper functions
{"level":30,"time":1768711936065,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711936221,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711936221,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w67_v3\",public"}
{"level":30,"time":1768711936222,"env":"test","msg":"DB: Created pool for worker 67, schema=\"test_schema_w67_v3\", max connections=5"}
{"level":30,"time":1768711936253,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711936334,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711936334,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w68_v3\",public"}
{"level":30,"time":1768711936335,"env":"test","msg":"DB: Created pool for worker 68, schema=\"test_schema_w68_v3\", max connections=5"}
{"level":30,"time":1768711936369,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/ui/runs.components.test.tsx [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should render runs table with correct columns
       [2m[90mâ†“[39m[22m should render run data correctly
       [2m[90mâ†“[39m[22m should show success badge for successful runs
       [2m[90mâ†“[39m[22m should show error badge for failed runs
       [2m[90mâ†“[39m[22m should format duration correctly
       [2m[90mâ†“[39m[22m should show download options for successful runs
       [2m[90mâ†“[39m[22m should render all filter controls
       [2m[90mâ†“[39m[22m should call onChange when status filter changes
       [2m[90mâ†“[39m[22m should call onChange when search is submitted
       [2m[90mâ†“[39m[22m should show clear filters button when filters are active
       [2m[90mâ†“[39m[22m should clear all filters when clear button is clicked
       [2m[90mâ†“[39m[22m should render all trace entries
       [2m[90mâ†“[39m[22m should show executed badge for executed nodes
       [2m[90mâ†“[39m[22m should show skipped badge for skipped nodes
       [2m[90mâ†“[39m[22m should display conditions and their results
       [2m[90mâ†“[39m[22m should display error messages
       [2m[90mâ†“[39m[22m should toggle show skipped nodes
       [2m[90mâ†“[39m[22m should expand outputs delta when clicked
       [2m[90mâ†“[39m[22m should copy trace as JSON
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [31mâ¯[39m tests/integration/api-docs.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 600005[2mms[22m[39m
     [2m[90mâ†“[39m[22m should serve Swagger UI at /api-docs/
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w70_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w70_v3 (Reused: true)

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mğŸ“Š Schema test_schema_w70_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w69_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w69_v3 (Reused: true)

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711938555,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711938556,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w70_v3\",public"}
{"level":30,"time":1768711938556,"env":"test","msg":"DB: Created pool for worker 70, schema=\"test_schema_w70_v3\", max connections=5"}
{"level":30,"time":1768711938592,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mğŸ“Š Schema test_schema_w69_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

 [31mâ¯[39m tests/unit/workflows/validation.test.ts [2m([22m[2m66 tests[22m[2m | [22m[33m66 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
         [2m[90mâ†“[39m[22m should return error for empty required field
         [2m[90mâ†“[39m[22m should return error for null required field
         [2m[90mâ†“[39m[22m should return error for undefined required field
         [2m[90mâ†“[39m[22m should return error for whitespace-only required field
         [2m[90mâ†“[39m[22m should return error for empty array required field
         [2m[90mâ†“[39m[22m should return error for empty object required field
         [2m[90mâ†“[39m[22m should not return error for 0 value
         [2m[90mâ†“[39m[22m should not return error for false value
         [2m[90mâ†“[39m[22m should stop validation after required check fails
         [2m[90mâ†“[39m[22m should validate minimum length
         [2m[90mâ†“[39m[22m should validate maximum length
         [2m[90mâ†“[39m[22m should pass when length is within bounds
         [2m[90mâ†“[39m[22m should accept exact minimum length
         [2m[90mâ†“[39m[22m should accept exact maximum length
         [2m[90mâ†“[39m[22m should skip length validation for non-string values
         [2m[90mâ†“[39m[22m should skip validation for empty non-required fields
         [2m[90mâ†“[39m[22m should validate minimum value
         [2m[90mâ†“[39m[22m should validate maximum value
         [2m[90mâ†“[39m[22m should pass when value is within range
         [2m[90mâ†“[39m[22m should accept exact minimum value
         [2m[90mâ†“[39m[22m should accept exact maximum value
         [2m[90mâ†“[39m[22m should parse string numbers
         [2m[90mâ†“[39m[22m should handle NaN gracefully
         [2m[90mâ†“[39m[22m should validate correct email format
         [2m[90mâ†“[39m[22m should reject email without @
         [2m[90mâ†“[39m[22m should reject email without domain
         [2m[90mâ†“[39m[22m should reject email without TLD
         [2m[90mâ†“[39m[22m should accept email with subdomains
         [2m[90mâ†“[39m[22m should accept email with plus addressing
         [2m[90mâ†“[39m[22m should accept email with numbers
         [2m[90mâ†“[39m[22m should skip email validation for non-string values
         [2m[90mâ†“[39m[22m should validate with valid pattern
         [2m[90mâ†“[39m[22m should reject invalid pattern
         [2m[90mâ†“[39m[22m should handle complex patterns
         [2m[90mâ†“[39m[22m should skip validation for invalid regex pattern
         [2m[90mâ†“[39m[22m should skip pattern validation for non-string values
         [2m[90mâ†“[39m[22m should run custom validator
         [2m[90mâ†“[39m[22m should handle custom validator returning null
         [2m[90mâ†“[39m[22m should add custom error to other errors
         [2m[90mâ†“[39m[22m should return multiple errors when multiple validations fail
         [2m[90mâ†“[39m[22m should pass all validations when value is valid
         [2m[90mâ†“[39m[22m should handle empty config
         [2m[90mâ†“[39m[22m should handle null value with non-required field
         [2m[90mâ†“[39m[22m should handle undefined value with non-required field
       [2m[90mâ†“[39m[22m should validate all visible steps
       [2m[90mâ†“[39m[22m should skip hidden steps
       [2m[90mâ†“[39m[22m should skip virtual steps
       [2m[90mâ†“[39m[22m should return valid result when all steps pass
       [2m[90mâ†“[39m[22m should count total errors correctly
       [2m[90mâ†“[39m[22m should handle empty steps array
       [2m[90mâ†“[39m[22m should handle missing values for non-required steps
       [2m[90mâ†“[39m[22m should format errors into string array
       [2m[90mâ†“[39m[22m should return empty array for no errors
       [2m[90mâ†“[39m[22m should handle errors with multiple messages
       [2m[90mâ†“[39m[22m should return first error for field
       [2m[90mâ†“[39m[22m should return null when field has no errors
       [2m[90mâ†“[39m[22m should return null for non-existent field
       [2m[90mâ†“[39m[22m should return null when field has empty errors array
       [2m[90mâ†“[39m[22m should handle very long strings
       [2m[90mâ†“[39m[22m should handle special characters in strings
       [2m[90mâ†“[39m[22m should handle unicode characters
       [2m[90mâ†“[39m[22m should handle negative numbers
       [2m[90mâ†“[39m[22m should handle decimal numbers
       [2m[90mâ†“[39m[22m should handle very large numbers
       [2m[90mâ†“[39m[22m should handle objects as values
       [2m[90mâ†“[39m[22m should handle arrays as values
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711939119,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711939119,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w69_v3\",public"}
{"level":30,"time":1768711939120,"env":"test","msg":"DB: Created pool for worker 69, schema=\"test_schema_w69_v3\", max connections=5"}
 [31mâ¯[39m tests/unit/HelperLibrary.test.ts [2m([22m[2m60 tests[22m[2m | [22m[33m60 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return current date
       [2m[90mâ†“[39m[22m should add days to date
       [2m[90mâ†“[39m[22m should subtract months from date
       [2m[90mâ†“[39m[22m should format dates
       [2m[90mâ†“[39m[22m should parse date strings
       [2m[90mâ†“[39m[22m should calculate date difference
       [2m[90mâ†“[39m[22m should handle invalid dates gracefully
       [2m[90mâ†“[39m[22m should convert to uppercase
       [2m[90mâ†“[39m[22m should convert to lowercase
       [2m[90mâ†“[39m[22m should trim whitespace
       [2m[90mâ†“[39m[22m should replace text
       [2m[90mâ†“[39m[22m should replace all occurrences
       [2m[90mâ†“[39m[22m should split strings
       [2m[90mâ†“[39m[22m should join arrays
       [2m[90mâ†“[39m[22m should create slugs
       [2m[90mâ†“[39m[22m should handle empty strings
       [2m[90mâ†“[39m[22m should round numbers
       [2m[90mâ†“[39m[22m should ceil numbers
       [2m[90mâ†“[39m[22m should floor numbers
       [2m[90mâ†“[39m[22m should get absolute value
       [2m[90mâ†“[39m[22m should clamp numbers
       [2m[90mâ†“[39m[22m should format currency
       [2m[90mâ†“[39m[22m should format percentages
       [2m[90mâ†“[39m[22m should get unique values
       [2m[90mâ†“[39m[22m should flatten arrays
       [2m[90mâ†“[39m[22m should chunk arrays
       [2m[90mâ†“[39m[22m should sort by property
       [2m[90mâ†“[39m[22m should filter arrays
       [2m[90mâ†“[39m[22m should map arrays
       [2m[90mâ†“[39m[22m should handle empty arrays
       [2m[90mâ†“[39m[22m should get object keys
       [2m[90mâ†“[39m[22m should get object values
       [2m[90mâ†“[39m[22m should pick properties
       [2m[90mâ†“[39m[22m should omit properties
       [2m[90mâ†“[39m[22m should merge objects
       [2m[90mâ†“[39m[22m should deep merge objects
       [2m[90mâ†“[39m[22m should handle empty objects
       [2m[90mâ†“[39m[22m should generate random numbers
       [2m[90mâ†“[39m[22m should generate random integers
       [2m[90mâ†“[39m[22m should sum arrays
       [2m[90mâ†“[39m[22m should calculate average
       [2m[90mâ†“[39m[22m should find min
       [2m[90mâ†“[39m[22m should find max
       [2m[90mâ†“[39m[22m should capture console.log calls
       [2m[90mâ†“[39m[22m should capture console.warn calls
       [2m[90mâ†“[39m[22m should capture console.error calls
       [2m[90mâ†“[39m[22m should capture mixed console calls in order
       [2m[90mâ†“[39m[22m should handle objects and arrays
       [2m[90mâ†“[39m[22m should create independent console instances
       [2m[90mâ†“[39m[22m should export all helper categories
       [2m[90mâ†“[39m[22m should have all expected date methods
       [2m[90mâ†“[39m[22m should have all expected string methods
       [2m[90mâ†“[39m[22m should have all expected number methods
       [2m[90mâ†“[39m[22m should have all expected array methods
       [2m[90mâ†“[39m[22m should have all expected object methods
       [2m[90mâ†“[39m[22m should have all expected math methods
       [2m[90mâ†“[39m[22m should handle null/undefined inputs gracefully
       [2m[90mâ†“[39m[22m should handle non-numeric inputs to number helpers
       [2m[90mâ†“[39m[22m should handle invalid date formats
       [2m[90mâ†“[39m[22m should handle array operations on non-arrays
{"level":30,"time":1768711939163,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w71_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w71_v3 (Reused: true)

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w72_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w72_v3 (Reused: true)

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w73_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w73_v3 (Reused: true)

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mğŸ“Š Schema test_schema_w71_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mğŸ“Š Schema test_schema_w72_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mğŸ“Š Schema test_schema_w73_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711940572,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711940573,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w71_v3\",public"}
{"level":30,"time":1768711940573,"env":"test","msg":"DB: Created pool for worker 71, schema=\"test_schema_w71_v3\", max connections=5"}
{"level":30,"time":1768711940610,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711940706,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711940707,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w72_v3\",public"}
{"level":30,"time":1768711940707,"env":"test","msg":"DB: Created pool for worker 72, schema=\"test_schema_w72_v3\", max connections=5"}
{"level":30,"time":1768711940739,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711940825,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711940826,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w73_v3\",public"}
{"level":30,"time":1768711940826,"env":"test","msg":"DB: Created pool for worker 73, schema=\"test_schema_w73_v3\", max connections=5"}
{"level":30,"time":1768711940860,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/workflows/conditionTruthTable.test.ts [2m([22m[2m51 tests[22m[2m | [22m[33m51 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should match equal strings (case-insensitive)
       [2m[90mâ†“[39m[22m should match equal numbers
       [2m[90mâ†“[39m[22m should match equal booleans
       [2m[90mâ†“[39m[22m should handle null values
       [2m[90mâ†“[39m[22m should match non-equal values
       [2m[90mâ†“[39m[22m should evaluate gt (greater than)
       [2m[90mâ†“[39m[22m should evaluate gte (greater than or equal)
       [2m[90mâ†“[39m[22m should evaluate lt (less than)
       [2m[90mâ†“[39m[22m should evaluate lte (less than or equal)
       [2m[90mâ†“[39m[22m should evaluate in (value in array)
       [2m[90mâ†“[39m[22m should evaluate notIn
       [2m[90mâ†“[39m[22m should evaluate contains for arrays
       [2m[90mâ†“[39m[22m should evaluate contains for strings
       [2m[90mâ†“[39m[22m should evaluate notContains
       [2m[90mâ†“[39m[22m should evaluate startsWith
       [2m[90mâ†“[39m[22m should evaluate endsWith
       [2m[90mâ†“[39m[22m should evaluate matches (regex)
       [2m[90mâ†“[39m[22m should evaluate isEmpty for null/undefined
       [2m[90mâ†“[39m[22m should evaluate isEmpty for empty strings
       [2m[90mâ†“[39m[22m should evaluate isEmpty for empty arrays
       [2m[90mâ†“[39m[22m should evaluate notEmpty
       [2m[90mâ†“[39m[22m should return true when all sub-conditions are true
       [2m[90mâ†“[39m[22m should handle empty AND array as true
       [2m[90mâ†“[39m[22m should support nested AND conditions
       [2m[90mâ†“[39m[22m should return true when any sub-condition is true
       [2m[90mâ†“[39m[22m should handle empty OR array as false
       [2m[90mâ†“[39m[22m should support nested OR conditions
       [2m[90mâ†“[39m[22m should negate the sub-condition
       [2m[90mâ†“[39m[22m should support double negation
       [2m[90mâ†“[39m[22m should negate composite conditions
       [2m[90mâ†“[39m[22m should handle deeply nested AND/OR/NOT combinations
     [2m[90mâ†“[39m[22m should resolve simple variable paths
     [2m[90mâ†“[39m[22m should resolve dot notation paths
     [2m[90mâ†“[39m[22m should resolve array indexing
     [2m[90mâ†“[39m[22m should resolve nested array indexing with dot notation
     [2m[90mâ†“[39m[22m should fall back to record data if variable not found
     [2m[90mâ†“[39m[22m should prefer variable over record if both exist
     [2m[90mâ†“[39m[22m should handle missing variables gracefully
     [2m[90mâ†“[39m[22m should validate correct comparison condition
     [2m[90mâ†“[39m[22m should reject missing operator
     [2m[90mâ†“[39m[22m should reject invalid operand type
     [2m[90mâ†“[39m[22m should validate AND conditions
     [2m[90mâ†“[39m[22m should reject invalid AND structure
     [2m[90mâ†“[39m[22m should validate nested conditions
     [2m[90mâ†“[39m[22m should propagate nested validation errors
     [2m[90mâ†“[39m[22m should handle type coercion in comparisons
     [2m[90mâ†“[39m[22m should handle case-insensitive string comparisons
     [2m[90mâ†“[39m[22m should handle whitespace trimming
     [2m[90mâ†“[39m[22m should handle invalid regex gracefully
     [2m[90mâ†“[39m[22m should handle comparison between two variables
     [2m[90mâ†“[39m[22m should handle numeric string comparisons
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w74_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w74_v3 (Reused: true)

 [31mâ¯[39m tests/integration/auth.routes.test.ts [2m([22m[2m41 tests[22m[2m | [22m[33m41 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should register a new user successfully
       [2m[90mâ†“[39m[22m should return 400 for invalid email format
       [2m[90mâ†“[39m[22m should return 400 for weak password
       [2m[90mâ†“[39m[22m should return 409 for duplicate email
       [2m[90mâ†“[39m[22m should hash password before storing
       [2m[90mâ†“[39m[22m should send email verification token
       [2m[90mâ†“[39m[22m should login with valid credentials
       [2m[90mâ†“[39m[22m should return 401 for invalid password
       [2m[90mâ†“[39m[22m should return 404 for non-existent user
       [2m[90mâ†“[39m[22m should return 403 for unverified email
       [2m[90mâ†“[39m[22m should record successful login attempt
       [2m[90mâ†“[39m[22m should record failed login attempt
       [2m[90mâ†“[39m[22m should return requiresMfa=true for MFA-enabled users
       [2m[90mâ†“[39m[22m should logout and revoke refresh token
       [2m[90mâ†“[39m[22m should return 401 for unauthenticated request
       [2m[90mâ†“[39m[22m should verify email with valid token
       [2m[90mâ†“[39m[22m should return 400 for invalid token
       [2m[90mâ†“[39m[22m should return 400 for expired token
       [2m[90mâ†“[39m[22m should delete verification token after successful verification
       [2m[90mâ†“[39m[22m should resend verification email
       [2m[90mâ†“[39m[22m should rate limit resend requests
       [2m[90mâ†“[39m[22m should return 404 for non-existent email
       [2m[90mâ†“[39m[22m should send password reset email
       [2m[90mâ†“[39m[22m should not reveal if email exists (security)
       [2m[90mâ†“[39m[22m should invalidate old password reset tokens
       [2m[90mâ†“[39m[22m should reset password with valid token
       [2m[90mâ†“[39m[22m should return 400 for invalid token
       [2m[90mâ†“[39m[22m should return 400 for weak new password
       [2m[90mâ†“[39m[22m should consume reset token after use
       [2m[90mâ†“[39m[22m should refresh access token with valid refresh token
       [2m[90mâ†“[39m[22m should rotate refresh token after use
       [2m[90mâ†“[39m[22m should detect token reuse and revoke all user tokens
       [2m[90mâ†“[39m[22m should return 401 for expired refresh token
       [2m[90mâ†“[39m[22m should lock account after 5 failed login attempts
       [2m[90mâ†“[39m[22m should unlock account after 15 minutes
       [2m[90mâ†“[39m[22m should allow admin to unlock account
       [2m[90mâ†“[39m[22m should reset attempt count after successful login
       [2m[90mâ†“[39m[22m should return current user for valid token
       [2m[90mâ†“[39m[22m should return 401 for missing token
       [2m[90mâ†“[39m[22m should return 401 for invalid token
       [2m[90mâ†“[39m[22m should return 401 for expired token
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mğŸ“Š Schema test_schema_w74_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711944016,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711944016,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w74_v3\",public"}
{"level":30,"time":1768711944016,"env":"test","msg":"DB: Created pool for worker 74, schema=\"test_schema_w74_v3\", max connections=5"}
{"level":30,"time":1768711944047,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w75_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w75_v3 (Reused: true)

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mğŸ“Š Schema test_schema_w75_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768711946170,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768711946171,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w75_v3\",public"}
{"level":30,"time":1768711946171,"env":"test","msg":"DB: Created pool for worker 75, schema=\"test_schema_w75_v3\", max connections=5"}
{"level":30,"time":1768711946199,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768712226966,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712229005,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712229843,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712234115,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712234333,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712234763,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712234981,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712235028,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712237284,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712237774,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712239236,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712239340,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712239481,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712242727,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712244900,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/services/docxHelpers.test.ts [2m([22m[2m39 tests[22m[2m | [22m[33m39 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
         [2m[90mâ†“[39m[22m should capitalize first letter
         [2m[90mâ†“[39m[22m should handle null/undefined
         [2m[90mâ†“[39m[22m should truncate long strings
         [2m[90mâ†“[39m[22m should allow custom suffix
         [2m[90mâ†“[39m[22m should replace all occurrences
         [2m[90mâ†“[39m[22m should handle null/undefined
         [2m[90mâ†“[39m[22m should join array elements
         [2m[90mâ†“[39m[22m should filter null values
         [2m[90mâ†“[39m[22m should handle empty/null arrays
         [2m[90mâ†“[39m[22m should return array length
         [2m[90mâ†“[39m[22m should return 0 for null/undefined
         [2m[90mâ†“[39m[22m should return first element
         [2m[90mâ†“[39m[22m should return null for empty/null
         [2m[90mâ†“[39m[22m should return last element
         [2m[90mâ†“[39m[22m should return null for empty/null
         [2m[90mâ†“[39m[22m should detect empty values
         [2m[90mâ†“[39m[22m should detect non-empty values
         [2m[90mâ†“[39m[22m should be inverse of isEmpty
         [2m[90mâ†“[39m[22m should return value if not empty
         [2m[90mâ†“[39m[22m should return default if empty
         [2m[90mâ†“[39m[22m should format dates with custom format
         [2m[90mâ†“[39m[22m should handle ISO strings
         [2m[90mâ†“[39m[22m should return empty for invalid dates
         [2m[90mâ†“[39m[22m should format USD by default
         [2m[90mâ†“[39m[22m should format other currencies
         [2m[90mâ†“[39m[22m should handle no symbol option
         [2m[90mâ†“[39m[22m should handle null/undefined
         [2m[90mâ†“[39m[22m should format with decimals
         [2m[90mâ†“[39m[22m should handle no thousands separator
         [2m[90mâ†“[39m[22m should handle null/undefined
         [2m[90mâ†“[39m[22m should add numbers
         [2m[90mâ†“[39m[22m should subtract numbers
         [2m[90mâ†“[39m[22m should multiply numbers
         [2m[90mâ†“[39m[22m should divide numbers
         [2m[90mâ†“[39m[22m should handle division by zero
         [2m[90mâ†“[39m[22m should pluralize based on count
         [2m[90mâ†“[39m[22m should use custom plural form
       [2m[90mâ†“[39m[22m should export all helpers
       [2m[90mâ†“[39m[22m should include helpers from formatters
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [31mâ¯[39m tests/ui/expression-editor.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should initialize with null validation result
       [2m[90mâ†“[39m[22m should validate expression after debounce
       [2m[90mâ†“[39m[22m should return validation errors for invalid expression
       [2m[90mâ†“[39m[22m should debounce validation calls
       [2m[90mâ†“[39m[22m should not validate when workflowId or nodeId is missing
       [2m[90mâ†“[39m[22m should validate helper functions in expressions
       [2m[90mâ†“[39m[22m should validate complex expressions with multiple helpers
       [2m[90mâ†“[39m[22m should handle syntax errors
       [2m[90mâ†“[39m[22m should handle empty expressions
       [2m[90mâ†“[39m[22m should update validation when expression changes
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w76_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w76_v3 (Reused: true)

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mğŸ“Š Schema test_schema_w76_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w77_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w77_v3 (Reused: true)

 [31mâ¯[39m tests/unit/collab.client.test.tsx [2m([22m[2m17 tests[22m[2m | [22m[33m17 skipped[39m[2m)[22m[33m 600011[2mms[22m[39m
     [2m[90mâ†“[39m[22m should initialize with default state
     [2m[90mâ†“[39m[22m should connect to WebSocket server
     [2m[90mâ†“[39m[22m should update nodes in Yjs document
     [2m[90mâ†“[39m[22m should update edges in Yjs document
     [2m[90mâ†“[39m[22m should disconnect cleanly
     [2m[90mâ†“[39m[22m should initialize with empty comments
     [2m[90mâ†“[39m[22m should add a comment
     [2m[90mâ†“[39m[22m should delete a comment
     [2m[90mâ†“[39m[22m should get comment count for a node
     [2m[90mâ†“[39m[22m should render nothing when no users
     [2m[90mâ†“[39m[22m should render user avatars
     [2m[90mâ†“[39m[22m should show hidden count when exceeds max
     [2m[90mâ†“[39m[22m should render comments
     [2m[90mâ†“[39m[22m should show empty state when no comments
     [2m[90mâ†“[39m[22m should add a comment
     [2m[90mâ†“[39m[22m should allow comment owner to delete their comment
     [2m[90mâ†“[39m[22m should not show delete button for other users comments
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712530013,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712530014,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w76_v3\",public"}
{"level":30,"time":1768712530014,"env":"test","msg":"DB: Created pool for worker 76, schema=\"test_schema_w76_v3\", max connections=5"}
{"level":30,"time":1768712530052,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mğŸ“Š Schema test_schema_w77_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712530559,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712530559,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w77_v3\",public"}
{"level":30,"time":1768712530560,"env":"test","msg":"DB: Created pool for worker 77, schema=\"test_schema_w77_v3\", max connections=5"}
{"level":30,"time":1768712530587,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w78_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w78_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mğŸ“Š Schema test_schema_w78_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712531495,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712531496,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w78_v3\",public"}
{"level":30,"time":1768712531496,"env":"test","msg":"DB: Created pool for worker 78, schema=\"test_schema_w78_v3\", max connections=5"}
{"level":30,"time":1768712531521,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/components/datavault/TableGridView.test.tsx [2m([22m[2m9 tests[22m[2m | [22m[33m9 skipped[39m[2m)[22m[33m 600012[2mms[22m[39m
     [2m[90mâ†“[39m[22m loads table schema and rows
     [2m[90mâ†“[39m[22m renders correct column headers
     [2m[90mâ†“[39m[22m displays empty state when no rows
     [2m[90mâ†“[39m[22m enters edit mode on double click
     [2m[90mâ†“[39m[22m updates cell value on blur
     [2m[90mâ†“[39m[22m renders Add Row button
     [2m[90mâ†“[39m[22m renders delete button for each row
     [2m[90mâ†“[39m[22m handles API errors gracefully
     [2m[90mâ†“[39m[22m sorts columns by orderIndex
 [31mâ¯[39m tests/unit/middleware/rbac.test.ts [2m([22m[2m44 tests[22m[2m | [22m[33m44 skipped[39m[2m)[22m[33m 600011[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return false for null role
       [2m[90mâ†“[39m[22m should return false for undefined role
       [2m[90mâ†“[39m[22m should allow owner to access all permissions (wildcard)
       [2m[90mâ†“[39m[22m should allow builder to create workflows
       [2m[90mâ†“[39m[22m should deny builder from deleting workflows
       [2m[90mâ†“[39m[22m should allow runner to view and run workflows
       [2m[90mâ†“[39m[22m should deny runner from editing workflows
       [2m[90mâ†“[39m[22m should allow viewer only view permissions
       [2m[90mâ†“[39m[22m should deny viewer from any edit/create/delete operations
       [2m[90mâ†“[39m[22m should allow builder to manage secrets
       [2m[90mâ†“[39m[22m should deny builder from deleting secrets
       [2m[90mâ†“[39m[22m should return 401 if user is not authenticated
       [2m[90mâ†“[39m[22m should return 403 if user lacks required permission
       [2m[90mâ†“[39m[22m should call next() if user has required permission
       [2m[90mâ†“[39m[22m should allow owner to access any permission
       [2m[90mâ†“[39m[22m should return 403 for null userRole
       [2m[90mâ†“[39m[22m should allow if user has at least one permission
       [2m[90mâ†“[39m[22m should deny if user has none of the permissions
       [2m[90mâ†“[39m[22m should allow owner with wildcard permission
       [2m[90mâ†“[39m[22m should allow if user has all required permissions
       [2m[90mâ†“[39m[22m should deny if user is missing any permission
       [2m[90mâ†“[39m[22m should allow owner with wildcard permission
       [2m[90mâ†“[39m[22m should allow if user has required role
       [2m[90mâ†“[39m[22m should allow if user has one of multiple allowed roles
       [2m[90mâ†“[39m[22m should deny if user lacks required role
       [2m[90mâ†“[39m[22m should deny if userRole is null
         [2m[90mâ†“[39m[22m should allow only owner role
         [2m[90mâ†“[39m[22m should deny builder role
         [2m[90mâ†“[39m[22m should allow owner
         [2m[90mâ†“[39m[22m should allow builder
         [2m[90mâ†“[39m[22m should deny runner
         [2m[90mâ†“[39m[22m should allow owner
         [2m[90mâ†“[39m[22m should allow builder
         [2m[90mâ†“[39m[22m should allow runner
         [2m[90mâ†“[39m[22m should deny viewer
       [2m[90mâ†“[39m[22m should return empty array for unauthenticated request
       [2m[90mâ†“[39m[22m should return empty array for null userRole
       [2m[90mâ†“[39m[22m should return all permissions for owner
       [2m[90mâ†“[39m[22m should return builder permissions
       [2m[90mâ†“[39m[22m should return runner permissions
       [2m[90mâ†“[39m[22m should return viewer permissions
       [2m[90mâ†“[39m[22m should handle missing userId gracefully
       [2m[90mâ†“[39m[22m should handle undefined userRole gracefully
       [2m[90mâ†“[39m[22m should handle invalid role type gracefully
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [31mâ¯[39m tests/unit/utils/encryption.test.ts [2m([22m[2m29 tests[22m[2m | [22m[33m29 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should generate a valid base64-encoded 32-byte key
       [2m[90mâ†“[39m[22m should generate different keys each time
       [2m[90mâ†“[39m[22m should not throw error when master key is valid
       [2m[90mâ†“[39m[22m should throw error when master key is missing
       [2m[90mâ†“[39m[22m should throw error when master key is invalid base64
       [2m[90mâ†“[39m[22m should throw error when master key is wrong length
       [2m[90mâ†“[39m[22m should encrypt and decrypt a string successfully
       [2m[90mâ†“[39m[22m should produce different ciphertext for same plaintext
       [2m[90mâ†“[39m[22m should handle empty strings
       [2m[90mâ†“[39m[22m should handle unicode characters
       [2m[90mâ†“[39m[22m should handle long strings
       [2m[90mâ†“[39m[22m should throw error when decrypting with wrong key
       [2m[90mâ†“[39m[22m should throw error when decrypting corrupted data
       [2m[90mâ†“[39m[22m should throw error when decrypting invalid base64
       [2m[90mâ†“[39m[22m should return base64-encoded ciphertext
       [2m[90mâ†“[39m[22m should redact non-empty strings
       [2m[90mâ†“[39m[22m should return (empty) for null
       [2m[90mâ†“[39m[22m should return (empty) for undefined
       [2m[90mâ†“[39m[22m should return (empty) for empty string
       [2m[90mâ†“[39m[22m should mask long secrets showing first and last 4 characters
       [2m[90mâ†“[39m[22m should fully redact short secrets
       [2m[90mâ†“[39m[22m should fully redact secrets with 8 or fewer characters
       [2m[90mâ†“[39m[22m should handle empty string
       [2m[90mâ†“[39m[22m should redact sensitive fields by default
       [2m[90mâ†“[39m[22m should redact custom sensitive keys
       [2m[90mâ†“[39m[22m should handle nested objects
       [2m[90mâ†“[39m[22m should not modify non-object values
       [2m[90mâ†“[39m[22m should handle case-insensitive matching
       [2m[90mâ†“[39m[22m should handle partial matches in key names
 [31mâ¯[39m tests/integration/auth/oauth2.client-credentials.test.ts [2m([22m[2m29 tests[22m[2m | [22m[33m29 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should fetch OAuth2 access token with client credentials
       [2m[90mâ†“[39m[22m should handle token request without scope
       [2m[90mâ†“[39m[22m should throw error when token request fails
       [2m[90mâ†“[39m[22m should throw error when access_token is missing from response
       [2m[90mâ†“[39m[22m should throw error when token_type is missing from response
       [2m[90mâ†“[39m[22m should default expires_in to 3600 when not provided
       [2m[90mâ†“[39m[22m should handle network errors gracefully
       [2m[90mâ†“[39m[22m should cache OAuth2 tokens to avoid redundant requests
       [2m[90mâ†“[39m[22m should use different cache keys for different configs
       [2m[90mâ†“[39m[22m should refresh token when cache expires
       [2m[90mâ†“[39m[22m should return cached token with remaining lifetime
       [2m[90mâ†“[39m[22m should invalidate specific cached token
       [2m[90mâ†“[39m[22m should clear all cached tokens
       [2m[90mâ†“[39m[22m should respect 30-second expiry buffer
       [2m[90mâ†“[39m[22m should return true for valid credentials
       [2m[90mâ†“[39m[22m should return false for invalid credentials
       [2m[90mâ†“[39m[22m should return false when token URL is unreachable
       [2m[90mâ†“[39m[22m should generate unique cache keys for different tenants
       [2m[90mâ†“[39m[22m should generate unique cache keys for different projects
       [2m[90mâ†“[39m[22m should generate unique cache keys for different scopes
       [2m[90mâ†“[39m[22m should use same cache key for identical configs
       [2m[90mâ†“[39m[22m should handle 400 Bad Request
       [2m[90mâ†“[39m[22m should handle 401 Unauthorized
       [2m[90mâ†“[39m[22m should handle 403 Forbidden
       [2m[90mâ†“[39m[22m should handle 500 Internal Server Error
       [2m[90mâ†“[39m[22m should handle malformed JSON response
       [2m[90mâ†“[39m[22m should handle timeout errors
       [2m[90mâ†“[39m[22m should include scope in token request when provided
       [2m[90mâ†“[39m[22m should handle space-separated scopes
 [31mâ¯[39m tests/integration/api.ai.test.ts [2m([22m[2m32 tests[22m[2m | [22m[33m32 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should require authentication
       [2m[90mâ†“[39m[22m should require builder or owner role
       [2m[90mâ†“[39m[22m should validate request body with Zod schema
       [2m[90mâ†“[39m[22m should generate workflow and return success response
       [2m[90mâ†“[39m[22m should enforce rate limiting (10 requests per minute)
       [2m[90mâ†“[39m[22m should handle AI API rate limit errors with 429 status
       [2m[90mâ†“[39m[22m should handle AI API timeout errors with 504 status
       [2m[90mâ†“[39m[22m should handle validation errors with 422 status
       [2m[90mâ†“[39m[22m should include metadata in response
       [2m[90mâ†“[39m[22m should log request and response with appropriate detail
       [2m[90mâ†“[39m[22m should require authentication
       [2m[90mâ†“[39m[22m should require builder or owner role
       [2m[90mâ†“[39m[22m should validate workflow exists
       [2m[90mâ†“[39m[22m should fetch existing workflow details
       [2m[90mâ†“[39m[22m should generate suggestions based on user request
       [2m[90mâ†“[39m[22m should return suggestions in correct format
       [2m[90mâ†“[39m[22m should enforce rate limiting
       [2m[90mâ†“[39m[22m should require authentication
       [2m[90mâ†“[39m[22m should require builder or owner role
       [2m[90mâ†“[39m[22m should require placeholders to be provided
       [2m[90mâ†“[39m[22m should fetch workflow variables
       [2m[90mâ†“[39m[22m should generate binding suggestions
       [2m[90mâ†“[39m[22m should include confidence scores in suggestions
       [2m[90mâ†“[39m[22m should identify unmatched placeholders and variables
       [2m[90mâ†“[39m[22m should enforce rate limiting
       [2m[90mâ†“[39m[22m should use user ID for rate limit key when authenticated
       [2m[90mâ†“[39m[22m should fall back to IP address for anonymous users
       [2m[90mâ†“[39m[22m should apply 10 requests per minute limit
       [2m[90mâ†“[39m[22m should reset limit after window expires
       [2m[90mâ†“[39m[22m should return user-friendly error messages
       [2m[90mâ†“[39m[22m should include error details only in development mode
       [2m[90mâ†“[39m[22m should log errors with appropriate context
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w80_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w80_v3 (Reused: true)

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mğŸ“Š Schema test_schema_w80_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w81_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w81_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w82_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w82_v3 (Reused: true)

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712536019,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712536019,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w80_v3\",public"}
{"level":30,"time":1768712536020,"env":"test","msg":"DB: Created pool for worker 80, schema=\"test_schema_w80_v3\", max connections=5"}
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w83_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

{"level":30,"time":1768712536050,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mğŸ“Š Schema test_schema_w81_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w83_v3 (Reused: true)

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w79_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w79_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mğŸ“Š Schema test_schema_w82_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mğŸ“Š Schema test_schema_w83_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712536571,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712536571,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w81_v3\",public"}
{"level":30,"time":1768712536572,"env":"test","msg":"DB: Created pool for worker 81, schema=\"test_schema_w81_v3\", max connections=5"}
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mğŸ“Š Schema test_schema_w79_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768712536615,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712536850,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712536850,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w82_v3\",public"}
{"level":30,"time":1768712536850,"env":"test","msg":"DB: Created pool for worker 82, schema=\"test_schema_w82_v3\", max connections=5"}
{"level":30,"time":1768712536880,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712537014,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712537014,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w83_v3\",public"}
{"level":30,"time":1768712537014,"env":"test","msg":"DB: Created pool for worker 83, schema=\"test_schema_w83_v3\", max connections=5"}
{"level":30,"time":1768712537045,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712537100,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712537100,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w79_v3\",public"}
{"level":30,"time":1768712537101,"env":"test","msg":"DB: Created pool for worker 79, schema=\"test_schema_w79_v3\", max connections=5"}
{"level":30,"time":1768712537141,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/utils/conditionalLogic.test.ts [2m([22m[2m29 tests[22m[2m | [22m[33m29 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
         [2m[90mâ†“[39m[22m should return true for exact string match
         [2m[90mâ†“[39m[22m should return false for non-matching string
         [2m[90mâ†“[39m[22m should handle numeric equality
         [2m[90mâ†“[39m[22m should return true for different values
         [2m[90mâ†“[39m[22m should return false for same values
         [2m[90mâ†“[39m[22m should find substring in string
         [2m[90mâ†“[39m[22m should find item in array
         [2m[90mâ†“[39m[22m should return false when not found
         [2m[90mâ†“[39m[22m should return true for greater number
         [2m[90mâ†“[39m[22m should return false for equal or smaller number
         [2m[90mâ†“[39m[22m should return true for smaller number
         [2m[90mâ†“[39m[22m should return false for equal or larger number
         [2m[90mâ†“[39m[22m should return true for value in range
         [2m[90mâ†“[39m[22m should return true for value at boundaries (inclusive)
         [2m[90mâ†“[39m[22m should return false for value outside range
         [2m[90mâ†“[39m[22m should return true for null
         [2m[90mâ†“[39m[22m should return true for undefined
         [2m[90mâ†“[39m[22m should return true for empty string
         [2m[90mâ†“[39m[22m should return false for non-empty values
         [2m[90mâ†“[39m[22m should return true for non-empty string
         [2m[90mâ†“[39m[22m should return false for null/undefined/empty
       [2m[90mâ†“[39m[22m should show question by default with no conditions
       [2m[90mâ†“[39m[22m should apply show action when condition is met
       [2m[90mâ†“[39m[22m should hide question when show condition is not met
       [2m[90mâ†“[39m[22m should apply hide action when condition is met
       [2m[90mâ†“[39m[22m should make question required when require action is met
       [2m[90mâ†“[39m[22m should make question optional when make_optional action is met
       [2m[90mâ†“[39m[22m should handle multiple conditions with AND logic
       [2m[90mâ†“[39m[22m should handle multiple conditions with OR logic
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [31mâ¯[39m tests/ui/datavault/ColumnTypeIcon.test.tsx [2m([22m[2m27 tests[22m[2m | [22m[33m27 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m renders text icon for text type
       [2m[90mâ†“[39m[22m renders hash icon for number type
       [2m[90mâ†“[39m[22m renders hash icon for auto_number type
       [2m[90mâ†“[39m[22m renders toggle icon for boolean type
       [2m[90mâ†“[39m[22m renders calendar icon for date type
       [2m[90mâ†“[39m[22m renders clock icon for datetime type
       [2m[90mâ†“[39m[22m renders mail icon for email type
       [2m[90mâ†“[39m[22m renders phone icon for phone type
       [2m[90mâ†“[39m[22m renders link icon for url type
       [2m[90mâ†“[39m[22m renders JSON icon for json type
       [2m[90mâ†“[39m[22m renders file icon for file_upload type
       [2m[90mâ†“[39m[22m renders default text icon for unknown type
       [2m[90mâ†“[39m[22m applies custom className
       [2m[90mâ†“[39m[22m returns blue color for text types
       [2m[90mâ†“[39m[22m returns green color for number types
       [2m[90mâ†“[39m[22m returns purple color for boolean types
       [2m[90mâ†“[39m[22m returns orange color for date types
       [2m[90mâ†“[39m[22m returns pink color for email type
       [2m[90mâ†“[39m[22m returns cyan color for phone type
       [2m[90mâ†“[39m[22m returns indigo color for url type
       [2m[90mâ†“[39m[22m returns yellow color for json type
       [2m[90mâ†“[39m[22m returns gray color for file_upload type
       [2m[90mâ†“[39m[22m returns muted color for unknown type
       [2m[90mâ†“[39m[22m returns proper labels for all column types
       [2m[90mâ†“[39m[22m returns the type itself for unknown types
       [2m[90mâ†“[39m[22m includes aria-label with column type
       [2m[90mâ†“[39m[22m has proper icon size class
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w84_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w84_v3 (Reused: true)

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mğŸ“Š Schema test_schema_w84_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712538871,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712538871,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w84_v3\",public"}
{"level":30,"time":1768712538871,"env":"test","msg":"DB: Created pool for worker 84, schema=\"test_schema_w84_v3\", max connections=5"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w85_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

{"level":30,"time":1768712538903,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w85_v3 (Reused: true)

 [31mâ¯[39m tests/ui/datavault/TableCard.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should render table name and description
     [2m[90mâ†“[39m[22m should render table slug
     [2m[90mâ†“[39m[22m should render table slug
     [2m[90mâ†“[39m[22m should render column and row counts
     [2m[90mâ†“[39m[22m should call onClick when card is clicked
     [2m[90mâ†“[39m[22m should call onDelete when delete button is clicked
     [2m[90mâ†“[39m[22m should show placeholder when description is missing
     [2m[90mâ†“[39m[22m should format dates correctly
 [31mâ¯[39m tests/unit/engine.expr.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m26 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should allow known variables and helpers
       [2m[90mâ†“[39m[22m should allow helper functions
       [2m[90mâ†“[39m[22m should allow complex expressions with multiple helpers
       [2m[90mâ†“[39m[22m should reject unknown identifiers
       [2m[90mâ†“[39m[22m should reject forbidden identifiers
       [2m[90mâ†“[39m[22m should handle syntax errors gracefully
       [2m[90mâ†“[39m[22m should validate boolean expressions
       [2m[90mâ†“[39m[22m should validate string operations
       [2m[90mâ†“[39m[22m should evaluate simple arithmetic
       [2m[90mâ†“[39m[22m should be deterministic with fixed clock
       [2m[90mâ†“[39m[22m should evaluate with helper functions
       [2m[90mâ†“[39m[22m should support math helpers
       [2m[90mâ†“[39m[22m should support string helpers
       [2m[90mâ†“[39m[22m should support array helpers
       [2m[90mâ†“[39m[22m should support logic helpers
       [2m[90mâ†“[39m[22m should support date helpers with deterministic clock
       [2m[90mâ†“[39m[22m should reject invalid property access
       [2m[90mâ†“[39m[22m should handle evaluation errors gracefully
       [2m[90mâ†“[39m[22m should enforce timeout on long-running expressions
       [2m[90mâ†“[39m[22m should support complex nested expressions
       [2m[90mâ†“[39m[22m should handle boolean comparisons
       [2m[90mâ†“[39m[22m should handle string concatenation
       [2m[90mâ†“[39m[22m should have all helpers listed in AllowedHelperNames
       [2m[90mâ†“[39m[22m roundTo should handle edge cases
       [2m[90mâ†“[39m[22m dateDiff should calculate differences correctly
       [2m[90mâ†“[39m[22m isEmpty should handle various types
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mğŸ“Š Schema test_schema_w85_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712539386,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712539387,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w85_v3\",public"}
{"level":30,"time":1768712539387,"env":"test","msg":"DB: Created pool for worker 85, schema=\"test_schema_w85_v3\", max connections=5"}
{"level":30,"time":1768712539420,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/session.management.test.ts [2m([22m[2m22 tests[22m[2m | [22m[33m22 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should list all active sessions for user
       [2m[90mâ†“[39m[22m should mark current session as current
       [2m[90mâ†“[39m[22m should only show sessions for authenticated user
       [2m[90mâ†“[39m[22m should not include revoked sessions
       [2m[90mâ†“[39m[22m should order sessions by last used (most recent first)
       [2m[90mâ†“[39m[22m should revoke specific session
       [2m[90mâ†“[39m[22m should not allow revoking other users sessions
       [2m[90mâ†“[39m[22m should allow revoking current session (logout)
       [2m[90mâ†“[39m[22m should return 404 for non-existent session ID
       [2m[90mâ†“[39m[22m should revoke all sessions except current
       [2m[90mâ†“[39m[22m should return count of revoked sessions
         [2m[90mâ†“[39m[22m should trust current device for 30 days
         [2m[90mâ†“[39m[22m should skip MFA on trusted device
         [2m[90mâ†“[39m[22m should require MFA on untrusted device
         [2m[90mâ†“[39m[22m should fingerprint device by User-Agent + IP
         [2m[90mâ†“[39m[22m should list all trusted devices
         [2m[90mâ†“[39m[22m should not include revoked trusted devices
         [2m[90mâ†“[39m[22m should not include expired trusted devices
         [2m[90mâ†“[39m[22m should revoke trusted device
         [2m[90mâ†“[39m[22m should not allow revoking other users trusted devices
         [2m[90mâ†“[39m[22m should complete full flow: MFA setup -> device trust -> login from trusted device
         [2m[90mâ†“[39m[22m should update lastUsedAt when using trusted device
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w86_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w86_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w87_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w87_v3 (Reused: true)

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w88_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w88_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mğŸ“Š Schema test_schema_w86_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mğŸ“Š Schema test_schema_w87_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mğŸ“Š Schema test_schema_w88_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712540871,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712540871,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w86_v3\",public"}
{"level":30,"time":1768712540872,"env":"test","msg":"DB: Created pool for worker 86, schema=\"test_schema_w86_v3\", max connections=5"}
{"level":30,"time":1768712540903,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712541008,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712541008,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w87_v3\",public"}
{"level":30,"time":1768712541008,"env":"test","msg":"DB: Created pool for worker 87, schema=\"test_schema_w87_v3\", max connections=5"}
{"level":30,"time":1768712541037,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712541102,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712541102,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w88_v3\",public"}
{"level":30,"time":1768712541102,"env":"test","msg":"DB: Created pool for worker 88, schema=\"test_schema_w88_v3\", max connections=5"}
{"level":30,"time":1768712541128,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/services/docxRenderer2.test.ts [2m([22m[2m27 tests[22m[2m | [22m[33m27 skipped[39m[2m)[22m[33m 600006[2mms[22m[39m
       [2m[90mâ†“[39m[22m should validate complete data
       [2m[90mâ†“[39m[22m should detect missing placeholders
       [2m[90mâ†“[39m[22m should detect extra data keys
       [2m[90mâ†“[39m[22m should ignore helper functions in validation
       [2m[90mâ†“[39m[22m should handle empty placeholders
       [2m[90mâ†“[39m[22m should parse simple placeholders
       [2m[90mâ†“[39m[22m should parse loop variables
       [2m[90mâ†“[39m[22m should parse conditional variables
       [2m[90mâ†“[39m[22m should parse helper calls
       [2m[90mâ†“[39m[22m should render template with data
       [2m[90mâ†“[39m[22m should handle rendering errors gracefully
       [2m[90mâ†“[39m[22m should support PDF conversion when requested
       [2m[90mâ†“[39m[22m should merge data with helpers
       [2m[90mâ†“[39m[22m should parse simple variable access
       [2m[90mâ†“[39m[22m should parse nested variable access
       [2m[90mâ†“[39m[22m should parse helper calls with arguments
       [2m[90mâ†“[39m[22m should handle missing values gracefully
       [2m[90mâ†“[39m[22m should support simple loops
       [2m[90mâ†“[39m[22m should support nested loops
       [2m[90mâ†“[39m[22m should support conditionals
       [2m[90mâ†“[39m[22m should support unless conditionals
       [2m[90mâ†“[39m[22m should support inline helpers
       [2m[90mâ†“[39m[22m should throw NotFound error for missing template
       [2m[90mâ†“[39m[22m should provide detailed error messages for render failures
       [2m[90mâ†“[39m[22m should handle malformed templates
       [2m[90mâ†“[39m[22m should make all helpers available in template
       [2m[90mâ†“[39m[22m should support helper chaining
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w89_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w89_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mğŸ“Š Schema test_schema_w89_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712544351,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712544351,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w89_v3\",public"}
{"level":30,"time":1768712544351,"env":"test","msg":"DB: Created pool for worker 89, schema=\"test_schema_w89_v3\", max connections=5"}
{"level":30,"time":1768712544381,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/components/datavault/CellRenderer.test.tsx [2m([22m[2m12 tests[22m[2m | [22m[33m12 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
     [2m[90mâ†“[39m[22m renders text value in display mode
     [2m[90mâ†“[39m[22m renders number value correctly
     [2m[90mâ†“[39m[22m renders boolean value as Yes/No
     [2m[90mâ†“[39m[22m renders date value formatted
     [2m[90mâ†“[39m[22m shows text input in edit mode for text columns
     [2m[90mâ†“[39m[22m shows number input in edit mode for number columns
     [2m[90mâ†“[39m[22m shows checkbox in edit mode for boolean columns
     [2m[90mâ†“[39m[22m calls onCommit when Enter is pressed
     [2m[90mâ†“[39m[22m calls onCancel when Escape is pressed
     [2m[90mâ†“[39m[22m handles empty values
     [2m[90mâ†“[39m[22m handles null values
     [2m[90mâ†“[39m[22m shows "Unsupported type" for unknown column types
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w90_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w90_v3 (Reused: true)

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mğŸ“Š Schema test_schema_w90_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768712546567,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768712546567,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w90_v3\",public"}
{"level":30,"time":1768712546567,"env":"test","msg":"DB: Created pool for worker 90, schema=\"test_schema_w90_v3\", max connections=5"}
{"level":30,"time":1768712546595,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768712828671,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712829331,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712830311,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712834685,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712835253,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712835515,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712835620,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712835697,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712837584,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712838553,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712839613,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712839721,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712839796,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712843147,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768712845315,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
     [2m[90mâ†“[39m[22m renders DndContext wrapper
     [2m[90mâ†“[39m[22m renders SortableContext for columns
     [2m[90mâ†“[39m[22m displays columns with type icons
     [2m[90mâ†“[39m[22m displays PK badge for primary key columns
     [2m[90mâ†“[39m[22m calls reorderColumns API when columns are reordered
     [2m[90mâ†“[39m[22m displays columns in order based on orderIndex
     [2m[90mâ†“[39m[22m maintains column order after successful reorder
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

 [31mâ¯[39m tests/unit/utils/pagination.test.ts [2m([22m[2m24 tests[22m[2m | [22m[33m24 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should parse valid pagination query with defaults
       [2m[90mâ†“[39m[22m should parse custom limit
       [2m[90mâ†“[39m[22m should coerce limit to number
       [2m[90mâ†“[39m[22m should parse cursor
       [2m[90mâ†“[39m[22m should enforce minimum limit of 1
       [2m[90mâ†“[39m[22m should enforce maximum limit of 100
       [2m[90mâ†“[39m[22m should enforce integer limit
       [2m[90mâ†“[39m[22m should encode and decode cursor correctly
       [2m[90mâ†“[39m[22m should handle null createdAt by using current time
       [2m[90mâ†“[39m[22m should encode cursor as base64
       [2m[90mâ†“[39m[22m should return null for invalid base64 cursor
       [2m[90mâ†“[39m[22m should return null for malformed cursor payload
       [2m[90mâ†“[39m[22m should return null for cursor with non-numeric timestamp
       [2m[90mâ†“[39m[22m should handle cursor with special characters in ID
       [2m[90mâ†“[39m[22m should create paginated response with hasMore=false when items <= limit
       [2m[90mâ†“[39m[22m should create paginated response with hasMore=true when items > limit
       [2m[90mâ†“[39m[22m should encode nextCursor based on last returned item
       [2m[90mâ†“[39m[22m should handle exact match (items === limit + 1)
       [2m[90mâ†“[39m[22m should handle empty items array
       [2m[90mâ†“[39m[22m should handle single item
       [2m[90mâ†“[39m[22m should return null for undefined cursor
       [2m[90mâ†“[39m[22m should build where clause from valid cursor
       [2m[90mâ†“[39m[22m should return null for invalid cursor
       [2m[90mâ†“[39m[22m should handle empty string cursor
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w91_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w91_v3 (Reused: true)

 [31mâ¯[39m tests/unit/services/TemplateAnalysisService.test.ts [2m([22m[2m27 tests[22m[2m | [22m[33m27 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should validate complete data
       [2m[90mâ†“[39m[22m should detect missing variables
       [2m[90mâ†“[39m[22m should detect type mismatches
       [2m[90mâ†“[39m[22m should calculate coverage percentage
       [2m[90mâ†“[39m[22m should handle empty template variables
       [2m[90mâ†“[39m[22m should generate date values for date fields
       [2m[90mâ†“[39m[22m should generate numeric values for amount fields
       [2m[90mâ†“[39m[22m should generate boolean values for boolean fields
       [2m[90mâ†“[39m[22m should generate email for email fields
       [2m[90mâ†“[39m[22m should generate arrays for loop variables
       [2m[90mâ†“[39m[22m should identify added variables
       [2m[90mâ†“[39m[22m should identify removed variables
       [2m[90mâ†“[39m[22m should identify unchanged variables
       [2m[90mâ†“[39m[22m should extract simple variables
       [2m[90mâ†“[39m[22m should extract loop variables
       [2m[90mâ†“[39m[22m should extract conditional variables
       [2m[90mâ†“[39m[22m should extract helper calls
       [2m[90mâ†“[39m[22m should handle nested paths
       [2m[90mâ†“[39m[22m should calculate simple loop depth
       [2m[90mâ†“[39m[22m should calculate nested loop depth
       [2m[90mâ†“[39m[22m should handle deeply nested loops
       [2m[90mâ†“[39m[22m should return 0 for no loops
       [2m[90mâ†“[39m[22m should warn about type mismatches
       [2m[90mâ†“[39m[22m should warn about empty arrays
       [2m[90mâ†“[39m[22m should categorize warning severities
       [2m[90mâ†“[39m[22m should detect helper usage
       [2m[90mâ†“[39m[22m should calculate template statistics
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mğŸ“Š Schema test_schema_w91_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713130430,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713130431,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w91_v3\",public"}
{"level":30,"time":1768713130431,"env":"test","msg":"DB: Created pool for worker 91, schema=\"test_schema_w91_v3\", max connections=5"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768713130469,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w92_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w92_v3 (Reused: true)

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mğŸ“Š Schema test_schema_w92_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w93_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w93_v3 (Reused: true)

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713132249,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713132250,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w92_v3\",public"}
{"level":30,"time":1768713132250,"env":"test","msg":"DB: Created pool for worker 92, schema=\"test_schema_w92_v3\", max connections=5"}
{"level":30,"time":1768713132284,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mğŸ“Š Schema test_schema_w93_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713132973,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713132973,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w93_v3\",public"}
{"level":30,"time":1768713132974,"env":"test","msg":"DB: Created pool for worker 93, schema=\"test_schema_w93_v3\", max connections=5"}
{"level":30,"time":1768713133003,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/intake.portal.test.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should prefill allowed fields from URL parameters
       [2m[90mâ†“[39m[22m should ignore disallowed prefill keys
       [2m[90mâ†“[39m[22m should not prefill when allowPrefill is false
       [2m[90mâ†“[39m[22m should not prefill file upload or sensitive fields
       [2m[90mâ†“[39m[22m should generate CAPTCHA challenge
       [2m[90mâ†“[39m[22m should require CAPTCHA when workflow config requires it
       [2m[90mâ†“[39m[22m should validate correct CAPTCHA and allow submission
       [2m[90mâ†“[39m[22m should reject incorrect CAPTCHA answer
       [2m[90mâ†“[39m[22m should not require CAPTCHA when workflow config disables it
       [2m[90mâ†“[39m[22m should send email receipt when configured
       [2m[90mâ†“[39m[22m should not send email when sendEmailReceipt is false
       [2m[90mâ†“[39m[22m should skip email when receiptEmailVar is not found
       [2m[90mâ†“[39m[22m should exclude sensitive fields from email summary
       [2m[90mâ†“[39m[22m should allow owner to update intakeConfig
       [2m[90mâ†“[39m[22m should allow builder to update intakeConfig
       [2m[90mâ†“[39m[22m should reject viewer from updating intakeConfig
       [2m[90mâ†“[39m[22m should validate intakeConfig schema
       [2m[90mâ†“[39m[22m should include intakeConfig in response
 [31mâ¯[39m tests/unit/docxRenderer.test.ts [2m([22m[2m12 tests[22m[2m | [22m[33m12 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should extract placeholders from a template
       [2m[90mâ†“[39m[22m should extract placeholders including formatters
       [2m[90mâ†“[39m[22m should throw error if template does not exist
       [2m[90mâ†“[39m[22m should validate complete data
       [2m[90mâ†“[39m[22m should detect missing data
       [2m[90mâ†“[39m[22m should allow formatters as valid placeholders
       [2m[90mâ†“[39m[22m should render a template with simple data
       [2m[90mâ†“[39m[22m should use formatters in templates
       [2m[90mâ†“[39m[22m should handle missing data gracefully
       [2m[90mâ†“[39m[22m should throw error if template does not exist
       [2m[90mâ†“[39m[22m should use custom output name
       [2m[90mâ†“[39m[22m should attempt PDF conversion when requested
 [31mâ¯[39m tests/unit/services/WorkflowPatchService.test.ts [2m([22m[2m21 tests[22m[2m | [22m[33m21 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should resolve section tempId to real UUID when creating step
       [2m[90mâ†“[39m[22m should handle multi-level tempId references
       [2m[90mâ†“[39m[22m should reject duplicate step alias on create
       [2m[90mâ†“[39m[22m should allow same alias on update of same step
       [2m[90mâ†“[39m[22m should reject duplicate alias on update to different step
       [2m[90mâ†“[39m[22m should reject completely unknown operation
       [2m[90mâ†“[39m[22m should reject malformed operation (missing required fields)
       [2m[90mâ†“[39m[22m should reject unsafe DataVault operations (dropTable)
       [2m[90mâ†“[39m[22m should reject unsafe DataVault operations (dropColumn)
       [2m[90mâ†“[39m[22m should reject unsafe DataVault operations (deleteRows)
       [2m[90mâ†“[39m[22m should reject unsafe DataVault operations (updateRowData)
       [2m[90mâ†“[39m[22m should allow safe DataVault operations (createTable, addColumns)
       [2m[90mâ†“[39m[22m should rollback all ops if any op fails
       [2m[90mâ†“[39m[22m should clear tempId mappings between batch calls
       [2m[90mâ†“[39m[22m should create visibility rule on step
       [2m[90mâ†“[39m[22m should parse complex condition expressions
       [2m[90mâ†“[39m[22m should attach document to workflow (document.add)
       [2m[90mâ†“[39m[22m should bind document fields to workflow variables (document.bindFields)
       [2m[90mâ†“[39m[22m should reject binding to non-existent step alias
       [2m[90mâ†“[39m[22m should create DataVault table with columns (datavault.createTable)
       [2m[90mâ†“[39m[22m should create writeback mapping (datavault.createWritebackMapping)
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [31mâ¯[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx [2m([22m[2m12 tests[22m[2m | [22m[33m12 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should detect duplicate column IDs
       [2m[90mâ†“[39m[22m should return empty array when no duplicates
       [2m[90mâ†“[39m[22m should detect multiple duplicate columns
       [2m[90mâ†“[39m[22m should detect missing required columns
       [2m[90mâ†“[39m[22m should return empty array when all required columns mapped
       [2m[90mâ†“[39m[22m should detect rows with missing column
       [2m[90mâ†“[39m[22m should detect rows with missing value
       [2m[90mâ†“[39m[22m should detect rows with both missing
       [2m[90mâ†“[39m[22m should return empty array for complete rows
       [2m[90mâ†“[39m[22m should validate update mode requires match strategy
       [2m[90mâ†“[39m[22m should validate upsert mode requires match strategy
       [2m[90mâ†“[39m[22m should validate create mode does not require match strategy
 [31mâ¯[39m tests/unit/ScriptEngine.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m26 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
         [2m[90mâ†“[39m[22m should execute simple JavaScript code
         [2m[90mâ†“[39m[22m should whitelist input keys correctly
         [2m[90mâ†“[39m[22m should inject helpers into execution context
         [2m[90mâ†“[39m[22m should inject context into execution
         [2m[90mâ†“[39m[22m should capture console logs when enabled
         [2m[90mâ†“[39m[22m should handle errors gracefully
         [2m[90mâ†“[39m[22m should enforce timeout
         [2m[90mâ†“[39m[22m should handle missing emit() call
         [2m[90mâ†“[39m[22m should use custom helpers if provided
         [2m[90mâ†“[39m[22m should measure execution duration
         [2m[90mâ†“[39m[22m should execute simple Python code
         [2m[90mâ†“[39m[22m should whitelist input keys in Python
         [2m[90mâ†“[39m[22m should handle Python errors gracefully
         [2m[90mâ†“[39m[22m should enforce timeout for Python
         [2m[90mâ†“[39m[22m should handle missing emit() in Python
       [2m[90mâ†“[39m[22m should validate JavaScript syntax
       [2m[90mâ†“[39m[22m should reject invalid JavaScript syntax
       [2m[90mâ†“[39m[22m should reject code exceeding size limit
       [2m[90mâ†“[39m[22m should reject empty code
       [2m[90mâ†“[39m[22m should warn if Python code missing emit()
       [2m[90mâ†“[39m[22m should accept Python code with emit()
       [2m[90mâ†“[39m[22m should test execute with sample data
       [2m[90mâ†“[39m[22m should capture console logs in test mode
       [2m[90mâ†“[39m[22m should use test context
       [2m[90mâ†“[39m[22m should handle unexpected errors gracefully
       [2m[90mâ†“[39m[22m should handle malformed output gracefully
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w95_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w95_v3 (Reused: true)

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w96_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w96_v3 (Reused: true)

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mğŸ“Š Schema test_schema_w95_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w94_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w94_v3 (Reused: true)

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mğŸ“Š Schema test_schema_w96_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713136900,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713136900,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w95_v3\",public"}
{"level":30,"time":1768713136900,"env":"test","msg":"DB: Created pool for worker 95, schema=\"test_schema_w95_v3\", max connections=5"}
{"level":30,"time":1768713136933,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mğŸ“Š Schema test_schema_w94_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713137242,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713137242,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w96_v3\",public"}
{"level":30,"time":1768713137242,"env":"test","msg":"DB: Created pool for worker 96, schema=\"test_schema_w96_v3\", max connections=5"}
{"level":30,"time":1768713137280,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713137547,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713137547,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w94_v3\",public"}
{"level":30,"time":1768713137547,"env":"test","msg":"DB: Created pool for worker 94, schema=\"test_schema_w94_v3\", max connections=5"}
{"level":30,"time":1768713137576,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/mfa.flow.test.ts [2m([22m[2m16 tests[22m[2m | [22m[33m16 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should complete full MFA setup flow
       [2m[90mâ†“[39m[22m should reject invalid TOTP code during setup
       [2m[90mâ†“[39m[22m should not enable MFA until TOTP is verified
       [2m[90mâ†“[39m[22m should complete full MFA login flow
       [2m[90mâ†“[39m[22m should accept backup code for MFA login
       [2m[90mâ†“[39m[22m should not allow reuse of backup code
       [2m[90mâ†“[39m[22m should reject invalid MFA code
       [2m[90mâ†“[39m[22m should accept TOTP code within 60-second window
       [2m[90mâ†“[39m[22m should regenerate backup codes
       [2m[90mâ†“[39m[22m should show remaining backup codes count
       [2m[90mâ†“[39m[22m should disable MFA with password confirmation
       [2m[90mâ†“[39m[22m should require password to disable MFA
       [2m[90mâ†“[39m[22m should delete backup codes when disabling MFA
       [2m[90mâ†“[39m[22m should allow admin to reset user MFA
       [2m[90mâ†“[39m[22m should require admin role for MFA reset
       [2m[90mâ†“[39m[22m should enforce MFA for all tenant users when required
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w98_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w98_v3 (Reused: true)

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mğŸ“Š Schema test_schema_w98_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w97_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w99_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w97_v3 (Reused: true)

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w99_v3 (Reused: true)

 [31mâ¯[39m tests/unit/schema/collections.test.ts [2m([22m[2m34 tests[22m[2m | [22m[33m34 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should have correct table name
       [2m[90mâ†“[39m[22m should have required columns
       [2m[90mâ†“[39m[22m should have correct table name
       [2m[90mâ†“[39m[22m should have required columns
       [2m[90mâ†“[39m[22m should have correct table name
       [2m[90mâ†“[39m[22m should have required columns
       [2m[90mâ†“[39m[22m should have all expected field types
         [2m[90mâ†“[39m[22m should validate valid collection data
         [2m[90mâ†“[39m[22m should require tenantId, name, and slug
         [2m[90mâ†“[39m[22m should omit id, createdAt, and updatedAt
         [2m[90mâ†“[39m[22m should allow description to be null
         [2m[90mâ†“[39m[22m should validate valid field data
         [2m[90mâ†“[39m[22m should require collectionId, name, slug, and type
         [2m[90mâ†“[39m[22m should validate field type enum
         [2m[90mâ†“[39m[22m should reject invalid field type
         [2m[90mâ†“[39m[22m should allow options for select types
         [2m[90mâ†“[39m[22m should allow defaultValue
         [2m[90mâ†“[39m[22m should validate valid record data
         [2m[90mâ†“[39m[22m should require tenantId, collectionId, and data
         [2m[90mâ†“[39m[22m should allow empty data object
         [2m[90mâ†“[39m[22m should allow createdBy and updatedBy to be null
         [2m[90mâ†“[39m[22m should allow complex nested data structures
       [2m[90mâ†“[39m[22m should enforce unique slug per tenant for collections
       [2m[90mâ†“[39m[22m should enforce unique slug per collection for fields
       [2m[90mâ†“[39m[22m should cascade delete fields when collection is deleted
       [2m[90mâ†“[39m[22m should cascade delete records when collection is deleted
       [2m[90mâ†“[39m[22m should cascade delete records when tenant is deleted
       [2m[90mâ†“[39m[22m should set null on createdBy/updatedBy when user is deleted
       [2m[90mâ†“[39m[22m should support JSONB for field options
       [2m[90mâ†“[39m[22m should support JSONB for field default values
       [2m[90mâ†“[39m[22m should support JSONB for record data with fieldSlug â†’ value mapping
       [2m[90mâ†“[39m[22m should correctly infer Collection type
       [2m[90mâ†“[39m[22m should correctly infer CollectionField type
       [2m[90mâ†“[39m[22m should correctly infer CollectionRecord type
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713138578,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713138579,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w98_v3\",public"}
{"level":30,"time":1768713138579,"env":"test","msg":"DB: Created pool for worker 98, schema=\"test_schema_w98_v3\", max connections=5"}
{"level":30,"time":1768713138608,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mğŸ“Š Schema test_schema_w97_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768713138692,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713138693,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w97_v3\",public"}
{"level":30,"time":1768713138693,"env":"test","msg":"DB: Created pool for worker 97, schema=\"test_schema_w97_v3\", max connections=5"}
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mğŸ“Š Schema test_schema_w99_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

{"level":30,"time":1768713138738,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713139131,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713139132,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w99_v3\",public"}
{"level":30,"time":1768713139132,"env":"test","msg":"DB: Created pool for worker 99, schema=\"test_schema_w99_v3\", max connections=5"}
{"level":30,"time":1768713139162,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/services/repeater.test.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should validate min instances constraint
       [2m[90mâ†“[39m[22m should validate max instances constraint
       [2m[90mâ†“[39m[22m should validate required fields in instances
       [2m[90mâ†“[39m[22m should pass validation for valid repeater
       [2m[90mâ†“[39m[22m should handle null value as empty instances
       [2m[90mâ†“[39m[22m should create empty repeater with min instances
       [2m[90mâ†“[39m[22m should add instance to repeater
       [2m[90mâ†“[39m[22m should not add instance if max reached
       [2m[90mâ†“[39m[22m should remove instance from repeater
       [2m[90mâ†“[39m[22m should not remove instance if min would be violated
       [2m[90mâ†“[39m[22m should reorder instances
       [2m[90mâ†“[39m[22m should flatten repeater data for variable resolution
       [2m[90mâ†“[39m[22m should handle empty instances
       [2m[90mâ†“[39m[22m should generate instance title from template
       [2m[90mâ†“[39m[22m should use default template if not provided
       [2m[90mâ†“[39m[22m should return empty string if showInstanceTitle is false
       [2m[90mâ†“[39m[22m should skip validation for hidden fields
       [2m[90mâ†“[39m[22m should require visible fields based on condition
 [31mâ¯[39m tests/unit/services/intakeQuestionVisibility.test.ts [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return all questions as visible when no conditions
       [2m[90mâ†“[39m[22m should exclude virtual steps from visibility evaluation
       [2m[90mâ†“[39m[22m should maintain question order
       [2m[90mâ†“[39m[22m should hide questions when visibleIf is false
       [2m[90mâ†“[39m[22m should show questions when visibleIf is true
       [2m[90mâ†“[39m[22m should handle complex visibleIf conditions
       [2m[90mâ†“[39m[22m should handle OR conditions
       [2m[90mâ†“[39m[22m should handle NOT conditions
       [2m[90mâ†“[39m[22m should include visible required questions in validation
       [2m[90mâ†“[39m[22m should skip hidden questions in validation
       [2m[90mâ†“[39m[22m should check if question is visible
       [2m[90mâ†“[39m[22m should get visible question count
       [2m[90mâ†“[39m[22m should clear values for hidden questions
       [2m[90mâ†“[39m[22m should not clear values for visible questions
       [2m[90mâ†“[39m[22m should warn if required question has visibility condition
       [2m[90mâ†“[39m[22m should warn if virtual step has visibility condition
       [2m[90mâ†“[39m[22m should return no warnings for valid configuration
       [2m[90mâ†“[39m[22m should default to visible on condition evaluation error
       [2m[90mâ†“[39m[22m should handle questions that depend on each other
 [31mâ¯[39m tests/unit/utils/variableResolver.test.ts [2m([22m[2m20 tests[22m[2m | [22m[33m20 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should resolve alias to key
       [2m[90mâ†“[39m[22m should return key if operand is already a key
       [2m[90mâ†“[39m[22m should return operand as-is if not found (for validation to catch)
       [2m[90mâ†“[39m[22m should handle empty operand
       [2m[90mâ†“[39m[22m should handle null-like operands
       [2m[90mâ†“[39m[22m should be case-sensitive for aliases
       [2m[90mâ†“[39m[22m should resolve multiple aliases to keys
       [2m[90mâ†“[39m[22m should handle mix of aliases and keys
       [2m[90mâ†“[39m[22m should handle empty array
       [2m[90mâ†“[39m[22m should preserve unknown operands
       [2m[90mâ†“[39m[22m should find variable by key
       [2m[90mâ†“[39m[22m should find variable by alias
       [2m[90mâ†“[39m[22m should return undefined if not found
       [2m[90mâ†“[39m[22m should prioritize key match over alias match
       [2m[90mâ†“[39m[22m should handle variable with null alias
       [2m[90mâ†“[39m[22m should return true for valid alias
       [2m[90mâ†“[39m[22m should return true for valid key
       [2m[90mâ†“[39m[22m should return false for invalid operand
       [2m[90mâ†“[39m[22m should return false for empty operand
       [2m[90mâ†“[39m[22m should validate against empty variables array
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w100_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w100_v3 (Reused: true)

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w101_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w101_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w102_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w102_v3 (Reused: true)

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mğŸ“Š Schema test_schema_w100_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w103_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mğŸ“Š Schema test_schema_w101_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w103_v3 (Reused: true)

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mğŸ“Š Schema test_schema_w102_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713141082,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713141082,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w100_v3\",public"}
{"level":30,"time":1768713141082,"env":"test","msg":"DB: Created pool for worker 100, schema=\"test_schema_w100_v3\", max connections=5"}
{"level":30,"time":1768713141120,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mğŸ“Š Schema test_schema_w103_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713141185,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713141186,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w101_v3\",public"}
{"level":30,"time":1768713141186,"env":"test","msg":"DB: Created pool for worker 101, schema=\"test_schema_w101_v3\", max connections=5"}
{"level":30,"time":1768713141213,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713141315,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713141316,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w102_v3\",public"}
{"level":30,"time":1768713141316,"env":"test","msg":"DB: Created pool for worker 102, schema=\"test_schema_w102_v3\", max connections=5"}
{"level":30,"time":1768713141342,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713141530,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713141530,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w103_v3\",public"}
{"level":30,"time":1768713141530,"env":"test","msg":"DB: Created pool for worker 103, schema=\"test_schema_w103_v3\", max connections=5"}
{"level":30,"time":1768713141558,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/services/intakeNavigation.test.ts [2m([22m[2m17 tests[22m[2m | [22m[33m17 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return all pages in order when no conditions
       [2m[90mâ†“[39m[22m should handle empty workflow
       [2m[90mâ†“[39m[22m should calculate correct current page index
       [2m[90mâ†“[39m[22m should hide pages when visibleIf is false
       [2m[90mâ†“[39m[22m should show pages when visibleIf is true
       [2m[90mâ†“[39m[22m should handle complex visibleIf conditions
       [2m[90mâ†“[39m[22m should skip pages when skipIf is true
       [2m[90mâ†“[39m[22m should not skip pages when skipIf is false
       [2m[90mâ†“[39m[22m should apply visibleIf before skipIf
       [2m[90mâ†“[39m[22m should get first page
       [2m[90mâ†“[39m[22m should return null for first page if all pages hidden
       [2m[90mâ†“[39m[22m should validate page navigability
       [2m[90mâ†“[39m[22m should get page sequence
       [2m[90mâ†“[39m[22m should default to visible on visibleIf evaluation error
       [2m[90mâ†“[39m[22m should default to not skipping on skipIf evaluation error
       [2m[90mâ†“[39m[22m should calculate correct progress for multi-page workflow
       [2m[90mâ†“[39m[22m should adjust progress when pages are skipped
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w104_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w104_v3 (Reused: true)

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mğŸ“Š Schema test_schema_w104_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713144646,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713144647,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w104_v3\",public"}
{"level":30,"time":1768713144647,"env":"test","msg":"DB: Created pool for worker 104, schema=\"test_schema_w104_v3\", max connections=5"}
{"level":30,"time":1768713144675,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/conditions/conditionEvaluation.test.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should evaluate "email equals test@example.com" correctly
       [2m[90mâ†“[39m[22m should evaluate "age greater_than 18" correctly
       [2m[90mâ†“[39m[22m should evaluate "optional_notes is_empty" correctly
       [2m[90mâ†“[39m[22m should evaluate "status not_equals pending" correctly
       [2m[90mâ†“[39m[22m should evaluate "description contains urgent" correctly
       [2m[90mâ†“[39m[22m should evaluate "confirm_email equals email" correctly
       [2m[90mâ†“[39m[22m should survive JSON serialization/deserialization (JSONB storage)
       [2m[90mâ†“[39m[22m should pass Zod schema validation (same validation used by UI)
       [2m[90mâ†“[39m[22m should handle all common operators used by UI
       [2m[90mâ†“[39m[22m should handle full lifecycle: Create â†’ Validate â†’ Store â†’ Retrieve â†’ Evaluate â†’ Edit
       [2m[90mâ†“[39m[22m should handle null vs empty string correctly
       [2m[90mâ†“[39m[22m should handle case-insensitive string comparison
       [2m[90mâ†“[39m[22m should handle number coercion
       [2m[90mâ†“[39m[22m should handle array includes operations
       [2m[90mâ†“[39m[22m should handle boolean operators
       [2m[90mâ†“[39m[22m should handle emergency contact visibility (has_emergency_contact equals true)
       [2m[90mâ†“[39m[22m should handle age-gated content (age greater_or_equal 18)
       [2m[90mâ†“[39m[22m should handle conditional required field (email is_not_empty)
[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w105_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w105_v3 (Reused: true)

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mğŸ“Š Schema test_schema_w105_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768713147612,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713147612,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w105_v3\",public"}
{"level":30,"time":1768713147612,"env":"test","msg":"DB: Created pool for worker 105, schema=\"test_schema_w105_v3\", max connections=5"}
{"level":30,"time":1768713147638,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768713429431,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713431005,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713431694,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713435586,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713435893,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713436171,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713437326,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713437888,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713437912,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713439855,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713439936,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713440090,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713440327,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713443449,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768713446833,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/schema/documentEngine.test.ts [2m([22m[2m33 tests[22m[2m | [22m[33m33 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should have correct table name
       [2m[90mâ†“[39m[22m should have required columns
       [2m[90mâ†“[39m[22m should have correct table name
       [2m[90mâ†“[39m[22m should have required columns
       [2m[90mâ†“[39m[22m should have correct table name
       [2m[90mâ†“[39m[22m should have required columns
       [2m[90mâ†“[39m[22m should have all expected status values
       [2m[90mâ†“[39m[22m should have all expected file type values
         [2m[90mâ†“[39m[22m should validate valid template data
         [2m[90mâ†“[39m[22m should require projectId, name, fileRef, and type
         [2m[90mâ†“[39m[22m should allow description to be null
         [2m[90mâ†“[39m[22m should validate valid workflow template mapping
         [2m[90mâ†“[39m[22m should require workflowVersionId, templateId, and key
         [2m[90mâ†“[39m[22m should default isPrimary to false
         [2m[90mâ†“[39m[22m should validate template key formats
         [2m[90mâ†“[39m[22m should validate valid run output data
         [2m[90mâ†“[39m[22m should require runId, workflowVersionId, templateKey, fileType, storagePath, and status
         [2m[90mâ†“[39m[22m should validate file type enum
         [2m[90mâ†“[39m[22m should reject invalid file type
         [2m[90mâ†“[39m[22m should validate status enum
         [2m[90mâ†“[39m[22m should reject invalid status
         [2m[90mâ†“[39m[22m should allow error to be null
         [2m[90mâ†“[39m[22m should allow error message for failed outputs
       [2m[90mâ†“[39m[22m should enforce unique key per workflow version
       [2m[90mâ†“[39m[22m should cascade delete workflow templates when workflow version is deleted
       [2m[90mâ†“[39m[22m should cascade delete workflow templates when template is deleted
       [2m[90mâ†“[39m[22m should cascade delete run outputs when run is deleted
       [2m[90mâ†“[39m[22m should cascade delete run outputs when workflow version is deleted
       [2m[90mâ†“[39m[22m should correctly infer Template type
       [2m[90mâ†“[39m[22m should correctly infer WorkflowTemplate type
       [2m[90mâ†“[39m[22m should correctly infer RunOutput type
       [2m[90mâ†“[39m[22m should support multiple templates per workflow version
       [2m[90mâ†“[39m[22m should support multiple outputs per run
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w106_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w106_v3 (Reused: true)

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mğŸ“Š Schema test_schema_w106_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [31mâ¯[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
     [2m[90mâ†“[39m[22m should render database settings page with breadcrumbs
     [2m[90mâ†“[39m[22m should show loading state
     [2m[90mâ†“[39m[22m should show not found state when database does not exist
     [2m[90mâ†“[39m[22m should render DatabaseSettings component with database data
     [2m[90mâ†“[39m[22m should navigate back when back button is clicked
     [2m[90mâ†“[39m[22m should display database name in header
     [2m[90mâ†“[39m[22m should render sidebar
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713731046,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713731047,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w106_v3\",public"}
{"level":30,"time":1768713731047,"env":"test","msg":"DB: Created pool for worker 106, schema=\"test_schema_w106_v3\", max connections=5"}
{"level":30,"time":1768713731075,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [31mâ¯[39m tests/ui/common/Breadcrumbs.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should render all breadcrumb items
     [2m[90mâ†“[39m[22m should render without home when showHome is false
     [2m[90mâ†“[39m[22m should render icons for items that have them
     [2m[90mâ†“[39m[22m should render links for non-last items with href
     [2m[90mâ†“[39m[22m should render last item without link
     [2m[90mâ†“[39m[22m should apply custom className
     [2m[90mâ†“[39m[22m should render chevron separators between items
     [2m[90mâ†“[39m[22m should handle single item
     [2m[90mâ†“[39m[22m should handle empty items array with home
     [2m[90mâ†“[39m[22m should apply font-medium to last item
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w107_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w107_v3 (Reused: true)

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w108_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w108_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mğŸ“Š Schema test_schema_w107_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768713732696,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713732696,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w107_v3\",public"}
{"level":30,"time":1768713732697,"env":"test","msg":"DB: Created pool for worker 107, schema=\"test_schema_w107_v3\", max connections=5"}
{"level":30,"time":1768713732723,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mğŸ“Š Schema test_schema_w108_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

 [31mâ¯[39m tests/unit/shared/validation/Validator.test.ts [2m([22m[2m13 tests[22m[2m | [22m[33m13 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should validate required values
       [2m[90mâ†“[39m[22m should respect custom required message
       [2m[90mâ†“[39m[22m should skip other validation if value is empty and not required
         [2m[90mâ†“[39m[22m should validate minValue
         [2m[90mâ†“[39m[22m should validate maxValue
         [2m[90mâ†“[39m[22m should validate maxDecimalPlaces
         [2m[90mâ†“[39m[22m should validate minLength
         [2m[90mâ†“[39m[22m should validate maxLength
         [2m[90mâ†“[39m[22m should validate email
         [2m[90mâ†“[39m[22m should validate url
         [2m[90mâ†“[39m[22m should validate pattern (regex)
         [2m[90mâ†“[39m[22m should pass if condition evaluates to true
         [2m[90mâ†“[39m[22m should fail if condition evaluates to false
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [31mâ¯[39m tests/unit/client/list-choice-options.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should generate options from a list with label and value paths
       [2m[90mâ†“[39m[22m should use labelTemplate to combine fields
       [2m[90mâ†“[39m[22m should add blank option when configured
       [2m[90mâ†“[39m[22m should filter options before mapping
       [2m[90mâ†“[39m[22m should support multi-condition filters
       [2m[90mâ†“[39m[22m should sort options by a field
       [2m[90mâ†“[39m[22m should support multi-key sorting
       [2m[90mâ†“[39m[22m should limit the number of options
       [2m[90mâ†“[39m[22m should apply offset and limit together
       [2m[90mâ†“[39m[22m should deduplicate options by a field
       [2m[90mâ†“[39m[22m should apply multiple transformations in sequence
       [2m[90mâ†“[39m[22m should handle empty lists gracefully
       [2m[90mâ†“[39m[22m should handle missing fields in rows
       [2m[90mâ†“[39m[22m should work with ListVariable format
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

 [31mâ¯[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m renders column name
     [2m[90mâ†“[39m[22m shows drag handle
     [2m[90mâ†“[39m[22m shows type icon for text columns
     [2m[90mâ†“[39m[22m shows type icon for number columns
     [2m[90mâ†“[39m[22m shows type icon for boolean columns
     [2m[90mâ†“[39m[22m shows type icon for date columns
     [2m[90mâ†“[39m[22m shows primary key badge when column is PK
     [2m[90mâ†“[39m[22m shows required indicator when column is required
     [2m[90mâ†“[39m[22m shows both PK badge and required indicator
     [2m[90mâ†“[39m[22m applies correct CSS classes
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w109_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w109_v3 (Reused: true)

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w110_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w110_v3 (Reused: true)

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mğŸ“Š Schema test_schema_w109_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w111_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w111_v3 (Reused: true)

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mğŸ“Š Schema test_schema_w110_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713737115,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713737116,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w109_v3\",public"}
{"level":30,"time":1768713737116,"env":"test","msg":"DB: Created pool for worker 109, schema=\"test_schema_w109_v3\", max connections=5"}
{"level":30,"time":1768713737149,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/ui/datavault/TemplateCard.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should render template name and description
     [2m[90mâ†“[39m[22m should show "Coming Soon" badge
     [2m[90mâ†“[39m[22m should render preview columns
     [2m[90mâ†“[39m[22m should limit preview columns to 5 and show count for remaining
     [2m[90mâ†“[39m[22m should handle empty preview columns
     [2m[90mâ†“[39m[22m should have cursor-not-allowed style
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mğŸ“Š Schema test_schema_w111_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713737398,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713737398,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w110_v3\",public"}
{"level":30,"time":1768713737398,"env":"test","msg":"DB: Created pool for worker 110, schema=\"test_schema_w110_v3\", max connections=5"}
{"level":30,"time":1768713737436,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713737766,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713737767,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w111_v3\",public"}
{"level":30,"time":1768713737767,"env":"test","msg":"DB: Created pool for worker 111, schema=\"test_schema_w111_v3\", max connections=5"}
{"level":30,"time":1768713737793,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/datavault.routes.test.ts [2m([22m[2m29 tests[22m[2m | [22m[33m29 skipped[39m[2m)[22m[33m 600006[2mms[22m[39m
         [2m[90mâ†“[39m[22m should list all tables for tenant
         [2m[90mâ†“[39m[22m should list tables with stats when requested
         [2m[90mâ†“[39m[22m should create a new table
         [2m[90mâ†“[39m[22m should validate required fields
         [2m[90mâ†“[39m[22m should get a table by ID
         [2m[90mâ†“[39m[22m should return 404 for non-existent table
         [2m[90mâ†“[39m[22m should update a table
         [2m[90mâ†“[39m[22m should delete a table
         [2m[90mâ†“[39m[22m should list all columns for a table
         [2m[90mâ†“[39m[22m should create a new column
         [2m[90mâ†“[39m[22m should validate column type enum
         [2m[90mâ†“[39m[22m should update a column
         [2m[90mâ†“[39m[22m should reject type changes
         [2m[90mâ†“[39m[22m should delete a column
         [2m[90mâ†“[39m[22m should reorder columns
         [2m[90mâ†“[39m[22m should list all rows for a table
         [2m[90mâ†“[39m[22m should support pagination
         [2m[90mâ†“[39m[22m should create a new row
         [2m[90mâ†“[39m[22m should validate required fields
         [2m[90mâ†“[39m[22m should get a row by ID
         [2m[90mâ†“[39m[22m should update a row
         [2m[90mâ†“[39m[22m should delete a row
       [2m[90mâ†“[39m[22m should handle tenant isolation
       [2m[90mâ†“[39m[22m should handle malformed UUIDs
       [2m[90mâ†“[39m[22m should handle database errors gracefully
       [2m[90mâ†“[39m[22m should validate email type values
       [2m[90mâ†“[39m[22m should validate phone type values
       [2m[90mâ†“[39m[22m should coerce number type values
       [2m[90mâ†“[39m[22m should coerce boolean type values
 [31mâ¯[39m tests/unit/captcha.service.test.ts [2m([22m[2m11 tests[22m[2m | [22m[33m11 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should generate a valid simple math challenge
       [2m[90mâ†“[39m[22m should generate unique tokens for each challenge
       [2m[90mâ†“[39m[22m should generate challenges with numbers between 1-20
       [2m[90mâ†“[39m[22m should validate correct answer
       [2m[90mâ†“[39m[22m should reject incorrect answer
       [2m[90mâ†“[39m[22m should reject missing token
       [2m[90mâ†“[39m[22m should reject missing answer
       [2m[90mâ†“[39m[22m should reject invalid token
       [2m[90mâ†“[39m[22m should enforce max attempts (3)
       [2m[90mâ†“[39m[22m should clean up used token after successful validation
       [2m[90mâ†“[39m[22m should return challenge statistics
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w112_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w112_v3 (Reused: true)

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mğŸ“Š Schema test_schema_w112_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w113_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w113_v3 (Reused: true)

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713738888,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713738889,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w112_v3\",public"}
{"level":30,"time":1768713738889,"env":"test","msg":"DB: Created pool for worker 112, schema=\"test_schema_w112_v3\", max connections=5"}
{"level":30,"time":1768713738925,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mğŸ“Š Schema test_schema_w113_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w114_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713739437,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713739437,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w113_v3\",public"}
{"level":30,"time":1768713739438,"env":"test","msg":"DB: Created pool for worker 113, schema=\"test_schema_w113_v3\", max connections=5"}
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w114_v3 (Reused: true)

{"level":30,"time":1768713739465,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/integration/metrics.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should expose /metrics endpoint
     [2m[90mâ†“[39m[22m should protect /metrics if API key is set
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mğŸ“Š Schema test_schema_w114_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768713739903,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713739904,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w114_v3\",public"}
{"level":30,"time":1768713739904,"env":"test","msg":"DB: Created pool for worker 114, schema=\"test_schema_w114_v3\", max connections=5"}
{"level":30,"time":1768713739933,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should identify write block correctly
     [2m[90mâ†“[39m[22m should identify read block correctly
     [2m[90mâ†“[39m[22m should fail if write block has read_table type
     [2m[90mâ†“[39m[22m should have correct config structure for write block
     [2m[90mâ†“[39m[22m should have correct config structure for read block
     [2m[90mâ†“[39m[22m should require columnMappings array
     [2m[90mâ†“[39m[22m should validate required columns are mapped
     [2m[90mâ†“[39m[22m should detect duplicate column mappings
     [2m[90mâ†“[39m[22m should require match strategy for update mode
     [2m[90mâ†“[39m[22m should allow create mode without match strategy
 [31mâ¯[39m tests/unit/services/AIService.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m reviseWorkflow should delegate to revision service
       [2m[90mâ†“[39m[22m generateWorkflow should return a generated workflow
       [2m[90mâ†“[39m[22m suggestWorkflowImprovements should return suggestions
       [2m[90mâ†“[39m[22m suggestTemplateBindings should return bindings
       [2m[90mâ†“[39m[22m suggestValues should return values
       [2m[90mâ†“[39m[22m generateLogic should return logic rules
       [2m[90mâ†“[39m[22m debugLogic should return issues
       [2m[90mâ†“[39m[22m visualizeLogic should return graph data
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [31mâ¯[39m tests/unit/ai.service.test.ts [2m([22m[2m11 tests[22m[2m | [22m[33m11 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should initialize with OpenAI configuration
       [2m[90mâ†“[39m[22m should generate a valid workflow from description
       [2m[90mâ†“[39m[22m should validate unique section IDs
       [2m[90mâ†“[39m[22m should validate unique step IDs
       [2m[90mâ†“[39m[22m should validate logic rules reference existing steps
       [2m[90mâ†“[39m[22m should handle rate limit errors
       [2m[90mâ†“[39m[22m should handle JSON parsing errors
       [2m[90mâ†“[39m[22m should initialize with Anthropic configuration
       [2m[90mâ†“[39m[22m should generate a valid workflow from description
       [2m[90mâ†“[39m[22m should strip markdown code blocks from Anthropic responses
       [2m[90mâ†“[39m[22m should generate binding suggestions
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w115_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w116_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w115_v3 (Reused: true)

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w116_v3 (Reused: true)

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w117_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w117_v3 (Reused: true)

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w118_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w118_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mğŸ“Š Schema test_schema_w115_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mğŸ“Š Schema test_schema_w116_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mğŸ“Š Schema test_schema_w117_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mğŸ“Š Schema test_schema_w118_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713741495,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713741496,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w115_v3\",public"}
{"level":30,"time":1768713741496,"env":"test","msg":"DB: Created pool for worker 115, schema=\"test_schema_w115_v3\", max connections=5"}
{"level":30,"time":1768713741527,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713741531,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713741531,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w116_v3\",public"}
{"level":30,"time":1768713741532,"env":"test","msg":"DB: Created pool for worker 116, schema=\"test_schema_w116_v3\", max connections=5"}
{"level":30,"time":1768713741559,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713741806,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713741806,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w117_v3\",public"}
{"level":30,"time":1768713741806,"env":"test","msg":"DB: Created pool for worker 117, schema=\"test_schema_w117_v3\", max connections=5"}
{"level":30,"time":1768713741835,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768713741878,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713741878,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w118_v3\",public"}
{"level":30,"time":1768713741878,"env":"test","msg":"DB: Created pool for worker 118, schema=\"test_schema_w118_v3\", max connections=5"}
{"level":30,"time":1768713741903,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/client/choice-utils.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 600011[2mms[22m[39m
     [2m[90mâ†“[39m[22m generates options with basic mapping
     [2m[90mâ†“[39m[22m sorts by label asc
     [2m[90mâ†“[39m[22m sorts by label desc
     [2m[90mâ†“[39m[22m dedupes by label
     [2m[90mâ†“[39m[22m dedupes by value (alias)
     [2m[90mâ†“[39m[22m uses label template with column names
     [2m[90mâ†“[39m[22m handles missing content gracefully
     [2m[90mâ†“[39m[22m includes blank option at the top
     [2m[90mâ†“[39m[22m sorts by specific column asc
     [2m[90mâ†“[39m[22m sorts by specific column desc
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w119_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w119_v3 (Reused: true)

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mğŸ“Š Schema test_schema_w119_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768713744993,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713744993,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w119_v3\",public"}
{"level":30,"time":1768713744993,"env":"test","msg":"DB: Created pool for worker 119, schema=\"test_schema_w119_v3\", max connections=5"}
{"level":30,"time":1768713745019,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/engine.run-conditions.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should validate a simple graph
       [2m[90mâ†“[39m[22m should detect duplicate node IDs
       [2m[90mâ†“[39m[22m should detect invalid edge references
       [2m[90mâ†“[39m[22m should validate node conditions
       [2m[90mâ†“[39m[22m should detect typos in variable names
       [2m[90mâ†“[39m[22m should validate compute node expressions
       [2m[90mâ†“[39m[22m should validate branch conditions
       [2m[90mâ†“[39m[22m should validate template bindings
       [2m[90mâ†“[39m[22m should skip question when condition is false
       [2m[90mâ†“[39m[22m should execute question when condition is true
       [2m[90mâ†“[39m[22m should skip compute node when condition is false
       [2m[90mâ†“[39m[22m should execute compute node when condition is true
       [2m[90mâ†“[39m[22m should handle complex workflow with multiple conditions
       [2m[90mâ†“[39m[22m should return trace when debug is enabled
       [2m[90mâ†“[39m[22m should not return trace when debug is disabled
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w120_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w120_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mğŸ“Š Schema test_schema_w120_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768713748391,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768713748392,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w120_v3\",public"}
{"level":30,"time":1768713748392,"env":"test","msg":"DB: Created pool for worker 120, schema=\"test_schema_w120_v3\", max connections=5"}
{"level":30,"time":1768713748417,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768714029771,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714031878,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714035868,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714036186,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714036503,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714037660,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714038213,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714039069,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714040255,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714040275,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714040568,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714040651,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714044211,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714047611,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/WorkflowOptimizationService.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
     [2m[90mâ†“[39m[22m should calculate metrics
     [2m[90mâ†“[39m[22m should detect long pages
     [2m[90mâ†“[39m[22m should auto-fix long pages (simulate split)
     [2m[90mâ†“[39m[22m should detect duplicate questions
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w121_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w121_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mğŸ“Š Schema test_schema_w121_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714331404,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714331405,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w121_v3\",public"}
{"level":30,"time":1768714331405,"env":"test","msg":"DB: Created pool for worker 121, schema=\"test_schema_w121_v3\", max connections=5"}
{"level":30,"time":1768714331432,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/services/CollectionFieldService.test.ts [2m([22m[2m23 tests[22m[2m | [22m[33m23 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create text field with generated slug
       [2m[90mâ†“[39m[22m should create select field with options
       [2m[90mâ†“[39m[22m should throw error if select field missing options
       [2m[90mâ†“[39m[22m should throw error if options is not an array
       [2m[90mâ†“[39m[22m should throw error if options array is empty
       [2m[90mâ†“[39m[22m should create field with default value
       [2m[90mâ†“[39m[22m should throw error if default value type mismatch
       [2m[90mâ†“[39m[22m should ensure unique slug by appending counter
       [2m[90mâ†“[39m[22m should throw error if collection does not exist
       [2m[90mâ†“[39m[22m should return field if it belongs to collection
       [2m[90mâ†“[39m[22m should throw error if field not found
       [2m[90mâ†“[39m[22m should throw error if field belongs to different collection
       [2m[90mâ†“[39m[22m should update field and regenerate slug if name changed
       [2m[90mâ†“[39m[22m should verify field ownership before updating
       [2m[90mâ†“[39m[22m should delete field after verifying ownership
       [2m[90mâ†“[39m[22m should create multiple fields
       [2m[90mâ†“[39m[22m should use underscores instead of dashes for field slugs
       [2m[90mâ†“[39m[22m should validate text default value
       [2m[90mâ†“[39m[22m should validate number default value
       [2m[90mâ†“[39m[22m should validate boolean default value
       [2m[90mâ†“[39m[22m should validate date default value
       [2m[90mâ†“[39m[22m should validate select default value
       [2m[90mâ†“[39m[22m should validate multi_select default value
 [31mâ¯[39m tests/unit/BlockRunner.validate.test.ts [2m([22m[2m7 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should pass if no rules are present
       [2m[90mâ†“[39m[22m should pass on valid comparison
       [2m[90mâ†“[39m[22m should fail on invalid comparison and map alias to ID
       [2m[90mâ†“[39m[22m should compare with variable
       [2m[90mâ†“[39m[22m should enforce requirement if condition met
       [2m[90mâ†“[39m[22m should ignore requirement if condition not met
       [2m[90mâ†“[39m[22m should validate items in list
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w122_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w122_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mğŸ“Š Schema test_schema_w122_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714333526,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714333527,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w122_v3\",public"}
{"level":30,"time":1768714333527,"env":"test","msg":"DB: Created pool for worker 122, schema=\"test_schema_w122_v3\", max connections=5"}
{"level":30,"time":1768714333558,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w123_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w123_v3 (Reused: true)

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mğŸ“Š Schema test_schema_w123_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714334072,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714334073,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w123_v3\",public"}
{"level":30,"time":1768714334073,"env":"test","msg":"DB: Created pool for worker 123, schema=\"test_schema_w123_v3\", max connections=5"}
{"level":30,"time":1768714334102,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/shared/validation/PageValidator.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
     [2m[90mâ†“[39m[22m should return valid if all blocks are valid
     [2m[90mâ†“[39m[22m should aggregate errors from invalid blocks
     [2m[90mâ†“[39m[22m should pass allValues context to validator
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

 [31mâ¯[39m tests/ui/builder.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should add a question node
     [2m[90mâ†“[39m[22m should add a compute node
     [2m[90mâ†“[39m[22m should export graph in correct format
     [2m[90mâ†“[39m[22m should load graph from API format
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [31mâ¯[39m tests/unit/shared/validation/stepConfigSchemas.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return schema for known types
       [2m[90mâ†“[39m[22m should return undefined for unknown types
       [2m[90mâ†“[39m[22m should validate valid config
       [2m[90mâ†“[39m[22m should fail invalid config (missing required fields)
       [2m[90mâ†“[39m[22m should pass through if no schema exists
         [2m[90mâ†“[39m[22m should enforce unique aliases
         [2m[90mâ†“[39m[22m should require at least one option
         [2m[90mâ†“[39m[22m should validate valid options
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w124_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w124_v3 (Reused: true)

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w125_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w125_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mğŸ“Š Schema test_schema_w124_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714337634,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714337635,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w124_v3\",public"}
{"level":30,"time":1768714337635,"env":"test","msg":"DB: Created pool for worker 124, schema=\"test_schema_w124_v3\", max connections=5"}
 [31mâ¯[39m tests/unit/WorkflowChangeAnalyzer.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should classify unused variable deletion as soft breaking (or safe context dependent)
     [2m[90mâ†“[39m[22m should classify used variable deletion as HARD breaking (JS Block)
     [2m[90mâ†“[39m[22m should classify used variable deletion as HARD breaking (Alias reference)
     [2m[90mâ†“[39m[22m should classify new required variable as SOFT breaking
     [2m[90mâ†“[39m[22m should classify type change as HARD breaking
{"level":30,"time":1768714337665,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w126_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w126_v3 (Reused: true)

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mğŸ“Š Schema test_schema_w125_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714337855,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714337855,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w125_v3\",public"}
{"level":30,"time":1768714337856,"env":"test","msg":"DB: Created pool for worker 125, schema=\"test_schema_w125_v3\", max connections=5"}
{"level":30,"time":1768714337885,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mğŸ“Š Schema test_schema_w126_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714338149,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714338150,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w126_v3\",public"}
{"level":30,"time":1768714338150,"env":"test","msg":"DB: Created pool for worker 126, schema=\"test_schema_w126_v3\", max connections=5"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768714338188,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/utils/conditionalLogic-simple.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
     [2m[90mâ†“[39m[22m should run basic tests
     [2m[90mâ†“[39m[22m should handle arrays
     [2m[90mâ†“[39m[22m should handle objects
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w127_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w127_v3 (Reused: true)

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

 [31mâ¯[39m tests/integration/branding.routes.test.ts [2m([22m[2m21 tests[22m[2m | [22m[33m21 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return null branding for new tenant
       [2m[90mâ†“[39m[22m should return existing branding configuration
       [2m[90mâ†“[39m[22m should return 404 for non-existent tenant
       [2m[90mâ†“[39m[22m should require authentication
       [2m[90mâ†“[39m[22m should update tenant branding with valid data
       [2m[90mâ†“[39m[22m should merge partial updates with existing branding
       [2m[90mâ†“[39m[22m should reject invalid color format
       [2m[90mâ†“[39m[22m should reject invalid email address
       [2m[90mâ†“[39m[22m should require tenant:update permission
       [2m[90mâ†“[39m[22m should return empty array for tenant with no domains
       [2m[90mâ†“[39m[22m should return all domains for tenant
       [2m[90mâ†“[39m[22m should require authentication
       [2m[90mâ†“[39m[22m should add a new domain
       [2m[90mâ†“[39m[22m should normalize domain to lowercase
       [2m[90mâ†“[39m[22m should reject duplicate domain
       [2m[90mâ†“[39m[22m should reject invalid domain format
       [2m[90mâ†“[39m[22m should require tenant:update permission
       [2m[90mâ†“[39m[22m should delete a domain
       [2m[90mâ†“[39m[22m should return 404 for non-existent domain
       [2m[90mâ†“[39m[22m should return 403 when trying to delete domain from different tenant
       [2m[90mâ†“[39m[22m should require tenant:update permission
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mğŸ“Š Schema test_schema_w127_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714339338,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714339338,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w127_v3\",public"}
{"level":30,"time":1768714339338,"env":"test","msg":"DB: Created pool for worker 127, schema=\"test_schema_w127_v3\", max connections=5"}
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w128_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":30,"time":1768714339367,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w128_v3 (Reused: true)

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mğŸ“Š Schema test_schema_w128_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714339810,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714339810,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w128_v3\",public"}
{"level":30,"time":1768714339811,"env":"test","msg":"DB: Created pool for worker 128, schema=\"test_schema_w128_v3\", max connections=5"}
{"level":30,"time":1768714339839,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

 [31mâ¯[39m tests/unit/services/RunExecutionCoordinator.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should execute JS questions using ScriptEngine
     [2m[90mâ†“[39m[22m should handle ScriptEngine errors gracefully
 [31mâ¯[39m tests/unit/engine/Performance.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should cache query results based on inputs
       [2m[90mâ†“[39m[22m should invalidate cache when filters change
       [2m[90mâ†“[39m[22m should prevent double execution in same run
 [31mâ¯[39m tests/unit/isolatedVmBridge.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should execute JS and use simple helpers (string)
     [2m[90mâ†“[39m[22m should execute JS and use complex helpers (math.sum)
     [2m[90mâ†“[39m[22m should execute JS and capture console logs
     [2m[90mâ†“[39m[22m should access context data
     [2m[90mâ†“[39m[22m should fail on missing helper
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

 [31mâ¯[39m tests/unit/workflow/QueryBlock.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should create instances from ListVariable
     [2m[90mâ†“[39m[22m should respect maxInstances with list
     [2m[90mâ†“[39m[22m should handle empty list
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w130_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w131_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w130_v3 (Reused: true)

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w131_v3 (Reused: true)

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w129_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w129_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w132_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w133_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w132_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w133_v3 (Reused: true)

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mğŸ“Š Schema test_schema_w130_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714341994,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714341994,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w130_v3\",public"}
{"level":30,"time":1768714341994,"env":"test","msg":"DB: Created pool for worker 130, schema=\"test_schema_w130_v3\", max connections=5"}
{"level":30,"time":1768714342021,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mğŸ“Š Schema test_schema_w131_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714342033,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714342034,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w131_v3\",public"}
{"level":30,"time":1768714342034,"env":"test","msg":"DB: Created pool for worker 131, schema=\"test_schema_w131_v3\", max connections=5"}
{"level":30,"time":1768714342059,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mğŸ“Š Schema test_schema_w129_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714342124,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714342124,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w129_v3\",public"}
{"level":30,"time":1768714342124,"env":"test","msg":"DB: Created pool for worker 129, schema=\"test_schema_w129_v3\", max connections=5"}
{"level":30,"time":1768714342158,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mğŸ“Š Schema test_schema_w132_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714342333,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714342334,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w132_v3\",public"}
{"level":30,"time":1768714342334,"env":"test","msg":"DB: Created pool for worker 132, schema=\"test_schema_w132_v3\", max connections=5"}
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mğŸ“Š Schema test_schema_w133_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714342339,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714342339,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w133_v3\",public"}
{"level":30,"time":1768714342339,"env":"test","msg":"DB: Created pool for worker 133, schema=\"test_schema_w133_v3\", max connections=5"}
{"level":30,"time":1768714342367,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768714342368,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/ListTools.test.ts [2m([22m[2m18 tests[22m[2m | [22m[33m18 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should filter rows by equals condition
       [2m[90mâ†“[39m[22m should filter with greater_than operator
       [2m[90mâ†“[39m[22m should filter with AND combinator
       [2m[90mâ†“[39m[22m should filter with OR combinator
       [2m[90mâ†“[39m[22m should sort by single key ascending
       [2m[90mâ†“[39m[22m should sort by single key descending
       [2m[90mâ†“[39m[22m should sort by multiple keys
       [2m[90mâ†“[39m[22m should apply limit
       [2m[90mâ†“[39m[22m should apply offset
       [2m[90mâ†“[39m[22m should apply offset and limit together
       [2m[90mâ†“[39m[22m should select specific columns
       [2m[90mâ†“[39m[22m should deduplicate by field
       [2m[90mâ†“[39m[22m should output count variable
       [2m[90mâ†“[39m[22m should output first row variable
       [2m[90mâ†“[39m[22m should apply all operations in sequence
       [2m[90mâ†“[39m[22m should handle empty input list
       [2m[90mâ†“[39m[22m should handle missing source list
       [2m[90mâ†“[39m[22m should handle plain arrays
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w134_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w134_v3 (Reused: true)

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mğŸ“Š Schema test_schema_w134_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714346146,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714346146,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w134_v3\",public"}
{"level":30,"time":1768714346146,"env":"test","msg":"DB: Created pool for worker 134, schema=\"test_schema_w134_v3\", max connections=5"}
{"level":30,"time":1768714346175,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/services/RecordService.test.ts [2m([22m[2m17 tests[22m[2m | [22m[33m17 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create record with valid data
       [2m[90mâ†“[39m[22m should throw error if required field is missing
       [2m[90mâ†“[39m[22m should apply default values to missing fields
       [2m[90mâ†“[39m[22m should throw error for unknown field
       [2m[90mâ†“[39m[22m should validate field type (text)
       [2m[90mâ†“[39m[22m should validate field type (number)
       [2m[90mâ†“[39m[22m should validate select field options
       [2m[90mâ†“[39m[22m should validate multi-select field options
       [2m[90mâ†“[39m[22m should allow null for non-required fields
       [2m[90mâ†“[39m[22m should return record if tenant owns it
       [2m[90mâ†“[39m[22m should throw error if record not found
       [2m[90mâ†“[39m[22m should throw error if tenant does not own record
       [2m[90mâ†“[39m[22m should update record with valid data
       [2m[90mâ†“[39m[22m should merge updates with existing data
       [2m[90mâ†“[39m[22m should list records in collection with pagination
       [2m[90mâ†“[39m[22m should throw error if collection does not belong to tenant
       [2m[90mâ†“[39m[22m should create multiple records
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w135_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w135_v3 (Reused: true)

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mğŸ“Š Schema test_schema_w135_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714349109,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714349110,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w135_v3\",public"}
{"level":30,"time":1768714349110,"env":"test","msg":"DB: Created pool for worker 135, schema=\"test_schema_w135_v3\", max connections=5"}
{"level":30,"time":1768714349142,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768714630540,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714632753,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714633285,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714636827,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714637048,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714637337,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714638533,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714638993,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714641201,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714641229,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714641306,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714641516,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714641547,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714645347,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714648331,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/services/DatavaultColumnsService.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should get all columns for a table
       [2m[90mâ†“[39m[22m should throw 404 if table not found
       [2m[90mâ†“[39m[22m should create column with generated slug
       [2m[90mâ†“[39m[22m should ensure unique slug by appending counter
       [2m[90mâ†“[39m[22m should use provided slug if given
       [2m[90mâ†“[39m[22m should update column
       [2m[90mâ†“[39m[22m should throw error if trying to change column type
       [2m[90mâ†“[39m[22m should delete column
       [2m[90mâ†“[39m[22m should reorder columns
       [2m[90mâ†“[39m[22m should create select column with valid options
       [2m[90mâ†“[39m[22m should create multiselect column with valid options
       [2m[90mâ†“[39m[22m should reject select column without options
       [2m[90mâ†“[39m[22m should reject options with duplicate values
       [2m[90mâ†“[39m[22m should reject options without label or value
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w136_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w136_v3 (Reused: true)

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mğŸ“Š Schema test_schema_w136_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714932307,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714932308,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w136_v3\",public"}
{"level":30,"time":1768714932308,"env":"test","msg":"DB: Created pool for worker 136, schema=\"test_schema_w136_v3\", max connections=5"}
{"level":30,"time":1768714932335,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/services/CollectionService.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create collection with generated slug
       [2m[90mâ†“[39m[22m should ensure unique slug by appending counter
       [2m[90mâ†“[39m[22m should use provided slug if unique
       [2m[90mâ†“[39m[22m should return collection if tenant owns it
       [2m[90mâ†“[39m[22m should throw error if collection not found
       [2m[90mâ†“[39m[22m should throw error if tenant does not own collection
       [2m[90mâ†“[39m[22m should return collection with fields
       [2m[90mâ†“[39m[22m should return collections with field and record counts
       [2m[90mâ†“[39m[22m should update collection and regenerate slug if name changed
       [2m[90mâ†“[39m[22m should verify tenant ownership before updating
       [2m[90mâ†“[39m[22m should delete collection after verifying ownership
       [2m[90mâ†“[39m[22m should throw error if tenant does not own collection
       [2m[90mâ†“[39m[22m should generate valid slug from name with special characters
       [2m[90mâ†“[39m[22m should trim whitespace and convert to lowercase
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

 [31mâ¯[39m tests/integration/datavault.api-tokens.test.ts [2m([22m[2m16 tests[22m[2m | [22m[33m16 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new token and return plain token once
       [2m[90mâ†“[39m[22m should create a token with expiration date
       [2m[90mâ†“[39m[22m should reject token creation with invalid scopes
       [2m[90mâ†“[39m[22m should reject token creation with empty label
       [2m[90mâ†“[39m[22m should reject token creation with past expiration date
       [2m[90mâ†“[39m[22m should list all tokens for a database without exposing hashes
       [2m[90mâ†“[39m[22m should return empty array for database with no tokens
       [2m[90mâ†“[39m[22m should revoke a token
       [2m[90mâ†“[39m[22m should reject revoking token without database ID
       [2m[90mâ†“[39m[22m should prevent cross-tenant token access
       [2m[90mâ†“[39m[22m should authenticate valid token
       [2m[90mâ†“[39m[22m should reject expired token
       [2m[90mâ†“[39m[22m should reject invalid token
       [2m[90mâ†“[39m[22m should allow read access with read scope
       [2m[90mâ†“[39m[22m should deny write access with read-only scope
       [2m[90mâ†“[39m[22m should allow write access with write scope
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w138_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w138_v3 (Reused: true)

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mğŸ“Š Schema test_schema_w138_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714936083,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714936084,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w138_v3\",public"}
{"level":30,"time":1768714936084,"env":"test","msg":"DB: Created pool for worker 138, schema=\"test_schema_w138_v3\", max connections=5"}
{"level":30,"time":1768714936109,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768714936115,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/unit/services/DocumentTemplateService.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new DOCX template successfully
       [2m[90mâ†“[39m[22m should throw error if template name already exists
       [2m[90mâ†“[39m[22m should throw error for invalid DOCX file type
       [2m[90mâ†“[39m[22m should delete uploaded file if database insert fails
       [2m[90mâ†“[39m[22m should retrieve template by ID
       [2m[90mâ†“[39m[22m should throw error if template not found
       [2m[90mâ†“[39m[22m should throw error if template file missing from storage
       [2m[90mâ†“[39m[22m should list all templates for a project
       [2m[90mâ†“[39m[22m should update template name and description
       [2m[90mâ†“[39m[22m should throw error if new name already exists
       [2m[90mâ†“[39m[22m should delete template and associated file
       [2m[90mâ†“[39m[22m should throw error if template not found
       [2m[90mâ†“[39m[22m should replace template file
       [2m[90mâ†“[39m[22m should rollback new file if update fails
 [31mâ¯[39m tests/services/BrandingService.test.ts [2m([22m[2m16 tests[22m[2m | [22m[33m16 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return branding for a tenant
       [2m[90mâ†“[39m[22m should return null for non-existent tenant
       [2m[90mâ†“[39m[22m should update tenant branding
       [2m[90mâ†“[39m[22m should merge partial branding with existing branding
       [2m[90mâ†“[39m[22m should return tenant and branding for a valid domain
       [2m[90mâ†“[39m[22m should return null for non-existent domain
       [2m[90mâ†“[39m[22m should return all domains for a tenant
       [2m[90mâ†“[39m[22m should return empty array for tenant with no domains
       [2m[90mâ†“[39m[22m should add a new domain to a tenant
       [2m[90mâ†“[39m[22m should normalize domain to lowercase
       [2m[90mâ†“[39m[22m should throw error for duplicate domain
       [2m[90mâ†“[39m[22m should remove a domain from a tenant
       [2m[90mâ†“[39m[22m should return false for non-existent domain
       [2m[90mâ†“[39m[22m should throw error when domain does not belong to tenant
       [2m[90mâ†“[39m[22m should return true for available domain
       [2m[90mâ†“[39m[22m should return false for taken domain
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [31mâ¯[39m tests/unit/repositories/DocumentTemplateRepository.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should find templates by project ID
       [2m[90mâ†“[39m[22m should return empty array when no templates found
       [2m[90mâ†“[39m[22m should find templates by type
       [2m[90mâ†“[39m[22m should find template by ID and project ID
       [2m[90mâ†“[39m[22m should return undefined when template not found
       [2m[90mâ†“[39m[22m should update template name and description
       [2m[90mâ†“[39m[22m should return undefined when template not found
       [2m[90mâ†“[39m[22m should update template file reference
       [2m[90mâ†“[39m[22m should delete template and return true
       [2m[90mâ†“[39m[22m should return false when template not found
       [2m[90mâ†“[39m[22m should return true when template name exists
       [2m[90mâ†“[39m[22m should return false when template name does not exist
       [2m[90mâ†“[39m[22m should exclude specific template ID when checking existence
       [2m[90mâ†“[39m[22m should create a new template
       [2m[90mâ†“[39m[22m should find template by ID
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w137_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w137_v3 (Reused: true)

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mğŸ“Š Schema test_schema_w137_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714938229,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714938230,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w137_v3\",public"}
{"level":30,"time":1768714938230,"env":"test","msg":"DB: Created pool for worker 137, schema=\"test_schema_w137_v3\", max connections=5"}
{"level":30,"time":1768714938270,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w139_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w139_v3 (Reused: true)

 [31mâ¯[39m tests/unit/services/StepService.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a step with auto-incrementing order
       [2m[90mâ†“[39m[22m should create step with order 1 if section is empty
       [2m[90mâ†“[39m[22m should validate alias uniqueness before creating
       [2m[90mâ†“[39m[22m should allow creating step with null alias
       [2m[90mâ†“[39m[22m should throw error if section not found
       [2m[90mâ†“[39m[22m should verify workflow ownership
       [2m[90mâ†“[39m[22m should update step successfully
       [2m[90mâ†“[39m[22m should validate alias uniqueness when updating alias
       [2m[90mâ†“[39m[22m should allow updating step without changing alias
       [2m[90mâ†“[39m[22m should throw error if step not found
       [2m[90mâ†“[39m[22m should throw error if step does not belong to workflow
       [2m[90mâ†“[39m[22m should delete step successfully
       [2m[90mâ†“[39m[22m should throw error if step not found
       [2m[90mâ†“[39m[22m should throw error if step does not belong to workflow
[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w141_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w141_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mğŸ“Š Schema test_schema_w139_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714938934,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714938934,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w139_v3\",public"}
{"level":30,"time":1768714938934,"env":"test","msg":"DB: Created pool for worker 139, schema=\"test_schema_w139_v3\", max connections=5"}
{"level":30,"time":1768714938961,"env":"test","msg":"DB: initialized flag set."}
 [31mâ¯[39m tests/services/EmailTemplateMetadataService.test.ts [2m([22m[2m13 tests[22m[2m | [22m[33m13 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return all email template metadata
       [2m[90mâ†“[39m[22m should return template for valid ID
       [2m[90mâ†“[39m[22m should return null for non-existent template
       [2m[90mâ†“[39m[22m should return template for valid key
       [2m[90mâ†“[39m[22m should return null for non-existent key
       [2m[90mâ†“[39m[22m should update template metadata
       [2m[90mâ†“[39m[22m should throw error for non-existent template
       [2m[90mâ†“[39m[22m should create new template metadata
       [2m[90mâ†“[39m[22m should throw error for duplicate template key
       [2m[90mâ†“[39m[22m should delete template metadata
       [2m[90mâ†“[39m[22m should return false for non-existent template
       [2m[90mâ†“[39m[22m should return templates with specific branding token
       [2m[90mâ†“[39m[22m should return empty array when no templates have the token
[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mğŸ“Š Schema test_schema_w141_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w140_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w142_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w140_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w142_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mğŸ“Š Schema test_schema_w140_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

{"level":30,"time":1768714939683,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768714939683,"env":"test","msg":"PG: Patched Pool.prototype.connect to enforce search_path=\"test_schema_w140_v3\",public"}
{"level":30,"time":1768714939683,"env":"test","msg":"DB: Created pool for worker 140, schema=\"test_schema_w140_v3\", max connections=5"}
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mğŸ“Š Schema test_schema_w142_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":30,"time":1768714939717,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w143_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w143_v3 (Reused: true)

 [32mâœ“[39m tests/unit/services/MfaService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 1887[2mms[22m[39m
{"level":30,"time":1768714940208,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/WorkflowService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1348[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return workflow if user is the creator [33m 508[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mğŸ“Š Schema test_schema_w143_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/PortalAuthService.test.ts [2m([22m[2m42 tests[22m[2m)[22m[33m 913[2mms[22m[39m
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

 [31mâ¯[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts [2m([22m[2m13 tests[22m[2m | [22m[33m13 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should find columns by table ID in order
       [2m[90mâ†“[39m[22m should return empty array if no columns found
       [2m[90mâ†“[39m[22m should find column by ID
       [2m[90mâ†“[39m[22m should return undefined if column not found
       [2m[90mâ†“[39m[22m should return true if slug exists
       [2m[90mâ†“[39m[22m should return false if slug does not exist
       [2m[90mâ†“[39m[22m should exclude specific column ID when checking slug
       [2m[90mâ†“[39m[22m should create a new column
       [2m[90mâ†“[39m[22m should update an existing column
       [2m[90mâ†“[39m[22m should delete a column
       [2m[90mâ†“[39m[22m should update order indices for multiple columns
       [2m[90mâ†“[39m[22m should return max order index
       [2m[90mâ†“[39m[22m should return 0 if no columns exist
 [31mâ¯[39m tests/unit/repositories/DatavaultTablesRepository.test.ts [2m([22m[2m12 tests[22m[2m | [22m[33m12 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
       [2m[90mâ†“[39m[22m should find tables by tenant ID
       [2m[90mâ†“[39m[22m should return empty array if no tables found
       [2m[90mâ†“[39m[22m should find table by ID
       [2m[90mâ†“[39m[22m should return undefined if table not found
       [2m[90mâ†“[39m[22m should return true if slug exists
       [2m[90mâ†“[39m[22m should return false if slug does not exist
       [2m[90mâ†“[39m[22m should exclude specific table ID when checking slug
       [2m[90mâ†“[39m[22m should create a new table
       [2m[90mâ†“[39m[22m should update an existing table
       [2m[90mâ†“[39m[22m should delete a table
       [2m[90mâ†“[39m[22m should count tables by tenant ID
       [2m[90mâ†“[39m[22m should return 0 if no tables found
 [31mâ¯[39m tests/integration/datavault.row-notes.test.ts [2m([22m[2m12 tests[22m[2m | [22m[33m12 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new note
       [2m[90mâ†“[39m[22m should sanitize HTML from note text
       [2m[90mâ†“[39m[22m should reject empty note text
       [2m[90mâ†“[39m[22m should reject note for row from different tenant
       [2m[90mâ†“[39m[22m should fetch notes for a row ordered by newest first
       [2m[90mâ†“[39m[22m should return empty array for row with no notes
       [2m[90mâ†“[39m[22m should reject access to notes for row from different tenant
       [2m[90mâ†“[39m[22m should allow note owner to delete their note
       [2m[90mâ†“[39m[22m should allow table owner to delete any note
       [2m[90mâ†“[39m[22m should prevent non-owner from deleting note
       [2m[90mâ†“[39m[22m should return 404 for non-existent note
       [2m[90mâ†“[39m[22m should prevent accessing notes from different tenant
[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w144_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w144_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w145_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w145_v3 (Reused: true)

 [31mâ¯[39m tests/unit/services/DatavaultTablesService.test.ts [2m([22m[2m12 tests[22m[2m | [22m[33m12 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should get all tables for a tenant
       [2m[90mâ†“[39m[22m should get tables with stats
       [2m[90mâ†“[39m[22m should get a table by ID
       [2m[90mâ†“[39m[22m should throw 404 if table not found
       [2m[90mâ†“[39m[22m should throw 403 if table belongs to different tenant
       [2m[90mâ†“[39m[22m should create table with generated slug
       [2m[90mâ†“[39m[22m should ensure unique slug by appending counter
       [2m[90mâ†“[39m[22m should use provided slug if given
       [2m[90mâ†“[39m[22m should update table
       [2m[90mâ†“[39m[22m should throw 404 if table not found
       [2m[90mâ†“[39m[22m should delete table
       [2m[90mâ†“[39m[22m should throw 404 if table not found
 [31mâ¯[39m tests/unit/services/DataSourceService.test.ts [2m([22m[2m9 tests[22m[2m | [22m[33m9 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return data sources for tenant
       [2m[90mâ†“[39m[22m should return null if not found
       [2m[90mâ†“[39m[22m should return null if tenant mismatch
       [2m[90mâ†“[39m[22m should return source if valid
       [2m[90mâ†“[39m[22m should create data source
       [2m[90mâ†“[39m[22m should throw if not exists
       [2m[90mâ†“[39m[22m should update if exists
       [2m[90mâ†“[39m[22m should throw if source not found
       [2m[90mâ†“[39m[22m should link if source exists
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mğŸ“Š Schema test_schema_w144_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/unit/services/AuditLogService.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 838[2mms[22m[39m
[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mğŸ“Š Schema test_schema_w145_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/unit/services/BrandingService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 867[2mms[22m[39m
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w146_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w147_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w146_v3 (Reused: true)

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w147_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mğŸ“Š Schema test_schema_w146_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/EmailTemplateMetadataService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 857[2mms[22m[39m
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mğŸ“Š Schema test_schema_w147_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w149_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstderr[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâš ï¸ Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "closeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:177:34
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

{"level":30,"time":1768714942541,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768714942549,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714942549,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1768714942551,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768714942552,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1768714942553,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
 [32mâœ“[39m tests/unit/writes/WriteRunner.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 876[2mms[22m[39m
[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w149_v3 (Reused: true)

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w153_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w148_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w153_v3 (Reused: true)

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w148_v3 (Reused: true)

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mğŸ“Š Schema test_schema_w149_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/Guardrail.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 870[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w150_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w150_v3 (Reused: true)

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mğŸ“Š Schema test_schema_w153_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":30,"time":1768714943250,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768714943255,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
 [32mâœ“[39m tests/unit/external/ExternalSendRunner.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 832[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mğŸ“Š Schema test_schema_w148_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w151_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w151_v3 (Reused: true)

 [32mâœ“[39m tests/unit/services/DatavaultRowsService.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 881[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w152_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w152_v3 (Reused: true)

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mğŸ“Š Schema test_schema_w150_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/DatavaultReferenceColumns.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 851[2mms[22m[39m
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mğŸ“Š Schema test_schema_w151_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":40,"time":1768714943774,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":50,"time":1768714943776,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1768714943778,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768714943783,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1768714943785,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mğŸ“Š Schema test_schema_w152_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/LifecycleHookService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 867[2mms[22m[39m
 [32mâœ“[39m tests/unit/services/AccountLockoutService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 836[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w155_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w154_v3
[SchemaManager] Processing URL: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech (Port: )
[SchemaManager] Removing -pooler from hostname: ep-gentle-leaf-ahsz38kq-pooler.c-3.us-east-1.aws.neon.tech
[SchemaManager] Switched to Direct Connection for schema isolation.
[SchemaManager] Final Connection String (Host): ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech
[SchemaManager] Final Connection String (Options): null

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w155_v3 (Reused: true)

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mğŸ”’ Test Schema Isolated: test_schema_w154_v3 (Reused: true)

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ğŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

 [2m[90mâ†“[39m[22m tests/unit/collab.server.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m
[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mğŸ“Š Schema test_schema_w155_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/engine/FinalBlockSnapshot.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 797[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mğŸ“Š Schema test_schema_w154_v3 has 110 tables - skipping migrations
[SETUP] DATABASE_URL sent to db module: postgresql://neondb_owner:npg_LYP2cC3DhGsx@ep-gentle-leaf-ahsz38kq.c-3.us-east-1.aws.neon.tech/neondb?sslmode=require

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/repositories/DatavaultRowsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 814[2mms[22m[39m
 [31mâ¯[39m tests/unit/api.ai.logic.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should return generated logic
       [2m[90mâ†“[39m[22m should return debug issues
       [2m[90mâ†“[39m[22m should return graph data
 [31mâ¯[39m tests/unit/lib/queries/QueryRunner.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 600008[2mms[22m[39m
     [2m[90mâ†“[39m[22m should throw if tableId is missing
     [2m[90mâ†“[39m[22m should execute basic query and return ListVariable
     [2m[90mâ†“[39m[22m should resolve variable filters
     [2m[90mâ†“[39m[22m should throw for missing variables
     [2m[90mâ†“[39m[22m should apply limit
{"level":30,"time":1768715231470,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768715235288,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768715237438,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768715238120,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

{"level":30,"time":1768715238869,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mğŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/api.ai.revise.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
       [2m[90mâ†“[39m[22m should enqueue revision job and return 202
       [2m[90mâ†“[39m[22m should return 400 for invalid request usage
 [31mâ¯[39m tests/unit/workflow/PreviewExecution.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 600010[2mms[22m[39m
     [2m[90mâ†“[39m[22m Preview mode should not call database write methods
     [2m[90mâ†“[39m[22m Live mode SHOULD call database write methods
     [2m[90mâ†“[39m[22m Query node in preview should see shadow writes
 [31mâ¯[39m tests/integration/api.ai.doc.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
       [2m[90mâ†“[39m[22m should analyze a DOCX file and return variables
       [2m[90mâ†“[39m[22m should fail if no file is provided
       [2m[90mâ†“[39m[22m should suggest mappings between template and workflow variables
       [2m[90mâ†“[39m[22m should return improvement suggestions
 [31mâ¯[39m tests/unit/debug_import.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 600007[2mms[22m[39m
     [2m[90mâ†“[39m[22m should find module
 [31mâ¯[39m tests/unit/debugging/Lineage.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 600009[2mms[22m[39m
     [2m[90mâ†“[39m[22m should generate execution trace with lineage
     [2m[90mâ†“[39m[22m should track skipped blocks in trace
Failed to parse file:///C:/Users/scoot/poll/VaultLogic/client/src/components/builder/cards/ChoiceCardEditor.tsx. Excluding it from coverage.
 Error [RollupError]: Expected ',', got 'UniversalBlock'
    at getRollupError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/rollup/dist/es/shared/parseAst.js:401:41)
    at convertProgram (file:///C:/Users/scoot/poll/VaultLogic/node_modules/rollup/dist/es/shared/parseAst.js:1098:26)
    at parseAstAsync (file:///C:/Users/scoot/poll/VaultLogic/node_modules/rollup/dist/es/shared/parseAst.js:2084:106)
    at V8CoverageProvider.remapCoverage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/coverage-v8/dist/provider.js:135:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/coverage-v8/dist/provider.js:121:23
    at async Promise.all (index 7)
    at V8CoverageProvider.getCoverageMapForUncoveredFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/coverage-v8/dist/provider.js:111:4)
    at V8CoverageProvider.generateCoverage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/coverage-v8/dist/provider.js:59:29)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/cli-api.BKg19Fvw.js:12546:23
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/cli-api.BKg19Fvw.js:12559:11 {
  code: 'PARSE_ERROR',
  pos: 1537
}

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 140 [49m[22m[31mâ¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m [ tests/ListTools.test.ts ][22m
[41m[1m FAIL [22m[49m tests/services/BrandingService.test.ts[2m [ tests/services/BrandingService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/services/EmailTemplateMetadataService.test.ts[2m [ tests/services/EmailTemplateMetadataService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/analytics_preservation.test.ts[2m [ tests/integration/analytics_preservation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/analytics_service.test.ts[2m [ tests/integration/analytics_service.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api-docs.test.ts[2m [ tests/integration/api-docs.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.ai.doc.test.ts[2m [ tests/integration/api.ai.doc.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.ai.personalization.test.ts[2m [ tests/integration/api.ai.personalization.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.ai.test.ts[2m [ tests/integration/api.ai.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.dataSources.native.test.ts[2m [ tests/integration/api.dataSources.native.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.expression-validation.test.ts[2m [ tests/integration/api.expression-validation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.projects.test.ts[2m [ tests/integration/api.projects.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.runs.docx.test.ts[2m [ tests/integration/api.runs.docx.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.runs.graph.test.ts[2m [ tests/integration/api.runs.graph.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.snapshots.test.ts[2m [ tests/integration/api.snapshots.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.templates-runs.test.ts[2m [ tests/integration/api.templates-runs.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m [ tests/integration/api.workflows.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m [ tests/integration/auth.flows.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth.routes.real.test.ts[2m [ tests/integration/auth.routes.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth.routes.test.ts[2m [ tests/integration/auth.routes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/branding.routes.test.ts[2m [ tests/integration/branding.routes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/collections.e2e.test.ts[2m [ tests/integration/collections.e2e.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/dataBlocks.test.ts[2m [ tests/integration/dataBlocks.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m [ tests/integration/datavault-v4-regression.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.api-tokens.test.ts[2m [ tests/integration/datavault.api-tokens.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.autonumber.test.ts[2m [ tests/integration/datavault.autonumber.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m [ tests/integration/datavault.permissions.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.routes.test.ts[2m [ tests/integration/datavault.routes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.row-notes.test.ts[2m [ tests/integration/datavault.row-notes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/dynamic_options_workflow.test.ts[2m [ tests/integration/dynamic_options_workflow.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/externalSends.test.ts[2m [ tests/integration/externalSends.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/intake.portal.test.ts[2m [ tests/integration/intake.portal.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/intake.workflow.test.ts[2m [ tests/integration/intake.workflow.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/js_helpers.test.ts[2m [ tests/integration/js_helpers.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/lifecycle-hooks-execution.test.ts[2m [ tests/integration/lifecycle-hooks-execution.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/metrics.test.ts[2m [ tests/integration/metrics.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m [ tests/integration/mfa.flow.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/mfa.flow.test.ts[2m [ tests/integration/mfa.flow.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/organizationInvites.test.ts[2m [ tests/integration/organizationInvites.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/organizations-audit-fixes.test.ts[2m [ tests/integration/organizations-audit-fixes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/organizations-workflow.test.ts[2m [ tests/integration/organizations-workflow.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/organizationService.test.ts[2m [ tests/integration/organizationService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/ownershipAccess.test.ts[2m [ tests/integration/ownershipAccess.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/regression-REG-1.test.ts[2m [ tests/integration/regression-REG-1.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m [ tests/integration/session.management.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/session.management.test.ts[2m [ tests/integration/session.management.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/transferOwnership.test.ts[2m [ tests/integration/transferOwnership.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m [ tests/integration/trusted.devices.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/variableSafety.test.ts[2m [ tests/integration/variableSafety.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/workflow_versioning.test.ts[2m [ tests/integration/workflow_versioning.test.ts ][22m
[41m[1m FAIL [22m[49m tests/ui/builder.test.ts[2m [ tests/ui/builder.test.ts ][22m
[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m [ tests/ui/expression-editor.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m [ tests/ui/runs.components.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m [ tests/unit/ai.service.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/api.ai.logic.test.ts[2m [ tests/unit/api.ai.logic.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/api.ai.revise.test.ts[2m [ tests/unit/api.ai.revise.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/BlockRunner.validate.test.ts[2m [ tests/unit/BlockRunner.validate.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/captcha.service.test.ts[2m [ tests/unit/captcha.service.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/collab.client.test.tsx[2m [ tests/unit/collab.client.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/debug_import.test.ts[2m [ tests/unit/debug_import.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m [ tests/unit/docxRenderer.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/engine.expr.test.ts[2m [ tests/unit/engine.expr.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/engine.run-conditions.test.ts[2m [ tests/unit/engine.run-conditions.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/HelperLibrary.test.ts[2m [ tests/unit/HelperLibrary.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/isolatedVmBridge.test.ts[2m [ tests/unit/isolatedVmBridge.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/listPipeline.semantics.test.ts[2m [ tests/unit/listPipeline.semantics.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/ScriptEngine.test.ts[2m [ tests/unit/ScriptEngine.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/WorkflowChangeAnalyzer.test.ts[2m [ tests/unit/WorkflowChangeAnalyzer.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/WorkflowOptimizationService.test.ts[2m [ tests/unit/WorkflowOptimizationService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/ai/workflowEdit.test.ts[2m [ tests/integration/ai/workflowEdit.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m [ tests/integration/auth/auth.middleware.integration.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m [ tests/integration/auth/jwt.authentication.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.callback.test.ts[2m [ tests/integration/auth/oauth2.callback.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.client-credentials.test.ts[2m [ tests/integration/auth/oauth2.client-credentials.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.google.test.ts[2m [ tests/integration/auth/oauth2.google.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m [ tests/integration/auth/oauth2.sessions.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m [ tests/integration/auth/oauth2.token-refresh.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m [ tests/integration/auth/protected.routes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m [ tests/integration/auth/session.management.integration.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/conditions/conditionEvaluation.test.ts[2m [ tests/integration/conditions/conditionEvaluation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/workflows/runtime-pipelines.test.ts[2m [ tests/integration/workflows/runtime-pipelines.test.ts ][22m
[41m[1m FAIL [22m[49m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m [ tests/ui/blocks/SendDataBlockEditorRouting.test.ts ][22m
[41m[1m FAIL [22m[49m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m [ tests/ui/blocks/SendDataToTableBlockEditor.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m [ tests/ui/common/Breadcrumbs.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m [ tests/ui/datavault/ColumnTypeIcon.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m [ tests/ui/datavault/DatabaseSettingsPage.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m [ tests/ui/datavault/EditableCell.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m [ tests/ui/datavault/TableCard.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/TemplateCard.test.tsx[2m [ tests/ui/datavault/TemplateCard.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/client/choice-utils.test.ts[2m [ tests/unit/client/choice-utils.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/client/list-choice-options.test.ts[2m [ tests/unit/client/list-choice-options.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/debugging/Lineage.test.ts[2m [ tests/unit/debugging/Lineage.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/engine/Performance.test.ts[2m [ tests/unit/engine/Performance.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/engine/templateNode.test.ts[2m [ tests/unit/engine/templateNode.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m [ tests/unit/repositories/DatavaultColumnsRepository.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m [ tests/unit/repositories/DatavaultTablesRepository.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m [ tests/unit/repositories/DocumentTemplateRepository.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m [ tests/unit/repositories/WorkflowTemplateRepository.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/middleware/auth.middleware.test.ts[2m [ tests/unit/middleware/auth.middleware.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/middleware/rbac.test.ts[2m [ tests/unit/middleware/rbac.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/schema/collections.test.ts[2m [ tests/unit/schema/collections.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/schema/documentEngine.test.ts[2m [ tests/unit/schema/documentEngine.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/conditionEvaluator.test.ts[2m [ tests/unit/shared/conditionEvaluator.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/workflowLogic.test.ts[2m [ tests/unit/shared/workflowLogic.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/AIService.test.ts[2m [ tests/unit/services/AIService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/CollectionFieldService.test.ts[2m [ tests/unit/services/CollectionFieldService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/CollectionService.test.ts[2m [ tests/unit/services/CollectionService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/DataSourceService.test.ts[2m [ tests/unit/services/DataSourceService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m [ tests/unit/services/DatavaultColumnsService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/DatavaultTablesService.test.ts[2m [ tests/unit/services/DatavaultTablesService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/DocumentTemplateService.test.ts[2m [ tests/unit/services/DocumentTemplateService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/docxHelpers.test.ts[2m [ tests/unit/services/docxHelpers.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/docxRenderer2.test.ts[2m [ tests/unit/services/docxRenderer2.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m [ tests/unit/services/intakeNavigation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/intakeQuestionVisibility.test.ts[2m [ tests/unit/services/intakeQuestionVisibility.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/PdfQueueService.test.ts[2m [ tests/unit/services/PdfQueueService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/RecordService.test.ts[2m [ tests/unit/services/RecordService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/repeater.test.ts[2m [ tests/unit/services/repeater.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/RunExecutionCoordinator.test.ts[2m [ tests/unit/services/RunExecutionCoordinator.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/StepService.test.ts[2m [ tests/unit/services/StepService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/TemplateAnalysisService.test.ts[2m [ tests/unit/services/TemplateAnalysisService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/WorkflowPatchService.test.ts[2m [ tests/unit/services/WorkflowPatchService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/WorkflowTemplateService.test.ts[2m [ tests/unit/services/WorkflowTemplateService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/conditionalLogic-simple.test.ts[2m [ tests/unit/utils/conditionalLogic-simple.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/conditionalLogic.test.ts[2m [ tests/unit/utils/conditionalLogic.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/encryption.test.ts[2m [ tests/unit/utils/encryption.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/pagination.test.ts[2m [ tests/unit/utils/pagination.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/variableResolver.test.ts[2m [ tests/unit/utils/variableResolver.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/workflow/PreviewExecution.test.ts[2m [ tests/unit/workflow/PreviewExecution.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/workflow/QueryBlock.test.ts[2m [ tests/unit/workflow/QueryBlock.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/workflows/conditionTruthTable.test.ts[2m [ tests/unit/workflows/conditionTruthTable.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/workflows/validation.test.ts[2m [ tests/unit/workflows/validation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/components/datavault/CellRenderer.test.tsx[2m [ tests/unit/components/datavault/CellRenderer.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m [ tests/unit/components/datavault/SortableColumnHeader.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/components/datavault/TableGridView.test.tsx[2m [ tests/unit/components/datavault/TableGridView.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m [ tests/unit/components/datavault/TableGridViewDragDrop.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/lib/queries/QueryRunner.test.ts[2m [ tests/unit/lib/queries/QueryRunner.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/validation/PageValidator.test.ts[2m [ tests/unit/shared/validation/PageValidator.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m [ tests/unit/shared/validation/stepConfigSchemas.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/validation/Validator.test.ts[2m [ tests/unit/shared/validation/Validator.test.ts ][22m
[31m[1mError[22m: Hook timed out in 300000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".[39m
[36m [2mâ¯[22m tests/setup.ts:[2m114:1[22m[39m
    [90m112| [39m
    [90m113| [39m[90m// Global test hooks[39m
    [90m114| [39m[34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m   | [39m[31m^[39m
    [90m115| [39m  [90m// Conditionally load jest-dom for UI tests (JSDOM environment)[39m
    [90m116| [39m  [35mif[39m ([35mtypeof[39m window [33m!==[39m [32m'undefined'[39m) {

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m [ tests/ListTools.test.ts ][22m
[41m[1m FAIL [22m[49m tests/services/BrandingService.test.ts[2m [ tests/services/BrandingService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/services/EmailTemplateMetadataService.test.ts[2m [ tests/services/EmailTemplateMetadataService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/analytics_preservation.test.ts[2m [ tests/integration/analytics_preservation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/analytics_service.test.ts[2m [ tests/integration/analytics_service.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api-docs.test.ts[2m [ tests/integration/api-docs.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.ai.doc.test.ts[2m [ tests/integration/api.ai.doc.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.ai.personalization.test.ts[2m [ tests/integration/api.ai.personalization.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.ai.test.ts[2m [ tests/integration/api.ai.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.dataSources.native.test.ts[2m [ tests/integration/api.dataSources.native.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.expression-validation.test.ts[2m [ tests/integration/api.expression-validation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.projects.test.ts[2m [ tests/integration/api.projects.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.runs.docx.test.ts[2m [ tests/integration/api.runs.docx.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.runs.graph.test.ts[2m [ tests/integration/api.runs.graph.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.snapshots.test.ts[2m [ tests/integration/api.snapshots.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.templates-runs.test.ts[2m [ tests/integration/api.templates-runs.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m [ tests/integration/api.workflows.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m [ tests/integration/auth.flows.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth.routes.real.test.ts[2m [ tests/integration/auth.routes.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth.routes.test.ts[2m [ tests/integration/auth.routes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/branding.routes.test.ts[2m [ tests/integration/branding.routes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/collections.e2e.test.ts[2m [ tests/integration/collections.e2e.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/dataBlocks.test.ts[2m [ tests/integration/dataBlocks.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m [ tests/integration/datavault-v4-regression.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.api-tokens.test.ts[2m [ tests/integration/datavault.api-tokens.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.autonumber.test.ts[2m [ tests/integration/datavault.autonumber.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m [ tests/integration/datavault.permissions.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.routes.test.ts[2m [ tests/integration/datavault.routes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/datavault.row-notes.test.ts[2m [ tests/integration/datavault.row-notes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/dynamic_options_workflow.test.ts[2m [ tests/integration/dynamic_options_workflow.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/externalSends.test.ts[2m [ tests/integration/externalSends.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/intake.portal.test.ts[2m [ tests/integration/intake.portal.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/intake.workflow.test.ts[2m [ tests/integration/intake.workflow.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/js_helpers.test.ts[2m [ tests/integration/js_helpers.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/lifecycle-hooks-execution.test.ts[2m [ tests/integration/lifecycle-hooks-execution.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/metrics.test.ts[2m [ tests/integration/metrics.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m [ tests/integration/mfa.flow.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/mfa.flow.test.ts[2m [ tests/integration/mfa.flow.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/organizationInvites.test.ts[2m [ tests/integration/organizationInvites.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/organizations-audit-fixes.test.ts[2m [ tests/integration/organizations-audit-fixes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/organizations-workflow.test.ts[2m [ tests/integration/organizations-workflow.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/organizationService.test.ts[2m [ tests/integration/organizationService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/ownershipAccess.test.ts[2m [ tests/integration/ownershipAccess.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/regression-REG-1.test.ts[2m [ tests/integration/regression-REG-1.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m [ tests/integration/session.management.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/session.management.test.ts[2m [ tests/integration/session.management.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/transferOwnership.test.ts[2m [ tests/integration/transferOwnership.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m [ tests/integration/trusted.devices.real.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/variableSafety.test.ts[2m [ tests/integration/variableSafety.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/workflow_versioning.test.ts[2m [ tests/integration/workflow_versioning.test.ts ][22m
[41m[1m FAIL [22m[49m tests/ui/builder.test.ts[2m [ tests/ui/builder.test.ts ][22m
[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m [ tests/ui/expression-editor.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m [ tests/ui/runs.components.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m [ tests/unit/ai.service.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/api.ai.logic.test.ts[2m [ tests/unit/api.ai.logic.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/api.ai.revise.test.ts[2m [ tests/unit/api.ai.revise.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/BlockRunner.validate.test.ts[2m [ tests/unit/BlockRunner.validate.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/captcha.service.test.ts[2m [ tests/unit/captcha.service.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/collab.client.test.tsx[2m [ tests/unit/collab.client.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/debug_import.test.ts[2m [ tests/unit/debug_import.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m [ tests/unit/docxRenderer.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/engine.expr.test.ts[2m [ tests/unit/engine.expr.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/engine.run-conditions.test.ts[2m [ tests/unit/engine.run-conditions.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/HelperLibrary.test.ts[2m [ tests/unit/HelperLibrary.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/isolatedVmBridge.test.ts[2m [ tests/unit/isolatedVmBridge.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/listPipeline.semantics.test.ts[2m [ tests/unit/listPipeline.semantics.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/ScriptEngine.test.ts[2m [ tests/unit/ScriptEngine.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/WorkflowChangeAnalyzer.test.ts[2m [ tests/unit/WorkflowChangeAnalyzer.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/WorkflowOptimizationService.test.ts[2m [ tests/unit/WorkflowOptimizationService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/ai/workflowEdit.test.ts[2m [ tests/integration/ai/workflowEdit.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m [ tests/integration/auth/auth.middleware.integration.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m [ tests/integration/auth/jwt.authentication.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.callback.test.ts[2m [ tests/integration/auth/oauth2.callback.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.client-credentials.test.ts[2m [ tests/integration/auth/oauth2.client-credentials.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.google.test.ts[2m [ tests/integration/auth/oauth2.google.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m [ tests/integration/auth/oauth2.sessions.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m [ tests/integration/auth/oauth2.token-refresh.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m [ tests/integration/auth/protected.routes.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m [ tests/integration/auth/session.management.integration.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/conditions/conditionEvaluation.test.ts[2m [ tests/integration/conditions/conditionEvaluation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/integration/workflows/runtime-pipelines.test.ts[2m [ tests/integration/workflows/runtime-pipelines.test.ts ][22m
[41m[1m FAIL [22m[49m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m [ tests/ui/blocks/SendDataBlockEditorRouting.test.ts ][22m
[41m[1m FAIL [22m[49m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m [ tests/ui/blocks/SendDataToTableBlockEditor.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m [ tests/ui/common/Breadcrumbs.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m [ tests/ui/datavault/ColumnTypeIcon.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m [ tests/ui/datavault/DatabaseSettingsPage.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m [ tests/ui/datavault/EditableCell.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m [ tests/ui/datavault/TableCard.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/ui/datavault/TemplateCard.test.tsx[2m [ tests/ui/datavault/TemplateCard.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/client/choice-utils.test.ts[2m [ tests/unit/client/choice-utils.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/client/list-choice-options.test.ts[2m [ tests/unit/client/list-choice-options.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/debugging/Lineage.test.ts[2m [ tests/unit/debugging/Lineage.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/engine/Performance.test.ts[2m [ tests/unit/engine/Performance.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/engine/templateNode.test.ts[2m [ tests/unit/engine/templateNode.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m [ tests/unit/repositories/DatavaultColumnsRepository.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m [ tests/unit/repositories/DatavaultTablesRepository.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m [ tests/unit/repositories/DocumentTemplateRepository.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m [ tests/unit/repositories/WorkflowTemplateRepository.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/middleware/auth.middleware.test.ts[2m [ tests/unit/middleware/auth.middleware.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/middleware/rbac.test.ts[2m [ tests/unit/middleware/rbac.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/schema/collections.test.ts[2m [ tests/unit/schema/collections.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/schema/documentEngine.test.ts[2m [ tests/unit/schema/documentEngine.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/conditionEvaluator.test.ts[2m [ tests/unit/shared/conditionEvaluator.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/workflowLogic.test.ts[2m [ tests/unit/shared/workflowLogic.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/AIService.test.ts[2m [ tests/unit/services/AIService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/CollectionFieldService.test.ts[2m [ tests/unit/services/CollectionFieldService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/CollectionService.test.ts[2m [ tests/unit/services/CollectionService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/DataSourceService.test.ts[2m [ tests/unit/services/DataSourceService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m [ tests/unit/services/DatavaultColumnsService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/DatavaultTablesService.test.ts[2m [ tests/unit/services/DatavaultTablesService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/DocumentTemplateService.test.ts[2m [ tests/unit/services/DocumentTemplateService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/docxHelpers.test.ts[2m [ tests/unit/services/docxHelpers.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/docxRenderer2.test.ts[2m [ tests/unit/services/docxRenderer2.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m [ tests/unit/services/intakeNavigation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/intakeQuestionVisibility.test.ts[2m [ tests/unit/services/intakeQuestionVisibility.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/PdfQueueService.test.ts[2m [ tests/unit/services/PdfQueueService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/RecordService.test.ts[2m [ tests/unit/services/RecordService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/repeater.test.ts[2m [ tests/unit/services/repeater.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/RunExecutionCoordinator.test.ts[2m [ tests/unit/services/RunExecutionCoordinator.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/StepService.test.ts[2m [ tests/unit/services/StepService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/TemplateAnalysisService.test.ts[2m [ tests/unit/services/TemplateAnalysisService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/WorkflowPatchService.test.ts[2m [ tests/unit/services/WorkflowPatchService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/services/WorkflowTemplateService.test.ts[2m [ tests/unit/services/WorkflowTemplateService.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/conditionalLogic-simple.test.ts[2m [ tests/unit/utils/conditionalLogic-simple.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/conditionalLogic.test.ts[2m [ tests/unit/utils/conditionalLogic.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/encryption.test.ts[2m [ tests/unit/utils/encryption.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/pagination.test.ts[2m [ tests/unit/utils/pagination.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/utils/variableResolver.test.ts[2m [ tests/unit/utils/variableResolver.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/workflow/PreviewExecution.test.ts[2m [ tests/unit/workflow/PreviewExecution.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/workflow/QueryBlock.test.ts[2m [ tests/unit/workflow/QueryBlock.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/workflows/conditionTruthTable.test.ts[2m [ tests/unit/workflows/conditionTruthTable.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/workflows/validation.test.ts[2m [ tests/unit/workflows/validation.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/components/datavault/CellRenderer.test.tsx[2m [ tests/unit/components/datavault/CellRenderer.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m [ tests/unit/components/datavault/SortableColumnHeader.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/components/datavault/TableGridView.test.tsx[2m [ tests/unit/components/datavault/TableGridView.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m [ tests/unit/components/datavault/TableGridViewDragDrop.test.tsx ][22m
[41m[1m FAIL [22m[49m tests/unit/lib/queries/QueryRunner.test.ts[2m [ tests/unit/lib/queries/QueryRunner.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/validation/PageValidator.test.ts[2m [ tests/unit/shared/validation/PageValidator.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m [ tests/unit/shared/validation/stepConfigSchemas.test.ts ][22m
[41m[1m FAIL [22m[49m tests/unit/shared/validation/Validator.test.ts[2m [ tests/unit/shared/validation/Validator.test.ts ][22m
[31m[1mError[22m: Hook timed out in 300000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".[39m
[36m [2mâ¯[22m tests/setup.ts:[2m356:1[22m[39m
    [90m354| [39m})[33m;[39m
    [90m355| [39m
    [90m356| [39m[34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m   | [39m[31m^[39m
    [90m357| [39m  [90m// Cleanup test database[39m
    [90m358| [39m  console[33m.[39m[34mlog[39m([32m"ğŸ§¹ Cleaning up test environment..."[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/293]â¯[22m[39m


[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 13 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mgeneratePasswordResetToken()[2m > [22mshould generate password reset token for existing user
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.generatePasswordResetToken server/services/AuthService.ts:[2m508:9[22m[39m
    [90m506| [39m
    [90m507| [39m        [35mawait[39m [34msendPasswordResetEmail[39m(email[33m,[39m plainToken)[33m;[39m
    [90m508| [39m        log[33m.[39m[34minfo[39m({ email }[33m,[39m [32m'Password reset email sent'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m509| [39m
    [90m510| [39m        [35mreturn[39m plainToken[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m671:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mgeneratePasswordResetToken()[2m > [22mshould invalidate previous reset tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.generatePasswordResetToken server/services/AuthService.ts:[2m508:9[22m[39m
    [90m506| [39m
    [90m507| [39m        [35mawait[39m [34msendPasswordResetEmail[39m(email[33m,[39m plainToken)[33m;[39m
    [90m508| [39m        log[33m.[39m[34minfo[39m({ email }[33m,[39m [32m'Password reset email sent'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m509| [39m
    [90m510| [39m        [35mreturn[39m plainToken[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m695:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould rotate valid token and return new one
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m901:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould return null for unknown token
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m914:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould revoke all tokens on reuse detection
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m933:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould return null for expired token
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m950:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired refresh tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.cleanupExpiredTokens server/services/AuthService.ts:[2m593:9[22m[39m
    [90m591| [39m        [35mawait[39m accountLockoutService[33m.[39m[34mcleanupOldAttempts[39m()[33m;[39m
    [90m592| [39m
    [90m593| [39m        log[33m.[39m[34minfo[39m([32m'Cleaned up expired tokens and old login attempts'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m594| [39m    }
    [90m595| [39m}
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m977:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired password reset tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.cleanupExpiredTokens server/services/AuthService.ts:[2m593:9[22m[39m
    [90m591| [39m        [35mawait[39m accountLockoutService[33m.[39m[34mcleanupOldAttempts[39m()[33m;[39m
    [90m592| [39m
    [90m593| [39m        log[33m.[39m[34minfo[39m([32m'Cleaned up expired tokens and old login attempts'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m594| [39m    }
    [90m595| [39m}
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m982:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired email verification tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.cleanupExpiredTokens server/services/AuthService.ts:[2m593:9[22m[39m
    [90m591| [39m        [35mawait[39m accountLockoutService[33m.[39m[34mcleanupOldAttempts[39m()[33m;[39m
    [90m592| [39m
    [90m593| [39m        log[33m.[39m[34minfo[39m([32m'Cleaned up expired tokens and old login attempts'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m594| [39m    }
    [90m595| [39m}
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m987:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup old login attempts via accountLockoutService
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.cleanupExpiredTokens server/services/AuthService.ts:[2m593:9[22m[39m
    [90m591| [39m        [35mawait[39m accountLockoutService[33m.[39m[34mcleanupOldAttempts[39m()[33m;[39m
    [90m592| [39m
    [90m593| [39m        log[33m.[39m[34minfo[39m([32m'Cleaned up expired tokens and old login attempts'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m594| [39m    }
    [90m595| [39m}
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m993:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mComplete Authentication Flow[2m > [22mshould support full user authentication lifecycle
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m1239:43[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mPassword Reset Flow[2m > [22mshould support complete password reset workflow
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.generatePasswordResetToken server/services/AuthService.ts:[2m508:9[22m[39m
    [90m506| [39m
    [90m507| [39m        [35mawait[39m [34msendPasswordResetEmail[39m(email[33m,[39m plainToken)[33m;[39m
    [90m508| [39m        log[33m.[39m[34minfo[39m({ email }[33m,[39m [32m'Password reset email sent'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m509| [39m
    [90m510| [39m        [35mreturn[39m plainToken[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m1259:28[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/293]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mPassword Reset Flow[2m > [22mshould prevent reuse of password reset tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.generatePasswordResetToken server/services/AuthService.ts:[2m508:9[22m[39m
    [90m506| [39m
    [90m507| [39m        [35mawait[39m [34msendPasswordResetEmail[39m(email[33m,[39m plainToken)[33m;[39m
    [90m508| [39m        log[33m.[39m[34minfo[39m({ email }[33m,[39m [32m'Password reset email sent'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m509| [39m
    [90m510| [39m        [35mreturn[39m plainToken[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m1296:28[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/293]â¯[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Unhandled Errors [49m[22m[31mâ¯â¯â¯â¯â¯â¯[39m
[31m[1m
Vitest caught 30 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.[22m[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/utils/pagination.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/components/datavault/TableGridViewDragDrop.test.tsx[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/services/TemplateAnalysisService.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/integration/intake.portal.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/docxRenderer.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/services/WorkflowPatchService.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/ui/blocks/SendDataToTableBlockEditor.test.tsx[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/utils/pagination.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/components/datavault/TableGridViewDragDrop.test.tsx[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/integration/intake.portal.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/docxRenderer.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/services/WorkflowPatchService.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/ui/blocks/SendDataToTableBlockEditor.test.tsx[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/integration/mfa.flow.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/schema/collections.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/services/repeater.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/services/intakeQuestionVisibility.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/integration/mfa.flow.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/schema/collections.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/services/repeater.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/services/intakeQuestionVisibility.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/services/TemplateAnalysisService.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/services/intakeNavigation.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/ScriptEngine.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/unit/utils/variableResolver.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: read ECONNRESET[39m
[90m [2mâ¯[22m TLSWrap.onStreamRead node:internal/stream_base_commons:[2m216:20[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -4077, code: 'ECONNRESET', syscall: 'read' }[39m
[31mThis error originated in "[1mtests/integration/conditions/conditionEvaluation.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/services/intakeNavigation.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/ScriptEngine.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/unit/utils/variableResolver.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâ¯â¯â¯â¯â¯[39m[1m[41m Uncaught Exception [49m[22m[31mâ¯â¯â¯â¯â¯[39m
[31m[1mError[22m: Connection terminated unexpectedly[39m
[90m [2mâ¯[22m Connection.<anonymous> node_modules/pg/lib/client.js:[2m136:73[22m[39m
[90m [2mâ¯[22m Object.onceWrapper node:events:[2m622:28[22m[39m
[90m [2mâ¯[22m Connection.emit node:events:[2m508:28[22m[39m
[90m [2mâ¯[22m Socket.<anonymous> node_modules/pg/lib/connection.js:[2m62:12[22m[39m
[90m [2mâ¯[22m Socket.emit node:events:[2m520:35[22m[39m
[90m [2mâ¯[22m TCP.<anonymous> node:net:[2m346:12[22m[39m

[31mThis error originated in "[1mtests/integration/conditions/conditionEvaluation.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[39m


[2m Test Files [22m [1m[31m141 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (157)[39m
[2m      Tests [22m [1m[31m13 failed[39m[22m[2m | [22m[1m[32m317 passed[39m[22m[2m | [22m[33m2310 skipped[39m[90m (2640)[39m
[2m     Errors [22m [1m[31m30 errors[39m[22m
[2m   Start at [22m 22:11:59
[2m   Duration [22m 6026.95s[2m (transform 19.17s, setup 14.62s, import 224.35s, tests 84023.77s, environment 13.17s)[22m

