npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764851149870,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764851155747,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764851159976,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764851159976,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764851159982,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764851159983,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764851159983,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764851159983,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764851160556,"env":"test","module":"user-credentials-repository","userId":"3kJoiDWjBN1mx7gxsIz6v","msg":"User credentials created"}
{"level":30,"time":1764851160559,"env":"test","module":"auth-routes","userId":"3kJoiDWjBN1mx7gxsIz6v","email":"test-workflows-jYM7ZsSl9L3c5SrFtO8GT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"8bb3be5d-0534-4c21-bf1c-296e2a646382","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"3kJoiDWjBN1mx7gxsIz6v","tenantId":"fa69a13d-60ec-4729-b00d-4c2df475c4c5","createdBy":"3kJoiDWjBN1mx7gxsIz6v","ownerId":"3kJoiDWjBN1mx7gxsIz6v","status":"active","archived":false,"createdAt":"2025-12-04T12:26:01.571Z","updatedAt":"2025-12-04T12:26:01.571Z"}

{"level":30,"time":1764851161282,"env":"test","module":"user-credentials-repository","userId":"iVRrULZNcfS1zwRf1oWPE","msg":"User credentials created"}
{"level":30,"time":1764851161282,"env":"test","module":"auth-routes","userId":"iVRrULZNcfS1zwRf1oWPE","email":"viewer-kFzXxWc36AhF1ffmaglz1@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851161388,"env":"test","module":"rbac-middleware","userId":"iVRrULZNcfS1zwRf1oWPE","userRole":"viewer","permission":"workflow:create","path":"/projects/8bb3be5d-0534-4c21-bf1c-296e2a646382/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'd0189b19-056f-4ccb-ab82-7723d94f3e1c'[39m,
  projectId: [32m'6d5a3251-f471-41cb-9a7d-377b18c8d4e2'[39m,
  body: { projectId: [32m'6d5a3251-f471-41cb-9a7d-377b18c8d4e2'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'd0189b19-056f-4ccb-ab82-7723d94f3e1c'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'3kJoiDWjBN1mx7gxsIz6v'[39m,
  ownerId: [32m'3kJoiDWjBN1mx7gxsIz6v'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'6d5a3251-f471-41cb-9a7d-377b18c8d4e2'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:26:07.446Z[39m,
  updatedAt: [35m2025-12-04T12:26:07.013Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'5d0e4980-fbf8-4433-aa80-21d97d51bb4f'[39m,
  projectId: [32m'965ab171-a896-4002-9b60-29055c72a302'[39m,
  body: { projectId: [32m'965ab171-a896-4002-9b60-29055c72a302'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'5d0e4980-fbf8-4433-aa80-21d97d51bb4f'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'3kJoiDWjBN1mx7gxsIz6v'[39m,
  ownerId: [32m'3kJoiDWjBN1mx7gxsIz6v'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'965ab171-a896-4002-9b60-29055c72a302'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:26:08.126Z[39m,
  updatedAt: [35m2025-12-04T12:26:07.674Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'5d0e4980-fbf8-4433-aa80-21d97d51bb4f'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'5d0e4980-fbf8-4433-aa80-21d97d51bb4f'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'3kJoiDWjBN1mx7gxsIz6v'[39m,
  ownerId: [32m'3kJoiDWjBN1mx7gxsIz6v'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:26:08.126Z[39m,
  updatedAt: [35m2025-12-04T12:26:07.830Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'2957f046-c628-4afc-bee4-ce900c82aa6c'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764851168488,"env":"test","error":{},"workflowId":"2957f046-c628-4afc-bee4-ce900c82aa6c","userId":"3kJoiDWjBN1mx7gxsIz6v","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764851168833,"env":"test","module":"auth-middleware","path":"/api/workflows/88ecd1fb-1dfa-4ac2-bb4a-d6b5cc72508d/move","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m400[39m {"message":"Password must contain at least one uppercase letter","error":"weak_password"}
Auth Token 2: Unset

{"level":40,"time":1764851169185,"env":"test","module":"auth-middleware","path":"/api/workflows/133c1502-1b93-47b8-a392-c81eb9fcaf0f/move","msg":"No valid authentication found"}
{"level":40,"time":1764851232345,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m401[39m {"message":"Authentication required","error":"unauthorized"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 132375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 523[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 511[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 881[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 631[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 884[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 890[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 678[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 496[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 344[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30357[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30775[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 32026[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:383:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:25:42
[2m   Duration [22m 149.92s[2m (transform 11.19s, setup 2.47s, collect 13.25s, tests 132.37s, environment 0ms, prepare 23ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764851293802,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764851294808,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764851296179,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764851296180,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764851296189,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764851296189,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764851296189,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764851296189,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764851296689,"env":"test","module":"user-credentials-repository","userId":"XaPPIttJxEZa-EKcWYhRI","msg":"User credentials created"}
{"level":30,"time":1764851296692,"env":"test","module":"auth-routes","userId":"XaPPIttJxEZa-EKcWYhRI","email":"test-workflows-ptAk1p7PEXo7Y__0o3aDh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"4b66406b-ec09-45bb-a49f-9773e79ba661","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"XaPPIttJxEZa-EKcWYhRI","tenantId":"9dba0f76-9660-4eca-a0e4-3e9b00b9ffc8","createdBy":"XaPPIttJxEZa-EKcWYhRI","ownerId":"XaPPIttJxEZa-EKcWYhRI","status":"active","archived":false,"createdAt":"2025-12-04T12:28:17.715Z","updatedAt":"2025-12-04T12:28:17.715Z"}

{"level":30,"time":1764851297469,"env":"test","module":"user-credentials-repository","userId":"xkNSlMi_Iy19ZHtGelwws","msg":"User credentials created"}
{"level":30,"time":1764851297470,"env":"test","module":"auth-routes","userId":"xkNSlMi_Iy19ZHtGelwws","email":"viewer-OfkCinmBZEfHMy8hwNrnT@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851297576,"env":"test","module":"rbac-middleware","userId":"xkNSlMi_Iy19ZHtGelwws","userRole":"viewer","permission":"workflow:create","path":"/projects/4b66406b-ec09-45bb-a49f-9773e79ba661/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'1913bb0e-6ca3-4075-a16a-d956f479195e'[39m,
  projectId: [32m'a1eb9841-d7cd-4bd7-8875-0d5d32463868'[39m,
  body: { projectId: [32m'a1eb9841-d7cd-4bd7-8875-0d5d32463868'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'1913bb0e-6ca3-4075-a16a-d956f479195e'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'XaPPIttJxEZa-EKcWYhRI'[39m,
  ownerId: [32m'XaPPIttJxEZa-EKcWYhRI'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'a1eb9841-d7cd-4bd7-8875-0d5d32463868'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:28:24.115Z[39m,
  updatedAt: [35m2025-12-04T12:28:23.821Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'60ac1d14-8171-4175-9eb3-870d5f822b05'[39m,
  projectId: [32m'4ae4d51d-8863-4d3f-bb1d-185526380d6d'[39m,
  body: { projectId: [32m'4ae4d51d-8863-4d3f-bb1d-185526380d6d'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'60ac1d14-8171-4175-9eb3-870d5f822b05'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'XaPPIttJxEZa-EKcWYhRI'[39m,
  ownerId: [32m'XaPPIttJxEZa-EKcWYhRI'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'4ae4d51d-8863-4d3f-bb1d-185526380d6d'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:28:24.948Z[39m,
  updatedAt: [35m2025-12-04T12:28:24.512Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'60ac1d14-8171-4175-9eb3-870d5f822b05'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'60ac1d14-8171-4175-9eb3-870d5f822b05'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'XaPPIttJxEZa-EKcWYhRI'[39m,
  ownerId: [32m'XaPPIttJxEZa-EKcWYhRI'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:28:24.948Z[39m,
  updatedAt: [35m2025-12-04T12:28:24.718Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'93fd96b6-a5fe-4fa9-b925-d4de6ee013bd'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764851305427,"env":"test","error":{},"workflowId":"93fd96b6-a5fe-4fa9-b925-d4de6ee013bd","userId":"XaPPIttJxEZa-EKcWYhRI","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764851305808,"env":"test","module":"auth-middleware","path":"/api/workflows/da646d90-6580-417c-82fc-3686e343c180/move","msg":"No valid authentication found"}
{"level":30,"time":1764851306396,"env":"test","module":"user-credentials-repository","userId":"V0nS0WlT3CuwtxUCtUgfE","msg":"User credentials created"}
{"level":30,"time":1764851306397,"env":"test","module":"auth-routes","userId":"V0nS0WlT3CuwtxUCtUgfE","email":"test-workflows-gpCkjCoPer3zE3Iwkjax-@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJWMG5TMFdsVDNDdXd0eFVDdFVnZkUiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLWdwQ2tqQ29QZXIzekUzSXdramF4LUBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiOWRiYTBmNzYtOTY2MC00ZWNhLWEwZTQtM2U5YjAwYjlmZmM4Iiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUxMzA2LCJleHAiOjE3NjU0NTYxMDZ9.IcaLCnyr-iIe0q5K55yQ1iogq1ve4_o6r2lW7NkrjIc","user":{"id":"V0nS0WlT3CuwtxUCtUgfE","email":"test-workflows-gpCkjCoPer3zE3Iwkjax-@example.com","firstName":null,"lastName":null,"tenantId":"9dba0f76-9660-4eca-a0e4-3e9b00b9ffc8","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'db1cc66a-596e-4154-88b8-c8b3ff480f08'[39m,
  projectId: [32m'0d324cf2-ee94-4955-bbff-4962dce23bfe'[39m,
  body: { projectId: [32m'0d324cf2-ee94-4955-bbff-4962dce23bfe'[39m }
}

{"level":50,"time":1764851306449,"env":"test","error":{},"workflowId":"db1cc66a-596e-4154-88b8-c8b3ff480f08","userId":"V0nS0WlT3CuwtxUCtUgfE","projectId":"0d324cf2-ee94-4955-bbff-4962dce23bfe","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":50,"time":1764851367862,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(XaPPIttJxEZa-EKcWYhRI) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"XaPPIttJxEZa-EKcWYhRI","msg":"Error creating workflow"}
{"level":40,"time":1764851367915,"env":"test","module":"tenant-middleware","userId":"XaPPIttJxEZa-EKcWYhRI","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764851368179,"env":"test","module":"user-credentials-repository","userId":"6XaPyRgOib6EXvRufwMia","msg":"User credentials created"}
{"level":30,"time":1764851368180,"env":"test","module":"auth-routes","userId":"6XaPyRgOib6EXvRufwMia","email":"test-workflows-kT0udlXsBlb2M1vqsxkex@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851368183,"env":"test","module":"rbac-middleware","userId":"6XaPyRgOib6EXvRufwMia","userRole":null,"permission":"project:create","path":"/","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m403[39m {"message":"Permission denied","error":"forbidden","details":"Required permission: project:create"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 131749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 399[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 1053[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 692[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 932[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 943[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 839[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 895[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 546[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 641[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30533[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30517[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30418[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5
    407|     });
    408| 
    409|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    410|       // Create a second user with their own project
    411|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:28:12
[2m   Duration [22m 135.22s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764852091661,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852095770,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852100308,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852100309,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852100327,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852100327,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852100328,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852100328,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852100854,"env":"test","module":"user-credentials-repository","userId":"cE77etRsezspOFY2Vnbye","msg":"User credentials created"}
{"level":30,"time":1764852100862,"env":"test","module":"auth-routes","userId":"cE77etRsezspOFY2Vnbye","email":"test-workflows-zV4tRJEK-45MNgJCbRSQ_@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"bd0a676e-3cf0-4155-8c3b-d5048978b4ab","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"cE77etRsezspOFY2Vnbye","tenantId":"7f4e65d1-b418-4df1-bd94-da72db58f249","createdBy":"cE77etRsezspOFY2Vnbye","ownerId":"cE77etRsezspOFY2Vnbye","status":"active","archived":false,"createdAt":"2025-12-04T12:41:41.909Z","updatedAt":"2025-12-04T12:41:41.909Z"}

{"level":30,"time":1764852101649,"env":"test","module":"user-credentials-repository","userId":"7hd-PI1fXHiV3pLNUebHq","msg":"User credentials created"}
{"level":30,"time":1764852101650,"env":"test","module":"auth-routes","userId":"7hd-PI1fXHiV3pLNUebHq","email":"viewer-GFpK_77ybav_XMYe1xDAU@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852101781,"env":"test","module":"rbac-middleware","userId":"7hd-PI1fXHiV3pLNUebHq","userRole":"viewer","permission":"workflow:create","path":"/projects/bd0a676e-3cf0-4155-8c3b-d5048978b4ab/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'e99d8bd9-cdff-4749-a2ec-9e4cf94c5226'[39m,
  projectId: [32m'5b29aca2-f044-4b21-a7d4-f4d2979dafa2'[39m,
  body: { projectId: [32m'5b29aca2-f044-4b21-a7d4-f4d2979dafa2'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'e99d8bd9-cdff-4749-a2ec-9e4cf94c5226'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'cE77etRsezspOFY2Vnbye'[39m,
  ownerId: [32m'cE77etRsezspOFY2Vnbye'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'5b29aca2-f044-4b21-a7d4-f4d2979dafa2'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:47.931Z[39m,
  updatedAt: [35m2025-12-04T12:41:47.496Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'e086019a-2606-4b9d-b8ce-7e27263fcad5'[39m,
  projectId: [32m'602e1af5-88f7-4e56-a1ae-40abeb9d9cba'[39m,
  body: { projectId: [32m'602e1af5-88f7-4e56-a1ae-40abeb9d9cba'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'e086019a-2606-4b9d-b8ce-7e27263fcad5'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'cE77etRsezspOFY2Vnbye'[39m,
  ownerId: [32m'cE77etRsezspOFY2Vnbye'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'602e1af5-88f7-4e56-a1ae-40abeb9d9cba'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:48.647Z[39m,
  updatedAt: [35m2025-12-04T12:41:48.203Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'e086019a-2606-4b9d-b8ce-7e27263fcad5'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'e086019a-2606-4b9d-b8ce-7e27263fcad5'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'cE77etRsezspOFY2Vnbye'[39m,
  ownerId: [32m'cE77etRsezspOFY2Vnbye'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:48.647Z[39m,
  updatedAt: [35m2025-12-04T12:41:48.371Z[39m
}

{"level":50,"time":1764852109140,"env":"test","error":{},"workflowId":"0f65e4a3-eb57-476d-8888-c66b3e690c17","userId":"cE77etRsezspOFY2Vnbye","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'0f65e4a3-eb57-476d-8888-c66b3e690c17'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764852109562,"env":"test","module":"auth-middleware","path":"/api/workflows/044e0785-5826-45dd-bb21-fc89209eedc0/move","msg":"No valid authentication found"}
{"level":30,"time":1764852110189,"env":"test","module":"user-credentials-repository","userId":"DU3K-4CpLqo_Wpm2dWJSn","msg":"User credentials created"}
{"level":30,"time":1764852110191,"env":"test","module":"auth-routes","userId":"DU3K-4CpLqo_Wpm2dWJSn","email":"test-workflows-eTJxtH5QNt1PdC1j0L8v0@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJEVTNLLTRDcExxb19XcG0yZFdKU24iLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLWVUSnh0SDVRTnQxUGRDMWowTDh2MEBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiN2Y0ZTY1ZDEtYjQxOC00ZGYxLWJkOTQtZGE3MmRiNThmMjQ5Iiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyMTEwLCJleHAiOjE3NjU0NTY5MTB9.f-edMPuElClXjdaHyOP4nFJk8tBANIZbviBINsVFRLk","user":{"id":"DU3K-4CpLqo_Wpm2dWJSn","email":"test-workflows-eTJxtH5QNt1PdC1j0L8v0@example.com","firstName":null,"lastName":null,"tenantId":"7f4e65d1-b418-4df1-bd94-da72db58f249","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'0d02847f-9ccd-49b8-a89c-2e41bd4fb699'[39m,
  projectId: [32m'5faa2ca9-2888-4c73-bd08-5cd032c1574f'[39m,
  body: { projectId: [32m'5faa2ca9-2888-4c73-bd08-5cd032c1574f'[39m }
}

{"level":50,"time":1764852110251,"env":"test","error":{},"workflowId":"0d02847f-9ccd-49b8-a89c-2e41bd4fb699","userId":"DU3K-4CpLqo_Wpm2dWJSn","projectId":"5faa2ca9-2888-4c73-bd08-5cd032c1574f","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764852171881,"env":"test","module":"user-credentials-repository","userId":"FSkuopd0tmjA64o0YWkH0","msg":"User credentials created"}
{"level":30,"time":1764852171882,"env":"test","module":"auth-routes","userId":"FSkuopd0tmjA64o0YWkH0","email":"test-workflows-z4xuoTyQ4Ehsp8OIJ_ZQP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852171937,"env":"test","module":"rbac-middleware","userId":"FSkuopd0tmjA64o0YWkH0","userRole":null,"permission":"project:create","path":"/","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m403[39m {"message":"Permission denied","error":"forbidden","details":"Required permission: project:create"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 131368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 394[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 539[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 537[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 897[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 856[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 904[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 719[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 878[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 421[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 690[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30364[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30514[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30534[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5
    407|     });
    408| 
    409|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    410|       // Create a second user with their own project
    411|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:41:27
[2m   Duration [22m 143.39s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764852395770,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852400507,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852406170,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852406170,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852406182,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852406182,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852406182,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852406182,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852406789,"env":"test","module":"user-credentials-repository","userId":"rpWSuNflNvmg54Z6_I178","msg":"User credentials created"}
{"level":30,"time":1764852406792,"env":"test","module":"auth-routes","userId":"rpWSuNflNvmg54Z6_I178","email":"test-workflows-q08JlixDkkfTR-uct4dIp@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"c04cd073-d099-4b6c-a8b8-1201d7c207ea","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"rpWSuNflNvmg54Z6_I178","tenantId":"0c2515d4-745d-4970-9204-6fa652cb16d8","createdBy":"rpWSuNflNvmg54Z6_I178","ownerId":"rpWSuNflNvmg54Z6_I178","status":"active","archived":false,"createdAt":"2025-12-04T12:46:47.855Z","updatedAt":"2025-12-04T12:46:47.855Z"}

{"level":30,"time":1764852407727,"env":"test","module":"user-credentials-repository","userId":"eUK8xHHHzuVFj1tgW7I72","msg":"User credentials created"}
{"level":30,"time":1764852407728,"env":"test","module":"auth-routes","userId":"eUK8xHHHzuVFj1tgW7I72","email":"viewer-G3u2ybWp6LaMKgE864fqT@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852407847,"env":"test","module":"rbac-middleware","userId":"eUK8xHHHzuVFj1tgW7I72","userRole":"viewer","permission":"workflow:create","path":"/projects/c04cd073-d099-4b6c-a8b8-1201d7c207ea/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'1cb5aee2-1b77-44b3-9a44-ad20a10b2fce'[39m,
  projectId: [32m'6ba84ea2-0fed-42f4-a99a-170f7b8988fb'[39m,
  body: { projectId: [32m'6ba84ea2-0fed-42f4-a99a-170f7b8988fb'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'1cb5aee2-1b77-44b3-9a44-ad20a10b2fce'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'rpWSuNflNvmg54Z6_I178'[39m,
  ownerId: [32m'rpWSuNflNvmg54Z6_I178'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'6ba84ea2-0fed-42f4-a99a-170f7b8988fb'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:54.059Z[39m,
  updatedAt: [35m2025-12-04T12:46:53.623Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'5cc08fd4-902d-49b9-83b3-7dcaa96aa907'[39m,
  projectId: [32m'11b35b43-ac41-4112-8a45-1ff328ea4545'[39m,
  body: { projectId: [32m'11b35b43-ac41-4112-8a45-1ff328ea4545'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'5cc08fd4-902d-49b9-83b3-7dcaa96aa907'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'rpWSuNflNvmg54Z6_I178'[39m,
  ownerId: [32m'rpWSuNflNvmg54Z6_I178'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'11b35b43-ac41-4112-8a45-1ff328ea4545'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:54.779Z[39m,
  updatedAt: [35m2025-12-04T12:46:54.329Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'5cc08fd4-902d-49b9-83b3-7dcaa96aa907'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'5cc08fd4-902d-49b9-83b3-7dcaa96aa907'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'rpWSuNflNvmg54Z6_I178'[39m,
  ownerId: [32m'rpWSuNflNvmg54Z6_I178'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:54.779Z[39m,
  updatedAt: [35m2025-12-04T12:46:54.492Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'db6818b5-7bcf-4fdc-ab7f-30a0ee618f8d'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764852415198,"env":"test","error":{},"workflowId":"db6818b5-7bcf-4fdc-ab7f-30a0ee618f8d","userId":"rpWSuNflNvmg54Z6_I178","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764852415580,"env":"test","module":"auth-middleware","path":"/api/workflows/63cec76e-9964-4600-9de1-2e032262abb1/move","msg":"No valid authentication found"}
{"level":30,"time":1764852416172,"env":"test","module":"user-credentials-repository","userId":"fI_HvH872X9Ovx3lrOrFk","msg":"User credentials created"}
{"level":30,"time":1764852416173,"env":"test","module":"auth-routes","userId":"fI_HvH872X9Ovx3lrOrFk","email":"test-workflows-srBSy7l7mrbn48VFYnvz4@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJmSV9Idkg4NzJYOU92eDNsck9yRmsiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLXNyQlN5N2w3bXJibjQ4VkZZbnZ6NEBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiMGMyNTE1ZDQtNzQ1ZC00OTcwLTkyMDQtNmZhNjUyY2IxNmQ4Iiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyNDE2LCJleHAiOjE3NjU0NTcyMTZ9.iGThHhb4SL0a08c3FaEQTf0WFoL2uhcEdrQ-OsTiXOQ","user":{"id":"fI_HvH872X9Ovx3lrOrFk","email":"test-workflows-srBSy7l7mrbn48VFYnvz4@example.com","firstName":null,"lastName":null,"tenantId":"0c2515d4-745d-4970-9204-6fa652cb16d8","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'75ac3775-051c-48f8-b370-4d346aac719d'[39m,
  projectId: [32m'f205369c-2e63-45d3-9661-3dda5f794b97'[39m,
  body: { projectId: [32m'f205369c-2e63-45d3-9661-3dda5f794b97'[39m }
}

{"level":50,"time":1764852416233,"env":"test","error":{},"workflowId":"75ac3775-051c-48f8-b370-4d346aac719d","userId":"fI_HvH872X9Ovx3lrOrFk","projectId":"f205369c-2e63-45d3-9661-3dda5f794b97","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764852477912,"env":"test","module":"user-credentials-repository","userId":"ShzoOf0E_9dW0ab0yuYAH","msg":"User credentials created"}
{"level":30,"time":1764852477913,"env":"test","module":"auth-routes","userId":"ShzoOf0E_9dW0ab0yuYAH","email":"test-workflows-1iRWMRa-Da_KsFmyPiU96@example.com","msg":"User registered successfully"}
{"level":30,"time":1764852478141,"env":"test","module":"auth-routes","userId":"ShzoOf0E_9dW0ab0yuYAH","email":"test-workflows-1iRWMRa-Da_KsFmyPiU96@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m201[39m {"id":"7a304098-2ba8-4d8e-bc9e-bc5bbf087344","title":"User 2 Project","name":"User 2 Project","description":"Project owned by user 2","creatorId":"ShzoOf0E_9dW0ab0yuYAH","tenantId":"0c2515d4-745d-4970-9204-6fa652cb16d8","createdBy":"ShzoOf0E_9dW0ab0yuYAH","ownerId":"ShzoOf0E_9dW0ab0yuYAH","status":"active","archived":false,"createdAt":"2025-12-04T12:47:59.077Z","updatedAt":"2025-12-04T12:47:59.077Z"}
User 2 Project ID: 7a304098-2ba8-4d8e-bc9e-bc5bbf087344

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'ffaa6d31-9506-4e54-bd8d-9c02167396aa'[39m,
  projectId: [32m'7a304098-2ba8-4d8e-bc9e-bc5bbf087344'[39m,
  body: { projectId: [32m'7a304098-2ba8-4d8e-bc9e-bc5bbf087344'[39m }
}

{"level":50,"time":1764852478344,"env":"test","error":{},"workflowId":"ffaa6d31-9506-4e54-bd8d-9c02167396aa","userId":"rpWSuNflNvmg54Z6_I178","projectId":"7a304098-2ba8-4d8e-bc9e-bc5bbf087344","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: Error: Workflow not found
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:47:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 102188[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 537[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 541[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 908[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 885[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 746[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 904[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 728[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 865[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 654[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30394[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30519[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1198[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:455:10
    453|         .set("Authorization", `Bearer ${authToken}`)
    454|         .send({ projectId: user2ProjectId })
    455|         .expect(403);
       |          ^
    456| 
    457|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 06:46:31
[2m   Duration [22m 116.22s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764852779960,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852788414,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852797779,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852797780,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852797803,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852797803,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852797803,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852797803,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852798463,"env":"test","module":"user-credentials-repository","userId":"wL22NDqws1jPIsro63Gar","msg":"User credentials created"}
{"level":30,"time":1764852798468,"env":"test","module":"auth-routes","userId":"wL22NDqws1jPIsro63Gar","email":"test-workflows-lNw-vnzYI-YPt0ZwM-m6J@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7db67614-2331-4bf0-9f99-8c6a458cfa72","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"wL22NDqws1jPIsro63Gar","tenantId":"71f7e323-eeba-4c20-9645-34a83f157479","createdBy":"wL22NDqws1jPIsro63Gar","ownerId":"wL22NDqws1jPIsro63Gar","status":"active","archived":false,"createdAt":"2025-12-04T12:53:19.528Z","updatedAt":"2025-12-04T12:53:19.528Z"}

{"level":30,"time":1764852799317,"env":"test","module":"user-credentials-repository","userId":"EnHuo1IJGDtFnZEPEOcyV","msg":"User credentials created"}
{"level":30,"time":1764852799318,"env":"test","module":"auth-routes","userId":"EnHuo1IJGDtFnZEPEOcyV","email":"viewer-c016P5YOsoW9AxbYMvTD4@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852799436,"env":"test","module":"rbac-middleware","userId":"EnHuo1IJGDtFnZEPEOcyV","userRole":"viewer","permission":"workflow:create","path":"/projects/7db67614-2331-4bf0-9f99-8c6a458cfa72/workflows","msg":"Permission denied"}
{"level":40,"time":1764852803794,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764852803853,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/workflows/undefined/versions","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852804068,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(wL22NDqws1jPIsro63Gar) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wL22NDqws1jPIsro63Gar","msg":"Error creating workflow"}
{"level":40,"time":1764852804131,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852804190,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"wL22NDqws1jPIsro63Gar","msg":"Error moving workflow"}
{"level":50,"time":1764852804408,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(wL22NDqws1jPIsro63Gar) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wL22NDqws1jPIsro63Gar","msg":"Error creating workflow"}
{"level":40,"time":1764852804471,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852804531,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"wL22NDqws1jPIsro63Gar","msg":"Error moving workflow"}
{"level":50,"time":1764852804659,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"wL22NDqws1jPIsro63Gar","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764852805044,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(wL22NDqws1jPIsro63Gar) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wL22NDqws1jPIsro63Gar","msg":"Error creating workflow"}
{"level":40,"time":1764852805099,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852805210,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"wL22NDqws1jPIsro63Gar","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":50,"time":1764852805582,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(wL22NDqws1jPIsro63Gar) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wL22NDqws1jPIsro63Gar","msg":"Error creating workflow"}
{"level":40,"time":1764852805638,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764852805644,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764852805847,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(wL22NDqws1jPIsro63Gar) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wL22NDqws1jPIsro63Gar","msg":"Error creating workflow"}
{"level":40,"time":1764852805906,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764852806135,"env":"test","module":"user-credentials-repository","userId":"VgptgIBubO6ZSw1AJkym-","msg":"User credentials created"}
{"level":30,"time":1764852806136,"env":"test","module":"auth-routes","userId":"VgptgIBubO6ZSw1AJkym-","email":"test-workflows-k9-82Jcq9h7L9RR91M812@example.com","msg":"User registered successfully"}
{"level":50,"time":1764852806141,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"VgptgIBubO6ZSw1AJkym-","msg":"Error moving workflow"}
{"level":50,"time":1764852806365,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(wL22NDqws1jPIsro63Gar) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wL22NDqws1jPIsro63Gar","msg":"Error creating workflow"}
{"level":40,"time":1764852806429,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852806490,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"undefined","userId":"wL22NDqws1jPIsro63Gar","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764852806700,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(wL22NDqws1jPIsro63Gar) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wL22NDqws1jPIsro63Gar","msg":"Error creating workflow"}
{"level":40,"time":1764852806753,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852806807,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"wL22NDqws1jPIsro63Gar","msg":"Error moving workflow"}
{"level":50,"time":1764852807067,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(wL22NDqws1jPIsro63Gar) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"wL22NDqws1jPIsro63Gar","msg":"Error creating workflow"}
{"level":40,"time":1764852807126,"env":"test","module":"tenant-middleware","userId":"wL22NDqws1jPIsro63Gar","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764852807353,"env":"test","module":"user-credentials-repository","userId":"H93DZz8LThnBzo2pish0t","msg":"User credentials created"}
{"level":30,"time":1764852807353,"env":"test","module":"auth-routes","userId":"H93DZz8LThnBzo2pish0t","email":"test-workflows-SThVqSRSMxB5l4xlzt60V@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852807470,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764852807543,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"wL22NDqws1jPIsro63Gar","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJWZ3B0Z0lCdWJPNlpTdzFBSmt5bS0iLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLWs5LTgySmNxOWg3TDlSUjkxTTgxMkBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiNzFmN2UzMjMtZWViYS00YzIwLTk2NDUtMzRhODNmMTU3NDc5Iiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyODA2LCJleHAiOjE3NjU0NTc2MDZ9.nVq23x_Iq6LrGtnNvfjitjBAXMffLD2qluUS1sXyeX8","user":{"id":"VgptgIBubO6ZSw1AJkym-","email":"test-workflows-k9-82Jcq9h7L9RR91M812@example.com","firstName":null,"lastName":null,"tenantId":"71f7e323-eeba-4c20-9645-34a83f157479","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m401[39m {"message":"Authentication required","error":"unauthorized"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 10093[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 398[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 555[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 930[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 871[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[33m 515[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 336[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 470[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 433[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 349[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 316[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 739[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:231:10
    229|         .set("Authorization", `Bearer ${authToken}`)
    230|         .send({})
    231|         .expect(200);
       |          ^
    232| 
    233|       expect(response.body).toHaveProperty("status", "active");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/7]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:263:10
    261|         .get(`/api/workflows/${workflowId}/versions`)
    262|         .set("Authorization", `Bearer ${authToken}`)
    263|         .expect(200);
       |          ^
    264| 
    265|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/7]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:302:10
    300|         .set("Authorization", `Bearer ${authToken}`)
    301|         .send({ projectId: targetProjectId })
    302|         .expect(200);
       |          ^
    303| 
    304|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/7]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:328:10
    326|         .set("Authorization", `Bearer ${authToken}`)
    327|         .send({ projectId: null })
    328|         .expect(200);
       |          ^
    329| 
    330|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/7]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Error: expected 404 "Not Found", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:349:10
    347|         .set("Authorization", `Bearer ${authToken}`)
    348|         .send({ projectId: fakeProjectId })
    349|         .expect(404);
       |          ^
    350| 
    351|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/7]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:383:10
    381|         .set("Authorization", `Bearer ${authToken2}`)
    382|         .send({ projectId: targetProjectId })
    383|         .expect(403);
       |          ^
    384| 
    385|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/7]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:455:10
    453|         .set("Authorization", `Bearer ${authToken}`)
    454|         .send({ projectId: user2ProjectId })
    455|         .expect(403);
       |          ^
    456| 
    457|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/7]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m10 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 06:52:54
[2m   Duration [22m 32.42s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21
  
  "await" can only be used inside an "async" function
  376 |  
  377 |      // Try to move the first user's workflow as the second user
  378 |      const response = await request(baseURL)
      |                       ^
  379 |        .put(`/api/workflows/${workflowId}/move`)
  380 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 06:56:28
[2m   Duration [22m 27ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21
  
  "await" can only be used inside an "async" function
  376 |  
  377 |      // Try to move the first user's workflow as the second user
  378 |      const response = await request(baseURL)
      |                       ^
  379 |        .put(`/api/workflows/${workflowId}/move`)
  380 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:04:25
[2m   Duration [22m 33ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:365:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:365:21
  
  "await" can only be used inside an "async" function
  363 |  
  364 |      // Try to move the first user's workflow as the second user
  365 |      const response = await request(baseURL)
      |                       ^
  366 |        .put(`/api/workflows/${workflowId}/move`)
  367 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:05:17
[2m   Duration [22m 27ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:06:04
[2m   Duration [22m 87ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764853575700,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764853580589,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764853586446,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764853586449,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764853586465,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764853586465,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764853586465,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764853586465,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764853587117,"env":"test","module":"user-credentials-repository","userId":"I__NjOd5hF1JDXARv0Omt","msg":"User credentials created"}
{"level":30,"time":1764853587121,"env":"test","module":"auth-routes","userId":"I__NjOd5hF1JDXARv0Omt","email":"test-workflows-SZxmGiUhUKYVTjRnE0qjb@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"b967596a-d289-45cb-b860-44e7cf221251","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"I__NjOd5hF1JDXARv0Omt","tenantId":"77290e62-3573-441c-9bea-8542b6bdba0f","createdBy":"I__NjOd5hF1JDXARv0Omt","ownerId":"I__NjOd5hF1JDXARv0Omt","status":"active","archived":false,"createdAt":"2025-12-04T13:06:28.205Z","updatedAt":"2025-12-04T13:06:28.205Z"}

{"level":30,"time":1764853587560,"env":"test","module":"user-credentials-repository","userId":"OT2BLkHoL-ovHTemjU0My","msg":"User credentials created"}
{"level":30,"time":1764853587560,"env":"test","module":"auth-routes","userId":"OT2BLkHoL-ovHTemjU0My","email":"viewer-NCuP9OuOIpDMBXYHUBQfN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764853587675,"env":"test","module":"rbac-middleware","userId":"OT2BLkHoL-ovHTemjU0My","userRole":"viewer","permission":"workflow:create","path":"/projects/b967596a-d289-45cb-b860-44e7cf221251/workflows","msg":"Permission denied"}
{"level":50,"time":1764853595325,"env":"test","error":{},"workflowId":"25fbc5af-13b3-4cdd-8910-2c36fec7aadb","userId":"I__NjOd5hF1JDXARv0Omt","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764853595726,"env":"test","module":"auth-middleware","path":"/api/workflows/77a3db8d-2f54-436a-807a-96f33815b652/move","msg":"No valid authentication found"}
{"level":30,"time":1764853596328,"env":"test","module":"user-credentials-repository","userId":"1OuRSVMraOtPaspYQvMes","msg":"User credentials created"}
{"level":30,"time":1764853596330,"env":"test","module":"auth-routes","userId":"1OuRSVMraOtPaspYQvMes","email":"test-workflows-jxcVlJk856j_olCwqUW3n@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853597222,"env":"test","module":"user-credentials-repository","userId":"OHR7dx3zpn8gmLlDDLLhR","msg":"User credentials created"}
{"level":30,"time":1764853597223,"env":"test","module":"auth-routes","userId":"OHR7dx3zpn8gmLlDDLLhR","email":"test-workflows-4U9wUGLEcfSVFH-fR0uKB@example.com","msg":"User registered successfully"}
{"level":50,"time":1764853597280,"env":"test","error":{},"workflowId":"f1e2ee73-9899-4b82-93fb-79b8136bf8bb","userId":"OHR7dx3zpn8gmLlDDLLhR","projectId":"47713e4e-8534-47ee-924e-60893590f0c1","msg":"Error moving workflow"}
{"level":50,"time":1764853597738,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"cbbf8246-aa4d-423a-b192-bf5fedec4e2b","userId":"I__NjOd5hF1JDXARv0Omt","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764853598203,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"78dd2e6d-95fc-4c5a-b8d1-786492c70a26","userId":"I__NjOd5hF1JDXARv0Omt","msg":"Error moving workflow"}
{"level":30,"time":1764853598821,"env":"test","module":"user-credentials-repository","userId":"FvwvLvVKnQqjvXEuhzK7O","msg":"User credentials created"}
{"level":30,"time":1764853598822,"env":"test","module":"auth-routes","userId":"FvwvLvVKnQqjvXEuhzK7O","email":"test-workflows-SDWxNfCFZL1gL8C6mx5Ba@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853599047,"env":"test","module":"auth-routes","userId":"FvwvLvVKnQqjvXEuhzK7O","email":"test-workflows-SDWxNfCFZL1gL8C6mx5Ba@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764853599282,"env":"test","error":{},"workflowId":"761f30f7-796e-4a5c-b4c6-a7175f5ba211","userId":"I__NjOd5hF1JDXARv0Omt","projectId":"e634d1ab-0e90-4e48-be39-9f68ed396c2b","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 13280[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a new draft workflow[39m[32m 2[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 938[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 892[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 804[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 920[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 722[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 888[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 559[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 400[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 949[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 465[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1079[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:projectId/workflows > should create a new draft workflow
ReferenceError: response is not defined
 Î“Â¥Â» tests/integration/api.workflows.test.ts:91:14
     89|   describe("POST /api/projects/:projectId/workflows", () => {
     90|     it("should create a new draft workflow", async () => {
     91|       expect(response.body.currentVersion).toHaveProperty("published",Î“Ã‡Âª
       |              ^
     92|     });
     93| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:324:10
    322|         .get(`/api/workflows/${workflowId}`)
    323|         .set("Authorization", `Bearer ${authToken}`)
    324|         .expect(200);
       |          ^
    325| 
    326|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:451:10
    449|         .set("Authorization", `Bearer ${authToken}`)
    450|         .send({ projectId: user2ProjectId })
    451|         .expect(403);
       |          ^
    452| 
    453|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/4]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (18)[39m
[2m   Start at [22m 07:06:10
[2m   Duration [22m 28.66s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764853867530,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764853870764,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764853874263,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764853874264,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764853874274,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764853874274,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764853874274,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764853874275,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764853874799,"env":"test","module":"user-credentials-repository","userId":"F3ww1feHkKpVHGgxOpM34","msg":"User credentials created"}
{"level":30,"time":1764853874803,"env":"test","module":"auth-routes","userId":"F3ww1feHkKpVHGgxOpM34","email":"test-workflows-WTHAXqMqon7iMjSni3cki@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"534a6951-80ef-47fd-ab4b-329ab2ca57af","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"F3ww1feHkKpVHGgxOpM34","tenantId":"f4333198-16b5-4acb-b2f4-0ec073d21040","createdBy":"F3ww1feHkKpVHGgxOpM34","ownerId":"F3ww1feHkKpVHGgxOpM34","status":"active","archived":false,"createdAt":"2025-12-04T13:11:15.886Z","updatedAt":"2025-12-04T13:11:15.886Z"}

{"level":30,"time":1764853875608,"env":"test","module":"user-credentials-repository","userId":"dlpyAkjHBt6C6YJLcSjZX","msg":"User credentials created"}
{"level":30,"time":1764853875609,"env":"test","module":"auth-routes","userId":"dlpyAkjHBt6C6YJLcSjZX","email":"viewer-pz8I0Q_BErFiM2no-V-dn@example.com","msg":"User registered successfully"}
{"level":40,"time":1764853875721,"env":"test","module":"rbac-middleware","userId":"dlpyAkjHBt6C6YJLcSjZX","userRole":"viewer","permission":"workflow:create","path":"/projects/534a6951-80ef-47fd-ab4b-329ab2ca57af/workflows","msg":"Permission denied"}
{"level":50,"time":1764853882958,"env":"test","error":{},"workflowId":"3ef60251-600b-4912-b597-fbfeac2b2c01","userId":"F3ww1feHkKpVHGgxOpM34","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764853883341,"env":"test","module":"auth-middleware","path":"/api/workflows/3fa301c7-9d12-4277-a5a4-eecf147ac095/move","msg":"No valid authentication found"}
{"level":30,"time":1764853883950,"env":"test","module":"user-credentials-repository","userId":"Uio5DPC42QoJWz8qIP8Nq","msg":"User credentials created"}
{"level":30,"time":1764853883951,"env":"test","module":"auth-routes","userId":"Uio5DPC42QoJWz8qIP8Nq","email":"test-workflows-faKbI9HjMEgsxpNo1ug2w@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853884578,"env":"test","module":"user-credentials-repository","userId":"myv5f8hcYlHFjrnG5ZvSh","msg":"User credentials created"}
{"level":30,"time":1764853884578,"env":"test","module":"auth-routes","userId":"myv5f8hcYlHFjrnG5ZvSh","email":"test-workflows-3s_6fyr-FejQ0KFMZ2NkI@example.com","msg":"User registered successfully"}
{"level":50,"time":1764853884632,"env":"test","error":{},"workflowId":"5ead8f37-efa9-4081-970c-78f696e77678","userId":"myv5f8hcYlHFjrnG5ZvSh","projectId":"72de81b5-a62f-4f62-b50c-dc3f51991fc5","msg":"Error moving workflow"}
{"level":50,"time":1764853885068,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ec6c4d3c-b9c4-4e2e-a187-1156ea8cf587","userId":"F3ww1feHkKpVHGgxOpM34","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764853885509,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c4aeac6d-69a6-4fd8-8da9-2a598f3ba565","userId":"F3ww1feHkKpVHGgxOpM34","msg":"Error moving workflow"}
{"level":30,"time":1764853886095,"env":"test","module":"user-credentials-repository","userId":"I-ZHFbvZpo2JcVW1_bcZ9","msg":"User credentials created"}
{"level":30,"time":1764853886096,"env":"test","module":"auth-routes","userId":"I-ZHFbvZpo2JcVW1_bcZ9","email":"test-workflows-E5yxLaBtCBvr5IyNmy2si@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853886306,"env":"test","module":"auth-routes","userId":"I-ZHFbvZpo2JcVW1_bcZ9","email":"test-workflows-E5yxLaBtCBvr5IyNmy2si@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764853886519,"env":"test","error":{},"workflowId":"e1315a6e-5816-4b2a-ac19-4b8e17793025","userId":"F3ww1feHkKpVHGgxOpM34","projectId":"e6aa746b-0696-4312-b9ca-8703b9e4e0db","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12702[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 398[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 530[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 893[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 848[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 902[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 690[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 859[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 552[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 680[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 441[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1010[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m17 passed[39m[22m[90m (18)[39m
[2m   Start at [22m 07:11:03
[2m   Duration [22m 23.05s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764854520226,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764854527508,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764854534774,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764854534775,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764854534785,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764854534785,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764854534786,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764854534786,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764854535685,"env":"test","module":"user-credentials-repository","userId":"JOxAf0lxVIJFLf8SnKpF8","msg":"User credentials created"}
{"level":30,"time":1764854535690,"env":"test","module":"auth-routes","userId":"JOxAf0lxVIJFLf8SnKpF8","email":"test-workflows-UW5yU4QCktV-5ue1VMHwp@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2c31c5fe-0169-4ecc-aaad-93dbdc4c62eb","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"JOxAf0lxVIJFLf8SnKpF8","tenantId":"ea9201f5-3e97-40b3-b164-20de07344404","createdBy":"JOxAf0lxVIJFLf8SnKpF8","ownerId":"JOxAf0lxVIJFLf8SnKpF8","status":"active","archived":false,"createdAt":"2025-12-04T13:22:16.802Z","updatedAt":"2025-12-04T13:22:16.802Z"}

{"level":30,"time":1764854536540,"env":"test","module":"user-credentials-repository","userId":"z9sq-38KmpeOPFkh3OJrG","msg":"User credentials created"}
{"level":30,"time":1764854536540,"env":"test","module":"auth-routes","userId":"z9sq-38KmpeOPFkh3OJrG","email":"viewer-K4sr5VG6CMPA3hCxmbnpn@example.com","msg":"User registered successfully"}
{"level":40,"time":1764854536655,"env":"test","module":"rbac-middleware","userId":"z9sq-38KmpeOPFkh3OJrG","userRole":"viewer","permission":"workflow:create","path":"/projects/2c31c5fe-0169-4ecc-aaad-93dbdc4c62eb/workflows","msg":"Permission denied"}
{"level":50,"time":1764854544298,"env":"test","error":{},"workflowId":"03bef7d3-7018-4e43-a81d-b56bf72670aa","userId":"JOxAf0lxVIJFLf8SnKpF8","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764854544707,"env":"test","module":"auth-middleware","path":"/api/workflows/7aeae014-8912-43b7-a9fb-33e9937f25fa/move","msg":"No valid authentication found"}
{"level":30,"time":1764854545334,"env":"test","module":"user-credentials-repository","userId":"0c1-hNofqnMdUQcdty_xu","msg":"User credentials created"}
{"level":30,"time":1764854545335,"env":"test","module":"auth-routes","userId":"0c1-hNofqnMdUQcdty_xu","email":"test-workflows-7kkE3W_iV9vcULD7AfH0g@example.com","msg":"User registered successfully"}
{"level":30,"time":1764854545958,"env":"test","module":"user-credentials-repository","userId":"OacrYFMBi_97Zyl9euXBq","msg":"User credentials created"}
{"level":30,"time":1764854545958,"env":"test","module":"auth-routes","userId":"OacrYFMBi_97Zyl9euXBq","email":"test-workflows-NV8hS-u-cxnqPB4UfsZFB@example.com","msg":"User registered successfully"}
{"level":50,"time":1764854546020,"env":"test","error":{},"workflowId":"6636482e-b13d-4016-8fa2-f338e5e34996","userId":"OacrYFMBi_97Zyl9euXBq","projectId":"9b1b5c71-84f6-4d72-8046-f42a16b08cbf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'413b65b9-1159-44fa-96ca-41ac6d1c2783'[39m,
  projectId: [32m'2e52cd06-c9c6-4104-8687-f13e2cb8af7c'[39m,
  body: { projectId: [32m'2e52cd06-c9c6-4104-8687-f13e2cb8af7c'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'413b65b9-1159-44fa-96ca-41ac6d1c2783'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'JOxAf0lxVIJFLf8SnKpF8'[39m,
  ownerId: [32m'JOxAf0lxVIJFLf8SnKpF8'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'2e52cd06-c9c6-4104-8687-f13e2cb8af7c'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T13:22:23.095Z[39m,
  updatedAt: [35m2025-12-04T13:22:22.628Z[39m
}

{"level":50,"time":1764854576770,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(JOxAf0lxVIJFLf8SnKpF8) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"JOxAf0lxVIJFLf8SnKpF8","msg":"Error creating workflow"}
{"level":40,"time":1764854576824,"env":"test","module":"tenant-middleware","userId":"JOxAf0lxVIJFLf8SnKpF8","path":"/","msg":"User does not have an associated tenant"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'c4df5c08-368c-4373-9e3e-b5f048b41ae3'[39m,
  projectId: [32m'21e50b10-01ac-409d-8292-cd9b3d8d8e6a'[39m,
  body: { projectId: [32m'21e50b10-01ac-409d-8292-cd9b3d8d8e6a'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'c4df5c08-368c-4373-9e3e-b5f048b41ae3'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'JOxAf0lxVIJFLf8SnKpF8'[39m,
  ownerId: [32m'JOxAf0lxVIJFLf8SnKpF8'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'21e50b10-01ac-409d-8292-cd9b3d8d8e6a'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T13:22:23.842Z[39m,
  updatedAt: [35m2025-12-04T13:22:23.363Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'c4df5c08-368c-4373-9e3e-b5f048b41ae3'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'c4df5c08-368c-4373-9e3e-b5f048b41ae3'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'JOxAf0lxVIJFLf8SnKpF8'[39m,
  ownerId: [32m'JOxAf0lxVIJFLf8SnKpF8'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T13:22:23.842Z[39m,
  updatedAt: [35m2025-12-04T13:22:23.527Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'03bef7d3-7018-4e43-a81d-b56bf72670aa'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'6636482e-b13d-4016-8fa2-f338e5e34996'[39m,
  projectId: [32m'9b1b5c71-84f6-4d72-8046-f42a16b08cbf'[39m,
  body: { projectId: [32m'9b1b5c71-84f6-4d72-8046-f42a16b08cbf'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":50,"time":1764854607198,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(JOxAf0lxVIJFLf8SnKpF8) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"JOxAf0lxVIJFLf8SnKpF8","msg":"Error creating workflow"}
{"level":40,"time":1764854607250,"env":"test","module":"tenant-middleware","userId":"JOxAf0lxVIJFLf8SnKpF8","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764854607457,"env":"test","module":"user-credentials-repository","userId":"oLNhSpNi1idYPYJZwg-MS","msg":"User credentials created"}
{"level":30,"time":1764854607458,"env":"test","module":"auth-routes","userId":"oLNhSpNi1idYPYJZwg-MS","email":"test-workflows-r4N8dr8o1mxRK5fEetsZ5@example.com","msg":"User registered successfully"}
{"level":30,"time":1764854607672,"env":"test","module":"auth-routes","userId":"oLNhSpNi1idYPYJZwg-MS","email":"test-workflows-r4N8dr8o1mxRK5fEetsZ5@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'undefined'[39m,
  projectId: [32m'7f41c712-50f0-48cf-87e0-5dcb556129b9'[39m,
  body: { projectId: [32m'7f41c712-50f0-48cf-87e0-5dcb556129b9'[39m }
}

{"level":50,"time":1764854607834,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"JOxAf0lxVIJFLf8SnKpF8","projectId":"7f41c712-50f0-48cf-87e0-5dcb556129b9","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: error: invalid input syntax for type uuid: "undefined"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at NeonPreparedQuery.execute (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
    at WorkflowRepository.findById (C:/Users/scoot/poll/VaultLogic/server/repositories/BaseRepository.ts:52:22)
    at WorkflowRepository.findByIdOrSlug (C:/Users/scoot/poll/VaultLogic/server/repositories/WorkflowRepository.ts:87:18)
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:44:22)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24 {
  length: 141,
  severity: 'ERROR',
  code: '22P02',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: "unnamed portal parameter $1 = '...'",
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'uuid.c',
  line: '138',
  routine: 'string_to_uuid'
}

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 103072[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 945[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 914[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 914[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 752[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 910[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 407[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 685[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30382[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30423[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1009[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:400:5
    398|     });
    399| 
    400|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    401|       const response = await request(baseURL)
    402|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:410:5
    408|     });
    409| 
    410|     it("should reject move without projectId in body", async () => {
       |     ^
    411|       const response = await request(baseURL)
    412|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:464:10
    462|         .set("Authorization", `Bearer ${authToken}`)
    463|         .send({ projectId: user2ProjectId })
    464|         .expect(403);
       |          ^
    465| 
    466|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (18)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 07:21:54
[2m   Duration [22m 121.79s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
