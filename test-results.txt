npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

> ezbuildr@1.0.0 test
> vitest run --coverage

[1m[43m DEPRECATED [49m[22m [33m`test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework[39m

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":40,"time":1767800696113,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696117,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696117,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696121,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696125,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696129,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696130,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696130,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696130,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696135,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696148,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800696155,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstderr[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/ai.service.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800696675,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767800696676,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"responseTokens":90,"totalTokens":1302,"durationMs":1,"estimatedCostUSD":0.01482,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800696680,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":6,"msg":"AI workflow generation failed"}
{"level":30,"time":1767800696694,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767800696695,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":49,"totalTokens":1250,"durationMs":1,"estimatedCostUSD":0.013479999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800696695,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767800696711,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767800696711,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":68,"totalTokens":1269,"durationMs":0,"estimatedCostUSD":0.01405,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800696712,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767800696718,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767800696719,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":89,"totalTokens":1290,"durationMs":1,"estimatedCostUSD":0.014679999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800696719,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767800696725,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1767800696726,"env":"test","module":"ai-service","attempt":0,"waitMs":1000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767800697479,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697480,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697493,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697527,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697531,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697531,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697533,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697540,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697544,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697555,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697555,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800697585,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":40,"time":1767800697728,"env":"test","module":"ai-service","attempt":1,"waitMs":2000,"msg":"Rate limit hit, retrying..."}
[90mstderr[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/session.management.real.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/auth.routes.real.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/auth.flows.real.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m‚ö†Ô∏è Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m‚ö†Ô∏è Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1767800698830,"env":"test","module":"user-credentials-repository","userId":"oU-t1HVwBq7CID_ejP6EG","msg":"User credentials created"}
{"level":30,"time":1767800698839,"env":"test","module":"user-credentials-repository","userId":"m68gyqZ_8ahPBikm8pS-0","msg":"User credentials created"}
{"level":30,"time":1767800699036,"env":"test","module":"auth-routes","userId":"m68gyqZ_8ahPBikm8pS-0","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1767800699379,"env":"test","module":"user-credentials-repository","userId":"qUv9jX1TvRS9n3kxiE60o","msg":"User credentials created"}
{"level":30,"time":1767800699486,"env":"test","module":"auth-routes","userId":"qUv9jX1TvRS9n3kxiE60o","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767800699508,"env":"test","module":"user-credentials-repository","userId":"CNfw8_JCuk1CKcA_4NRFI","msg":"User credentials created"}
{"level":50,"time":1767800699512,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800699518,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800699729,"env":"test","module":"ai-service","attempt":2,"waitMs":4000,"msg":"Rate limit hit, retrying..."}
{"level":50,"time":1767800699773,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800699810,"env":"test","module":"user-credentials-repository","userId":"XfXNY_NE9VhHu8ZIeBBQ0","msg":"User credentials created"}
{"level":30,"time":1767800699823,"env":"test","module":"user-credentials-repository","userId":"Qtd3fcgebVEHuA_5AHazp","msg":"User credentials created"}
{"level":50,"time":1767800699886,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800699914,"env":"test","module":"email-queue","jobId":"329bb3b4-7d6d-4e63-bf39-9fec95c00a1d","to":"test-1767800699398-0c78m8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800699928,"env":"test","module":"auth-routes","userId":"Qtd3fcgebVEHuA_5AHazp","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767800699976,"env":"test","module":"auth-routes","userId":"XfXNY_NE9VhHu8ZIeBBQ0","email":"test-1767800699398-0c78m8@example.com","msg":"User registered"}
{"level":30,"time":1767800700000,"env":"test","module":"user-credentials-repository","userId":"uKwxgdiiaaU2ymaltq3GR","msg":"User credentials created"}
{"level":40,"time":1767800700002,"env":"test","module":"mfa-service","userId":"83969a6ecacf85b23bc430c592424247","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800700002,"env":"test","module":"auth-routes","userId":"83969a6ecacf85b23bc430c592424247","msg":"MFA verification failed during login"}
{"level":50,"time":1767800700009,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800700033,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800700038,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800700102,"env":"test","module":"email-queue","jobId":"6ebdb454-4002-4795-a741-fa7500eacb4e","to":"test-1767800699586-56lil6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800700157,"env":"test","module":"auth-routes","userId":"uKwxgdiiaaU2ymaltq3GR","email":"test-1767800699586-56lil6@example.com","msg":"User registered"}
{"level":30,"time":1767800700180,"env":"test","module":"user-credentials-repository","userId":"jIRVziRLW0MsmJ1Au7joP","msg":"User credentials created"}
{"level":30,"time":1767800700279,"env":"test","module":"user-credentials-repository","userId":"j9uep1Sc836Pthzw-p0rM","msg":"User credentials created"}
{"level":30,"time":1767800700387,"env":"test","module":"auth-routes","userId":"j9uep1Sc836Pthzw-p0rM","sessionCount":0,"msg":"Listed active sessions"}
{"level":40,"time":1767800700569,"env":"test","module":"auth-routes","userId":"uKwxgdiiaaU2ymaltq3GR","email":"test-1767800699586-56lil6@example.com","msg":"Login blocked: email not verified"}
{"level":50,"time":1767800700569,"env":"test","module":"auth-routes","error":{"name":"EmailNotVerifiedError","code":"AUTH_006","statusCode":403,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800700576,"env":"test","module":"user-credentials-repository","userId":"Mv-yI4FwJdIf1nYwTlXXY","msg":"User credentials created"}
{"level":50,"time":1767800700635,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800700642,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800700647,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800700684,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767800700720,"env":"test","module":"user-credentials-repository","userId":"Yq-H5KfpGbka4BdeYvTGe","msg":"User credentials created"}
{"level":50,"time":1767800700886,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800700886,"env":"test","module":"auth-routes","userId":"Yq-H5KfpGbka4BdeYvTGe","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1767800701013,"env":"test","module":"user-credentials-repository","userId":"zFI6QlhV2QzCjoU5Ve_lq","msg":"User credentials created"}
{"level":50,"time":1767800701105,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800701178,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767800701230,"env":"test","module":"user-credentials-repository","userId":"E5C02zhcRPUsmuX9wIoiY","msg":"User credentials created"}
{"level":30,"time":1767800701342,"env":"test","module":"auth-routes","userId":"E5C02zhcRPUsmuX9wIoiY","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1767800701364,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800701457,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800701530,"env":"test","module":"user-credentials-repository","userId":"XTxrmZ8xu9Oql8zby6rwx","msg":"User credentials created"}
{"level":40,"time":1767800701572,"env":"test","module":"mfa-service","userId":"ab902e8cd12df4dc26a11711e50ec1b5","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800701572,"env":"test","module":"auth-routes","userId":"ab902e8cd12df4dc26a11711e50ec1b5","msg":"MFA verification failed during login"}
{"level":50,"time":1767800701577,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800701697,"env":"test","module":"auth-service","tokenHash":"f85d8a2aa65ee0302578499194ec1c0e5c3053f5e263d2865ed3e3015c1d4829","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767800701704,"env":"test","module":"user-credentials-repository","userId":"YKl0_A8XM48tX29AoSpcA","msg":"User credentials created"}
{"level":50,"time":1767800701709,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800701988,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800702035,"env":"test","module":"user-credentials-repository","userId":"RVnLT1tAiacHWP9ATvSCN","msg":"User credentials created"}
{"level":30,"time":1767800702054,"env":"test","module":"user-credentials-repository","userId":"DZvkUZtipls_JHcAOrKar","msg":"User credentials created"}
{"level":50,"time":1767800702078,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800702203,"env":"test","module":"auth-service","tokenHash":"b67c7a24ae3d03e3ff2eda58cb6afdfb83a8d5256fe8999e61d395780478a1a2","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1767800702253,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800702414,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800702485,"env":"test","module":"user-credentials-repository","userId":"EcWlhLG-FEbnyYQrXa_WS","msg":"User credentials created"}
{"level":50,"time":1767800702512,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800702539,"env":"test","module":"user-credentials-repository","userId":"qXsBV1kFH9JNsLY__9cRB","msg":"User credentials created"}
{"level":50,"time":1767800702669,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800702773,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800702862,"env":"test","module":"user-credentials-repository","userId":"OH6o3a_3lp3iSSAELiOWl","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800702966,"env":"test","module":"user-credentials-repository","userId":"UaA4pVwlXCK0LAasr_o5K","msg":"User credentials created"}
{"level":50,"time":1767800703011,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800703043,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800703077,"env":"test","module":"email-queue","jobId":"8f11cf06-5c30-4ecc-b849-6c4585183844","to":"test-1767800702539-is8cys@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767800703120,"env":"test","module":"mfa-service","userId":"f2f51b2f9e40b983ba69b106f545a03a","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800703120,"env":"test","module":"auth-routes","userId":"f2f51b2f9e40b983ba69b106f545a03a","msg":"MFA verification failed during login"}
{"level":30,"time":1767800703124,"env":"test","module":"auth-routes","userId":"UaA4pVwlXCK0LAasr_o5K","email":"test-1767800702539-is8cys@example.com","msg":"User registered"}
{"level":50,"time":1767800703124,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #8: Placeholder user cleanup[2m > [22m[2mshould cleanup placeholder user when invite is revoked
[22m[39mCleaned up placeholder user 2a612202-f610-4a43-8a0a-4f445c303580 (no pending invites or memberships)

{"level":30,"time":1767800703191,"env":"test","module":"user-credentials-repository","userId":"0m-MbGlIXmSE20N_BjIH5","msg":"User credentials created"}
{"level":50,"time":1767800703230,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800703306,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800703311,"env":"test","module":"user-credentials-repository","userId":"RHpFbyCDIL27_PYdt9fgQ","msg":"User credentials created"}
{"level":30,"time":1767800703384,"env":"test","module":"auth-routes","userId":"6cdf5dd644dda286f3b399636be48d5d","msg":"User logged in successfully"}
[90mstderr[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/api.workflows.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800703441,"env":"test","module":"audit-log-service","userId":"6cdf5dd644dda286f3b399636be48d5d","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767800703463,"env":"test","module":"auth-service","userId":"0m-MbGlIXmSE20N_BjIH5","tokenHash":"405ed222b1af0822688461f7525fa957224a72979686c4834b1ce37b0464e943","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstderr[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:111:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:73:9 {
  length: [33m320[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23505'[39m,
  detail: [32m'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'pg_catalog'[39m,
  table: [32m'pg_proc'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'pg_proc_proname_args_nsp_index'[39m,
  file: [32m'nbtinsert.c'[39m,
  line: [32m'667'[39m,
  routine: [32m'_bt_check_unique'[39m
}

{"level":30,"time":1767800703540,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m‚ö†Ô∏è Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1767800703560,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800703548,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800703549,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800703554,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800703560,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800703560,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800703560,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800703560,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1767800703654,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800703689,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800703691,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800703704,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800703711,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800703715,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800703700,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800703701,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800703705,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800703710,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800703710,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800703711,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800703711,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767800703699,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800703700,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800703705,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800703714,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800703714,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800703715,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800703715,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767800703724,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800703713,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800703714,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800703719,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800703724,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800703724,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800703724,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800703724,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":40,"time":1767800703734,"env":"test","module":"ai-service","attempt":3,"waitMs":8000,"msg":"Rate limit hit, retrying..."}
{"level":50,"time":1767800703783,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800703804,"env":"test","module":"user-credentials-repository","userId":"t9qE6KDxhaUzv3imSqkP5","msg":"User credentials created"}
{"level":50,"time":1767800703808,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800703849,"env":"test","module":"user-credentials-repository","userId":"K4UHnMkNQFpGvBLq-UZ6R","msg":"User credentials created"}
{"level":40,"time":1767800703949,"env":"test","module":"auth-service","tokenHash":"1a3e1c8a1ad362173f20706ba490ba1323336f5a0da8f9112f5de86edcdd93eb","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767800703963,"env":"test","module":"mfa-service","userId":"6cdf5dd644dda286f3b399636be48d5d","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767800703963,"env":"test","module":"mfa-service","userId":"6cdf5dd644dda286f3b399636be48d5d","msg":"Generated TOTP secret"}
{"level":30,"time":1767800703963,"env":"test","module":"auth-routes","userId":"6cdf5dd644dda286f3b399636be48d5d","msg":"MFA setup initiated"}
[90mstderr[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:70:7 {
  length: [33m336[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(51898d34-de78-490a-aa22-f4ac2fcd38f8) is still referenced from table "workflows".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'workflows'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'workflows_creator_id_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39müßπ Cleaning up test environment...

 [31m‚ùØ[39m tests/integration/organizations-audit-fixes.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 8352[2mms[22m[39m
       [33m[2m‚úì[22m[39m should cascade ownership to workflow runs when project is transferred [33m 1271[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent double-acceptance via transaction [33m 988[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not create invite if email fails [33m 525[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow re-invite after invite expires [33m 1097[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow last admin to delete empty organization [33m 627[2mms[22m[39m
[31m       [31m√ó[31m should prevent deletion if org owns assets[39m[33m 908[2mms[22m[39m
       [33m[2m‚úì[22m[39m should cleanup placeholder user when invite is revoked [33m 1090[2mms[22m[39m
       [33m[2m‚úì[22m[39m should fail fast on non-existent org [33m 479[2mms[22m[39m
{"level":30,"time":1767800704113,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImZlYzhkZGIwLTc4ZWQtNGRkZS1iMDdjLTA2MjU2NGY5Nzk5YiIsInJvbGUiOiJhZG1pbiIsInRlbmFudFJvbGUiOiJvd25lciIsImlhdCI6MTc2NzgwMDcwNCwiZXhwIjoxNzY3ODAxNjA0fQ._b5TBqJhDjuCMRW5aWROSB9a-lmAEXmicsQxm5rWMrY",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": null,
    "lastName": null,
    "profileImageUrl": null,
    "tenantId": "fec8ddb0-78ed-4dde-b07c-062564f9799b",
    "role": "admin",
    "tenantRole": "owner"
  }
}

{"level":50,"time":1767800704130,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800704138,"env":"test","module":"user-credentials-repository","userId":"xVdfKvE3zhVH3cPv3LcSC","msg":"User credentials created"}
{"level":30,"time":1767800704187,"env":"test","module":"user-credentials-repository","userId":"F-gE9yPcB1UT1DxgLNT-l","msg":"User credentials created"}
{"level":30,"time":1767800704187,"env":"test","module":"user-credentials-repository","userId":"A4UC4fQ-29Z4zysryx_2q","msg":"User credentials created"}
{"level":30,"time":1767800704209,"env":"test","module":"user-credentials-repository","userId":"ZjxXARxaFMSjPdYzsXUg3","msg":"User credentials created"}
{"level":30,"time":1767800704280,"env":"test","module":"user-credentials-repository","userId":"g6ekSDCE0R-g33AwEkPMn","msg":"User credentials created"}
{"level":30,"time":1767800704288,"env":"test","module":"email-queue","jobId":"85037202-cf8c-43c0-9f84-a9cb9594446f","to":"test-uHKbJ3Os8XpQ4ZvD8uXhp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800704290,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800704294,"env":"test","module":"email-queue","jobId":"4bbf44ad-2ec5-4d79-8349-48a34ea7686c","to":"test-2wIiT6wWobtFl0NcZd05K@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800704308,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800704314,"env":"test","module":"email-queue","jobId":"01f0e7b8-7f5e-4918-8a63-e88765d78241","to":"test-frigEqMzMn5iFbEgCz6Yb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800704298,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800704299,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800704302,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800704307,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800704307,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800704308,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800704308,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767800704333,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1767800704343,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800704344,"env":"test","module":"auth-routes","userId":"F-gE9yPcB1UT1DxgLNT-l","email":"test-uHKbJ3Os8XpQ4ZvD8uXhp@example.com","msg":"User registered"}
{"level":30,"time":1767800704351,"env":"test","module":"auth-routes","userId":"A4UC4fQ-29Z4zysryx_2q","email":"test-2wIiT6wWobtFl0NcZd05K@example.com","msg":"User registered"}
{"level":30,"time":1767800704383,"env":"test","module":"auth-routes","userId":"ZjxXARxaFMSjPdYzsXUg3","email":"test-frigEqMzMn5iFbEgCz6Yb@example.com","msg":"User registered"}
{"level":30,"time":1767800704392,"env":"test","module":"user-credentials-repository","userId":"_5WTnxHEOlbfz28_BwyGl","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767800704471,"env":"test","module":"auth-routes","userId":"xVdfKvE3zhVH3cPv3LcSC","msg":"All other sessions revoked"}
{"level":50,"time":1767800704502,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800704507,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800704506,"env":"test","module":"email-queue","jobId":"8b8212b7-81ff-4525-9b98-4bb29d339b36","to":"test-1767800704007-5ogl8h@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800704513,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800704523,"env":"test","module":"audit-log-service","userId":"xVdfKvE3zhVH3cPv3LcSC","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767800704557,"env":"test","module":"auth-routes","userId":"_5WTnxHEOlbfz28_BwyGl","email":"test-1767800704007-5ogl8h@example.com","msg":"User registered"}
{"level":50,"time":1767800704609,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800704740,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800704811,"env":"test","module":"user-credentials-repository","userId":"76__uUC1Ded2iI_Qt2-A-","msg":"User credentials created"}
{"level":30,"time":1767800704820,"env":"test","module":"user-credentials-repository","userId":"oysfJaw8dCHQgZPk-rk7R","msg":"User credentials created"}
{"level":50,"time":1767800704873,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800704899,"env":"test","module":"user-credentials-repository","userId":"MEqxwAkWlK3GEnc4UVLxX","msg":"User credentials created"}
{"level":30,"time":1767800704904,"env":"test","module":"user-credentials-repository","userId":"r07dPDvq-NC8CDxGrVczD","msg":"User credentials created"}
{"level":30,"time":1767800704911,"env":"test","module":"email-queue","jobId":"f07dfd5c-659b-4c0e-a3f8-5e2a10cabb1f","to":"test-WBCvpjH5JLQIwoTqy7Sd6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800704932,"env":"test","module":"email-queue","jobId":"5d51b319-8234-421c-bf00-73f16d1c7953","to":"session-test-Pqx8BuvTiWt37nL-EUDCa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800704932,"env":"test","module":"user-credentials-repository","userId":"rbH-BdRIZAZDTkVlqjJVc","msg":"User credentials created"}
{"level":50,"time":1767800704949,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800704954,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800704958,"env":"test","module":"user-credentials-repository","userId":"EZXj1OXmBOzBWjMEskLdh","msg":"User credentials created"}
{"level":30,"time":1767800704967,"env":"test","module":"auth-routes","userId":"76__uUC1Ded2iI_Qt2-A-","email":"test-WBCvpjH5JLQIwoTqy7Sd6@example.com","msg":"User registered"}
{"level":30,"time":1767800704988,"env":"test","module":"auth-routes","userId":"oysfJaw8dCHQgZPk-rk7R","email":"session-test-Pqx8BuvTiWt37nL-EUDCa@example.com","msg":"User registered"}
{"level":30,"time":1767800705008,"env":"test","module":"email-queue","jobId":"98f7207a-04b1-400b-8d5e-5e21cf7d36e4","to":"middleware-test-T2uOpt5v-Uf-uF6FgO0BC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800705040,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800705045,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800705064,"env":"test","module":"email-queue","jobId":"3bca4f10-47d1-4daf-8566-036e3e191d04","to":"protected-test-Jf0hlkfnv4qsyjGnIOXGG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800705064,"env":"test","module":"auth-routes","userId":"r07dPDvq-NC8CDxGrVczD","email":"middleware-test-T2uOpt5v-Uf-uF6FgO0BC@example.com","msg":"User registered"}
{"level":50,"time":1767800705069,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800705114,"env":"test","module":"auth-routes","userId":"EZXj1OXmBOzBWjMEskLdh","email":"protected-test-Jf0hlkfnv4qsyjGnIOXGG@example.com","msg":"User registered"}
{"level":30,"time":1767800705143,"env":"test","module":"auth-routes","userId":"rbH-BdRIZAZDTkVlqjJVc","msg":"All other sessions revoked"}
{"level":40,"time":1767800705145,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstderr[2m | tests/unit/services/AuthService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

{"level":50,"time":1767800705169,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800705174,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800705181,"env":"test","module":"mfa-service","userId":"b647c5f97b2826e49524cf2291bd8f50","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800705181,"env":"test","module":"auth-routes","userId":"b647c5f97b2826e49524cf2291bd8f50","msg":"MFA verification failed during login"}
{"level":50,"time":1767800705185,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800705193,"env":"test","module":"audit-log-service","userId":"rbH-BdRIZAZDTkVlqjJVc","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":50,"time":1767800705360,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800705385,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800705386,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800705444,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800705455,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800705492,"env":"test","module":"user-credentials-repository","userId":"mzprJMN2fwkw54fjYp06p","msg":"User credentials created"}
{"level":40,"time":1767800705564,"env":"test","module":"mfa-service","userId":"b647c5f97b2826e49524cf2291bd8f50","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800705564,"env":"test","module":"auth-routes","userId":"b647c5f97b2826e49524cf2291bd8f50","msg":"MFA verification failed during login"}
{"level":50,"time":1767800705568,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800705569,"env":"test","module":"user-credentials-repository","userId":"6Kb88JJPE_r2D7tRUsBJC","msg":"User credentials created"}
{"level":50,"time":1767800705601,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800705605,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800705747,"env":"test","module":"user-credentials-repository","userId":"FqtuCwJ6C_XCx3yqYX2sw","msg":"User credentials created"}
{"level":30,"time":1767800705770,"env":"test","module":"user-credentials-repository","userId":"1vV0Jmq8Pz_VpfHqKSqOu","msg":"User credentials created"}
{"level":50,"time":1767800705802,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800705836,"env":"test","module":"user-credentials-repository","userId":"DlCA01j8QA3wQl1q_9h9Y","msg":"User credentials created"}
{"level":50,"time":1767800705836,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800705849,"env":"test","module":"email-queue","jobId":"d0ad562d-bd42-48aa-98a4-9494075a38ca","to":"session-test-yEY0iCfv-OYd-8cvIsD8H@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800705874,"env":"test","module":"email-queue","jobId":"5f600702-d781-493e-8649-bfbefbbef322","to":"middleware-test-mQ54rY8PwMLfOIjRUZZ-m@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800705878,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800705899,"env":"test","module":"user-credentials-repository","userId":"K3aHGWF_LaZSLO2H_xv0h","msg":"User credentials created"}
{"level":30,"time":1767800705900,"env":"test","module":"auth-routes","userId":"FqtuCwJ6C_XCx3yqYX2sw","email":"session-test-yEY0iCfv-OYd-8cvIsD8H@example.com","msg":"User registered"}
{"level":50,"time":1767800705901,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800705926,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800705928,"env":"test","module":"auth-routes","userId":"1vV0Jmq8Pz_VpfHqKSqOu","email":"middleware-test-mQ54rY8PwMLfOIjRUZZ-m@example.com","msg":"User registered"}
{"level":30,"time":1767800705941,"env":"test","module":"email-queue","jobId":"52173a6f-4bae-4d1c-8ae7-62cef6f4e49f","to":"protected-test--gkObL0dxQHQzA8uJKNi4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767800705948,"env":"test","module":"mfa-service","userId":"b647c5f97b2826e49524cf2291bd8f50","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800705948,"env":"test","module":"auth-routes","userId":"b647c5f97b2826e49524cf2291bd8f50","msg":"MFA verification failed during login"}
{"level":50,"time":1767800705951,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800705994,"env":"test","module":"auth-routes","userId":"DlCA01j8QA3wQl1q_9h9Y","email":"protected-test--gkObL0dxQHQzA8uJKNi4@example.com","msg":"User registered"}
{"level":30,"time":1767800706134,"env":"test","module":"user-credentials-repository","userId":"95rPqpVvsiQ1h0S5qEkEk","msg":"User credentials created"}
{"level":50,"time":1767800706151,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800706155,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800706182,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800706210,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800706216,"env":"test","module":"auth-routes","userId":"f4e8adb2b5c23e973d3776c1111e972b","msg":"User logged in successfully"}
{"level":30,"time":1767800706236,"env":"test","module":"user-credentials-repository","userId":"rnd6RjfcxsCuSeciZXROZ","msg":"User credentials created"}
{"level":30,"time":1767800706267,"env":"test","module":"audit-log-service","userId":"f4e8adb2b5c23e973d3776c1111e972b","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800706271,"env":"test","module":"auth-routes","userId":"317d9f326a6d07b14aff461be72b06d8","msg":"User logged in successfully"}
{"level":30,"time":1767800706323,"env":"test","module":"audit-log-service","userId":"317d9f326a6d07b14aff461be72b06d8","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800706344,"env":"test","module":"auth-routes","userId":"rnd6RjfcxsCuSeciZXROZ","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":30,"time":1767800706460,"env":"test","module":"auth-routes","userId":"1vV0Jmq8Pz_VpfHqKSqOu","msg":"User logged in successfully"}
{"level":50,"time":1767800706481,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800706503,"env":"test","module":"auth-routes","userId":"FqtuCwJ6C_XCx3yqYX2sw","msg":"User logged in successfully"}
{"level":50,"time":1767800706506,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800706510,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800706514,"env":"test","module":"audit-log-service","userId":"1vV0Jmq8Pz_VpfHqKSqOu","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800706519,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800706529,"env":"test","module":"auth-routes","userId":"DlCA01j8QA3wQl1q_9h9Y","msg":"User logged in successfully"}
{"level":30,"time":1767800706554,"env":"test","module":"audit-log-service","userId":"FqtuCwJ6C_XCx3yqYX2sw","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800706582,"env":"test","module":"audit-log-service","userId":"DlCA01j8QA3wQl1q_9h9Y","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800706587,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800706628,"env":"test","module":"user-credentials-repository","userId":"MMZFjROMobX7sy94sdxDx","msg":"User credentials created"}
{"level":30,"time":1767800706676,"env":"test","module":"auth-routes","userId":"0f5cadbe1a3cbea6a4c14a242e7761cb","msg":"User logged in successfully"}
{"level":30,"time":1767800706727,"env":"test","module":"user-credentials-repository","userId":"GdJ8nixW8-sGmGqeiqPF-","msg":"User credentials created"}
{"level":30,"time":1767800706736,"env":"test","module":"audit-log-service","userId":"0f5cadbe1a3cbea6a4c14a242e7761cb","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800706740,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800706768,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800706772,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800706782,"env":"test","module":"mfa-service","userId":"f4e8adb2b5c23e973d3776c1111e972b","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767800706782,"env":"test","module":"mfa-service","userId":"f4e8adb2b5c23e973d3776c1111e972b","msg":"Generated TOTP secret"}
{"level":30,"time":1767800706782,"env":"test","module":"auth-routes","userId":"f4e8adb2b5c23e973d3776c1111e972b","msg":"MFA setup initiated"}
{"level":30,"time":1767800706829,"env":"test","module":"auth-routes","userId":"GdJ8nixW8-sGmGqeiqPF-","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":30,"time":1767800706907,"env":"test","module":"user-credentials-repository","userId":"dLixQuIqLkRxjfGUjbyS-","msg":"User credentials created"}
{"level":30,"time":1767800706979,"env":"test","module":"user-credentials-repository","userId":"2XK5j0hMslTeojAmberAG","msg":"User credentials created"}
{"level":50,"time":1767800706990,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800706991,"env":"test","module":"auth-routes","userId":"GdJ8nixW8-sGmGqeiqPF-","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":30,"time":1767800706995,"env":"test","module":"user-credentials-repository","userId":"CqfvypFTxGmvs09tcNM9-","msg":"User credentials created"}
{"level":30,"time":1767800707014,"env":"test","module":"user-credentials-repository","userId":"Wv3uxwkdlR2R-eiH52Dgr","msg":"User credentials created"}
{"level":30,"time":1767800707014,"env":"test","module":"email-queue","jobId":"120cf613-7b50-4180-b0a9-e2413d0080ae","to":"middleware-test-Tn3zjclRR09PL4pw3k42O@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800707067,"env":"test","module":"auth-routes","userId":"dLixQuIqLkRxjfGUjbyS-","email":"middleware-test-Tn3zjclRR09PL4pw3k42O@example.com","msg":"User registered"}
{"level":30,"time":1767800707081,"env":"test","module":"email-queue","jobId":"3320782b-a805-4f76-aca5-ade0fb8e639c","to":"protected-test-r3sF3TwBK2dlxbNYVNZky@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800707101,"env":"test","module":"email-queue","jobId":"221057b4-cd13-4acb-a75a-8d8512f5e65d","to":"session-test-RYGlMO2W-hb-5bR0VQ3Wx@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800707132,"env":"test","module":"auth-routes","userId":"2XK5j0hMslTeojAmberAG","email":"protected-test-r3sF3TwBK2dlxbNYVNZky@example.com","msg":"User registered"}
{"level":50,"time":1767800707133,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800707151,"env":"test","module":"auth-routes","userId":"CqfvypFTxGmvs09tcNM9-","email":"session-test-RYGlMO2W-hb-5bR0VQ3Wx@example.com","msg":"User registered"}
{"level":50,"time":1767800707200,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800707356,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800707365,"env":"test","module":"user-credentials-repository","userId":"gQXjPI9ZJ_eh2RZwwVV2O","msg":"User credentials created"}
{"level":50,"time":1767800707375,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800707419,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800707446,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800707468,"env":"test","module":"mfa-service","userId":"3763f91ee963943ec18de7d1f66c35c7","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800707468,"env":"test","module":"auth-routes","userId":"3763f91ee963943ec18de7d1f66c35c7","msg":"MFA verification failed during login"}
{"level":50,"time":1767800707472,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800707476,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800707480,"env":"test","module":"auth-routes","userId":"gQXjPI9ZJ_eh2RZwwVV2O","deviceCount":2,"msg":"Listed trusted devices"}
{"level":50,"time":1767800707529,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800707550,"env":"test","module":"user-credentials-repository","userId":"xPoBIGQbOqjIB_lkPviKp","msg":"User credentials created"}
{"level":50,"time":1767800707636,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800707640,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800707753,"env":"test","module":"user-credentials-repository","userId":"9SVicBy4seTwZsU0YXlOG","msg":"User credentials created"}
{"level":50,"time":1767800707801,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800707812,"env":"test","module":"user-credentials-repository","userId":"NxE2F1tVQbI7XCbiXVUsy","msg":"User credentials created"}
{"level":30,"time":1767800707839,"env":"test","module":"user-credentials-repository","userId":"bHW-tSlv942EZducxt9mE","msg":"User credentials created"}
{"level":30,"time":1767800707857,"env":"test","module":"email-queue","jobId":"1405893c-52be-4921-85de-f8d70782659b","to":"middleware-test-o--SlxBlHS20O6zSHIrXx@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800707861,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800707863,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800707908,"env":"test","module":"auth-routes","userId":"9SVicBy4seTwZsU0YXlOG","email":"middleware-test-o--SlxBlHS20O6zSHIrXx@example.com","msg":"User registered"}
{"level":30,"time":1767800707914,"env":"test","module":"auth-routes","userId":"NxE2F1tVQbI7XCbiXVUsy","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1767800707915,"env":"test","module":"user-credentials-repository","userId":"SniQN2stiFzSlNEwW-8r8","msg":"User credentials created"}
{"level":30,"time":1767800707942,"env":"test","module":"email-queue","jobId":"9d0ce2ff-ecb1-48b8-af92-35c526a6755d","to":"protected-test-PjbSOpWsuYRZVD1wLF_tg@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800707997,"env":"test","module":"auth-routes","userId":"bHW-tSlv942EZducxt9mE","email":"protected-test-PjbSOpWsuYRZVD1wLF_tg@example.com","msg":"User registered"}
{"level":30,"time":1767800708021,"env":"test","module":"email-queue","jobId":"0ef80119-e5aa-42e3-82f8-9c2882b364e9","to":"session-test-wTPQN4V1qlf64LZQLz4fA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800708077,"env":"test","module":"auth-routes","userId":"SniQN2stiFzSlNEwW-8r8","email":"session-test-wTPQN4V1qlf64LZQLz4fA@example.com","msg":"User registered"}
{"level":30,"time":1767800708126,"env":"test","module":"user-credentials-repository","userId":"MPPz0TIJJ8JhbIvHKXpyU","msg":"User credentials created"}
{"level":50,"time":1767800708133,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800708150,"env":"test","module":"auth-routes","userId":"cd7c5d26c5a7037269870995e438fd1b","msg":"User logged in successfully"}
{"level":50,"time":1767800708157,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800708201,"env":"test","module":"audit-log-service","userId":"cd7c5d26c5a7037269870995e438fd1b","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800708218,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800708239,"env":"test","module":"user-credentials-repository","userId":"oFmGtUMK2p-Wm3kSFMHER","msg":"User credentials created"}
{"level":50,"time":1767800708308,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800708354,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800708358,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  success: [33mfalse[39m,
  error: {
    code: [32m'AUTH_008'[39m,
    message: [32m'Authentication required'[39m,
    details: { errorType: [32m'UnauthorizedError'[39m },
    timestamp: [32m'2026-01-07T15:45:08.359Z'[39m
  }
}

{"level":30,"time":1767800708392,"env":"test","module":"auth-routes","userId":"oFmGtUMK2p-Wm3kSFMHER","deviceId":"74bf18f1-0ba5-4a1b-895f-f2675e903960","msg":"Trusted device revoked"}
{"level":50,"time":1767800708411,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800708415,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800708433,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800708581,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800708586,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800708609,"env":"test","module":"user-credentials-repository","userId":"kmuCzZqaHJKgKCHBfRExu","msg":"User credentials created"}
{"level":30,"time":1767800708701,"env":"test","module":"mfa-service","userId":"cd7c5d26c5a7037269870995e438fd1b","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767800708701,"env":"test","module":"mfa-service","userId":"cd7c5d26c5a7037269870995e438fd1b","msg":"Generated TOTP secret"}
{"level":30,"time":1767800708701,"env":"test","module":"auth-routes","userId":"cd7c5d26c5a7037269870995e438fd1b","msg":"MFA setup initiated"}
{"level":30,"time":1767800708707,"env":"test","module":"user-credentials-repository","userId":"mPTlN17oDgIE3ZQIOHUbY","msg":"User credentials created"}
{"level":30,"time":1767800708711,"env":"test","module":"email-queue","jobId":"292db9b0-7657-4b09-bf31-6466af8732c3","to":"middleware-test-v-Tp_grQ6lmoz1nmThDYr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800708761,"env":"test","module":"auth-routes","userId":"kmuCzZqaHJKgKCHBfRExu","email":"middleware-test-v-Tp_grQ6lmoz1nmThDYr@example.com","msg":"User registered"}
{"level":30,"time":1767800708774,"env":"test","module":"user-credentials-repository","userId":"JWSuDS9I-fROnu868eoFH","msg":"User credentials created"}
{"level":50,"time":1767800708807,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800708811,"env":"test","module":"email-queue","jobId":"3557de5a-5b16-4b14-bedf-5880645cf189","to":"protected-test-K4QVJw4i_TVH9s5JdnBqI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800708816,"env":"test","module":"user-credentials-repository","userId":"nNKvIqvffP2URWipsjuv5","msg":"User credentials created"}
{"level":50,"time":1767800708848,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800708862,"env":"test","module":"auth-routes","userId":"mPTlN17oDgIE3ZQIOHUbY","email":"protected-test-K4QVJw4i_TVH9s5JdnBqI@example.com","msg":"User registered"}
{"level":50,"time":1767800708875,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800708919,"env":"test","module":"email-queue","jobId":"df495ede-d890-4b61-8f3f-fe83689cf5ed","to":"session-test-7RHFUK-8jBz9hoc_0fSLm@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800708972,"env":"test","module":"auth-routes","userId":"nNKvIqvffP2URWipsjuv5","email":"session-test-7RHFUK-8jBz9hoc_0fSLm@example.com","msg":"User registered"}
{"level":40,"time":1767800708987,"env":"test","module":"mfa-service","userId":"410a91314c623da637dc135316421033","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800708987,"env":"test","module":"auth-routes","userId":"410a91314c623da637dc135316421033","msg":"MFA verification failed during login"}
{"level":50,"time":1767800708991,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800709049,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800709075,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800709102,"env":"test","module":"user-credentials-repository","userId":"f48RqLsDOdrHqm-R0Bk1F","msg":"User credentials created"}
{"level":50,"time":1767800709189,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800709231,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800709336,"env":"test","module":"mfa-service","userId":"8287f997c54452e70ae76855afb9312b","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800709337,"env":"test","module":"auth-routes","userId":"8287f997c54452e70ae76855afb9312b","msg":"MFA verification failed during login"}
{"level":50,"time":1767800709342,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800709448,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800709460,"env":"test","module":"user-credentials-repository","userId":"9A_ww3uHtIYgis-eHH-YL","msg":"User credentials created"}
{"level":30,"time":1767800709539,"env":"test","module":"user-credentials-repository","userId":"lxVZLxIyTon1O0UKhqUAe","msg":"User credentials created"}
{"level":30,"time":1767800709565,"env":"test","module":"email-queue","jobId":"4c4584dc-10b7-4ece-8585-50d1d11f2d8f","to":"middleware-test-MJP0j0YnNxeah98nPNghj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800709572,"env":"test","module":"user-credentials-repository","userId":"Zk-1stC5yfB5XGzvRkVXx","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800709615,"env":"test","module":"auth-routes","userId":"9A_ww3uHtIYgis-eHH-YL","email":"middleware-test-MJP0j0YnNxeah98nPNghj@example.com","msg":"User registered"}
 [31m‚ùØ[39m tests/unit/server/transferOwnership.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 13745[2mms[22m[39m
       [33m[2m‚úì[22m[39m should transfer user-owned project to org [33m 1624[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent transfer to org if user is not a member [33m 1174[2mms[22m[39m
[31m       [31m√ó[31m should allow org member to transfer org-owned project to another org they belong to[39m[33m 1107[2mms[22m[39m
       [33m[2m‚úì[22m[39m should detach workflow from project when transferring to different owner [33m 1365[2mms[22m[39m
[31m       [31m√ó[31m should keep workflow in project when transferring to same owner[39m[33m 1392[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent non-member from transferring org workflow [33m 1272[2mms[22m[39m
       [33m[2m‚úì[22m[39m should transfer database ownership [33m 959[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow org member to transfer org database [33m 1090[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent transfer to org if user is not a member [33m 1242[2mms[22m[39m
       [33m[2m‚úì[22m[39m should only allow transfer to self when targetOwnerType is user [33m 861[2mms[22m[39m
[31m       [31m√ó[31m should allow transfer from user to self (org member transferring org asset to themselves)[39m[33m 828[2mms[22m[39m
{"level":30,"time":1767800709673,"env":"test","module":"email-queue","jobId":"dd84caaa-2abc-4d27-9645-80e641cdcc68","to":"protected-test-fIBpedJNNEpnyxAYNnwYW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800709725,"env":"test","module":"auth-routes","userId":"Zk-1stC5yfB5XGzvRkVXx","email":"protected-test-fIBpedJNNEpnyxAYNnwYW@example.com","msg":"User registered"}
{"level":30,"time":1767800709725,"env":"test","module":"user-credentials-repository","userId":"ZrJIBSMjG_7TLei3H6s_D","msg":"User credentials created"}
{"level":30,"time":1767800709772,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767800709794,"env":"test","module":"email-queue","jobId":"7a71330d-29f8-43a5-824e-4268f9718e27","to":"test-1767800709214-y7y2bk@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800709794,"env":"test","module":"auth-service","email":"test-1767800709214-y7y2bk@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767800709782,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":40,"time":1767800709813,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767800709827,"env":"test","module":"email-queue","jobId":"4697d7df-b89d-4001-a125-6516e06d9f60","to":"session-test-lRr5orBe4-YGrzapaE-F9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800709828,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800709815,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1767800709816,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1767800709820,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767800709821,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767800709822,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767800709823,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767800709880,"env":"test","module":"auth-routes","userId":"ZrJIBSMjG_7TLei3H6s_D","email":"session-test-lRr5orBe4-YGrzapaE-F9@example.com","msg":"User registered"}
{"level":50,"time":1767800709930,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800709981,"env":"test","module":"user-credentials-repository","userId":"KJcI3BPuYsq-94kvzRhUa","msg":"User credentials created"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":50,"time":1767800710048,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800710053,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800710068,"env":"test","module":"user-credentials-repository","userId":"e3L4Y0I08URwU5ZTgbWyB","msg":"User credentials created"}
{"level":30,"time":1767800710105,"env":"test","module":"email-queue","jobId":"f407a492-ca45-49b6-83ff-e4d5420e5e1f","to":"test-1767800709214-y7y2bk@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800710105,"env":"test","module":"auth-service","email":"test-1767800709214-y7y2bk@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767800710177,"env":"test","module":"email-queue","jobId":"b9a80d6b-4ce0-4197-b9e9-dbdbe0899f93","to":"test-1767800709666-y0akjj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800710230,"env":"test","module":"auth-routes","userId":"e3L4Y0I08URwU5ZTgbWyB","email":"test-1767800709666-y0akjj@example.com","msg":"User registered"}
{"level":50,"time":1767800710273,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800710278,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800710296,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800710332,"env":"test","module":"user-credentials-repository","userId":"pAolzPPAgik6kzBipAARk","msg":"User credentials created"}
{"level":30,"time":1767800710440,"env":"test","module":"email-queue","jobId":"1a42d70d-d864-4ab9-b5c7-0cf94b18ce6c","to":"middleware-test-CVoQSgbdahwo8RP9xo8CS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800710461,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800710462,"env":"test","module":"user-credentials-repository","userId":"gb4FxaW3H9iPc48W7dkeZ","msg":"User credentials created"}
{"level":30,"time":1767800710495,"env":"test","module":"auth-routes","userId":"pAolzPPAgik6kzBipAARk","email":"middleware-test-CVoQSgbdahwo8RP9xo8CS@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800710505,"env":"test","module":"user-credentials-repository","error":{},"userId":"789486d719b57d8a0891debbd41c0593","msg":"Failed to update user password"}
{"level":50,"time":1767800710505,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

{"level":50,"time":1767800710554,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800710564,"env":"test","module":"email-queue","jobId":"b9b6479e-7f71-46ce-a2a1-0e88409cba46","to":"protected-test-vQv-ukEYqaprZy3dVulF4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800710577,"env":"test","module":"mfa-service","userId":"33f1e5c8d0cd790823773d3e5d158181","msg":"TOTP verification successful"}
 [31m‚ùØ[39m tests/integration/auth/oauth2.sessions.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 12893[2mms[22m[39m
       [33m[2m‚úì[22m[39m should list all active sessions for current user [33m 535[2mms[22m[39m
[31m       [31m√ó[31m should mark current session as current[39m[33m 447[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return empty array when user has no active sessions [33m 437[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not include expired sessions [33m 458[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not include revoked sessions [33m 498[2mms[22m[39m
       [33m[2m‚úì[22m[39m should parse device name from user agent [33m 456[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for unauthenticated request [33m 368[2mms[22m[39m
[31m       [31m√ó[31m should revoke a specific session[39m[33m 446[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 404 for non-existent session [33m 332[2mms[22m[39m
[31m       [31m√ó[31m should prevent revoking current session[39m[33m 483[2mms[22m[39m
[31m       [31m√ó[31m should prevent revoking another user's session[39m[33m 493[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for unauthenticated request [33m 343[2mms[22m[39m
[31m       [31m√ó[31m should revoke all sessions except current[39m[33m 768[2mms[22m[39m
       [33m[2m‚úì[22m[39m should revoke all trusted devices [33m 667[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 400 when no active session found [33m 330[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for unauthenticated request [33m 329[2mms[22m[39m
         [33m[2m‚úì[22m[39m should mark current device as trusted [33m 493[2mms[22m[39m
         [33m[2m‚úì[22m[39m should update existing trusted device expiry [33m 644[2mms[22m[39m
         [33m[2m‚úì[22m[39m should list all trusted devices [33m 442[2mms[22m[39m
         [33m[2m‚úì[22m[39m should not include revoked devices [33m 433[2mms[22m[39m
[31m         [31m√ó[31m should revoke a trusted device[39m[33m 529[2mms[22m[39m
         [33m[2m‚úì[22m[39m should return 404 for non-existent device [33m 334[2mms[22m[39m
[31m       [31m√ó[31m should track IP address for sessions[39m[33m 440[2mms[22m[39m
[31m       [31m√ó[31m should track user agent for sessions[39m[33m 423[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update lastUsedAt on token refresh [33m 803[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800710616,"env":"test","module":"auth-routes","userId":"gb4FxaW3H9iPc48W7dkeZ","email":"protected-test-vQv-ukEYqaprZy3dVulF4@example.com","msg":"User registered"}
{"level":40,"time":1767800710623,"env":"test","module":"auth-routes","userId":"e3L4Y0I08URwU5ZTgbWyB","email":"test-1767800709666-y0akjj@example.com","msg":"Login blocked: email not verified"}
{"level":50,"time":1767800710623,"env":"test","module":"auth-routes","error":{"name":"EmailNotVerifiedError","code":"AUTH_006","statusCode":403,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800710636,"env":"test","module":"auth-routes","userId":"33f1e5c8d0cd790823773d3e5d158181","msg":"MFA login successful"}
{"level":30,"time":1767800710693,"env":"test","module":"user-credentials-repository","userId":"wQ8aGeZ_xQzDpFd-vtNny","msg":"User credentials created"}
{"level":30,"time":1767800710716,"env":"test","module":"auth-routes","userId":"e0820ac1fb64e909a105b1f59fcb30df","msg":"User logged in successfully"}
{"level":30,"time":1767800710768,"env":"test","module":"audit-log-service","userId":"e0820ac1fb64e909a105b1f59fcb30df","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800710792,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"76__uUC1Ded2iI_Qt2-A-","msg":"Error creating workflow"}
{"level":30,"time":1767800710794,"env":"test","module":"email-queue","jobId":"1fcb1f16-e830-4add-b4c5-248520334309","to":"session-test-_a9HpRTUXTsI5Mn_ZNL24@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800710832,"env":"test","module":"auth-routes","userId":"33f1e5c8d0cd790823773d3e5d158181","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1767800710849,"env":"test","module":"auth-routes","userId":"wQ8aGeZ_xQzDpFd-vtNny","email":"session-test-_a9HpRTUXTsI5Mn_ZNL24@example.com","msg":"User registered"}
 [31m‚ùØ[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m22 failed[39m[2m)[22m[33m 7700[2mms[22m[39m
[31m       [31m√ó[31m should create a select column with options[39m[32m 241[2mms[22m[39m
[31m       [31m√ó[31m should create a multiselect column with options[39m[32m 216[2mms[22m[39m
[31m       [31m√ó[31m should validate select value against options[39m[32m 216[2mms[22m[39m
[31m       [31m√ó[31m should validate multiselect values as array[39m[32m 218[2mms[22m[39m
[31m       [31m√ó[31m should create an autonumber column with sequence[39m[32m 211[2mms[22m[39m
[31m       [31m√ó[31m should format autonumber with prefix[39m[32m 223[2mms[22m[39m
[31m       [31m√ó[31m should create a note for a row[39m[32m 274[2mms[22m[39m
[31m       [31m√ó[31m should get all notes for a row[39m[33m 327[2mms[22m[39m
[31m       [31m√ó[31m should delete a note[39m[32m 299[2mms[22m[39m
[31m       [31m√ó[31m should not allow deleting notes by other users[39m[32m 265[2mms[22m[39m
[31m       [31m√ó[31m should create an API token[39m[32m 215[2mms[22m[39m
[31m       [31m√ó[31m should validate API token scopes[39m[32m 214[2mms[22m[39m
[31m       [31m√ó[31m should revoke (delete) an API token[39m[32m 220[2mms[22m[39m
       [32m‚úì[39m should deny access with expired token[32m 219[2mms[22m[39m
[31m       [31m√ó[31m should grant table permission[39m[32m 222[2mms[22m[39m
[31m       [31m√ó[31m should list table permissions[39m[32m 273[2mms[22m[39m
[31m       [31m√ó[31m should update table permission role[39m[32m 226[2mms[22m[39m
[31m       [31m√ó[31m should revoke table permission[39m[32m 224[2mms[22m[39m
[31m       [31m√ó[31m should enforce RBAC - only owners can manage permissions[39m[32m 222[2mms[22m[39m
[31m       [31m√ó[31m should paginate rows efficiently[39m[33m 1027[2mms[22m[39m
[31m       [31m√ó[31m should return user-friendly error for invalid column type[39m[32m 219[2mms[22m[39m
[31m       [31m√ó[31m should return user-friendly error for missing required fields[39m[32m 227[2mms[22m[39m
[31m       [31m√ó[31m should handle network errors gracefully[39m[32m 277[2mms[22m[39m
{"level":40,"time":1767800710880,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767800710971,"env":"test","module":"auth-routes","userId":"e838a4cfa8195910f1af2a7edaa18b44","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800710992,"env":"test","module":"auth-routes","userId":"33f1e5c8d0cd790823773d3e5d158181","deviceCount":0,"msg":"Listed trusted devices"}
{"level":50,"time":1767800711000,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"76__uUC1Ded2iI_Qt2-A-","msg":"Error creating workflow"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

{"level":30,"time":1767800711068,"env":"test","module":"auth-routes","userId":"pAolzPPAgik6kzBipAARk","msg":"User logged in successfully"}
{"level":40,"time":1767800711082,"env":"test","module":"mfa-service","userId":"e838a4cfa8195910f1af2a7edaa18b44","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800711083,"env":"test","module":"auth-routes","userId":"e838a4cfa8195910f1af2a7edaa18b44","msg":"MFA verification failed during login"}
{"level":30,"time":1767800711117,"env":"test","module":"audit-log-service","userId":"pAolzPPAgik6kzBipAARk","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800711188,"env":"test","module":"auth-routes","userId":"gb4FxaW3H9iPc48W7dkeZ","msg":"User logged in successfully"}
{"level":50,"time":1767800711213,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"76__uUC1Ded2iI_Qt2-A-","msg":"Error creating workflow"}
{"level":30,"time":1767800711240,"env":"test","module":"audit-log-service","userId":"gb4FxaW3H9iPc48W7dkeZ","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800711244,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800711252,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":50,"time":1767800711415,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"76__uUC1Ded2iI_Qt2-A-","msg":"Error creating workflow"}
[90mstderr[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800711563,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800711622,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"76__uUC1Ded2iI_Qt2-A-","msg":"Error creating workflow"}
{"level":30,"time":1767800711644,"env":"test","module":"user-credentials-repository","userId":"uo367IYt9szcPT5dXnc6r","msg":"User credentials created"}
{"level":30,"time":1767800711652,"env":"test","module":"user-credentials-repository","userId":"HiVnn99PWU3S75CpNpXAE","msg":"User credentials created"}
{"level":30,"time":1767800711723,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":40,"time":1767800711735,"env":"test","module":"ai-service","attempt":4,"waitMs":16000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767800711756,"env":"test","module":"email-queue","jobId":"4f770f52-ab88-4b35-8dd9-7d4e09d74b75","to":"protected-test-ueyTnCtvk0_bq3yyf3It1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800711762,"env":"test","module":"email-queue","jobId":"6c3b9ed8-f883-43ba-a5c3-3e58d279efdf","to":"session-test-XLhT_tryDdC2llm3X4V0t@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800711766,"env":"test","module":"email-queue","jobId":"9b35ac7e-4003-4733-baca-2deaad3f2253","to":"test-1767800710918-gtjnrt@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800711766,"env":"test","module":"auth-service","email":"test-1767800710918-gtjnrt@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767800711809,"env":"test","module":"auth-routes","userId":"uo367IYt9szcPT5dXnc6r","email":"protected-test-ueyTnCtvk0_bq3yyf3It1@example.com","msg":"User registered"}
{"level":30,"time":1767800711816,"env":"test","module":"auth-routes","userId":"HiVnn99PWU3S75CpNpXAE","email":"session-test-XLhT_tryDdC2llm3X4V0t@example.com","msg":"User registered"}
{"level":50,"time":1767800711846,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"76__uUC1Ded2iI_Qt2-A-","msg":"Error creating workflow"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

{"level":50,"time":1767800711926,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800712006,"env":"test","module":"user-credentials-repository","userId":"jC6r47upSmFF7--Yow4MB","msg":"User credentials created"}
{"level":50,"time":1767800712041,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"76__uUC1Ded2iI_Qt2-A-","msg":"Error creating workflow"}
{"level":30,"time":1767800712111,"env":"test","module":"email-queue","jobId":"08cdd32f-499e-44c9-917e-7cbee93a51b9","to":"middleware-test-r9Xjw3ADNGF3JA8xvhkwv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800712162,"env":"test","module":"auth-routes","userId":"jC6r47upSmFF7--Yow4MB","email":"middleware-test-r9Xjw3ADNGF3JA8xvhkwv@example.com","msg":"User registered"}
{"level":50,"time":1767800712167,"env":"test","module":"user-credentials-repository","error":{},"userId":"354b111e0d91509735f8c6474d6222e1","msg":"Failed to update user password"}
{"level":50,"time":1767800712167,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":50,"time":1767800712172,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800712194,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767800712199,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":50,"time":1767800712241,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"76__uUC1Ded2iI_Qt2-A-","msg":"Error creating workflow"}
{"level":40,"time":1767800712257,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstderr[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:29:5 {
  length: [33m361[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(76__uUC1Ded2iI_Qt2-A-) is still referenced from table "workflow_versions".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'workflow_versions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'workflow_versions_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800712324,"env":"test","module":"user-credentials-repository","userId":"ZOhJiKZghvB4Bn8BtZoPR","msg":"User credentials created"}
{"level":50,"time":1767800712353,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800712363,"env":"test","module":"auth-routes","userId":"uo367IYt9szcPT5dXnc6r","msg":"User logged in successfully"}
{"level":30,"time":1767800712405,"env":"test","module":"auth-routes","userId":"42bc3252088983e04468955ce23f23c2","msg":"User logged in successfully"}
{"level":30,"time":1767800712414,"env":"test","module":"audit-log-service","userId":"uo367IYt9szcPT5dXnc6r","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800712419,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800712432,"env":"test","module":"email-queue","jobId":"606be73e-ea11-4190-b73d-2f2a7ebcccbd","to":"session-test-IvVwMaSLbPRfEkjA_r7cq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800712454,"env":"test","module":"audit-log-service","userId":"42bc3252088983e04468955ce23f23c2","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800712487,"env":"test","module":"auth-routes","userId":"ZOhJiKZghvB4Bn8BtZoPR","email":"session-test-IvVwMaSLbPRfEkjA_r7cq@example.com","msg":"User registered"}
{"level":30,"time":1767800712499,"env":"test","module":"auth-routes","userId":"892f1679382b38f53e8be08bd3228abb","msg":"User logged in successfully"}
{"level":30,"time":1767800712565,"env":"test","module":"audit-log-service","userId":"892f1679382b38f53e8be08bd3228abb","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [31m‚ùØ[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 9381[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create a new draft workflow [33m 382[2mms[22m[39m
[31m       [31m√ó[31m should reject without permission[39m[32m 7[2mms[22m[39m
       [33m[2m‚úì[22m[39m should list workflows [33m 517[2mms[22m[39m
       [33m[2m‚úì[22m[39m should filter by status [33m 526[2mms[22m[39m
       [33m[2m‚úì[22m[39m should search by name [33m 863[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update draft workflow [33m 676[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not allow editing published workflow [33m 873[2mms[22m[39m
       [33m[2m‚úì[22m[39m should publish workflow [33m 711[2mms[22m[39m
       [33m[2m‚úì[22m[39m should list workflow versions [33m 901[2mms[22m[39m
[31m       [31m√ó[31m should move workflow to a project[39m[32m 209[2mms[22m[39m
[31m       [31m√ó[31m should move workflow to Main Folder (projectId = null)[39m[32m 208[2mms[22m[39m
[31m       [31m√ó[31m should reject move to non-existent project[39m[32m 213[2mms[22m[39m
[31m       [31m√ó[31m should reject move without authentication[39m[32m 201[2mms[22m[39m
[31m       [31m√ó[31m should reject move of workflow user does not own[39m[32m 208[2mms[22m[39m
[31m       [31m√ó[31m should reject move with invalid projectId format[39m[32m 224[2mms[22m[39m
[31m       [31m√ó[31m should reject move without projectId in body[39m[32m 195[2mms[22m[39m
[31m       [31m√ó[31m should reject move to project user does not have access to[39m[32m 199[2mms[22m[39m
{"level":40,"time":1767800712597,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767800712662,"env":"test","module":"auth-routes","userId":"0ad892253014ffd368d7d7f908342f80","msg":"Login requires MFA verification"}
{"level":30,"time":1767800712713,"env":"test","module":"auth-routes","userId":"jC6r47upSmFF7--Yow4MB","msg":"User logged in successfully"}
{"level":30,"time":1767800712766,"env":"test","module":"audit-log-service","userId":"jC6r47upSmFF7--Yow4MB","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767800712774,"env":"test","module":"mfa-service","userId":"0ad892253014ffd368d7d7f908342f80","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800712774,"env":"test","module":"auth-routes","userId":"0ad892253014ffd368d7d7f908342f80","msg":"MFA verification failed during login"}
{"level":50,"time":1767800712779,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800712784,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800712822,"env":"test","module":"user-credentials-repository","userId":"KloUVAHvvI7PXUOq5ZTol","msg":"User credentials created"}
{"level":50,"time":1767800712830,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800712878,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800712930,"env":"test","module":"email-queue","jobId":"27373c89-be84-49a2-8f08-e1fc6cfcb1e4","to":"protected-test-tDkxDEo-RAacNcgV5r9Od@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800712940,"env":"test","module":"auth-routes","userId":"892f1679382b38f53e8be08bd3228abb","sessionCount":0,"msg":"Listed active sessions"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39müßπ Cleaning up test environment...

 [31m‚ùØ[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 7784[2mms[22m[39m
         [32m‚úì[39m should hash a password using bcrypt with 12 rounds[32m 215[2mms[22m[39m
         [33m[2m‚úì[22m[39m should generate different hashes for same password [33m 429[2mms[22m[39m
         [32m‚úì[39m should handle empty passwords[32m 214[2mms[22m[39m
         [32m‚úì[39m should handle long passwords[32m 219[2mms[22m[39m
         [32m‚úì[39m should handle unicode characters in password[32m 215[2mms[22m[39m
         [33m[2m‚úì[22m[39m should return true for correct password [33m 433[2mms[22m[39m
         [33m[2m‚úì[22m[39m should return false for incorrect password [33m 435[2mms[22m[39m
         [33m[2m‚úì[22m[39m should be case-sensitive [33m 452[2mms[22m[39m
         [33m[2m‚úì[22m[39m should handle empty password comparison [33m 445[2mms[22m[39m
         [32m‚úì[39m should accept valid email addresses[32m 2[2mms[22m[39m
         [32m‚úì[39m should reject emails longer than 254 characters (RFC 5321)[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject emails shorter than 3 characters[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject emails with consecutive dots[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject emails without @ symbol[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject emails without domain[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject emails with spaces[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject emails without TLD[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject null or undefined[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject emails with local part longer than 64 characters[32m 1[2mms[22m[39m
         [32m‚úì[39m should accept valid strong passwords[32m 20[2mms[22m[39m
         [32m‚úì[39m should reject passwords shorter than 8 characters[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject passwords longer than 128 characters[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject weak passwords with zxcvbn score < 3[32m 5[2mms[22m[39m
         [32m‚úì[39m should provide helpful feedback for weak passwords[32m 2[2mms[22m[39m
         [32m‚úì[39m should reject password containing user's email[32m 3[2mms[22m[39m
         [32m‚úì[39m should reject password containing user's name[32m 2[2mms[22m[39m
         [32m‚úì[39m should accept strong password even with user inputs provided[32m 3[2mms[22m[39m
         [32m‚úì[39m should accept password with exactly 8 characters if strong enough[32m 1[2mms[22m[39m
         [32m‚úì[39m should accept password with exactly 128 characters if strong[32m 110[2mms[22m[39m
         [32m‚úì[39m should return score in result object[32m 4[2mms[22m[39m
         [32m‚úì[39m should create a valid JWT token for a user[32m 5[2mms[22m[39m
[31m         [31m√ó[31m should include userId, email, tenantId, and role in token payload[39m[32m 10[2mms[22m[39m
         [32m‚úì[39m should set token expiry to 15 minutes by default[32m 2[2mms[22m[39m
         [32m‚úì[39m should throw error if JWT_SECRET is not configured[32m 2[2mms[22m[39m
[31m         [31m√ó[31m should handle null tenantId and role[39m[32m 2[2mms[22m[39m
[31m         [31m√ó[31m should verify and decode a valid token[39m[32m 3[2mms[22m[39m
         [33m[2m‚úì[22m[39m should throw error for expired token [33m 1106[2mms[22m[39m
[31m         [31m√ó[31m should throw error for invalid token signature[39m[32m 4[2mms[22m[39m
[31m         [31m√ó[31m should throw error for malformed token[39m[32m 2[2mms[22m[39m
[31m         [31m√ó[31m should throw error for invalid token[39m[32m 1[2mms[22m[39m
         [32m‚úì[39m should extract token from Bearer authorization header[32m 1[2mms[22m[39m
         [32m‚úì[39m should return token if no Bearer prefix[32m 1[2mms[22m[39m
         [32m‚úì[39m should return null for undefined header[32m 1[2mms[22m[39m
         [32m‚úì[39m should return null for empty header[32m 1[2mms[22m[39m
         [32m‚úì[39m should handle Bearer with multiple spaces[32m 1[2mms[22m[39m
         [32m‚úì[39m should return true for JWT-like tokens[32m 1[2mms[22m[39m
         [32m‚úì[39m should return false for non-JWT tokens[32m 1[2mms[22m[39m
         [32m‚úì[39m should return false for empty token[32m 1[2mms[22m[39m
         [32m‚úì[39m should return false for null/undefined[32m 1[2mms[22m[39m
         [32m‚úì[39m should create a valid portal token for an email[32m 2[2mms[22m[39m
         [32m‚úì[39m should include email and portal flag in token payload[32m 1[2mms[22m[39m
         [32m‚úì[39m should set token expiry to 24 hours[32m 1[2mms[22m[39m
         [32m‚úì[39m should verify and decode a valid portal token[32m 2[2mms[22m[39m
         [32m‚úì[39m should throw error for non-portal token[32m 1[2mms[22m[39m
         [32m‚úì[39m should throw error for token without email[32m 2[2mms[22m[39m
         [32m‚úì[39m should throw error for expired portal token[32m 1[2mms[22m[39m
         [32m‚úì[39m should generate password reset token for existing user[32m 232[2mms[22m[39m
         [32m‚úì[39m should return null for non-existent user[32m 3[2mms[22m[39m
         [32m‚úì[39m should invalidate previous reset tokens[32m 7[2mms[22m[39m
         [32m‚úì[39m should return userId for valid token[32m 6[2mms[22m[39m
         [32m‚úì[39m should return null for invalid token[32m 1[2mms[22m[39m
         [32m‚úì[39m should return null for expired token[32m 1[2mms[22m[39m
         [32m‚úì[39m should return null for used token[32m 1[2mms[22m[39m
         [32m‚úì[39m should mark token as used[32m 2[2mms[22m[39m
         [32m‚úì[39m should generate verification token[32m 2[2mms[22m[39m
         [32m‚úì[39m should have 24 hour expiry[32m 1[2mms[22m[39m
         [32m‚úì[39m should verify email with valid token[32m 1[2mms[22m[39m
         [32m‚úì[39m should return false for invalid token[32m 1[2mms[22m[39m
         [32m‚úì[39m should return false for expired token[32m 1[2mms[22m[39m
         [32m‚úì[39m should delete token after successful verification[32m 1[2mms[22m[39m
         [32m‚úì[39m should create refresh token with 30-day expiry[32m 2[2mms[22m[39m
         [32m‚úì[39m should store device metadata[32m 1[2mms[22m[39m
         [32m‚úì[39m should return userId for valid token[32m 1[2mms[22m[39m
         [32m‚úì[39m should return null for revoked token[32m 1[2mms[22m[39m
         [32m‚úì[39m should return null for expired token[32m 1[2mms[22m[39m
         [32m‚úì[39m should rotate valid token and return new one[32m 1[2mms[22m[39m
         [32m‚úì[39m should return null for unknown token[32m 1[2mms[22m[39m
         [32m‚úì[39m should revoke all tokens on reuse detection[32m 2[2mms[22m[39m
         [32m‚úì[39m should return null for expired token[32m 1[2mms[22m[39m
         [32m‚úì[39m should revoke specific token[32m 1[2mms[22m[39m
         [32m‚úì[39m should revoke all tokens for user[32m 1[2mms[22m[39m
         [32m‚úì[39m should cleanup expired refresh tokens[32m 1[2mms[22m[39m
         [32m‚úì[39m should cleanup expired password reset tokens[32m 1[2mms[22m[39m
         [32m‚úì[39m should cleanup expired email verification tokens[32m 1[2mms[22m[39m
         [32m‚úì[39m should cleanup old login attempts via accountLockoutService[32m 1[2mms[22m[39m
         [32m‚úì[39m should use JWT_SECRET if provided[32m 1[2mms[22m[39m
         [32m‚úì[39m should warn if JWT_SECRET is less than 32 characters[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject token with modified payload[32m 1[2mms[22m[39m
[31m         [31m√ó[31m should reject token with valid structure but invalid signature[39m[32m 2[2mms[22m[39m
         [33m[2m‚úì[22m[39m should handle password with special characters [33m 487[2mms[22m[39m
         [32m‚úì[39m should handle password with only spaces[32m 228[2mms[22m[39m
         [33m[2m‚úì[22m[39m should handle password with newlines and tabs [33m 479[2mms[22m[39m
         [33m[2m‚úì[22m[39m should reject password with null bytes (if validation exists) [33m 457[2mms[22m[39m
         [32m‚úì[39m should reject email with unicode domain (security fix)[32m 2[2mms[22m[39m
         [32m‚úì[39m should reject email starting with dot (security fix)[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject email ending with dot before @ (security fix)[32m 1[2mms[22m[39m
         [32m‚úì[39m should handle email with plus addressing[32m 1[2mms[22m[39m
         [32m‚úì[39m should handle email with subdomain[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject email with invalid TLD (single char)[32m 1[2mms[22m[39m
         [32m‚úì[39m should accept email with numeric TLD[32m 1[2mms[22m[39m
         [32m‚úì[39m should prevent timing attacks on token validation[32m 1[2mms[22m[39m
         [32m‚úì[39m should support full user authentication lifecycle[32m 232[2mms[22m[39m
         [33m[2m‚úì[22m[39m should support complete password reset workflow [33m 477[2mms[22m[39m
         [32m‚úì[39m should prevent reuse of password reset tokens[32m 2[2mms[22m[39m
         [32m‚úì[39m should support multiple valid refresh tokens per user[32m 2[2mms[22m[39m
         [32m‚úì[39m should revoke all user tokens on security event[32m 1[2mms[22m[39m
         [32m‚úì[39m should handle database connection failures gracefully[32m 2[2mms[22m[39m
         [32m‚úì[39m should handle transaction failures[32m 1[2mms[22m[39m
         [32m‚úì[39m should throw error if JWT signing fails[32m 1[2mms[22m[39m
         [32m‚úì[39m should hash password in reasonable time (< 500ms)[32m 239[2mms[22m[39m
         [33m[2m‚úì[22m[39m should compare password in reasonable time (< 500ms) [33m 493[2mms[22m[39m
         [32m‚úì[39m should create JWT token in < 10ms[32m 2[2mms[22m[39m
         [32m‚úì[39m should verify JWT token in < 10ms[32m 3[2mms[22m[39m
{"level":30,"time":1767800712984,"env":"test","module":"auth-routes","userId":"KloUVAHvvI7PXUOq5ZTol","email":"protected-test-tDkxDEo-RAacNcgV5r9Od@example.com","msg":"User registered"}
{"level":30,"time":1767800713004,"env":"test","module":"mfa-service","userId":"42bc3252088983e04468955ce23f23c2","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767800713004,"env":"test","module":"mfa-service","userId":"42bc3252088983e04468955ce23f23c2","msg":"Generated TOTP secret"}
{"level":30,"time":1767800713004,"env":"test","module":"auth-routes","userId":"42bc3252088983e04468955ce23f23c2","msg":"MFA setup initiated"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

{"level":50,"time":1767800713123,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800713300,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800713313,"env":"test","module":"user-credentials-repository","userId":"hI0d7H4auMc1FhdzI5P5o","msg":"User credentials created"}
{"level":30,"time":1767800713329,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1767800713345,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800713416,"env":"test","module":"email-queue","jobId":"e75e405a-2dac-4da7-8c6e-6293df9c1fd2","to":"session-test-1mO9aHg1eZ39xqTGtELE8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800713467,"env":"test","module":"auth-routes","userId":"hI0d7H4auMc1FhdzI5P5o","email":"session-test-1mO9aHg1eZ39xqTGtELE8@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767800713572,"env":"test","module":"user-credentials-repository","userId":"64JAApi_T9UuX4iGYntaZ","msg":"User credentials created"}
{"level":30,"time":1767800713676,"env":"test","module":"email-queue","jobId":"27ac9fa4-593c-4a4c-a706-bc6ab47d987e","to":"middleware-test-LlfEpL6BJ3TVpsO9MnFEB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800713720,"env":"test","module":"user-credentials-repository","userId":"fKjZE4WZEv7f6Rm_JgWY1","msg":"User credentials created"}
{"level":30,"time":1767800713723,"env":"test","module":"auth-routes","userId":"64JAApi_T9UuX4iGYntaZ","email":"middleware-test-LlfEpL6BJ3TVpsO9MnFEB@example.com","msg":"User registered"}
{"level":30,"time":1767800713796,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800713816,"env":"test","module":"user-credentials-repository","userId":"14cWTZcU_nvfz-txOfVAY","msg":"User credentials created"}
{"level":30,"time":1767800713824,"env":"test","module":"email-queue","jobId":"9a192e7e-1f89-4d62-b168-d607beebe349","to":"protected-test-wWM4byfxuQSdrcry3zDD3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800713836,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767800713879,"env":"test","module":"auth-routes","userId":"fKjZE4WZEv7f6Rm_JgWY1","email":"protected-test-wWM4byfxuQSdrcry3zDD3@example.com","msg":"User registered"}
{"level":50,"time":1767800714004,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800714039,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800714214,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800714263,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800714279,"env":"test","module":"user-credentials-repository","userId":"ooXrHCWeSBaxmO4pUXwXh","msg":"User credentials created"}
{"level":50,"time":1767800714326,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800714350,"env":"test","module":"user-credentials-repository","userId":"DtJOc1jWZHDuLgGxFAnPu","msg":"User credentials created"}
{"level":50,"time":1767800714357,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800714385,"env":"test","module":"email-queue","jobId":"577b4bd5-c8a7-4970-a126-e3b004b96ece","to":"session-test-AhXCnUZmtsS17grYTprBD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800714436,"env":"test","module":"mfa-service","userId":"edc75bf5616e2196580f5100bbaa95fa","msg":"TOTP verification successful"}
{"level":30,"time":1767800714442,"env":"test","module":"auth-routes","userId":"ooXrHCWeSBaxmO4pUXwXh","email":"session-test-AhXCnUZmtsS17grYTprBD@example.com","msg":"User registered"}
{"level":30,"time":1767800714453,"env":"test","module":"user-credentials-repository","userId":"Bpdd7WysilYAJe2vPcJkT","msg":"User credentials created"}
{"level":30,"time":1767800714492,"env":"test","module":"auth-routes","userId":"edc75bf5616e2196580f5100bbaa95fa","msg":"MFA login successful"}
{"level":50,"time":1767800714527,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800714561,"env":"test","module":"email-queue","jobId":"407ed874-8e34-46f5-be5c-a66b07821d10","to":"middleware-test-QDU4SnTyjRHUw4cmMzd1w@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767800714617,"env":"test","module":"auth-routes","userId":"Bpdd7WysilYAJe2vPcJkT","email":"middleware-test-QDU4SnTyjRHUw4cmMzd1w@example.com","msg":"User registered"}
{"level":30,"time":1767800714619,"env":"test","module":"user-credentials-repository","userId":"9_SUGO8F_dUyTkGmCSXzB","msg":"User credentials created"}
[90mstderr[2m | tests/integration/regression-REG-1.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":40,"time":1767800714672,"env":"test","module":"auth-service","userId":"DtJOc1jWZHDuLgGxFAnPu","tokenHash":"e8b787f66624b6c7b17e78a2b3266b58ead6c88cd320cb12d9ab5c120a7d6e24","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":50,"time":1767800714679,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800714679,"env":"test","module":"auth-routes","userId":"0f0a34f7f3d111d766b6b779711bc221","msg":"User logged in successfully"}
{"level":30,"time":1767800714726,"env":"test","module":"email-queue","jobId":"32e33fcc-11f8-43c5-b8e6-4b2e9c936b28","to":"protected-test-uwUjDduGwyxkk5MPOtXBw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800714730,"env":"test","module":"audit-log-service","userId":"0f0a34f7f3d111d766b6b779711bc221","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800714778,"env":"test","module":"auth-routes","userId":"9_SUGO8F_dUyTkGmCSXzB","email":"protected-test-uwUjDduGwyxkk5MPOtXBw@example.com","msg":"User registered"}
{"level":50,"time":1767800714783,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800714930,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800714929,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767800714939,"env":"test","module":"user-credentials-repository","userId":"SD6rEfMJf0VbX9ZkZB30a","msg":"User credentials created"}
{"level":40,"time":1767800714996,"env":"test","module":"auth-service","tokenHash":"65b7c7bb063d0745c9db347efc2619d6f90dd34b311301e61d1f615d6826f9ce","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767800715045,"env":"test","module":"email-queue","jobId":"643981a1-5eab-4bad-b1ed-0b6d17822222","to":"user2-upe1ZioeCqhiZWc3eK0Qz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800715058,"env":"test","module":"user-credentials-repository","userId":"Ep5WiKNWC8FIyD0iacL9F","msg":"User credentials created"}
{"level":50,"time":1767800715099,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800715099,"env":"test","module":"auth-routes","userId":"SD6rEfMJf0VbX9ZkZB30a","email":"user2-upe1ZioeCqhiZWc3eK0Qz@example.com","msg":"User registered"}
{"level":50,"time":1767800715118,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800715317,"env":"test","module":"user-credentials-repository","userId":"R1udmE6ZIn4ao3i2GkNu-","msg":"User credentials created"}
{"level":50,"time":1767800715406,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800715428,"env":"test","module":"email-queue","jobId":"4d1d4ab3-68e2-4cdf-9773-f98db89dde0c","to":"middleware-test-lcFg9ntHV_9pB2iChuscn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800715431,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800715436,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800715482,"env":"test","module":"auth-routes","userId":"R1udmE6ZIn4ao3i2GkNu-","email":"middleware-test-lcFg9ntHV_9pB2iChuscn@example.com","msg":"User registered"}
{"level":30,"time":1767800715494,"env":"test","module":"user-credentials-repository","userId":"4WkiTvHhRFwOXiHGRFI9s","msg":"User credentials created"}
{"level":30,"time":1767800715549,"env":"test","module":"user-credentials-repository","userId":"iRelhFLXisP0_k3YvQvQ3","msg":"User credentials created"}
{"level":30,"time":1767800715607,"env":"test","module":"email-queue","jobId":"dbfd2105-38b0-4cae-801a-68d161c19ad2","to":"protected-test-vnxp8aA5C8uh9EQTApeF0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800715659,"env":"test","module":"auth-routes","userId":"4WkiTvHhRFwOXiHGRFI9s","email":"protected-test-vnxp8aA5C8uh9EQTApeF0@example.com","msg":"User registered"}
{"level":40,"time":1767800715740,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767800715781,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1767800715793,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800715808,"env":"test","module":"user-credentials-repository","userId":"x5dyyDezOUgwce_XlRS_m","msg":"User credentials created"}
{"level":30,"time":1767800715915,"env":"test","module":"email-queue","jobId":"617a668d-285b-419c-bd20-8daff547701d","to":"session-test-mTolVx5YsNVkrdIdxcN6o@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800715970,"env":"test","module":"auth-routes","userId":"x5dyyDezOUgwce_XlRS_m","email":"session-test-mTolVx5YsNVkrdIdxcN6o@example.com","msg":"User registered"}
{"level":50,"time":1767800715969,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800716060,"env":"test","module":"auth-routes","userId":"c30d53c83ef4858971c6d9efae2cec20","msg":"User logged in successfully"}
{"level":50,"time":1767800716074,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800716076,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767800716111,"env":"test","module":"audit-log-service","userId":"c30d53c83ef4858971c6d9efae2cec20","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800716140,"env":"test","module":"user-credentials-repository","userId":"kL5pksshxPv81N_-cKsCB","msg":"User credentials created"}
{"level":50,"time":1767800716164,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800716189,"env":"test","module":"user-credentials-repository","userId":"jKisPUY7l1qILmN6nQDAS","msg":"User credentials created"}
{"level":30,"time":1767800716291,"env":"test","module":"email-queue","jobId":"a5c7d9b7-1413-4eb2-ae2d-357a634b98d1","to":"middleware-test-vxCn1kg-8iGGISezMDr6H@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800716340,"env":"test","module":"auth-routes","userId":"jKisPUY7l1qILmN6nQDAS","email":"middleware-test-vxCn1kg-8iGGISezMDr6H@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800716341,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800716342,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800716359,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800716368,"env":"test","module":"user-credentials-repository","userId":"hTJXokJpQnpKpRzOVUrWg","msg":"User credentials created"}
{"level":50,"time":1767800716435,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800716439,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800716469,"env":"test","module":"email-queue","jobId":"85bc231c-e48b-4b9f-a31c-314170cbb31a","to":"protected-test--7gsJQxat4pDTN6i38Kw-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767800716471,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767800716528,"env":"test","module":"auth-routes","userId":"hTJXokJpQnpKpRzOVUrWg","email":"protected-test--7gsJQxat4pDTN6i38Kw-@example.com","msg":"User registered"}
{"level":50,"time":1767800716615,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800716723,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800716736,"env":"test","module":"user-credentials-repository","userId":"WkN-Ct1EBMtT20vvWXQje","msg":"User credentials created"}
{"level":50,"time":1767800716736,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800716737,"env":"test","module":"user-credentials-repository","userId":"YA26mHduJn-qMFGHeUJWt","msg":"User credentials created"}
{"level":50,"time":1767800716737,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800716835,"env":"test","module":"mfa-service","userId":"96b70a8b7a8862ef9aab1684a23fd8fe","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800716835,"env":"test","module":"auth-routes","userId":"96b70a8b7a8862ef9aab1684a23fd8fe","msg":"MFA verification failed during login"}
{"level":50,"time":1767800716839,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800716842,"env":"test","module":"email-queue","jobId":"7871149b-cbbf-47f2-8769-583e2c55ce68","to":"session-test-XDzeidkpAk6FxL_suMXnv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800716843,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstderr[2m | tests/integration/api.templates-runs.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":40,"time":1767800716863,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767800716873,"env":"test","module":"auth-routes","userId":"jKisPUY7l1qILmN6nQDAS","msg":"User logged in successfully"}
{"level":50,"time":1767800716886,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800716894,"env":"test","module":"auth-routes","userId":"YA26mHduJn-qMFGHeUJWt","email":"session-test-XDzeidkpAk6FxL_suMXnv@example.com","msg":"User registered"}
{"level":40,"time":1767800716924,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":50,"time":1767800716927,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800716928,"env":"test","module":"audit-log-service","userId":"jKisPUY7l1qILmN6nQDAS","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767800716924,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767800716925,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767800716925,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767800716927,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767800716927,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767800716927,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":50,"time":1767800716934,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstderr[2m | tests/integration/regression-REG-1.test.ts[2m > [22m[2mREG-1: Workflow Logic Regression
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/integration/regression-REG-1.test.ts:79:13 {
  length: [33m376[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(98d686a5-75b4-4670-bc4e-06eba90b715d) is still referenced from table "workflow_versions".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'workflow_versions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'workflow_versions_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39müßπ Cleaning up test environment...

 [31m‚ùØ[39m tests/integration/regression-REG-1.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 2905[2mms[22m[39m
       [33m[2m‚úì[22m[39m should block Next when required visible question is empty [33m 328[2mms[22m[39m
[31m       [31m√ó[31m should NOT block Next when required question is hidden[39m[33m 350[2mms[22m[39m
       [33m[2m‚úì[22m[39m should block when required becomes visible and is empty [33m 325[2mms[22m[39m
[31m       [31m√ó[31m should skip hidden required page entirely[39m[33m 395[2mms[22m[39m
       [33m[2m‚úì[22m[39m should enforce required on visible page [33m 452[2mms[22m[39m
[31m       [31m√ó[31m should evaluate visibility consistently across modes[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should handle malformed visibility expression gracefully[32m 2[2mms[22m[39m
       [32m‚úì[39m should handle missing variable in visibility expression[32m 0[2mms[22m[39m
{"level":40,"time":1767800717031,"env":"test","module":"mfa-service","userId":"eacea1997543cd14a07e3285efcedb5e","msg":"No enabled MFA secret found for user"}
{"level":30,"time":1767800717069,"env":"test","module":"auth-routes","userId":"hTJXokJpQnpKpRzOVUrWg","msg":"User logged in successfully"}
{"level":40,"time":1767800717083,"env":"test","module":"mfa-service","userId":"eacea1997543cd14a07e3285efcedb5e","msg":"No unused backup codes available"}
{"level":40,"time":1767800717084,"env":"test","module":"auth-routes","userId":"eacea1997543cd14a07e3285efcedb5e","msg":"MFA verification failed during login"}
{"level":30,"time":1767800717124,"env":"test","module":"audit-log-service","userId":"hTJXokJpQnpKpRzOVUrWg","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800717154,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstderr[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800717160,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800717175,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts[2m > [22m[2mTemplates and Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800717163,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800717163,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800717170,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800717175,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800717175,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800717175,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800717175,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1767800717273,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800717318,"env":"test","module":"user-credentials-repository","userId":"Cqs2STNPZFO21Rbm_x5bK","msg":"User credentials created"}
{"level":30,"time":1767800717331,"env":"test","module":"user-credentials-repository","userId":"79PezdnZHUM2MviSUIA1K","msg":"User credentials created"}
{"level":50,"time":1767800717392,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800717397,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

{"level":30,"time":1767800717424,"env":"test","module":"email-queue","jobId":"691f1d6e-126f-4a13-a3be-92d9b289cdf5","to":"middleware-test-G24LqcshRDtWROFz1INIh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800717424,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":50,"time":1767800717432,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800717444,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1767800717432,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800717433,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800717438,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800717444,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800717444,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800717444,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800717444,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":40,"time":1767800717447,"env":"test","module":"auth-service","tokenHash":"4efde8fcc7ffe72ee048e30fdddf32aa1e24b9ae46b2ceef098366a0b526848a","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767800717480,"env":"test","module":"auth-routes","userId":"Cqs2STNPZFO21Rbm_x5bK","email":"middleware-test-G24LqcshRDtWROFz1INIh@example.com","msg":"User registered"}
{"level":50,"time":1767800717494,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39müßπ Cleaning up test environment...

 [31m‚ùØ[39m tests/integration/auth/oauth2.token-refresh.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 19917[2mms[22m[39m
[31m       [31m√ó[31m should refresh access token with valid refresh token[39m[33m 694[2mms[22m[39m
[31m       [31m√ó[31m should rotate refresh token after use[39m[33m 668[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 when refresh token is missing [33m 396[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for invalid refresh token [33m 448[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for expired refresh token [33m 494[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for revoked refresh token [33m 518[2mms[22m[39m
[31m       [31m√ó[31m should return 401 when user is not found[39m[33m 509[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update refresh token metadata on rotation [33m 648[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle concurrent refresh token requests (token reuse detection) [33m 658[2mms[22m[39m
[31m       [31m√ó[31m should set secure cookie in production[39m[33m 437[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set proper cookie attributes [33m 601[2mms[22m[39m
[31m       [31m√ó[31m should include user role information in response[39m[33m 614[2mms[22m[39m
[31m       [31m√ó[31m should create refresh token on login[39m[33m 638[2mms[22m[39m
[31m       [31m√ó[31m should revoke refresh token on logout[39m[33m 491[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle logout without refresh token gracefully [33m 387[2mms[22m[39m
[31m       [31m√ó[31m should support multiple active refresh tokens per user[39m[33m 539[2mms[22m[39m
       [33m[2m‚úì[22m[39m should revoke all user tokens on password reset [33m 577[2mms[22m[39m
       [33m[2m‚úì[22m[39m should use cryptographically strong random tokens [33m 5670[2mms[22m[39m
       [33m[2m‚úì[22m[39m should hash refresh tokens before storing in database [33m 511[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent refresh token reuse after rotation [33m 747[2mms[22m[39m
[31m       [31m√ó[31m should validate token ownership[39m[33m 489[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set HttpOnly flag to prevent XSS [33m 594[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set SameSite=Strict to prevent CSRF [33m 596[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set proper cookie path [33m 597[2mms[22m[39m
[31m       [31m√ó[31m should set appropriate expiry (30 days)[39m[33m 446[2mms[22m[39m
{"level":30,"time":1767800717666,"env":"test","module":"user-credentials-repository","userId":"KICO3hoeY3PwS8SViV0x8","msg":"User credentials created"}
{"level":30,"time":1767800717666,"env":"test","module":"user-credentials-repository","userId":"0Ld98Nk_FFQJBTcxEXP2J","msg":"User credentials created"}
{"level":50,"time":1767800717753,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800717757,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800717775,"env":"test","module":"email-queue","jobId":"8d9d74fc-f70b-4045-ae45-90c3df0309ba","to":"session-test-fF63mJlcdBBN09txkfodq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800717778,"env":"test","module":"email-queue","jobId":"e4384f38-8c6d-43ad-aed5-252314b06349","to":"test-dlUmIPYYtdeqWr9OUU1KC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800717792,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800717828,"env":"test","module":"auth-routes","userId":"KICO3hoeY3PwS8SViV0x8","email":"session-test-fF63mJlcdBBN09txkfodq@example.com","msg":"User registered"}
{"level":30,"time":1767800717836,"env":"test","module":"auth-routes","userId":"0Ld98Nk_FFQJBTcxEXP2J","email":"test-dlUmIPYYtdeqWr9OUU1KC@example.com","msg":"User registered"}
 [31m‚ùØ[39m tests/integration/auth.flows.real.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 20134[2mms[22m[39m
[31m       [31m√ó[31m should complete registration, verify email, then login[39m[33m 1727[2mms[22m[39m
[31m       [31m√ó[31m should lock account after 5 failed attempts, then unlock after waiting[39m[33m 2411[2mms[22m[39m
[31m       [31m√ó[31m should record all login attempts[39m[33m 1623[2mms[22m[39m
[31m       [31m√ó[31m should complete MFA setup and login with TOTP[39m[33m 1957[2mms[22m[39m
[31m       [31m√ó[31m should login with backup code when TOTP unavailable[39m[33m 1922[2mms[22m[39m
[31m       [31m√ó[31m should complete full password reset flow[39m[33m 1696[2mms[22m[39m
       [33m[2m‚úì[22m[39m should invalidate all sessions after password reset [33m 1769[2mms[22m[39m
[31m       [31m√ó[31m should rotate refresh token on each use[39m[33m 1073[2mms[22m[39m
       [33m[2m‚úì[22m[39m should detect and prevent refresh token reuse (token theft) [33m 1756[2mms[22m[39m
[31m       [31m√ó[31m should list all active sessions[39m[33m 1337[2mms[22m[39m
[31m       [31m√ó[31m should revoke specific session[39m[33m 1318[2mms[22m[39m
{"level":30,"time":1767800718037,"env":"test","module":"user-credentials-repository","userId":"PGTUCfEfz9PHEH97jGrYa","msg":"User credentials created"}
{"level":30,"time":1767800718143,"env":"test","module":"email-queue","jobId":"848455b7-8f7a-4624-a937-1cf5cd608f96","to":"test-qDJKSVBnVRMX4WSDmNdJ6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800718166,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800718171,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

{"level":30,"time":1767800718203,"env":"test","module":"auth-routes","userId":"PGTUCfEfz9PHEH97jGrYa","email":"test-qDJKSVBnVRMX4WSDmNdJ6@example.com","msg":"User registered"}
{"level":50,"time":1767800718207,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800718220,"env":"test","module":"user-credentials-repository","userId":"6PZBGeibP3WPaZs5zupcH","msg":"User credentials created"}
{"level":30,"time":1767800718273,"env":"test","module":"user-credentials-repository","userId":"bQCLEZNIUK11OFK5O8Ui8","msg":"User credentials created"}
{"level":30,"time":1767800718324,"env":"test","module":"email-queue","jobId":"6d78fd44-e8e9-4a6b-a765-dfe5298cb5da","to":"middleware-test-y-d2h5tN--EOWwn7Es7Ox@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800718338,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800718376,"env":"test","module":"auth-routes","userId":"6PZBGeibP3WPaZs5zupcH","email":"middleware-test-y-d2h5tN--EOWwn7Es7Ox@example.com","msg":"User registered"}
{"level":30,"time":1767800718378,"env":"test","module":"email-queue","jobId":"423e23f0-0346-49ea-945b-5ccb5025cfa6","to":"protected-test-6WhpDnNE896WqKH6-QkPv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800718433,"env":"test","module":"auth-routes","userId":"bQCLEZNIUK11OFK5O8Ui8","email":"protected-test-6WhpDnNE896WqKH6-QkPv@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

{"level":40,"time":1767800718453,"env":"test","module":"mfa-service","userId":"de2e265cefb357649e80fb95d0d4287f","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800718453,"env":"test","module":"auth-routes","userId":"de2e265cefb357649e80fb95d0d4287f","msg":"MFA verification failed during login"}
{"level":50,"time":1767800718459,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800718476,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800718483,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800718485,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800718489,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800718618,"env":"test","module":"user-credentials-repository","userId":"u2j50JjBY9Aeh8py1GHe6","msg":"User credentials created"}
{"level":50,"time":1767800718637,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800718638,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800718638,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800718638,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800718640,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
{"level":50,"time":1767800718664,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800718672,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800718686,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31m‚ùØ[39m tests/unit/middleware/auth.middleware.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 7654[2mms[22m[39m
       [33m[2m‚úì[22m[39m should authenticate with valid JWT token [33m 454[2mms[22m[39m
[31m       [31m√ó[31m should return 401 for missing token[39m[32m 11[2mms[22m[39m
       [32m‚úì[39m should return 401 for invalid token[32m 1[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for expired token [33m 493[2mms[22m[39m
       [33m[2m‚úì[22m[39m should extract token without Bearer prefix [33m 468[2mms[22m[39m
       [33m[2m‚úì[22m[39m should authenticate with valid token [33m 498[2mms[22m[39m
       [32m‚úì[39m should proceed without auth when no token provided[32m 1[2mms[22m[39m
       [32m‚úì[39m should proceed even with invalid token[32m 1[2mms[22m[39m
       [33m[2m‚úì[22m[39m should authenticate with JWT Bearer token [33m 493[2mms[22m[39m
[31m       [31m√ó[31m should authenticate with refresh token cookie for GET requests[39m[33m 521[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject cookie auth for POST requests [33m 438[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prioritize JWT over cookie when both present [33m 901[2mms[22m[39m
[31m       [31m√ó[31m should allow cookie auth only for safe methods[39m[33m 718[2mms[22m[39m
       [32m‚úì[39m should return 401 when no auth provided[32m 1[2mms[22m[39m
       [33m[2m‚úì[22m[39m should authenticate with JWT [33m 441[2mms[22m[39m
       [33m[2m‚úì[22m[39m should authenticate with cookie for GET [33m 540[2mms[22m[39m
       [32m‚úì[39m should proceed without auth when none provided[32m 1[2mms[22m[39m
       [32m‚úì[39m should proceed even with invalid auth[32m 1[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not allow token tampering [33m 434[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not allow cookie auth for mutations (CSRF protection) [33m 485[2mms[22m[39m
       [32m‚úì[39m should reject malformed JWT[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle missing authorization header gracefully[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800718721,"env":"test","module":"email-queue","jobId":"c19e20f8-7603-41f8-ac59-cc26789a784b","to":"session-test-XKAeVV0HyyeJ2Bwddc_hk@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800718746,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800718757,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800718777,"env":"test","module":"auth-routes","userId":"u2j50JjBY9Aeh8py1GHe6","email":"session-test-XKAeVV0HyyeJ2Bwddc_hk@example.com","msg":"User registered"}
[90mstderr[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800718882,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800719085,"env":"test","module":"user-credentials-repository","userId":"-Pvsv8iKNQrc568xCaS_n","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800719149,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"qpdf --decrypt \"C:\\Users\\scoot\\AppData\\Local\\Temp\\locked-1767800719110.pdf\" \"C:\\Users\\scoot\\AppData\\Local\\Temp\\unlocked-1767800719110.pdf\"","stdout":"","stderr":"'qpdf' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"Failed to unlock PDF with qpdf"}
{"level":40,"time":1767800719150,"env":"test","msg":"Returning original PDF buffer due to unlock failure"}
 [31m‚ùØ[39m tests/unit/services/intakeNavigation.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 1599[2mms[22m[39m
[31m       [31m√ó[31m should return all pages in order when no conditions[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should handle empty workflow[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should calculate correct current page index[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should hide pages when visibleIf is false[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show pages when visibleIf is true[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle complex visibleIf conditions[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should skip pages when skipIf is true[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should not skip pages when skipIf is false[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should apply visibleIf before skipIf[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should get first page[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return null for first page if all pages hidden[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate page navigability[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should get page sequence[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should default to visible on visibleIf evaluation error[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should default to not skipping on skipIf evaluation error[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should calculate correct progress for multi-page workflow[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should adjust progress when pages are skipped[39m[32m 0[2mms[22m[39m
{"level":50,"time":1767800719152,"env":"test","error":{},"msg":"Failed to extract PDF fields"}
{"level":50,"time":1767800719153,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF processing failed"}
{"level":50,"time":1767800719153,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"b3827001-8fd8-4663-b3b7-250d6d6f95fe"},"file":{"fieldname":"file","originalname":"test.pdf","encoding":"7bit","mimetype":"application/pdf","buffer":{"type":"Buffer","data":[37,80,68,70]},"size":4},"msg":"Error creating template"}
{"level":30,"time":1767800719172,"env":"test","module":"user-credentials-repository","userId":"zee-mDbA5aEyLf-9FCNbs","msg":"User credentials created"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800719186,"env":"test","module":"email-queue","jobId":"77f7f529-7a56-4d42-9087-326aedac89ae","to":"middleware-test-dl5lSGQi-9iIgzs54UP4z@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800719197,"env":"test","module":"auth-routes","userId":"70ad2877cd8d4ff5fb61d5407b06b0dc","msg":"User logged in successfully"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767800719234,"env":"test","module":"auth-routes","userId":"-Pvsv8iKNQrc568xCaS_n","email":"middleware-test-dl5lSGQi-9iIgzs54UP4z@example.com","msg":"User registered"}
{"level":30,"time":1767800719249,"env":"test","module":"audit-log-service","userId":"70ad2877cd8d4ff5fb61d5407b06b0dc","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstderr[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800719262,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"b3827001-8fd8-4663-b3b7-250d6d6f95fe"},"msg":"Error creating template"}
{"level":30,"time":1767800719281,"env":"test","module":"email-queue","jobId":"4ddc6643-2597-4a61-acde-8d82e5a9d5ff","to":"protected-test-Z9jK07s5MPIbjRXa8lv-S@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767800719331,"env":"test","module":"user-credentials-repository","userId":"aKMGkXaUQuUuP3w3oyBzA","msg":"User credentials created"}
{"level":30,"time":1767800719332,"env":"test","module":"auth-routes","userId":"zee-mDbA5aEyLf-9FCNbs","email":"protected-test-Z9jK07s5MPIbjRXa8lv-S@example.com","msg":"User registered"}
{"level":30,"time":1767800719457,"env":"test","module":"email-queue","jobId":"55d3afc2-df84-4afa-8d57-69728b3a3ce1","to":"session-test-NMBtO2OusV8xxzDPmxXyI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800719513,"env":"test","module":"auth-routes","userId":"aKMGkXaUQuUuP3w3oyBzA","email":"session-test-NMBtO2OusV8xxzDPmxXyI@example.com","msg":"User registered"}
{"level":50,"time":1767800719535,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800719536,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800719559,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts[2m > [22m[2mData Sources API - Native Catalog
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800719545,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800719546,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800719552,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800719558,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800719558,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800719559,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800719559,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

{"level":50,"time":1767800719593,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800719637,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstderr[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800719779,"env":"test","module":"auth-routes","userId":"39575a729a12b16427d1bac6a57dab4c","msg":"User logged in successfully"}
{"level":50,"time":1767800719779,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800719834,"env":"test","module":"audit-log-service","userId":"39575a729a12b16427d1bac6a57dab4c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800719886,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800719902,"env":"test","module":"auth-routes","userId":"zee-mDbA5aEyLf-9FCNbs","msg":"User logged in successfully"}
{"level":30,"time":1767800719936,"env":"test","module":"user-credentials-repository","userId":"TAYvAt3EDyZnZVka2KXw2","msg":"User credentials created"}
{"level":40,"time":1767800719950,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1767800719955,"env":"test","module":"audit-log-service","userId":"zee-mDbA5aEyLf-9FCNbs","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800719960,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":40,"time":1767800719953,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767800719955,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767800719961,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767800719963,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1767800719987,"env":"test","module":"auth-routes","userId":"39575a729a12b16427d1bac6a57dab4c","msg":"All other sessions revoked"}
 [31m‚ùØ[39m tests/unit/isolatedVmBridge.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1507[2mms[22m[39m
     [32m‚úì[39m should execute JS and use simple helpers (string)[32m 10[2mms[22m[39m
     [32m‚úì[39m should execute JS and use complex helpers (math.sum)[32m 2[2mms[22m[39m
[31m     [31m√ó[31m should execute JS and capture console logs[39m[32m 6[2mms[22m[39m
     [32m‚úì[39m should access context data[32m 2[2mms[22m[39m
     [32m‚úì[39m should fail on missing helper[32m 4[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800720042,"env":"test","module":"email-queue","jobId":"c178bcd6-8493-4290-9376-68479f87bd19","to":"middleware-test-AUbeKHy8-Hv_Zo-qKSSfa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800720042,"env":"test","module":"audit-log-service","userId":"39575a729a12b16427d1bac6a57dab4c","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767800720057,"env":"test","module":"user-credentials-repository","userId":"mRphdAVEYXEATgFFG7XPy","msg":"User credentials created"}
{"level":30,"time":1767800720094,"env":"test","module":"auth-routes","userId":"TAYvAt3EDyZnZVka2KXw2","email":"middleware-test-AUbeKHy8-Hv_Zo-qKSSfa@example.com","msg":"User registered"}
{"level":30,"time":1767800720151,"env":"test","module":"auth-routes","userId":"39575a729a12b16427d1bac6a57dab4c","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767800720166,"env":"test","module":"email-queue","jobId":"2dde9c68-5ef4-48b5-b3c4-2e9798b9abb2","to":"test-j5UU1aTly0zJpJsR3GQoC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800720184,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800720228,"env":"test","module":"auth-routes","userId":"mRphdAVEYXEATgFFG7XPy","email":"test-j5UU1aTly0zJpJsR3GQoC@example.com","msg":"User registered"}
{"level":40,"time":1767800720290,"env":"test","module":"mfa-service","userId":"b07feb21b84f1d6889747e36bd501950","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800720290,"env":"test","module":"auth-routes","userId":"b07feb21b84f1d6889747e36bd501950","msg":"MFA verification failed during login"}
{"level":30,"time":1767800720295,"env":"test","module":"user-credentials-repository","userId":"S5Xr0VyvXBXpzOz2iuf_W","msg":"User credentials created"}
{"level":50,"time":1767800720295,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800720368,"env":"test","module":"user-credentials-repository","userId":"mW7e5SDKn1N5jVcQ8LxEe","msg":"User credentials created"}
{"level":30,"time":1767800720400,"env":"test","module":"email-queue","jobId":"f75736f4-9b24-4665-919f-03cf4f8babf7","to":"session-test-HCuDwT5FLu71s0_A_LWnV@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800720411,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1767800720455,"env":"test","module":"auth-routes","userId":"S5Xr0VyvXBXpzOz2iuf_W","email":"session-test-HCuDwT5FLu71s0_A_LWnV@example.com","msg":"User registered"}
{"level":30,"time":1767800720474,"env":"test","module":"email-queue","jobId":"44fe03e0-4f39-41ef-9851-948e58eebfab","to":"protected-test-YN2lnCmhKxmTOjwb1PtsN@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800720525,"env":"test","module":"auth-routes","userId":"mW7e5SDKn1N5jVcQ8LxEe","email":"protected-test-YN2lnCmhKxmTOjwb1PtsN@example.com","msg":"User registered"}
{"level":50,"time":1767800720575,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800720759,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching native catalog"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800720797,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800720815,"env":"test","module":"user-credentials-repository","userId":"6Xzq_O_kDVSfW66RV26EZ","msg":"User credentials created"}
{"level":50,"time":1767800720837,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800720842,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800720885,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800720919,"env":"test","module":"email-queue","jobId":"6dd4effd-58f7-49f5-85a9-957d13b6b5c3","to":"middleware-test-DTX0AnkCytNtaiM9z0PdB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800720973,"env":"test","module":"auth-routes","userId":"6Xzq_O_kDVSfW66RV26EZ","email":"middleware-test-DTX0AnkCytNtaiM9z0PdB@example.com","msg":"User registered"}
{"level":50,"time":1767800720982,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31m‚ùØ[39m tests/ui/datavault/TemplateCard.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 1455[2mms[22m[39m
[31m     [31m√ó[31m should render template name and description[39m[32m 5[2mms[22m[39m
[31m     [31m√ó[31m should show "Coming Soon" badge[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should render preview columns[39m[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should limit preview columns to 5 and show count for remaining[39m[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should handle empty preview columns[39m[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should have cursor-not-allowed style[39m[32m 0[2mms[22m[39m
{"level":50,"time":1767800720995,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800721068,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":40,"time":1767800721180,"env":"test","module":"mfa-service","userId":"b77085c25945c76d8a31b32626aa0fdc","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800721180,"env":"test","module":"auth-routes","userId":"b77085c25945c76d8a31b32626aa0fdc","msg":"MFA verification failed during login"}
{"level":50,"time":1767800721184,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800721204,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800721208,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800721236,"env":"test","module":"user-credentials-repository","userId":"nJWca7m80zLEJv7zZpguz","msg":"User credentials created"}
{"level":50,"time":1767800721285,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800721342,"env":"test","module":"email-queue","jobId":"99f6c09f-fb90-4602-b5ae-938f6aa83891","to":"protected-test-DeRQGhsUzGhFmHenURgNz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

 [31m‚ùØ[39m tests/integration/api.dataSources.native.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 2431[2mms[22m[39m
[31m     [31m√ó[31m should list databases and databases' tables in the catalog[39m[33m 345[2mms[22m[39m
     [33m[2m‚úì[22m[39m should create a native_table data source [33m 320[2mms[22m[39m
[90mstderr[2m | tests/integration/datavault.permissions.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800721395,"env":"test","module":"auth-routes","userId":"nJWca7m80zLEJv7zZpguz","email":"protected-test-DeRQGhsUzGhFmHenURgNz@example.com","msg":"User registered"}
{"level":30,"time":1767800721397,"env":"test","module":"user-credentials-repository","userId":"h0fpk1rpoeqTxgYjDoLAU","msg":"User credentials created"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800721475,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800721508,"env":"test","module":"email-queue","jobId":"35fd905a-dce0-4412-8bc2-8cfa45ec766f","to":"session-test-Vz35cdbQ00girkDDi1OJB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800721562,"env":"test","module":"auth-routes","userId":"h0fpk1rpoeqTxgYjDoLAU","email":"session-test-Vz35cdbQ00girkDDi1OJB@example.com","msg":"User registered"}
{"level":30,"time":1767800721676,"env":"test","module":"user-credentials-repository","userId":"kg_IIKkVL1vAtlKmvQv6L","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800721720,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800721773,"env":"test","module":"email-queue","jobId":"24afdc22-7296-4ec0-b551-566e970558cc","to":"middleware-test-vLnIcCbsQNhXnNVyXXhle@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31m‚ùØ[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 1458[2mms[22m[39m
[31m     [31m√ó[31m should render database settings page with breadcrumbs[39m[32m 5[2mms[22m[39m
[31m     [31m√ó[31m should show loading state[39m[32m 2[2mms[22m[39m
[31m     [31m√ó[31m should show not found state when database does not exist[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should render DatabaseSettings component with database data[39m[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should navigate back when back button is clicked[39m[32m 13[2mms[22m[39m
[31m     [31m√ó[31m should display database name in header[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should render sidebar[39m[32m 0[2mms[22m[39m
{"level":30,"time":1767800721826,"env":"test","module":"auth-routes","userId":"kg_IIKkVL1vAtlKmvQv6L","email":"middleware-test-vLnIcCbsQNhXnNVyXXhle@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstderr[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800721943,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31m‚ùØ[39m tests/integration/auth/jwt.authentication.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 5094[2mms[22m[39m
[31m       [31m√ó[31m should generate valid JWT token on successful login[39m[32m 19[2mms[22m[39m
[31m       [31m√ó[31m should include correct payload in JWT token[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should set JWT expiry to 15 minutes[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should accept valid JWT token on protected routes[39m[32m 179[2mms[22m[39m
       [32m‚úì[39m should reject request without authorization header[32m 6[2mms[22m[39m
       [32m‚úì[39m should reject request with malformed token[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should reject request with missing Bearer prefix[39m[32m 175[2mms[22m[39m
       [32m‚úì[39m should reject token with invalid signature[32m 8[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject expired JWT token [33m 1108[2mms[22m[39m
[31m       [31m√ó[31m should return token_expired error code for expired tokens[39m[33m 1110[2mms[22m[39m
       [32m‚úì[39m should authenticate with Bearer token in Authorization header[32m 118[2mms[22m[39m
       [32m‚úì[39m should work with Bearer token on POST requests[32m 120[2mms[22m[39m
[31m       [31m√ó[31m should work with Bearer token on PUT requests[39m[32m 63[2mms[22m[39m
[31m       [31m√ó[31m should work with Bearer token on DELETE requests[39m[32m 274[2mms[22m[39m
[31m       [31m√ó[31m should exchange valid session cookie for JWT token[39m[32m 7[2mms[22m[39m
       [32m‚úì[39m should reject token exchange without valid cookie[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should prefer Bearer token over cookie when both present[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should fall back to cookie if Bearer token is invalid[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should allow GET requests with cookie auth only[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should reject POST requests with cookie auth only (mutation-strict)[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should allow anonymous access to public workflows[39m[32m 63[2mms[22m[39m
[31m       [31m√ó[31m should attach user info if authenticated on optional auth routes[39m[32m 57[2mms[22m[39m
[31m       [31m√ó[31m should refresh access token using refresh token[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should rotate refresh token on use[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should detect token reuse and revoke all user tokens[39m[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should revoke refresh token on logout[39m[32m 5[2mms[22m[39m
[31m       [31m√ó[31m should clear refresh token cookie on logout[39m[32m 7[2mms[22m[39m
{"level":50,"time":1767800721997,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800722069,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800722101,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800722110,"env":"test","module":"mfa-service","userId":"ec4dc163c67078ee647c4d940b913c0a","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800722110,"env":"test","module":"auth-routes","userId":"ec4dc163c67078ee647c4d940b913c0a","msg":"MFA verification failed during login"}
{"level":50,"time":1767800722111,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722115,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800722116,"env":"test","module":"user-credentials-repository","userId":"D-riJkP1ihZou3m16iwqr","msg":"User credentials created"}
{"level":50,"time":1767800722120,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722141,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722155,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800722188,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722196,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722209,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800722222,"env":"test","module":"email-queue","jobId":"1a821de0-2b65-4133-9031-17eb6b1b12af","to":"protected-test-cznGadUQAL3AHcNTsx3QB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767800722221,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722226,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800722232,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722234,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722241,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

{"level":50,"time":1767800722252,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722260,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722270,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722282,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800722282,"env":"test","module":"auth-routes","userId":"D-riJkP1ihZou3m16iwqr","email":"protected-test-cznGadUQAL3AHcNTsx3QB@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800722291,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31m‚ùØ[39m tests/ui/datavault/EditableCell.test.tsx [2m([22m[2m29 tests[22m[2m | [22m[31m29 failed[39m[2m)[22m[33m 1374[2mms[22m[39m
[31m       [31m√ó[31m renders value in display mode initially[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m shows double-click hint on hover[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m does not show hint for read-only cells[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m includes proper ARIA label with column name and value[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m indicates read-only status in ARIA label[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m is focusable when editable[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m is not focusable when read-only[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m enters edit mode on double-click[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m enters edit mode on Enter key press[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m enters edit mode on Space key press[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m does not enter edit mode when read-only[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m focuses and selects input text on edit mode entry[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m saves on blur[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m saves on Enter key press[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m does not save if value unchanged[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m cancels edit on Escape key press[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m reverts value on save error[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m displays error indicator on save failure[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders checkbox for boolean type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m saves immediately on checkbox change[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m disables checkbox when read-only[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m shows loading spinner when saving checkbox[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders number input for number type[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m renders email input for email type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders url input for url type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m includes placeholder text in edit mode[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m formats date values for display[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m formats boolean values as Yes/No[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m handles null values gracefully[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m tests/integration/trusted.devices.real.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 24545[2mms[22m[39m
[31m       [31m√ó[31m should trust current device[39m[33m 1575[2mms[22m[39m
[31m       [31m√ó[31m should set trust expiry to 30 days[39m[33m 1558[2mms[22m[39m
[31m       [31m√ó[31m should update expiry if device already trusted[39m[33m 1652[2mms[22m[39m
       [33m[2m‚úì[22m[39m should require authentication [33m 423[2mms[22m[39m
[31m       [31m√ó[31m should list all trusted devices[39m[33m 2297[2mms[22m[39m
[31m       [31m√ó[31m should mark current device[39m[33m 1524[2mms[22m[39m
[31m       [31m√ó[31m should exclude revoked devices[39m[33m 1574[2mms[22m[39m
       [33m[2m‚úì[22m[39m should exclude expired devices [33m 1942[2mms[22m[39m
[31m       [31m√ó[31m should revoke specific device[39m[33m 1792[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 404 for non-existent device [33m 1770[2mms[22m[39m
[31m       [31m√ó[31m should prevent revoking other user's device[39m[33m 2289[2mms[22m[39m
[31m       [31m√ó[31m should skip MFA for trusted device[39m[33m 1904[2mms[22m[39m
[31m       [31m√ó[31m should require MFA for untrusted device[39m[33m 1828[2mms[22m[39m
[31m       [31m√ó[31m should update lastUsedAt on trusted device login[39m[33m 1592[2mms[22m[39m
 [31m‚ùØ[39m tests/integration/auth/session.management.integration.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 19089[2mms[22m[39m
[31m       [31m√ó[31m should create refresh token on login[39m[33m 953[2mms[22m[39m
       [33m[2m‚úì[22m[39m should track device metadata in session [33m 1241[2mms[22m[39m
[31m       [31m√ó[31m should create separate sessions for multiple device logins[39m[33m 925[2mms[22m[39m
[31m       [31m√ó[31m should list all active sessions for user[39m[33m 904[2mms[22m[39m
[31m       [31m√ó[31m should mark current session correctly[39m[33m 909[2mms[22m[39m
[31m       [31m√ó[31m should not include revoked sessions[39m[33m 955[2mms[22m[39m
[31m       [31m√ó[31m should order sessions by last used (most recent first)[39m[33m 955[2mms[22m[39m
       [33m[2m‚úì[22m[39m should require authentication [33m 674[2mms[22m[39m
[31m       [31m√ó[31m should revoke specific session[39m[33m 952[2mms[22m[39m
[31m       [31m√ó[31m should prevent revoking current session[39m[33m 958[2mms[22m[39m
[31m       [31m√ó[31m should not allow revoking other users sessions[39m[33m 1569[2mms[22m[39m
[31m       [31m√ó[31m should return 404 for non-existent session ID[39m[33m 936[2mms[22m[39m
[31m       [31m√ó[31m should revoke all sessions except current[39m[33m 931[2mms[22m[39m
[31m       [31m√ó[31m should revoke all trusted devices[39m[33m 935[2mms[22m[39m
       [33m[2m‚úì[22m[39m should require active session [33m 675[2mms[22m[39m
[31m       [31m√ó[31m should reject refresh token after 30 days[39m[33m 1004[2mms[22m[39m
[31m       [31m√ó[31m should handle multiple concurrent logins[39m[33m 1115[2mms[22m[39m
[31m       [31m√ó[31m should handle concurrent token refreshes[39m[33m 941[2mms[22m[39m
{"level":50,"time":1767800722393,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800722403,"env":"test","module":"auth-routes","userId":"kg_IIKkVL1vAtlKmvQv6L","msg":"User logged in successfully"}
{"level":50,"time":1767800722458,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800722458,"env":"test","module":"audit-log-service","userId":"kg_IIKkVL1vAtlKmvQv6L","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800722466,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722473,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722480,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800722560,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800722606,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1767800722672,"env":"test","module":"mfa-service","userId":"a1f6e219bc2687f983e0cfba23acacd1","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800722672,"env":"test","module":"auth-routes","userId":"a1f6e219bc2687f983e0cfba23acacd1","msg":"MFA verification failed during login"}
{"level":50,"time":1767800722679,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/ui/expression-editor.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [31m‚ùØ[39m tests/integration/datavault.permissions.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m22 failed[39m[2m)[22m[33m 1834[2mms[22m[39m
[31m       [31m√ó[31m should allow owner to read table[39m[32m 40[2mms[22m[39m
[31m       [31m√ó[31m should allow writer to read table[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should allow reader to read table[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should deny non-member from reading table[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should allow owner to update table[39m[32m 21[2mms[22m[39m
[31m       [31m√ó[31m should deny writer from updating table[39m[32m 33[2mms[22m[39m
[31m       [31m√ó[31m should deny reader from updating table[39m[32m 14[2mms[22m[39m
[31m       [31m√ó[31m should deny writer from deleting table[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should deny reader from deleting table[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should deny non-member from deleting table[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should allow owner to view permissions[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should deny writer from viewing permissions[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should deny reader from viewing permissions[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should allow owner to grant permissions[39m[32m 9[2mms[22m[39m
[31m       [31m√ó[31m should allow owner to update existing permission (upsert)[39m[32m 10[2mms[22m[39m
[31m       [31m√ó[31m should deny writer from granting permissions[39m[32m 11[2mms[22m[39m
[31m       [31m√ó[31m should prevent modifying table owner permissions[39m[32m 37[2mms[22m[39m
[31m       [31m√ó[31m should allow owner to revoke permissions[39m[32m 74[2mms[22m[39m
[31m       [31m√ó[31m should deny writer from revoking permissions[39m[32m 65[2mms[22m[39m
[31m       [31m√ó[31m should enforce owner includes write and read[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should enforce write includes read but not owner[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should enforce read is read-only[39m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

{"level":30,"time":1767800723042,"env":"test","module":"user-credentials-repository","userId":"0L1pKQzO3hkuDXzOX5Rkp","msg":"User credentials created"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800723148,"env":"test","module":"email-queue","jobId":"e82d2c09-7f0b-460a-b28f-74e307a38904","to":"protected-test-MEPC4wXh1TvCqMreNdhlF@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800723202,"env":"test","module":"auth-routes","userId":"0L1pKQzO3hkuDXzOX5Rkp","email":"protected-test-MEPC4wXh1TvCqMreNdhlF@example.com","msg":"User registered"}
 [31m‚ùØ[39m tests/ui/expression-editor.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 1507[2mms[22m[39m
[31m       [31m√ó[31m should initialize with null validation result[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should validate expression after debounce[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should return validation errors for invalid expression[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should debounce validation calls[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should not validate when workflowId or nodeId is missing[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate helper functions in expressions[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should validate complex expressions with multiple helpers[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle syntax errors[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle empty expressions[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should update validation when expression changes[39m[32m 1[2mms[22m[39m
{"level":50,"time":1767800723317,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800723322,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/integration/api.templates-runs.test.ts[2m > [22m[2mTemplates and Runs API Integration Tests
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.templates-runs.test.ts:83:5 {
  length: [33m296[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(0Ld98Nk_FFQJBTcxEXP2J) is still referenced from table "runs".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'runs'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'runs_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800723392,"env":"test","module":"auth-routes","userId":"28e3844e70f5811011b2459c9a553afb","msg":"User logged in successfully"}
{"level":30,"time":1767800723422,"env":"test","module":"user-credentials-repository","userId":"2Qtgnys3Kva0qzlJsdZup","msg":"User credentials created"}
{"level":30,"time":1767800723447,"env":"test","module":"audit-log-service","userId":"28e3844e70f5811011b2459c9a553afb","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [31m‚ùØ[39m tests/integration/session.management.real.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m16 failed[39m[2m)[22m[33m 25700[2mms[22m[39m
[31m       [31m√ó[31m should list all active sessions for current user[39m[33m 1594[2mms[22m[39m
[31m       [31m√ó[31m should mark current session correctly[39m[33m 1317[2mms[22m[39m
[31m       [31m√ó[31m should exclude revoked sessions[39m[33m 1360[2mms[22m[39m
[31m       [31m√ó[31m should order sessions by last used (most recent first)[39m[33m 1781[2mms[22m[39m
[31m       [31m√ó[31m should filter sessions by current user only[39m[33m 2233[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for unauthenticated request [33m 393[2mms[22m[39m
[31m       [31m√ó[31m should revoke specific session[39m[33m 1282[2mms[22m[39m
[31m       [31m√ó[31m should prevent revoking current session[39m[33m 1033[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 404 for non-existent session [33m 1375[2mms[22m[39m
[31m       [31m√ó[31m should prevent revoking other user's session[39m[33m 2118[2mms[22m[39m
[31m       [31m√ó[31m should revoke all other sessions[39m[33m 1842[2mms[22m[39m
[31m       [31m√ó[31m should keep current session active[39m[33m 1576[2mms[22m[39m
[31m       [31m√ó[31m should return 400 if no active session found[39m[33m 1039[2mms[22m[39m
[31m       [31m√ó[31m should revoke all trusted devices[39m[33m 1087[2mms[22m[39m
[31m       [31m√ó[31m should handle user with single session gracefully[39m[33m 1666[2mms[22m[39m
[31m       [31m√ó[31m should include device metadata in sessions[39m[33m 1056[2mms[22m[39m
[31m       [31m√ó[31m should not expose sensitive token data[39m[33m 1027[2mms[22m[39m
[31m       [31m√ó[31m should track session activity timestamps[39m[33m 1088[2mms[22m[39m
{"level":50,"time":1767800723508,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767800723525,"env":"test","module":"email-queue","jobId":"04bed76e-fa39-458c-abc2-8576d57eb725","to":"middleware-test-Q204ZCGnwffe9s75Nja1M@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800723578,"env":"test","module":"auth-routes","userId":"2Qtgnys3Kva0qzlJsdZup","email":"middleware-test-Q204ZCGnwffe9s75Nja1M@example.com","msg":"User registered"}
{"level":40,"time":1767800723720,"env":"test","module":"auth-service","userId":"28e3844e70f5811011b2459c9a553afb","tokenHash":"74affcf4fb42a83f8fa8e1b5c0dbb5bc76b277a59c2b5fc23f60aad9e1e35fd6","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
 [31m‚ùØ[39m tests/integration/api.templates-runs.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 7080[2mms[22m[39m
         [32m‚úì[39m should create template with file upload[32m 192[2mms[22m[39m
[31m         [31m√ó[31m should reject non-docx files[39m[32m 157[2mms[22m[39m
         [32m‚úì[39m should reject without file[32m 108[2mms[22m[39m
         [33m[2m‚úì[22m[39m should list templates [33m 326[2mms[22m[39m
         [33m[2m‚úì[22m[39m should get template by ID [33m 301[2mms[22m[39m
         [32m‚úì[39m should extract placeholders[32m 284[2mms[22m[39m
         [33m[2m‚úì[22m[39m should update template name [33m 344[2mms[22m[39m
         [33m[2m‚úì[22m[39m should delete template [33m 463[2mms[22m[39m
         [32m‚úì[39m should execute workflow[32m 294[2mms[22m[39m
         [32m‚úì[39m should include logs in debug mode[32m 279[2mms[22m[39m
[31m         [31m√ó[31m should reject without required permission[39m[32m 8[2mms[22m[39m
         [33m[2m‚úì[22m[39m should list runs [33m 397[2mms[22m[39m
         [33m[2m‚úì[22m[39m should filter by workflowId [33m 395[2mms[22m[39m
         [33m[2m‚úì[22m[39m should get run by ID [33m 454[2mms[22m[39m
         [33m[2m‚úì[22m[39m should get run logs [33m 512[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800723969,"env":"test","module":"user-credentials-repository","userId":"oo7bS04pfCEqEw-oAvvXG","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800724081,"env":"test","module":"email-queue","jobId":"3320f753-af87-4448-9b40-624699a2dd91","to":"protected-test-rfGKgvbRHJ9gnMiusO5UL@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800724135,"env":"test","module":"auth-routes","userId":"oo7bS04pfCEqEw-oAvvXG","email":"protected-test-rfGKgvbRHJ9gnMiusO5UL@example.com","msg":"User registered"}
{"level":30,"time":1767800724139,"env":"test","module":"auth-routes","userId":"2Qtgnys3Kva0qzlJsdZup","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800724186,"env":"test","module":"audit-log-service","userId":"2Qtgnys3Kva0qzlJsdZup","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstderr[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800724454,"env":"test","module":"auth-routes","userId":"4c64561f6804193045157bdd4f40cbcd","msg":"Login requires MFA verification"}
[90mstderr[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800724474,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800724561,"env":"test","module":"mfa-service","userId":"4c64561f6804193045157bdd4f40cbcd","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767800724561,"env":"test","module":"auth-routes","userId":"4c64561f6804193045157bdd4f40cbcd","msg":"MFA verification failed during login"}
{"level":50,"time":1767800724567,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800724608,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mMOCK SETUP DONE. Mock questions: [
  {
    id: [32m'q1'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q1'[39m,
    order: [33m0[39m,
    isVirtual: [33mfalse[39m,
    alias: [32m'show'[39m,
    visibleIf: [1mnull[22m
  },
  {
    id: [32m'q2'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q2'[39m,
    order: [33m1[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: { op: [32m'equals'[39m, left: [36m[Object][39m, right: [36m[Object][39m }
  },
  {
    id: [32m'q3'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q3'[39m,
    order: [33m2[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: [1mnull[22m
  }
]
Calling getVisibleQuestionCount...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mCOUNT RESULT: [33m0[39m
Mock called times: [33m1[39m
Mock last call args: [ [ [32m'section1'[39m ] ]

[90mstderr[2m | tests/ui/runs.components.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800724760,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39müßπ Cleaning up test environment...

 [31m‚ùØ[39m tests/ui/datavault/ColumnTypeIcon.test.tsx [2m([22m[2m27 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 1795[2mms[22m[39m
[31m       [31m√ó[31m renders text icon for text type[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m renders hash icon for number type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders hash icon for auto_number type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders toggle icon for boolean type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders calendar icon for date type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders clock icon for datetime type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders mail icon for email type[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m renders phone icon for phone type[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m renders link icon for url type[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m renders JSON icon for json type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m renders file icon for file_upload type[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m renders default text icon for unknown type[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m applies custom className[39m[32m 1[2mms[22m[39m
       [32m‚úì[39m returns blue color for text types[32m 1[2mms[22m[39m
       [32m‚úì[39m returns green color for number types[32m 0[2mms[22m[39m
       [32m‚úì[39m returns purple color for boolean types[32m 0[2mms[22m[39m
       [32m‚úì[39m returns orange color for date types[32m 0[2mms[22m[39m
       [32m‚úì[39m returns pink color for email type[32m 0[2mms[22m[39m
       [32m‚úì[39m returns cyan color for phone type[32m 0[2mms[22m[39m
       [32m‚úì[39m returns indigo color for url type[32m 0[2mms[22m[39m
       [32m‚úì[39m returns yellow color for json type[32m 0[2mms[22m[39m
       [32m‚úì[39m returns gray color for file_upload type[32m 0[2mms[22m[39m
       [32m‚úì[39m returns muted color for unknown type[32m 0[2mms[22m[39m
       [32m‚úì[39m returns proper labels for all column types[32m 1[2mms[22m[39m
       [32m‚úì[39m returns the type itself for unknown types[32m 0[2mms[22m[39m
[31m       [31m√ó[31m includes aria-label with column type[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m has proper icon size class[39m[32m 0[2mms[22m[39m
[90mstderr[2m | tests/integration/metrics.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [31m‚ùØ[39m tests/unit/utils/variableResolver.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 1727[2mms[22m[39m
       [32m‚úì[39m should resolve alias to key[32m 2[2mms[22m[39m
       [32m‚úì[39m should return key if operand is already a key[32m 0[2mms[22m[39m
       [32m‚úì[39m should return operand as-is if not found (for validation to catch)[32m 0[2mms[22m[39m
       [32m‚úì[39m should handle empty operand[32m 0[2mms[22m[39m
       [32m‚úì[39m should handle null-like operands[32m 0[2mms[22m[39m
       [32m‚úì[39m should be case-sensitive for aliases[32m 1[2mms[22m[39m
       [32m‚úì[39m should resolve multiple aliases to keys[32m 0[2mms[22m[39m
       [32m‚úì[39m should handle mix of aliases and keys[32m 0[2mms[22m[39m
       [32m‚úì[39m should handle empty array[32m 0[2mms[22m[39m
       [32m‚úì[39m should preserve unknown operands[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should find variable by key[39m[32m 12[2mms[22m[39m
[31m       [31m√ó[31m should find variable by alias[39m[32m 3[2mms[22m[39m
       [32m‚úì[39m should return undefined if not found[32m 0[2mms[22m[39m
       [32m‚úì[39m should prioritize key match over alias match[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should handle variable with null alias[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should return true for valid alias[32m 1[2mms[22m[39m
       [32m‚úì[39m should return true for valid key[32m 0[2mms[22m[39m
       [32m‚úì[39m should return false for invalid operand[32m 0[2mms[22m[39m
       [32m‚úì[39m should return false for empty operand[32m 0[2mms[22m[39m
       [32m‚úì[39m should validate against empty variables array[32m 0[2mms[22m[39m
 [31m‚ùØ[39m tests/unit/services/intakeQuestionVisibility.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1753[2mms[22m[39m
       [32m‚úì[39m should return all questions as visible when no conditions[32m 4[2mms[22m[39m
       [32m‚úì[39m should exclude virtual steps from visibility evaluation[32m 1[2mms[22m[39m
       [32m‚úì[39m should maintain question order[32m 0[2mms[22m[39m
       [32m‚úì[39m should hide questions when visibleIf is false[32m 1[2mms[22m[39m
       [32m‚úì[39m should show questions when visibleIf is true[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle complex visibleIf conditions[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle OR conditions[32m 1[2mms[22m[39m
       [32m‚úì[39m should handle NOT conditions[32m 0[2mms[22m[39m
       [32m‚úì[39m should include visible required questions in validation[32m 1[2mms[22m[39m
       [32m‚úì[39m should skip hidden questions in validation[32m 0[2mms[22m[39m
       [32m‚úì[39m should check if question is visible[32m 1[2mms[22m[39m
       [32m‚úì[39m should get visible question count[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should clear values for hidden questions[39m[32m 8[2mms[22m[39m
       [32m‚úì[39m should not clear values for visible questions[32m 1[2mms[22m[39m
       [32m‚úì[39m should warn if required question has visibility condition[32m 1[2mms[22m[39m
       [32m‚úì[39m should warn if virtual step has visibility condition[32m 0[2mms[22m[39m
       [32m‚úì[39m should return no warnings for valid configuration[32m 0[2mms[22m[39m
       [32m‚úì[39m should default to visible on condition evaluation error[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should handle questions that depend on each other[39m[32m 9[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800724887,"env":"test","module":"user-credentials-repository","userId":"JBgJo5_NIWdnthz1SQ2ao","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800724995,"env":"test","module":"email-queue","jobId":"f590e509-b001-4b6f-a0fb-3ea2afe25070","to":"protected-test-y60igk2Pf9QSuqwUJpbw_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800725027,"env":"test","module":"user-credentials-repository","userId":"29AguymYDnZmU4PyiBVLX","msg":"User credentials created"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800725048,"env":"test","module":"auth-routes","userId":"JBgJo5_NIWdnthz1SQ2ao","email":"protected-test-y60igk2Pf9QSuqwUJpbw_@example.com","msg":"User registered"}
 [31m‚ùØ[39m tests/ui/common/Breadcrumbs.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 1760[2mms[22m[39m
[31m     [31m√ó[31m should render all breadcrumb items[39m[32m 5[2mms[22m[39m
[31m     [31m√ó[31m should render without home when showHome is false[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should render icons for items that have them[39m[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should render links for non-last items with href[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should render last item without link[39m[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should apply custom className[39m[32m 0[2mms[22m[39m
[31m     [31m√ó[31m should render chevron separators between items[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should handle single item[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should handle empty items array with home[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should apply font-medium to last item[39m[32m 1[2mms[22m[39m
 [31m‚ùØ[39m tests/ui/runs.components.test.tsx [2m([22m[2m19 tests[22m[2m | [22m[31m19 failed[39m[2m)[22m[33m 1744[2mms[22m[39m
[31m       [31m√ó[31m should render runs table with correct columns[39m[32m 8[2mms[22m[39m
[31m       [31m√ó[31m should render run data correctly[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show success badge for successful runs[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should show error badge for failed runs[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should format duration correctly[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should show download options for successful runs[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should render all filter controls[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should call onChange when status filter changes[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should call onChange when search is submitted[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should show clear filters button when filters are active[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should clear all filters when clear button is clicked[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should render all trace entries[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should show executed badge for executed nodes[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should show skipped badge for skipped nodes[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should display conditions and their results[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should display error messages[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should toggle show skipped nodes[39m[32m 0[2mms[22m[39m
[31m       [31m√ó[31m should expand outputs delta when clicked[39m[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should copy trace as JSON[39m[32m 1[2mms[22m[39m
{"level":30,"time":1767800725128,"env":"test","module":"email-queue","jobId":"a4c5b80b-e77d-40bf-a403-034b8326c462","to":"middleware-test-xbHMsAeBqftEIFz0sRbYj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800725157,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1767800725158,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1767800725161,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1767800725176,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1767800725183,"env":"test","module":"auth-routes","userId":"29AguymYDnZmU4PyiBVLX","email":"middleware-test-xbHMsAeBqftEIFz0sRbYj@example.com","msg":"User registered"}
{"level":30,"time":1767800725205,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
[90mstderr[2m | tests/unit/client/choice-utils.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800725266,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1767800725266,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1767800725267,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1767800725273,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1767800725284,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800725287,"env":"test","module":"email-queue","jobId":"7c9009e8-e043-49ed-b446-b193a511fa80","to":"test-1767800724629-k5gko8@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800725288,"env":"test","module":"auth-service","email":"test-1767800724629-k5gko8@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstderr[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [31m‚ùØ[39m tests/integration/metrics.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1925[2mms[22m[39m
[31m     [31m√ó[31m should expose /metrics endpoint[39m[32m 145[2mms[22m[39m
     [32m‚úì[39m should protect /metrics if API key is set[32m 78[2mms[22m[39m
{"level":50,"time":1767800725404,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/client/choice-utils.test.ts[2m > [22m[2mchoice-utils[2m > [22m[2mhandles missing content gracefully
[22m[39m[generateOptionsFromList] Invalid list data: [1mnull[22m

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39müßπ Cleaning up test environment...

 [31m‚ùØ[39m tests/unit/client/choice-utils.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1567[2mms[22m[39m
     [32m‚úì[39m generates options with basic mapping[32m 6[2mms[22m[39m
     [32m‚úì[39m sorts by label asc[32m 1[2mms[22m[39m
     [32m‚úì[39m sorts by label desc[32m 0[2mms[22m[39m
     [32m‚úì[39m dedupes by label[32m 1[2mms[22m[39m
     [32m‚úì[39m dedupes by value (alias)[32m 1[2mms[22m[39m
[31m     [31m√ó[31m uses label template with column names[39m[32m 9[2mms[22m[39m
     [32m‚úì[39m handles missing content gracefully[32m 1[2mms[22m[39m
     [32m‚úì[39m includes blank option at the top[32m 1[2mms[22m[39m
     [32m‚úì[39m sorts by specific column asc[32m 0[2mms[22m[39m
     [32m‚úì[39m sorts by specific column desc[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/unit/services/AIService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

 [31m‚ùØ[39m tests/ui/datavault/TableCard.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 1531[2mms[22m[39m
[31m     [31m√ó[31m should render table name and description[39m[32m 7[2mms[22m[39m
[31m     [31m√ó[31m should render table slug[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should render column and row counts[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should call onClick when card is clicked[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should call onDelete when delete button is clicked[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should show placeholder when description is missing[39m[32m 1[2mms[22m[39m
[31m     [31m√ó[31m should format dates correctly[39m[32m 1[2mms[22m[39m
{"level":30,"time":1767800725764,"env":"test","module":"auth-routes","userId":"29AguymYDnZmU4PyiBVLX","msg":"User logged in successfully"}
{"level":30,"time":1767800725815,"env":"test","module":"audit-log-service","userId":"29AguymYDnZmU4PyiBVLX","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800725853,"env":"test","module":"user-credentials-repository","userId":"9OE4JWIfIwrCw4fZxJRk4","msg":"User credentials created"}
{"level":30,"time":1767800725930,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800725958,"env":"test","module":"email-queue","jobId":"88441035-8097-4df0-8005-715b1e5fed4f","to":"protected-test-KdU5aBUKqzJHKTIpBzxbu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800725958,"env":"test","module":"auth-routes","userId":"301cd8169591fc553e915ebb1303126e","msg":"User logged in successfully"}
{"level":30,"time":1767800725931,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767800725932,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":66,"totalTokens":878,"durationMs":1,"estimatedCostUSD":0.00010760000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800725936,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"},"duration":5,"msg":"AI workflow revision failed"}
{"level":50,"time":1767800725937,"env":"test","module":"ai-service","duration":8,"error":{"code":"VALIDATION_ERROR","details":{"originalError":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"}},"troubleshooting":"üîß Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"msg":"AI workflow revision failed"}
{"level":30,"time":1767800725948,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767800725948,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767800725949,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":45,"totalTokens":857,"durationMs":1,"estimatedCostUSD":0.00009920000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800725949,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow revision failed"}
{"level":50,"time":1767800725949,"env":"test","module":"ai-service","duration":1,"error":{"code":"VALIDATION_ERROR","details":{"originalError":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"}},"troubleshooting":"üîß Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"msg":"AI workflow revision failed"}
{"level":30,"time":1767800725951,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767800725951,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767800725952,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":1,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1767800725952,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1767800725952,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1767800725952,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":1,"msg":"AI workflow revision failed"}
{"level":40,"time":1767800725952,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"actualOutputTokens":4,"responseLength":13,"msg":"Single-shot revision truncated - automatically retrying with chunking"}
{"level":30,"time":1767800725953,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767800725953,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1767800725953,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1767800725953,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1767800725953,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":0,"msg":"AI workflow revision failed"}
{"level":50,"time":1767800725953,"env":"test","module":"ai-service","duration":2,"error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"msg":"AI workflow revision failed"}
{"level":30,"time":1767800726009,"env":"test","module":"audit-log-service","userId":"301cd8169591fc553e915ebb1303126e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [31m‚ùØ[39m tests/unit/services/AIService.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1567[2mms[22m[39m
[31m     [31m√ó[31m reviseWorkflow should parse valid JSON response correctly[39m[32m 20[2mms[22m[39m
[31m     [31m√ó[31m reviseWorkflow should handle JSON markdown code blocks[39m[32m 2[2mms[22m[39m
     [32m‚úì[39m reviseWorkflow should throw on invalid JSON[32m 5[2mms[22m[39m
{"level":30,"time":1767800726011,"env":"test","module":"auth-routes","userId":"9OE4JWIfIwrCw4fZxJRk4","email":"protected-test-KdU5aBUKqzJHKTIpBzxbu@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstderr[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

{"level":50,"time":1767800726187,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800726363,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767800726608,"env":"test","module":"user-credentials-repository","userId":"FrjfXtXgesL7qtl8ewM1K","msg":"User credentials created"}
{"level":30,"time":1767800726712,"env":"test","module":"email-queue","jobId":"b873e641-c3f9-4a17-bf54-7dbe30918ecd","to":"middleware-test-H3Pdg6ionz3oTcY7cEbUw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800726733,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800726734,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":6,"totalTokens":1207,"durationMs":1,"estimatedCostUSD":0.01219,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800726734,"env":"test","module":"ai-service","error":{},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767800726742,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767800726742,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"responseTokens":68,"totalTokens":1280,"durationMs":0,"estimatedCostUSD":0.004656,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800726743,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767800726747,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767800726748,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"responseTokens":33,"totalTokens":1234,"durationMs":1,"estimatedCostUSD":0.004098,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767800726748,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767800726753,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"maxTokens":4000,"msg":"AI request started"}
{"level":30,"time":1767800726753,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"responseTokens":44,"totalTokens":302,"durationMs":0,"estimatedCostUSD":0.0039,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1767800726753,"env":"test","module":"ai-service","duration":1,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
{"level":30,"time":1767800726765,"env":"test","module":"auth-routes","userId":"FrjfXtXgesL7qtl8ewM1K","email":"middleware-test-H3Pdg6ionz3oTcY7cEbUw@example.com","msg":"User registered"}
{"level":30,"time":1767800726775,"env":"test","module":"user-credentials-repository","userId":"x8AgmW3JQNVc4QAfsXnI_","msg":"User credentials created"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

 [31m‚ùØ[39m tests/unit/ai.service.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 31647[2mms[22m[39m
       [32m‚úì[39m should initialize with OpenAI configuration[32m 6[2mms[22m[39m
[31m       [31m√ó[31m should generate a valid workflow from description[39m[32m 20[2mms[22m[39m
[31m       [31m√ó[31m should validate unique section IDs[39m[32m 17[2mms[22m[39m
[31m       [31m√ó[31m should validate unique step IDs[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should validate logic rules reference existing steps[39m[32m 7[2mms[22m[39m
[31m       [31m√ó[31m should handle rate limit errors[39m[33m 30006[2mms[22m[39m
       [32m‚úì[39m should handle JSON parsing errors[32m 6[2mms[22m[39m
       [32m‚úì[39m should initialize with Anthropic configuration[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should generate a valid workflow from description[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should strip markdown code blocks from Anthropic responses[39m[32m 5[2mms[22m[39m
       [32m‚úì[39m should generate binding suggestions[32m 5[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstderr[2m | tests/integration/workflow_versioning.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800726884,"env":"test","module":"email-queue","jobId":"d169f549-b110-48ea-9021-8a3d5993f175","to":"protected-test-xaTz6ZU8cGrf8TEt_jQQ0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31m‚ùØ[39m tests/integration/ai/workflowEdit.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 1357[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should create draft version on successful AI edit
     [2m[90m‚Üì[39m[22m should enforce draft mode (revert active workflow to draft)
     [2m[90m‚Üì[39m[22m should not create version when no changes detected (checksum match)
     [2m[90m‚Üì[39m[22m should reject unauthorized access
     [2m[90m‚Üì[39m[22m should reject unsafe DataVault operations
     [2m[90m‚Üì[39m[22m should handle multi-operation edits with tempId resolution
     [2m[90m‚Üì[39m[22m should create BEFORE and AFTER snapshots
     [2m[90m‚Üì[39m[22m should rollback on validation failure
{"level":30,"time":1767800726940,"env":"test","module":"auth-routes","userId":"x8AgmW3JQNVc4QAfsXnI_","email":"protected-test-xaTz6ZU8cGrf8TEt_jQQ0@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800727266,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800727347,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800727347,"env":"test","module":"auth-routes","userId":"FrjfXtXgesL7qtl8ewM1K","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800727397,"env":"test","module":"audit-log-service","userId":"FrjfXtXgesL7qtl8ewM1K","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767800727413,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

 [31m‚ùØ[39m tests/integration/mfa.flow.real.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m16 failed[39m[2m)[22m[33m 29726[2mms[22m[39m
[31m       [31m√ó[31m should complete full MFA setup flow[39m[33m 1097[2mms[22m[39m
[31m       [31m√ó[31m should reject invalid TOTP code during setup[39m[33m 1124[2mms[22m[39m
[31m       [31m√ó[31m should not allow MFA setup if already enabled[39m[33m 1428[2mms[22m[39m
       [33m[2m‚úì[22m[39m should generate unique backup codes [33m 1882[2mms[22m[39m
[31m       [31m√ó[31m should store hashed backup codes[39m[33m 1135[2mms[22m[39m
[31m       [31m√ó[31m should require MFA for enabled users[39m[33m 1383[2mms[22m[39m
[31m       [31m√ó[31m should complete MFA login with valid TOTP[39m[33m 1382[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject invalid TOTP during login [33m 1473[2mms[22m[39m
[31m       [31m√ó[31m should accept TOTP codes within 60-second window[39m[33m 1746[2mms[22m[39m
[31m       [31m√ó[31m should login with valid backup code[39m[33m 2028[2mms[22m[39m
       [33m[2m‚úì[22m[39m should mark backup code as used [33m 1237[2mms[22m[39m
[31m       [31m√ó[31m should prevent backup code reuse[39m[33m 1193[2mms[22m[39m
[31m       [31m√ó[31m should try TOTP before backup code[39m[33m 1543[2mms[22m[39m
[31m       [31m√ó[31m should return MFA status for user[39m[33m 1088[2mms[22m[39m
[31m       [31m√ó[31m should return backup codes count for MFA users[39m[33m 1475[2mms[22m[39m
[31m       [31m√ó[31m should disable MFA with password verification[39m[33m 1538[2mms[22m[39m
[31m       [31m√ó[31m should require correct password to disable MFA[39m[33m 1496[2mms[22m[39m
[31m       [31m√ó[31m should regenerate backup codes[39m[33m 1887[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return error if MFA not enabled [33m 1558[2mms[22m[39m
[31m       [31m√ó[31m should enforce MFA for tenant users when required by tenant[39m[33m 1223[2mms[22m[39m
[90mstderr[2m | tests/unit/schema/collections.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767800727664,"env":"test","module":"email-queue","jobId":"d58e72d2-b03e-4767-85a0-0d6944ddffee","to":"test-1767800727008-8p2uo5@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800727664,"env":"test","module":"auth-service","email":"test-1767800727008-8p2uo5@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800727718,"env":"test","module":"user-credentials-repository","userId":"D7d34l_L07dUe8jWPpwIL","msg":"User credentials created"}
 [31m‚ùØ[39m tests/integration/workflow_versioning.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1358[2mms[22m[39m
     [32m‚úì[39m should diff two versions correctly[32m 3[2mms[22m[39m
[31m     [31m√ó[31m should create a version and populate changelog[39m[32m 9[2mms[22m[39m
[31m     [31m√ó[31m should track execution lineage via snapshot[39m[32m 51[2mms[22m[39m
{"level":50,"time":1767800727771,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstderr[2m | tests/unit/api.ai.logic.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800727820,"env":"test","module":"email-queue","jobId":"72f4d6f1-5e63-4e50-89d0-16081c15468c","to":"protected-test-P1MC8p63wHfHTicr2XOuU@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800727871,"env":"test","module":"auth-routes","userId":"D7d34l_L07dUe8jWPpwIL","email":"protected-test-P1MC8p63wHfHTicr2XOuU@example.com","msg":"User registered"}
 [31m‚ùØ[39m tests/unit/schema/collections.test.ts [2m([22m[2m34 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1010[2mms[22m[39m
       [32m‚úì[39m should have correct table name[32m 3[2mms[22m[39m
       [32m‚úì[39m should have required columns[32m 2[2mms[22m[39m
       [32m‚úì[39m should have correct table name[32m 0[2mms[22m[39m
       [32m‚úì[39m should have required columns[32m 1[2mms[22m[39m
       [32m‚úì[39m should have correct table name[32m 0[2mms[22m[39m
       [32m‚úì[39m should have required columns[32m 1[2mms[22m[39m
       [32m‚úì[39m should have all expected field types[32m 1[2mms[22m[39m
         [32m‚úì[39m should validate valid collection data[32m 2[2mms[22m[39m
         [32m‚úì[39m should require tenantId, name, and slug[32m 1[2mms[22m[39m
[31m         [31m√ó[31m should omit id, createdAt, and updatedAt[39m[32m 10[2mms[22m[39m
         [32m‚úì[39m should allow description to be null[32m 0[2mms[22m[39m
         [32m‚úì[39m should validate valid field data[32m 1[2mms[22m[39m
         [32m‚úì[39m should require collectionId, name, slug, and type[32m 1[2mms[22m[39m
         [32m‚úì[39m should validate field type enum[32m 1[2mms[22m[39m
         [32m‚úì[39m should reject invalid field type[32m 0[2mms[22m[39m
         [32m‚úì[39m should allow options for select types[32m 2[2mms[22m[39m
         [32m‚úì[39m should allow defaultValue[32m 0[2mms[22m[39m
         [32m‚úì[39m should validate valid record data[32m 1[2mms[22m[39m
         [32m‚úì[39m should require tenantId, collectionId, and data[32m 0[2mms[22m[39m
         [32m‚úì[39m should allow empty data object[32m 0[2mms[22m[39m
         [32m‚úì[39m should allow createdBy and updatedBy to be null[32m 0[2mms[22m[39m
         [32m‚úì[39m should allow complex nested data structures[32m 0[2mms[22m[39m
       [32m‚úì[39m should enforce unique slug per tenant for collections[32m 0[2mms[22m[39m
       [32m‚úì[39m should enforce unique slug per collection for fields[32m 0[2mms[22m[39m
       [32m‚úì[39m should cascade delete fields when collection is deleted[32m 0[2mms[22m[39m
       [32m‚úì[39m should cascade delete records when collection is deleted[32m 0[2mms[22m[39m
       [32m‚úì[39m should cascade delete records when tenant is deleted[32m 0[2mms[22m[39m
       [32m‚úì[39m should set null on createdBy/updatedBy when user is deleted[32m 2[2mms[22m[39m
       [32m‚úì[39m should support JSONB for field options[32m 1[2mms[22m[39m
       [32m‚úì[39m should support JSONB for field default values[32m 6[2mms[22m[39m
       [32m‚úì[39m should support JSONB for record data with fieldSlug ‚Üí value mapping[32m 1[2mms[22m[39m
       [32m‚úì[39m should correctly infer Collection type[32m 0[2mms[22m[39m
       [32m‚úì[39m should correctly infer CollectionField type[32m 0[2mms[22m[39m
       [32m‚úì[39m should correctly infer CollectionRecord type[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":40,"time":1767800728063,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767800728082,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstderr[2m | tests/integration/analytics_service.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800728101,"env":"test","module":"user-credentials-repository","userId":"1522d30d9dcc9f80fe7f17c0a79255e5","msg":"User password updated"}
[90mstderr[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800728120,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI logic generation failed"}
[90mstderr[2m | tests/unit/api.ai.logic.test.ts[2m > [22m[2mAI Logic Routes[2m > [22m[2mPOST /api/ai/workflows/generate-logic[2m > [22m[2mshould return generated logic
[22m[39mLogic Test Failed: {
  "success": false,
  "message": "Invalid request data",
  "error": "validation_error",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": [
        "currentWorkflow",
        "title"
      ],
      "message": "Required"
    }
  ]
}

{"level":30,"time":1767800728148,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767800728159,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI debug logic failed"}
{"level":30,"time":1767800728164,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767800728177,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI visualize logic failed"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800728267,"env":"test","module":"audit-log-service","userId":"1522d30d9dcc9f80fe7f17c0a79255e5","eventType":"password_reset","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800728280,"env":"test","module":"user-credentials-repository","userId":"jC-xwXyI0xKWyT1z6MZZp","msg":"User credentials created"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

 [31m‚ùØ[39m tests/unit/api.ai.logic.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 936[2mms[22m[39m
[31m       [31m√ó[31m should return generated logic[39m[32m 69[2mms[22m[39m
[31m       [31m√ó[31m should return debug issues[39m[32m 16[2mms[22m[39m
[31m       [31m√ó[31m should return graph data[39m[32m 25[2mms[22m[39m
{"level":30,"time":1767800728381,"env":"test","module":"email-queue","jobId":"2827721d-10fb-4c2f-a92c-6cebf0b57192","to":"middleware-test-5oWl0xhV7cPqGkALV8EEK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800728432,"env":"test","module":"auth-routes","userId":"jC-xwXyI0xKWyT1z6MZZp","email":"middleware-test-5oWl0xhV7cPqGkALV8EEK@example.com","msg":"User registered"}
{"level":40,"time":1767800728474,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767800728498,"env":"test","module":"auth-routes","userId":"D7d34l_L07dUe8jWPpwIL","msg":"User logged in successfully"}
{"level":30,"time":1767800728555,"env":"test","module":"audit-log-service","userId":"D7d34l_L07dUe8jWPpwIL","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstderr[2m | tests/unit/api.ai.revise.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767800728811,"env":"test","module":"auth-routes","userId":"1522d30d9dcc9f80fe7f17c0a79255e5","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800728852,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800728865,"env":"test","module":"audit-log-service","userId":"1522d30d9dcc9f80fe7f17c0a79255e5","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [31m‚ùØ[39m tests/integration/analytics_service.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1191[2mms[22m[39m
[31m     [31m√ó[31m should generate events and metrics on run completion[39m[32m 65[2mms[22m[39m
{"level":50,"time":1767800728891,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts[2m > [22m[2mAI Routes Integration[2m > [22m[2mPOST /api/ai/workflows/revise[2m > [22m[2mshould call AIService.reviseWorkflow with correct parameters
[22m[39mRevise Test Failed: {
  "success": false,
  "message": "Invalid request data",
  "error": "validation_error",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": [
        "currentWorkflow",
        "title"
      ],
      "message": "Required"
    }
  ]
}

{"level":30,"time":1767800728937,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
 [31m‚ùØ[39m tests/integration/workflows/runtime-pipelines.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 1281[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create DataVault row on workflow completion
       [2m[90m‚Üì[39m[22m should execute writebacks via RunService.completeRun()
       [2m[90m‚Üì[39m[22m should skip document generation when visibleIf condition is false
       [2m[90m‚Üì[39m[22m should generate document when visibleIf condition is true
{"level":50,"time":1767800728971,"env":"test","module":"ai-controller","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["workflowId"]},{"code":"invalid_type","expected":"object","received":"undefined","path":["currentWorkflow"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["userInstruction"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800728990,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800728997,"env":"test","module":"auth-routes","userId":"jC-xwXyI0xKWyT1z6MZZp","msg":"User logged in successfully"}
{"level":30,"time":1767800729048,"env":"test","module":"audit-log-service","userId":"jC-xwXyI0xKWyT1z6MZZp","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

 [31m‚ùØ[39m tests/unit/api.ai.revise.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 960[2mms[22m[39m
[31m       [31m√ó[31m should call AIService.reviseWorkflow with correct parameters[39m[32m 89[2mms[22m[39m
       [32m‚úì[39m should return 400 for invalid request usage[32m 39[2mms[22m[39m
{"level":30,"time":1767800729128,"env":"test","module":"user-credentials-repository","userId":"9LcTkaMr6kbnnlrkffNoM","msg":"User credentials created"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800729211,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800729217,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800729223,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767800729230,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800729236,"env":"test","module":"email-queue","jobId":"9e7ff1ae-e8eb-4987-bc0b-430fe21902e8","to":"protected-test-XcBh1Z0rZ8kNRj7A6P3hd@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800729290,"env":"test","module":"auth-routes","userId":"9LcTkaMr6kbnnlrkffNoM","email":"protected-test-XcBh1Z0rZ8kNRj7A6P3hd@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

{"level":50,"time":1767800729411,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800729543,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstderr[2m | tests/unit/services/StepService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1767800729693,"env":"test","module":"user-credentials-repository","userId":"ljycvOwPMrELdeualiLmT","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/portal.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstderr[2m | tests/ListTools.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800729802,"env":"test","module":"email-queue","jobId":"1e73c575-b4e9-48e0-9b16-36a60c9975c9","to":"middleware-test-q72IY-kifyeSpKYGBqtHS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mdrizzle-orm[24m/node-postgres/migrator.js:4:20[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:66:17
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m

{"level":30,"time":1767800729815,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767800729835,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800729836,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1767800729837,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767800729841,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1767800729841,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
{"level":30,"time":1767800729855,"env":"test","module":"auth-routes","userId":"ljycvOwPMrELdeualiLmT","email":"middleware-test-q72IY-kifyeSpKYGBqtHS@example.com","msg":"User registered"}
 [31m‚ùØ[39m tests/unit/writes/WriteRunner.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 43[2mms[22m[39m
[31m       [31m√ó[31m should resolve values and call createRowWithValues[39m[32m 23[2mms[22m[39m
       [32m‚úì[39m should simulate write in preview mode[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should find row by PK and update[39m[32m 4[2mms[22m[39m
       [32m‚úì[39m should return failure result if row not found[32m 2[2mms[22m[39m
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800729936,"env":"test","module":"auth-routes","userId":"9LcTkaMr6kbnnlrkffNoM","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

 [31m‚ùØ[39m tests/unit/services/StepService.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 933[2mms[22m[39m
[31m       [31m√ó[31m should create a step with auto-incrementing order[39m[32m 18[2mms[22m[39m
       [32m‚úì[39m should create step with order 1 if section is empty[32m 1[2mms[22m[39m
       [32m‚úì[39m should validate alias uniqueness before creating[32m 3[2mms[22m[39m
       [32m‚úì[39m should allow creating step with null alias[32m 1[2mms[22m[39m
       [32m‚úì[39m should throw error if section not found[32m 1[2mms[22m[39m
       [32m‚úì[39m should verify workflow ownership[32m 1[2mms[22m[39m
       [32m‚úì[39m should update step successfully[32m 2[2mms[22m[39m
       [32m‚úì[39m should validate alias uniqueness when updating alias[32m 1[2mms[22m[39m
       [32m‚úì[39m should allow updating step without changing alias[32m 1[2mms[22m[39m
       [32m‚úì[39m should throw error if step not found[32m 1[2mms[22m[39m
       [32m‚úì[39m should throw error if step does not belong to workflow[32m 1[2mms[22m[39m
       [32m‚úì[39m should delete step successfully[32m 1[2mms[22m[39m
       [32m‚úì[39m should throw error if step not found[32m 1[2mms[22m[39m
       [32m‚úì[39m should throw error if step does not belong to workflow[32m 1[2mms[22m[39m
{"level":30,"time":1767800729988,"env":"test","module":"audit-log-service","userId":"9LcTkaMr6kbnnlrkffNoM","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800730025,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"filtered_users","filters":{"combinator":"and","rules":[{"fieldPath":"city","op":"equals","valueSource":"const","value":"NYC"}]}},"msg":"List tools block failed"}
{"level":30,"time":1767800730027,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/ListTools.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800730041,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"senior_users","filters":{"combinator":"and","rules":[{"fieldPath":"age","op":"greater_than","valueSource":"const","value":30}]}},"msg":"List tools block failed"}
{"level":50,"time":1767800730044,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"active_nyc","filters":{"combinator":"and","rules":[{"fieldPath":"city","op":"equals","valueSource":"const","value":"NYC"},{"fieldPath":"active","op":"equals","valueSource":"const","value":true}]}},"msg":"List tools block failed"}
{"level":50,"time":1767800730046,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"young_or_sf","filters":{"combinator":"or","rules":[{"fieldPath":"age","op":"less_than","valueSource":"const","value":28},{"fieldPath":"city","op":"equals","valueSource":"const","value":"SF"}]}},"msg":"List tools block failed"}
{"level":50,"time":1767800730050,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"age","direction":"asc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767800730052,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"name","direction":"desc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767800730055,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"city","direction":"asc"},{"fieldPath":"age","direction":"desc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767800730058,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"limited_users","limit":3},"msg":"List tools block failed"}
{"level":50,"time":1767800730060,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"offset_users","offset":2},"msg":"List tools block failed"}
{"level":50,"time":1767800730064,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"paged_users","offset":1,"limit":2},"msg":"List tools block failed"}
{"level":50,"time":1767800730067,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"name_age_only","select":["name","age"]},"msg":"List tools block failed"}
{"level":50,"time":1767800730070,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"unique_cities","dedupe":{"fieldPath":"city"}},"msg":"List tools block failed"}
{"level":50,"time":1767800730074,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"all_users","outputs":{"countVar":"user_count"}},"msg":"List tools block failed"}
{"level":50,"time":1767800730076,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"all_users","sort":[{"fieldPath":"age","direction":"asc"}],"outputs":{"firstVar":"youngest_user"}},"msg":"List tools block failed"}
{"level":50,"time":1767800730078,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"processed_users","filters":{"combinator":"and","rules":[{"fieldPath":"active","op":"equals","valueSource":"const","value":true}]},"sort":[{"fieldPath":"age","direction":"desc"}],"offset":0,"limit":2,"select":["name","age"],"outputs":{"countVar":"active_count","firstVar":"oldest_active"}},"msg":"List tools block failed"}
{"level":50,"time":1767800730081,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"filtered_users","filters":{"combinator":"and","rules":[{"fieldPath":"age","op":"greater_than","valueSource":"const","value":30}]}},"msg":"List tools block failed"}
{"level":40,"time":1767800730082,"env":"test","sourceListVar":"nonexistent_list","inputKey":"nonexistent_list","msg":"Input list not found, treating as empty array"}
{"level":50,"time":1767800730085,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"simple_array","outputListVar":"sorted_array","sort":[{"fieldPath":"score","direction":"desc"}]},"msg":"List tools block failed"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

{"level":50,"time":1767800730164,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31m‚ùØ[39m tests/ListTools.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 906[2mms[22m[39m
[31m       [31m√ó[31m should filter rows by equals condition[39m[32m 18[2mms[22m[39m
[31m       [31m√ó[31m should filter with greater_than operator[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should filter with AND combinator[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should filter with OR combinator[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should sort by single key ascending[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should sort by single key descending[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should sort by multiple keys[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should apply limit[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should apply offset[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should apply offset and limit together[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should select specific columns[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should deduplicate by field[39m[32m 4[2mms[22m[39m
[31m       [31m√ó[31m should output count variable[39m[32m 3[2mms[22m[39m
[31m       [31m√ó[31m should output first row variable[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should apply all operations in sequence[39m[32m 2[2mms[22m[39m
[31m       [31m√ó[31m should handle empty input list[39m[32m 2[2mms[22m[39m
       [32m‚úì[39m should handle missing source list[32m 1[2mms[22m[39m
[31m       [31m√ó[31m should handle plain arrays[39m[32m 3[2mms[22m[39m
[90mstderr[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

{"level":30,"time":1767800730464,"env":"test","module":"user-credentials-repository","userId":"wR2szKhS01pg-HV0-GKCl","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1767800730572,"env":"test","module":"email-queue","jobId":"f6a1f83c-ce23-4b93-8e0d-eadecbc6500d","to":"user2-xMhS0wsj4nMF6hzxvrbKu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

{"level":30,"time":1767800730624,"env":"test","module":"auth-routes","userId":"wR2szKhS01pg-HV0-GKCl","email":"user2-xMhS0wsj4nMF6hzxvrbKu@example.com","msg":"User registered"}
{"level":30,"time":1767800730676,"env":"test","module":"user-credentials-repository","userId":"DleAgrwHAvGB8x2n36vpi","msg":"User credentials created"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1767800730714,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800730734,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767800730780,"env":"test","module":"email-queue","jobId":"cafdb1f0-5214-4174-bbe6-bdb6c039c3c7","to":"middleware-test-x5f1Leyq3UfTKTLPX4X2C@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800730831,"env":"test","module":"auth-routes","userId":"DleAgrwHAvGB8x2n36vpi","email":"middleware-test-x5f1Leyq3UfTKTLPX4X2C@example.com","msg":"User registered"}
{"level":50,"time":1767800730952,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

{"level":50,"time":1767800731137,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767800731155,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800731404,"env":"test","module":"user-credentials-repository","userId":"FPQbrs23qac5EWjMZphZt","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800731548,"env":"test","module":"email-queue","jobId":"c564c51b-c692-4c13-90d6-a27672aff1b4","to":"protected-test-TveYquuOfEsc8e_rXYywJ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800731571,"env":"test","module":"user-credentials-repository","userId":"K59XjOHGPJbpdJw9qyem3","msg":"User credentials created"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767800731606,"env":"test","module":"auth-routes","userId":"FPQbrs23qac5EWjMZphZt","email":"protected-test-TveYquuOfEsc8e_rXYywJ@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800731674,"env":"test","module":"email-queue","jobId":"1902c67f-e9fc-4500-b91a-1775347ef041","to":"middleware-test-GLhvB4tJQ8HFjnkGasAeN@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800731727,"env":"test","module":"auth-routes","userId":"K59XjOHGPJbpdJw9qyem3","email":"middleware-test-GLhvB4tJQ8HFjnkGasAeN@example.com","msg":"User registered"}
{"level":30,"time":1767800731770,"env":"test","module":"email-queue","jobId":"e7179d15-3dc5-4e16-bdb3-e73febe3239f","to":"test-1767800731101-lodgmp@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800731770,"env":"test","module":"auth-service","email":"test-1767800731101-lodgmp@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstderr[2m | tests/unit/server/organizationInvites.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800732137,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800732210,"env":"test","module":"auth-routes","userId":"FPQbrs23qac5EWjMZphZt","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800732234,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstderr[2m | tests/unit/debugging/Lineage.test.ts[2m > [22m[2mDebug & Lineage[2m > [22m[2mshould generate execution trace with lineage
[22m[39m[DEBUG Question] Node q1 executed. Key: userName, Value: Alice. Context keys: 3

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800732266,"env":"test","module":"audit-log-service","userId":"FPQbrs23qac5EWjMZphZt","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800732321,"env":"test","module":"auth-routes","userId":"K59XjOHGPJbpdJw9qyem3","msg":"User logged in successfully"}
{"level":30,"time":1767800732371,"env":"test","module":"audit-log-service","userId":"K59XjOHGPJbpdJw9qyem3","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [31m‚ùØ[39m tests/unit/debugging/Lineage.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 963[2mms[22m[39m
     [32m‚úì[39m should generate execution trace with lineage[32m 21[2mms[22m[39m
[31m     [31m√ó[31m should track skipped blocks in trace[39m[32m 10[2mms[22m[39m
{"level":50,"time":1767800732432,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstderr[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800732560,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800732858,"env":"test","module":"user-credentials-repository","userId":"K97eUDI9AhiGFI0HtRd3H","msg":"User credentials created"}
{"level":30,"time":1767800732864,"env":"test","module":"user-credentials-repository","userId":"l_6Z_nHBNrHZ_sDcuaGXg","msg":"User credentials created"}
{"level":30,"time":1767800732966,"env":"test","module":"email-queue","jobId":"ad7036b6-d88c-4b7d-8b9b-e8d95733914b","to":"protected-test-kp2gjteb6lUKqOqKoPPbW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800732970,"env":"test","module":"email-queue","jobId":"1a4f7657-d034-4b07-b645-59829e7b2e23","to":"middleware-test-9OF9wacd-VB7ZMgJl7QTz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800733023,"env":"test","module":"auth-routes","userId":"l_6Z_nHBNrHZ_sDcuaGXg","email":"middleware-test-9OF9wacd-VB7ZMgJl7QTz@example.com","msg":"User registered"}
{"level":30,"time":1767800733023,"env":"test","module":"auth-routes","userId":"K97eUDI9AhiGFI0HtRd3H","email":"protected-test-kp2gjteb6lUKqOqKoPPbW@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstderr[2m | tests/unit/engine/templateNode.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800733614,"env":"test","module":"auth-routes","userId":"l_6Z_nHBNrHZ_sDcuaGXg","msg":"User logged in successfully"}
{"level":30,"time":1767800733641,"env":"test","module":"auth-routes","userId":"K97eUDI9AhiGFI0HtRd3H","msg":"User logged in successfully"}
{"level":30,"time":1767800733667,"env":"test","module":"audit-log-service","userId":"l_6Z_nHBNrHZ_sDcuaGXg","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800733695,"env":"test","module":"audit-log-service","userId":"K97eUDI9AhiGFI0HtRd3H","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800733738,"env":"test","module":"auth-routes","userId":"5d4cae1d78057f775837940d315664bf","msg":"User logged in successfully"}
{"level":30,"time":1767800733794,"env":"test","module":"audit-log-service","userId":"5d4cae1d78057f775837940d315664bf","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/integration/api.runs.docx.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800734205,"env":"test","module":"user-credentials-repository","userId":"WuHaAVOr7MRJpkU28rZ2m","msg":"User credentials created"}
{"level":30,"time":1767800734220,"env":"test","module":"user-credentials-repository","userId":"MW-atT6bVHtUta3uregXg","msg":"User credentials created"}
{"level":30,"time":1767800734313,"env":"test","module":"email-queue","jobId":"b6cdea23-5bf5-429c-ae90-772b3cdcf16a","to":"middleware-test-DecxVv0tjsRYdJ1HpAdQd@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800734332,"env":"test","module":"email-queue","jobId":"4786ce4a-2698-4d1e-9eb0-c0baf4a4186c","to":"protected-test-58gr4KIfZJOhTlXfyTdgr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800734361,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800734367,"env":"test","module":"auth-routes","userId":"WuHaAVOr7MRJpkU28rZ2m","email":"middleware-test-DecxVv0tjsRYdJ1HpAdQd@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800734387,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800734373,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800734374,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800734379,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800734387,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800734387,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800734387,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800734387,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767800734397,"env":"test","module":"auth-routes","userId":"MW-atT6bVHtUta3uregXg","email":"protected-test-58gr4KIfZJOhTlXfyTdgr@example.com","msg":"User registered"}
[90mstderr[2m | tests/integration/api.ai.doc.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800734684,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800734685,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800734708,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":50,"time":1767800734717,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767800734695,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800734696,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800734702,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800734707,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800734708,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800734708,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800734708,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1767800734749,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests[2m > [22m[2mPOST /api/ai/doc/analyze[2m > [22m[2mshould analyze a DOCX file and return variables
[22m[39mFAIL_STATUS: 500
FAIL_BODY: {}

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39müßπ Cleaning up test environment...

 [31m‚ùØ[39m tests/integration/api.runs.docx.test.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 1018[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should execute workflow with template node and generate DOCX
       [2m[90m‚Üì[39m[22m should handle missing template data gracefully
       [2m[90m‚Üì[39m[22m should download DOCX output from successful run
       [2m[90m‚Üì[39m[22m should return 404 for PDF when not generated
       [2m[90m‚Üì[39m[22m should return 404 for non-existent run
       [2m[90m‚Üì[39m[22m should extract placeholders from uploaded template
[90mstderr[2m | tests/integration/api.projects.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [31m‚ùØ[39m tests/integration/api.ai.doc.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 924[2mms[22m[39m
[31m       [31m√ó[31m should analyze a DOCX file and return variables[39m[32m 45[2mms[22m[39m
[31m       [31m√ó[31m should fail if no file is provided[39m[32m 10[2mms[22m[39m
       [32m‚úì[39m should suggest mappings between template and workflow variables[32m 24[2mms[22m[39m
       [32m‚úì[39m should return improvement suggestions[32m 7[2mms[22m[39m
{"level":30,"time":1767800735093,"env":"test","module":"user-credentials-repository","userId":"97UeMiQd6YVVD5QiqXF5X","msg":"User credentials created"}
{"level":30,"time":1767800735116,"env":"test","module":"user-credentials-repository","userId":"T5Dx648Yoy7bZyYa2IC75","msg":"User credentials created"}
{"level":30,"time":1767800735128,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800735152,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.projects.test.ts[2m > [22m[2mProjects API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800735138,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800735139,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800735144,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800735151,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800735151,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800735152,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800735152,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767800735199,"env":"test","module":"email-queue","jobId":"ff72f621-ebd8-42f5-98e3-a0bed692b2bc","to":"middleware-test-_V2M58R4m5sKYc1p6eH04@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800735220,"env":"test","module":"email-queue","jobId":"d6c0ce4f-faa9-4366-8b66-9fbe3a165797","to":"protected-test-vTAWYL4XUuSk9_mRj0cNi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800735253,"env":"test","module":"auth-routes","userId":"97UeMiQd6YVVD5QiqXF5X","email":"middleware-test-_V2M58R4m5sKYc1p6eH04@example.com","msg":"User registered"}
{"level":30,"time":1767800735273,"env":"test","module":"auth-routes","userId":"T5Dx648Yoy7bZyYa2IC75","email":"protected-test-vTAWYL4XUuSk9_mRj0cNi@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

{"level":50,"time":1767800735578,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800735593,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767800735596,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31m‚ùØ[39m tests/integration/api.projects.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 1012[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create a new project
       [2m[90m‚Üì[39m[22m should reject without authentication
       [2m[90m‚Üì[39m[22m should reject with invalid data
       [2m[90m‚Üì[39m[22m should list projects for tenant
       [2m[90m‚Üì[39m[22m should support pagination
       [2m[90m‚Üì[39m[22m should get project by ID
       [2m[90m‚Üì[39m[22m should return 404 for non-existent project
       [2m[90m‚Üì[39m[22m should update project
       [2m[90m‚Üì[39m[22m should soft-delete project
       [2m[90m‚Üì[39m[22m should not allow cross-tenant access
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800736006,"env":"test","module":"user-credentials-repository","userId":"5-iE8zYtTgTqKnQx-cTSE","msg":"User credentials created"}
{"level":30,"time":1767800736038,"env":"test","module":"user-credentials-repository","userId":"uK_azLMbq0ZBtRfIRgwHd","msg":"User credentials created"}
{"level":30,"time":1767800736106,"env":"test","module":"email-queue","jobId":"b0038ab3-4dd3-498a-b1ef-498798b317a9","to":"middleware-test-tEFRYW1jqlOjoAZNrJWyR@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767800736150,"env":"test","module":"email-queue","jobId":"d2ebbb11-6054-4e38-a27a-f771c2910d89","to":"protected-test-tAyjxw6WyeIvuox5EJj-j@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800736155,"env":"test","module":"auth-routes","userId":"5-iE8zYtTgTqKnQx-cTSE","email":"middleware-test-tEFRYW1jqlOjoAZNrJWyR@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800736202,"env":"test","module":"auth-routes","userId":"uK_azLMbq0ZBtRfIRgwHd","email":"protected-test-tAyjxw6WyeIvuox5EJj-j@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstderr[2m | tests/integration/api.snapshots.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/js_helpers.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":50,"time":1767800736463,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/integration/api.runs.graph.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/unit/server/organizationService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800736741,"env":"test","module":"auth-routes","userId":"uK_azLMbq0ZBtRfIRgwHd","msg":"User logged in successfully"}
{"level":30,"time":1767800736792,"env":"test","module":"audit-log-service","userId":"uK_azLMbq0ZBtRfIRgwHd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800736857,"env":"test","module":"user-credentials-repository","userId":"GMXl3jyhZxLPa3qDLlJRg","msg":"User credentials created"}
 [31m‚ùØ[39m tests/integration/api.snapshots.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 806[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should maintain immutability of runs across versions
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800736961,"env":"test","module":"email-queue","jobId":"a7269e89-32ae-4260-8853-04ea4bd33b47","to":"middleware-test-cbfRoaDWaCtX8Vm0iMKfM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31m‚ùØ[39m tests/integration/js_helpers.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 814[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should execute a JS block that uses helper functions
{"level":30,"time":1767800737014,"env":"test","module":"auth-routes","userId":"GMXl3jyhZxLPa3qDLlJRg","email":"middleware-test-cbfRoaDWaCtX8Vm0iMKfM@example.com","msg":"User registered"}
{"level":50,"time":1767800737065,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/organizations-workflow.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [31m‚ùØ[39m tests/integration/api.runs.graph.test.ts [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[33m 788[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should list all runs with pagination
       [2m[90m‚Üì[39m[22m should filter runs by status
       [2m[90m‚Üì[39m[22m should filter runs by workflow
       [2m[90m‚Üì[39m[22m should filter runs by project
       [2m[90m‚Üì[39m[22m should filter runs by date range
       [2m[90m‚Üì[39m[22m should search runs by query string
       [2m[90m‚Üì[39m[22m should get run by ID with all details
       [2m[90m‚Üì[39m[22m should return 404 for non-existent run
       [2m[90m‚Üì[39m[22m should get logs for a run
       [2m[90m‚Üì[39m[22m should re-run workflow with same inputs
       [2m[90m‚Üì[39m[22m should re-run workflow with override inputs
       [2m[90m‚Üì[39m[22m should return 404 for non-existent run
       [2m[90m‚Üì[39m[22m should export runs to CSV
       [2m[90m‚Üì[39m[22m should export runs with filters applied
       [2m[90m‚Üì[39m[22m should compare two runs
       [2m[90m‚Üì[39m[22m should identify changed input keys
       [2m[90m‚Üì[39m[22m should return 404 if run A not found
       [2m[90m‚Üì[39m[22m should return 404 if run B not found
       [2m[90m‚Üì[39m[22m should enforce tenant isolation on runs list
{"level":30,"time":1767800737468,"env":"test","module":"user-credentials-repository","userId":"moOT0mRgFh32AqBwTbbV8","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767800737555,"env":"test","module":"auth-routes","userId":"GMXl3jyhZxLPa3qDLlJRg","msg":"User logged in successfully"}
{"level":30,"time":1767800737578,"env":"test","module":"email-queue","jobId":"d384bfa6-a7d4-4137-83fb-72ed8a7ed736","to":"protected-test-iYrUS1OFsB0eicL0J85DL@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800737608,"env":"test","module":"audit-log-service","userId":"GMXl3jyhZxLPa3qDLlJRg","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800737633,"env":"test","module":"auth-routes","userId":"moOT0mRgFh32AqBwTbbV8","email":"protected-test-iYrUS1OFsB0eicL0J85DL@example.com","msg":"User registered"}
{"level":30,"time":1767800737664,"env":"test","module":"auth-routes","userId":"64671d0423ebd91a6bcb0a4be50dd744","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767800737777,"env":"test","module":"mfa-service","userId":"64671d0423ebd91a6bcb0a4be50dd744","msg":"TOTP verification successful"}
{"level":30,"time":1767800737833,"env":"test","module":"auth-routes","userId":"64671d0423ebd91a6bcb0a4be50dd744","msg":"MFA login successful"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39müß™ Setting up test environment...

{"level":50,"time":1767800738064,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"Failed to render template"}
{"level":30,"time":1767800738106,"env":"test","module":"user-credentials-repository","userId":"y1K3id3CvklZiVl3PliHe","msg":"User credentials created"}
{"level":30,"time":1767800738175,"env":"test","module":"auth-routes","userId":"moOT0mRgFh32AqBwTbbV8","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800738215,"env":"test","module":"email-queue","jobId":"58351b0a-4839-41a4-92f7-f8fd96d4366b","to":"middleware-test-BGgaVb167k6jL6ku_5KDM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800738228,"env":"test","module":"audit-log-service","userId":"moOT0mRgFh32AqBwTbbV8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767800738265,"env":"test","module":"auth-routes","userId":"y1K3id3CvklZiVl3PliHe","email":"middleware-test-BGgaVb167k6jL6ku_5KDM@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests[2m > [22m[2mshould generate basic autonumber without prefix
[22m[39mRow 1 Basic Autonumber: 0001
Row 2 Basic Autonumber: 0002

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800738492,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

{"level":50,"time":1767800738575,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800738873,"env":"test","module":"user-credentials-repository","userId":"TeAGEXeU28OLt9UjaSIn2","msg":"User credentials created"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800738956,"env":"test","module":"user-credentials-repository","userId":"n61AGuheSMik7kEZHcR-7","msg":"User credentials created"}
[90mstderr[2m | tests/integration/collections.e2e.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800738984,"env":"test","module":"email-queue","jobId":"11d55183-2dbe-48d9-9861-96749f5b0599","to":"protected-test-Wtc4f6e-JyfDnpa90_5vw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800739041,"env":"test","module":"auth-routes","userId":"TeAGEXeU28OLt9UjaSIn2","email":"protected-test-Wtc4f6e-JyfDnpa90_5vw@example.com","msg":"User registered"}
{"level":30,"time":1767800739059,"env":"test","module":"email-queue","jobId":"7fcbc558-40cd-4ead-b46e-33e5d1c4a209","to":"middleware-test-wVZ228URZ02Vns7yANYLh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800739114,"env":"test","module":"auth-routes","userId":"n61AGuheSMik7kEZHcR-7","email":"middleware-test-wVZ228URZ02Vns7yANYLh@example.com","msg":"User registered"}
[90mstderr[2m | tests/integration/dataBlocks.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":40,"time":1767800739502,"env":"test","module":"mfa-service","userId":"3a8af09c6b62fbfb54cf7ca8e5473885","msg":"TOTP verification failed"}
{"level":40,"time":1767800739502,"env":"test","module":"auth-routes","userId":"3a8af09c6b62fbfb54cf7ca8e5473885","msg":"MFA verification failed during login"}
{"level":30,"time":1767800739580,"env":"test","module":"auth-routes","userId":"TeAGEXeU28OLt9UjaSIn2","msg":"User logged in successfully"}
{"level":30,"time":1767800739632,"env":"test","module":"audit-log-service","userId":"TeAGEXeU28OLt9UjaSIn2","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800739643,"env":"test","module":"auth-routes","userId":"n61AGuheSMik7kEZHcR-7","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800739695,"env":"test","module":"audit-log-service","userId":"n61AGuheSMik7kEZHcR-7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800739699,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800740009,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767800740011,"env":"test","workflowId":"e16f3937-8bef-4090-a859-4ffe9dc1eb2b","userId":"dea12263-d618-44dd-bc6f-c674f27b7b87","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
 [31m‚ùØ[39m tests/integration/auth.routes.real.test.ts [2m([22m[2m26 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 42308[2mms[22m[39m
       [33m[2m‚úì[22m[39m should register a new user successfully [33m 1469[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 400 for invalid email format [33m 837[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 400 for weak password [33m 835[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 409 for duplicate email [33m 1474[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set httpOnly refresh token cookie [33m 1373[2mms[22m[39m
       [33m[2m‚úì[22m[39m should login with valid credentials [33m 1776[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for invalid password [33m 1476[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for non-existent user [33m 1030[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 403 for unverified email [33m 1785[2mms[22m[39m
[31m       [31m√ó[31m should record failed login attempt[39m[33m 1802[2mms[22m[39m
[31m       [31m√ó[31m should return requiresMfa=true for MFA-enabled users[39m[33m 1934[2mms[22m[39m
[31m       [31m√ó[31m should lock account after 5 failed attempts[39m[33m 3079[2mms[22m[39m
       [33m[2m‚úì[22m[39m should logout and clear refresh token cookie [33m 1856[2mms[22m[39m
[31m       [31m√ó[31m should refresh access token with valid refresh token[39m[33m 1507[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for missing refresh token [33m 814[2mms[22m[39m
       [33m[2m‚úì[22m[39m should rotate refresh token after use [33m 2187[2mms[22m[39m
       [33m[2m‚úì[22m[39m should send password reset email for existing user [33m 1478[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not reveal if email exists (security) [33m 904[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reset password with valid token [33m 3216[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 400 for invalid token [33m 882[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 400 for weak new password [33m 1598[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return current user for valid token [33m 2020[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for missing token [33m 844[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return 401 for invalid token [33m 856[2mms[22m[39m
         [33m[2m‚úì[22m[39m should complete MFA login with valid TOTP code [33m 2255[2mms[22m[39m
         [33m[2m‚úì[22m[39m should reject invalid MFA code [33m 1658[2mms[22m[39m
{"level":30,"time":1767800740072,"env":"test","module":"user-credentials-repository","userId":"DK5QWHcQ9C7RH2BFRms7C","msg":"User credentials created"}
{"level":30,"time":1767800740170,"env":"test","module":"email-queue","jobId":"353edefc-f1de-4674-9237-1c86dc1a3224","to":"middleware-test-HKabUYn-bkCBeYY0076_v@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800740222,"env":"test","module":"auth-routes","userId":"DK5QWHcQ9C7RH2BFRms7C","email":"middleware-test-HKabUYn-bkCBeYY0076_v@example.com","msg":"User registered"}
[90mstderr[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1767800740389,"env":"test","module":"user-credentials-repository","userId":"AtjLSld9Kn3F5Rl8_psXi","msg":"User credentials created"}
{"level":30,"time":1767800740451,"env":"test","workflowId":"e16f3937-8bef-4090-a859-4ffe9dc1eb2b","userId":"f0b9b305-6239-4235-9d21-2ad28c305bf6","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1767800740494,"env":"test","module":"email-queue","jobId":"96bcef19-7030-4c63-9c3f-80bb8cf4fab4","to":"protected-test-8NZbqHHbjM5tM0W1aKxjh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767800740526,"env":"test","workflowId":"f3b7d86c-ecb7-4486-9bc5-b8d5426eb531","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":30,"time":1767800740546,"env":"test","module":"auth-routes","userId":"AtjLSld9Kn3F5Rl8_psXi","email":"protected-test-8NZbqHHbjM5tM0W1aKxjh@example.com","msg":"User registered"}
{"level":30,"time":1767800740757,"env":"test","module":"auth-routes","userId":"DK5QWHcQ9C7RH2BFRms7C","msg":"User logged in successfully"}
{"level":30,"time":1767800740812,"env":"test","module":"audit-log-service","userId":"DK5QWHcQ9C7RH2BFRms7C","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767800741093,"env":"test","module":"auth-routes","userId":"AtjLSld9Kn3F5Rl8_psXi","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767800741144,"env":"test","module":"audit-log-service","userId":"AtjLSld9Kn3F5Rl8_psXi","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767800741397,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/protected.routes.test.ts:37:9 {
  length: [33m361[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(ZjxXARxaFMSjPdYzsXUg3) is still referenced from table "workflow_versions".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'workflow_versions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'workflow_versions_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/components/datavault/TableGridView.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 2446[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests
[22m[39mError cleaning up table: Error: Table not found
    at DatavaultTablesService.verifyTenantOwnership (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:150:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablesService.deleteTable (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:290:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/datavault.autonumber.test.ts:90:9

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800741919,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31m‚ùØ[39m tests/integration/auth/protected.routes.test.ts [2m([22m[2m33 tests[22m[2m | [22m[31m25 failed[39m[2m)[22m[33m 38788[2mms[22m[39m
[31m       [31m√ó[31m should allow access with valid Bearer token[39m[33m 893[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject access without Authorization header [33m 1141[2mms[22m[39m
[31m       [31m√ó[31m should reject access with empty Bearer token[39m[33m 860[2mms[22m[39m
[31m       [31m√ó[31m should reject access with malformed Authorization header[39m[33m 863[2mms[22m[39m
[31m       [31m√ó[31m should reject access with wrong token type[39m[33m 879[2mms[22m[39m
[31m       [31m√ó[31m should allow POST with valid Bearer token[39m[33m 859[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject POST without Bearer token [33m 1195[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject POST with invalid token [33m 1176[2mms[22m[39m
[31m       [31m√ó[31m should allow PUT with valid Bearer token[39m[33m 882[2mms[22m[39m
[31m       [31m√ó[31m should reject PUT without Bearer token[39m[33m 913[2mms[22m[39m
[31m       [31m√ó[31m should allow DELETE with valid Bearer token[39m[33m 885[2mms[22m[39m
[31m       [31m√ó[31m should reject DELETE without Bearer token[39m[33m 871[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow PATCH with valid Bearer token [33m 1874[2mms[22m[39m
[31m       [31m√ó[31m should reject PATCH without Bearer token[39m[33m 914[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle Bearer token with extra spaces [33m 1201[2mms[22m[39m
[31m       [31m√ó[31m should handle token with newlines[39m[33m 882[2mms[22m[39m
[31m       [31m√ó[31m should handle very long invalid token[39m[33m 879[2mms[22m[39m
[31m       [31m√ó[31m should handle empty Authorization header[39m[33m 885[2mms[22m[39m
[31m       [31m√ó[31m should handle Authorization header with only Bearer[39m[33m 902[2mms[22m[39m
[31m       [31m√ó[31m should handle multiple Authorization headers[39m[33m 965[2mms[22m[39m
[31m       [31m√ó[31m should reject token with SQL injection attempt[39m[33m 930[2mms[22m[39m
[31m       [31m√ó[31m should reject token with XSS attempt[39m[33m 959[2mms[22m[39m
[31m       [31m√ó[31m should reject token with missing userId[39m[33m 903[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject token with non-existent userId [33m 1397[2mms[22m[39m
[31m       [31m√ó[31m should not allow user to access another user's resources[39m[33m 2289[2mms[22m[39m
       [33m[2m‚úì[22m[39m should inject userId into request context [33m 1430[2mms[22m[39m
       [33m[2m‚úì[22m[39m should inject tenantId into request context [33m 1423[2mms[22m[39m
[31m       [31m√ó[31m should inject role into request context[39m[33m 911[2mms[22m[39m
[31m       [31m√ó[31m should not apply general rate limiting to authenticated requests[39m[33m 876[2mms[22m[39m
[31m       [31m√ó[31m should handle request with both Bearer token and cookies[39m[33m 1473[2mms[22m[39m
[31m       [31m√ó[31m should prioritize Bearer token over cookie when both present[39m[33m 1425[2mms[22m[39m
[31m       [31m√ó[31m should allow unauthenticated access to optional auth routes[39m[33m 1516[2mms[22m[39m
[31m       [31m√ó[31m should enhance optional auth routes with user context when authenticated[39m[33m 1631[2mms[22m[39m
 [31m‚ùØ[39m tests/integration/datavault.autonumber.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 7800[2mms[22m[39m
     [33m[2m‚úì[22m[39m should generate basic autonumber without prefix [33m 1201[2mms[22m[39m
[31m     [31m√ó[31m should generate autonumber with prefix[39m[33m 892[2mms[22m[39m
[31m     [31m√ó[31m should generate autonumber with yearly reset format[39m[33m 584[2mms[22m[39m
[31m     [31m√ó[31m should be atomic and prevent race conditions[39m[33m 515[2mms[22m[39m
     [33m[2m‚úì[22m[39m should prevent manual updates to autonumber values [33m 1504[2mms[22m[39m
{"level":30,"time":1767800742066,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"mode":"create","tableId":"592a9113-2d00-419b-9e70-2477a8a5288d","dataSourceId":"176b6c5e-70c3-4322-bc9e-ce0277f40b39","columnMappings":[{"value":"{{24ee32fc-845e-41dd-a514-c7c57d34a369}}","columnId":"0c2c1aa0-2464-4cbb-93ef-6aa38e0b329e"}]},"tableId":"592a9113-2d00-419b-9e70-2477a8a5288d","preview":false,"msg":"Starting write execution"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767800742247,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767800742313,"env":"test","module":"user-credentials-repository","userId":"L8tkkxcvxWyZM0SFXEdyD","msg":"User credentials created"}
{"level":30,"time":1767800742363,"env":"test","workflowId":"e16f3937-8bef-4090-a859-4ffe9dc1eb2b","userId":"dea12263-d618-44dd-bc6f-c674f27b7b87","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

{"level":30,"time":1767800742421,"env":"test","module":"email-queue","jobId":"c7d696aa-bbe0-4775-bf1b-fc03df7b4ecf","to":"middleware-test-_JO09Y304WJt01gpNPhFN@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767800742476,"env":"test","module":"auth-routes","userId":"L8tkkxcvxWyZM0SFXEdyD","email":"middleware-test-_JO09Y304WJt01gpNPhFN@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/collections.e2e.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 4474[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create multiple records [33m 420[2mms[22m[39m
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

{"level":30,"time":1767800743025,"env":"test","module":"auth-routes","userId":"L8tkkxcvxWyZM0SFXEdyD","msg":"User logged in successfully"}
{"level":30,"time":1767800743078,"env":"test","module":"audit-log-service","userId":"L8tkkxcvxWyZM0SFXEdyD","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800743085,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767800743129,"env":"test","workflowId":"c34cf9e4-4a3a-432b-8c81-ab47644d8d72","msg":"No current or pinned version found for workflow, run might be unstable"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/server/ownershipAccess.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 5260[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow member of multiple orgs to access all their org assets [33m 339[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800743488,"env":"test","module":"user-credentials-repository","userId":"Pnef82HlOJMNp_w6qUgWw","msg":"User credentials created"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767800743592,"env":"test","module":"email-queue","jobId":"349f6ac9-86fa-4b41-be53-8728e49c9bd3","to":"middleware-test-GFAfEBYe9Pyip5whO8iKQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767800743643,"env":"test","module":"auth-routes","userId":"Pnef82HlOJMNp_w6qUgWw","email":"middleware-test-GFAfEBYe9Pyip5whO8iKQ@example.com","msg":"User registered"}
[90mstderr[2m | tests/integration/externalSends.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1767800743812,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/integration/variableSafety.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800744182,"env":"test","module":"auth-routes","userId":"Pnef82HlOJMNp_w6qUgWw","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767800744230,"env":"test","module":"audit-log-service","userId":"Pnef82HlOJMNp_w6qUgWw","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767800744236,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstderr[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/auth.middleware.integration.test.ts:41:9 {
  length: [33m361[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(F-gE9yPcB1UT1DxgLNT-l) is still referenced from table "workflow_versions".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'workflow_versions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'workflow_versions_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800744327,"env":"test","workflowId":"c34cf9e4-4a3a-432b-8c81-ab47644d8d72","queryId":"e4eda0f9-8428-42e8-9e78-51c138e4773c","outputVar":"my_results","msg":"Executing query block"}
[90mstderr[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":40,"time":1767800744547,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
 [31m‚ùØ[39m tests/integration/auth/auth.middleware.integration.test.ts [2m([22m[2m35 tests[22m[2m | [22m[31m29 failed[39m[2m)[22m[33m 41372[2mms[22m[39m
[31m       [31m√ó[31m should allow access with valid JWT Bearer token[39m[33m 872[2mms[22m[39m
[31m       [31m√ó[31m should return 401 when no token provided[39m[33m 1136[2mms[22m[39m
[31m       [31m√ó[31m should return 401 with invalid token[39m[33m 851[2mms[22m[39m
[31m       [31m√ó[31m should return 401 with expired token[39m[33m 843[2mms[22m[39m
[31m       [31m√ó[31m should extract token without Bearer prefix[39m[33m 856[2mms[22m[39m
[31m       [31m√ó[31m should proceed without authentication if no token provided[39m[33m 855[2mms[22m[39m
[31m       [31m√ó[31m should attach user context if valid token provided[39m[33m 1675[2mms[22m[39m
[31m       [31m√ó[31m should proceed without auth if invalid token provided[39m[33m 1518[2mms[22m[39m
[31m       [31m√ó[31m should authenticate with JWT Bearer token[39m[33m 917[2mms[22m[39m
[31m       [31m√ó[31m should authenticate with refresh token cookie (GET only)[39m[33m 890[2mms[22m[39m
[31m       [31m√ó[31m should reject cookie auth for POST requests (mutation-strict)[39m[33m 863[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject cookie auth for PUT requests [33m 1140[2mms[22m[39m
[31m       [31m√ó[31m should reject cookie auth for DELETE requests[39m[33m 859[2mms[22m[39m
[31m       [31m√ó[31m should allow cookie auth for HEAD requests[39m[33m 895[2mms[22m[39m
[31m       [31m√ó[31m should prioritize JWT over cookie when both present[39m[33m 848[2mms[22m[39m
[31m       [31m√ó[31m should return 401 when no auth provided[39m[33m 876[2mms[22m[39m
[31m       [31m√ó[31m should return 401 when both JWT and cookie are invalid[39m[33m 874[2mms[22m[39m
[31m       [31m√ó[31m should authenticate with JWT if provided[39m[33m 1649[2mms[22m[39m
[31m       [31m√ó[31m should authenticate with cookie if JWT not provided[39m[33m 1673[2mms[22m[39m
[31m       [31m√ó[31m should proceed anonymously if no auth provided[39m[33m 1579[2mms[22m[39m
[31m       [31m√ó[31m should proceed anonymously if both JWT and cookie are invalid[39m[33m 1584[2mms[22m[39m
       [33m[2m‚úì[22m[39m should only allow safe methods for cookie auth [33m 1459[2mms[22m[39m
[31m       [31m√ó[31m should ignore cookies when Bearer token present[39m[33m 934[2mms[22m[39m
[31m       [31m√ó[31m should validate refresh token from cookie[39m[33m 973[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject expired refresh token from cookie [33m 1294[2mms[22m[39m
       [33m[2m‚úì[22m[39m should attach userId to request [33m 1348[2mms[22m[39m
[31m       [31m√ó[31m should attach userEmail to request[39m[33m 903[2mms[22m[39m
[31m       [31m√ó[31m should attach tenantId to request[39m[33m 895[2mms[22m[39m
[31m       [31m√ó[31m should attach userRole to request[39m[33m 884[2mms[22m[39m
       [33m[2m‚úì[22m[39m should lookup tenantId from database if missing from token [33m 1253[2mms[22m[39m
[31m       [31m√ó[31m should return consistent error format for missing token[39m[33m 859[2mms[22m[39m
[31m       [31m√ó[31m should return consistent error format for invalid token[39m[33m 1125[2mms[22m[39m
[31m       [31m√ó[31m should return consistent error format for expired token[39m[33m 2220[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle malformed JWT gracefully [33m 1166[2mms[22m[39m
[31m       [31m√ó[31m should handle JWT with wrong algorithm[39m[33m 1150[2mms[22m[39m
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/server/organizationService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 8403[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create organization and auto-create admin membership [33m 440[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return all organizations for user [33m 437[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow admin to update organization [33m 479[2mms[22m[39m
       [33m[2m‚úì[22m[39m should deny non-admin from updating organization [33m 483[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return all members of organization [33m 622[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow admin to promote member [33m 800[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow admin to demote other admin [33m 777[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent self-demotion [33m 435[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow admin to remove member [33m 796[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent self-removal [33m 429[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow member to leave organization [33m 830[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow admin to leave organization [33m 867[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

 [32m‚úì[39m tests/unit/engine/templateNode.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 11965[2mms[22m[39m
       [33m[2m‚úì[22m[39m should resolve template by key from workflowTemplates mapping [33m 748[2mms[22m[39m
       [33m[2m‚úì[22m[39m should throw error if template key not found [33m 601[2mms[22m[39m
       [33m[2m‚úì[22m[39m should store output in runOutputs table [33m 770[2mms[22m[39m
       [33m[2m‚úì[22m[39m should resolve template by templateId directly [33m 620[2mms[22m[39m
       [33m[2m‚úì[22m[39m should throw error if templateId not found [33m 599[2mms[22m[39m
       [33m[2m‚úì[22m[39m should use docxRenderer2 by default (v2 engine) [33m 660[2mms[22m[39m
       [33m[2m‚úì[22m[39m should use legacy engine when engine="legacy" [33m 609[2mms[22m[39m
       [33m[2m‚úì[22m[39m should generate PDF when toPdf=true [33m 790[2mms[22m[39m
       [33m[2m‚úì[22m[39m should default to DOCX when toPdf=false [33m 777[2mms[22m[39m
       [33m[2m‚úì[22m[39m should skip execution when condition evaluates to false [33m 585[2mms[22m[39m
       [33m[2m‚úì[22m[39m should execute when condition evaluates to true [33m 605[2mms[22m[39m
       [33m[2m‚úì[22m[39m should resolve simple bindings [33m 639[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle binding resolution errors gracefully [33m 551[2mms[22m[39m
       [33m[2m‚úì[22m[39m should record failed output in runOutputs table [33m 743[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not throw errors (should return error in result) [33m 625[2mms[22m[39m
       [33m[2m‚úì[22m[39m should deny access to templates from different tenant [33m 612[2mms[22m[39m
       [33m[2m‚úì[22m[39m should require either templateKey or templateId [33m 566[2mms[22m[39m
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":40,"time":1767800744886,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
 [32m‚úì[39m tests/unit/services/PdfQueueService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 12668[2mms[22m[39m
       [33m[2m‚úì[22m[39m should enqueue a PDF conversion job [33m 720[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create output with empty storagePath initially [33m 706[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return job status for pending job [33m 743[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return null for non-existent job [33m 674[2mms[22m[39m
       [33m[2m‚úì[22m[39m should parse attempt count from error field [33m 708[2mms[22m[39m
       [33m[2m‚úì[22m[39m should convert DOCX to PDF immediately [33m 808[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle conversion errors gracefully [33m 704[2mms[22m[39m
       [33m[2m‚úì[22m[39m should start and stop service [33m 752[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not start if already running [33m 605[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle stop when not running [33m 632[2mms[22m[39m
       [33m[2m‚úì[22m[39m should process pending jobs when queue is processed [33m 1022[2mms[22m[39m
       [33m[2m‚úì[22m[39m should process multiple jobs in batch [33m 1315[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle missing DOCX output gracefully [33m 828[2mms[22m[39m
       [33m[2m‚úì[22m[39m should support enqueue within transaction [33m 855[2mms[22m[39m
       [33m[2m‚úì[22m[39m should support convertImmediate within transaction [33m 767[2mms[22m[39m
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/dataBlocks.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 5958[2mms[22m[39m
     [33m[2m‚úì[22m[39m should write data to DataVault via WriteBlock [33m 2548[2mms[22m[39m
     [33m[2m‚úì[22m[39m should query data from DataVault via QueryBlock and use in Logic [33m 1950[2mms[22m[39m
 [32m‚úì[39m tests/integration/organizations-workflow.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 8440[2mms[22m[39m
       [33m[2m‚úì[22m[39m Step 2: Invite member via email [33m 477[2mms[22m[39m
       [33m[2m‚úì[22m[39m Step 3: Accept invite [33m 542[2mms[22m[39m
       [33m[2m‚úì[22m[39m Step 4: Create workflow owned by user [33m 500[2mms[22m[39m
       [33m[2m‚úì[22m[39m Step 5: Transfer workflow to organization [33m 328[2mms[22m[39m
       [33m[2m‚úì[22m[39m Step 6: Org member (user2) can access workflow [33m 443[2mms[22m[39m
       [33m[2m‚úì[22m[39m Step 16: Re-add member and verify access restored [33m 420[2mms[22m[39m
       [33m[2m‚úì[22m[39m Cannot invite same email twice (pending invite exists) [33m 754[2mms[22m[39m
       [33m[2m‚úì[22m[39m Cannot accept expired invite [33m 650[2mms[22m[39m
       [33m[2m‚úì[22m[39m Cannot transfer workflow to org user is not a member of [33m 543[2mms[22m[39m
{"level":40,"time":1767800745048,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstderr[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800745267,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":50,"time":1767800745525,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":40,"time":1767800745526,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":50,"time":1767800745526,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google authentication failed"}
{"level":40,"time":1767800745590,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1767800745591,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google token verification failed"}
{"level":50,"time":1767800745591,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google authentication failed"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstderr[2m | tests/integration/intake.workflow.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800745874,"env":"test","msg":"Simulating External Send","destination":"Test Webhook","payload":{"message":"Hello Preview"}}
{"level":30,"time":1767800745995,"env":"test","connectionId":"c59d1d1b-38c5-420e-80a3-1f3dc3264969","projectId":"f97fd3f0-f0fd-4ffe-be01-2c36e852c864","name":"Test OAuth2 Connection","type":"oauth2_3leg","msg":"Connection created:"}
{"level":30,"time":1767800746039,"env":"test","module":"auth","email":"existing@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1767800746128,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767800746149,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts[2m > [22m[2mIntake Workflow Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800746138,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800746138,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800746143,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800746148,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800746148,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800746149,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800746149,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767800746245,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 14683[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create a workflow template mapping [33m 670[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create non-primary mapping by default [33m 647[2mms[22m[39m
       [33m[2m‚úì[22m[39m should find all templates for a workflow version [33m 764[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return empty array for version with no templates [33m 637[2mms[22m[39m
       [33m[2m‚úì[22m[39m should order by createdAt desc (newest first) [33m 762[2mms[22m[39m
       [33m[2m‚úì[22m[39m should find mapping by workflow version and key [33m 686[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return undefined for non-existent key [33m 660[2mms[22m[39m
       [33m[2m‚úì[22m[39m should find primary template for workflow version [33m 745[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return undefined when no primary template exists [33m 706[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set a template as primary and unset others [33m 895[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle setting primary when none existed before [33m 903[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not delete mapping if workflow version does not match [33m 882[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return true if key exists in workflow version [33m 704[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return false if key does not exist [33m 632[2mms[22m[39m
       [33m[2m‚úì[22m[39m should exclude specified id when checking existence [33m 715[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return true if key exists on different mapping [33m 756[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update mapping fields [33m 733[2mms[22m[39m
       [33m[2m‚úì[22m[39m should find mapping by id [33m 692[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return undefined for non-existent id [33m 645[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

{"level":30,"time":1767800746503,"env":"test","module":"auth","email":"refresh@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767800746703,"env":"test","module":"user-credentials-repository","userId":"WT_PMQTvJaftou_sIOWzJ","msg":"User credentials created"}
{"level":30,"time":1767800746814,"env":"test","module":"email-queue","jobId":"5f1da3a1-2a4d-41c0-865b-cfd9d7a189bb","to":"test-J9y4PGQZtUa3mf43k5lxx@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767800746874,"env":"test","module":"auth-routes","userId":"WT_PMQTvJaftou_sIOWzJ","email":"test-J9y4PGQZtUa3mf43k5lxx@example.com","msg":"User registered"}
{"level":30,"time":1767800746945,"env":"test","module":"auth","email":"idtoken@example.com","msg":"OAuth2 login successful"}
[90mstderr[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

[90mstderr[2m | tests/unit/docxRenderer.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/variableSafety.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 3619[2mms[22m[39m
     [33m[2m‚úì[22m[39m REPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided [33m 651[2mms[22m[39m
     [33m[2m‚úì[22m[39m ScriptEngine resolves alias 'input_variable' when aliasMap is provided [33m 641[2mms[22m[39m
     [33m[2m‚úì[22m[39m REPRO: BlockRunner fails to resolve alias in CreateRecordConfig [33m 640[2mms[22m[39m
     [33m[2m‚úì[22m[39m BlockRunner logic resolves alias with aliasMap [33m 636[2mms[22m[39m
{"level":30,"time":1767800747198,"env":"test","msg":"External Send Completed","destination":"Test Webhook","success":true,"status":200}
{"level":30,"time":1767800747203,"env":"test","connectionId":"654af9b1-516b-44af-9e3d-7a9c036c5c9d","projectId":"f97fd3f0-f0fd-4ffe-be01-2c36e852c864","name":"Status Test Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800747311,"env":"test","status":401,"statusText":"Unauthorized","error":"Invalid client credentials","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1767800747312,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747315,"env":"test","data":{"token_type":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1767800747315,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747316,"env":"test","data":{"access_token":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1767800747316,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747317,"env":"test","error":"Network error: ECONNREFUSED","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
 [32m‚úì[39m tests/integration/externalSends.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 4050[2mms[22m[39m
     [33m[2m‚úì[22m[39m PREVIEW MODE: Should simulate send and NOT call fetch [33m 1444[2mms[22m[39m
     [33m[2m‚úì[22m[39m LIVE MODE: Should call fetch with mapped payload [33m 1324[2mms[22m[39m
{"level":30,"time":1767800747396,"env":"test","module":"auth","email":"minimal@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1767800747425,"env":"test","error":"Invalid credentials","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800747426,"env":"test","error":"ECONNREFUSED","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747428,"env":"test","status":400,"statusText":"Bad Request","error":"Invalid grant_type","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1767800747428,"env":"test","error":"OAuth2 token request failed: 400 Bad Request","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747429,"env":"test","status":401,"statusText":"Unauthorized","error":"Client authentication failed","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1767800747429,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747429,"env":"test","status":403,"statusText":"Forbidden","error":"Access denied","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1767800747429,"env":"test","error":"OAuth2 token request failed: 403 Forbidden","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747430,"env":"test","status":500,"statusText":"Internal Server Error","error":"Server error","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1767800747430,"env":"test","error":"OAuth2 token request failed: 500 Internal Server Error","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747431,"env":"test","error":"Unexpected token in JSON","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767800747431,"env":"test","error":"Request timeout","tokenUrl":"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢","msg":"OAuth2 token fetch error"}
 [32m‚úì[39m tests/integration/auth/oauth2.client-credentials.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1701[2mms[22m[39m
{"level":50,"time":1767800747511,"env":"test","module":"auth","err":{"type":"Error","message":"Token verification failed","stack":"Error: Token verification failed\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:425:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":40,"time":1767800747565,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1767800747565,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
{"level":40,"time":1767800747601,"env":"test","error":{},"msg":"libreoffice-convert not available, trying system LibreOffice"}
{"level":50,"time":1767800747620,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token payload","stack":"Error: Invalid token payload\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:85:25)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
{"level":40,"time":1767800747652,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"libreoffice --headless --convert-to pdf --outdir \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\" \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\\simple-template-1767800747574.docx\"","stdout":"","stderr":"'libreoffice' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"System LibreOffice conversion failed"}
{"level":40,"time":1767800747653,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF conversion failed"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/docxRenderer.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1877[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

 [32m‚úì[39m tests/integration/auth/oauth2.google.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 3840[2mms[22m[39m
       [33m[2m‚úì[22m[39m should successfully authenticate with valid Google ID token [33m 623[2mms[22m[39m
       [33m[2m‚úì[22m[39m should update existing user on subsequent logins [33m 501[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create refresh token record in database [33m 465[2mms[22m[39m
       [33m[2m‚úì[22m[39m should support both "token" and "idToken" fields [33m 389[2mms[22m[39m
       [33m[2m‚úì[22m[39m should handle missing profile information gracefully [33m 395[2mms[22m[39m
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39müß™ Setting up test environment...

 [32m‚úì[39m tests/integration/auth/oauth2.callback.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 3292[2mms[22m[39m
       [33m[2m‚úì[22m[39m should initiate OAuth2 3-legged flow and generate authorization URL [33m 362[2mms[22m[39m
       [33m[2m‚úì[22m[39m should track OAuth2 connection status [33m 401[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767800748165,"env":"test","workflowId":"d7ede8a1-47ea-4009-aa6c-517b9c4e1914","userId":"WT_PMQTvJaftou_sIOWzJ","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

 [32m‚úì[39m tests/unit/services/WorkflowTemplateService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 16988[2mms[22m[39m
       [33m[2m‚úì[22m[39m should throw error if template belongs to different project [33m 612[2mms[22m[39m
       [33m[2m‚úì[22m[39m should automatically unset other primaries when setting new primary [33m 1098[2mms[22m[39m
         [33m[2m‚úì[22m[39m should list all templates for workflow version [33m 803[2mms[22m[39m
         [33m[2m‚úì[22m[39m should return empty array for version with no templates [33m 544[2mms[22m[39m
         [33m[2m‚úì[22m[39m should get template mapping by id and version [33m 724[2mms[22m[39m
         [33m[2m‚úì[22m[39m should throw error if mapping not found [33m 553[2mms[22m[39m
         [33m[2m‚úì[22m[39m should get template by key [33m 743[2mms[22m[39m
         [33m[2m‚úì[22m[39m should throw error if key not found [33m 543[2mms[22m[39m
         [33m[2m‚úì[22m[39m should get primary template for workflow version [33m 822[2mms[22m[39m
         [33m[2m‚úì[22m[39m should return null when no primary template exists [33m 660[2mms[22m[39m
         [33m[2m‚úì[22m[39m should update mapping key [33m 789[2mms[22m[39m
         [33m[2m‚úì[22m[39m should update isPrimary flag [33m 809[2mms[22m[39m
         [33m[2m‚úì[22m[39m should throw error if new key already exists [33m 879[2mms[22m[39m
         [33m[2m‚úì[22m[39m should throw error if mapping not found [33m 554[2mms[22m[39m
         [33m[2m‚úì[22m[39m should unset other primaries when setting isPrimary to true [33m 1107[2mms[22m[39m
         [33m[2m‚úì[22m[39m should detach template from workflow version [33m 787[2mms[22m[39m
         [33m[2m‚úì[22m[39m should throw error if mapping not found [33m 549[2mms[22m[39m
         [33m[2m‚úì[22m[39m should set template as primary [33m 1064[2mms[22m[39m
         [33m[2m‚úì[22m[39m should throw error if mapping not found [33m 551[2mms[22m[39m
         [33m[2m‚úì[22m[39m should support operations within a transaction [33m 817[2mms[22m[39m
         [33m[2m‚úì[22m[39m should rollback on transaction error [33m 1116[2mms[22m[39m
[90mstderr[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/collab.client.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39müß™ Setting up test environment...

 [32m‚úì[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 2075[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/engine.expr.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22m[2mTableGridView - Drag & Drop[2m > [22m[2mrenders DndContext wrapper
[22m[39mWarning: validateDOMNesting(...): <th> cannot appear as a child of <div>.
    at th
    at SortableColumnHeader (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/SortableColumnHeader.tsx:12:33)
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
Warning: validateDOMNesting(...): <div> cannot appear as a child of <tr>.
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/integration/intake.workflow.test.ts[2m > [22m[2mIntake Workflow Integration Tests
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/intake.workflow.test.ts:20:9 {
  length: [33m361[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(WT_PMQTvJaftou_sIOWzJ) is still referenced from table "workflow_versions".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'workflow_versions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'workflow_versions_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/engine.expr.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 1802[2mms[22m[39m
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

{"level":30,"time":1767800749914,"env":"test","blockId":"64e5fd8a-0160-4e00-b7d0-3a56453d3b32","virtualStepId":"54393740-581f-4da2-83cc-91861351c367","outputVar":"userList","msg":"Created read table block with virtual step"}
[90mstderr[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

 [32m‚úì[39m tests/integration/intake.workflow.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 4384[2mms[22m[39m
     [33m[2m‚úì[22m[39m should allow designating a workflow as Intake [33m 1151[2mms[22m[39m
     [33m[2m‚úì[22m[39m should allow linking a downstream workflow to an intake workflow [33m 1421[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/integration/api.ai.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [32m‚úì[39m tests/unit/services/docxRenderer2.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 1694[2mms[22m[39m
 [32m‚úì[39m tests/unit/components/datavault/CellRenderer.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 2837[2mms[22m[39m
     [33m[2m‚úì[22m[39m renders boolean value as Yes/No [33m 417[2mms[22m[39m
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/services/TemplateAnalysisService.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 1755[2mms[22m[39m
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/unit/shared/conditionEvaluator.test.ts[2m > [22m[2mconditionEvaluator[2m > [22m[2mComparison operators[2m > [22m[2mUnknown operator[2m > [22m[2mshould default to true and log warning
[22m[39mUnknown operator: unknown_operator

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/dynamic_options_workflow.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 2137[2mms[22m[39m
     [33m[2m‚úì[22m[39m should successfully configure a workflow with Read Table -> Dynamic Choice [33m 437[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/shared/conditionEvaluator.test.ts [2m([22m[2m70 tests[22m[2m)[22m[33m 1754[2mms[22m[39m
[90mstderr[2m | tests/unit/captcha.service.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [32m‚úì[39m tests/integration/api.ai.test.ts [2m([22m[2m32 tests[22m[2m)[22m[33m 1774[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 3250[2mms[22m[39m
     [33m[2m‚úì[22m[39m displays columns in order based on orderIndex [33m 551[2mms[22m[39m
     [33m[2m‚úì[22m[39m maintains column order after successful reorder [33m 343[2mms[22m[39m
 [32m‚úì[39m tests/unit/captcha.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 1794[2mms[22m[39m
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

 [32m‚úì[39m tests/unit/collab.client.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[33m 3810[2mms[22m[39m
     [33m[2m‚úì[22m[39m should add a comment [33m 669[2mms[22m[39m
     [33m[2m‚úì[22m[39m should allow comment owner to delete their comment [33m 416[2mms[22m[39m
[90mstderr[2m | tests/unit/utils/encryption.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/api.expression-validation.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

 [32m‚úì[39m tests/unit/server/organizationInvites.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 19876[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create placeholder user for non-existent email [33m 1043[2mms[22m[39m
       [33m[2m‚úì[22m[39m should create invite for existing user without creating placeholder [33m 958[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent duplicate pending invites [33m 1243[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent inviting existing members [33m 868[2mms[22m[39m
       [33m[2m‚úì[22m[39m should require admin access to create invite [33m 544[2mms[22m[39m
       [33m[2m‚úì[22m[39m should set expiry to 7 days from now [33m 1017[2mms[22m[39m
       [33m[2m‚úì[22m[39m should accept invite and create membership [33m 1483[2mms[22m[39m
       [33m[2m‚úì[22m[39m should convert placeholder user to real user on accept [33m 1560[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject expired invite [33m 1105[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject already accepted invite [33m 1412[2mms[22m[39m
       [33m[2m‚úì[22m[39m should verify email matches invite [33m 1012[2mms[22m[39m
       [33m[2m‚úì[22m[39m should reject invalid token [33m 529[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return pending invites for user email [33m 1025[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not return expired invites [33m 1072[2mms[22m[39m
       [33m[2m‚úì[22m[39m should not return accepted invites [33m 1747[2mms[22m[39m
       [33m[2m‚úì[22m[39m should allow admin to revoke invite [33m 1190[2mms[22m[39m
       [33m[2m‚úì[22m[39m should prevent accepting revoked invite [33m 1206[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

{"level":30,"time":1767800751606,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800751634,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts[2m > [22m[2mExpression Validation API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800751617,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800751618,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800751626,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767800751633,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767800751633,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767800751633,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767800751634,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
 [32m‚úì[39m tests/unit/utils/encryption.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1959[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstderr[2m | tests/integration/session.management.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/session.management.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 1995[2mms[22m[39m
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":30,"time":1767800752255,"env":"test","module":"user-credentials-repository","userId":"8G5iytAv6FC-mTUfKUAfo","msg":"User credentials created"}
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39müß™ Setting up test environment...

{"level":30,"time":1767800752364,"env":"test","module":"email-queue","jobId":"b499ef66-8245-4cb0-bebc-d8107ff43f1e","to":"test-5_Qih1YUPLwJ0fQr5pc_K@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767800752422,"env":"test","module":"auth-routes","userId":"8G5iytAv6FC-mTUfKUAfo","email":"test-5_Qih1YUPLwJ0fQr5pc_K@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/middleware/rbac.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39müß™ Setting up test environment...

{"level":40,"time":1767800753012,"env":"test","module":"rbac-middleware","path":"/api/workflows","permission":"workflow:create","msg":"Unauthenticated user attempted to access protected resource"}
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":40,"time":1767800753017,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permission":"workflow:create","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1767800753020,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"permission":"workflow:view","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1767800753022,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permissions":["workflow:create","workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (none of required permissions)"}
{"level":40,"time":1767800753024,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","permissions":["workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (missing some required permissions)"}
{"level":40,"time":1767800753026,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1767800753027,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"requiredRoles":["owner"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1767800753028,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","requiredRoles":["owner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767800753029,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"runner","requiredRoles":["owner","builder"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767800753032,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder","runner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767800753038,"env":"test","module":"rbac-middleware","path":"/api/test","permission":"workflow:view","msg":"Unauthenticated user attempted to access protected resource"}
{"level":40,"time":1767800753039,"env":"test","module":"rbac-middleware","userId":"user-123","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":40,"time":1767800753040,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"invalid-role","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39müß™ Setting up test environment...

 [32m‚úì[39m tests/unit/middleware/rbac.test.ts [2m([22m[2m44 tests[22m[2m)[22m[33m 2398[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstderr[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/integration/mfa.flow.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800753463,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32m‚úì[39m tests/unit/WorkflowChangeAnalyzer.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 2320[2mms[22m[39m
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39müß™ Setting up test environment...

 [32m‚úì[39m tests/unit/shared/validation/PageValidator.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2241[2mms[22m[39m
[90mstderr[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [32m‚úì[39m tests/integration/mfa.flow.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 2078[2mms[22m[39m
{"level":50,"time":1767800753658,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

 [32m‚úì[39m tests/unit/services/docxHelpers.test.ts [2m([22m[2m39 tests[22m[2m)[22m[33m 2224[2mms[22m[39m
{"level":50,"time":1767800753835,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/integration/api.expression-validation.test.ts[2m > [22m[2mExpression Validation API Integration Tests
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.expression-validation.test.ts:75:5 {
  length: [33m361[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(8G5iytAv6FC-mTUfKUAfo) is still referenced from table "workflow_versions".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'workflow_versions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'workflow_versions_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2027[2mms[22m[39m
 [32m‚úì[39m tests/unit/utils/conditionalLogic-simple.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2217[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstderr[2m | tests/unit/ScriptEngine.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [32m‚úì[39m tests/unit/shared/validation/stepConfigSchemas.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2207[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/utils/conditionalLogic.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 2154[2mms[22m[39m
[90mstderr[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/auth.routes.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

 [32m‚úì[39m tests/unit/ScriptEngine.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 2189[2mms[22m[39m
 [32m‚úì[39m tests/integration/api.expression-validation.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 3117[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/auth.routes.test.ts [2m([22m[2m41 tests[22m[2m)[22m[33m 1940[2mms[22m[39m
 [32m‚úì[39m tests/unit/workflows/conditionTruthTable.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 1950[2mms[22m[39m
[90mstderr[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstderr[2m | tests/unit/utils/pagination.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

 [32m‚úì[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 1918[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/utils/pagination.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 1930[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }

[90mstderr[2m | tests/unit/workflows/validation.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39müß™ Setting up test environment...

 [32m‚úì[39m tests/unit/workflows/validation.test.ts [2m([22m[2m66 tests[22m[2m)[22m[33m 2050[2mms[22m[39m
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/shared/workflowLogic.test.ts[2m > [22m[2mworkflowLogic[2m > [22m[2mevaluateRules[2m > [22m[2mOperators[2m > [22m[2mUnknown operator[2m > [22m[2mshould return false and log warning for unknown operator
[22m[39mUnknown operator: unknown_operator

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/shared/workflowLogic.test.ts [2m([22m[2m65 tests[22m[2m)[22m[33m 2063[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39müß™ Setting up test environment...

 [32m‚úì[39m tests/unit/workflow/QueryBlock.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2023[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [32m‚úì[39m tests/unit/shared/validation/Validator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 2157[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/services/repeater.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/ui/builder.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/WorkflowOptimizationService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 2011[2mms[22m[39m
 [32m‚úì[39m tests/unit/services/RunExecutionCoordinator.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 2019[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/client/list-choice-options.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1963[2mms[22m[39m
 [32m‚úì[39m tests/unit/services/repeater.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1961[2mms[22m[39m
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/ui/builder.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 2236[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstderr[2m | tests/integration/intake.portal.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/services/MfaService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstderr[2m | tests/unit/engine/Performance.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/intake.portal.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1944[2mms[22m[39m
[90mstderr[2m | tests/unit/HelperLibrary.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [32m‚úì[39m tests/integration/conditions/conditionEvaluation.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1954[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/engine/Performance.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2026[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/HelperLibrary.test.ts [2m([22m[2m60 tests[22m[2m)[22m[33m 1928[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstderr[2m | tests/integration/analytics_preservation.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767800758707,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/services/WorkflowService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1354[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return workflow if user is the creator [33m 1238[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/analytics_preservation.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1405[2mms[22m[39m
     [33m[2m‚úì[22m[39m should preserve lifetime user count when a user is deleted [33m 525[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/services/MfaService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 1723[2mms[22m[39m
         [33m[2m‚úì[22m[39m should try multiple codes if first doesn't match [33m 377[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":40,"time":1767800759584,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1048[2mms[22m[39m
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts[2m > [22m[2mDatavaultColumnsService[2m > [22m[2mgetColumns[2m > [22m[2mshould throw 404 if table not found
[22m[39m[DEBUG] Table not found: 660e8400-e29b-41d4-a716-446655440001

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

 [32m‚úì[39m tests/unit/services/DatavaultColumnsService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1335[2mms[22m[39m
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstderr[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstderr[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

 [32m‚úì[39m tests/unit/services/DataSourceService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 1001[2mms[22m[39m
[90mstderr[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39müß™ Setting up test environment...

 [32m‚úì[39m tests/unit/schema/documentEngine.test.ts [2m([22m[2m33 tests[22m[2m)[22m[33m 1183[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

 [32m‚úì[39m tests/unit/repositories/DocumentTemplateRepository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1004[2mms[22m[39m
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/repositories/DatavaultTablesRepository.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1170[2mms[22m[39m
[90mstderr[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1345:74
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:111:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:73:9 {
  length: [33m320[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23505'[39m,
  detail: [32m'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'pg_catalog'[39m,
  table: [32m'pg_proc'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'pg_proc_proname_args_nsp_index'[39m,
  file: [32m'nbtinsert.c'[39m,
  line: [32m'667'[39m,
  routine: [32m'_bt_check_unique'[39m
}

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops

 [32m‚úì[39m tests/services/EmailTemplateMetadataService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 778[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstderr[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/lib/queries/QueryRunner.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 952[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

{"level":40,"time":1767800761298,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":50,"time":1767800761303,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1767800761307,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1767800761314,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1767800761317,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

 [32m‚úì[39m tests/unit/LifecycleHookService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 920[2mms[22m[39m
{"level":30,"time":1767800761456,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstderr[2m | tests/unit/services/CollectionService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

 [32m‚úì[39m tests/unit/services/CollectionFieldService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 848[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/services/CollectionService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 944[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":40,"time":1767800762432,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould skip question when condition is false
[22m[39m[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 3

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould execute question when condition is true
[22m[39m[DEBUG Question] Node q1 executed. Key: has_code, Value: true. Context keys: 4

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould execute question when condition is true
[22m[39m[DEBUG Question] Node q2 executed. Key: code, Value: ABC123. Context keys: 5

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould skip compute node when condition is false
[22m[39m[DEBUG Question] Node q1 executed. Key: amount, Value: 0. Context keys: 3

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould execute compute node when condition is true
[22m[39m[DEBUG Question] Node q1 executed. Key: amount, Value: 100. Context keys: 3

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould handle complex workflow with multiple conditions
[22m[39m[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 4

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould handle complex workflow with multiple conditions
[22m[39m[DEBUG Question] Node q3 executed. Key: amount, Value: 1000. Context keys: 5

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mDebug Mode[2m > [22m[2mshould return trace when debug is enabled
[22m[39m[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mDebug Mode[2m > [22m[2mshould not return trace when debug is disabled
[22m[39m[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [32m‚úì[39m tests/unit/engine.run-conditions.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1003[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }

[90mstderr[2m | tests/integration/branding.routes.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/services/BrandingService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [32m‚úì[39m tests/unit/services/DatavaultTablesService.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 880[2mms[22m[39m
 [32m‚úì[39m tests/unit/services/DocumentTemplateService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1035[2mms[22m[39m
[90mstderr[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

[90mstderr[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":40,"time":1767800763455,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
 [32m‚úì[39m tests/integration/branding.routes.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 835[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/services/BrandingService.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 863[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/services/PortalAuthService.test.ts [2m([22m[2m42 tests[22m[2m)[22m[32m 278[2mms[22m[39m
[90mstderr[2m | tests/unit/services/RecordService.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

 [32m‚úì[39m tests/unit/workflow/PreviewExecution.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 861[2mms[22m[39m
{"level":40,"time":1767800763790,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":40,"time":1767800764103,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767800764188,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
 [32m‚úì[39m tests/unit/services/RecordService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 921[2mms[22m[39m
[90mstderr[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstderr[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

 [32m‚úì[39m tests/unit/services/AccountLockoutService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 37[2mms[22m[39m
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

 [32m‚úì[39m tests/unit/services/EmailTemplateMetadataService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 52[2mms[22m[39m
[90mstderr[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

{"level":30,"time":1767800764607,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800764621,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

 [32m‚úì[39m tests/unit/external/ExternalSendRunner.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 30[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

 [32m‚úì[39m tests/integration/datavault.api-tokens.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 1092[2mms[22m[39m
[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üîë add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstderr[2m | tests/unit/services/BrandingService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/services/BrandingService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 38[2mms[22m[39m
[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops

[90mstderr[2m | tests/unit/services/Guardrail.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }

 [32m‚úì[39m tests/unit/services/Guardrail.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 20[2mms[22m[39m
[90mstderr[2m | tests/unit/debug_import.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/repositories/DatavaultRowsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 30[2mms[22m[39m
[90mstderr[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/debug_import.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 829[2mms[22m[39m
[90mstderr[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

 [32m‚úì[39m tests/unit/services/DatavaultReferenceColumns.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 31[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/services/DatavaultRowsService.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 32[2mms[22m[39m
[90mstderr[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/unit/services/AuditLogService.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39müß™ Setting up test environment...

[90mstderr[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstderr[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m‚ö†Ô∏è Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:51:35
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39müßπ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

 [32m‚úì[39m tests/unit/BlockRunner.validate.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32m‚úì[39m tests/unit/engine/FinalBlockSnapshot.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39müß™ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m‚úÖ Database initialized for tests
üîÑ Running test migrations...

{"level":40,"time":1767800766738,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
[90mstderr[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

 [2m[90m‚Üì[39m[22m tests/unit/collab.server.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m
[90mstderr[2m | tests/integration/datavault.routes.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstderr[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m‚ö†Ô∏è Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1182:6[90m)[39m
    at cn.handlePacket [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1143:13[90m)[39m
    at cn.parse [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1127:36[90m)[39m
    at v.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:1190:16[90m)[39m
    at v.emit [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:397:12[90m)[39m
    at WebSocket.<anonymous> [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@neondatabase/serverless[24m/index.mjs:987:80[90m)[39m
    at callListener [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:290:14[90m)[39m
    at WebSocket.onMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\event-target.js:209:9[90m)[39m
[90m    at WebSocket.emit (node:events:508:28)[39m
    at Receiver.receiverOnMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\websocket.js:1220:20[90m)[39m
[90m    at Receiver.emit (node:events:508:28)[39m
    at Receiver.dataMessage [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:569:14[90m)[39m
    at Receiver.getData [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:496:10[90m)[39m
    at Receiver.startLoop [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:167:16[90m)[39m
    at Receiver._write [90m(C:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mws[24m\lib\receiver.js:94:10[90m)[39m
[90m    at writeOrBuffer (node:internal/streams/writable:570:12)[39m {
  length: [33m93[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42710'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'typecmds.c'[39m,
  line: [32m'1177'[39m,
  routine: [32m'DefineEnum'[39m
}

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/datavault.row-notes.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 822[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39müßπ Cleaning up test environment...

{"level":30,"time":1767800767251,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts[2m > [22m[2mPersonalization API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767800767259,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767800767260,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767800767264,"env":"test","module":"documents-routes","msg":"Document routes registered"}
 [32m‚úì[39m tests/integration/datavault.routes.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 802[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39müßπ Cleaning up test environment...

 [32m‚úì[39m tests/integration/api.ai.personalization.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1238[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Suites 11 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/api.projects.test.ts:[2m61:8[22m[39m
    [90m 59| [39m        lastName[33m:[39m [32m"User"[39m[33m,[39m
    [90m 60| [39m      })
    [90m 61| [39m      [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 62| [39m
    [90m 63| [39m    authToken [33m=[39m registerResponse[33m.[39mbody[33m.[39mtoken[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.runs.docx.test.ts[2m > [22mRuns API - DOCX Generation Integration Tests
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/api.runs.docx.test.ts:[2m110:8[22m[39m
    [90m108| [39m      [33m.[39m[34mpost[39m([32m'/api/auth/register'[39m)
    [90m109| [39m      [33m.[39m[34msend[39m({ email[33m,[39m password[33m:[39m [32m'TestPassword123'[39m })
    [90m110| [39m      [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m111| [39m
    [90m112| [39m    authToken [33m=[39m registerResponse[33m.[39mbody[33m.[39mtoken[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests
[31m[1mTypeError[22m: actual.getSession is not a function[39m
[36m [2m‚ùØ[22m setupAuth tests/integration/api.runs.graph.test.ts:[2m35:24[22m[39m
    [90m 33| [39m      [33m...[39mactual[33m,[39m
    [90m 34| [39m      setupAuth[33m:[39m (app[33m:[39m [33mExpress[39m) [33m=>[39m {
    [90m 35| [39m        app[33m.[39m[34muse[39m(actual[33m.[39m[34mgetSession[39m())[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m 36| [39m
    [90m 37| [39m        // Debug middleware to log cookies and session AND restore req‚Ä¶
[90m [2m‚ùØ[22m Module.registerRoutes server/routes.ts:[2m19:9[22m[39m
[90m [2m‚ùØ[22m tests/integration/api.runs.graph.test.ts:[2m67:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.snapshots.test.ts[2m > [22mStage 13: Workflow Snapshots & Versioning
[31m[1mTypeError[22m: actual.getSession is not a function[39m
[36m [2m‚ùØ[22m setupAuth tests/integration/api.snapshots.test.ts:[2m28:32[22m[39m
    [90m 26| [39m            [33m...[39mactual[33m,[39m
    [90m 27| [39m            setupAuth[33m:[39m (app[33m:[39m [33mExpress[39m) [33m=>[39m {
    [90m 28| [39m                app[33m.[39m[34muse[39m(actual[33m.[39m[34mgetSession[39m())[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 29| [39m
    [90m 30| [39m                // Debug middleware to log cookies and session AND res‚Ä¶
[90m [2m‚ùØ[22m Module.registerRoutes server/routes.ts:[2m19:9[22m[39m
[90m [2m‚ùØ[22m tests/integration/api.snapshots.test.ts:[2m62:24[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/js_helpers.test.ts[2m > [22mDetailed Verification: JS Helper Availability
[31m[1mTypeError[22m: actual.getSession is not a function[39m
[36m [2m‚ùØ[22m setupAuth tests/integration/js_helpers.test.ts:[2m18:28[22m[39m
    [90m 16| [39m        [33m...[39mactual[33m,[39m
    [90m 17| [39m        setupAuth[33m:[39m (app[33m:[39m [33mExpress[39m) [33m=>[39m {
    [90m 18| [39m            app[33m.[39m[34muse[39m(actual[33m.[39m[34mgetSession[39m())[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m 19| [39m            app[33m.[39m[34muse[39m((req[33m,[39m res[33m,[39m next) [33m=>[39m {
    [90m 20| [39m                [35mconst[39m r [33m=[39m req [35mas[39m any[33m;[39m
[90m [2m‚ùØ[22m Module.registerRoutes server/routes.ts:[2m19:9[22m[39m
[90m [2m‚ùØ[22m tests/integration/js_helpers.test.ts:[2m54:15[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test
[31m[1merror[22m: invalid input syntax for type uuid: "test-tenant"[39m
[90m [2m‚ùØ[22m node_modules/@neondatabase/serverless/index.mjs:[2m1345:74[22m[39m
[90m [2m‚ùØ[22m NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:[2m76:20[22m[39m
[36m [2m‚ùØ[22m tests/integration/ai/workflowEdit.test.ts:[2m64:20[22m[39m
    [90m 62| [39m
    [90m 63| [39m    [90m// Create test user[39m
    [90m 64| [39m    [35mconst[39m [user] [33m=[39m [35mawait[39m db[33m.[39m[34minsert[39m(users)[33m.[39m[34mvalues[39m({
    [90m   | [39m                   [31m^[39m
    [90m 65| [39m      email[33m:[39m [32m'test@example.com'[39m[33m,[39m
    [90m 66| [39m      fullName[33m:[39m [32m'Test User'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management
[31m[1merror[22m: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"[39m
[90m [2m‚ùØ[22m node_modules/@neondatabase/serverless/index.mjs:[2m1345:74[22m[39m
[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m72:7[22m[39m
    [90m 70| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 71| [39m    [35mif[39m (testTenantId) {
    [90m 72| [39m      [35mawait[39m db[33m.[39m[35mdelete[39m(tenants)[33m.[39m[34mwhere[39m([34meq[39m(tenants[33m.[39mid[33m,[39m testTenantId))[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 73| [39m    }
    [90m 74| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/portal.authentication.test.ts[2m [ tests/integration/auth/portal.authentication.test.ts ][22m
[31m[1mError[22m: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/auth/portal.authentication.test.ts[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/workflows/runtime-pipelines.test.ts[2m > [22mRuntime Pipelines Integration Tests
[31m[1merror[22m: insert or update on table "projects" violates foreign key constraint "projects_creator_id_users_id_fk"[39m
[90m [2m‚ùØ[22m node_modules/@neondatabase/serverless/index.mjs:[2m1345:74[22m[39m
[90m [2m‚ùØ[22m NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:[2m76:20[22m[39m
[36m [2m‚ùØ[22m tests/integration/workflows/runtime-pipelines.test.ts:[2m69:23[22m[39m
    [90m 67| [39m
    [90m 68| [39m    [90m// Create test project[39m
    [90m 69| [39m    [35mconst[39m [project] [33m=[39m [35mawait[39m db
    [90m   | [39m                      [31m^[39m
    [90m 70| [39m      [33m.[39m[34minsert[39m(projects)
    [90m 71| [39m      [33m.[39m[34mvalues[39m({

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/workflows/runtime-pipelines.test.ts[2m > [22mRuntime Pipelines Integration Tests
[31m[1merror[22m: syntax error at end of input[39m
[90m [2m‚ùØ[22m node_modules/@neondatabase/serverless/index.mjs:[2m1345:74[22m[39m
[36m [2m‚ùØ[22m tests/integration/workflows/runtime-pipelines.test.ts:[2m212:5[22m[39m
    [90m210| [39m    [35mawait[39m db[33m.[39m[35mdelete[39m(datavaultValues)[33m.[39m[34mwhere[39m(sql[32m`1=1`[39m)[33m;[39m
    [90m211| [39m    [35mawait[39m db[33m.[39m[35mdelete[39m(datavaultRows)[33m.[39m[34mwhere[39m(sql[32m`1=1`[39m)[33m;[39m
    [90m212| [39m    await db.delete(datavaultColumns).where(sql`table_id = ${testTable‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m213| [39m    [35mawait[39m db[33m.[39m[35mdelete[39m(datavaultTables)[33m.[39m[34mwhere[39m(sql[32m`id = [39m[36m${[39mtestTableId[36m}[39m[32m`[39m)[33m;[39m
    [90m214| [39m    [35mawait[39m db[33m.[39m[35mdelete[39m(workflowRuns)[33m.[39m[34mwhere[39m(sql[32m`id = [39m[36m${[39mtestRunId[36m}[39m[32m`[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m [ tests/ui/datavault/EditableCell.test.tsx ][22m
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'navigator')[39m
[90m [2m‚ùØ[22m detachClipboardStubFromView node_modules/@testing-library/user-event/dist/esm/utils/dataTransfer/Clipboard.js:[2m120:32[22m[39m
[90m [2m‚ùØ[22m node_modules/@testing-library/user-event/dist/esm/utils/dataTransfer/Clipboard.js:[2m159:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowPatchService.test.ts[2m [ tests/unit/services/WorkflowPatchService.test.ts ][22m
[31m[1mTypeError[22m: () => ({
    createTable: __vite_ssr_import_0__.vi.fn(),
    requirePermission: __vite_ssr_import_0__.vi.fn()
  }) is not a constructor[39m
[36m [2m‚ùØ[22m new WorkflowPatchService server/services/WorkflowPatchService.ts:[2m27:36[22m[39m
    [90m 25| [39m[35mexport[39m [35mclass[39m [33mWorkflowPatchService[39m {
    [90m 26| [39m  [35mprivate[39m tempIdMap[33m:[39m [33mMap[39m[33m<[39mstring[33m,[39m string[33m>[39m [33m=[39m [35mnew[39m [33mMap[39m()[33m;[39m
    [90m 27| [39m  [35mprivate[39m datavaultTablesService [33m=[39m [35mnew[39m [33mDatavaultTablesService[39m()[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 28| [39m  [35mprivate[39m datavaultColumnsService [33m=[39m [35mnew[39m [33mDatavaultColumnsService[39m()[33m;[39m
    [90m 29| [39m
[90m [2m‚ùØ[22m server/services/WorkflowPatchService.ts:[2m773:37[22m[39m
[90m [2m‚ùØ[22m tests/unit/services/WorkflowPatchService.test.ts:[2m2:1[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/448]‚éØ[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 407 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mFilter Operations[2m > [22mshould filter rows by equals condition
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m85:30[22m[39m
    [90m 83| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m 84| [39m
    [90m 85| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 86| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39mfiltered_users[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m 87| [39m      expect(result.data?.filtered_users.rows.every((r: any) => r.city‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mFilter Operations[2m > [22mshould filter with greater_than operator
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m116:30[22m[39m
    [90m114| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m115| [39m
    [90m116| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m117| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39msenior_users[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m118| [39m      expect(result.data?.senior_users.rows.every((r: any) => r.age > ‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mFilter Operations[2m > [22mshould filter with AND combinator
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m148:30[22m[39m
    [90m146| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m147| [39m
    [90m148| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m149| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39mactive_nyc[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m150| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mFilter Operations[2m > [22mshould filter with OR combinator
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m179:30[22m[39m
    [90m177| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m178| [39m
    [90m179| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m180| [39m      expect(result.data?.young_or_sf.count).toBe(2); // Bob (25) and ‚Ä¶
    [90m181| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[16/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mSort Operations[2m > [22mshould sort by single key ascending
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m208:30[22m[39m
    [90m206| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m207| [39m
    [90m208| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m209| [39m      const ages = result.data?.sorted_users.rows.map((r: any) => r.ag‚Ä¶
    [90m210| [39m      [34mexpect[39m(ages)[33m.[39m[34mtoEqual[39m([[34m25[39m[33m,[39m [34m28[39m[33m,[39m [34m30[39m[33m,[39m [34m32[39m[33m,[39m [34m35[39m])[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[17/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mSort Operations[2m > [22mshould sort by single key descending
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m236:30[22m[39m
    [90m234| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m235| [39m
    [90m236| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m237| [39m      const names = result.data?.sorted_users.rows.map((r: any) => r.n‚Ä¶
    [90m238| [39m      expect(names).toEqual(['Eve', 'Diana', 'Charlie', 'Bob', 'Alice'‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[18/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mSort Operations[2m > [22mshould sort by multiple keys
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m265:30[22m[39m
    [90m263| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m264| [39m
    [90m265| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m266| [39m      [35mconst[39m rows [33m=[39m result[33m.[39mdata[33m?.[39msorted_users[33m.[39mrows[33m;[39m
    [90m267| [39m      [34mexpect[39m(rows[[34m0[39m][33m.[39mcity)[33m.[39m[34mtoBe[39m([32m'LA'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[19/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mRange Operations[2m > [22mshould apply limit
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m295:30[22m[39m
    [90m293| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m294| [39m
    [90m295| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m296| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39mlimited_users[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m297| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[20/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mRange Operations[2m > [22mshould apply offset
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m320:30[22m[39m
    [90m318| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m319| [39m
    [90m320| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m321| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39moffset_users[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m322| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39moffset_users[33m.[39mrows[[34m0[39m][33m.[39mname)[33m.[39m[34mtoBe[39m([32m'Charlie'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[21/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mRange Operations[2m > [22mshould apply offset and limit together
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m347:30[22m[39m
    [90m345| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m346| [39m
    [90m347| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m348| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39mpaged_users[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m349| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39mpaged_users[33m.[39mrows[[34m0[39m][33m.[39mname)[33m.[39m[34mtoBe[39m([32m'Bob'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mSelect Operations[2m > [22mshould select specific columns
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m376:30[22m[39m
    [90m374| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m375| [39m
    [90m376| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m377| [39m      [35mconst[39m row [33m=[39m result[33m.[39mdata[33m?.[39mname_age_only[33m.[39mrows[[34m0[39m][33m;[39m
    [90m378| [39m      [34mexpect[39m(row)[33m.[39m[34mtoHaveProperty[39m([32m'name'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[23/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mDedupe Operations[2m > [22mshould deduplicate by field
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m414:30[22m[39m
    [90m412| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m413| [39m
    [90m414| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m415| [39m      [90m// NYC, LA, SF = 3 unique cities[39m
    [90m416| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39munique_cities[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[24/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mDerived Outputs[2m > [22mshould output count variable
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m447:30[22m[39m
    [90m445| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m446| [39m
    [90m447| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m448| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39muser_count)[33m.[39m[34mtoBe[39m([34m5[39m)[33m;[39m
    [90m449| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[25/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mDerived Outputs[2m > [22mshould output first row variable
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m475:30[22m[39m
    [90m473| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m474| [39m
    [90m475| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m476| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39myoungest_user)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m477| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39myoungest_user[33m.[39mname)[33m.[39m[34mtoBe[39m([32m'Bob'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[26/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mComprehensive Pipeline[2m > [22mshould apply all operations in sequence
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m519:30[22m[39m
    [90m517| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m518| [39m
    [90m519| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m520| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39mprocessed_users[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m [90m// Limit of 2[39m
    [90m521| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39mactive_count)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[27/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mEdge Cases[2m > [22mshould handle empty input list
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m567:30[22m[39m
    [90m565| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m566| [39m
    [90m567| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m568| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39mfiltered_users[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m
    [90m569| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[28/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mEdge Cases[2m > [22mshould handle plain arrays
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/ListTools.test.ts:[2m621:30[22m[39m
    [90m619| [39m      const result = await (blockRunner as any).executeListToolsBlock(‚Ä¶
    [90m620| [39m
    [90m621| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m622| [39m      [34mexpect[39m(result[33m.[39mdata[33m?.[39msorted_array[33m.[39mrows[[34m0[39m][33m.[39mscore)[33m.[39m[34mtoBe[39m([34m90[39m)[33m;[39m
    [90m623| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[29/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/analytics_service.test.ts[2m > [22mAnalytics Service Integration[2m > [22mshould generate events and metrics on run completion
[31m[1mError[22m: Workflow is not active[39m
[36m [2m‚ùØ[22m RunAuthResolver.verifyCreateAccess server/services/runs/RunAuthResolver.ts:[2m110:53[22m[39m
    [90m108| [39m
    [90m109| [39m            [35mif[39m ([33m![39mworkflow) [35mthrow[39m [35mnew[39m [33mError[39m([32m'Workflow not found'[39m)[33m;[39m
    [90m110| [39m            if (workflow.status !== 'active') throw new Error('Workflo‚Ä¶
    [90m   | [39m                                                    [31m^[39m
    [90m111| [39m            if (!workflow.isPublic) throw new Error('Workflow is not p‚Ä¶
    [90m112| [39m
[90m [2m‚ùØ[22m RunService.createRun server/services/RunService.ts:[2m202:22[22m[39m
[90m [2m‚ùØ[22m tests/integration/analytics_service.test.ts:[2m42:21[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[30/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.ai.doc.test.ts[2m > [22mAI Document Assistant API Integration Tests[2m > [22mPOST /api/ai/doc/analyze[2m > [22mshould analyze a DOCX file and return variables
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2m‚ùØ[22m tests/integration/api.ai.doc.test.ts:[2m143:37[22m[39m
    [90m141| [39m                } catch (e) { console.log("FAIL_BODY: " + response.tex‚Ä¶
    [90m142| [39m            }
    [90m143| [39m            [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m144| [39m
    [90m145| [39m            [34mexpect[39m(response[33m.[39mbody[33m.[39mdata)[33m.[39m[34mtoHaveProperty[39m([32m"variables"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[31/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.ai.doc.test.ts[2m > [22mAI Document Assistant API Integration Tests[2m > [22mPOST /api/ai/doc/analyze[2m > [22mshould fail if no file is provided
[31m[1mError[22m: expected 400 "Bad Request", got 500 "Internal Server Error"[39m
[36m [2m‚ùØ[22m tests/integration/api.ai.doc.test.ts:[2m168:18[22m[39m
    [90m166| [39m            [35mawait[39m [34mrequest[39m(baseURL)
    [90m167| [39m                [33m.[39m[34mpost[39m([32m"/api/ai/doc/analyze"[39m)
    [90m168| [39m                [33m.[39m[34mexpect[39m([34m400[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m169| [39m        })[33m;[39m
    [90m170| [39m    })[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[32/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.dataSources.native.test.ts[2m > [22mData Sources API - Native Catalog[2m > [22mshould list databases and databases' tables in the catalog
[31m[1mError[22m: expected 200 "OK", got 500 "Internal Server Error"[39m
[36m [2m‚ùØ[22m tests/integration/api.dataSources.native.test.ts:[2m60:14[22m[39m
    [90m 58| [39m            [33m.[39m[35mget[39m([32m"/api/data-sources/native/catalog"[39m)
    [90m 59| [39m            [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mctx[33m.[39mauthToken[36m}[39m[32m`[39m)
    [90m 60| [39m            [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m             [31m^[39m
    [90m 61| [39m
    [90m 62| [39m        [35mconst[39m catalog [33m=[39m response[33m.[39mbody[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[33/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mPOST /api/projects/:ctx.projectId/templates[2m > [22mshould reject non-docx files
[31m[1mError[22m: expected 500 "Internal Server Error", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/api.templates-runs.test.ts:[2m119:12[22m[39m
    [90m117| [39m          [33m.[39m[34mfield[39m([32m"name"[39m[33m,[39m [32m"Test Template"[39m)
    [90m118| [39m          [33m.[39m[34mattach[39m([32m"file"[39m[33m,[39m mockPdf[33m,[39m [32m"test.pdf"[39m)
    [90m119| [39m          [33m.[39m[34mexpect[39m([34m500[39m)[33m;[39m [90m// Multer rejects before handler[39m
    [90m   | [39m           [31m^[39m
    [90m120| [39m      })[33m;[39m
    [90m121| [39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[34/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mRuns API[2m > [22mPOST /api/workflows/:id/run[2m > [22mshould reject without required permission
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/api.templates-runs.test.ts:[2m289:12[22m[39m
    [90m287| [39m          [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m288| [39m          [33m.[39m[34msend[39m({ email[33m:[39m viewerEmail[33m,[39m password[33m:[39m [32m"TestPassword123"[39m })
    [90m289| [39m          [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m           [31m^[39m
    [90m290| [39m
    [90m291| [39m        [35mawait[39m db[33m.[39m[34mupdate[39m(schema[33m.[39musers)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[35/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPOST /api/projects/:ctx.projectId/workflows[2m > [22mshould reject without permission
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/api.workflows.test.ts:[2m56:10[22m[39m
    [90m 54| [39m        [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m 55| [39m        [33m.[39m[34msend[39m({ email[33m:[39m viewerEmail[33m,[39m password[33m:[39m [32m"TestPassword123"[39m })
    [90m 56| [39m        [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m 57| [39m
    [90m 58| [39m      [35mawait[39m db[33m.[39m[34mupdate[39m(schema[33m.[39musers)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[36/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould move workflow to a project
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould move workflow to Main Folder (projectId = null)
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move to non-existent project
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move without authentication
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move of workflow user does not own
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move with invalid projectId format
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move without projectId in body
[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move to project user does not have access to
[31m[1mError[22m: Failed to create workflow: 500[39m
[36m [2m‚ùØ[22m tests/integration/api.workflows.test.ts:[2m229:15[22m[39m
    [90m227| [39m
    [90m228| [39m      [35mif[39m (workflowResponse[33m.[39mstatus [33m!==[39m [34m201[39m) {
    [90m229| [39m        throw new Error(`Failed to create workflow: ${workflowResponse‚Ä¶
    [90m   | [39m              [31m^[39m
    [90m230| [39m      }
    [90m231| [39m      workflowId [33m=[39m workflowResponse[33m.[39mbody[33m.[39mid[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[37/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mComplete Registration ‚Üí Login Flow[2m > [22mshould complete registration, verify email, then login
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m70:36[22m[39m
    [90m 68| [39m        [33m.[39m[34msend[39m({ email[33m,[39m password })[33m;[39m
    [90m 69| [39m
    [90m 70| [39m      [34mexpect[39m(loginAttempt2[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 71| [39m      [34mexpect[39m(loginAttempt2[33m.[39mbody[33m.[39mtoken)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m 72| [39m      [34mexpect[39m(loginAttempt2[33m.[39mbody[33m.[39muser[33m.[39memailVerified)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[38/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mAccount Lockout Flow[2m > [22mshould lock account after 5 failed attempts, then unlock after waiting
[31m[1mAssertionError[22m: expected 401 to be 423 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 423[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m110:36[22m[39m
    [90m108| [39m        })[33m;[39m
    [90m109| [39m
    [90m110| [39m      [34mexpect[39m(lockedAttempt[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m423[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m111| [39m      expect(lockedAttempt.body.message || lockedAttempt.body.error).t‚Ä¶
    [90m112| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mAccount Lockout Flow[2m > [22mshould record all login attempts
[31m[1mAssertionError[22m: expected 1 to be 3 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 1[39m

[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m145:31[22m[39m
    [90m143| [39m      })[33m;[39m
    [90m144| [39m
    [90m145| [39m      [34mexpect[39m(attempts[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m146| [39m      [34mexpect[39m(attempts[33m.[39m[34mfilter[39m(a [33m=>[39m [33m![39ma[33m.[39msuccessful)[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m147| [39m      [34mexpect[39m(attempts[33m.[39m[34mfilter[39m(a [33m=>[39m a[33m.[39msuccessful)[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[40/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mMFA Enrollment and Login Flow[2m > [22mshould complete MFA setup and login with TOTP
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m182:25[22m[39m
    [90m180| [39m      })[33m;[39m
    [90m181| [39m
    [90m182| [39m      [34mexpect[39m(mfaSecret)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m183| [39m      expect(mfaSecret!.enabled).toBe(false); // Not enabled until ver‚Ä¶
    [90m184| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[41/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mMFA Enrollment and Login Flow[2m > [22mshould login with backup code when TOTP unavailable
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'secret')[39m
[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m248:52[22m[39m
    [90m246| [39m      })[33m;[39m
    [90m247| [39m
    [90m248| [39m      [35mconst[39m totpCode [33m=[39m [34mgenerateTotpCode[39m(mfaSecret[33m![39m[33m.[39msecret)[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m249| [39m
    [90m250| [39m      [35mawait[39m [34mrequest[39m(app)

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[42/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mPassword Reset Flow[2m > [22mshould complete full password reset flow
[31m[1mAssertionError[22m: expected 500 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m332:36[22m[39m
    [90m330| [39m        })[33m;[39m
    [90m331| [39m
    [90m332| [39m      [34mexpect[39m(resetResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m333| [39m
    [90m334| [39m      [90m// Step 4: Verify old password no longer works[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[43/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mToken Refresh Flow[2m > [22mshould rotate refresh token on each use
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m405:40[22m[39m
    [90m403| [39m
    [90m404| [39m      let cookies = loginResponse.headers['set-cookie'] as unknown as ‚Ä¶
    [90m405| [39m      let refreshTokenCookie = cookies.find(c => c.startsWith('refresh‚Ä¶
    [90m   | [39m                                       [31m^[39m
    [90m406| [39m
    [90m407| [39m      [34mexpect[39m(refreshTokenCookie)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[44/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mSession Management Flow[2m > [22mshould list all active sessions
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m492:39[22m[39m
    [90m490| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m491| [39m
    [90m492| [39m      [34mexpect[39m(sessionsResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                      [31m^[39m
    [90m493| [39m      [34mexpect[39m(sessionsResponse[33m.[39mbody[33m.[39msessions)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m494| [39m      expect(sessionsResponse.body.sessions.length).toBeGreaterThanOrE‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[45/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mSession Management Flow[2m > [22mshould revoke specific session
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/auth.flows.real.test.ts:[2m517:40[22m[39m
    [90m515| [39m
    [90m516| [39m      [35mconst[39m sessions [33m=[39m sessionsResponse[33m.[39mbody[33m.[39msessions[33m;[39m
    [90m517| [39m      [35mconst[39m sessionToRevoke [33m=[39m sessions[33m.[39m[34mfind[39m((s[33m:[39m any) [33m=>[39m [33m![39ms[33m.[39mcurrent)[33m;[39m
    [90m   | [39m                                       [31m^[39m
    [90m518| [39m
    [90m519| [39m      [90m// Revoke first session[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[46/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould record failed login attempt
[31m[1mAssertionError[22m: expected 0 to be greater than 0[39m
[36m [2m‚ùØ[22m tests/integration/auth.routes.real.test.ts:[2m211:31[22m[39m
    [90m209| [39m      })[33m;[39m
    [90m210| [39m
    [90m211| [39m      [34mexpect[39m(attempts[33m.[39mlength)[33m.[39m[34mtoBeGreaterThan[39m([34m0[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m212| [39m      [35mconst[39m failedAttempt [33m=[39m attempts[33m.[39m[34mfind[39m(a [33m=>[39m [33m![39ma[33m.[39msuccessful)[33m;[39m
    [90m213| [39m      [34mexpect[39m(failedAttempt)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[47/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould return requiresMfa=true for MFA-enabled users
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/auth.routes.real.test.ts:[2m223:31[22m[39m
    [90m221| [39m        [33m.[39m[34msend[39m({ email[33m,[39m password })[33m;[39m
    [90m222| [39m
    [90m223| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m224| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mrequiresMfa)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m225| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39muserId)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[48/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould lock account after 5 failed attempts
[31m[1mAssertionError[22m: expected 401 to be 423 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 423[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/auth.routes.real.test.ts:[2m250:31[22m[39m
    [90m248| [39m        })[33m;[39m
    [90m249| [39m
    [90m250| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m423[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m251| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m252| [39m      expect(response.body.error || response.body.message).toBeDefined‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[49/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould refresh access token with valid refresh token
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m‚ùØ[22m tests/integration/auth.routes.real.test.ts:[2m295:23[22m[39m
    [90m293| [39m
    [90m294| [39m      const cookies = (loginResponse.headers as any)['set-cookie'] as ‚Ä¶
    [90m295| [39m      [34mexpect[39m(cookies)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                      [31m^[39m
    [90m296| [39m      const refreshTokenCookie = cookies!.find(c => c.startsWith('refr‚Ä¶
    [90m297| [39m      [34mexpect[39m(refreshTokenCookie)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[50/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mSelect/Multiselect Columns[2m > [22mshould create a select column with options
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m218:31[22m[39m
    [90m216| [39m        })[33m;[39m
    [90m217| [39m
    [90m218| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m219| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m220| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'select'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[51/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mSelect/Multiselect Columns[2m > [22mshould create a multiselect column with options
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m241:31[22m[39m
    [90m239| [39m        })[33m;[39m
    [90m240| [39m
    [90m241| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m242| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m243| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'multiselect'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[52/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mSelect/Multiselect Columns[2m > [22mshould validate select value against options
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m276:36[22m[39m
    [90m274| [39m        })[33m;[39m
    [90m275| [39m
    [90m276| [39m      [34mexpect[39m(validResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m277| [39m
    [90m278| [39m      [90m// Create row with invalid value should fail[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[53/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mSelect/Multiselect Columns[2m > [22mshould validate multiselect values as array
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m321:36[22m[39m
    [90m319| [39m        })[33m;[39m
    [90m320| [39m
    [90m321| [39m      [34mexpect[39m(validResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m322| [39m      expect(validResponse.body.values[testColumnId]).toEqual(['urgent‚Ä¶
    [90m323| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[54/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAutonumber Columns[2m > [22mshould create an autonumber column with sequence
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m341:31[22m[39m
    [90m339| [39m        })[33m;[39m
    [90m340| [39m
    [90m341| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m342| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m343| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'autonumber'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[55/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAutonumber Columns[2m > [22mshould format autonumber with prefix
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m375:34[22m[39m
    [90m373| [39m        [33m.[39m[34msend[39m({ values[33m:[39m {} })[33m;[39m
    [90m374| [39m
    [90m375| [39m      [34mexpect[39m(rowResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m376| [39m      [90m// Check if formatted value is stored or displayed[39m
    [90m377| [39m      [90m// This depends on implementation - adjust as needed[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[56/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mRow Notes[2m > [22mshould create a note for a row
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m401:31[22m[39m
    [90m399| [39m        })[33m;[39m
    [90m400| [39m
    [90m401| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m402| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m403| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mtext)[33m.[39m[34mtoBe[39m([32m'This is a test note'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[57/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mRow Notes[2m > [22mshould get all notes for a row
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m427:31[22m[39m
    [90m425| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m authCookie)[33m;[39m
    [90m426| [39m
    [90m427| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m428| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m429| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[58/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mRow Notes[2m > [22mshould delete a note
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m447:37[22m[39m
    [90m445| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m authCookie)[33m;[39m
    [90m446| [39m
    [90m447| [39m      [34mexpect[39m(deleteResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m448| [39m
    [90m449| [39m      [90m// Verify note is deleted[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[59/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mRow Notes[2m > [22mshould not allow deleting notes by other users
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m474:37[22m[39m
    [90m472| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m otherUserCookie)[33m;[39m
    [90m473| [39m
    [90m474| [39m      [34mexpect[39m(deleteResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m475| [39m    })[33m;[39m
    [90m476| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[60/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAPI Tokens[2m > [22mshould create an API token
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m494:31[22m[39m
    [90m492| [39m      [90m// Assuming DB exists (created in beforeAll).[39m
    [90m493| [39m      [90m// If 404 persists, we might need to debug route registration.[39m
    [90m494| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m495| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m496| [39m      // plainToken is not returned in the object, it might be separat‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[61/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAPI Tokens[2m > [22mshould validate API token scopes
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m514:31[22m[39m
    [90m512| [39m        })[33m;[39m
    [90m513| [39m
    [90m514| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m515| [39m    })[33m;[39m
    [90m516| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[62/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAPI Tokens[2m > [22mshould revoke (delete) an API token
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m528:49[22m[39m
    [90m526| [39m        })[33m;[39m
    [90m527| [39m
    [90m528| [39m      [35mconst[39m tokenId [33m=[39m createResponse[33m.[39mbody[33m.[39mtoken[33m.[39mid[33m;[39m
    [90m   | [39m                                                [31m^[39m
    [90m529| [39m
    [90m530| [39m      [90m// Revoke token[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[63/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould grant table permission
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m588:31[22m[39m
    [90m586| [39m        })[33m;[39m
    [90m587| [39m
    [90m588| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m589| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m590| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mrole)[33m.[39m[34mtoBe[39m([32m'read'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[64/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould list table permissions
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m600:31[22m[39m
    [90m598| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m authCookie)[33m;[39m
    [90m599| [39m
    [90m600| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m601| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m602| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(response[33m.[39mbody))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[65/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould update table permission role
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m633:37[22m[39m
    [90m631| [39m        console[33m.[39m[34mlog[39m([32m'Update permission failed:'[39m[33m,[39m updateResponse[33m.[39mbody)[33m;[39m
    [90m632| [39m      }
    [90m633| [39m      [34mexpect[39m(updateResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m634| [39m      [34mexpect[39m(updateResponse[33m.[39mbody[33m.[39mrole)[33m.[39m[34mtoBe[39m([32m'write'[39m)[33m;[39m
    [90m635| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[66/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould revoke table permission
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m659:37[22m[39m
    [90m657| [39m
    [90m658| [39m      [90m// Revoke returns 200 with message[39m
    [90m659| [39m      [34mexpect[39m(revokeResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m660| [39m
    [90m661| [39m      [90m// Verify permission is deleted[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[67/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould enforce RBAC - only owners can manage permissions
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m681:31[22m[39m
    [90m679| [39m        })[33m;[39m
    [90m680| [39m
    [90m681| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m682| [39m    })[33m;[39m
    [90m683| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[68/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mGrid Performance[2m > [22mshould paginate rows efficiently
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m707:31[22m[39m
    [90m705| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m authCookie)[33m;[39m
    [90m706| [39m
    [90m707| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m708| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mrows)[33m.[39m[34mtoHaveLength[39m([34m25[39m)[33m;[39m
    [90m709| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mpagination[33m.[39mtotal)[33m.[39m[34mtoBe[39m([34m100[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[69/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mError Handling[2m > [22mshould return user-friendly error for invalid column type
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m727:31[22m[39m
    [90m725| [39m        })[33m;[39m
    [90m726| [39m
    [90m727| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m728| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39merrors)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m729| [39m      [90m// expect(response.body.error).toContain('Invalid column type');[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[70/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mError Handling[2m > [22mshould return user-friendly error for missing required fields
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m754:31[22m[39m
    [90m752| [39m
    [90m753| [39m      [90m// Improved error handling returns 400[39m
    [90m754| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m755| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m756| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Required'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[71/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mError Handling[2m > [22mshould handle network errors gracefully
[31m[1mAssertionError[22m: expected 401 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault-v4-regression.test.ts:[2m767:31[22m[39m
    [90m765| [39m
    [90m766| [39m      [90m// TODO: Improve error handling to return 400 instead of 500[39m
    [90m767| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m768| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m769| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[72/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.autonumber.test.ts[2m > [22mDataVault Autonumber Integration Tests[2m > [22mshould generate autonumber with prefix
[31m[1merror[22m: function public.datavault_get_next_auto_number(uuid, uuid, integer) does not exist[39m
[90m [2m‚ùØ[22m cn.parseErrorMessage node_modules/@neondatabase/serverless/index.mjs:[2m1182:6[22m[39m
[90m [2m‚ùØ[22m cn.handlePacket node_modules/@neondatabase/serverless/index.mjs:[2m1143:13[22m[39m
[90m [2m‚ùØ[22m cn.parse node_modules/@neondatabase/serverless/index.mjs:[2m1127:36[22m[39m
[90m [2m‚ùØ[22m v.<anonymous> node_modules/@neondatabase/serverless/index.mjs:[2m1190:16[22m[39m
[90m [2m‚ùØ[22m v.emit node_modules/@neondatabase/serverless/index.mjs:[2m397:12[22m[39m
[90m [2m‚ùØ[22m WebSocket.<anonymous> node_modules/@neondatabase/serverless/index.mjs:[2m987:80[22m[39m
[90m [2m‚ùØ[22m callListener node_modules/ws/lib/event-target.js:[2m290:14[22m[39m
[90m [2m‚ùØ[22m WebSocket.onMessage node_modules/ws/lib/event-target.js:[2m209:9[22m[39m
[90m [2m‚ùØ[22m Receiver.receiverOnMessage node_modules/ws/lib/websocket.js:[2m1220:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[73/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.autonumber.test.ts[2m > [22mDataVault Autonumber Integration Tests[2m > [22mshould generate autonumber with yearly reset format
[31m[1mAssertionError[22m: expected 'INV-2026-004' to be 'INV-2026-005' // Object.is equality[39m

Expected: [32m"INV-2026-00[7m5[27m"[39m
Received: [31m"INV-2026-00[7m4[27m"[39m

[36m [2m‚ùØ[22m tests/integration/datavault.autonumber.test.ts:[2m157:46[22m[39m
    [90m155| [39m
    [90m156| [39m    [90m// Format should be: PREFIX-YEAR-PADDED_NUMBER[39m
    [90m157| [39m    expect(row1.values[yearlyResetColumnId]).toBe(`INV-${currentYear}-‚Ä¶
    [90m   | [39m                                             [31m^[39m
    [90m158| [39m
    [90m159| [39m    [90m// Create second row[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[74/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.autonumber.test.ts[2m > [22mDataVault Autonumber Integration Tests[2m > [22mshould be atomic and prevent race conditions
[31m[1merror[22m: function public.datavault_get_next_autonumber(uuid, uuid, uuid, text, integer, text, text) does not exist[39m
[90m [2m‚ùØ[22m cn.parseErrorMessage node_modules/@neondatabase/serverless/index.mjs:[2m1182:6[22m[39m
[90m [2m‚ùØ[22m cn.handlePacket node_modules/@neondatabase/serverless/index.mjs:[2m1143:13[22m[39m
[90m [2m‚ùØ[22m cn.parse node_modules/@neondatabase/serverless/index.mjs:[2m1127:36[22m[39m
[90m [2m‚ùØ[22m v.<anonymous> node_modules/@neondatabase/serverless/index.mjs:[2m1190:16[22m[39m
[90m [2m‚ùØ[22m v.emit node_modules/@neondatabase/serverless/index.mjs:[2m397:12[22m[39m
[90m [2m‚ùØ[22m WebSocket.<anonymous> node_modules/@neondatabase/serverless/index.mjs:[2m987:80[22m[39m
[90m [2m‚ùØ[22m callListener node_modules/ws/lib/event-target.js:[2m290:14[22m[39m
[90m [2m‚ùØ[22m WebSocket.onMessage node_modules/ws/lib/event-target.js:[2m209:9[22m[39m
[90m [2m‚ùØ[22m Receiver.receiverOnMessage node_modules/ws/lib/websocket.js:[2m1220:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[75/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould allow owner to read table
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m154:26[22m[39m
    [90m152| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m ownerCookie)[33m;[39m
    [90m153| [39m
    [90m154| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m155| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mid)[33m.[39m[34mtoBe[39m(tableId)[33m;[39m
    [90m156| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[76/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould allow writer to read table
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m163:26[22m[39m
    [90m161| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m writerCookie)[33m;[39m
    [90m162| [39m
    [90m163| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m164| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mid)[33m.[39m[34mtoBe[39m(tableId)[33m;[39m
    [90m165| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[77/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould allow reader to read table
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m172:26[22m[39m
    [90m170| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m readerCookie)[33m;[39m
    [90m171| [39m
    [90m172| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m173| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mid)[33m.[39m[34mtoBe[39m(tableId)[33m;[39m
    [90m174| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[78/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould deny non-member from reading table
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m181:26[22m[39m
    [90m179| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m nonMemberCookie)[33m;[39m
    [90m180| [39m
    [90m181| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m182| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m183| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[79/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPATCH /api/datavault/tables/:tableId[2m > [22mshould allow owner to update table
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m193:26[22m[39m
    [90m191| [39m        [33m.[39m[34msend[39m({ description[33m:[39m [32m'Updated by owner'[39m })[33m;[39m
    [90m192| [39m
    [90m193| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m194| [39m    })[33m;[39m
    [90m195| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[80/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPATCH /api/datavault/tables/:tableId[2m > [22mshould deny writer from updating table
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m202:26[22m[39m
    [90m200| [39m        [33m.[39m[34msend[39m({ description[33m:[39m [32m'Attempt by writer'[39m })[33m;[39m
    [90m201| [39m
    [90m202| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m203| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m204| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[81/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPATCH /api/datavault/tables/:tableId[2m > [22mshould deny reader from updating table
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m212:26[22m[39m
    [90m210| [39m        [33m.[39m[34msend[39m({ description[33m:[39m [32m'Attempt by reader'[39m })[33m;[39m
    [90m211| [39m
    [90m212| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m213| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m214| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[82/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/tables/:tableId[2m > [22mshould deny writer from deleting table
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m223:26[22m[39m
    [90m221| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m writerCookie)[33m;[39m
    [90m222| [39m
    [90m223| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m224| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m225| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[83/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/tables/:tableId[2m > [22mshould deny reader from deleting table
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m232:26[22m[39m
    [90m230| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m readerCookie)[33m;[39m
    [90m231| [39m
    [90m232| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m233| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m234| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[84/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/tables/:tableId[2m > [22mshould deny non-member from deleting table
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m241:26[22m[39m
    [90m239| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m nonMemberCookie)[33m;[39m
    [90m240| [39m
    [90m241| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m242| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m243| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[85/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId/permissions[2m > [22mshould allow owner to view permissions
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m252:26[22m[39m
    [90m250| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m ownerCookie)[33m;[39m
    [90m251| [39m
    [90m252| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m253| [39m      [34mexpect[39m([33mArray[39m[33m.[39m[34misArray[39m(res[33m.[39mbody))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m254| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m [90m// writer and reader[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[86/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId/permissions[2m > [22mshould deny writer from viewing permissions
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m262:26[22m[39m
    [90m260| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m writerCookie)[33m;[39m
    [90m261| [39m
    [90m262| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m263| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m264| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[87/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId/permissions[2m > [22mshould deny reader from viewing permissions
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m271:26[22m[39m
    [90m269| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m readerCookie)[33m;[39m
    [90m270| [39m
    [90m271| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m272| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m273| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[88/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPOST /api/datavault/tables/:tableId/permissions[2m > [22mshould allow owner to grant permissions
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m283:26[22m[39m
    [90m281| [39m        [33m.[39m[34msend[39m({ userId[33m:[39m nonMemberId[33m,[39m role[33m:[39m [32m'read'[39m })[33m;[39m
    [90m282| [39m
    [90m283| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m284| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39muserId)[33m.[39m[34mtoBe[39m(nonMemberId)[33m;[39m
    [90m285| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mrole)[33m.[39m[34mtoBe[39m([32m'read'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[89/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPOST /api/datavault/tables/:tableId/permissions[2m > [22mshould allow owner to update existing permission (upsert)
[31m[1mAssertionError[22m: expected 401 to be 201 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 201[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m301:26[22m[39m
    [90m299| [39m        .send({ userId: readerId, role: 'write' }); // Upgrade reader ‚Ä¶
    [90m300| [39m
    [90m301| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m201[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m302| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mrole)[33m.[39m[34mtoBe[39m([32m'write'[39m)[33m;[39m
    [90m303| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[90/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPOST /api/datavault/tables/:tableId/permissions[2m > [22mshould deny writer from granting permissions
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m317:26[22m[39m
    [90m315| [39m        [33m.[39m[34msend[39m({ userId[33m:[39m nonMemberId[33m,[39m role[33m:[39m [32m'read'[39m })[33m;[39m
    [90m316| [39m
    [90m317| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m318| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m319| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[91/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPOST /api/datavault/tables/:tableId/permissions[2m > [22mshould prevent modifying table owner permissions
[31m[1mAssertionError[22m: expected 401 to be 500 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m327:26[22m[39m
    [90m325| [39m        [33m.[39m[34msend[39m({ userId[33m:[39m ownerId[33m,[39m role[33m:[39m [32m'read'[39m })[33m;[39m
    [90m326| [39m
    [90m327| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m500[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m328| [39m      expect(res.body.message).toContain('Cannot modify permissions fo‚Ä¶
    [90m329| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[92/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/permissions/:permissionId[2m > [22mshould allow owner to revoke permissions
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m347:26[22m[39m
    [90m345| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m ownerCookie)[33m;[39m
    [90m346| [39m
    [90m347| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m348| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m349| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[93/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/permissions/:permissionId[2m > [22mshould deny writer from revoking permissions
[31m[1mAssertionError[22m: expected 401 to be 403 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m370:26[22m[39m
    [90m368| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m writerCookie)[33m;[39m
    [90m369| [39m
    [90m370| [39m      [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m403[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m371| [39m      [34mexpect[39m(res[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Access denied'[39m)[33m;[39m
    [90m372| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[94/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPermission hierarchy[2m > [22mshould enforce owner includes write and read
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m381:30[22m[39m
    [90m379| [39m        [33m.[39m[35mget[39m([32m`/api/datavault/tables/[39m[36m${[39mtableId[36m}[39m[32m`[39m)
    [90m380| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m ownerCookie)[33m;[39m
    [90m381| [39m      [34mexpect[39m(readRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m382| [39m
    [90m383| [39m      [90m// Owner can update table[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[95/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPermission hierarchy[2m > [22mshould enforce write includes read but not owner
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m396:30[22m[39m
    [90m394| [39m        [33m.[39m[35mget[39m([32m`/api/datavault/tables/[39m[36m${[39mtableId[36m}[39m[32m`[39m)
    [90m395| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m writerCookie)[33m;[39m
    [90m396| [39m      [34mexpect[39m(readRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m397| [39m
    [90m398| [39m      [90m// Writer cannot update table schema[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[96/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPermission hierarchy[2m > [22mshould enforce read is read-only
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/datavault.permissions.test.ts:[2m411:30[22m[39m
    [90m409| [39m        [33m.[39m[35mget[39m([32m`/api/datavault/tables/[39m[36m${[39mtableId[36m}[39m[32m`[39m)
    [90m410| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m readerCookie)[33m;[39m
    [90m411| [39m      [34mexpect[39m(readRes[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m412| [39m
    [90m413| [39m      [90m// Reader cannot update[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[97/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/metrics.test.ts[2m > [22mMetrics Integration[2m > [22mshould expose /metrics endpoint
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/metrics.test.ts:[2m33:33[22m[39m
    [90m 31| [39m        [35mconst[39m response [33m=[39m [35mawait[39m [34mrequest[39m(app)[33m.[39m[35mget[39m([32m'/metrics'[39m)[33m;[39m
    [90m 32| [39m
    [90m 33| [39m        [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m 34| [39m        expect(response.headers['content-type']).toContain('text/plain‚Ä¶
    [90m 35| [39m        // Prometheus metrics usually contain comments like # HELP or ‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[98/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould complete full MFA setup flow
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mfaEnabled')[39m
[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m41:47[22m[39m
    [90m 39| [39m
    [90m 40| [39m      [35mconst[39m token [33m=[39m (loginResponse[33m.[39mbody [35mas[39m any)[33m.[39mtoken[33m;[39m
    [90m 41| [39m      [34mexpect[39m((loginResponse[33m.[39mbody [35mas[39m any)[33m.[39muser[33m.[39mmfaEnabled)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                                              [31m^[39m
    [90m 42| [39m
    [90m 43| [39m      [90m// Step 2: Setup MFA[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[99/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould reject invalid TOTP code during setup
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m117:37[22m[39m
    [90m115| [39m        [33m.[39m[34msend[39m({ token[33m:[39m [32m"000000"[39m })[33m;[39m [90m// Invalid code[39m
    [90m116| [39m
    [90m117| [39m      [34mexpect[39m(verifyResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m118| [39m      [34mexpect[39m(verifyResponse[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m"Invalid"[39m)[33m;[39m
    [90m119| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[100/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould not allow MFA setup if already enabled
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m135:46[22m[39m
    [90m133| [39m        [33m.[39m[34msend[39m({ email[33m,[39m password })[33m;[39m
    [90m134| [39m
    [90m135| [39m      [34mexpect[39m(loginResponse[33m.[39mbody[33m.[39mrequiresMfa)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m136| [39m
    [90m137| [39m      // Can't test setup with MFA user since we can't login without M‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[101/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould store hashed backup codes
[31m[1mAssertionError[22m: expected [] to have a length of 10 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 10[39m
[31m+ 0[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m177:27[22m[39m
    [90m175| [39m      })[33m;[39m
    [90m176| [39m
    [90m177| [39m      [34mexpect[39m(storedCodes)[33m.[39m[34mtoHaveLength[39m([34m10[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m178| [39m
    [90m179| [39m      [90m// Hashes should not match plain codes[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[102/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Login Flow[2m > [22mshould require MFA for enabled users
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m195:36[22m[39m
    [90m193| [39m        [33m.[39m[34msend[39m({ email[33m,[39m password })[33m;[39m
    [90m194| [39m
    [90m195| [39m      [34mexpect[39m(loginResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m196| [39m      [34mexpect[39m(loginResponse[33m.[39mbody[33m.[39mrequiresMfa)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m197| [39m      [34mexpect[39m(loginResponse[33m.[39mbody[33m.[39muserId)[33m.[39m[34mtoBe[39m(userId)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[103/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Login Flow[2m > [22mshould complete MFA login with valid TOTP
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m209:46[22m[39m
    [90m207| [39m        [33m.[39m[34msend[39m({ email[33m,[39m password })[33m;[39m
    [90m208| [39m
    [90m209| [39m      [34mexpect[39m(loginResponse[33m.[39mbody[33m.[39mrequiresMfa)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m210| [39m
    [90m211| [39m      [90m// Step 2: Verify MFA[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[104/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Login Flow[2m > [22mshould accept TOTP codes within 60-second window
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m264:32[22m[39m
    [90m262| [39m        [33m.[39m[34msend[39m({ userId[33m,[39m token[33m:[39m totpCode })[33m;[39m
    [90m263| [39m
    [90m264| [39m      [34mexpect[39m(response1[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m265| [39m
    [90m266| [39m      [90m// Login again for second test[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[105/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Flow[2m > [22mshould login with valid backup code
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'secret')[39m
[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m305:52[22m[39m
    [90m303| [39m      })[33m;[39m
    [90m304| [39m
    [90m305| [39m      [35mconst[39m totpCode [33m=[39m [34mgenerateTotpCode[39m(mfaSecret[33m![39m[33m.[39msecret)[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m306| [39m
    [90m307| [39m      [35mawait[39m [34mrequest[39m(app)

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[106/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Flow[2m > [22mshould prevent backup code reuse
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'secret')[39m
[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m375:52[22m[39m
    [90m373| [39m      })[33m;[39m
    [90m374| [39m
    [90m375| [39m      [35mconst[39m totpCode [33m=[39m [34mgenerateTotpCode[39m(mfaSecret[33m![39m[33m.[39msecret)[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m376| [39m
    [90m377| [39m      [35mawait[39m [34mrequest[39m(app)

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[107/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Flow[2m > [22mshould try TOTP before backup code
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m430:31[22m[39m
    [90m428| [39m
    [90m429| [39m      [90m// Should succeed with TOTP (backup code ignored)[39m
    [90m430| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m431| [39m    })[33m;[39m
    [90m432| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[108/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Status[2m > [22mshould return MFA status for user
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m446:37[22m[39m
    [90m444| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mloginResponse[33m.[39mbody[33m.[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m445| [39m
    [90m446| [39m      [34mexpect[39m(statusResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m447| [39m      [34mexpect[39m(statusResponse[33m.[39mbody[33m.[39mmfaEnabled)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m448| [39m      [34mexpect[39m(statusResponse[33m.[39mbody[33m.[39mbackupCodesRemaining)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[109/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Status[2m > [22mshould return backup codes count for MFA users
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'secret')[39m
[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m464:52[22m[39m
    [90m462| [39m      })[33m;[39m
    [90m463| [39m
    [90m464| [39m      [35mconst[39m totpCode [33m=[39m [34mgenerateTotpCode[39m(mfaSecret[33m![39m[33m.[39msecret)[33m;[39m
    [90m   | [39m                                                   [31m^[39m
    [90m465| [39m
    [90m466| [39m      [35mconst[39m mfaLoginResponse [33m=[39m [35mawait[39m [34mrequest[39m(app)

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[110/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Disable Flow[2m > [22mshould disable MFA with password verification
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m510:38[22m[39m
    [90m508| [39m        [33m.[39m[34msend[39m({ password })[33m;[39m
    [90m509| [39m
    [90m510| [39m      [34mexpect[39m(disableResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m511| [39m
    [90m512| [39m      [90m// Verify MFA is disabled[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[111/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Disable Flow[2m > [22mshould require correct password to disable MFA
[31m[1mAssertionError[22m: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string[39m
[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m557:44[22m[39m
    [90m555| [39m
    [90m556| [39m      [34mexpect[39m(disableResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m401[39m)[33m;[39m
    [90m557| [39m      expect(disableResponse.body.message).toContain("Invalid password‚Ä¶
    [90m   | [39m                                           [31m^[39m
    [90m558| [39m
    [90m559| [39m      [90m// MFA should still be enabled[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[112/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Regeneration[2m > [22mshould regenerate backup codes
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m588:41[22m[39m
    [90m586| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m587| [39m
    [90m588| [39m      [34mexpect[39m(regenerateResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m589| [39m      [34mexpect[39m(regenerateResponse[33m.[39mbody[33m.[39mbackupCodes)[33m.[39m[34mtoHaveLength[39m([34m10[39m)[33m;[39m
    [90m590| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[113/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mTenant-Level MFA Enforcement[2m > [22mshould enforce MFA for tenant users when required by tenant
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/mfa.flow.real.test.ts:[2m638:36[22m[39m
    [90m636| [39m        [33m.[39m[34msend[39m({ email[33m,[39m password })[33m;[39m
    [90m637| [39m
    [90m638| [39m      [34mexpect[39m(loginResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m639| [39m      [34mexpect[39m(loginResponse[33m.[39mbody[33m.[39mrequiresMfa)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m640| [39m      [34mexpect[39m(loginResponse[33m.[39mbody[33m.[39muserId)[33m.[39m[34mtoBe[39m(userId)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[114/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #7: Delete organization[2m > [22mshould prevent deletion if org owns assets
[31m[1mAssertionError[22m: promise resolved "undefined" instead of rejecting[39m

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/organizations-audit-fixes.test.ts:[2m246:7[22m[39m
    [90m244| [39m      [35mawait[39m [34mexpect[39m(
    [90m245| [39m        organizationService[33m.[39m[34mdeleteOrganization[39m(org[33m.[39mid[33m,[39m user1Id)
    [90m246| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m([36m/owns workflows/i[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m247| [39m
    [90m248| [39m      [90m// Cleanup[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[115/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m1. Required + Show/Hide (Questions)[2m > [22mshould NOT block Next when required question is hidden
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2m‚ùØ[22m tests/integration/regression-REG-1.test.ts:[2m197:31[22m[39m
    [90m195| [39m            [90m// Check visibility[39m
    [90m196| [39m            const isVisible = evaluateVisibilityExpression("show_trigg‚Ä¶
    [90m197| [39m            [34mexpect[39m(isVisible)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m198| [39m
    [90m199| [39m            [90m// Required question is hidden, should not block[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[116/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m2. Required + Show/Hide (Pages)[2m > [22mshould skip hidden required page entirely
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2m‚ùØ[22m tests/integration/regression-REG-1.test.ts:[2m330:31[22m[39m
    [90m328| [39m            const isVisible = evaluateVisibilityExpression((section2.v‚Ä¶
    [90m329| [39m
    [90m330| [39m            expect(isVisible).toBe(false); // Section 2 should be hidd‚Ä¶
    [90m   | [39m                              [31m^[39m
    [90m331| [39m
    [90m332| [39m            [90m// Get all sections[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[117/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m3. Preview/Snapshot/Live Parity[2m > [22mshould evaluate visibility consistently across modes
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2m‚ùØ[22m tests/integration/regression-REG-1.test.ts:[2m445:64[22m[39m
    [90m443| [39m            [90m// Change data[39m
    [90m444| [39m            [35mconst[39m data2 [33m=[39m { trigger[33m:[39m [35mfalse[39m[33m,[39m value[33m:[39m [34m10[39m }[33m;[39m
    [90m445| [39m            expect(evaluateVisibilityExpression(expr1, data2)).toBe(fa‚Ä¶
    [90m   | [39m                                                               [31m^[39m
    [90m446| [39m            expect(evaluateVisibilityExpression(expr2, data2)).toBe(tr‚Ä¶
    [90m447| [39m            expect(evaluateVisibilityExpression(expr3, data2)).toBe(fa‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[118/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould list all active sessions for current user
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m53:31[22m[39m
    [90m 51| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m 52| [39m
    [90m 53| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m 54| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39msessions)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m 55| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39msessions[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[119/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould mark current session correctly
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m85:30[22m[39m
    [90m 83| [39m      [35mconst[39m token [33m=[39m login2[33m.[39mbody[33m.[39mtoken[33m;[39m
    [90m 84| [39m      const cookies = (login2.headers as any)["set-cookie"] as string[‚Ä¶
    [90m 85| [39m      const cookie = cookies.find((c) => c.startsWith("refresh_token="‚Ä¶
    [90m   | [39m                             [31m^[39m
    [90m 86| [39m
    [90m 87| [39m      [90m// List sessions with cookie (should identify current session)[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[120/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould exclude revoked sessions
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m120:50[22m[39m
    [90m118| [39m        [33m.[39m[34mupdate[39m(refreshTokens)
    [90m119| [39m        [33m.[39m[35mset[39m({ revoked[33m:[39m [35mtrue[39m })
    [90m120| [39m        [33m.[39m[34mwhere[39m([34meq[39m(refreshTokens[33m.[39mid[33m,[39m allTokens[[34m0[39m][33m.[39mid))[33m;[39m
    [90m   | [39m                                                 [31m^[39m
    [90m121| [39m
    [90m122| [39m      [90m// List sessions[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[121/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould order sessions by last used (most recent first)
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m154:36[22m[39m
    [90m152| [39m
    [90m153| [39m      [90m// Should be ordered by lastUsedAt descending[39m
    [90m154| [39m      [35mfor[39m ([35mlet[39m i [33m=[39m [34m1[39m[33m;[39m i [33m<[39m sessions[33m.[39mlength[33m;[39m i[33m++[39m) {
    [90m   | [39m                                   [31m^[39m
    [90m155| [39m        [35mconst[39m prev [33m=[39m [35mnew[39m [33mDate[39m(sessions[i [33m-[39m [34m1[39m][33m.[39mlastUsedAt)[33m;[39m
    [90m156| [39m        [35mconst[39m curr [33m=[39m [35mnew[39m [33mDate[39m(sessions[i][33m.[39mlastUsedAt)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[122/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould filter sessions by current user only
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m184:37[22m[39m
    [90m182| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39muser1Login[33m.[39mbody[33m.[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m183| [39m
    [90m184| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39msessions[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m185| [39m    })[33m;[39m
    [90m186| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[123/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould revoke specific session
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m215:40[22m[39m
    [90m213| [39m
    [90m214| [39m      [35mconst[39m sessions [33m=[39m sessionsResponse[33m.[39mbody[33m.[39msessions[33m;[39m
    [90m215| [39m      [35mconst[39m sessionToRevoke [33m=[39m sessions[33m.[39m[34mfind[39m((s[33m:[39m any) [33m=>[39m [33m![39ms[33m.[39mcurrent)[33m;[39m
    [90m   | [39m                                       [31m^[39m
    [90m216| [39m
    [90m217| [39m      [90m// Revoke non-current session[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[124/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould prevent revoking current session
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m249:30[22m[39m
    [90m247| [39m      [35mconst[39m token [33m=[39m login[33m.[39mbody[33m.[39mtoken[33m;[39m
    [90m248| [39m      [35mconst[39m cookies [33m=[39m (login[33m.[39mheaders [35mas[39m any)[[32m"set-cookie"[39m] [35mas[39m string[][33m;[39m
    [90m249| [39m      const cookie = cookies.find((c) => c.startsWith("refresh_token="‚Ä¶
    [90m   | [39m                             [31m^[39m
    [90m250| [39m
    [90m251| [39m      [90m// Get sessions[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[125/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould prevent revoking other user's session
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m303:61[22m[39m
    [90m301| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39muser1Login[33m.[39mbody[33m.[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m302| [39m
    [90m303| [39m      [35mconst[39m user1SessionId [33m=[39m user1Sessions[33m.[39mbody[33m.[39msessions[[34m0[39m][33m.[39mid[33m;[39m
    [90m   | [39m                                                            [31m^[39m
    [90m304| [39m
    [90m305| [39m      [90m// Try to revoke user 1's session as user 2[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[126/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all other sessions
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m329:30[22m[39m
    [90m327| [39m      [35mconst[39m token [33m=[39m currentLogin[33m.[39mbody[33m.[39mtoken[33m;[39m
    [90m328| [39m      const cookies = (currentLogin.headers as any)["set-cookie"] as s‚Ä¶
    [90m329| [39m      const cookie = cookies.find((c) => c.startsWith("refresh_token="‚Ä¶
    [90m   | [39m                             [31m^[39m
    [90m330| [39m
    [90m331| [39m      [90m// Revoke all except current[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[127/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould keep current session active
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m360:30[22m[39m
    [90m358| [39m      [35mconst[39m token [33m=[39m currentLogin[33m.[39mbody[33m.[39mtoken[33m;[39m
    [90m359| [39m      const cookies = (currentLogin.headers as any)["set-cookie"] as s‚Ä¶
    [90m360| [39m      const cookie = cookies.find((c) => c.startsWith("refresh_token="‚Ä¶
    [90m   | [39m                             [31m^[39m
    [90m361| [39m
    [90m362| [39m      [90m// Revoke all others[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[128/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould return 400 if no active session found
[31m[1mAssertionError[22m: expected 401 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m397:31[22m[39m
    [90m395| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m396| [39m
    [90m397| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m398| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m"No active session"[39m)[33m;[39m
    [90m399| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[129/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all trusted devices
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m410:30[22m[39m
    [90m408| [39m      [35mconst[39m token [33m=[39m login[33m.[39mbody[33m.[39mtoken[33m;[39m
    [90m409| [39m      [35mconst[39m cookies [33m=[39m (login[33m.[39mheaders [35mas[39m any)[[32m"set-cookie"[39m] [35mas[39m string[][33m;[39m
    [90m410| [39m      const cookie = cookies.find((c) => c.startsWith("refresh_token="‚Ä¶
    [90m   | [39m                             [31m^[39m
    [90m411| [39m
    [90m412| [39m      [90m// Trust a device[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[130/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould handle user with single session gracefully
[31m[1mAssertionError[22m: expected +0 to be 1 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m456:53[22m[39m
    [90m454| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m455| [39m
    [90m456| [39m      [34mexpect[39m(sessionsResponse[33m.[39mbody[33m.[39msessions[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                                                    [31m^[39m
    [90m457| [39m    })[33m;[39m
    [90m458| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[131/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mSession Security[2m > [22mshould include device metadata in sessions
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m476:37[22m[39m
    [90m474| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m475| [39m
    [90m476| [39m      [35mconst[39m session [33m=[39m response[33m.[39mbody[33m.[39msessions[[34m0[39m][33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m477| [39m
    [90m478| [39m      [34mexpect[39m(session[33m.[39mdeviceName)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[132/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mSession Security[2m > [22mshould not expose sensitive token data
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m493:37[22m[39m
    [90m491| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mlogin[33m.[39mbody[33m.[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m492| [39m
    [90m493| [39m      [35mconst[39m session [33m=[39m response[33m.[39mbody[33m.[39msessions[[34m0[39m][33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m494| [39m
    [90m495| [39m      [90m// Should NOT include token hash or metadata[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[133/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mSession Security[2m > [22mshould track session activity timestamps
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2m‚ùØ[22m tests/integration/session.management.real.test.ts:[2m511:37[22m[39m
    [90m509| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mlogin[33m.[39mbody[33m.[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m510| [39m
    [90m511| [39m      [35mconst[39m session [33m=[39m response[33m.[39mbody[33m.[39msessions[[34m0[39m][33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m512| [39m
    [90m513| [39m      [34mexpect[39m(session[33m.[39mcreatedAt)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[134/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mPOST /api/auth/trust-device[2m > [22mshould trust current device
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m52:36[22m[39m
    [90m 50| [39m        [33m.[39m[35mset[39m([32m"X-Forwarded-For"[39m[33m,[39m [32m"192.168.1.100"[39m)[33m;[39m
    [90m 51| [39m
    [90m 52| [39m      [34mexpect[39m(trustResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 53| [39m      [34mexpect[39m(trustResponse[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m"trusted"[39m)[33m;[39m
    [90m 54| [39m      [34mexpect[39m(trustResponse[33m.[39mbody[33m.[39mtrustedUntil)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[135/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mPOST /api/auth/trust-device[2m > [22mshould set trust expiry to 30 days
[31m[1mAssertionError[22m: expected NaN to be 30 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 30[39m
[31m+ NaN[39m

[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m92:24[22m[39m
    [90m 90| [39m      )[33m;[39m
    [90m 91| [39m
    [90m 92| [39m      [34mexpect[39m(diffDays)[33m.[39m[34mtoBe[39m([34m30[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m 93| [39m    })[33m;[39m
    [90m 94| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[136/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mPOST /api/auth/trust-device[2m > [22mshould update expiry if device already trusted
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m132:42[22m[39m
    [90m130| [39m
    [90m131| [39m      [90m// Should have extended expiry[39m
    [90m132| [39m      [34mexpect[39m(secondExpiry [33m>[39m firstExpiry)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m133| [39m
    [90m134| [39m      [90m// Should still only have 1 device record[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[137/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould list all trusted devices
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m193:31[22m[39m
    [90m191| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mmfaLoginResponse[33m.[39mbody[33m.[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m192| [39m
    [90m193| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m194| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mdevices)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m195| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mdevices[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m2[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[138/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould mark current device
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'find')[39m
[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m236:51[22m[39m
    [90m234| [39m        [33m.[39m[35mset[39m([32m"X-Forwarded-For"[39m[33m,[39m [32m"192.168.1.100"[39m)[33m;[39m
    [90m235| [39m
    [90m236| [39m      const currentDevice = response.body.devices.find((d: any) => d.c‚Ä¶
    [90m   | [39m                                                  [31m^[39m
    [90m237| [39m      [34mexpect[39m(currentDevice)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m238| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[139/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould exclude revoked devices
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m269:36[22m[39m
    [90m267| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mmfaLoginResponse[33m.[39mbody[33m.[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m268| [39m
    [90m269| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mdevices[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m270| [39m    })[33m;[39m
    [90m271| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[140/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDELETE /api/auth/trusted-devices/:deviceId[2m > [22mshould revoke specific device
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m332:45[22m[39m
    [90m330| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m331| [39m
    [90m332| [39m      [35mconst[39m deviceId [33m=[39m devicesResponse[33m.[39mbody[33m.[39mdevices[[34m0[39m][33m.[39mid[33m;[39m
    [90m   | [39m                                            [31m^[39m
    [90m333| [39m
    [90m334| [39m      [90m// Revoke device[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[141/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDELETE /api/auth/trusted-devices/:deviceId[2m > [22mshould prevent revoking other user's device
[31m[1mTypeError[22m: Cannot read properties of undefined (reading '0')[39m
[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m399:43[22m[39m
    [90m397| [39m        [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mmfaLogin1[33m.[39mbody[33m.[39mtoken[36m}[39m[32m`[39m)[33m;[39m
    [90m398| [39m
    [90m399| [39m      [35mconst[39m user1DeviceId [33m=[39m devices1[33m.[39mbody[33m.[39mdevices[[34m0[39m][33m.[39mid[33m;[39m
    [90m   | [39m                                          [31m^[39m
    [90m400| [39m
    [90m401| [39m      [90m// User 2 tries to revoke user 1's device[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[142/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDevice Trust with MFA Login[2m > [22mshould skip MFA for trusted device
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m453:42[22m[39m
    [90m451| [39m
    [90m452| [39m      [90m// Should not require MFA[39m
    [90m453| [39m      [34mexpect[39m(secondLoginResponse[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m454| [39m      [34mexpect[39m(secondLoginResponse[33m.[39mbody[33m.[39mrequiresMfa)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m
    [90m455| [39m      [34mexpect[39m(secondLoginResponse[33m.[39mbody[33m.[39mtoken)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[143/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDevice Trust with MFA Login[2m > [22mshould require MFA for untrusted device
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m485:51[22m[39m
    [90m483| [39m
    [90m484| [39m      [90m// Should require MFA[39m
    [90m485| [39m      [34mexpect[39m(loginFromNewDevice[33m.[39mbody[33m.[39mrequiresMfa)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                                  [31m^[39m
    [90m486| [39m    })[33m;[39m
    [90m487| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[144/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDevice Trust with MFA Login[2m > [22mshould update lastUsedAt on trusted device login
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'lastUsedAt')[39m
[36m [2m‚ùØ[22m tests/integration/trusted.devices.real.test.ts:[2m512:38[22m[39m
    [90m510| [39m      })[33m;[39m
    [90m511| [39m
    [90m512| [39m      [35mconst[39m firstLastUsed [33m=[39m device1[33m![39m[33m.[39mlastUsedAt[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m513| [39m
    [90m514| [39m      [90m// Wait a bit[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[145/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/workflow_versioning.test.ts[2m > [22mWorkflow Versioning & Lineage[2m > [22mshould create a version and populate changelog
[31m[1mError[22m: Validation failed: Schema Error: id - Required, Schema Error: title - Required, Schema Error: pages.0.title - Required, Schema Error: pages.0.order - Required[39m
[36m [2m‚ùØ[22m VersionService.publishVersion server/services/VersionService.ts:[2m287:13[22m[39m
    [90m285| [39m
    [90m286| [39m    [35mif[39m ([33m![39mvalidation[33m.[39mvalid [33m&&[39m [33m![39mforce) {
    [90m287| [39m      throw new Error(`Validation failed: ${validation.errors.join(', ‚Ä¶
    [90m   | [39m            [31m^[39m
    [90m288| [39m    }
    [90m289| [39m
[90m [2m‚ùØ[22m tests/integration/workflow_versioning.test.ts:[2m97:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[146/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/workflow_versioning.test.ts[2m > [22mWorkflow Versioning & Lineage[2m > [22mshould track execution lineage via snapshot
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/workflow_versioning.test.ts:[2m117:143[22m[39m
    [90m115| [39m
    [90m116| [39m        [90m// Create Snapshot[39m
    [90m117| [39m        const snapshot = await snapshotService.createSnapshot(workflow‚Ä¶
    [90m   | [39m                                                                                                                                              [31m^[39m
    [90m118| [39m
    [90m119| [39m        [34mexpect[39m(snapshot[33m.[39mworkflowVersionId)[33m.[39m[34mtoBeDefined[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[147/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould initialize with null validation result
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m36:26[22m[39m
    [90m 34| [39m  [34mdescribe[39m([32m'useExpressionValidation'[39m[33m,[39m () [33m=>[39m {
    [90m 35| [39m    [34mit[39m([32m'should initialize with null validation result'[39m[33m,[39m () [33m=>[39m {
    [90m 36| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m 37| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m 38| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[148/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould validate expression after debounce
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m54:26[22m[39m
    [90m 52| [39m      })[33m;[39m
    [90m 53| [39m
    [90m 54| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m 55| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m 56| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[149/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould return validation errors for invalid expression
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m93:26[22m[39m
    [90m 91| [39m      })[33m;[39m
    [90m 92| [39m
    [90m 93| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m 94| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m 95| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[150/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould debounce validation calls
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m120:26[22m[39m
    [90m118| [39m      })[33m;[39m
    [90m119| [39m
    [90m120| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m121| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m122| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[151/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould not validate when workflowId or nodeId is missing
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m143:26[22m[39m
    [90m141| [39m
    [90m142| [39m    it('should not validate when workflowId or nodeId is missing', asy‚Ä¶
    [90m143| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m144| [39m        () [33m=>[39m [34museExpressionValidation[39m(undefined[33m,[39m undefined[33m,[39m [34m100[39m)[33m,[39m
    [90m145| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[152/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression validation integration[2m > [22mshould validate helper functions in expressions
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m166:26[22m[39m
    [90m164| [39m      })[33m;[39m
    [90m165| [39m
    [90m166| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m167| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m168| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[153/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression validation integration[2m > [22mshould validate complex expressions with multiple helpers
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m189:26[22m[39m
    [90m187| [39m      })[33m;[39m
    [90m188| [39m
    [90m189| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m190| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m191| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[154/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression validation integration[2m > [22mshould handle syntax errors
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m221:26[22m[39m
    [90m219| [39m      })[33m;[39m
    [90m220| [39m
    [90m221| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m222| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m223| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[155/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression Editor component behavior[2m > [22mshould handle empty expressions
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m242:26[22m[39m
    [90m240| [39m  [34mdescribe[39m([32m'Expression Editor component behavior'[39m[33m,[39m () [33m=>[39m {
    [90m241| [39m    [34mit[39m([32m'should handle empty expressions'[39m[33m,[39m () [33m=>[39m {
    [90m242| [39m      [35mconst[39m { result } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                         [31m^[39m
    [90m243| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m244| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[156/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression Editor component behavior[2m > [22mshould update validation when expression changes
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[90m [2m‚ùØ[22m renderHook node_modules/@testing-library/react/dist/pure.js:[2m339:7[22m[39m
[36m [2m‚ùØ[22m tests/ui/expression-editor.test.tsx:[2m268:36[22m[39m
    [90m266| [39m        })[33m;[39m
    [90m267| [39m
    [90m268| [39m      [35mconst[39m { result[33m,[39m rerender } [33m=[39m [34mrenderHook[39m(
    [90m   | [39m                                   [31m^[39m
    [90m269| [39m        () [33m=>[39m [34museExpressionValidation[39m([32m'workflow-1'[39m[33m,[39m [32m'node-1'[39m[33m,[39m [34m100[39m)[33m,[39m
    [90m270| [39m        { wrapper[33m:[39m [34mcreateWrapper[39m() }

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[157/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould render runs table with correct columns
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m67:7[22m[39m
    [90m 65| [39m
    [90m 66| [39m    [34mit[39m([32m'should render runs table with correct columns'[39m[33m,[39m () [33m=>[39m {
    [90m 67| [39m      [34mrender[39m([33m<[39m[33mRunsTable[39m [33mruns[39m[33m=[39m[33m{[39mmockRuns[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 68| [39m
    [90m 69| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Status'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[158/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould render run data correctly
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m79:7[22m[39m
    [90m 77| [39m
    [90m 78| [39m    [34mit[39m([32m'should render run data correctly'[39m[33m,[39m () [33m=>[39m {
    [90m 79| [39m      [34mrender[39m([33m<[39m[33mRunsTable[39m [33mruns[39m[33m=[39m[33m{[39mmockRuns[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 80| [39m
    [90m 81| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Test Workflow'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[159/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould show success badge for successful runs
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m87:7[22m[39m
    [90m 85| [39m
    [90m 86| [39m    [34mit[39m([32m'should show success badge for successful runs'[39m[33m,[39m () [33m=>[39m {
    [90m 87| [39m      [34mrender[39m([33m<[39m[33mRunsTable[39m [33mruns[39m[33m=[39m[33m{[39mmockRuns[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 88| [39m
    [90m 89| [39m      [35mconst[39m successBadge [33m=[39m screen[33m.[39m[34mgetByText[39m([32m'Success'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[160/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould show error badge for failed runs
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m95:7[22m[39m
    [90m 93| [39m
    [90m 94| [39m    [34mit[39m([32m'should show error badge for failed runs'[39m[33m,[39m () [33m=>[39m {
    [90m 95| [39m      [34mrender[39m([33m<[39m[33mRunsTable[39m [33mruns[39m[33m=[39m[33m{[39mmockRuns[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 96| [39m
    [90m 97| [39m      [35mconst[39m errorBadge [33m=[39m screen[33m.[39m[34mgetByText[39m([32m'Error'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[161/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould format duration correctly
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m102:7[22m[39m
    [90m100| [39m
    [90m101| [39m    [34mit[39m([32m'should format duration correctly'[39m[33m,[39m () [33m=>[39m {
    [90m102| [39m      [34mrender[39m([33m<[39m[33mRunsTable[39m [33mruns[39m[33m=[39m[33m{[39mmockRuns[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m103| [39m
    [90m104| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'1.5s'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[162/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould show download options for successful runs
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m109:7[22m[39m
    [90m107| [39m
    [90m108| [39m    [34mit[39m([32m'should show download options for successful runs'[39m[33m,[39m () [33m=>[39m {
    [90m109| [39m      [34mrender[39m([33m<[39m[33mRunsTable[39m [33mruns[39m[33m=[39m[33m{[39mmockRuns[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m110| [39m
    [90m111| [39m      const successRunActions = screen.getAllByRole('button')[0]; // F‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[163/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould render all filter controls
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m126:7[22m[39m
    [90m124| [39m
    [90m125| [39m    [34mit[39m([32m'should render all filter controls'[39m[33m,[39m () [33m=>[39m {
    [90m126| [39m      render(<RunFilters filters={initialFilters} onChange={mockOnChan‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m127| [39m
    [90m128| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByLabelText[39m([32m'Status'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[164/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould call onChange when status filter changes
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m135:7[22m[39m
    [90m133| [39m
    [90m134| [39m    [34mit[39m([32m'should call onChange when status filter changes'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m135| [39m      render(<RunFilters filters={initialFilters} onChange={mockOnChan‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m136| [39m
    [90m137| [39m      [35mconst[39m statusSelect [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'Status'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[165/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould call onChange when search is submitted
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m154:7[22m[39m
    [90m152| [39m
    [90m153| [39m    [34mit[39m([32m'should call onChange when search is submitted'[39m[33m,[39m () [33m=>[39m {
    [90m154| [39m      render(<RunFilters filters={initialFilters} onChange={mockOnChan‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m155| [39m
    [90m156| [39m      const searchInput = screen.getByPlaceholderText(/Search by run I‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[166/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould show clear filters button when filters are active
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m177:7[22m[39m
    [90m175| [39m      }[33m;[39m
    [90m176| [39m
    [90m177| [39m      render(<RunFilters filters={activeFilters} onChange={mockOnChang‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m178| [39m
    [90m179| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Clear Filters'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[167/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould clear all filters when clear button is clicked
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m190:7[22m[39m
    [90m188| [39m      }[33m;[39m
    [90m189| [39m
    [90m190| [39m      render(<RunFilters filters={activeFilters} onChange={mockOnChang‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m191| [39m
    [90m192| [39m      [35mconst[39m clearButton [33m=[39m screen[33m.[39m[34mgetByText[39m([32m'Clear Filters'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[168/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould render all trace entries
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m235:7[22m[39m
    [90m233| [39m
    [90m234| [39m    [34mit[39m([32m'should render all trace entries'[39m[33m,[39m () [33m=>[39m {
    [90m235| [39m      [34mrender[39m([33m<[39m[33mTracePanel[39m [33mtrace[39m[33m=[39m[33m{[39mmockTrace[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m236| [39m
    [90m237| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'node-1'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[169/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould show executed badge for executed nodes
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m244:7[22m[39m
    [90m242| [39m
    [90m243| [39m    [34mit[39m([32m'should show executed badge for executed nodes'[39m[33m,[39m () [33m=>[39m {
    [90m244| [39m      [34mrender[39m([33m<[39m[33mTracePanel[39m [33mtrace[39m[33m=[39m[33m{[39mmockTrace[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m245| [39m
    [90m246| [39m      [35mconst[39m executedBadges [33m=[39m screen[33m.[39m[34mgetAllByText[39m([32m'Executed'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[170/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould show skipped badge for skipped nodes
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m251:7[22m[39m
    [90m249| [39m
    [90m250| [39m    [34mit[39m([32m'should show skipped badge for skipped nodes'[39m[33m,[39m () [33m=>[39m {
    [90m251| [39m      [34mrender[39m([33m<[39m[33mTracePanel[39m [33mtrace[39m[33m=[39m[33m{[39mmockTrace[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m252| [39m
    [90m253| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Skipped'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[171/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould display conditions and their results
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m257:7[22m[39m
    [90m255| [39m
    [90m256| [39m    [34mit[39m([32m'should display conditions and their results'[39m[33m,[39m () [33m=>[39m {
    [90m257| [39m      [34mrender[39m([33m<[39m[33mTracePanel[39m [33mtrace[39m[33m=[39m[33m{[39mmockTrace[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m258| [39m
    [90m259| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'age > 18'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[172/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould display error messages
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m267:7[22m[39m
    [90m265| [39m
    [90m266| [39m    [34mit[39m([32m'should display error messages'[39m[33m,[39m () [33m=>[39m {
    [90m267| [39m      [34mrender[39m([33m<[39m[33mTracePanel[39m [33mtrace[39m[33m=[39m[33m{[39mmockTrace[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m268| [39m
    [90m269| [39m      expect(screen.getByText('Failed to generate document')).toBeInTh‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[173/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould toggle show skipped nodes
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m273:7[22m[39m
    [90m271| [39m
    [90m272| [39m    [34mit[39m([32m'should toggle show skipped nodes'[39m[33m,[39m () [33m=>[39m {
    [90m273| [39m      [34mrender[39m([33m<[39m[33mTracePanel[39m [33mtrace[39m[33m=[39m[33m{[39mmockTrace[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m274| [39m
    [90m275| [39m      const showSkippedSwitch = screen.getByLabelText('Show skipped no‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[174/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould expand outputs delta when clicked
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m289:7[22m[39m
    [90m287| [39m
    [90m288| [39m    [34mit[39m([32m'should expand outputs delta when clicked'[39m[33m,[39m () [33m=>[39m {
    [90m289| [39m      [34mrender[39m([33m<[39m[33mTracePanel[39m [33mtrace[39m[33m=[39m[33m{[39mmockTrace[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m290| [39m
    [90m291| [39m      const showOutputsButton = screen.getAllByText(/Show.*Outputs/)[0‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[175/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould copy trace as JSON
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/runs.components.test.tsx:[2m308:7[22m[39m
    [90m306| [39m      })[33m;[39m
    [90m307| [39m
    [90m308| [39m      [34mrender[39m([33m<[39m[33mTracePanel[39m [33mtrace[39m[33m=[39m[33m{[39mmockTrace[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m309| [39m
    [90m310| [39m      [35mconst[39m copyButton [33m=[39m screen[33m.[39m[34mgetByText[39m([32m'Copy Trace JSON'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[176/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould generate a valid workflow from description
[31m[1mError[22m: AI response does not match expected schema

üîß Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details[39m
[36m [2m‚ùØ[22m AIService.createError server/services/AIService.ts:[2m1059:19[22m[39m
    [90m1057| [39m    const fullMessage = troubleshootingHints ? `${message}\n\n${troubl‚Ä¶
    [90m1058| [39m
    [90m1059| [39m    [35mconst[39m error [33m=[39m [35mnew[39m [33mError[39m(fullMessage) [35mas[39m any[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m1060| [39m    error[33m.[39mcode [33m=[39m code[33m;[39m
    [90m1061| [39m    error[33m.[39mdetails [33m=[39m details[33m;[39m
[90m [2m‚ùØ[22m AIService.generateWorkflow server/services/AIService.ts:[2m127:20[22m[39m
[90m [2m‚ùØ[22m tests/unit/ai.service.test.ts:[2m86:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[177/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould validate unique section IDs
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Duplicate section IDs' but got 'AI response does not match expected s‚Ä¶'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [7mDuplicate section ID[27ms[39m
[31m+ AI response does not match expected schema[39m
[31m+[39m
[31m+ üîß Troubleshooting Steps:[39m
[31m+ 1. The AI response structure doesn't match our expected format[39m
[31m+ 2. This may indicate:[39m
[31m+    - A breaking change in the AI model behavior[39m
[31m+    - The model is struggling with the complexity of the request[39m
[31m+ 3. Try simplifying your workflow or request[39m
[31m+ [7m4. If this persists, please report this issue with the workflow detail[27ms[39m

[36m [2m‚ùØ[22m tests/unit/ai.service.test.ts:[2m136:7[22m[39m
    [90m134| [39m      } [35mas[39m any[33m;[39m
    [90m135| [39m
    [90m136| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m137| [39m        openaiService[33m.[39m[34mgenerateWorkflow[39m({
    [90m138| [39m          description[33m:[39m [32m'Test'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[178/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould validate unique step IDs
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Duplicate step ID' but got 'AI response does not match expected s‚Ä¶'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Duplicate step ID[39m
[31m+ AI response does not match expected schema[39m
[31m+[39m
[31m+ üîß Troubleshooting Steps:[39m
[31m+ 1. The AI response structure doesn't match our expected format[39m
[31m+ 2. This may indicate:[39m
[31m+    - A breaking change in the AI model behavior[39m
[31m+    - The model is struggling with the complexity of the request[39m
[31m+ 3. Try simplifying your workflow or request[39m
[31m+ 4. If this persists, please report this issue with the workflow details[39m

[36m [2m‚ùØ[22m tests/unit/ai.service.test.ts:[2m190:7[22m[39m
    [90m188| [39m      } [35mas[39m any[33m;[39m
    [90m189| [39m
    [90m190| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m191| [39m        openaiService[33m.[39m[34mgenerateWorkflow[39m({
    [90m192| [39m          description[33m:[39m [32m'Test'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[179/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould validate logic rules reference existing steps
[31m[1mAssertionError[22m: expected [Function] to throw error including 'references non-existent step alias' but got 'AI response does not match expected s‚Ä¶'[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [7mreferences non-existent step alia[27ms[39m
[31m+ AI response does not match expected schema[39m
[31m+[39m
[31m+ üîß Troubleshooting Steps:[39m
[31m+ 1. The AI response structure doesn't match our expected format[39m
[31m+ 2. This may indicate:[39m
[31m+    - A breaking change in the AI model behavior[39m
[31m+    - The model is struggling with the complexity of the request[39m
[31m+ 3. Try simplifying your workflow or request[39m
[31m+ [7m4. If this persists, please report this issue with the workflow detail[27ms[39m

[36m [2m‚ùØ[22m tests/unit/ai.service.test.ts:[2m248:7[22m[39m
    [90m246| [39m      } [35mas[39m any[33m;[39m
    [90m247| [39m
    [90m248| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m249| [39m        openaiService[33m.[39m[34mgenerateWorkflow[39m({
    [90m250| [39m          description[33m:[39m [32m'Test'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[180/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould handle rate limit errors
[31m[1mError[22m: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2m‚ùØ[22m tests/unit/ai.service.test.ts:[2m256:5[22m[39m
    [90m254| [39m    })[33m;[39m
    [90m255| [39m
    [90m256| [39m    [34mit[39m([32m'should handle rate limit errors'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m257| [39m      [35mconst[39m rateLimitError [33m=[39m [35mnew[39m [33mError[39m([32m'Rate limit exceeded'[39m)[33m;[39m
    [90m258| [39m      [90m// @ts-ignore[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[181/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mAnthropic Provider[2m > [22mshould generate a valid workflow from description
[31m[1mError[22m: AI response does not match expected schema

üîß Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details[39m
[36m [2m‚ùØ[22m AIService.createError server/services/AIService.ts:[2m1059:19[22m[39m
    [90m1057| [39m    const fullMessage = troubleshootingHints ? `${message}\n\n${troubl‚Ä¶
    [90m1058| [39m
    [90m1059| [39m    [35mconst[39m error [33m=[39m [35mnew[39m [33mError[39m(fullMessage) [35mas[39m any[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m1060| [39m    error[33m.[39mcode [33m=[39m code[33m;[39m
    [90m1061| [39m    error[33m.[39mdetails [33m=[39m details[33m;[39m
[90m [2m‚ùØ[22m AIService.generateWorkflow server/services/AIService.ts:[2m127:20[22m[39m
[90m [2m‚ùØ[22m tests/unit/ai.service.test.ts:[2m369:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[182/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mAnthropic Provider[2m > [22mshould strip markdown code blocks from Anthropic responses
[31m[1mError[22m: AI response does not match expected schema

üîß Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details[39m
[36m [2m‚ùØ[22m AIService.createError server/services/AIService.ts:[2m1059:19[22m[39m
    [90m1057| [39m    const fullMessage = troubleshootingHints ? `${message}\n\n${troubl‚Ä¶
    [90m1058| [39m
    [90m1059| [39m    [35mconst[39m error [33m=[39m [35mnew[39m [33mError[39m(fullMessage) [35mas[39m any[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m1060| [39m    error[33m.[39mcode [33m=[39m code[33m;[39m
    [90m1061| [39m    error[33m.[39mdetails [33m=[39m details[33m;[39m
[90m [2m‚ùØ[22m AIService.generateWorkflow server/services/AIService.ts:[2m127:20[22m[39m
[90m [2m‚ùØ[22m tests/unit/ai.service.test.ts:[2m409:22[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[183/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/api.ai.logic.test.ts[2m > [22mAI Logic Routes[2m > [22mPOST /api/ai/workflows/generate-logic[2m > [22mshould return generated logic
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2m‚ùØ[22m tests/unit/api.ai.logic.test.ts:[2m89:32[22m[39m
    [90m 87| [39m                if (!res.body || Object.keys(res.body).length === 0) c‚Ä¶
    [90m 88| [39m            }
    [90m 89| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 90| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 91| [39m            [34mexpect[39m(mockGenerateLogic)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[184/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/api.ai.logic.test.ts[2m > [22mAI Logic Routes[2m > [22mPOST /api/ai/workflows/debug-logic[2m > [22mshould return debug issues
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2m‚ùØ[22m tests/unit/api.ai.logic.test.ts:[2m110:32[22m[39m
    [90m108| [39m                })[33m;[39m
    [90m109| [39m
    [90m110| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m111| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m112| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39missues)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[185/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/api.ai.logic.test.ts[2m > [22mAI Logic Routes[2m > [22mPOST /api/ai/workflows/visualize-logic[2m > [22mshould return graph data
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2m‚ùØ[22m tests/unit/api.ai.logic.test.ts:[2m129:32[22m[39m
    [90m127| [39m                })[33m;[39m
    [90m128| [39m
    [90m129| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m130| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39mgraph[33m.[39mnodes)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m131| [39m        })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[186/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/api.ai.revise.test.ts[2m > [22mAI Routes Integration[2m > [22mPOST /api/ai/workflows/revise[2m > [22mshould call AIService.reviseWorkflow with correct parameters
[31m[1mAssertionError[22m: expected 400 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 400[39m

[36m [2m‚ùØ[22m tests/unit/api.ai.revise.test.ts:[2m89:32[22m[39m
    [90m 87| [39m                if (!res.body || Object.keys(res.body).length === 0) c‚Ä¶
    [90m 88| [39m            }
    [90m 89| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 90| [39m            [34mexpect[39m(mockReviseWorkflow)[33m.[39m[34mtoHaveBeenCalledTimes[39m([34m1[39m)[33m;[39m
    [90m 91| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[187/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/isolatedVmBridge.test.ts[2m > [22misolated-vm Bridge Verification[2m > [22mshould execute JS and capture console logs
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m‚ùØ[22m tests/unit/isolatedVmBridge.test.ts:[2m86:36[22m[39m
    [90m 84| [39m
    [90m 85| [39m        [34mexpect[39m(result[33m.[39mok)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 86| [39m        [34mexpect[39m(result[33m.[39mconsoleLogs)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 87| [39m        [90m// @ts-ignore[39m
    [90m 88| [39m        [34mexpect[39m(result[33m.[39mconsoleLogs[[34m0[39m])[33m.[39m[34mtoEqual[39m([[32m"hello log"[39m])[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[188/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould allow access with valid JWT Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould return 401 with invalid token
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould return 401 with expired token
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould extract token without Bearer prefix
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalAuth Middleware[2m > [22mshould proceed without authentication if no token provided
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould authenticate with JWT Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould authenticate with refresh token cookie (GET only)
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould reject cookie auth for POST requests (mutation-strict)
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould reject cookie auth for DELETE requests
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould allow cookie auth for HEAD requests
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould prioritize JWT over cookie when both present
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould return 401 when no auth provided
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould return 401 when both JWT and cookie are invalid
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mCookie Strategy Security[2m > [22mshould ignore cookies when Bearer token present
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mCookie Strategy Security[2m > [22mshould validate refresh token from cookie
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mUser Context Attachment[2m > [22mshould attach userEmail to request
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mUser Context Attachment[2m > [22mshould attach tenantId to request
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mUser Context Attachment[2m > [22mshould attach userRole to request
[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould return consistent error format for missing token
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m70:14[22m[39m
    [90m 68| [39m                password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m 69| [39m            })
    [90m 70| [39m            [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m             [31m^[39m
    [90m 71| [39m
    [90m 72| [39m        userToken [33m=[39m loginRes[33m.[39mbody[33m.[39mtoken[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[189/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould return 401 when no token provided
[31m[1mAssertionError[22m: expected { code: 'AUTH_008', ‚Ä¶(3) } to be 'missing_token' // Object.is equality[39m

[32m- Expected:[39m 
"missing_token"

[31m+ Received:[39m 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T15:45:06.519Z",
}

[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m91:36[22m[39m
    [90m 89| [39m                [33m.[39m[34mexpect[39m([34m401[39m)[33m;[39m
    [90m 90| [39m
    [90m 91| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39merror)[33m.[39m[34mtoBe[39m([32m"missing_token"[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 92| [39m        })[33m;[39m
    [90m 93| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[190/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalAuth Middleware[2m > [22mshould attach user context if valid token provided
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m170:18[22m[39m
    [90m168| [39m                [33m.[39m[35mget[39m([32m`/api/workflows/[39m[36m${[39mworkflowRes[33m.[39mbody[33m.[39mid[36m}[39m[32m/public`[39m)
    [90m169| [39m                [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)
    [90m170| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m171| [39m
    [90m172| [39m            [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[191/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalAuth Middleware[2m > [22mshould proceed without auth if invalid token provided
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m189:18[22m[39m
    [90m187| [39m                [33m.[39m[35mget[39m([32m`/api/workflows/[39m[36m${[39mworkflowRes[33m.[39mbody[33m.[39mid[36m}[39m[32m/public`[39m)
    [90m188| [39m                [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m"Bearer invalid-token"[39m)
    [90m189| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m190| [39m        })[33m;[39m
    [90m191| [39m    })[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[192/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalHybridAuth Middleware[2m > [22mshould authenticate with JWT if provided
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m312:18[22m[39m
    [90m310| [39m                [33m.[39m[35mget[39m([32m`/api/workflows/[39m[36m${[39mworkflowRes[33m.[39mbody[33m.[39mid[36m}[39m[32m/public`[39m)
    [90m311| [39m                [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)
    [90m312| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m313| [39m        })[33m;[39m
    [90m314| [39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[193/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalHybridAuth Middleware[2m > [22mshould authenticate with cookie if JWT not provided
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m328:18[22m[39m
    [90m326| [39m                [33m.[39m[35mget[39m([32m`/api/workflows/[39m[36m${[39mworkflowRes[33m.[39mbody[33m.[39mid[36m}[39m[32m/public`[39m)
    [90m327| [39m                [33m.[39m[35mset[39m([32m"Cookie"[39m[33m,[39m refreshCookie)
    [90m328| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m329| [39m        })[33m;[39m
    [90m330| [39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[194/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalHybridAuth Middleware[2m > [22mshould proceed anonymously if no auth provided
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m343:18[22m[39m
    [90m341| [39m            [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
    [90m342| [39m                [33m.[39m[35mget[39m([32m`/api/workflows/[39m[36m${[39mworkflowRes[33m.[39mbody[33m.[39mid[36m}[39m[32m/public`[39m)
    [90m343| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m344| [39m        })[33m;[39m
    [90m345| [39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[195/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalHybridAuth Middleware[2m > [22mshould proceed anonymously if both JWT and cookie are invalid
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m360:18[22m[39m
    [90m358| [39m                [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m"Bearer invalid-token"[39m)
    [90m359| [39m                [33m.[39m[35mset[39m([32m"Cookie"[39m[33m,[39m [[32m"refresh_token=invalid-cookie"[39m])
    [90m360| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m361| [39m        })[33m;[39m
    [90m362| [39m    })[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[196/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould return consistent error format for invalid token
[31m[1mAssertionError[22m: expected { success: false, error: { ‚Ä¶(4) } } to have property "message"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m535:30[22m[39m
    [90m533| [39m                [33m.[39m[34mexpect[39m([34m401[39m)[33m;[39m
    [90m534| [39m
    [90m535| [39m            [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"message"[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m536| [39m            [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"error"[39m)[33m;[39m
    [90m537| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39merror)[33m.[39m[34mtoBe[39m([32m"invalid_token"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[197/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould return consistent error format for expired token
[31m[1mAssertionError[22m: expected { success: false, error: { ‚Ä¶(4) } } to have property "message"[39m
[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m560:30[22m[39m
    [90m558| [39m                [33m.[39m[34mexpect[39m([34m401[39m)[33m;[39m
    [90m559| [39m
    [90m560| [39m            [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"message"[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m561| [39m            [34mexpect[39m(res[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"error"[39m)[33m;[39m
    [90m562| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39merror)[33m.[39m[34mtoBe[39m([32m"token_expired"[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[198/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould handle JWT with wrong algorithm
[31m[1mAssertionError[22m: expected { code: 'AUTH_008', ‚Ä¶(3) } to be 'invalid_token' // Object.is equality[39m

[32m- Expected:[39m 
"invalid_token"

[31m+ Received:[39m 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T15:45:44.236Z",
}

[36m [2m‚ùØ[22m tests/integration/auth/auth.middleware.integration.test.ts:[2m592:36[22m[39m
    [90m590| [39m                [33m.[39m[34mexpect[39m([34m401[39m)[33m;[39m
    [90m591| [39m
    [90m592| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39merror)[33m.[39m[34mtoBe[39m([32m"invalid_token"[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m593| [39m        })[33m;[39m
    [90m594| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[199/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Generation[2m > [22mshould generate valid JWT token on successful login
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m54:18[22m[39m
    [90m 52| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m 53| [39m                [33m.[39m[34msend[39m(testUser)
    [90m 54| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 55| [39m
    [90m 56| [39m            [90m// Verify email[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[200/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Generation[2m > [22mshould include correct payload in JWT token
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m90:18[22m[39m
    [90m 88| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m 89| [39m                [33m.[39m[34msend[39m(testUser)
    [90m 90| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 91| [39m
    [90m 92| [39m            [35mawait[39m db[33m.[39m[34mupdate[39m(db[33m.[39mquery[33m.[39musers [35mas[39m any)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[201/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Generation[2m > [22mshould set JWT expiry to 15 minutes
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m122:18[22m[39m
    [90m120| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m121| [39m                [33m.[39m[34msend[39m(testUser)
    [90m122| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m123| [39m
    [90m124| [39m            [35mawait[39m db[33m.[39m[34mupdate[39m(db[33m.[39mquery[33m.[39musers [35mas[39m any)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[202/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Validation[2m > [22mshould accept valid JWT token on protected routes
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m153:18[22m[39m
    [90m151| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m152| [39m                })
    [90m153| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m154| [39m
    [90m155| [39m            [35mconst[39m meRes [33m=[39m [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[203/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Validation[2m > [22mshould reject request with missing Bearer prefix
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m183:18[22m[39m
    [90m181| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m182| [39m                })
    [90m183| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m184| [39m
    [90m185| [39m            [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[204/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Expiration[2m > [22mshould return token_expired error code for expired tokens
[31m[1mAssertionError[22m: expected { code: 'AUTH_008', ‚Ä¶(3) } to be 'token_expired' // Object.is equality[39m

[32m- Expected:[39m 
"token_expired"

[31m+ Received:[39m 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T15:45:20.886Z",
}

[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m237:36[22m[39m
    [90m235| [39m                [33m.[39m[34mexpect[39m([34m401[39m)[33m;[39m
    [90m236| [39m
    [90m237| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39merror)[33m.[39m[34mtoBe[39m([32m"token_expired"[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m238| [39m        })[33m;[39m
    [90m239| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[205/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mBearer Token Authentication[2m > [22mshould work with Bearer token on PUT requests
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m268:18[22m[39m
    [90m266| [39m                [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mctx[33m.[39mauthToken[36m}[39m[32m`[39m)
    [90m267| [39m                [33m.[39m[34msend[39m({ firstName[33m:[39m [32m"Updated"[39m })
    [90m268| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m269| [39m
    [90m270| [39m            [34mexpect[39m(updateRes[33m.[39mbody)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[206/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mBearer Token Authentication[2m > [22mshould work with Bearer token on DELETE requests
[31m[1mError[22m: expected 200 "OK", got 204 "No Content"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m285:18[22m[39m
    [90m283| [39m                [33m.[39m[35mdelete[39m([32m`/api/projects/[39m[36m${[39mprojectRes[33m.[39mbody[33m.[39mid[36m}[39m[32m`[39m)
    [90m284| [39m                [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39mctx[33m.[39mauthToken[36m}[39m[32m`[39m)
    [90m285| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m286| [39m        })[33m;[39m
    [90m287| [39m    })[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m847:12[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[207/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mCookie-to-Token Exchange[2m > [22mshould exchange valid session cookie for JWT token
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m295:18[22m[39m
    [90m293| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m294| [39m                [33m.[39m[34msend[39m(testUser)
    [90m295| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m296| [39m
    [90m297| [39m            [35mconst[39m cookies [33m=[39m registerRes[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[208/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mHybrid Authentication Strategy[2m > [22mshould prefer Bearer token over cookie when both present
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m330:18[22m[39m
    [90m328| [39m                    email[33m:[39m [32m`user1-[39m[36m${[39m[34mnanoid[39m()[36m}[39m[32m@example.com`[39m[33m,[39m
    [90m329| [39m                })
    [90m330| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m331| [39m
    [90m332| [39m            [35mconst[39m user2Res [33m=[39m [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[209/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mHybrid Authentication Strategy[2m > [22mshould fall back to cookie if Bearer token is invalid
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m358:18[22m[39m
    [90m356| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m357| [39m                [33m.[39m[34msend[39m(testUser)
    [90m358| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m359| [39m
    [90m360| [39m            [35mconst[39m cookies [33m=[39m registerRes[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[210/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mHybrid Authentication Strategy[2m > [22mshould allow GET requests with cookie auth only
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m377:18[22m[39m
    [90m375| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m376| [39m                [33m.[39m[34msend[39m(testUser)
    [90m377| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m378| [39m
    [90m379| [39m            [35mawait[39m db[33m.[39m[34mupdate[39m(db[33m.[39mquery[33m.[39musers [35mas[39m any)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[211/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mHybrid Authentication Strategy[2m > [22mshould reject POST requests with cookie auth only (mutation-strict)
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m406:18[22m[39m
    [90m404| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m405| [39m                [33m.[39m[34msend[39m(testUser)
    [90m406| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m407| [39m
    [90m408| [39m            [35mconst[39m cookies [33m=[39m registerRes[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[212/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mOptional Authentication[2m > [22mshould allow anonymous access to public workflows
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m432:18[22m[39m
    [90m430| [39m                    publicLink[33m:[39m [32m`public-[39m[36m${[39m[34mnanoid[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m431| [39m                })
    [90m432| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m433| [39m
    [90m434| [39m            [90m// Access without authentication[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[213/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mOptional Authentication[2m > [22mshould attach user info if authenticated on optional auth routes
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m451:18[22m[39m
    [90m449| [39m                    publicLink[33m:[39m [32m`optional-[39m[36m${[39m[34mnanoid[39m()[36m}[39m[32m`[39m[33m,[39m
    [90m450| [39m                })
    [90m451| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m452| [39m
    [90m453| [39m            [90m// Access with authentication[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[214/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mToken Refresh Flow[2m > [22mshould refresh access token using refresh token
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m469:18[22m[39m
    [90m467| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m468| [39m                [33m.[39m[34msend[39m(testUser)
    [90m469| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m470| [39m
    [90m471| [39m            [35mawait[39m db[33m.[39m[34mupdate[39m(db[33m.[39mquery[33m.[39musers [35mas[39m any)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[215/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mToken Refresh Flow[2m > [22mshould rotate refresh token on use
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m503:18[22m[39m
    [90m501| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m502| [39m                [33m.[39m[34msend[39m(testUser)
    [90m503| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m504| [39m
    [90m505| [39m            [35mawait[39m db[33m.[39m[34mupdate[39m(db[33m.[39mquery[33m.[39musers [35mas[39m any)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[216/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mToken Refresh Flow[2m > [22mshould detect token reuse and revoke all user tokens
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m544:18[22m[39m
    [90m542| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m543| [39m                [33m.[39m[34msend[39m(testUser)
    [90m544| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m545| [39m
    [90m546| [39m            [35mawait[39m db[33m.[39m[34mupdate[39m(db[33m.[39mquery[33m.[39musers [35mas[39m any)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[217/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mLogout Flow[2m > [22mshould revoke refresh token on logout
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m595:18[22m[39m
    [90m593| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m594| [39m                [33m.[39m[34msend[39m(testUser)
    [90m595| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m596| [39m
    [90m597| [39m            [35mawait[39m db[33m.[39m[34mupdate[39m(db[33m.[39mquery[33m.[39musers [35mas[39m any)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[218/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mLogout Flow[2m > [22mshould clear refresh token cookie on logout
[31m[1mError[22m: expected 201 "Created", got 400 "Bad Request"[39m
[36m [2m‚ùØ[22m tests/integration/auth/jwt.authentication.test.ts:[2m628:18[22m[39m
    [90m626| [39m                [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m627| [39m                [33m.[39m[34msend[39m(testUser)
    [90m628| [39m                [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m629| [39m
    [90m630| [39m            [35mawait[39m db[33m.[39m[34mupdate[39m(db[33m.[39mquery[33m.[39musers [35mas[39m any)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[219/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mGET /api/auth/sessions - List Active Sessions[2m > [22mshould mark current session as current
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m119:30[22m[39m
    [90m117| [39m
    [90m118| [39m      const currentSession = response.body.sessions.find((s: any) => s‚Ä¶
    [90m119| [39m      [34mexpect[39m(currentSession)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m120| [39m    })[33m;[39m
    [90m121| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[220/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/:sessionId - Revoke Session[2m > [22mshould revoke a specific session
[31m[1mAssertionError[22m: expected undefined to be defined[39m
[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m210:29[22m[39m
    [90m208| [39m      })[33m;[39m
    [90m209| [39m
    [90m210| [39m      [34mexpect[39m(sessionRecord)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m211| [39m
    [90m212| [39m      [35mconst[39m response [33m=[39m [35mawait[39m [34mrequest[39m(app)

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[221/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/:sessionId - Revoke Session[2m > [22mshould prevent revoking current session
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m243:54[22m[39m
    [90m241| [39m
    [90m242| [39m      [35mconst[39m response [33m=[39m [35mawait[39m [34mrequest[39m(app)
    [90m243| [39m        [33m.[39m[35mdelete[39m([32m`/api/auth/sessions/[39m[36m${[39msessionRecord[33m![39m[33m.[39mid[36m}[39m[32m`[39m)
    [90m   | [39m                                                     [31m^[39m
    [90m244| [39m        [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39mauthToken[36m}[39m[32m`[39m)
    [90m245| [39m        [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m [32m`refresh_token=[39m[36m${[39mtoken[36m}[39m[32m`[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[222/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/:sessionId - Revoke Session[2m > [22mshould prevent revoking another user's session
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m275:53[22m[39m
    [90m273| [39m      [90m// Try to revoke other user's session[39m
    [90m274| [39m      [35mconst[39m response [33m=[39m [35mawait[39m [34mrequest[39m(app)
    [90m275| [39m        [33m.[39m[35mdelete[39m([32m`/api/auth/sessions/[39m[36m${[39motherSession[33m![39m[33m.[39mid[36m}[39m[32m`[39m)
    [90m   | [39m                                                    [31m^[39m
    [90m276| [39m        [33m.[39m[35mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer [39m[36m${[39mauthToken[36m}[39m[32m`[39m)[33m;[39m
    [90m277| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[223/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/all - Logout All Other Devices[2m > [22mshould revoke all sessions except current
[31m[1mAssertionError[22m: expected +0 to be 1 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m316:37[22m[39m
    [90m314| [39m        ))[33m;[39m
    [90m315| [39m
    [90m316| [39m      [34mexpect[39m(activeSessions[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m317| [39m      [34mexpect[39m(activeSessions[[34m0[39m][33m.[39mtoken)[33m.[39m[34mtoBe[39m(currentToken)[33m;[39m
    [90m318| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[224/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mTrusted Devices Management[2m > [22mDELETE /api/auth/trusted-devices/:deviceId[2m > [22mshould revoke a trusted device
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m512:40[22m[39m
    [90m510| [39m          where[33m:[39m [34meq[39m(trustedDevices[33m.[39mid[33m,[39m device[33m.[39mid)[33m,[39m
    [90m511| [39m        })[33m;[39m
    [90m512| [39m        [34mexpect[39m(updatedDevice[33m?.[39mrevoked)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                       [31m^[39m
    [90m513| [39m      })[33m;[39m
    [90m514| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[225/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mSession Metadata Tracking[2m > [22mshould track IP address for sessions
[31m[1mAssertionError[22m: expected undefined to be '192.168.1.100' // Object.is equality[39m

[32m- Expected:[39m 
"192.168.1.100"

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m535:34[22m[39m
    [90m533| [39m      })[33m;[39m
    [90m534| [39m
    [90m535| [39m      [34mexpect[39m(session[33m?.[39mipAddress)[33m.[39m[34mtoBe[39m([32m'192.168.1.100'[39m)[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m536| [39m    })[33m;[39m
    [90m537| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[226/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mSession Metadata Tracking[2m > [22mshould track user agent for sessions
[31m[1mAssertionError[22m: expected undefined to be 'Mozilla/5.0 (Windows NT 10.0; Win64; ‚Ä¶' // Object.is equality[39m

[32m- Expected:[39m 
"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.sessions.test.ts:[2m549:35[22m[39m
    [90m547| [39m
    [90m548| [39m      [35mconst[39m metadata [33m=[39m session[33m?.[39mmetadata [35mas[39m any[33m;[39m
    [90m549| [39m      [34mexpect[39m(metadata[33m?.[39muserAgent)[33m.[39m[34mtoBe[39m(userAgent)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m550| [39m    })[33m;[39m
    [90m551| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[227/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould refresh access token with valid refresh token
[31m[1mAssertionError[22m: expected { ‚Ä¶(2) } to match object { token: Any<String>, user: { ‚Ä¶(3) } }
(1 matching property omitted from actual)[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[2m    "token": Any<String>,[22m
[2m    "user": {[22m
[2m      "email": "refresh-test-Jf29g17fRALNczlYZRrmv@example.com",[22m
[2m      "id": "oU-t1HVwBq7CID_ejP6EG",[22m
[32m-     "role": "owner",[39m
[31m+     "role": "creator",[39m
[2m    },[22m
[2m  }[22m

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m88:29[22m[39m
    [90m 86| [39m
    [90m 87| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 88| [39m      [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoMatchObject[39m({
    [90m   | [39m                            [31m^[39m
    [90m 89| [39m        token[33m:[39m expect[33m.[39m[34many[39m([33mString[39m)[33m,[39m
    [90m 90| [39m        user[33m:[39m {

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[228/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould rotate refresh token after use
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m126:33[22m[39m
    [90m124| [39m        where[33m:[39m [34meq[39m(refreshTokens[33m.[39mtoken[33m,[39m testRefreshToken)[33m,[39m
    [90m125| [39m      })[33m;[39m
    [90m126| [39m      [34mexpect[39m(oldToken[33m?.[39mrevoked)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m127| [39m
    [90m128| [39m      [90m// New token should exist and not be revoked[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[229/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould return 401 when user is not found
[31m[1mAssertionError[22m: expected 'Invalid refresh token' to be 'User not found' // Object.is equality[39m

Expected: [32m"User not found"[39m
Received: [31m"Invalid refresh token"[39m

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m206:37[22m[39m
    [90m204| [39m
    [90m205| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m401[39m)[33m;[39m
    [90m206| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39mmessage)[33m.[39m[34mtoBe[39m([32m'User not found'[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m207| [39m    })[33m;[39m
    [90m208| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[230/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould set secure cookie in production
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m258:33[22m[39m
    [90m256| [39m          [33m.[39m[35mset[39m([32m'Cookie'[39m[33m,[39m [32m`refresh_token=[39m[36m${[39mtestRefreshToken[36m}[39m[32m`[39m)[33m;[39m
    [90m257| [39m
    [90m258| [39m        [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                [31m^[39m
    [90m259| [39m
    [90m260| [39m        [35mconst[39m setCookieHeader [33m=[39m response[33m.[39mheaders[[32m'set-cookie'[39m][33m?.[39m[[34m0[39m][33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[231/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould include user role information in response
[31m[1mAssertionError[22m: expected { id: 'MEqxwAkWlK3GEnc4UVLxX', ‚Ä¶(3) } to match object { id: 'MEqxwAkWlK3GEnc4UVLxX', ‚Ä¶(2) }
(1 matching property omitted from actual)[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[2m    "email": "refresh-test-co8SOfcv2req23cDwzEfx@example.com",[22m
[2m    "id": "MEqxwAkWlK3GEnc4UVLxX",[22m
[32m-   "role": "owner",[39m
[31m+   "role": "creator",[39m
[2m  }[22m

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m290:34[22m[39m
    [90m288| [39m
    [90m289| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m290| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39muser)[33m.[39m[34mtoMatchObject[39m({
    [90m   | [39m                                 [31m^[39m
    [90m291| [39m        id[33m:[39m testUserId[33m,[39m
    [90m292| [39m        email[33m:[39m testUserEmail[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[232/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Lifecycle[2m > [22mshould create refresh token on login
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m307:31[22m[39m
    [90m305| [39m        })[33m;[39m
    [90m306| [39m
    [90m307| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m308| [39m
    [90m309| [39m      [90m// Verify refresh token cookie is set[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[233/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Lifecycle[2m > [22mshould revoke refresh token on logout
[31m[1mAssertionError[22m: expected undefined to be true // Object.is equality[39m

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m333:30[22m[39m
    [90m331| [39m        where[33m:[39m [34meq[39m(refreshTokens[33m.[39mtoken[33m,[39m testRefreshToken)[33m,[39m
    [90m332| [39m      })[33m;[39m
    [90m333| [39m      [34mexpect[39m(token[33m?.[39mrevoked)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m334| [39m
    [90m335| [39m      [90m// Verify cookie is cleared[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[234/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Lifecycle[2m > [22mshould support multiple active refresh tokens per user
[31m[1mAssertionError[22m: expected 0 to be greater than or equal to 3[39m
[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m368:35[22m[39m
    [90m366| [39m        ))[33m;[39m
    [90m367| [39m
    [90m368| [39m      [34mexpect[39m(activeTokens[33m.[39mlength)[33m.[39m[34mtoBeGreaterThanOrEqual[39m([34m3[39m)[33m;[39m
    [90m   | [39m                                  [31m^[39m
    [90m369| [39m    })[33m;[39m
    [90m370| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[235/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Security[2m > [22mshould validate token ownership
[31m[1mAssertionError[22m: expected undefined to be 'Ep5WiKNWC8FIyD0iacL9F' // Object.is equality[39m

[32m- Expected:[39m 
"Ep5WiKNWC8FIyD0iacL9F"

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m465:29[22m[39m
    [90m463| [39m      })[33m;[39m
    [90m464| [39m
    [90m465| [39m      [34mexpect[39m(token[33m?.[39muserId)[33m.[39m[34mtoBe[39m(testUserId)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m466| [39m      [34mexpect[39m(token[33m?.[39muserId)[33m.[39mnot[33m.[39m[34mtoBe[39m(otherUser[33m.[39mid)[33m;[39m
    [90m467| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[236/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mCookie Security[2m > [22mshould set appropriate expiry (30 days)
[31m[1mAssertionError[22m: expected 'refresh_token=; Max-Age=0; Path=/' to contain 'Max-Age=2592000'[39m

Expected: [32m"Max-Age=2592000"[39m
Received: [31m"refresh_token=; Max-Age=0; Path=/"[39m

[36m [2m‚ùØ[22m tests/integration/auth/oauth2.token-refresh.test.ts:[2m505:31[22m[39m
    [90m503| [39m      [35mconst[39m setCookieHeader [33m=[39m response[33m.[39mheaders[[32m'set-cookie'[39m][33m?.[39m[[34m0[39m][33m;[39m
    [90m504| [39m      [90m// 30 days = 2592000 seconds[39m
    [90m505| [39m      [34mexpect[39m(setCookieHeader)[33m.[39m[34mtoContain[39m([32m'Max-Age=2592000'[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m506| [39m    })[33m;[39m
    [90m507| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[237/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould allow access with valid Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould reject access with empty Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould reject access with malformed Authorization header
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould reject access with wrong token type
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPOST Protected Routes[2m > [22mshould allow POST with valid Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPUT Protected Routes[2m > [22mshould allow PUT with valid Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPUT Protected Routes[2m > [22mshould reject PUT without Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mDELETE Protected Routes[2m > [22mshould allow DELETE with valid Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mDELETE Protected Routes[2m > [22mshould reject DELETE without Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPATCH Protected Routes[2m > [22mshould reject PATCH without Bearer token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle token with newlines
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle very long invalid token
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle empty Authorization header
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle Authorization header with only Bearer
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle multiple Authorization headers
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould reject token with SQL injection attempt
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould reject token with XSS attempt
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Payload Validation[2m > [22mshould reject token with missing userId
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mUser Context Injection[2m > [22mshould inject role into request context
[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mRate Limiting on Protected Routes[2m > [22mshould not apply general rate limiting to authenticated requests
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/protected.routes.test.ts:[2m66:14[22m[39m
    [90m 64| [39m                password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m 65| [39m            })
    [90m 66| [39m            [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m             [31m^[39m
    [90m 67| [39m
    [90m 68| [39m        userToken [33m=[39m loginRes[33m.[39mbody[33m.[39mtoken[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[238/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mCross-User Authorization[2m > [22mshould not allow user to access another user's resources
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/protected.routes.test.ts:[2m323:18[22m[39m
    [90m321| [39m                    password[33m:[39m user2[33m.[39mpassword[33m,[39m
    [90m322| [39m                })
    [90m323| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m324| [39m
    [90m325| [39m            [35mconst[39m user2Token [33m=[39m user2LoginRes[33m.[39mbody[33m.[39mtoken[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[239/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mMixed Auth Scenarios[2m > [22mshould handle request with both Bearer token and cookies
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/protected.routes.test.ts:[2m400:18[22m[39m
    [90m398| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m399| [39m                })
    [90m400| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m401| [39m
    [90m402| [39m            [35mconst[39m cookies [33m=[39m loginRes[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[240/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mMixed Auth Scenarios[2m > [22mshould prioritize Bearer token over cookie when both present
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/protected.routes.test.ts:[2m422:18[22m[39m
    [90m420| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m421| [39m                })
    [90m422| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m423| [39m
    [90m424| [39m            [35mconst[39m user2 [33m=[39m {
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[241/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mOptional Auth Routes[2m > [22mshould allow unauthenticated access to optional auth routes
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/protected.routes.test.ts:[2m475:18[22m[39m
    [90m473| [39m            [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
    [90m474| [39m                [33m.[39m[35mget[39m([32m`/api/workflows/[39m[36m${[39mworkflowRes[33m.[39mbody[33m.[39mid[36m}[39m[32m/public`[39m)
    [90m475| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m476| [39m        })[33m;[39m
    [90m477| [39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[242/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mOptional Auth Routes[2m > [22mshould enhance optional auth routes with user context when authenticated
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2m‚ùØ[22m tests/integration/auth/protected.routes.test.ts:[2m492:18[22m[39m
    [90m490| [39m                [33m.[39m[35mget[39m([32m`/api/workflows/[39m[36m${[39mworkflowRes[33m.[39mbody[33m.[39mid[36m}[39m[32m/public`[39m)
    [90m491| [39m                [33m.[39m[35mset[39m([32m"Authorization"[39m[33m,[39m [32m`Bearer [39m[36m${[39muserToken[36m}[39m[32m`[39m)
    [90m492| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m493| [39m        })[33m;[39m
    [90m494| [39m    })[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[243/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mSession Creation and Tracking[2m > [22mshould create refresh token on login
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m74:18[22m[39m
    [90m 72| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m 73| [39m                })
    [90m 74| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 75| [39m
    [90m 76| [39m            [34mexpect[39m(loginRes[33m.[39mheaders[[32m'set-cookie'[39m])[33m.[39m[34mtoBeDefined[39m()[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[244/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mSession Creation and Tracking[2m > [22mshould create separate sessions for multiple device logins
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m120:18[22m[39m
    [90m118| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m119| [39m                })
    [90m120| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m121| [39m
    [90m122| [39m            [90m// Login from device 2[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[245/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould list all active sessions for user
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m163:18[22m[39m
    [90m161| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m162| [39m                })
    [90m163| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m164| [39m
    [90m165| [39m            [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[246/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould mark current session correctly
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m208:18[22m[39m
    [90m206| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m207| [39m                })
    [90m208| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m209| [39m
    [90m210| [39m            [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[247/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould not include revoked sessions
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m237:18[22m[39m
    [90m235| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m236| [39m                })
    [90m237| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m238| [39m
    [90m239| [39m            [35mconst[39m session2 [33m=[39m [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[248/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould order sessions by last used (most recent first)
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m282:18[22m[39m
    [90m280| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m281| [39m                })
    [90m282| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m283| [39m
    [90m284| [39m            [35mawait[39m [35mnew[39m [33mPromise[39m(resolve [33m=>[39m [34msetTimeout[39m(resolve[33m,[39m [34m100[39m))[33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[249/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould revoke specific session
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m332:18[22m[39m
    [90m330| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m331| [39m                })
    [90m332| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m333| [39m
    [90m334| [39m            [35mconst[39m session2 [33m=[39m [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[250/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould prevent revoking current session
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m373:18[22m[39m
    [90m371| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m372| [39m                })
    [90m373| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m374| [39m
    [90m375| [39m            [35mconst[39m sessionsRes [33m=[39m [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[251/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould not allow revoking other users sessions
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m417:18[22m[39m
    [90m415| [39m                    password[33m:[39m user2[33m.[39mpassword[33m,[39m
    [90m416| [39m                })
    [90m417| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m418| [39m
    [90m419| [39m            [90m// User1 tries to get user2's sessions[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[252/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould return 404 for non-existent session ID
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m452:18[22m[39m
    [90m450| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m451| [39m                })
    [90m452| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m453| [39m
    [90m454| [39m            [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[253/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all sessions except current
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m471:18[22m[39m
    [90m469| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m470| [39m                })
    [90m471| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m472| [39m
    [90m473| [39m            [35mconst[39m session2 [33m=[39m [35mawait[39m [34mrequest[39m(ctx[33m.[39mbaseURL)
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[254/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all trusted devices
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m523:18[22m[39m
    [90m521| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m522| [39m                })
    [90m523| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m524| [39m
    [90m525| [39m            [90m// Trust device[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[255/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mSession Expiration[2m > [22mshould reject refresh token after 30 days
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m564:18[22m[39m
    [90m562| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m563| [39m                })
    [90m564| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m565| [39m
    [90m566| [39m            [90m// Get the refresh token from database (non-revoked only)[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[256/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mConcurrent Session Handling[2m > [22mshould handle multiple concurrent logins
[31m[1mAssertionError[22m: expected 401 to be 200 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 401[39m

[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m610:36[22m[39m
    [90m608| [39m
    [90m609| [39m            logins[33m.[39m[34mforEach[39m(res [33m=>[39m {
    [90m610| [39m                [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m611| [39m                [34mexpect[39m(res[33m.[39mbody[33m.[39mtoken)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m612| [39m            })[33m;[39m
[90m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m609:20[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[257/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mConcurrent Session Handling[2m > [22mshould handle concurrent token refreshes
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2m‚ùØ[22m tests/integration/auth/session.management.integration.test.ts:[2m631:18[22m[39m
    [90m629| [39m                    password[33m:[39m testUser[33m.[39mpassword[33m,[39m
    [90m630| [39m                })
    [90m631| [39m                [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m632| [39m
    [90m633| [39m            [35mconst[39m cookies [33m=[39m session[33m.[39mheaders[[32m'set-cookie'[39m][33m;[39m
[90m [2m‚ùØ[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2m‚ùØ[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2m‚ùØ[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2m‚ùØ[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2m‚ùØ[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2m‚ùØ[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2m‚ùØ[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2m‚ùØ[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[258/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render all breadcrumb items
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m28:5[22m[39m
    [90m 26| [39m
    [90m 27| [39m  [34mit[39m([32m'should render all breadcrumb items'[39m[33m,[39m () [33m=>[39m {
    [90m 28| [39m    [34mrender[39m([33m<[39m[33mBreadcrumbs[39m [33mitems[39m[33m=[39m[33m{[39mmockItems[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 29| [39m
    [90m 30| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Home'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[259/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render without home when showHome is false
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m37:5[22m[39m
    [90m 35| [39m
    [90m 36| [39m  [34mit[39m([32m'should render without home when showHome is false'[39m[33m,[39m () [33m=>[39m {
    [90m 37| [39m    [34mrender[39m([33m<[39m[33mBreadcrumbs[39m [33mitems[39m[33m=[39m[33m{[39mmockItems[33m}[39m [33mshowHome[39m[33m=[39m[33m{[39m[35mfalse[39m[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 38| [39m
    [90m 39| [39m    [34mexpect[39m(screen[33m.[39m[34mqueryByText[39m([32m'Home'[39m))[33m.[39mnot[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[260/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render icons for items that have them
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m44:5[22m[39m
    [90m 42| [39m
    [90m 43| [39m  [34mit[39m([32m'should render icons for items that have them'[39m[33m,[39m () [33m=>[39m {
    [90m 44| [39m    [34mrender[39m([33m<[39m[33mBreadcrumbs[39m [33mitems[39m[33m=[39m[33m{[39mmockItems[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 45| [39m
    [90m 46| [39m    [35mconst[39m icons [33m=[39m screen[33m.[39m[34mgetAllByTestId[39m([32m'icon'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[261/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render links for non-last items with href
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m51:5[22m[39m
    [90m 49| [39m
    [90m 50| [39m  [34mit[39m([32m'should render links for non-last items with href'[39m[33m,[39m () [33m=>[39m {
    [90m 51| [39m    [34mrender[39m([33m<[39m[33mBreadcrumbs[39m [33mitems[39m[33m=[39m[33m{[39mmockItems[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 52| [39m
    [90m 53| [39m    [35mconst[39m links [33m=[39m screen[33m.[39m[34mgetAllByTestId[39m([32m'breadcrumb-link'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[262/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render last item without link
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m59:5[22m[39m
    [90m 57| [39m
    [90m 58| [39m  [34mit[39m([32m'should render last item without link'[39m[33m,[39m () [33m=>[39m {
    [90m 59| [39m    [34mrender[39m([33m<[39m[33mBreadcrumbs[39m [33mitems[39m[33m=[39m[33m{[39mmockItems[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 60| [39m
    [90m 61| [39m    [35mconst[39m lastItem [33m=[39m screen[33m.[39m[34mgetByText[39m([32m'Test Database'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[263/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould apply custom className
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m66:27[22m[39m
    [90m 64| [39m
    [90m 65| [39m  [34mit[39m([32m'should apply custom className'[39m[33m,[39m () [33m=>[39m {
    [90m 66| [39m    const { container } = render(<Breadcrumbs items={mockItems} classN‚Ä¶
    [90m   | [39m                          [31m^[39m
    [90m 67| [39m
    [90m 68| [39m    [35mconst[39m nav [33m=[39m container[33m.[39m[34mquerySelector[39m([32m'nav'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[264/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render chevron separators between items
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m73:27[22m[39m
    [90m 71| [39m
    [90m 72| [39m  [34mit[39m([32m'should render chevron separators between items'[39m[33m,[39m () [33m=>[39m {
    [90m 73| [39m    [35mconst[39m { container } [33m=[39m [34mrender[39m([33m<[39m[33mBreadcrumbs[39m [33mitems[39m[33m=[39m[33m{[39mmockItems[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m 74| [39m
    [90m 75| [39m    [90m// Should have chevrons between items[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[265/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould handle single item
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m81:5[22m[39m
    [90m 79| [39m
    [90m 80| [39m  [34mit[39m([32m'should handle single item'[39m[33m,[39m () [33m=>[39m {
    [90m 81| [39m    render(<Breadcrumbs items={[{ label: 'Single Item' }]} showHome={f‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 82| [39m
    [90m 83| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Single Item'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[266/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould handle empty items array with home
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m88:5[22m[39m
    [90m 86| [39m
    [90m 87| [39m  [34mit[39m([32m'should handle empty items array with home'[39m[33m,[39m () [33m=>[39m {
    [90m 88| [39m    [34mrender[39m([33m<[39m[33mBreadcrumbs[39m [33mitems[39m[33m=[39m[33m{[39m[][33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 89| [39m
    [90m 90| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Home'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[267/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould apply font-medium to last item
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/common/Breadcrumbs.test.tsx:[2m94:5[22m[39m
    [90m 92| [39m
    [90m 93| [39m  [34mit[39m([32m'should apply font-medium to last item'[39m[33m,[39m () [33m=>[39m {
    [90m 94| [39m    [34mrender[39m([33m<[39m[33mBreadcrumbs[39m [33mitems[39m[33m=[39m[33m{[39mmockItems[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 95| [39m
    [90m 96| [39m    [35mconst[39m lastItem [33m=[39m screen[33m.[39m[34mgetByText[39m([32m'Test Database'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[268/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders text icon for text type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m14:7[22m[39m
    [90m 12| [39m  [34mdescribe[39m([32m'Icon Rendering'[39m[33m,[39m () [33m=>[39m {
    [90m 13| [39m    [34mit[39m([32m'renders text icon for text type'[39m[33m,[39m () [33m=>[39m {
    [90m 14| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"text"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 15| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'text column type'[39m)[33m;[39m
    [90m 16| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[269/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders hash icon for number type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m20:7[22m[39m
    [90m 18| [39m
    [90m 19| [39m    [34mit[39m([32m'renders hash icon for number type'[39m[33m,[39m () [33m=>[39m {
    [90m 20| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"number"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 21| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'number column type'[39m)[33m;[39m
    [90m 22| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[270/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders hash icon for auto_number type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m26:7[22m[39m
    [90m 24| [39m
    [90m 25| [39m    [34mit[39m([32m'renders hash icon for auto_number type'[39m[33m,[39m () [33m=>[39m {
    [90m 26| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"auto_number"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 27| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'auto_number column type'[39m)[33m;[39m
    [90m 28| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[271/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders toggle icon for boolean type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m32:7[22m[39m
    [90m 30| [39m
    [90m 31| [39m    [34mit[39m([32m'renders toggle icon for boolean type'[39m[33m,[39m () [33m=>[39m {
    [90m 32| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"boolean"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 33| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'boolean column type'[39m)[33m;[39m
    [90m 34| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[272/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders calendar icon for date type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m38:7[22m[39m
    [90m 36| [39m
    [90m 37| [39m    [34mit[39m([32m'renders calendar icon for date type'[39m[33m,[39m () [33m=>[39m {
    [90m 38| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"date"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 39| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'date column type'[39m)[33m;[39m
    [90m 40| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[273/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders clock icon for datetime type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m44:7[22m[39m
    [90m 42| [39m
    [90m 43| [39m    [34mit[39m([32m'renders clock icon for datetime type'[39m[33m,[39m () [33m=>[39m {
    [90m 44| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"datetime"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 45| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'datetime column type'[39m)[33m;[39m
    [90m 46| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[274/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders mail icon for email type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m50:7[22m[39m
    [90m 48| [39m
    [90m 49| [39m    [34mit[39m([32m'renders mail icon for email type'[39m[33m,[39m () [33m=>[39m {
    [90m 50| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"email"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 51| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'email column type'[39m)[33m;[39m
    [90m 52| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[275/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders phone icon for phone type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m56:7[22m[39m
    [90m 54| [39m
    [90m 55| [39m    [34mit[39m([32m'renders phone icon for phone type'[39m[33m,[39m () [33m=>[39m {
    [90m 56| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"phone"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 57| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'phone column type'[39m)[33m;[39m
    [90m 58| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[276/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders link icon for url type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m62:7[22m[39m
    [90m 60| [39m
    [90m 61| [39m    [34mit[39m([32m'renders link icon for url type'[39m[33m,[39m () [33m=>[39m {
    [90m 62| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"url"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 63| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'url column type'[39m)[33m;[39m
    [90m 64| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[277/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders JSON icon for json type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m68:7[22m[39m
    [90m 66| [39m
    [90m 67| [39m    [34mit[39m([32m'renders JSON icon for json type'[39m[33m,[39m () [33m=>[39m {
    [90m 68| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"json"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 69| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'json column type'[39m)[33m;[39m
    [90m 70| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[278/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders file icon for file_upload type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m74:7[22m[39m
    [90m 72| [39m
    [90m 73| [39m    [34mit[39m([32m'renders file icon for file_upload type'[39m[33m,[39m () [33m=>[39m {
    [90m 74| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"file_upload"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 75| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'file_upload column type'[39m)[33m;[39m
    [90m 76| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[279/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders default text icon for unknown type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m80:7[22m[39m
    [90m 78| [39m
    [90m 79| [39m    [34mit[39m([32m'renders default text icon for unknown type'[39m[33m,[39m () [33m=>[39m {
    [90m 80| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"unknown_type"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m 81| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'unknown_type column type'[39m)[33m;[39m
    [90m 82| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[280/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mapplies custom className
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m86:29[22m[39m
    [90m 84| [39m
    [90m 85| [39m    [34mit[39m([32m'applies custom className'[39m[33m,[39m () [33m=>[39m {
    [90m 86| [39m      const { container } = render(<ColumnTypeIcon type="text" classNa‚Ä¶
    [90m   | [39m                            [31m^[39m
    [90m 87| [39m      [35mconst[39m icon [33m=[39m container[33m.[39m[34mquerySelector[39m([32m'.custom-class'[39m)[33m;[39m
    [90m 88| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[281/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mAccessibility[2m > [22mincludes aria-label with column type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m162:7[22m[39m
    [90m160| [39m  [34mdescribe[39m([32m'Accessibility'[39m[33m,[39m () [33m=>[39m {
    [90m161| [39m    [34mit[39m([32m'includes aria-label with column type'[39m[33m,[39m () [33m=>[39m {
    [90m162| [39m      [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"email"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m163| [39m      [35mconst[39m icon [33m=[39m screen[33m.[39m[34mgetByLabelText[39m([32m'email column type'[39m)[33m;[39m
    [90m164| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoHaveAttribute[39m([32m'aria-label'[39m[33m,[39m [32m'email column type'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[282/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mAccessibility[2m > [22mhas proper icon size class
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/ColumnTypeIcon.test.tsx:[2m168:29[22m[39m
    [90m166| [39m
    [90m167| [39m    [34mit[39m([32m'has proper icon size class'[39m[33m,[39m () [33m=>[39m {
    [90m168| [39m      [35mconst[39m { container } [33m=[39m [34mrender[39m([33m<[39m[33mColumnTypeIcon[39m [33mtype[39m[33m=[39m[32m"text"[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m169| [39m      [35mconst[39m icon [33m=[39m container[33m.[39m[34mquerySelector[39m([32m'.w-4.h-4'[39m)[33m;[39m
    [90m170| [39m      [34mexpect[39m(icon)[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[283/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould render database settings page with breadcrumbs
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m renderPage tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m64:12[22m[39m
    [90m 62| [39m
    [90m 63| [39m  [35mconst[39m renderPage [33m=[39m () [33m=>[39m {
    [90m 64| [39m    [35mreturn[39m [34mrender[39m(
    [90m   | [39m           [31m^[39m
    [90m 65| [39m      [33m<[39m[33mQueryClientProvider[39m [33mclient[39m[33m=[39m[33m{[39mqueryClient[33m}[39m[33m>[39m
    [90m 66| [39m        [33m<[39m[33mDatabaseSettingsPage[39m [33m/[39m[33m>[39m
[90m [2m‚ùØ[22m tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m72:5[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[284/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould show loading state
[31m[1mError[22m: Cannot find module '@/lib/datavault-hooks'
Require stack:
- C:\Users\scoot\poll\VaultLogic\tests\ui\datavault\DatabaseSettingsPage.test.tsx[39m
[36m [2m‚ùØ[22m tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m79:38[22m[39m
    [90m 77| [39m
    [90m 78| [39m  [34mit[39m([32m'should show loading state'[39m[33m,[39m () [33m=>[39m {
    [90m 79| [39m    [35mconst[39m { useDatavaultDatabase } [33m=[39m [34mrequire[39m([32m'@/lib/datavault-hooks'[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 80| [39m    useDatavaultDatabase[33m.[39m[34mmockReturnValue[39m({
    [90m 81| [39m      data[33m:[39m [35mnull[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[285/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould show not found state when database does not exist
[31m[1mError[22m: Cannot find module '@/lib/datavault-hooks'
Require stack:
- C:\Users\scoot\poll\VaultLogic\tests\ui\datavault\DatabaseSettingsPage.test.tsx[39m
[36m [2m‚ùØ[22m tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m91:38[22m[39m
    [90m 89| [39m
    [90m 90| [39m  it('should show not found state when database does not exist', () =>‚Ä¶
    [90m 91| [39m    [35mconst[39m { useDatavaultDatabase } [33m=[39m [34mrequire[39m([32m'@/lib/datavault-hooks'[39m)[33m;[39m
    [90m   | [39m                                     [31m^[39m
    [90m 92| [39m    useDatavaultDatabase[33m.[39m[34mmockReturnValue[39m({
    [90m 93| [39m      data[33m:[39m [35mnull[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[286/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould render DatabaseSettings component with database data
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m renderPage tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m64:12[22m[39m
    [90m 62| [39m
    [90m 63| [39m  [35mconst[39m renderPage [33m=[39m () [33m=>[39m {
    [90m 64| [39m    [35mreturn[39m [34mrender[39m(
    [90m   | [39m           [31m^[39m
    [90m 65| [39m      [33m<[39m[33mQueryClientProvider[39m [33mclient[39m[33m=[39m[33m{[39mqueryClient[33m}[39m[33m>[39m
    [90m 66| [39m        [33m<[39m[33mDatabaseSettingsPage[39m [33m/[39m[33m>[39m
[90m [2m‚ùØ[22m tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m104:5[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[287/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould navigate back when back button is clicked
[31m[1mTypeError[22m: useLocation.mockReturnValue is not a function[39m
[36m [2m‚ùØ[22m tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m116:17[22m[39m
    [90m114| [39m    [35mconst[39m mockSetLocation [33m=[39m vi[33m.[39m[34mfn[39m()[33m;[39m
    [90m115| [39m    [35mconst[39m { useLocation } [33m=[39m [34mrequire[39m([32m'wouter'[39m)[33m;[39m
    [90m116| [39m    useLocation.mockReturnValue(['/datavault/databases/db-1/settings',‚Ä¶
    [90m   | [39m                [31m^[39m
    [90m117| [39m
    [90m118| [39m    [34mrenderPage[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[288/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould display database name in header
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m renderPage tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m64:12[22m[39m
    [90m 62| [39m
    [90m 63| [39m  [35mconst[39m renderPage [33m=[39m () [33m=>[39m {
    [90m 64| [39m    [35mreturn[39m [34mrender[39m(
    [90m   | [39m           [31m^[39m
    [90m 65| [39m      [33m<[39m[33mQueryClientProvider[39m [33mclient[39m[33m=[39m[33m{[39mqueryClient[33m}[39m[33m>[39m
    [90m 66| [39m        [33m<[39m[33mDatabaseSettingsPage[39m [33m/[39m[33m>[39m
[90m [2m‚ùØ[22m tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m127:5[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[289/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould render sidebar
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m Proxy.render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m renderPage tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m64:12[22m[39m
    [90m 62| [39m
    [90m 63| [39m  [35mconst[39m renderPage [33m=[39m () [33m=>[39m {
    [90m 64| [39m    [35mreturn[39m [34mrender[39m(
    [90m   | [39m           [31m^[39m
    [90m 65| [39m      [33m<[39m[33mQueryClientProvider[39m [33mclient[39m[33m=[39m[33m{[39mqueryClient[33m}[39m[33m>[39m
    [90m 66| [39m        [33m<[39m[33mDatabaseSettingsPage[39m [33m/[39m[33m>[39m
[90m [2m‚ùØ[22m tests/ui/datavault/DatabaseSettingsPage.test.tsx:[2m135:5[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[290/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mrenders value in display mode initially
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m36:7[22m[39m
    [90m 34| [39m  [34mdescribe[39m([32m'Display Mode'[39m[33m,[39m () [33m=>[39m {
    [90m 35| [39m    [34mit[39m([32m'renders value in display mode initially'[39m[33m,[39m () [33m=>[39m {
    [90m 36| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 37| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'John Doe'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m
    [90m 38| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[291/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mrenders value in display mode initially
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mshows double-click hint on hover
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mdoes not show hint for read-only cells
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mincludes proper ARIA label with column name and value
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mindicates read-only status in ARIA label
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mis focusable when editable
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mis not focusable when read-only
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on double-click
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on Enter key press
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on Space key press
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22mdoes not enter edit mode when read-only
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22mfocuses and selects input text on edit mode entry
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22msaves on blur
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22msaves on Enter key press
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22mdoes not save if value unchanged
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22mcancels edit on Escape key press
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mError Handling[2m > [22mreverts value on save error
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mError Handling[2m > [22mdisplays error indicator on save failure
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mrenders checkbox for boolean type
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22msaves immediately on checkbox change
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mdisables checkbox when read-only
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mshows loading spinner when saving checkbox
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders number input for number type
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders email input for email type
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders url input for url type
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mincludes placeholder text in edit mode
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mformats date values for display
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mformats boolean values as Yes/No
[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mhandles null values gracefully
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'navigator')[39m
[90m [2m‚ùØ[22m resetClipboardStubOnView node_modules/@testing-library/user-event/dist/esm/utils/dataTransfer/Clipboard.js:[2m115:32[22m[39m
[90m [2m‚ùØ[22m node_modules/@testing-library/user-event/dist/esm/utils/dataTransfer/Clipboard.js:[2m156:21[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[292/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mshows double-click hint on hover
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m41:7[22m[39m
    [90m 39| [39m
    [90m 40| [39m    [34mit[39m([32m'shows double-click hint on hover'[39m[33m,[39m () [33m=>[39m {
    [90m 41| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 42| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m 43| [39m      [34mexpect[39m(cell)[33m.[39m[34mtoHaveAttribute[39m([32m'title'[39m[33m,[39m [32m'Double-click to edit'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[293/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mdoes not show hint for read-only cells
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m47:7[22m[39m
    [90m 45| [39m
    [90m 46| [39m    [34mit[39m([32m'does not show hint for read-only cells'[39m[33m,[39m () [33m=>[39m {
    [90m 47| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 48| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m 49| [39m      [34mexpect[39m(cell)[33m.[39m[34mtoHaveAttribute[39m([32m'title'[39m[33m,[39m [32m''[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[294/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mincludes proper ARIA label with column name and value
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m53:7[22m[39m
    [90m 51| [39m
    [90m 52| [39m    [34mit[39m([32m'includes proper ARIA label with column name and value'[39m[33m,[39m () [33m=>[39m {
    [90m 53| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 54| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m 55| [39m      expect(cell).toHaveAttribute('aria-label', 'Full Name: John Doe'‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[295/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mindicates read-only status in ARIA label
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m59:7[22m[39m
    [90m 57| [39m
    [90m 58| [39m    [34mit[39m([32m'indicates read-only status in ARIA label'[39m[33m,[39m () [33m=>[39m {
    [90m 59| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 60| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m 61| [39m      expect(cell).toHaveAttribute('aria-label', 'Full Name: John Doe ‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[296/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mis focusable when editable
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m65:7[22m[39m
    [90m 63| [39m
    [90m 64| [39m    [34mit[39m([32m'is focusable when editable'[39m[33m,[39m () [33m=>[39m {
    [90m 65| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 66| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m 67| [39m      [34mexpect[39m(cell)[33m.[39m[34mtoHaveAttribute[39m([32m'tabIndex'[39m[33m,[39m [32m'0'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[297/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mis not focusable when read-only
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m71:7[22m[39m
    [90m 69| [39m
    [90m 70| [39m    [34mit[39m([32m'is not focusable when read-only'[39m[33m,[39m () [33m=>[39m {
    [90m 71| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 72| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m 73| [39m      [34mexpect[39m(cell)[33m.[39m[34mtoHaveAttribute[39m([32m'tabIndex'[39m[33m,[39m [32m'-1'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[298/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on double-click
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m79:7[22m[39m
    [90m 77| [39m  [34mdescribe[39m([32m'Edit Mode Activation'[39m[33m,[39m () [33m=>[39m {
    [90m 78| [39m    [34mit[39m([32m'enters edit mode on double-click'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m 79| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 80| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m 81| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[299/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on Enter key press
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m90:7[22m[39m
    [90m 88| [39m
    [90m 89| [39m    [34mit[39m([32m'enters edit mode on Enter key press'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m 90| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m 91| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m 92| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[300/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on Space key press
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m101:7[22m[39m
    [90m 99| [39m
    [90m100| [39m    [34mit[39m([32m'enters edit mode on Space key press'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m101| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m102| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m103| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[301/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22mdoes not enter edit mode when read-only
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m112:7[22m[39m
    [90m110| [39m
    [90m111| [39m    [34mit[39m([32m'does not enter edit mode when read-only'[39m[33m,[39m () [33m=>[39m {
    [90m112| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m113| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m114| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[302/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22mfocuses and selects input text on edit mode entry
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m121:7[22m[39m
    [90m119| [39m
    [90m120| [39m    it('focuses and selects input text on edit mode entry', async () =‚Ä¶
    [90m121| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m122| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m
    [90m123| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[303/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22msaves on blur
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m136:7[22m[39m
    [90m134| [39m    [34mit[39m([32m'saves on blur'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m135| [39m      mockOnSave[33m.[39m[34mmockResolvedValue[39m(undefined)[33m;[39m
    [90m136| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m137| [39m
    [90m138| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[304/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22msaves on Enter key press
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m153:7[22m[39m
    [90m151| [39m    [34mit[39m([32m'saves on Enter key press'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m152| [39m      mockOnSave[33m.[39m[34mmockResolvedValue[39m(undefined)[33m;[39m
    [90m153| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m154| [39m
    [90m155| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[305/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22mdoes not save if value unchanged
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m168:7[22m[39m
    [90m166| [39m
    [90m167| [39m    [34mit[39m([32m'does not save if value unchanged'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m168| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m169| [39m
    [90m170| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[306/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22mcancels edit on Escape key press
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m181:7[22m[39m
    [90m179| [39m
    [90m180| [39m    [34mit[39m([32m'cancels edit on Escape key press'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m181| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m182| [39m
    [90m183| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[307/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mError Handling[2m > [22mreverts value on save error
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m200:7[22m[39m
    [90m198| [39m    [34mit[39m([32m'reverts value on save error'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m199| [39m      mockOnSave[33m.[39m[34mmockRejectedValue[39m([35mnew[39m [33mError[39m([32m'Network error'[39m))[33m;[39m
    [90m200| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m201| [39m
    [90m202| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[308/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mError Handling[2m > [22mdisplays error indicator on save failure
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m216:7[22m[39m
    [90m214| [39m    [34mit[39m([32m'displays error indicator on save failure'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m215| [39m      mockOnSave[33m.[39m[34mmockRejectedValue[39m([35mnew[39m [33mError[39m([32m'Network error'[39m))[33m;[39m
    [90m216| [39m      render(<EditableCell column={mockColumn} value="John Doe" onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m217| [39m
    [90m218| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[309/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mrenders checkbox for boolean type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m239:7[22m[39m
    [90m237| [39m
    [90m238| [39m    [34mit[39m([32m'renders checkbox for boolean type'[39m[33m,[39m () [33m=>[39m {
    [90m239| [39m      render(<EditableCell column={booleanColumn} value={true} onSave=‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m240| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByRole[39m([32m'checkbox'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m
    [90m241| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[310/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22msaves immediately on checkbox change
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m245:7[22m[39m
    [90m243| [39m    [34mit[39m([32m'saves immediately on checkbox change'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m244| [39m      mockOnSave[33m.[39m[34mmockResolvedValue[39m(undefined)[33m;[39m
    [90m245| [39m      render(<EditableCell column={booleanColumn} value={false} onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m246| [39m
    [90m247| [39m      [35mconst[39m checkbox [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'checkbox'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[311/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mdisables checkbox when read-only
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m256:7[22m[39m
    [90m254| [39m
    [90m255| [39m    [34mit[39m([32m'disables checkbox when read-only'[39m[33m,[39m () [33m=>[39m {
    [90m256| [39m      render(<EditableCell column={booleanColumn} value={true} onSave=‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m257| [39m      [35mconst[39m checkbox [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'checkbox'[39m)[33m;[39m
    [90m258| [39m      [34mexpect[39m(checkbox)[33m.[39m[34mtoBeDisabled[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[312/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mshows loading spinner when saving checkbox
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m268:7[22m[39m
    [90m266| [39m      mockOnSave[33m.[39m[34mmockReturnValue[39m(savePromise)[33m;[39m
    [90m267| [39m
    [90m268| [39m      render(<EditableCell column={booleanColumn} value={false} onSave‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m269| [39m
    [90m270| [39m      [35mconst[39m checkbox [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'checkbox'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[313/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders number input for number type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m284:7[22m[39m
    [90m282| [39m    [34mit[39m([32m'renders number input for number type'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m283| [39m      const numberColumn: DatavaultColumn = { ...mockColumn, type: 'nu‚Ä¶
    [90m284| [39m      render(<EditableCell column={numberColumn} value={25} onSave={mo‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m285| [39m
    [90m286| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[314/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders email input for email type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m294:7[22m[39m
    [90m292| [39m    [34mit[39m([32m'renders email input for email type'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m293| [39m      const emailColumn: DatavaultColumn = { ...mockColumn, type: 'ema‚Ä¶
    [90m294| [39m      render(<EditableCell column={emailColumn} value="test@example.co‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m295| [39m
    [90m296| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[315/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders url input for url type
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m304:7[22m[39m
    [90m302| [39m    [34mit[39m([32m'renders url input for url type'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m303| [39m      const urlColumn: DatavaultColumn = { ...mockColumn, type: 'url',‚Ä¶
    [90m304| [39m      render(<EditableCell column={urlColumn} value="https://example.c‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m305| [39m
    [90m306| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[316/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mincludes placeholder text in edit mode
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m313:7[22m[39m
    [90m311| [39m
    [90m312| [39m    [34mit[39m([32m'includes placeholder text in edit mode'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m313| [39m      render(<EditableCell column={mockColumn} value="" onSave={mockOn‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m314| [39m
    [90m315| [39m      fireEvent[33m.[39m[34mdoubleClick[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[317/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mformats date values for display
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m326:7[22m[39m
    [90m324| [39m      const dateColumn: DatavaultColumn = { ...mockColumn, type: 'date‚Ä¶
    [90m325| [39m      [35mconst[39m dateValue [33m=[39m [32m'2000-01-15'[39m[33m;[39m
    [90m326| [39m      render(<EditableCell column={dateColumn} value={dateValue} onSav‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m327| [39m
    [90m328| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[318/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mformats boolean values as Yes/No
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m334:7[22m[39m
    [90m332| [39m    [34mit[39m([32m'formats boolean values as Yes/No'[39m[33m,[39m () [33m=>[39m {
    [90m333| [39m      const booleanColumn: DatavaultColumn = { ...mockColumn, type: 'y‚Ä¶
    [90m334| [39m      render(<EditableCell column={booleanColumn} value={true} onSave=‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m335| [39m
    [90m336| [39m      [35mconst[39m cell [33m=[39m screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[319/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mhandles null values gracefully
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/EditableCell.test.tsx:[2m341:7[22m[39m
    [90m339| [39m
    [90m340| [39m    [34mit[39m([32m'handles null values gracefully'[39m[33m,[39m () [33m=>[39m {
    [90m341| [39m      render(<EditableCell column={mockColumn} value={null} onSave={mo‚Ä¶
    [90m   | [39m      [31m^[39m
    [90m342| [39m      [34mexpect[39m(screen[33m.[39m[34mgetByRole[39m([32m'gridcell'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m
    [90m343| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[320/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould render table name and description
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TableCard.test.tsx:[2m25:5[22m[39m
    [90m 23| [39m
    [90m 24| [39m  [34mit[39m([32m'should render table name and description'[39m[33m,[39m () [33m=>[39m {
    [90m 25| [39m    render(<TableCard table={mockTable} onClick={vi.fn()} onDelete={vi‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 26| [39m
    [90m 27| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Test Table'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[321/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould render table slug
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TableCard.test.tsx:[2m32:5[22m[39m
    [90m 30| [39m
    [90m 31| [39m  [34mit[39m([32m'should render table slug'[39m[33m,[39m () [33m=>[39m {
    [90m 32| [39m    render(<TableCard table={mockTable} onClick={vi.fn()} onDelete={vi‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 33| [39m
    [90m 34| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'/test-table'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[322/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould render column and row counts
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TableCard.test.tsx:[2m38:5[22m[39m
    [90m 36| [39m
    [90m 37| [39m  [34mit[39m([32m'should render column and row counts'[39m[33m,[39m () [33m=>[39m {
    [90m 38| [39m    render(<TableCard table={mockTable} onClick={vi.fn()} onDelete={vi‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 39| [39m
    [90m 40| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'5'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m [90m// column count[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[323/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould call onClick when card is clicked
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TableCard.test.tsx:[2m46:5[22m[39m
    [90m 44| [39m  [34mit[39m([32m'should call onClick when card is clicked'[39m[33m,[39m () [33m=>[39m {
    [90m 45| [39m    [35mconst[39m handleClick [33m=[39m vi[33m.[39m[34mfn[39m()[33m;[39m
    [90m 46| [39m    render(<TableCard table={mockTable} onClick={handleClick} onDelete‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 47| [39m
    [90m 48| [39m    const card = screen.getByText('Test Table').closest('.cursor-point‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[324/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould call onDelete when delete button is clicked
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TableCard.test.tsx:[2m56:5[22m[39m
    [90m 54| [39m  [34mit[39m([32m'should call onDelete when delete button is clicked'[39m[33m,[39m () [33m=>[39m {
    [90m 55| [39m    [35mconst[39m handleDelete [33m=[39m vi[33m.[39m[34mfn[39m()[33m;[39m
    [90m 56| [39m    render(<TableCard table={mockTable} onClick={vi.fn()} onDelete={ha‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 57| [39m
    [90m 58| [39m    const deleteButton = screen.getByRole('button', { name: /delete/i ‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[325/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould show placeholder when description is missing
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TableCard.test.tsx:[2m66:5[22m[39m
    [90m 64| [39m  [34mit[39m([32m'should show placeholder when description is missing'[39m[33m,[39m () [33m=>[39m {
    [90m 65| [39m    [35mconst[39m tableNoDesc [33m=[39m { [33m...[39mmockTable[33m,[39m description[33m:[39m [35mnull[39m }[33m;[39m
    [90m 66| [39m    render(<TableCard table={tableNoDesc} onClick={vi.fn()} onDelete={‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 67| [39m
    [90m 68| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'No description'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[326/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould format dates correctly
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TableCard.test.tsx:[2m72:5[22m[39m
    [90m 70| [39m
    [90m 71| [39m  [34mit[39m([32m'should format dates correctly'[39m[33m,[39m () [33m=>[39m {
    [90m 72| [39m    render(<TableCard table={mockTable} onClick={vi.fn()} onDelete={vi‚Ä¶
    [90m   | [39m    [31m^[39m
    [90m 73| [39m
    [90m 74| [39m    [90m// Check that a date is displayed (exact format may vary by locale)[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[327/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould render template name and description
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TemplateCard.test.tsx:[2m18:5[22m[39m
    [90m 16| [39m
    [90m 17| [39m  [34mit[39m([32m'should render template name and description'[39m[33m,[39m () [33m=>[39m {
    [90m 18| [39m    [34mrender[39m([33m<[39m[33mTemplateCard[39m [33m{[39m[33m...[39mmockTemplate[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 19| [39m
    [90m 20| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'People'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[328/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould show "Coming Soon" badge
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TemplateCard.test.tsx:[2m25:5[22m[39m
    [90m 23| [39m
    [90m 24| [39m  [34mit[39m([32m'should show "Coming Soon" badge'[39m[33m,[39m () [33m=>[39m {
    [90m 25| [39m    [34mrender[39m([33m<[39m[33mTemplateCard[39m [33m{[39m[33m...[39mmockTemplate[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 26| [39m
    [90m 27| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Coming Soon'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[329/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould render preview columns
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TemplateCard.test.tsx:[2m31:5[22m[39m
    [90m 29| [39m
    [90m 30| [39m  [34mit[39m([32m'should render preview columns'[39m[33m,[39m () [33m=>[39m {
    [90m 31| [39m    [34mrender[39m([33m<[39m[33mTemplateCard[39m [33m{[39m[33m...[39mmockTemplate[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 32| [39m
    [90m 33| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'First Name'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[330/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould limit preview columns to 5 and show count for remaining
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TemplateCard.test.tsx:[2m45:5[22m[39m
    [90m 43| [39m    }[33m;[39m
    [90m 44| [39m
    [90m 45| [39m    [34mrender[39m([33m<[39m[33mTemplateCard[39m [33m{[39m[33m...[39mmanyColumns[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 46| [39m
    [90m 47| [39m    [34mexpect[39m(screen[33m.[39m[34mgetByText[39m([32m'Col1'[39m))[33m.[39m[34mtoBeInTheDocument[39m()[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[331/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould handle empty preview columns
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TemplateCard.test.tsx:[2m59:5[22m[39m
    [90m 57| [39m    }[33m;[39m
    [90m 58| [39m
    [90m 59| [39m    [34mrender[39m([33m<[39m[33mTemplateCard[39m [33m{[39m[33m...[39mnoColumns[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 60| [39m
    [90m 61| [39m    expect(screen.queryByText('Suggested columns:')).not.toBeInTheDocu‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[332/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould have cursor-not-allowed style
[31m[1mReferenceError[22m: document is not defined[39m
[90m [2m‚ùØ[22m render node_modules/@testing-library/react/dist/pure.js:[2m256:5[22m[39m
[36m [2m‚ùØ[22m tests/ui/datavault/TemplateCard.test.tsx:[2m65:27[22m[39m
    [90m 63| [39m
    [90m 64| [39m  [34mit[39m([32m'should have cursor-not-allowed style'[39m[33m,[39m () [33m=>[39m {
    [90m 65| [39m    [35mconst[39m { container } [33m=[39m [34mrender[39m([33m<[39m[33mTemplateCard[39m [33m{[39m[33m...[39mmockTemplate[33m}[39m [33m/[39m[33m>[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m 66| [39m
    [90m 67| [39m    [35mconst[39m card [33m=[39m container[33m.[39m[34mquerySelector[39m([32m'.cursor-not-allowed'[39m)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[333/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22muses label template with column names
[31m[1mAssertionError[22m: expected ' ()' to be 'Alice (Admin)' // Object.is equality[39m

Expected: [32m"[7mAlice (Admin[27m)"[39m
Received: [31m"[7m ([27m)"[39m

[36m [2m‚ùØ[22m tests/unit/client/choice-utils.test.ts:[2m116:31[22m[39m
    [90m114| [39m        }[33m;[39m
    [90m115| [39m        [35mconst[39m opts [33m=[39m [34mgenerateOptionsFromList[39m(mockList[33m,[39m config)[33m;[39m
    [90m116| [39m        [34mexpect[39m(opts[[34m0[39m][33m.[39mlabel)[33m.[39m[34mtoBe[39m([32m"Alice (Admin)"[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m117| [39m        [34mexpect[39m(opts[[34m1[39m][33m.[39mlabel)[33m.[39m[34mtoBe[39m([32m"Bob (User)"[39m)[33m;[39m
    [90m118| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[334/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/debugging/Lineage.test.ts[2m > [22mDebug & Lineage[2m > [22mshould track skipped blocks in trace
[31m[1mAssertionError[22m: expected 'condition false' to be 'condition evaluated to false' // Object.is equality[39m

Expected: [32m"condition [7mevaluated to [27mfalse"[39m
Received: [31m"condition false"[39m

[36m [2m‚ùØ[22m tests/unit/debugging/Lineage.test.ts:[2m133:36[22m[39m
    [90m131| [39m
    [90m132| [39m        [34mexpect[39m(step[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'skipped'[39m)[33m;[39m
    [90m133| [39m        expect(step.skippedReason).toBe('condition evaluated to false'‚Ä¶
    [90m   | [39m                                   [31m^[39m
    [90m134| [39m        expect(result.executionTrace!.variableLineage['skippedVar']).t‚Ä¶
    [90m135| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[335/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mrequireAuth[2m > [22mshould return 401 for missing token
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ ObjectContaining{‚Ä¶} ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   ObjectContaining {[90m
[32m-     "error": "missing_token",[90m
[31m+   {[90m
[31m+     "error": {[90m
[31m+       "code": "AUTH_008",[90m
[31m+       "details": {[90m
[31m+         "errorType": "UnauthorizedError",[90m
[31m+       },[90m
[2m        "message": "Authentication required",[22m
[31m+       "timestamp": "2026-01-07T15:45:12.195Z",[90m
[31m+     },[90m
[31m+     "success": false,[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m tests/unit/middleware/auth.middleware.test.ts:[2m74:24[22m[39m
    [90m 72| [39m      [34mexpect[39m(mockNext)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m 73| [39m      [34mexpect[39m(statusMock)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m401[39m)[33m;[39m
    [90m 74| [39m      [34mexpect[39m(jsonMock)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                       [31m^[39m
    [90m 75| [39m        expect[33m.[39m[34mobjectContaining[39m({
    [90m 76| [39m          message[33m:[39m [32m'Authentication required'[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[336/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mhybridAuth[2m > [22mshould authenticate with refresh token cookie for GET requests
[31m[1mAssertionError[22m: expected "vi.fn()" to be called at least once[39m
[36m [2m‚ùØ[22m tests/unit/middleware/auth.middleware.test.ts:[2m200:24[22m[39m
    [90m198| [39m      await hybridAuth(mockReq as unknown as Request, mockRes as unkno‚Ä¶
    [90m199| [39m
    [90m200| [39m      [34mexpect[39m(mockNext)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m201| [39m      [35mconst[39m authReq [33m=[39m mockReq [35mas[39m unknown [35mas[39m [33mAuthRequest[39m[33m;[39m
    [90m202| [39m      [34mexpect[39m(authReq[33m.[39muserId)[33m.[39m[34mtoBe[39m(user[33m.[39mid)[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[337/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mhybridAuth[2m > [22mshould allow cookie auth only for safe methods
[31m[1mAssertionError[22m: expected "vi.fn()" to be called at least once[39m
[36m [2m‚ùØ[22m tests/unit/middleware/auth.middleware.test.ts:[2m259:22[22m[39m
    [90m257| [39m
    [90m258| [39m        await hybridAuth(req as unknown as Request, res as unknown as ‚Ä¶
    [90m259| [39m        [34mexpect[39m(next)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m260| [39m      }
    [90m261| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[338/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionSchema[2m > [22mshould omit id, createdAt, and updatedAt
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2m‚ùØ[22m tests/unit/schema/collections.test.ts:[2m139:32[22m[39m
    [90m137| [39m        const result = insertCollectionSchema.safeParse(dataWithOmitte‚Ä¶
    [90m138| [39m        // Should be invalid because id, createdAt, updatedAt are omit‚Ä¶
    [90m139| [39m        [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m140| [39m      })[33m;[39m
    [90m141| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[339/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/server/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mProject Transfer[2m > [22mshould allow org member to transfer org-owned project to another org they belong to
[31m[1mError[22m: Access denied - you do not have permission to access this project[39m
[36m [2m‚ùØ[22m ProjectService.verifyOwnership server/services/ProjectService.ts:[2m50:11[22m[39m
    [90m 48| [39m    }
    [90m 49| [39m
    [90m 50| [39m    throw new Error("Access denied - you do not have permission to acc‚Ä¶
    [90m   | [39m          [31m^[39m
    [90m 51| [39m  }
    [90m 52| [39m
[90m [2m‚ùØ[22m ProjectService.transferOwnership server/services/ProjectService.ts:[2m274:21[22m[39m
[90m [2m‚ùØ[22m tests/unit/server/transferOwnership.test.ts:[2m157:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[340/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/server/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mWorkflow Transfer[2m > [22mshould keep workflow in project when transferring to same owner
[31m[1mAssertionError[22m: expected null to be '47636148-a892-4dbf-b3ec-7d8eabae203c' // Object.is equality[39m

[32m- Expected:[39m 
"47636148-a892-4dbf-b3ec-7d8eabae203c"

[31m+ Received:[39m 
null

[36m [2m‚ùØ[22m tests/unit/server/transferOwnership.test.ts:[2m227:37[22m[39m
    [90m225| [39m      [34mexpect[39m(transferred[33m.[39mownerType)[33m.[39m[34mtoBe[39m([32m'org'[39m)[33m;[39m
    [90m226| [39m      [34mexpect[39m(transferred[33m.[39mownerUuid)[33m.[39m[34mtoBe[39m(testOrgId)[33m;[39m
    [90m227| [39m      expect(transferred.projectId).toBe(testProjectId); // Still in p‚Ä¶
    [90m   | [39m                                    [31m^[39m
    [90m228| [39m    })[33m;[39m
    [90m229| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[341/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/server/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mTransfer Validation[2m > [22mshould allow transfer from user to self (org member transferring org asset to themselves)
[31m[1mError[22m: Access denied - you do not have permission to access this project[39m
[36m [2m‚ùØ[22m ProjectService.verifyOwnership server/services/ProjectService.ts:[2m50:11[22m[39m
    [90m 48| [39m    }
    [90m 49| [39m
    [90m 50| [39m    throw new Error("Access denied - you do not have permission to acc‚Ä¶
    [90m   | [39m          [31m^[39m
    [90m 51| [39m  }
    [90m 52| [39m
[90m [2m‚ùØ[22m ProjectService.transferOwnership server/services/ProjectService.ts:[2m274:21[22m[39m
[90m [2m‚ùØ[22m tests/unit/server/transferOwnership.test.ts:[2m359:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[342/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AIService.test.ts[2m > [22mAIService Unit Tests[2m > [22mreviseWorkflow should parse valid JSON response correctly
[31m[1mError[22m: AI response does not match expected schema

üîß Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details[39m
[36m [2m‚ùØ[22m AIService.createError server/services/AIService.ts:[2m1059:19[22m[39m
    [90m1057| [39m    const fullMessage = troubleshootingHints ? `${message}\n\n${troubl‚Ä¶
    [90m1058| [39m
    [90m1059| [39m    [35mconst[39m error [33m=[39m [35mnew[39m [33mError[39m(fullMessage) [35mas[39m any[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m1060| [39m    error[33m.[39mcode [33m=[39m code[33m;[39m
    [90m1061| [39m    error[33m.[39mdetails [33m=[39m details[33m;[39m
[90m [2m‚ùØ[22m AIService.reviseWorkflowSingleShot server/services/AIService.ts:[2m1418:20[22m[39m
[90m [2m‚ùØ[22m AIService.reviseWorkflow server/services/AIService.ts:[2m1298:16[22m[39m
[90m [2m‚ùØ[22m tests/unit/services/AIService.test.ts:[2m61:24[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[343/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AIService.test.ts[2m > [22mAIService Unit Tests[2m > [22mreviseWorkflow should handle JSON markdown code blocks
[31m[1mError[22m: AI response does not match expected schema

üîß Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details[39m
[36m [2m‚ùØ[22m AIService.createError server/services/AIService.ts:[2m1059:19[22m[39m
    [90m1057| [39m    const fullMessage = troubleshootingHints ? `${message}\n\n${troubl‚Ä¶
    [90m1058| [39m
    [90m1059| [39m    [35mconst[39m error [33m=[39m [35mnew[39m [33mError[39m(fullMessage) [35mas[39m any[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m1060| [39m    error[33m.[39mcode [33m=[39m code[33m;[39m
    [90m1061| [39m    error[33m.[39mdetails [33m=[39m details[33m;[39m
[90m [2m‚ùØ[22m AIService.reviseWorkflowSingleShot server/services/AIService.ts:[2m1418:20[22m[39m
[90m [2m‚ùØ[22m AIService.reviseWorkflow server/services/AIService.ts:[2m1298:16[22m[39m
[90m [2m‚ùØ[22m tests/unit/services/AIService.test.ts:[2m95:24[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[344/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mcreateToken()[2m > [22mshould include userId, email, tenantId, and role in token payload
[31m[1mAssertionError[22m: expected undefined to be 'builder' // Object.is equality[39m

[32m- Expected:[39m 
"builder"

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/unit/services/AuthService.test.ts:[2m349:30[22m[39m
    [90m347| [39m        [34mexpect[39m(decoded[33m.[39memail)[33m.[39m[34mtoBe[39m([32m"owner@example.com"[39m)[33m;[39m
    [90m348| [39m        [34mexpect[39m(decoded[33m.[39mtenantId)[33m.[39m[34mtoBe[39m([32m"tenant-789"[39m)[33m;[39m
    [90m349| [39m        [34mexpect[39m(decoded[33m.[39mrole)[33m.[39m[34mtoBe[39m([32m"builder"[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m350| [39m      })[33m;[39m
    [90m351| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[345/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mcreateToken()[2m > [22mshould handle null tenantId and role
[31m[1mAssertionError[22m: expected undefined to be null[39m

[32m- Expected:[39m 
null

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/unit/services/AuthService.test.ts:[2m432:30[22m[39m
    [90m430| [39m
    [90m431| [39m        [34mexpect[39m(decoded[33m.[39mtenantId)[33m.[39m[34mtoBeNull[39m()[33m;[39m
    [90m432| [39m        [34mexpect[39m(decoded[33m.[39mrole)[33m.[39m[34mtoBeNull[39m()[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m433| [39m      })[33m;[39m
    [90m434| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[346/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould verify and decode a valid token
[31m[1mAssertionError[22m: expected undefined to be 'owner' // Object.is equality[39m

[32m- Expected:[39m 
"owner"

[31m+ Received:[39m 
undefined

[36m [2m‚ùØ[22m tests/unit/services/AuthService.test.ts:[2m463:30[22m[39m
    [90m461| [39m        [34mexpect[39m(payload[33m.[39memail)[33m.[39m[34mtoBe[39m([32m"test@example.com"[39m)[33m;[39m
    [90m462| [39m        [34mexpect[39m(payload[33m.[39mtenantId)[33m.[39m[34mtoBe[39m([32m"tenant-123"[39m)[33m;[39m
    [90m463| [39m        [34mexpect[39m(payload[33m.[39mrole)[33m.[39m[34mtoBe[39m([32m"owner"[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m464| [39m      })[33m;[39m
    [90m465| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[347/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould throw error for invalid token signature
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'[39m

Expected: [32m"Invalid token"[39m
Received: [31m"Invalid [7mor malformed [27mtoken"[39m

[36m [2m‚ùØ[22m tests/unit/services/AuthService.test.ts:[2m502:62[22m[39m
    [90m500| [39m        [35mconst[39m tamperedToken [33m=[39m token[33m.[39m[34mslice[39m([34m0[39m[33m,[39m [33m-[39m[34m5[39m) [33m+[39m [32m"XXXXX"[39m[33m;[39m
    [90m501| [39m
    [90m502| [39m        expect(() => authService.verifyToken(tamperedToken)).toThrow("‚Ä¶
    [90m   | [39m                                                             [31m^[39m
    [90m503| [39m      })[33m;[39m
    [90m504| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[348/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould throw error for malformed token
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'[39m

Expected: [32m"Invalid token"[39m
Received: [31m"Invalid [7mor malformed [27mtoken"[39m

[36m [2m‚ùØ[22m tests/unit/services/AuthService.test.ts:[2m506:68[22m[39m
    [90m504| [39m
    [90m505| [39m      [34mit[39m([32m"should throw error for malformed token"[39m[33m,[39m () [33m=>[39m {
    [90m506| [39m        expect(() => authService.verifyToken("not.a.valid.token")).toT‚Ä¶
    [90m   | [39m                                                                   [31m^[39m
    [90m507| [39m      })[33m;[39m
    [90m508| [39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[349/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould throw error for invalid token
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'[39m

Expected: [32m"Invalid token"[39m
Received: [31m"Invalid [7mor malformed [27mtoken"[39m

[36m [2m‚ùØ[22m tests/unit/services/AuthService.test.ts:[2m511:64[22m[39m
    [90m509| [39m      [34mit[39m([32m"should throw error for invalid token"[39m[33m,[39m () [33m=>[39m {
    [90m510| [39m        [90m// Test with a malformed token[39m
    [90m511| [39m        expect(() => authService.verifyToken("invalid.token")).toThrow‚Ä¶
    [90m   | [39m                                                               [31m^[39m
    [90m512| [39m      })[33m;[39m
    [90m513| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[350/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mToken Manipulation[2m > [22mshould reject token with valid structure but invalid signature
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'[39m

Expected: [32m"Invalid token"[39m
Received: [31m"Invalid [7mor malformed [27mtoken"[39m

[36m [2m‚ùØ[22m tests/unit/services/AuthService.test.ts:[2m1053:58[22m[39m
    [90m1051| [39m        const fakeToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2‚Ä¶
    [90m1052| [39m
    [90m1053| [39m        expect(() => authService.verifyToken(fakeToken)).toThrow("Inva‚Ä¶
    [90m   | [39m                                                         [31m^[39m
    [90m1054| [39m      })[33m;[39m
    [90m1055| [39m    })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[351/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mBasic navigation (no conditions)[2m > [22mshould return all pages in order when no conditions
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m49:71[22m[39m
    [90m 47| [39m      ][33m;[39m
    [90m 48| [39m
    [90m 49| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m 50| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m 51| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[352/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mBasic navigation (no conditions)[2m > [22mshould handle empty workflow
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m65:71[22m[39m
    [90m 63| [39m
    [90m 64| [39m    [34mit[39m([32m'should handle empty workflow'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m 65| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m 66| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m 67| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[353/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mBasic navigation (no conditions)[2m > [22mshould calculate correct current page index
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m85:71[22m[39m
    [90m 83| [39m      ][33m;[39m
    [90m 84| [39m
    [90m 85| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m 86| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m 87| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[354/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mvisibleIf conditions[2m > [22mshould hide pages when visibleIf is false
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m125:71[22m[39m
    [90m123| [39m      ][33m;[39m
    [90m124| [39m
    [90m125| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m126| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m127| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[355/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mvisibleIf conditions[2m > [22mshould show pages when visibleIf is true
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m158:71[22m[39m
    [90m156| [39m      ][33m;[39m
    [90m157| [39m
    [90m158| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m159| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m160| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[356/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mvisibleIf conditions[2m > [22mshould handle complex visibleIf conditions
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m196:71[22m[39m
    [90m194| [39m      ][33m;[39m
    [90m195| [39m
    [90m196| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m197| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m198| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[357/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mskipIf conditions[2m > [22mshould skip pages when skipIf is true
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m233:71[22m[39m
    [90m231| [39m      ][33m;[39m
    [90m232| [39m
    [90m233| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m234| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m235| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[358/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mskipIf conditions[2m > [22mshould not skip pages when skipIf is false
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m266:71[22m[39m
    [90m264| [39m      ][33m;[39m
    [90m265| [39m
    [90m266| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m267| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m268| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[359/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mCombined visibleIf and skipIf[2m > [22mshould apply visibleIf before skipIf
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m306:71[22m[39m
    [90m304| [39m      ][33m;[39m
    [90m305| [39m
    [90m306| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m307| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m308| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[360/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mHelper methods[2m > [22mshould get first page
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m343:71[22m[39m
    [90m341| [39m      ][33m;[39m
    [90m342| [39m
    [90m343| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m344| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m345| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[361/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mHelper methods[2m > [22mshould return null for first page if all pages hidden
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m367:71[22m[39m
    [90m365| [39m      const mockValues = [{ runId: 'run1', stepId: 'step1', value: fal‚Ä¶
    [90m366| [39m
    [90m367| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m368| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m369| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[362/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mHelper methods[2m > [22mshould validate page navigability
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m392:71[22m[39m
    [90m390| [39m      const mockValues = [{ runId: 'run1', stepId: 'step1', value: fal‚Ä¶
    [90m391| [39m
    [90m392| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m393| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m394| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[363/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mHelper methods[2m > [22mshould get page sequence
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m420:71[22m[39m
    [90m418| [39m      const mockValues = [{ runId: 'run1', stepId: 'step1', value: tru‚Ä¶
    [90m419| [39m
    [90m420| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m421| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m422| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[364/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mError handling[2m > [22mshould default to visible on visibleIf evaluation error
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m447:71[22m[39m
    [90m445| [39m      ][33m;[39m
    [90m446| [39m
    [90m447| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m448| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m449| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[365/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mError handling[2m > [22mshould default to not skipping on skipIf evaluation error
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m470:71[22m[39m
    [90m468| [39m      ][33m;[39m
    [90m469| [39m
    [90m470| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m471| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m472| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[366/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mProgress calculation[2m > [22mshould calculate correct progress for multi-page workflow
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m495:71[22m[39m
    [90m493| [39m      ][33m;[39m
    [90m494| [39m
    [90m495| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m496| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m497| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[367/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mProgress calculation[2m > [22mshould adjust progress when pages are skipped
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'mockResolvedValue')[39m
[36m [2m‚ùØ[22m tests/unit/services/intakeNavigation.test.ts:[2m533:71[22m[39m
    [90m531| [39m      const mockValues = [{ runId: 'run1', stepId: 'step1', value: tru‚Ä¶
    [90m532| [39m
    [90m533| [39m      vi.mocked(repositories.sectionRepository.findByWorkflowId as any‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m534| [39m      vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliase‚Ä¶
    [90m535| [39m      vi.mocked(repositories.stepValueRepository.findByRunId as any).m‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[368/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mHidden question value clearing[2m > [22mshould clear values for hidden questions
[31m[1mTypeError[22m: this.stepValueRepo.deleteWhere is not a function[39m
[36m [2m‚ùØ[22m IntakeQuestionVisibilityService.clearHiddenQuestionValues server/services/IntakeQuestionVisibilityService.ts:[2m339:32[22m[39m
    [90m337| [39m      [35mconst[39m { stepValues } [33m=[39m [35mawait[39m [35mimport[39m([32m"../../shared/schema"[39m)[33m;[39m
    [90m338| [39m
    [90m339| [39m      await this.stepValueRepo.deleteWhere(inArray(stepValues.id, idsT‚Ä¶
    [90m   | [39m                               [31m^[39m
    [90m340| [39m
    [90m341| [39m      logger[33m.[39m[34mdebug[39m(
[90m [2m‚ùØ[22m tests/unit/services/intakeQuestionVisibility.test.ts:[2m425:23[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[369/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mCascading visibility[2m > [22mshould handle questions that depend on each other
[31m[1mAssertionError[22m: expected [ 'q1' ] to deeply equal [ 'q1', 'q2', 'q3' ][39m

[32m- Expected[39m
[31m+ Received[39m

[2m  [[22m
[2m    "q1",[22m
[32m-   "q2",[39m
[32m-   "q3",[39m
[2m  ][22m

[36m [2m‚ùØ[22m tests/unit/services/intakeQuestionVisibility.test.ts:[2m615:40[22m[39m
    [90m613| [39m      const result2 = await service.evaluatePageQuestions('section1', ‚Ä¶
    [90m614| [39m
    [90m615| [39m      expect(result2.visibleQuestions).toEqual(['q1', 'q2', 'q3']); //‚Ä¶
    [90m   | [39m                                       [31m^[39m
    [90m616| [39m    })[33m;[39m
    [90m617| [39m  })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[370/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mcreateStep[2m > [22mshould create a step with auto-incrementing order
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ ObjectContaining{‚Ä¶} ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[32m-   ObjectContaining {[90m
[32m-     "order": 3,[90m
[31m+   {[90m
[31m+     "options": {},[90m
[31m+     "order": 1,[90m
[31m+     "required": false,[90m
[2m      "sectionId": "section-yt93gg",[22m
[31m+     "title": "New Step",[90m
[31m+     "type": "short_text",[90m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2m‚ùØ[22m tests/unit/services/StepService.test.ts:[2m65:35[22m[39m
    [90m 63| [39m
    [90m 64| [39m      [34mexpect[39m(result[33m.[39morder)[33m.[39m[34mtoBe[39m([34m3[39m)[33m;[39m
    [90m 65| [39m      [34mexpect[39m(mockStepRepo[33m.[39mcreate)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                  [31m^[39m
    [90m 66| [39m        expect[33m.[39m[34mobjectContaining[39m({
    [90m 67| [39m          sectionId[33m:[39m section[33m.[39mid[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[371/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mgetVariable[2m > [22mshould find variable by key
[31m[1mAssertionError[22m: expected { key: 'step-uuid-123', ‚Ä¶(6) } to deeply equal { key: 'step-uuid-123', ‚Ä¶(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[2m    "alias": "firstName",[22m
[2m    "key": "step-uuid-123",[22m
[32m-   "title": "First Name",[39m
[31m+   "label": "First Name",[39m
[31m+   "sectionId": "sec-1",[39m
[31m+   "sectionTitle": "Section 1",[39m
[31m+   "stepId": "step-1",[39m
[2m    "type": "short_text",[22m
[2m  }[22m

[36m [2m‚ùØ[22m tests/unit/utils/variableResolver.test.ts:[2m125:22[22m[39m
    [90m123| [39m      const result = VariableResolver.getVariable("step-uuid-123", moc‚Ä¶
    [90m124| [39m
    [90m125| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m126| [39m        key[33m:[39m [32m"step-uuid-123"[39m[33m,[39m
    [90m127| [39m        alias[33m:[39m [32m"firstName"[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[372/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mgetVariable[2m > [22mshould find variable by alias
[31m[1mAssertionError[22m: expected { key: 'step-uuid-123', ‚Ä¶(6) } to deeply equal { key: 'step-uuid-123', ‚Ä¶(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[2m    "alias": "firstName",[22m
[2m    "key": "step-uuid-123",[22m
[32m-   "title": "First Name",[39m
[31m+   "label": "First Name",[39m
[31m+   "sectionId": "sec-1",[39m
[31m+   "sectionTitle": "Section 1",[39m
[31m+   "stepId": "step-1",[39m
[2m    "type": "short_text",[22m
[2m  }[22m

[36m [2m‚ùØ[22m tests/unit/utils/variableResolver.test.ts:[2m136:22[22m[39m
    [90m134| [39m      const result = VariableResolver.getVariable("firstName", mockVar‚Ä¶
    [90m135| [39m
    [90m136| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m137| [39m        key[33m:[39m [32m"step-uuid-123"[39m[33m,[39m
    [90m138| [39m        alias[33m:[39m [32m"firstName"[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[373/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mgetVariable[2m > [22mshould handle variable with null alias
[31m[1mAssertionError[22m: expected { key: 'step-uuid-789', ‚Ä¶(6) } to deeply equal { key: 'step-uuid-789', ‚Ä¶(2) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[2m    "alias": null,[22m
[2m    "key": "step-uuid-789",[22m
[31m+   "label": "Email",[39m
[31m+   "sectionId": "section-1",[39m
[31m+   "sectionTitle": "Section 1",[39m
[31m+   "stepId": "step-uuid-789",[39m
[2m    "type": "short_text",[22m
[2m  }[22m

[36m [2m‚ùØ[22m tests/unit/utils/variableResolver.test.ts:[2m175:22[22m[39m
    [90m173| [39m      const result = VariableResolver.getVariable("step-uuid-789", moc‚Ä¶
    [90m174| [39m
    [90m175| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m176| [39m        key[33m:[39m [32m"step-uuid-789"[39m[33m,[39m
    [90m177| [39m        alias[33m:[39m [35mnull[39m[33m,[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[374/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/writes/WriteRunner.test.ts[2m > [22mWriteRunner[2m > [22mMode: Create[2m > [22mshould resolve values and call createRowWithValues
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ ObjectContaining{‚Ä¶}, ‚Ä¶(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m‚ùØ[22m tests/unit/writes/WriteRunner.test.ts:[2m143:65[22m[39m
    [90m141| [39m                { columnId[33m:[39m [32m"col-age"[39m[33m,[39m value[33m:[39m [34m30[39m }
    [90m142| [39m            ][33m;[39m
    [90m143| [39m            expect(datavaultRowsRepository.createRowWithValues).toHave‚Ä¶
    [90m   | [39m                                                                [31m^[39m
    [90m144| [39m                expect.objectContaining({ tableId: "table-users", tena‚Ä¶
    [90m145| [39m                expect[33m.[39m[34marrayContaining[39m([

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[375/448]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/unit/writes/WriteRunner.test.ts[2m > [22mWriteRunner[2m > [22mMode: Update[2m > [22mshould find row by PK and update
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'row-existing-1', [ { ‚Ä¶(2) } ] ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2m‚ùØ[22m tests/unit/writes/WriteRunner.test.ts:[2m192:61[22m[39m
    [90m190| [39m                "table-users", "col-email", "test@example.com", mockTe‚Ä¶
    [90m191| [39m            )[33m;[39m
    [90m192| [39m            expect(datavaultRowsRepository.updateRowValues).toHaveBeen‚Ä¶
    [90m   | [39m                                                            [31m^[39m
    [90m193| [39m                [32m"row-existing-1"[39m[33m,[39m
    [90m194| [39m                [{ columnId[33m:[39m [32m"col-status"[39m[33m,[39m value[33m:[39m [32m"Active"[39m }]

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[376/448]‚éØ[22m[39m


[2m Test Files [22m [1m[31m57 failed[39m[22m[2m | [22m[1m[32m97 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (155)[39m
[2m      Tests [22m [1m[31m407 failed[39m[22m[2m | [22m[1m[32m2061 passed[39m[22m[2m | [22m[33m67 skipped[39m[90m (2535)[39m
[2m   Start at [22m 09:44:52
[2m   Duration [22m 83.63s[2m (transform 32.70s, setup 43.71s, import 278.77s, tests 677.71s, environment 6.22s)[22m

