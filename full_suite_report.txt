npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.
 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

stderr | tests/unit/services/AuthService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "dbInitPromise" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:107:34
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884055655,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767884055656,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"responseTokens":90,"totalTokens":1302,"durationMs":1,"estimatedCostUSD":0.01482,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884055659,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":5,"msg":"AI workflow generation failed"}
{"level":30,"time":1767884055673,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767884055674,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":49,"totalTokens":1250,"durationMs":1,"estimatedCostUSD":0.013479999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884055674,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767884055768,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767884055769,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":68,"totalTokens":1269,"durationMs":1,"estimatedCostUSD":0.01405,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884055769,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767884055811,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767884055829,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":89,"totalTokens":1290,"durationMs":18,"estimatedCostUSD":0.014679999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884055830,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":19,"msg":"AI workflow generation failed"}
{"level":30,"time":1767884055834,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1767884055834,"env":"test","module":"ai-service","attempt":0,"waitMs":1000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1767884056298,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
{"level":30,"time":1767884056526,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884056543,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884056593,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884056596,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884056618,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884056641,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884056658,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884056663,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884056676,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884056683,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884056710,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":40,"time":1767884056836,"env":"test","module":"ai-service","attempt":1,"waitMs":2000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767884057833,"env":"test","module":"user-credentials-repository","userId":"jxUHeQZ-pUOaEIe8Kswpa","msg":"User credentials created"}
{"level":30,"time":1767884057923,"env":"test","module":"user-credentials-repository","userId":"yUG4pFElnAzmW98lSUQ7n","msg":"User credentials created"}
{"level":30,"time":1767884058015,"env":"test","module":"auth-routes","userId":"jxUHeQZ-pUOaEIe8Kswpa","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1767884058211,"env":"test","module":"user-credentials-repository","userId":"93193f78-bbdf-4743-9b6a-9018596be0bc","msg":"User credentials created"}
{"level":30,"time":1767884058316,"env":"test","module":"email-queue","jobId":"a1e3e2af-8677-433f-bebd-a8240209369a","to":"test-1767884057785-fhwz3w@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884058363,"env":"test","module":"user-credentials-repository","userId":"h9WzxQWCvN1eL_8qr6tq9","msg":"User credentials created"}
{"level":30,"time":1767884058376,"env":"test","module":"auth-routes","userId":"93193f78-bbdf-4743-9b6a-9018596be0bc","email":"test-1767884057785-fhwz3w@example.com","msg":"User registered"}
{"level":30,"time":1767884058473,"env":"test","module":"auth-routes","userId":"h9WzxQWCvN1eL_8qr6tq9","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1767884058572,"env":"test","module":"user-credentials-repository","userId":"7KiXa_Qu7o68sOmcLQHYQ","msg":"User credentials created"}
{"level":30,"time":1767884058686,"env":"test","module":"auth-routes","userId":"b77cf6207d70a3142935107f0a560ca1","msg":"User logged in successfully"}
{"level":30,"time":1767884058744,"env":"test","module":"audit-log-service","userId":"b77cf6207d70a3142935107f0a560ca1","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767884058762,"env":"test","module":"auth-routes","userId":"93193f78-bbdf-4743-9b6a-9018596be0bc","email":"test-1767884057785-fhwz3w@example.com","msg":"Login blocked: email not verified"}
{"level":50,"time":1767884058762,"env":"test","module":"auth-routes","error":{"name":"EmailNotVerifiedError","code":"AUTH_006","statusCode":403,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884058821,"env":"test","module":"user-credentials-repository","userId":"P0yLts3NyMfUfD_S9RBXw","msg":"User credentials created"}
{"level":40,"time":1767884058836,"env":"test","module":"ai-service","attempt":2,"waitMs":4000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767884058878,"env":"test","module":"auth-routes","userId":"047a17a0e4190efd42b7b8d4415a9d57","msg":"User logged in successfully"}
{"level":30,"time":1767884058930,"env":"test","module":"auth-routes","userId":"P0yLts3NyMfUfD_S9RBXw","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767884058934,"env":"test","module":"audit-log-service","userId":"047a17a0e4190efd42b7b8d4415a9d57","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884059147,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884059169,"env":"test","module":"auth-routes","userId":"83d123ac73a4dda5b539afc4939bae18","msg":"Login requires MFA verification"}
{"level":30,"time":1767884059268,"env":"test","module":"user-credentials-repository","userId":"7RBp22mIR81DSZwJRnyOf","msg":"User credentials created"}
{"level":30,"time":1767884059272,"env":"test","module":"auth-routes","userId":"b77cf6207d70a3142935107f0a560ca1","msg":"User logged in successfully"}
{"level":30,"time":1767884059286,"env":"test","module":"mfa-service","userId":"83d123ac73a4dda5b539afc4939bae18","msg":"TOTP verification successful"}
{"level":30,"time":1767884059293,"env":"test","module":"user-credentials-repository","userId":"xZk3fGtDlcVG0pIR-53uy","msg":"User credentials created"}
{"level":30,"time":1767884059325,"env":"test","module":"audit-log-service","userId":"b77cf6207d70a3142935107f0a560ca1","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884059347,"env":"test","module":"auth-routes","userId":"93193f78-bbdf-4743-9b6a-9018596be0bc","msg":"User logged in successfully"}
{"level":30,"time":1767884059348,"env":"test","module":"auth-routes","userId":"83d123ac73a4dda5b539afc4939bae18","msg":"MFA login successful"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts[2m > [22m[2mAuthService[2m > [22m[2mJWT Token Management[2m > [22m[2mverifyToken()[2m > [22m[2mshould throw error for invalid token signature
[22m[39mDEBUG: verifyToken threw: Invalid or malformed token InvalidTokenError

{"level":30,"time":1767884059399,"env":"test","module":"auth-routes","userId":"xZk3fGtDlcVG0pIR-53uy","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767884059400,"env":"test","module":"audit-log-service","userId":"93193f78-bbdf-4743-9b6a-9018596be0bc","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884059406,"env":"test","module":"mfa-service","userId":"047a17a0e4190efd42b7b8d4415a9d57","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767884059406,"env":"test","module":"mfa-service","userId":"047a17a0e4190efd42b7b8d4415a9d57","msg":"Generated TOTP secret"}
{"level":30,"time":1767884059406,"env":"test","module":"auth-routes","userId":"047a17a0e4190efd42b7b8d4415a9d57","msg":"MFA setup initiated"}
{"level":30,"time":1767884059530,"env":"test","module":"auth-routes","userId":"83d123ac73a4dda5b539afc4939bae18","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1767884059617,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767884059621,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":40,"time":1767884059647,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767884059655,"env":"test","module":"user-credentials-repository","userId":"riHNqc3Y0jpiy0Mz-BQQC","msg":"User credentials created"}
{"level":40,"time":1767884059649,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1767884059651,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1767884059655,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767884059657,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767884059659,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767884059661,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767884059748,"env":"test","module":"mfa-service","userId":"047a17a0e4190efd42b7b8d4415a9d57","msg":"MFA enabled successfully"}
{"level":30,"time":1767884059748,"env":"test","module":"auth-routes","userId":"047a17a0e4190efd42b7b8d4415a9d57","msg":"MFA enabled successfully"}
{"level":40,"time":1767884059761,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767884059778,"env":"test","module":"user-credentials-repository","userId":"1wGAGR7bEaIDTxWfcEFil","msg":"User credentials created"}
{"level":30,"time":1767884059803,"env":"test","module":"audit-log-service","userId":"047a17a0e4190efd42b7b8d4415a9d57","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884059864,"env":"test","module":"auth-routes","userId":"b77cf6207d70a3142935107f0a560ca1","msg":"User logged in successfully"}
{"level":30,"time":1767884059920,"env":"test","module":"audit-log-service","userId":"b77cf6207d70a3142935107f0a560ca1","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884059945,"env":"test","module":"auth-routes","userId":"1wGAGR7bEaIDTxWfcEFil","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767884060038,"env":"test","module":"auth-routes","userId":"b77cf6207d70a3142935107f0a560ca1","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767884060118,"env":"test","module":"user-credentials-repository","userId":"svF01ghuKnCxVtbE143jy","msg":"User credentials created"}
{"level":40,"time":1767884060282,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767884060288,"env":"test","module":"user-credentials-repository","userId":"4ctVdRhOUKNLwMjlGn_BM","msg":"User credentials created"}
{"level":30,"time":1767884060401,"env":"test","module":"auth-routes","userId":"4ctVdRhOUKNLwMjlGn_BM","sessionCount":0,"msg":"Listed active sessions"}
{"level":50,"time":1767884060495,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884060647,"env":"test","module":"user-credentials-repository","userId":"qtAEmGHp-fiiiYsVGHOXb","msg":"User credentials created"}
{"level":30,"time":1767884060754,"env":"test","module":"user-credentials-repository","userId":"Ue2T3sr5xzpAU9CJPLmbT","msg":"User credentials created"}
{"level":50,"time":1767884060759,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884060768,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884060852,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884060852,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884060853,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884060853,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884060854,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884061038,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884061064,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884061095,"env":"test","module":"user-credentials-repository","userId":"Zd_9mE-WD154DSlxIDFJg","msg":"User credentials created"}
{"level":30,"time":1767884061180,"env":"test","module":"auth-routes","userId":"a6930f42120473017a7f868e4755b405","msg":"User logged in successfully"}
{"level":30,"time":1767884061180,"env":"test","module":"mfa-service","userId":"6c18a37c8532f3f030f35ec2200009f1","msg":"TOTP verification successful"}
{"level":30,"time":1767884061232,"env":"test","module":"audit-log-service","userId":"a6930f42120473017a7f868e4755b405","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884061233,"env":"test","module":"auth-routes","userId":"6c18a37c8532f3f030f35ec2200009f1","msg":"MFA login successful"}
{"level":30,"time":1767884061294,"env":"test","module":"user-credentials-repository","userId":"FPAAN-91eN5gdtdwEN7h-","msg":"User credentials created"}
{"level":50,"time":1767884061306,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884061351,"env":"test","module":"auth-routes","userId":"89c14aa24a1dbc9b2ed6e5f1e82b0341","msg":"User logged in successfully"}
{"level":30,"time":1767884061407,"env":"test","module":"audit-log-service","userId":"89c14aa24a1dbc9b2ed6e5f1e82b0341","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884061411,"env":"test","module":"auth-routes","userId":"6c18a37c8532f3f030f35ec2200009f1","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":40,"time":1767884061473,"env":"test","module":"auth-service","tokenHash":"32aef484255cfa00078732af1c2a3ed43ada817747093496c3b034bca979452b","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767884061531,"env":"test","module":"user-credentials-repository","userId":"9X2vMVx--7UxqlsFdDO8f","msg":"User credentials created"}
{"level":50,"time":1767884061565,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884061573,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767884061670,"env":"test","module":"mfa-service","userId":"a6930f42120473017a7f868e4755b405","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767884061670,"env":"test","module":"mfa-service","userId":"a6930f42120473017a7f868e4755b405","msg":"Generated TOTP secret"}
{"level":30,"time":1767884061670,"env":"test","module":"auth-routes","userId":"a6930f42120473017a7f868e4755b405","msg":"MFA setup initiated"}
{"level":40,"time":1767884061776,"env":"test","module":"mfa-service","userId":"a6930f42120473017a7f868e4755b405","msg":"No MFA secret found for user"}
{"level":50,"time":1767884061824,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884061828,"env":"test","module":"user-credentials-repository","userId":"8lZNx-iM1blASJdGsQBcq","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884061892,"env":"test","module":"user-credentials-repository","userId":"xPoKk8MN0gZemWVm-oqvo","msg":"User credentials created"}
{"level":30,"time":1767884061914,"env":"test","module":"auth-routes","userId":"89c14aa24a1dbc9b2ed6e5f1e82b0341","msg":"User logged in successfully"}
{"level":30,"time":1767884061965,"env":"test","module":"audit-log-service","userId":"89c14aa24a1dbc9b2ed6e5f1e82b0341","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884062032,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767884062079,"env":"test","module":"auth-routes","userId":"89c14aa24a1dbc9b2ed6e5f1e82b0341","sessionCount":1,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #8: Placeholder user cleanup[2m > [22m[2mshould cleanup placeholder user when invite is revoked
[22m[39mCleaned up placeholder user db280b6d-e6b1-4641-9ea4-370b85384e6b (no pending invites or memberships)

{"level":30,"time":1767884062316,"env":"test","module":"user-credentials-repository","userId":"5YgjoMRl2qtYinRdOVQdf","msg":"User credentials created"}
stderr | tests/integration/auth/auth.middleware.integration.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:189:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1767884062453,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1767884062468,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884062473,"env":"test","module":"user-credentials-repository","userId":"6R4twhBc9vDClpi7BbY2i","msg":"User credentials created"}
{"level":30,"time":1767884062459,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884062460,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884062464,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884062467,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884062467,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884062468,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884062468,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767884062602,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884062616,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884062608,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884062608,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884062611,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884062615,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884062615,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884062616,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884062616,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1767884062627,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884062643,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts[2m > [22m[2mTemplates and Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884062634,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884062635,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884062638,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884062642,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884062642,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884062643,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884062643,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1767884062673,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767884062674,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884062674,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884062674,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767884062676,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
 [31mÎ“Â¥Â»[39m tests/unit/middleware/auth.middleware.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 7771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with valid JWT token [33m 520[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 for missing token[39m[32m 14[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 401 for invalid token[32m 2[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for expired token [33m 506[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should extract token without Bearer prefix [33m 449[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with valid token [33m 433[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should proceed without auth when no token provided[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should proceed even with invalid token[32m 0[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with JWT Bearer token [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with refresh token cookie for GET requests [33m 572[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject cookie auth for POST requests [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prioritize JWT over cookie when both present [33m 928[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow cookie auth only for safe methods [33m 777[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 401 when no auth provided[32m 1[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with JWT [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with cookie for GET [33m 542[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should proceed without auth when none provided[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should proceed even with invalid auth[32m 0[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow token tampering [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow cookie auth for mutations (CSRF protection) [33m 446[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject malformed JWT[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle missing authorization header gracefully[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 8129[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should hash a password using bcrypt with 12 rounds[32m 226[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate different hashes for same password [33m 575[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle empty passwords[32m 255[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle long passwords[32m 297[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle unicode characters in password[32m 295[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return true for correct password [33m 504[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return false for incorrect password [33m 441[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should be case-sensitive [33m 439[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle empty password comparison [33m 459[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept valid email addresses[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails longer than 254 characters (RFC 5321)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails shorter than 3 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with consecutive dots[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without @ symbol[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without domain[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with spaces[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without TLD[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject null or undefined[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with local part longer than 64 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept valid strong passwords[32m 37[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject passwords shorter than 8 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject passwords longer than 128 characters[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject weak passwords with zxcvbn score < 3[32m 6[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should provide helpful feedback for weak passwords[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject password containing user's email[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject password containing user's name[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept strong password even with user inputs provided[32m 4[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept password with exactly 8 characters if strong enough[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept password with exactly 128 characters if strong[32m 89[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return score in result object[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create a valid JWT token for a user[32m 5[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include userId, email, tenantId, and role in token payload[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should set token expiry to 15 minutes by default[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error if JWT_SECRET is not configured[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle null tenantId and role[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify and decode a valid token[32m 2[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error for expired token [33m 1103[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for invalid token signature[39m[32m 10[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for malformed token[39m[32m 2[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for invalid token[39m[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should extract token from Bearer authorization header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return token if no Bearer prefix[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for undefined header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for empty header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle Bearer with multiple spaces[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return true for JWT-like tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for non-JWT tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for empty token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for null/undefined[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create a valid portal token for an email[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include email and portal flag in token payload[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should set token expiry to 24 hours[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify and decode a valid portal token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for non-portal token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for token without email[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for expired portal token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should generate password reset token for existing user[32m 235[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for non-existent user[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should invalidate previous reset tokens[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return userId for valid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for invalid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for used token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should mark token as used[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should generate verification token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should have 24 hour expiry[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify email with valid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for invalid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for expired token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should delete token after successful verification[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create refresh token with 30-day expiry[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should store device metadata[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return userId for valid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for revoked token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should rotate valid token and return new one[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for unknown token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all tokens on reuse detection[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke specific token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all tokens for user[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired refresh tokens[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired password reset tokens[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired email verification tokens[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup old login attempts via accountLockoutService[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should use JWT_SECRET if provided[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should warn if JWT_SECRET is less than 32 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject token with modified payload[32m 6[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject token with valid structure but invalid signature[39m[32m 2[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with special characters [33m 478[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle password with only spaces[32m 254[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with newlines and tabs [33m 474[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject password with null bytes (if validation exists) [33m 449[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email with unicode domain (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email starting with dot (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email ending with dot before @ (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle email with plus addressing[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle email with subdomain[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email with invalid TLD (single char)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept email with numeric TLD[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should prevent timing attacks on token validation[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should support full user authentication lifecycle[32m 234[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support complete password reset workflow [33m 460[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should prevent reuse of password reset tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should support multiple valid refresh tokens per user[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all user tokens on security event[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle database connection failures gracefully[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle transaction failures[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error if JWT signing fails[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should hash password in reasonable time (< 500ms)[32m 217[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should compare password in reasonable time (< 500ms) [33m 445[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create JWT token in < 10ms[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify JWT token in < 10ms[32m 2[2mms[22m[39m
{"level":40,"time":1767884062739,"env":"test","module":"auth-service","userId":"6R4twhBc9vDClpi7BbY2i","tokenHash":"dbbf6e248c07e192789742f1282b1260e70183d58e81dc9baa9c18ff35cddfeb","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1767884062807,"env":"test","module":"user-credentials-repository","userId":"mdjsaQ1vrDF3FzexOd9pk","msg":"User credentials created"}
{"level":50,"time":1767884062813,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884062834,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767884062838,"env":"test","module":"ai-service","attempt":3,"waitMs":8000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1767884062945,"env":"test","module":"mfa-service","userId":"a5e107ac6518e6401a63cfd67bdab955","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884062945,"env":"test","module":"auth-routes","userId":"a5e107ac6518e6401a63cfd67bdab955","msg":"MFA verification failed during login"}
{"level":50,"time":1767884062952,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":50,"time":1767884063057,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884063072,"env":"test","module":"user-credentials-repository","userId":"8f78a989-f2f5-4975-aa66-c346cc479f90","msg":"User credentials created"}
{"level":30,"time":1767884063097,"env":"test","module":"user-credentials-repository","userId":"d383900e-bf0a-4c7f-a6d6-b4d6e320d55b","msg":"User credentials created"}
{"level":30,"time":1767884063129,"env":"test","module":"user-credentials-repository","userId":"rLAokeh8Twqf9_IoOkrai","msg":"User credentials created"}
{"level":30,"time":1767884063131,"env":"test","module":"user-credentials-repository","userId":"4f0d1a7d-d470-4891-924f-edd1ac71309e","msg":"User credentials created"}
{"level":30,"time":1767884063149,"env":"test","module":"user-credentials-repository","userId":"r85u7t1mihvYDlmLKcwBb","msg":"User credentials created"}
stderr | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:70:7 {
  length: 336,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(71f3ce14-24bc-4301-b728-934868fa540c) is still referenced from table "workflows".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflows',
  column: undefined,
  dataType: undefined,
  constraint: 'workflows_creator_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/organizations-audit-fixes.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 8255[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should cascade ownership to workflow runs when project is transferred [33m 1188[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent double-acceptance via transaction [33m 926[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not create invite if email fails [33m 522[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow re-invite after invite expires [33m 1085[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow last admin to delete empty organization [33m 624[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent deletion if org owns assets[39m[33m 902[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should cleanup placeholder user when invite is revoked [33m 1093[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should fail fast on non-existent org [33m 485[2mms[22m[39m
{"level":50,"time":1767884063170,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884063185,"env":"test","module":"email-queue","jobId":"bb1351ba-1e59-42cb-8000-55fdd424667a","to":"test-v7WlswvEhFXsoOHRVZH50@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884063197,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884063199,"env":"test","module":"email-queue","jobId":"9bb0dbcd-0453-490a-a4c9-2e077d94b704","to":"test-PHGxPzlqS6pvOm7rVF_aT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884063212,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884063204,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884063205,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884063208,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884063212,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884063212,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884063212,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884063212,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767884063236,"env":"test","module":"email-queue","jobId":"03c9dbf9-4147-42df-9477-0ec871c112ba","to":"test-d7MsZT074tAb7-iEZTMP3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884063241,"env":"test","module":"auth-routes","userId":"8f78a989-f2f5-4975-aa66-c346cc479f90","email":"test-v7WlswvEhFXsoOHRVZH50@example.com","msg":"User registered"}
{"level":30,"time":1767884063253,"env":"test","module":"auth-routes","userId":"d383900e-bf0a-4c7f-a6d6-b4d6e320d55b","email":"test-PHGxPzlqS6pvOm7rVF_aT@example.com","msg":"User registered"}
{"level":30,"time":1767884063291,"env":"test","module":"auth-routes","userId":"4f0d1a7d-d470-4891-924f-edd1ac71309e","email":"test-d7MsZT074tAb7-iEZTMP3@example.com","msg":"User registered"}
{"level":30,"time":1767884063352,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884063367,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884063358,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884063358,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884063362,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884063367,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884063367,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884063367,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884063367,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767884063381,"env":"test","module":"auth-routes","userId":"b154441cc42e2b5674bf5d89f6905d94","msg":"User logged in successfully"}
{"level":30,"time":1767884063435,"env":"test","module":"audit-log-service","userId":"b154441cc42e2b5674bf5d89f6905d94","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884063453,"env":"test","module":"auth-routes","userId":"f16ca53fec592223fa1cdb347a175fea","msg":"Login requires MFA verification"}
{"level":30,"time":1767884063476,"env":"test","module":"auth-routes","userId":"r85u7t1mihvYDlmLKcwBb","msg":"All other sessions revoked"}
{"level":50,"time":1767884063479,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884063538,"env":"test","module":"audit-log-service","userId":"r85u7t1mihvYDlmLKcwBb","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":50,"time":1767884063655,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884063666,"env":"test","module":"user-credentials-repository","userId":"78132345-863a-4019-9abc-95141990dd44","msg":"User credentials created"}
{"level":50,"time":1767884063702,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884063727,"env":"test","module":"user-credentials-repository","userId":"_5EMCLRkBaigJI88WAP5n","msg":"User credentials created"}
{"level":30,"time":1767884063766,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1767884063772,"env":"test","module":"email-queue","jobId":"515c637a-70a4-46c7-a8c2-c1d85eb5d919","to":"test-9thXRzB7Tn5TouupV5Vjl@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjgwNWVlYTkyLTBhYjYtNGVlOC1hZjNlLTYwY2Q4NDYzNmM2MSIsInJvbGUiOiJhZG1pbiIsInRlbmFudFJvbGUiOiJvd25lciIsImlhdCI6MTc2Nzg4NDA2MywiZXhwIjoxNzY3ODg0OTYzfQ._yrMej1c9TU7ZniunHKTv1WtYto2rBNh-Qhp88rga8o",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": null,
    "lastName": null,
    "profileImageUrl": null,
    "tenantId": "805eea92-0ab6-4ee8-af3e-60cd84636c61",
    "role": "admin",
    "tenantRole": "owner"
  }
}

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":50,"time":1767884063813,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767884063827,"env":"test","module":"auth-service","tokenHash":"b90063485a53958457b25c6e805af67b440567669727425568e3186f0b424876","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767884063828,"env":"test","module":"auth-routes","userId":"78132345-863a-4019-9abc-95141990dd44","email":"test-9thXRzB7Tn5TouupV5Vjl@example.com","msg":"User registered"}
{"level":30,"time":1767884063895,"env":"test","module":"user-credentials-repository","userId":"d72f746a-13e2-4d18-8de7-f3625112eac2","msg":"User credentials created"}
{"level":50,"time":1767884063916,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884063918,"env":"test","module":"user-credentials-repository","userId":"e82b1168-2fe3-4072-894f-f3a2aaf88fcd","msg":"User credentials created"}
{"level":30,"time":1767884063930,"env":"test","module":"user-credentials-repository","userId":"knVDzPpR8I0Z6U-pn-qlW","msg":"User credentials created"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1767884063986,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1767884063997,"env":"test","module":"email-queue","jobId":"3d6e4666-4ee5-47d6-aaf4-1b0141e3e1aa","to":"protected-test-1-3kevDn4R6IkCVCOFTUn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884064020,"env":"test","module":"email-queue","jobId":"a8dcf838-73f6-40b0-88fd-0e15c70fd612","to":"middleware-test-6-TFgxutA6dKeHm94DZZJ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884064052,"env":"test","module":"auth-routes","userId":"d72f746a-13e2-4d18-8de7-f3625112eac2","email":"protected-test-1-3kevDn4R6IkCVCOFTUn@example.com","msg":"User registered"}
{"level":30,"time":1767884064072,"env":"test","module":"auth-routes","userId":"e82b1168-2fe3-4072-894f-f3a2aaf88fcd","email":"middleware-test-6-TFgxutA6dKeHm94DZZJ@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884064155,"env":"test","module":"user-credentials-repository","userId":"cXWlWuGUyFKs_F1s-QFF-","msg":"User credentials created"}
{"level":30,"time":1767884064156,"env":"test","module":"auth-routes","userId":"knVDzPpR8I0Z6U-pn-qlW","msg":"All other sessions revoked"}
{"level":30,"time":1767884064211,"env":"test","module":"audit-log-service","userId":"knVDzPpR8I0Z6U-pn-qlW","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767884064364,"env":"test","module":"user-credentials-repository","userId":"074d1935-71e0-4f4a-96e3-54043e66774e","msg":"User credentials created"}
{"level":50,"time":1767884064384,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884064408,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884064466,"env":"test","module":"email-queue","jobId":"e366faea-24b5-4793-9c54-fac9ed8882d2","to":"session-test-6jCYg-5rzPVzincTZCrPi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884064523,"env":"test","module":"auth-routes","userId":"074d1935-71e0-4f4a-96e3-54043e66774e","email":"session-test-6jCYg-5rzPVzincTZCrPi@example.com","msg":"User registered"}
{"level":50,"time":1767884064523,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884064528,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884064597,"env":"test","module":"user-credentials-repository","userId":"mwvF4baNv2-jEtyXZEagT","msg":"User credentials created"}
{"level":50,"time":1767884064673,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"qpdf --decrypt \"C:\\Users\\scoot\\AppData\\Local\\Temp\\locked-1767884064596.pdf\" \"C:\\Users\\scoot\\AppData\\Local\\Temp\\unlocked-1767884064597.pdf\"","stdout":"","stderr":"'qpdf' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"Failed to unlock PDF with qpdf"}
{"level":40,"time":1767884064673,"env":"test","msg":"Returning original PDF buffer due to unlock failure"}
{"level":50,"time":1767884064675,"env":"test","error":{},"msg":"Failed to extract PDF fields"}
{"level":50,"time":1767884064676,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF processing failed"}
{"level":50,"time":1767884064676,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"c71a66d4-490b-4760-9b2c-dce4c1251b41"},"file":{"fieldname":"file","originalname":"test.pdf","encoding":"7bit","mimetype":"application/pdf","buffer":{"type":"Buffer","data":[37,80,68,70]},"size":4},"msg":"Error creating template"}
{"level":50,"time":1767884064786,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"c71a66d4-490b-4760-9b2c-dce4c1251b41"},"msg":"Error creating template"}
{"level":30,"time":1767884064806,"env":"test","module":"user-credentials-repository","userId":"eHB4XK078v0HZYPIDjpqQ","msg":"User credentials created"}
{"level":30,"time":1767884064821,"env":"test","module":"user-credentials-repository","userId":"22450ab2-04ae-4b53-b9a9-22479b8cff2c","msg":"User credentials created"}
{"level":30,"time":1767884064823,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884064843,"env":"test","module":"user-credentials-repository","userId":"cde778dd-5f52-49e8-999d-e5c83af67728","msg":"User credentials created"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884064882,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884064885,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884064933,"env":"test","module":"email-queue","jobId":"eddbb692-7abc-41ec-92b0-5867ce30be61","to":"middleware-test-gh7v-HTmTpLKqEEZBna8F@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884064948,"env":"test","module":"user-credentials-repository","userId":"rvbM3NwODiMMKC6pCd1lJ","msg":"User credentials created"}
{"level":30,"time":1767884064950,"env":"test","module":"email-queue","jobId":"531ed63d-5a21-4457-a169-54f396d4e5ab","to":"protected-test-wOTKjMRYJuuSp_zCIn6L1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884064951,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884064988,"env":"test","module":"auth-routes","userId":"22450ab2-04ae-4b53-b9a9-22479b8cff2c","email":"middleware-test-gh7v-HTmTpLKqEEZBna8F@example.com","msg":"User registered"}
{"level":40,"time":1767884064987,"env":"test","module":"mfa-service","userId":"49524a3c44e2639bc15cb66fb5846a01","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884064987,"env":"test","module":"auth-routes","userId":"49524a3c44e2639bc15cb66fb5846a01","msg":"MFA verification failed during login"}
{"level":50,"time":1767884064991,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884065000,"env":"test","module":"auth-routes","userId":"cde778dd-5f52-49e8-999d-e5c83af67728","email":"protected-test-wOTKjMRYJuuSp_zCIn6L1@example.com","msg":"User registered"}
{"level":30,"time":1767884065087,"env":"test","module":"auth-routes","userId":"f9fd5568df05472ae4db367bde900a9f","msg":"User logged in successfully"}
{"level":50,"time":1767884065140,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884065142,"env":"test","module":"audit-log-service","userId":"f9fd5568df05472ae4db367bde900a9f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884065254,"env":"test","module":"auth-routes","userId":"e6a4867e7312a77fa81b20d98d267a5f","msg":"User logged in successfully"}
{"level":50,"time":1767884065260,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884065264,"env":"test","module":"user-credentials-repository","userId":"8efc3075-d982-4a7c-86bf-49c82fd52f18","msg":"User credentials created"}
{"level":30,"time":1767884065279,"env":"test","module":"user-credentials-repository","userId":"7ZBJurtmmO2euV7JU-Cu3","msg":"User credentials created"}
{"level":50,"time":1767884065306,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884065307,"env":"test","module":"audit-log-service","userId":"e6a4867e7312a77fa81b20d98d267a5f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884065362,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767884065364,"env":"test","module":"mfa-service","userId":"49524a3c44e2639bc15cb66fb5846a01","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884065364,"env":"test","module":"auth-routes","userId":"49524a3c44e2639bc15cb66fb5846a01","msg":"MFA verification failed during login"}
{"level":50,"time":1767884065367,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884065369,"env":"test","module":"email-queue","jobId":"32fb02fd-9f63-4522-9afa-29e6b576d860","to":"session-test-ii0QG1Y81J685VeRC_VuE@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884065390,"env":"test","module":"auth-routes","userId":"7ZBJurtmmO2euV7JU-Cu3","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":30,"time":1767884065424,"env":"test","module":"auth-routes","userId":"8efc3075-d982-4a7c-86bf-49c82fd52f18","email":"session-test-ii0QG1Y81J685VeRC_VuE@example.com","msg":"User registered"}
{"level":30,"time":1767884065456,"env":"test","module":"user-credentials-repository","userId":"jtHC6alizmW4uNtvzNvl0","msg":"User credentials created"}
{"level":50,"time":1767884065506,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767884065592,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":50,"time":1767884065630,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884065691,"env":"test","module":"user-credentials-repository","userId":"2e09213b-31c1-4983-a210-ecaf816a318c","msg":"User credentials created"}
{"level":40,"time":1767884065732,"env":"test","module":"mfa-service","userId":"49524a3c44e2639bc15cb66fb5846a01","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884065732,"env":"test","module":"auth-routes","userId":"49524a3c44e2639bc15cb66fb5846a01","msg":"MFA verification failed during login"}
{"level":50,"time":1767884065735,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884065749,"env":"test","module":"user-credentials-repository","userId":"67203f5b-7f57-4051-81c8-d41aaf5020ef","msg":"User credentials created"}
{"level":30,"time":1767884065759,"env":"test","module":"mfa-service","userId":"e6a4867e7312a77fa81b20d98d267a5f","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767884065759,"env":"test","module":"mfa-service","userId":"e6a4867e7312a77fa81b20d98d267a5f","msg":"Generated TOTP secret"}
{"level":30,"time":1767884065759,"env":"test","module":"auth-routes","userId":"e6a4867e7312a77fa81b20d98d267a5f","msg":"MFA setup initiated"}
{"level":30,"time":1767884065784,"env":"test","module":"user-credentials-repository","userId":"cItOxFKoXmqV-AY5_dojw","msg":"User credentials created"}
{"level":30,"time":1767884065796,"env":"test","module":"email-queue","jobId":"4a29df8e-1bc1-4e0b-ad67-1b8e1dbf94ca","to":"middleware-test--_acMWsful1sfS-18OYb_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884065806,"env":"test","module":"auth-routes","userId":"eb26be242edc219c497a45fee5337a69","msg":"User logged in successfully"}
{"level":30,"time":1767884065844,"env":"test","module":"auth-routes","userId":"2e09213b-31c1-4983-a210-ecaf816a318c","email":"middleware-test--_acMWsful1sfS-18OYb_@example.com","msg":"User registered"}
{"level":30,"time":1767884065849,"env":"test","module":"email-queue","jobId":"12df6334-8788-47e1-9941-146bc4af1a29","to":"protected-test-5TxiDCJvUtGgdaSzFwk5g@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884065856,"env":"test","module":"audit-log-service","userId":"eb26be242edc219c497a45fee5337a69","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884065867,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884065870,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884065898,"env":"test","module":"auth-routes","userId":"67203f5b-7f57-4051-81c8-d41aaf5020ef","email":"protected-test-5TxiDCJvUtGgdaSzFwk5g@example.com","msg":"User registered"}
{"level":30,"time":1767884065900,"env":"test","module":"auth-routes","userId":"cItOxFKoXmqV-AY5_dojw","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":40,"time":1767884065907,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767884065941,"env":"test","module":"user-credentials-repository","userId":"66-wiHOev7eCHdB08jZc3","msg":"User credentials created"}
{"level":30,"time":1767884066028,"env":"test","module":"auth-routes","userId":"8efc3075-d982-4a7c-86bf-49c82fd52f18","msg":"User logged in successfully"}
{"level":30,"time":1767884066061,"env":"test","module":"auth-routes","userId":"cItOxFKoXmqV-AY5_dojw","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Trusted device expiry updated"}
{"level":30,"time":1767884066089,"env":"test","module":"audit-log-service","userId":"8efc3075-d982-4a7c-86bf-49c82fd52f18","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884066090,"env":"test","module":"mfa-service","userId":"e6a4867e7312a77fa81b20d98d267a5f","msg":"MFA enabled successfully"}
{"level":30,"time":1767884066090,"env":"test","module":"auth-routes","userId":"e6a4867e7312a77fa81b20d98d267a5f","msg":"MFA enabled successfully"}
{"level":50,"time":1767884066141,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":30,"time":1767884066143,"env":"test","module":"audit-log-service","userId":"e6a4867e7312a77fa81b20d98d267a5f","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884066262,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767884066276,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767884066311,"env":"test","module":"mfa-service","userId":"eb26be242edc219c497a45fee5337a69","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767884066311,"env":"test","module":"mfa-service","userId":"eb26be242edc219c497a45fee5337a69","msg":"Generated TOTP secret"}
{"level":30,"time":1767884066311,"env":"test","module":"auth-routes","userId":"eb26be242edc219c497a45fee5337a69","msg":"MFA setup initiated"}
{"level":30,"time":1767884066336,"env":"test","module":"user-credentials-repository","userId":"sy7LhhixrjcfeDh9ctCHr","msg":"User credentials created"}
{"level":30,"time":1767884066391,"env":"test","module":"auth-routes","userId":"2e09213b-31c1-4983-a210-ecaf816a318c","msg":"User logged in successfully"}
{"level":50,"time":1767884066407,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884066447,"env":"test","module":"audit-log-service","userId":"2e09213b-31c1-4983-a210-ecaf816a318c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884066448,"env":"test","module":"user-credentials-repository","userId":"3Z-AbByShyOuqtWAFXyAe","msg":"User credentials created"}
{"level":50,"time":1767884066453,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > reverts value on save error
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:204:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":30,"time":1767884066531,"env":"test","module":"user-credentials-repository","userId":"d07e32af-866e-4dd6-b709-9755e15d99af","msg":"User credentials created"}
{"level":30,"time":1767884066559,"env":"test","module":"auth-routes","userId":"3Z-AbByShyOuqtWAFXyAe","deviceCount":0,"msg":"Listed trusted devices"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > displays error indicator on save failure
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:220:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":40,"time":1767884066632,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767884066633,"env":"test","module":"user-credentials-repository","userId":"066b12aa-f8e0-4e28-b01f-8d9a95c1011f","msg":"User credentials created"}
{"level":30,"time":1767884066633,"env":"test","module":"email-queue","jobId":"06bf70df-4426-4d21-b540-1f9b349c5605","to":"session-test-9OLVkQa97s3Tpi6lIE6wG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767884066680,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767884066681,"env":"test","module":"auth-routes","userId":"d07e32af-866e-4dd6-b709-9755e15d99af","email":"session-test-9OLVkQa97s3Tpi6lIE6wG@example.com","msg":"User registered"}
{"level":40,"time":1767884066680,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767884066680,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767884066680,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767884066682,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767884066682,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767884066683,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
stderr | tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/regression-REG-1.test.ts:79:13 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(51c0b591-8159-41b3-ae4f-e5f61c356125) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767884066737,"env":"test","module":"email-queue","jobId":"0a716d17-5dbe-406a-a08f-033940dab43d","to":"protected-test-0qFhoEUsxpsA_KdDDq04I@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31mÎ“Â¥Â»[39m tests/integration/regression-REG-1.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 2661[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should block Next when required visible question is empty [33m 309[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should NOT block Next when required question is hidden[39m[33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should block when required becomes visible and is empty [33m 304[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip hidden required page entirely[39m[33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce required on visible page [33m 403[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should evaluate visibility consistently across modes[39m[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle malformed visibility expression gracefully[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle missing variable in visibility expression[32m 0[2mms[22m[39m
{"level":30,"time":1767884066790,"env":"test","module":"auth-routes","userId":"066b12aa-f8e0-4e28-b01f-8d9a95c1011f","email":"protected-test-0qFhoEUsxpsA_KdDDq04I@example.com","msg":"User registered"}
{"level":30,"time":1767884066854,"env":"test","module":"user-credentials-repository","userId":"c7c6d458-93bf-4d67-a793-a6d9b1d4c407","msg":"User credentials created"}
{"level":30,"time":1767884066893,"env":"test","module":"user-credentials-repository","userId":"KC62xWWbJLEahrIpnURyx","msg":"User credentials created"}
{"level":30,"time":1767884066907,"env":"test","module":"user-credentials-repository","userId":"bHcTmadHW2uYHdcyLkmWq","msg":"User credentials created"}
{"level":30,"time":1767884066958,"env":"test","module":"email-queue","jobId":"cd83cc04-fb16-4e69-91c6-5814df22515c","to":"middleware-test-pN1k1liL-lYFMKG6PuNMn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884067013,"env":"test","module":"auth-routes","userId":"c7c6d458-93bf-4d67-a793-a6d9b1d4c407","email":"middleware-test-pN1k1liL-lYFMKG6PuNMn@example.com","msg":"User registered"}
{"level":30,"time":1767884067017,"env":"test","module":"auth-routes","userId":"bHcTmadHW2uYHdcyLkmWq","deviceCount":0,"msg":"Listed trusted devices"}
{"level":50,"time":1767884067059,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884067136,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884067176,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767884067251,"env":"test","module":"mfa-service","userId":"5ed1d060d07115fd7d7b0a3d7738a3ed","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884067251,"env":"test","module":"auth-routes","userId":"5ed1d060d07115fd7d7b0a3d7738a3ed","msg":"MFA verification failed during login"}
{"level":50,"time":1767884067255,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884067260,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884067338,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884067392,"env":"test","module":"user-credentials-repository","userId":"WZShKalQz_7gi_rTrl72d","msg":"User credentials created"}
{"level":30,"time":1767884067466,"env":"test","module":"user-credentials-repository","userId":"7db5152e-de20-445c-9413-86307179d459","msg":"User credentials created"}
{"level":30,"time":1767884067537,"env":"test","module":"user-credentials-repository","userId":"scYdoWvRiNOlwNYPuP_aL","msg":"User credentials created"}
{"level":30,"time":1767884067547,"env":"test","module":"auth-routes","userId":"WZShKalQz_7gi_rTrl72d","deviceId":"a5e11bee-c408-4754-9c07-5066fec09657","msg":"Trusted device revoked"}
{"level":30,"time":1767884067571,"env":"test","module":"user-credentials-repository","userId":"9fd12a0a-f8d5-4afa-8e3d-e2628acbe41f","msg":"User credentials created"}
{"level":30,"time":1767884067592,"env":"test","module":"email-queue","jobId":"e45d6037-393a-46f5-bd39-4bf4201ed21a","to":"session-test-Tdngj19aD8M16_OkOIdho@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884067596,"env":"test","module":"auth-routes","userId":"c7c6d458-93bf-4d67-a793-a6d9b1d4c407","msg":"User logged in successfully"}
{"level":50,"time":1767884067601,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884067644,"env":"test","module":"auth-routes","userId":"7db5152e-de20-445c-9413-86307179d459","email":"session-test-Tdngj19aD8M16_OkOIdho@example.com","msg":"User registered"}
{"level":30,"time":1767884067650,"env":"test","module":"audit-log-service","userId":"c7c6d458-93bf-4d67-a793-a6d9b1d4c407","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884067671,"env":"test","module":"email-queue","jobId":"c5d26dbb-e3fa-4ed5-bc7c-e15cc173f4b3","to":"protected-test-oOEtvw_hjjaiwC0himf5f@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884067699,"env":"test","module":"auth-routes","userId":"d1c8ab3fa7eac84eb9a1442ee0dd345b","msg":"User logged in successfully"}
{"level":30,"time":1767884067722,"env":"test","module":"auth-routes","userId":"9fd12a0a-f8d5-4afa-8e3d-e2628acbe41f","email":"protected-test-oOEtvw_hjjaiwC0himf5f@example.com","msg":"User registered"}
{"level":30,"time":1767884067755,"env":"test","module":"audit-log-service","userId":"d1c8ab3fa7eac84eb9a1442ee0dd345b","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/datavault/EditableCell.test.tsx [2m([22m[2m29 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 3570[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders value in display mode initially[32m 31[2mms[22m[39m
       [32mÎ“Â£Ã´[39m shows double-click hint on hover[32m 138[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not show hint for read-only cells[32m 17[2mms[22m[39m
       [32mÎ“Â£Ã´[39m includes proper ARIA label with column name and value[32m 16[2mms[22m[39m
       [32mÎ“Â£Ã´[39m indicates read-only status in ARIA label[32m 15[2mms[22m[39m
       [32mÎ“Â£Ã´[39m is focusable when editable[32m 14[2mms[22m[39m
       [32mÎ“Â£Ã´[39m is not focusable when read-only[32m 14[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on double-click[32m 54[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on Enter key press[32m 28[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on Space key press[32m 29[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not enter edit mode when read-only[32m 12[2mms[22m[39m
       [32mÎ“Â£Ã´[39m focuses and selects input text on edit mode entry[32m 33[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves on blur[32m 113[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves on Enter key press[32m 85[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not save if value unchanged[32m 29[2mms[22m[39m
       [32mÎ“Â£Ã´[39m cancels edit on Escape key press[32m 80[2mms[22m[39m
       [32mÎ“Â£Ã´[39m reverts value on save error[32m 80[2mms[22m[39m
       [32mÎ“Â£Ã´[39m displays error indicator on save failure[32m 88[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders checkbox for boolean type[32m 33[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves immediately on checkbox change[32m 26[2mms[22m[39m
       [32mÎ“Â£Ã´[39m disables checkbox when read-only[32m 23[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m shows loading spinner when saving checkbox[39m[33m 1033[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders number input for number type[32m 26[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders email input for email type[32m 23[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders url input for url type[32m 24[2mms[22m[39m
       [32mÎ“Â£Ã´[39m includes placeholder text in edit mode[32m 29[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m formats date values for display[39m[32m 31[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m formats boolean values as Yes/No[39m[32m 9[2mms[22m[39m
       [32mÎ“Â£Ã´[39m handles null values gracefully[32m 9[2mms[22m[39m
{"level":50,"time":1767884067872,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884067878,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884067916,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884067929,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884067921,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884067922,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884067925,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884067929,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884067929,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884067929,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884067929,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767884067934,"env":"test","module":"user-credentials-repository","userId":"4kxuqPbEKHTiZo_zWOS5W","msg":"User credentials created"}
{"level":50,"time":1767884068035,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884068090,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884068100,"env":"test","module":"auth-routes","userId":"d3f897ef02b59988293e71bc2aa307ee","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767884068232,"env":"test","module":"mfa-service","userId":"d1c8ab3fa7eac84eb9a1442ee0dd345b","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767884068233,"env":"test","module":"mfa-service","userId":"d1c8ab3fa7eac84eb9a1442ee0dd345b","msg":"Generated TOTP secret"}
{"level":30,"time":1767884068233,"env":"test","module":"auth-routes","userId":"d1c8ab3fa7eac84eb9a1442ee0dd345b","msg":"MFA setup initiated"}
{"level":50,"time":1767884068303,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884068327,"env":"test","module":"user-credentials-repository","userId":"8sglgoW4l-k-BJOH_oC-t","msg":"User credentials created"}
{"level":30,"time":1767884068445,"env":"test","module":"user-credentials-repository","userId":"7b82761c-e704-4f74-8338-ecddaa7dd2eb","msg":"User credentials created"}
{"level":30,"time":1767884068486,"env":"test","module":"user-credentials-repository","userId":"42cb7ae4-ef59-43c6-83a1-5028f1b149d2","msg":"User credentials created"}
{"level":30,"time":1767884068509,"env":"test","module":"user-credentials-repository","userId":"a7c971c3-996e-48e1-bb12-b978578d612d","msg":"User credentials created"}
{"level":30,"time":1767884068553,"env":"test","module":"email-queue","jobId":"92bc5772-8c51-455b-8a37-7ce3ee962854","to":"test-XyRXR7ZeVEKxW8_6xdaaS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884068593,"env":"test","module":"email-queue","jobId":"8e0ff6c5-d5c3-4c48-90aa-a2df4a8b7872","to":"protected-test-LXFaoDlNToOD5te_WI1KA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884068612,"env":"test","module":"email-queue","jobId":"04440a47-9ae5-47b0-802f-3d440e862808","to":"session-test-_dRlcNgqkTgnr0gs7SxyB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884068613,"env":"test","module":"auth-routes","userId":"7b82761c-e704-4f74-8338-ecddaa7dd2eb","email":"test-XyRXR7ZeVEKxW8_6xdaaS@example.com","msg":"User registered"}
{"level":30,"time":1767884068645,"env":"test","module":"auth-routes","userId":"42cb7ae4-ef59-43c6-83a1-5028f1b149d2","email":"protected-test-LXFaoDlNToOD5te_WI1KA@example.com","msg":"User registered"}
{"level":30,"time":1767884068670,"env":"test","module":"auth-routes","userId":"a7c971c3-996e-48e1-bb12-b978578d612d","email":"session-test-_dRlcNgqkTgnr0gs7SxyB@example.com","msg":"User registered"}
{"level":50,"time":1767884068717,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884068757,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.templates-runs.test.ts:83:5 {
  length: 311,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(4f0d1a7d-d470-4891-924f-edd1ac71309e) is still referenced from table "runs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'runs',
  column: undefined,
  dataType: undefined,
  constraint: 'runs_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.templates-runs.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 6924[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create template with file upload[32m 175[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject non-docx files[39m[32m 189[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject without file[32m 108[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list templates [33m 336[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should get template by ID[32m 274[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should extract placeholders[32m 270[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update template name [33m 310[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should delete template [33m 437[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should execute workflow[32m 266[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include logs in debug mode[32m 272[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject without required permission[39m[32m 8[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list runs [33m 390[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should filter by workflowId [33m 403[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get run by ID [33m 452[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get run logs [33m 492[2mms[22m[39m
{"level":30,"time":1767884068764,"env":"test","module":"user-credentials-repository","userId":"hSVODgbKoV3HeZGEoZt_8","msg":"User credentials created"}
{"level":40,"time":1767884068828,"env":"test","module":"mfa-service","userId":"a20b03d6f531e66b499e418bc2689dec","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884068828,"env":"test","module":"auth-routes","userId":"a20b03d6f531e66b499e418bc2689dec","msg":"MFA verification failed during login"}
{"level":50,"time":1767884068833,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884068889,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884068981,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: ab4aa003-0b5b-42b3-8d66-7b02107591fe tenantId: 805eea92-0ab6-4ee8-af3e-60cd84636c61 userId: google-user-id

{"level":50,"time":1767884068987,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884068992,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884069012,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884069036,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767884069155,"env":"test","module":"user-credentials-repository","userId":"2745eed2-b158-4a4a-89a1-de0f4298f38a","msg":"User credentials created"}
{"level":50,"time":1767884069155,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884069164,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884069218,"env":"test","module":"user-credentials-repository","userId":"IJp9vb9JqgPOFHzmujiXS","msg":"User credentials created"}
{"level":30,"time":1767884069264,"env":"test","module":"email-queue","jobId":"6f09b78a-6071-45ce-885d-5732f0b68aeb","to":"middleware-test-9eW6ucGfS73K65tTjTDNS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884069318,"env":"test","module":"auth-routes","userId":"2745eed2-b158-4a4a-89a1-de0f4298f38a","email":"middleware-test-9eW6ucGfS73K65tTjTDNS@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1767884069372,"env":"test","module":"email-queue","jobId":"dda5d895-b5fd-455a-90f2-12b33898d51e","to":"test-1767884068762-gy8y9e@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884069372,"env":"test","module":"auth-service","email":"test-1767884068762-gy8y9e@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767884069399,"env":"test","module":"user-credentials-repository","userId":"7c72a8d9-9eef-4780-a582-992795465fa1","msg":"User credentials created"}
{"level":30,"time":1767884069427,"env":"test","module":"user-credentials-repository","userId":"de55b3ca-e500-43f5-9adf-30c5940d8ce7","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 73380bcc-1eea-4150-ae89-daf2bfe058b3 tenantId: 805eea92-0ab6-4ee8-af3e-60cd84636c61 userId: google-user-id

{"level":30,"time":1767884069508,"env":"test","module":"email-queue","jobId":"ecc0f704-4696-4ece-a328-465844545935","to":"protected-test-dm6Ii0QRq4SqPG4GzqCQi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884069509,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884069533,"env":"test","module":"email-queue","jobId":"7950453a-1a01-49e7-9843-79c54918b2e4","to":"session-test-07UtsjXwUhKYuZMZsTxi6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884069560,"env":"test","module":"auth-routes","userId":"7c72a8d9-9eef-4780-a582-992795465fa1","email":"protected-test-dm6Ii0QRq4SqPG4GzqCQi@example.com","msg":"User registered"}
{"level":30,"time":1767884069590,"env":"test","module":"auth-routes","userId":"de55b3ca-e500-43f5-9adf-30c5940d8ce7","email":"session-test-07UtsjXwUhKYuZMZsTxi6@example.com","msg":"User registered"}
{"level":30,"time":1767884069603,"env":"test","module":"auth-routes","userId":"adbebc1dc0494d150c1c4ce26511f723","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: a3383d43-820e-4737-a86d-842f43c87b99 tenantId: 805eea92-0ab6-4ee8-af3e-60cd84636c61 userId: google-user-id

{"level":50,"time":1767884069643,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884069662,"env":"test","module":"audit-log-service","userId":"adbebc1dc0494d150c1c4ce26511f723","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.sessions.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 13097[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list all active sessions for current user [33m 524[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark current session as current [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array when user has no active sessions [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include expired sessions [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include revoked sessions [33m 545[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should parse device name from user agent[39m[33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 350[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke a specific session[39m[33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent session [33m 337[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 458[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking another user's session[39m[33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 334[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all sessions except current[39m[33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all trusted devices [33m 665[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 when no active session found [33m 336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 349[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should mark current device as trusted [33m 492[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should update existing trusted device expiry[39m[33m 670[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should list all trusted devices[39m[33m 447[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should not include revoked devices [33m 458[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should revoke a trusted device [33m 583[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent device [33m 339[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track IP address for sessions[39m[33m 497[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track user agent for sessions[39m[33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update lastUsedAt on token refresh [33m 824[2mms[22m[39m
{"level":30,"time":1767884069773,"env":"test","module":"email-queue","jobId":"4e5e7d48-5c1f-42ae-9606-fc2ce5928a3d","to":"test-1767884068762-gy8y9e@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884069773,"env":"test","module":"auth-service","email":"test-1767884068762-gy8y9e@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should debounce validation calls
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1767884069919,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884069922,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767884070051,"env":"test","module":"user-credentials-repository","userId":"9f48fadd-b020-4b3e-a014-356e463a4356","msg":"User credentials created"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767884070155,"env":"test","module":"email-queue","jobId":"48d4a2f2-eb22-4a37-84dc-9ea1c6f615b7","to":"middleware-test-RCzgBbQVKOQrEijyh25ud@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884070161,"env":"test","module":"user-credentials-repository","error":{},"userId":"5f749ded416bd5bfcdd00aff9cf274e9","msg":"Failed to update user password"}
{"level":50,"time":1767884070161,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":30,"time":1767884070166,"env":"test","module":"auth-routes","userId":"7c72a8d9-9eef-4780-a582-992795465fa1","msg":"User logged in successfully"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate helper functions in expressions
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767884070209,"env":"test","module":"auth-routes","userId":"de55b3ca-e500-43f5-9adf-30c5940d8ce7","msg":"User logged in successfully"}
{"level":30,"time":1767884070210,"env":"test","module":"auth-routes","userId":"9f48fadd-b020-4b3e-a014-356e463a4356","email":"middleware-test-RCzgBbQVKOQrEijyh25ud@example.com","msg":"User registered"}
{"level":30,"time":1767884070214,"env":"test","module":"audit-log-service","userId":"7c72a8d9-9eef-4780-a582-992795465fa1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884070218,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 3fded1c2-ce46-41b3-9003-1bd0154695fd tenantId: 805eea92-0ab6-4ee8-af3e-60cd84636c61 userId: google-user-id

{"level":30,"time":1767884070265,"env":"test","module":"audit-log-service","userId":"de55b3ca-e500-43f5-9adf-30c5940d8ce7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884070270,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884070298,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate complex expressions with multiple helpers
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":40,"time":1767884070406,"env":"test","module":"mfa-service","userId":"fb185bcf35b225397eae63d5e860adf9","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884070406,"env":"test","module":"auth-routes","userId":"fb185bcf35b225397eae63d5e860adf9","msg":"MFA verification failed during login"}
{"level":50,"time":1767884070410,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884070468,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should handle syntax errors
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884070531,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884070537,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767884070608,"env":"test","module":"user-credentials-repository","userId":"117310f9-f063-4d84-913b-21110b7c2499","msg":"User credentials created"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884070712,"env":"test","module":"email-queue","jobId":"343047a4-410c-494a-ad33-786dabb14cbe","to":"protected-test-xeACz0UAKU9hn04boAS3w@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767884070762,"env":"test","module":"auth-routes","userId":"117310f9-f063-4d84-913b-21110b7c2499","email":"protected-test-xeACz0UAKU9hn04boAS3w@example.com","msg":"User registered"}
{"level":40,"time":1767884070840,"env":"test","module":"ai-service","attempt":4,"waitMs":16000,"msg":"Rate limit hit, retrying..."}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/expression-editor.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 2532[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with null validation result[32m 17[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate expression after debounce[39m[32m 12[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return validation errors for invalid expression[39m[32m 159[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should debounce validation calls[32m 157[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should not validate when workflowId or nodeId is missing[32m 153[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate helper functions in expressions[32m 158[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate complex expressions with multiple helpers[32m 156[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle syntax errors[32m 106[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle empty expressions[32m 3[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update validation when expression changes [33m 309[2mms[22m[39m
{"level":30,"time":1767884070913,"env":"test","module":"user-credentials-repository","userId":"6639fef2-dc2e-428e-9e80-5b770ff4aa2e","msg":"User credentials created"}
{"level":30,"time":1767884070917,"env":"test","module":"user-credentials-repository","userId":"2e62b25a-53f4-4a7e-865f-19c3969b2014","msg":"User credentials created"}
{"level":50,"time":1767884070949,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 1c57871e-8930-4468-a9f3-1f957e4b04ee tenantId: 805eea92-0ab6-4ee8-af3e-60cd84636c61 userId: google-user-id

{"level":30,"time":1767884071017,"env":"test","module":"email-queue","jobId":"982218a9-1864-4943-97c2-34b9b90b2a36","to":"session-test-pXPRJM3AzhnxCd4GCu0r6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884071018,"env":"test","module":"email-queue","jobId":"9a65618e-1620-471c-8cce-5fec1d9df386","to":"middleware-test-ibi70oemRjIDJKujNpccl@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767884071055,"env":"test","module":"mfa-service","userId":"693c0569887cd2baebaa1d540ca6b41c","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884071055,"env":"test","module":"auth-routes","userId":"693c0569887cd2baebaa1d540ca6b41c","msg":"MFA verification failed during login"}
{"level":30,"time":1767884071071,"env":"test","module":"auth-routes","userId":"2e62b25a-53f4-4a7e-865f-19c3969b2014","email":"session-test-pXPRJM3AzhnxCd4GCu0r6@example.com","msg":"User registered"}
{"level":30,"time":1767884071072,"env":"test","module":"auth-routes","userId":"6639fef2-dc2e-428e-9e80-5b770ff4aa2e","email":"middleware-test-ibi70oemRjIDJKujNpccl@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884071120,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884071190,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":30,"time":1767884071208,"env":"test","module":"auth-routes","userId":"c375d343877733465ff2947774970cc6","msg":"User logged in successfully"}
{"level":30,"time":1767884071262,"env":"test","module":"audit-log-service","userId":"c375d343877733465ff2947774970cc6","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1767884071377,"env":"test","module":"auth-routes","userId":"c375d343877733465ff2947774970cc6","sessionCount":0,"msg":"Listed active sessions"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
{"level":50,"time":1767884071379,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1767884071441,"env":"test","module":"auth-routes","userId":"5d4007f5f9c69abc102c81b4f63b61d3","msg":"User logged in successfully"}
{"level":30,"time":1767884071494,"env":"test","module":"audit-log-service","userId":"5d4007f5f9c69abc102c81b4f63b61d3","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884071526,"env":"test","module":"user-credentials-repository","userId":"2e79e9e1-b5d3-4339-8d12-8115bf44ab8c","msg":"User credentials created"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884071632,"env":"test","module":"email-queue","jobId":"633a93b9-31ab-4238-b14c-8d5944c8c58e","to":"protected-test-WyBhJlubMLKHMXYeyEiMt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884071646,"env":"test","module":"auth-routes","userId":"6639fef2-dc2e-428e-9e80-5b770ff4aa2e","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884071683,"env":"test","module":"auth-routes","userId":"2e79e9e1-b5d3-4339-8d12-8115bf44ab8c","email":"protected-test-WyBhJlubMLKHMXYeyEiMt@example.com","msg":"User registered"}
{"level":30,"time":1767884071683,"env":"test","module":"auth-routes","userId":"2e62b25a-53f4-4a7e-865f-19c3969b2014","msg":"User logged in successfully"}
{"level":30,"time":1767884071698,"env":"test","module":"audit-log-service","userId":"6639fef2-dc2e-428e-9e80-5b770ff4aa2e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884071701,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884071703,"env":"test","module":"email-queue","jobId":"eb1edc71-5ebb-4796-83ee-8ce7c0b4341a","to":"test-1767884070588-6hg8dr@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884071703,"env":"test","module":"auth-service","email":"test-1767884070588-6hg8dr@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767884071735,"env":"test","module":"audit-log-service","userId":"2e62b25a-53f4-4a7e-865f-19c3969b2014","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884071897,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884071996,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767884072015,"env":"test","module":"mfa-service","userId":"6e991c46fab50673e3a50180353fcf0f","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884072015,"env":"test","module":"auth-routes","userId":"6e991c46fab50673e3a50180353fcf0f","msg":"MFA verification failed during login"}
{"level":50,"time":1767884072019,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072023,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072044,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884072102,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884072135,"env":"test","module":"user-credentials-repository","userId":"9a472667-b9fb-4b00-91b8-bcdca0591b68","msg":"User credentials created"}
{"level":50,"time":1767884072165,"env":"test","module":"user-credentials-repository","error":{},"userId":"5d4007f5f9c69abc102c81b4f63b61d3","msg":"Failed to update user password"}
{"level":50,"time":1767884072165,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/jwt.authentication.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 5105[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate valid JWT token on successful login[39m[32m 14[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include correct payload in JWT token[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set JWT expiry to 15 minutes[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept valid JWT token on protected routes[39m[32m 172[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject request without authorization header[32m 6[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject request with malformed token[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject request with missing Bearer prefix[39m[32m 164[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject token with invalid signature[32m 8[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired JWT token [33m 1106[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return token_expired error code for expired tokens[39m[33m 1118[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should authenticate with Bearer token in Authorization header[32m 144[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should work with Bearer token on POST requests[32m 109[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should work with Bearer token on PUT requests[39m[32m 64[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should work with Bearer token on DELETE requests[39m[32m 276[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exchange valid session cookie for JWT token[39m[32m 8[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject token exchange without valid cookie[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prefer Bearer token over cookie when both present[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fall back to cookie if Bearer token is invalid[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow GET requests with cookie auth only[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST requests with cookie auth only (mutation-strict)[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow anonymous access to public workflows[39m[32m 59[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach user info if authenticated on optional auth routes[39m[32m 59[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token using refresh token[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token on use[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should detect token reuse and revoke all user tokens[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke refresh token on logout[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should clear refresh token cookie on logout[39m[32m 6[2mms[22m[39m
{"level":30,"time":1767884072242,"env":"test","module":"email-queue","jobId":"c3be2a4e-3a72-4ab8-9c6a-4e10026beb6c","to":"middleware-test-egS4-G9OJKpLX4ouBmpGs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884072296,"env":"test","module":"auth-routes","userId":"9a472667-b9fb-4b00-91b8-bcdca0591b68","email":"middleware-test-egS4-G9OJKpLX4ouBmpGs@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/runs.components.test.tsx [2m([22m[2m19 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 2283[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should render runs table with correct columns[39m[32m 23[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should render run data correctly[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show success badge for successful runs[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show error badge for failed runs[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format duration correctly[39m[32m 29[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show download options for successful runs[39m[32m 4[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should render all filter controls[32m 134[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should call onChange when status filter changes [33m 457[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should call onChange when search is submitted[32m 70[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show clear filters button when filters are active[32m 20[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should clear all filters when clear button is clicked[32m 33[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should render all trace entries[32m 50[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show executed badge for executed nodes[32m 17[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show skipped badge for skipped nodes[32m 34[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should display conditions and their results[32m 19[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should display error messages[32m 19[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should toggle show skipped nodes[32m 24[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should expand outputs delta when clicked[32m 28[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should copy trace as JSON[32m 26[2mms[22m[39m
{"level":30,"time":1767884072437,"env":"test","module":"user-credentials-repository","userId":"56e4668f-b75e-4597-aa82-24b0cb54e493","msg":"User credentials created"}
{"level":30,"time":1767884072469,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1767884072470,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1767884072472,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1767884072483,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1767884072500,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
{"level":30,"time":1767884072506,"env":"test","module":"user-credentials-repository","userId":"e38131b3-073e-46fd-a4c4-a6fb78052508","msg":"User credentials created"}
{"level":50,"time":1767884072535,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884072541,"env":"test","module":"email-queue","jobId":"d7187c8d-ed2e-4fbf-b6be-086b42936274","to":"protected-test-wk7btWXzAY7OX8gPBrptb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884072572,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072583,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072591,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884072594,"env":"test","module":"auth-routes","userId":"56e4668f-b75e-4597-aa82-24b0cb54e493","email":"protected-test-wk7btWXzAY7OX8gPBrptb@example.com","msg":"User registered"}
{"level":30,"time":1767884072591,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1767884072591,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1767884072591,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1767884072602,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":50,"time":1767884072606,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884072612,"env":"test","module":"email-queue","jobId":"c17cb0d8-1622-4d71-b811-b219b404ecb6","to":"session-test-YfECAyAAJqT5T45Quqy3V@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884072614,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/metrics.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1534[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should expose /metrics endpoint[39m[32m 99[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should protect /metrics if API key is set[32m 114[2mms[22m[39m
{"level":50,"time":1767884072624,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884072624,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072652,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072659,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884072663,"env":"test","module":"auth-routes","userId":"e38131b3-073e-46fd-a4c4-a6fb78052508","email":"session-test-YfECAyAAJqT5T45Quqy3V@example.com","msg":"User registered"}
{"level":50,"time":1767884072667,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072675,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072684,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072697,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884072703,"env":"test","module":"auth-routes","userId":"85f2d9276b19ddde7f56f74817a38760","msg":"Login requires MFA verification"}
{"level":50,"time":1767884072704,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072713,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":50,"time":1767884072726,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072740,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072751,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072760,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072777,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884072780,"env":"test","module":"auth-routes","userId":"f404fde6b1a3d7638776161a77fffb2a","msg":"User logged in successfully"}
{"level":50,"time":1767884072818,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767884072828,"env":"test","module":"mfa-service","userId":"85f2d9276b19ddde7f56f74817a38760","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884072828,"env":"test","module":"auth-routes","userId":"85f2d9276b19ddde7f56f74817a38760","msg":"MFA verification failed during login"}
{"level":30,"time":1767884072835,"env":"test","module":"audit-log-service","userId":"f404fde6b1a3d7638776161a77fffb2a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":50,"time":1767884072874,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072880,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072885,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072890,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884072955,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884073034,"env":"test","module":"user-credentials-repository","userId":"1235151a-3ddd-4147-bde9-3f2c1cbff037","msg":"User credentials created"}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault.permissions.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m22 failed[39m[2m)[22m[33m 2018[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to read table[39m[32m 32[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow writer to read table[39m[32m 26[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow reader to read table[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny non-member from reading table[39m[32m 12[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to update table[39m[32m 47[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from updating table[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from updating table[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from deleting table[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from deleting table[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny non-member from deleting table[39m[32m 13[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to view permissions[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from viewing permissions[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from viewing permissions[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to grant permissions[39m[32m 17[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to update existing permission (upsert)[39m[32m 12[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from granting permissions[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent modifying table owner permissions[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to revoke permissions[39m[32m 58[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from revoking permissions[39m[32m 56[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce owner includes write and read[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce write includes read but not owner[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce read is read-only[39m[32m 5[2mms[22m[39m
{"level":30,"time":1767884073140,"env":"test","module":"email-queue","jobId":"cc05bc27-2a64-4e9b-9bae-917eb2cf4b20","to":"middleware-test-tL549tdZaBiGjyCoC45q3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884073174,"env":"test","module":"user-credentials-repository","userId":"8777955b-44ab-4540-8f26-ed808c6078fb","msg":"User credentials created"}
{"level":30,"time":1767884073195,"env":"test","module":"auth-routes","userId":"1235151a-3ddd-4147-bde9-3f2c1cbff037","email":"middleware-test-tL549tdZaBiGjyCoC45q3@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884073276,"env":"test","module":"email-queue","jobId":"6b1f1181-a111-479c-b110-6338c0b89a10","to":"session-test-Jj_MvRQo4SgN15jZPk8hk@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884073301,"env":"test","module":"user-credentials-repository","userId":"NSkS0ndZoMU33CYCzpI9Q","msg":"User credentials created"}
{"level":30,"time":1767884073326,"env":"test","module":"auth-routes","userId":"8777955b-44ab-4540-8f26-ed808c6078fb","email":"session-test-Jj_MvRQo4SgN15jZPk8hk@example.com","msg":"User registered"}
{"level":30,"time":1767884073358,"env":"test","module":"user-credentials-repository","userId":"b4c50f2a-32e4-46b6-b371-45e0208a02f1","msg":"User credentials created"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884073456,"env":"test","module":"email-queue","jobId":"fc811778-1ddb-4778-bb7d-ae15847e6387","to":"protected-test-B-yRqZWK28pyomPxPohrM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884073456,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":50,"time":1767884073495,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884073508,"env":"test","module":"auth-routes","userId":"b4c50f2a-32e4-46b6-b371-45e0208a02f1","email":"protected-test-B-yRqZWK28pyomPxPohrM@example.com","msg":"User registered"}
{"level":50,"time":1767884073508,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1767884073602,"env":"test","module":"mfa-service","userId":"57ec2d3de2b91df048d1b06691e8bfa6","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884073602,"env":"test","module":"auth-routes","userId":"57ec2d3de2b91df048d1b06691e8bfa6","msg":"MFA verification failed during login"}
{"level":50,"time":1767884073608,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884073702,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884073796,"env":"test","module":"user-credentials-repository","userId":"1bRE9inGJBQA02Va2CaYb","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'da6d51da-847a-48bb-8204-8bb1309806e8'[39m,
  tableId: [32m'1a0fe434-ee08-4011-8fc4-38f18229da5c'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2026-01-08T14:54:34.701Z'[39m
}

{"level":30,"time":1767884073897,"env":"test","module":"user-credentials-repository","userId":"1d4603cb-a382-4419-a43b-83f46fd0447a","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884074001,"env":"test","module":"email-queue","jobId":"37311e44-4cd9-4c5a-aba8-f09a111cd555","to":"middleware-test-G6_DkIXRLuPsM5SOXgLZo@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884074053,"env":"test","module":"auth-routes","userId":"1d4603cb-a382-4419-a43b-83f46fd0447a","email":"middleware-test-G6_DkIXRLuPsM5SOXgLZo@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/common/Breadcrumbs.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1528[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render all breadcrumb items[32m 43[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render without home when showHome is false[32m 5[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render icons for items that have them[32m 5[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render links for non-last items with href[32m 6[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render last item without link[32m 7[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should apply custom className[32m 9[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render chevron separators between items[32m 4[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should handle single item[32m 2[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should handle empty items array with home[32m 3[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should apply font-medium to last item[39m[32m 11[2mms[22m[39m
{"level":30,"time":1767884074091,"env":"test","module":"user-credentials-repository","userId":"09e18b67-f644-47ec-8413-7830f064276b","msg":"User credentials created"}
{"level":30,"time":1767884074098,"env":"test","module":"auth-routes","userId":"b4c50f2a-32e4-46b6-b371-45e0208a02f1","msg":"User logged in successfully"}
{"level":40,"time":1767884074117,"env":"test","module":"auth-service","tokenHash":"beab21064d06fc7c0d297457b7447007902e35fac39ac0f1a4c94a7b8a907fdd","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767884074129,"env":"test","module":"auth-routes","userId":"f8a001685986a539184fe68afe92436b","msg":"User logged in successfully"}
{"level":30,"time":1767884074148,"env":"test","module":"audit-log-service","userId":"b4c50f2a-32e4-46b6-b371-45e0208a02f1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884074181,"env":"test","module":"audit-log-service","userId":"f8a001685986a539184fe68afe92436b","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884074196,"env":"test","module":"email-queue","jobId":"4b677a76-cdc0-4dca-b35f-f0f3a741aff3","to":"session-test-uRtVdRLOb9uEz6qngTFCC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767884074201,"env":"test","module":"tenant-middleware","userId":"b4c50f2a-32e4-46b6-b371-45e0208a02f1","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1767884074247,"env":"test","module":"auth-routes","userId":"09e18b67-f644-47ec-8413-7830f064276b","email":"session-test-uRtVdRLOb9uEz6qngTFCC@example.com","msg":"User registered"}
{"level":40,"time":1767884074277,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1767884074280,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767884074282,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767884074287,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767884074289,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
 [31mÎ“Â¥Â»[39m tests/unit/isolatedVmBridge.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1341[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should execute JS and use simple helpers (string)[32m 7[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should execute JS and use complex helpers (math.sum)[32m 2[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should execute JS and capture console logs[39m[32m 5[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should access context data[32m 2[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should fail on missing helper[32m 2[2mms[22m[39m
{"level":50,"time":1767884074351,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884074364,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884074370,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767884074371,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767884074372,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":66,"totalTokens":878,"durationMs":1,"estimatedCostUSD":0.00010760000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884074374,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"},"duration":3,"msg":"AI workflow revision failed"}
{"level":50,"time":1767884074374,"env":"test","module":"ai-service","duration":4,"error":{"code":"VALIDATION_ERROR","details":{"originalError":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"}},"troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"msg":"AI workflow revision failed"}
{"level":30,"time":1767884074385,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767884074385,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767884074385,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":45,"totalTokens":857,"durationMs":0,"estimatedCostUSD":0.00009920000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884074385,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"},"duration":0,"msg":"AI workflow revision failed"}
{"level":50,"time":1767884074385,"env":"test","module":"ai-service","duration":0,"error":{"code":"VALIDATION_ERROR","details":{"originalError":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"}},"troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"msg":"AI workflow revision failed"}
{"level":30,"time":1767884074386,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767884074387,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767884074387,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1767884074387,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1767884074387,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1767884074387,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":0,"msg":"AI workflow revision failed"}
{"level":40,"time":1767884074387,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"actualOutputTokens":4,"responseLength":13,"msg":"Single-shot revision truncated - automatically retrying with chunking"}
{"level":30,"time":1767884074387,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767884074388,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":1,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1767884074388,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1767884074388,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1767884074388,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":1,"msg":"AI workflow revision failed"}
{"level":50,"time":1767884074388,"env":"test","module":"ai-service","duration":2,"error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"msg":"AI workflow revision failed"}
 [31mÎ“Â¥Â»[39m tests/unit/services/AIService.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1342[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m reviseWorkflow should parse valid JSON response correctly[39m[32m 15[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m reviseWorkflow should handle JSON markdown code blocks[39m[32m 2[2mms[22m[39m
     [32mÎ“Â£Ã´[39m reviseWorkflow should throw on invalid JSON[32m 2[2mms[22m[39m
{"level":30,"time":1767884074445,"env":"test","module":"user-credentials-repository","userId":"_n_JEQW05OIjD9LLWRQjF","msg":"User credentials created"}
stderr | tests/unit/client/choice-utils.test.ts > choice-utils > handles missing content gracefully
[generateOptionsFromList] Invalid list data: null

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/client/choice-utils.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1367[2mms[22m[39m
     [32mÎ“Â£Ã´[39m generates options with basic mapping[32m 3[2mms[22m[39m
     [32mÎ“Â£Ã´[39m sorts by label asc[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m sorts by label desc[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m dedupes by label[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m dedupes by value (alias)[32m 1[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m uses label template with column names[39m[32m 7[2mms[22m[39m
     [32mÎ“Â£Ã´[39m handles missing content gracefully[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m includes blank option at the top[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m sorts by specific column asc[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m sorts by specific column desc[32m 0[2mms[22m[39m
{"level":30,"time":1767884074617,"env":"test","module":"user-credentials-repository","userId":"cedb29fb-9ec0-4ba3-914a-ac93854b152d","msg":"User credentials created"}
{"level":30,"time":1767884074651,"env":"test","module":"mfa-service","userId":"f8a001685986a539184fe68afe92436b","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767884074651,"env":"test","module":"mfa-service","userId":"f8a001685986a539184fe68afe92436b","msg":"Generated TOTP secret"}
{"level":30,"time":1767884074651,"env":"test","module":"auth-routes","userId":"f8a001685986a539184fe68afe92436b","msg":"MFA setup initiated"}
{"level":30,"time":1767884074723,"env":"test","module":"email-queue","jobId":"c05e5f33-9951-43c4-a8d3-02df3e5049f4","to":"protected-test-BDxuad4SDP5PsLqF6bqfA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884074775,"env":"test","module":"auth-routes","userId":"cedb29fb-9ec0-4ba3-914a-ac93854b152d","email":"protected-test-BDxuad4SDP5PsLqF6bqfA@example.com","msg":"User registered"}
{"level":30,"time":1767884074793,"env":"test","module":"auth-routes","userId":"b585bc13a9167c3c671e765ceb6f29b3","msg":"User logged in successfully"}
{"level":30,"time":1767884074807,"env":"test","module":"user-credentials-repository","userId":"fd844b4a-a61a-403c-b342-bef4862f064a","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mMOCK SETUP DONE. Mock questions: [
  {
    id: [32m'q1'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q1'[39m,
    order: [33m0[39m,
    isVirtual: [33mfalse[39m,
    alias: [32m'show'[39m,
    visibleIf: [1mnull[22m
  },
  {
    id: [32m'q2'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q2'[39m,
    order: [33m1[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: { op: [32m'equals'[39m, left: [36m[Object][39m, right: [36m[Object][39m }
  },
  {
    id: [32m'q3'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q3'[39m,
    order: [33m2[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: [1mnull[22m
  }
]
Calling getVisibleQuestionCount...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mCOUNT RESULT: [33m0[39m
Mock called times: [33m1[39m
Mock last call args: [ [ [32m'section1'[39m ] ]

{"level":50,"time":1767884074817,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":50,"time":1767884074828,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/services/intakeQuestionVisibility.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1287[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return all questions as visible when no conditions[32m 5[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should exclude virtual steps from visibility evaluation[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should maintain question order[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should hide questions when visibleIf is false[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show questions when visibleIf is true[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle complex visibleIf conditions[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle OR conditions[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle NOT conditions[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should include visible required questions in validation[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should skip hidden questions in validation[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should check if question is visible[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should get visible question count[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should clear values for hidden questions[39m[32m 7[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should not clear values for visible questions[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should warn if required question has visibility condition[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should warn if virtual step has visibility condition[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return no warnings for valid configuration[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should default to visible on condition evaluation error[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle questions that depend on each other[39m[32m 6[2mms[22m[39m
{"level":30,"time":1767884074845,"env":"test","module":"audit-log-service","userId":"b585bc13a9167c3c671e765ceb6f29b3","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767884074862,"env":"test","module":"auth-routes","userId":"09e18b67-f644-47ec-8413-7830f064276b","msg":"User logged in successfully"}
{"level":30,"time":1767884074885,"env":"test","module":"auth-routes","userId":"7a49fe33f80e8d7ca45052f774be35fb","msg":"User logged in successfully"}
{"level":30,"time":1767884074916,"env":"test","module":"audit-log-service","userId":"09e18b67-f644-47ec-8413-7830f064276b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884074917,"env":"test","module":"email-queue","jobId":"286fb93f-e93f-44eb-8cc6-b59b6ed39c0b","to":"middleware-test-xspxAuVvCAv2m9eOZZbil@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884074935,"env":"test","module":"audit-log-service","userId":"7a49fe33f80e8d7ca45052f774be35fb","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884074940,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884074967,"env":"test","module":"user-credentials-repository","userId":"WzAHygytS_NFvLuSWq_H-","msg":"User credentials created"}
{"level":30,"time":1767884074968,"env":"test","module":"auth-routes","userId":"fd844b4a-a61a-403c-b342-bef4862f064a","email":"middleware-test-xspxAuVvCAv2m9eOZZbil@example.com","msg":"User registered"}
{"level":30,"time":1767884074974,"env":"test","module":"mfa-service","userId":"f8a001685986a539184fe68afe92436b","msg":"MFA enabled successfully"}
{"level":30,"time":1767884074974,"env":"test","module":"auth-routes","userId":"f8a001685986a539184fe68afe92436b","msg":"MFA enabled successfully"}
{"level":30,"time":1767884075027,"env":"test","module":"auth-routes","userId":"09e18b67-f644-47ec-8413-7830f064276b","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1767884075027,"env":"test","module":"audit-log-service","userId":"f8a001685986a539184fe68afe92436b","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1767884075121,"env":"test","module":"auth-service","userId":"b585bc13a9167c3c671e765ceb6f29b3","tokenHash":"3fac5db69f858c3e56829dabee41c0c786c113263a4fdbab2c8a2e8468ca3ec6","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":50,"time":1767884075299,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884075384,"env":"test","module":"auth-routes","userId":"cedb29fb-9ec0-4ba3-914a-ac93854b152d","msg":"User logged in successfully"}
{"level":30,"time":1767884075437,"env":"test","module":"audit-log-service","userId":"cedb29fb-9ec0-4ba3-914a-ac93854b152d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884075441,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767884075533,"env":"test","module":"auth-routes","userId":"fd844b4a-a61a-403c-b342-bef4862f064a","msg":"User logged in successfully"}
{"level":30,"time":1767884075553,"env":"test","module":"user-credentials-repository","userId":"7ef3ad43-010e-40ac-ae92-1a3bd5a79131","msg":"User credentials created"}
{"level":30,"time":1767884075585,"env":"test","module":"user-credentials-repository","userId":"KsUA7SB9NS5T7bC60EZ7W","msg":"User credentials created"}
{"level":30,"time":1767884075586,"env":"test","module":"audit-log-service","userId":"fd844b4a-a61a-403c-b342-bef4862f064a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767884075662,"env":"test","module":"email-queue","jobId":"d407f8e8-b171-4bf0-af86-cc5148209e3c","to":"session-test--jZ-iQYezWp54U2lvtOc5@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884075715,"env":"test","module":"auth-routes","userId":"7ef3ad43-010e-40ac-ae92-1a3bd5a79131","email":"session-test--jZ-iQYezWp54U2lvtOc5@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884075781,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884075838,"env":"test","module":"user-credentials-repository","userId":"2a3d4224-3661-4097-afe5-9570b2cdfc1d","msg":"User credentials created"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1767884075889,"env":"test","module":"mfa-service","userId":"0419741d97ff49298bd5ac78d416a749","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884075889,"env":"test","module":"auth-routes","userId":"0419741d97ff49298bd5ac78d416a749","msg":"MFA verification failed during login"}
{"level":50,"time":1767884075895,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884075899,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767884075938,"env":"test","module":"email-queue","jobId":"c13aa204-0685-41d5-8f6d-f1c1441ce005","to":"protected-test-LEvm_drJ9ujqukftPQuz3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884075993,"env":"test","module":"auth-routes","userId":"2a3d4224-3661-4097-afe5-9570b2cdfc1d","email":"protected-test-LEvm_drJ9ujqukftPQuz3@example.com","msg":"User registered"}
{"level":30,"time":1767884076011,"env":"test","module":"user-credentials-repository","userId":"8174cb94-71f7-4a0e-b809-0993b4c77680","msg":"User credentials created"}
{"level":50,"time":1767884076016,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884076113,"env":"test","module":"email-queue","jobId":"45cedb1b-a90b-4633-b52b-1ae3d4a74901","to":"user2-PR6bx9BrtT0QxTlJUKzWB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884076163,"env":"test","module":"auth-routes","userId":"8174cb94-71f7-4a0e-b809-0993b4c77680","email":"user2-PR6bx9BrtT0QxTlJUKzWB@example.com","msg":"User registered"}
{"level":30,"time":1767884076210,"env":"test","module":"user-credentials-repository","userId":"Kzgtz7nM8mHwfhbv7tiIQ","msg":"User credentials created"}
{"level":30,"time":1767884076230,"env":"test","module":"user-credentials-repository","userId":"fcc95af2-fd01-4109-a9ca-1b1cbf7cb879","msg":"User credentials created"}
{"level":50,"time":1767884076291,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884076343,"env":"test","module":"email-queue","jobId":"fab1db79-2e40-4d46-989e-2b845af0f8d1","to":"user2-DLjfhTDwzid3EUn5huz_9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884076375,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
{"level":30,"time":1767884076397,"env":"test","module":"auth-routes","userId":"fcc95af2-fd01-4109-a9ca-1b1cbf7cb879","email":"user2-DLjfhTDwzid3EUn5huz_9@example.com","msg":"User registered"}
{"level":50,"time":1767884076471,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884076551,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884076563,"env":"test","module":"auth-routes","userId":"2a3d4224-3661-4097-afe5-9570b2cdfc1d","msg":"User logged in successfully"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884076613,"env":"test","module":"audit-log-service","userId":"2a3d4224-3661-4097-afe5-9570b2cdfc1d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884076621,"env":"test","module":"auth-routes","userId":"75ca5dfafe6ba5ae96a40c41a34fcc84","msg":"User logged in successfully"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884076672,"env":"test","module":"audit-log-service","userId":"75ca5dfafe6ba5ae96a40c41a34fcc84","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884076713,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884076810,"env":"test","module":"user-credentials-repository","userId":"ffgB-Ljo7IFWSUU7mlgVG","msg":"User credentials created"}
{"level":50,"time":1767884076810,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884076855,"env":"test","module":"user-credentials-repository","userId":"e7b64883-fad6-4f86-a887-039b8c3b8ff8","msg":"User credentials created"}
{"level":50,"time":1767884076938,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884076941,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884076955,"env":"test","module":"email-queue","jobId":"fd8a731d-71f4-4c53-bc6f-a3b1e8368375","to":"middleware-test-mpGyMQcp1skxPk1GLPN9C@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/workflow_versioning.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1321[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should diff two versions correctly[32m 2[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should create a version and populate changelog[39m[32m 7[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should track execution lineage via snapshot[39m[32m 53[2mms[22m[39m
{"level":30,"time":1767884077011,"env":"test","module":"auth-routes","userId":"e7b64883-fad6-4f86-a887-039b8c3b8ff8","email":"middleware-test-mpGyMQcp1skxPk1GLPN9C@example.com","msg":"User registered"}
{"level":30,"time":1767884077102,"env":"test","module":"user-credentials-repository","userId":"36071bd1-ba93-473c-b4aa-065f59db0245","msg":"User credentials created"}
{"level":50,"time":1767884077122,"env":"test","error":{},"msg":"Error creating DataVault row"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.token-refresh.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 20418[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token with valid refresh token[39m[33m 661[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token after use[39m[33m 670[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when refresh token is missing [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid refresh token [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for expired refresh token [33m 522[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 for revoked refresh token[39m[33m 683[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when user is not found[39m[33m 511[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update refresh token metadata on rotation[39m[33m 669[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle concurrent refresh token requests (token reuse detection) [33m 645[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set secure cookie in production [33m 614[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set proper cookie attributes[39m[33m 423[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include user role information in response[39m[33m 600[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create refresh token on login[39m[33m 713[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke refresh token on logout[39m[33m 473[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle logout without refresh token gracefully [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support multiple active refresh tokens per user [33m 555[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all user tokens on password reset [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use cryptographically strong random tokens [33m 5796[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should hash refresh tokens before storing in database [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent refresh token reuse after rotation [33m 657[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate token ownership[39m[33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set HttpOnly flag to prevent XSS [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set SameSite=Strict to prevent CSRF [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set proper cookie path [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set appropriate expiry (30 days) [33m 587[2mms[22m[39m
{"level":30,"time":1767884077205,"env":"test","module":"email-queue","jobId":"165c7292-3e82-4ceb-8d71-5b0700125268","to":"session-test-oMLq4UCB9tjg3J8I5NQ9s@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884077258,"env":"test","module":"auth-routes","userId":"36071bd1-ba93-473c-b4aa-065f59db0245","email":"session-test-oMLq4UCB9tjg3J8I5NQ9s@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/ai/workflowEdit.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 1225[2mms[22m[39m
     [2m[90mÎ“Ã¥Ã´[39m[22m should create draft version on successful AI edit
     [2m[90mÎ“Ã¥Ã´[39m[22m should enforce draft mode (revert active workflow to draft)
     [2m[90mÎ“Ã¥Ã´[39m[22m should not create version when no changes detected (checksum match)
     [2m[90mÎ“Ã¥Ã´[39m[22m should reject unauthorized access
     [2m[90mÎ“Ã¥Ã´[39m[22m should reject unsafe DataVault operations
     [2m[90mÎ“Ã¥Ã´[39m[22m should handle multi-operation edits with tempId resolution
     [2m[90mÎ“Ã¥Ã´[39m[22m should create BEFORE and AFTER snapshots
     [2m[90mÎ“Ã¥Ã´[39m[22m should rollback on validation failure
{"level":50,"time":1767884077307,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884077325,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table name and description
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table slug
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render column and row counts
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onClick when card is clicked
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onDelete when delete button is clicked
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should show placeholder when description is missing
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should format dates correctly
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/datavault/TableCard.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 1319[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render table name and description[39m[32m 24[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render table slug[39m[32m 5[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render column and row counts[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should call onClick when card is clicked[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should call onDelete when delete button is clicked[39m[32m 5[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should show placeholder when description is missing[39m[32m 3[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should format dates correctly[39m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 15563[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 493[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1231[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 896[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 1014[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 838[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 623[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 389[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list table permissions [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce RBAC - only owners can manage permissions [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should paginate rows efficiently [33m 1286[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return user-friendly error for missing required fields [33m 748[2mms[22m[39m
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render template name and description
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":40,"time":1767884077425,"env":"test","module":"mfa-service","userId":"f99ec8b50512054f531bc23b794559a5","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884077425,"env":"test","module":"auth-routes","userId":"f99ec8b50512054f531bc23b794559a5","msg":"MFA verification failed during login"}
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should show "Coming Soon" badge
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":50,"time":1767884077430,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render preview columns
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should limit preview columns to 5 and show count for remaining
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should handle empty preview columns
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should have cursor-not-allowed style
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/datavault/TemplateCard.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 1300[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render template name and description[39m[32m 28[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should show "Coming Soon" badge[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render preview columns[39m[32m 7[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should limit preview columns to 5 and show count for remaining[39m[32m 5[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should handle empty preview columns[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should have cursor-not-allowed style[39m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":50,"time":1767884077620,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884077626,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884077637,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884077695,"env":"test","module":"user-credentials-repository","userId":"1d124cea-0f65-40e7-892e-cec4b3d1adbe","msg":"User credentials created"}
{"level":50,"time":1767884077703,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884077748,"env":"test","module":"user-credentials-repository","userId":"196e1d65-51f8-464c-a08c-ddcb5051d0fe","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767884077800,"env":"test","module":"email-queue","jobId":"d061aa4d-5870-40b4-83ea-441d022c5c6b","to":"protected-test-dCn80ELyvGKBFXIN_-l7j@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884077853,"env":"test","module":"email-queue","jobId":"02ee924b-d2fb-4cce-9c7a-66335bae83a1","to":"middleware-test-E7kqSAC3emOhZArjYzXnk@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884077857,"env":"test","module":"auth-routes","userId":"1d124cea-0f65-40e7-892e-cec4b3d1adbe","email":"protected-test-dCn80ELyvGKBFXIN_-l7j@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767884077906,"env":"test","module":"auth-routes","userId":"196e1d65-51f8-464c-a08c-ddcb5051d0fe","email":"middleware-test-E7kqSAC3emOhZArjYzXnk@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/workflows/runtime-pipelines.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 1194[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should create DataVault row on workflow completion
       [2m[90mÎ“Ã¥Ã´[39m[22m should execute writebacks via RunService.completeRun()
       [2m[90mÎ“Ã¥Ã´[39m[22m should skip document generation when visibleIf condition is false
       [2m[90mÎ“Ã¥Ã´[39m[22m should generate document when visibleIf condition is true
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767884078051,"env":"test","module":"user-credentials-repository","userId":"dac9640b-3909-41a0-ad3f-e38f2d0bba60","msg":"User credentials created"}
{"level":30,"time":1767884078153,"env":"test","module":"email-queue","jobId":"42e042cb-6f45-4589-b0e3-ffe4c19668e5","to":"session-test-z2KycUcoiaWRrm_8frUe9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884078166,"env":"test","module":"auth-routes","userId":"cc80df68d2bef8b9611f9a6ed6ae1781","msg":"User logged in successfully"}
{"level":30,"time":1767884078206,"env":"test","module":"auth-routes","userId":"dac9640b-3909-41a0-ad3f-e38f2d0bba60","email":"session-test-z2KycUcoiaWRrm_8frUe9@example.com","msg":"User registered"}
{"level":30,"time":1767884078220,"env":"test","module":"audit-log-service","userId":"cc80df68d2bef8b9611f9a6ed6ae1781","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884078273,"env":"test","module":"auth-routes","userId":"d123d2b17695717979fe81ee3696a011","msg":"User logged in successfully"}
{"level":30,"time":1767884078326,"env":"test","module":"audit-log-service","userId":"d123d2b17695717979fe81ee3696a011","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884078492,"env":"test","module":"auth-routes","userId":"1d124cea-0f65-40e7-892e-cec4b3d1adbe","msg":"User logged in successfully"}
{"level":50,"time":1767884078495,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884078507,"env":"test","module":"auth-routes","userId":"196e1d65-51f8-464c-a08c-ddcb5051d0fe","msg":"User logged in successfully"}
{"level":30,"time":1767884078547,"env":"test","module":"audit-log-service","userId":"1d124cea-0f65-40e7-892e-cec4b3d1adbe","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884078553,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884078561,"env":"test","module":"audit-log-service","userId":"196e1d65-51f8-464c-a08c-ddcb5051d0fe","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884078566,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884078567,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884078591,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884078596,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth.flows.real.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 22031[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should complete registration, verify email, then login [33m 2031[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should lock account after 5 failed attempts, then unlock after waiting[39m[33m 2432[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should record all login attempts[39m[33m 2133[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete MFA setup and login with TOTP[39m[33m 2442[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with backup code when TOTP unavailable[39m[33m 1929[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete full password reset flow[39m[33m 1824[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should invalidate all sessions after password reset [33m 2224[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token on each use[39m[33m 1072[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should detect and prevent refresh token reuse (token theft) [33m 1821[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions[39m[33m 1663[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1655[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884078966,"env":"test","module":"user-credentials-repository","userId":"c8f5448e-e70e-4d5a-941c-c8f3d651007c","msg":"User credentials created"}
{"level":30,"time":1767884079007,"env":"test","module":"user-credentials-repository","userId":"83ee1273-f947-416b-b211-e1525c9df017","msg":"User credentials created"}
{"level":30,"time":1767884079072,"env":"test","module":"email-queue","jobId":"45d5500b-6110-49f4-8e9a-2fa4ff400b94","to":"protected-test-4K3fNCzKeXeXIvx72pIDL@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884079118,"env":"test","module":"user-credentials-repository","userId":"2cf25c29-54f3-4ae7-a2df-0a708c41b5f7","msg":"User credentials created"}
{"level":30,"time":1767884079119,"env":"test","module":"email-queue","jobId":"951f7d1b-ce16-422c-a041-00b34aff1ed3","to":"middleware-test-Az8bfXrFSulGv_fr1bFqJ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884079124,"env":"test","module":"auth-routes","userId":"c8f5448e-e70e-4d5a-941c-c8f3d651007c","email":"protected-test-4K3fNCzKeXeXIvx72pIDL@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767884079177,"env":"test","module":"auth-routes","userId":"83ee1273-f947-416b-b211-e1525c9df017","email":"middleware-test-Az8bfXrFSulGv_fr1bFqJ@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884079202,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884079216,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884079224,"env":"test","module":"email-queue","jobId":"5cd46460-6174-4822-b036-6eb5351b53ef","to":"session-test-nSBjQo-DYrrG8TwSjGxC7@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884079280,"env":"test","module":"auth-routes","userId":"2cf25c29-54f3-4ae7-a2df-0a708c41b5f7","email":"session-test-nSBjQo-DYrrG8TwSjGxC7@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":40,"time":1767884079309,"env":"test","module":"mfa-service","userId":"53d8ad468bdcea66aae8cbccf0ba3174","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884079322,"env":"test","module":"mfa-service","userId":"6bcd9eca5d920d9b51a6a5c522199d10","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884079322,"env":"test","module":"auth-routes","userId":"6bcd9eca5d920d9b51a6a5c522199d10","msg":"MFA verification failed during login"}
{"level":50,"time":1767884079328,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":50,"time":1767884079603,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/schema/collections.test.ts [2m([22m[2m34 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1076[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have correct table name[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have required columns[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have correct table name[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have required columns[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have correct table name[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have required columns[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have all expected field types[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should validate valid collection data[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should require tenantId, name, and slug[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should omit id, createdAt, and updatedAt[39m[32m 8[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow description to be null[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should validate valid field data[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should require collectionId, name, slug, and type[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should validate field type enum[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject invalid field type[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow options for select types[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow defaultValue[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should validate valid record data[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should require tenantId, collectionId, and data[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow empty data object[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow createdBy and updatedBy to be null[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow complex nested data structures[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce unique slug per tenant for collections[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce unique slug per collection for fields[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should cascade delete fields when collection is deleted[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should cascade delete records when collection is deleted[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should cascade delete records when tenant is deleted[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should set null on createdBy/updatedBy when user is deleted[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should support JSONB for field options[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should support JSONB for field default values[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should support JSONB for record data with fieldSlug Î“Ã¥Ã† value mapping[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should correctly infer Collection type[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should correctly infer CollectionField type[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should correctly infer CollectionRecord type[32m 0[2mms[22m[39m
{"level":30,"time":1767884079737,"env":"test","module":"auth-routes","userId":"c8f5448e-e70e-4d5a-941c-c8f3d651007c","msg":"User logged in successfully"}
{"level":30,"time":1767884079752,"env":"test","module":"auth-routes","userId":"83ee1273-f947-416b-b211-e1525c9df017","msg":"User logged in successfully"}
{"level":30,"time":1767884079789,"env":"test","module":"audit-log-service","userId":"c8f5448e-e70e-4d5a-941c-c8f3d651007c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884079799,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884079806,"env":"test","module":"audit-log-service","userId":"83ee1273-f947-416b-b211-e1525c9df017","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884079864,"env":"test","module":"auth-routes","userId":"ff87368e72c69dd6d1c229296128b9fc","msg":"User logged in successfully"}
{"level":30,"time":1767884079921,"env":"test","module":"audit-log-service","userId":"ff87368e72c69dd6d1c229296128b9fc","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884079935,"env":"test","module":"auth-routes","userId":"2cf25c29-54f3-4ae7-a2df-0a708c41b5f7","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884079989,"env":"test","module":"audit-log-service","userId":"2cf25c29-54f3-4ae7-a2df-0a708c41b5f7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884080051,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767884080077,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI logic generation failed"}
{"level":40,"time":1767884080080,"env":"test","module":"mfa-service","userId":"53d8ad468bdcea66aae8cbccf0ba3174","msg":"Invalid backup code provided"}
{"level":40,"time":1767884080081,"env":"test","module":"auth-routes","userId":"53d8ad468bdcea66aae8cbccf0ba3174","msg":"MFA verification failed during login"}
stderr | tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/generate-logic > should return generated logic
Logic Test Failed: {
  "success": false,
  "message": "Invalid request data",
  "error": "validation_error",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": [
        "currentWorkflow",
        "title"
      ],
      "message": "Required"
    }
  ]
}

{"level":30,"time":1767884080094,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767884080104,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI debug logic failed"}
{"level":30,"time":1767884080107,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767884080113,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI visualize logic failed"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/api.ai.logic.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 850[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return generated logic[39m[32m 47[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return debug issues[39m[32m 13[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return graph data[39m[32m 11[2mms[22m[39m
{"level":30,"time":1767884080145,"env":"test","module":"auth-routes","userId":"2cf25c29-54f3-4ae7-a2df-0a708c41b5f7","deviceFingerprint":"377ad01217b8c93ca52518d515505c47ab7553fab66d6fddaa60af67802c5a4c","msg":"Device marked as trusted"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884080230,"env":"test","module":"user-credentials-repository","userId":"00abf8f3-ff43-45a1-aa15-4a2be8891b44","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884080265,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884080296,"env":"test","module":"auth-routes","userId":"2cf25c29-54f3-4ae7-a2df-0a708c41b5f7","msg":"All other sessions revoked"}
{"level":30,"time":1767884080313,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/analytics_service.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1146[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should generate events and metrics on run completion[39m[32m 62[2mms[22m[39m
{"level":30,"time":1767884080335,"env":"test","module":"email-queue","jobId":"56e7b48c-c3c1-41ef-8ce2-88dfc6d030e1","to":"protected-test-Br_pO9BuZLsfJGK_aag9P@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884080350,"env":"test","module":"audit-log-service","userId":"2cf25c29-54f3-4ae7-a2df-0a708c41b5f7","eventType":"all_sessions_revoked","ipAddress":"::1","hasMetadata":false,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767884080387,"env":"test","module":"auth-routes","userId":"00abf8f3-ff43-45a1-aa15-4a2be8891b44","email":"protected-test-Br_pO9BuZLsfJGK_aag9P@example.com","msg":"User registered"}
{"level":30,"time":1767884080401,"env":"test","module":"intake-service","runId":"9f0af09c-5d74-48ee-9f64-5b213f32fc12","slug":"hybrid-jwt-NLoQNUA1Lp54-6oh6vDCG","userId":"83ee1273-f947-416b-b211-e1525c9df017","msg":"Created intake run"}
{"level":30,"time":1767884080453,"env":"test","module":"auth-routes","userId":"2cf25c29-54f3-4ae7-a2df-0a708c41b5f7","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1767884080616,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":50,"time":1767884080747,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884080768,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767884080800,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts[2m > [22m[2mAI Routes Integration[2m > [22m[2mPOST /api/ai/workflows/revise[2m > [22m[2mshould call AIService.reviseWorkflow with correct parameters
[22m[39mRevise Test Failed: {
  "success": false,
  "message": "Invalid request data",
  "error": "validation_error",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": [
        "currentWorkflow",
        "title"
      ],
      "message": "Required"
    }
  ]
}

{"level":30,"time":1767884080818,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767884080825,"env":"test","module":"ai-controller","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["workflowId"]},{"code":"invalid_type","expected":"object","received":"undefined","path":["currentWorkflow"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["userInstruction"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/api.ai.revise.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 867[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should call AIService.reviseWorkflow with correct parameters[39m[32m 53[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 400 for invalid request usage[32m 11[2mms[22m[39m
{"level":30,"time":1767884080835,"env":"test","module":"user-credentials-repository","userId":"dc6a258c-8403-4070-ad6d-bf9831e80be9","msg":"User credentials created"}
{"level":30,"time":1767884080897,"env":"test","module":"user-credentials-repository","userId":"a11b42ea-35b1-494c-9d96-cc6f4a8fc1a1","msg":"User credentials created"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767884080938,"env":"test","module":"email-queue","jobId":"f211755c-2599-4e97-8636-6c4caa6abc41","to":"middleware-test-KW0e2hlSfU5nf7FBYALuT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884080990,"env":"test","module":"auth-routes","userId":"dc6a258c-8403-4070-ad6d-bf9831e80be9","email":"middleware-test-KW0e2hlSfU5nf7FBYALuT@example.com","msg":"User registered"}
{"level":30,"time":1767884081009,"env":"test","module":"email-queue","jobId":"0361a386-3e9d-4545-838b-64b365c104b1","to":"session-test-7zUeuUF-jtMXaFyFe9iBX@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/services/StepService.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 832[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a step with auto-incrementing order[39m[32m 15[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create step with order 1 if section is empty[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate alias uniqueness before creating[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should allow creating step with null alias[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if section not found[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should verify workflow ownership[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should update step successfully[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate alias uniqueness when updating alias[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should allow updating step without changing alias[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if step not found[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if step does not belong to workflow[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should delete step successfully[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if step not found[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if step does not belong to workflow[32m 1[2mms[22m[39m
{"level":30,"time":1767884081074,"env":"test","module":"auth-routes","userId":"a11b42ea-35b1-494c-9d96-cc6f4a8fc1a1","email":"session-test-7zUeuUF-jtMXaFyFe9iBX@example.com","msg":"User registered"}
{"level":50,"time":1767884081089,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767884081171,"env":"test","module":"user-credentials-repository","userId":"1992515b-8031-416d-98e9-16a31de73191","msg":"User credentials created"}
{"level":50,"time":1767884081182,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884081197,"env":"test","module":"mfa-service","userId":"893116625edb01d131b42201bd44e6d4","msg":"TOTP verification successful"}
{"level":30,"time":1767884081248,"env":"test","module":"auth-routes","userId":"893116625edb01d131b42201bd44e6d4","msg":"MFA login successful"}
{"level":30,"time":1767884081272,"env":"test","module":"email-queue","jobId":"0882f586-bae9-4b8f-8c07-6b6eb20b27e0","to":"protected-test-lRwwcHvgbf8Yo9YuqBTGf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884081325,"env":"test","module":"auth-routes","userId":"1992515b-8031-416d-98e9-16a31de73191","email":"protected-test-lRwwcHvgbf8Yo9YuqBTGf@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767884081380,"env":"test","module":"auth-routes","userId":"045410e60e020dbb4aa3e6b832abec67","msg":"User logged in successfully"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1767884081411,"env":"test","module":"auth-routes","userId":"893116625edb01d131b42201bd44e6d4","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1767884081435,"env":"test","module":"audit-log-service","userId":"045410e60e020dbb4aa3e6b832abec67","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884081466,"env":"test","module":"auth-routes","userId":"979b410a82791a0de8501deeb0fe7551","msg":"User logged in successfully"}
{"level":30,"time":1767884081519,"env":"test","module":"audit-log-service","userId":"979b410a82791a0de8501deeb0fe7551","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884081601,"env":"test","module":"auth-routes","userId":"045410e60e020dbb4aa3e6b832abec67","deviceFingerprint":"5704edd074e9c212893f0aacd3ccb4ea052539cb69bd3f923d88aab5ed5844f1","msg":"Device marked as trusted"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767884081628,"env":"test","module":"auth-routes","userId":"dc6a258c-8403-4070-ad6d-bf9831e80be9","msg":"User logged in successfully"}
{"level":30,"time":1767884081641,"env":"test","module":"user-credentials-repository","userId":"8fd18637-5a0d-4222-a0d6-74688453fa9f","msg":"User credentials created"}
{"level":30,"time":1767884081686,"env":"test","module":"audit-log-service","userId":"dc6a258c-8403-4070-ad6d-bf9831e80be9","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884081748,"env":"test","module":"email-queue","jobId":"6142fe43-1eec-4d19-b644-140a0981e93b","to":"session-test-gz4K8zJqFoaV0X1SVn0mz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884081769,"env":"test","module":"auth-routes","userId":"045410e60e020dbb4aa3e6b832abec67","msg":"All other sessions revoked"}
{"level":30,"time":1767884081812,"env":"test","module":"auth-routes","userId":"8fd18637-5a0d-4222-a0d6-74688453fa9f","email":"session-test-gz4K8zJqFoaV0X1SVn0mz@example.com","msg":"User registered"}
{"level":30,"time":1767884081823,"env":"test","module":"audit-log-service","userId":"045410e60e020dbb4aa3e6b832abec67","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":50,"time":1767884081837,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/trusted.devices.real.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[33m 25205[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should trust current device[39m[33m 2105[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set trust expiry to 30 days [33m 1819[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update expiry if device already trusted[39m[33m 1648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 420[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all trusted devices[39m[33m 2256[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current device[39m[33m 1525[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude revoked devices[39m[33m 1629[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude expired devices[39m[33m 1578[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific device[39m[33m 1555[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent device[39m[33m 1588[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking other user's device[39m[33m 2289[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip MFA for trusted device[39m[33m 1804[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require MFA for untrusted device[39m[33m 1900[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update lastUsedAt on trusted device login[39m[33m 2288[2mms[22m[39m
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884081968,"env":"test","module":"auth-routes","userId":"1992515b-8031-416d-98e9-16a31de73191","msg":"User logged in successfully"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884082022,"env":"test","module":"audit-log-service","userId":"1992515b-8031-416d-98e9-16a31de73191","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884082027,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":50,"time":1767884082182,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884082226,"env":"test","module":"intake-service","runId":"42ee0226-bc21-47fd-a8f3-846ea298a061","slug":"hybrid-cookie-afEtP-m24hC6btGMvUmNy","msg":"Created intake run"}
[90mstdout[2m | tests/integration/auth/portal.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767884082453,"env":"test","module":"user-credentials-repository","userId":"be17670d-1f1e-4515-b536-2787bf06fe83","msg":"User credentials created"}
{"level":30,"time":1767884082566,"env":"test","module":"email-queue","jobId":"9296e132-ade5-440d-9f50-6a3075c177b5","to":"protected-test-BwEUq1Y6AqQfI58zaqlzh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767884082612,"env":"test","module":"user-credentials-repository","userId":"5b2ac355-84de-47a7-9a46-d56cde11dbb8","msg":"User credentials created"}
{"level":30,"time":1767884082617,"env":"test","module":"auth-routes","userId":"be17670d-1f1e-4515-b536-2787bf06fe83","email":"protected-test-BwEUq1Y6AqQfI58zaqlzh@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884082654,"env":"test","module":"user-credentials-repository","userId":"e6c06030-7704-4ced-86d5-e68d20a40eba","msg":"User credentials created"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884082723,"env":"test","module":"email-queue","jobId":"4d9ff7b9-5759-4818-80de-2a1783d77013","to":"session-test-RsSDi5Rgtul37YF_44UJ_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884082752,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"filtered_users","filters":{"combinator":"and","rules":[{"fieldPath":"city","op":"equals","valueSource":"const","value":"NYC"}]}},"msg":"List tools block failed"}
{"level":30,"time":1767884082770,"env":"test","module":"email-queue","jobId":"f9d16d07-1072-4e75-a2e8-c9778a48f9d8","to":"middleware-test-diWqcx-Chh7Lqh3i2fSOv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884082777,"env":"test","module":"auth-routes","userId":"5b2ac355-84de-47a7-9a46-d56cde11dbb8","email":"session-test-RsSDi5Rgtul37YF_44UJ_@example.com","msg":"User registered"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767884082763,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"senior_users","filters":{"combinator":"and","rules":[{"fieldPath":"age","op":"greater_than","valueSource":"const","value":30}]}},"msg":"List tools block failed"}
{"level":50,"time":1767884082765,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"active_nyc","filters":{"combinator":"and","rules":[{"fieldPath":"city","op":"equals","valueSource":"const","value":"NYC"},{"fieldPath":"active","op":"equals","valueSource":"const","value":true}]}},"msg":"List tools block failed"}
{"level":50,"time":1767884082767,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"young_or_sf","filters":{"combinator":"or","rules":[{"fieldPath":"age","op":"less_than","valueSource":"const","value":28},{"fieldPath":"city","op":"equals","valueSource":"const","value":"SF"}]}},"msg":"List tools block failed"}
{"level":50,"time":1767884082770,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"age","direction":"asc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767884082772,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"name","direction":"desc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767884082774,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"city","direction":"asc"},{"fieldPath":"age","direction":"desc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767884082776,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"limited_users","limit":3},"msg":"List tools block failed"}
{"level":50,"time":1767884082779,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"offset_users","offset":2},"msg":"List tools block failed"}
{"level":50,"time":1767884082785,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"paged_users","offset":1,"limit":2},"msg":"List tools block failed"}
{"level":50,"time":1767884082787,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"name_age_only","select":["name","age"]},"msg":"List tools block failed"}
{"level":50,"time":1767884082788,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"unique_cities","dedupe":{"fieldPath":"city"}},"msg":"List tools block failed"}
{"level":50,"time":1767884082790,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"all_users","outputs":{"countVar":"user_count"}},"msg":"List tools block failed"}
{"level":50,"time":1767884082795,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"all_users","sort":[{"fieldPath":"age","direction":"asc"}],"outputs":{"firstVar":"youngest_user"}},"msg":"List tools block failed"}
{"level":50,"time":1767884082797,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"processed_users","filters":{"combinator":"and","rules":[{"fieldPath":"active","op":"equals","valueSource":"const","value":true}]},"sort":[{"fieldPath":"age","direction":"desc"}],"offset":0,"limit":2,"select":["name","age"],"outputs":{"countVar":"active_count","firstVar":"oldest_active"}},"msg":"List tools block failed"}
{"level":50,"time":1767884082799,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"filtered_users","filters":{"combinator":"and","rules":[{"fieldPath":"age","op":"greater_than","valueSource":"const","value":30}]}},"msg":"List tools block failed"}
{"level":40,"time":1767884082800,"env":"test","sourceListVar":"nonexistent_list","inputKey":"nonexistent_list","msg":"Input list not found, treating as empty array"}
{"level":50,"time":1767884082802,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"simple_array","outputListVar":"sorted_array","sort":[{"fieldPath":"score","direction":"desc"}]},"msg":"List tools block failed"}
 [31mÎ“Â¥Â»[39m tests/ListTools.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 849[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter rows by equals condition[39m[32m 12[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter with greater_than operator[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter with AND combinator[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter with OR combinator[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should sort by single key ascending[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should sort by single key descending[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should sort by multiple keys[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply limit[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply offset[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply offset and limit together[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should select specific columns[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deduplicate by field[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should output count variable[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should output first row variable[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply all operations in sequence[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle empty input list[39m[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle missing source list[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle plain arrays[39m[32m 2[2mms[22m[39m
{"level":30,"time":1767884082822,"env":"test","module":"auth-routes","userId":"e6c06030-7704-4ced-86d5-e68d20a40eba","email":"middleware-test-diWqcx-Chh7Lqh3i2fSOv@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1767884083261,"env":"test","module":"auth-routes","userId":"1dae5ac7be5776395fb9cdaca5b482c3","msg":"User logged in successfully"}
{"level":30,"time":1767884083282,"env":"test","module":"auth-routes","userId":"be17670d-1f1e-4515-b536-2787bf06fe83","msg":"User logged in successfully"}
{"level":30,"time":1767884083313,"env":"test","module":"audit-log-service","userId":"1dae5ac7be5776395fb9cdaca5b482c3","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884083333,"env":"test","module":"audit-log-service","userId":"be17670d-1f1e-4515-b536-2787bf06fe83","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884083338,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should generate execution trace with lineage
[DEBUG Question] Node q1 executed. Key: userName, Value: Alice. Context keys: 3

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/debugging/Lineage.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 824[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should generate execution trace with lineage[32m 21[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should track skipped blocks in trace[39m[32m 7[2mms[22m[39m
{"level":30,"time":1767884083450,"env":"test","module":"auth-routes","userId":"e6c06030-7704-4ced-86d5-e68d20a40eba","msg":"User logged in successfully"}
{"level":30,"time":1767884083462,"env":"test","module":"auth-routes","userId":"5b2ac355-84de-47a7-9a46-d56cde11dbb8","msg":"User logged in successfully"}
{"level":30,"time":1767884083470,"env":"test","module":"auth-routes","userId":"b2f4d52319ccbee822ee8112ee43a383","msg":"Login requires MFA verification"}
stderr | tests/unit/services/WorkflowPatchService.test.ts
[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

{"level":30,"time":1767884083482,"env":"test","module":"auth-routes","userId":"1dae5ac7be5776395fb9cdaca5b482c3","msg":"All other sessions revoked"}
{"level":30,"time":1767884083504,"env":"test","module":"audit-log-service","userId":"e6c06030-7704-4ced-86d5-e68d20a40eba","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884083516,"env":"test","module":"audit-log-service","userId":"5b2ac355-84de-47a7-9a46-d56cde11dbb8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884083535,"env":"test","module":"audit-log-service","userId":"1dae5ac7be5776395fb9cdaca5b482c3","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767884083617,"env":"test","module":"auth-routes","userId":"5b2ac355-84de-47a7-9a46-d56cde11dbb8","msg":"User logged in successfully"}
{"level":30,"time":1767884083619,"env":"test","module":"auth-routes","userId":"5b2ac355-84de-47a7-9a46-d56cde11dbb8","msg":"User logged in successfully"}
{"level":30,"time":1767884083631,"env":"test","module":"mfa-service","userId":"b2f4d52319ccbee822ee8112ee43a383","msg":"TOTP verification successful"}
{"level":30,"time":1767884083640,"env":"test","module":"auth-routes","userId":"1dae5ac7be5776395fb9cdaca5b482c3","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1767884083668,"env":"test","module":"audit-log-service","userId":"5b2ac355-84de-47a7-9a46-d56cde11dbb8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884083670,"env":"test","module":"audit-log-service","userId":"5b2ac355-84de-47a7-9a46-d56cde11dbb8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884083680,"env":"test","module":"auth-routes","userId":"b2f4d52319ccbee822ee8112ee43a383","msg":"MFA login successful"}
{"level":30,"time":1767884083767,"env":"test","module":"user-credentials-repository","userId":"a9e3dd3c-337e-4cf7-8a4c-a272dbabd8dd","msg":"User credentials created"}
{"level":30,"time":1767884083865,"env":"test","module":"email-queue","jobId":"2bcdedce-0cd8-4e99-ae3e-f72aa77f654e","to":"protected-test-Mr7ggRM7evfAJiiSSF1dH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884083916,"env":"test","module":"auth-routes","userId":"a9e3dd3c-337e-4cf7-8a4c-a272dbabd8dd","email":"protected-test-Mr7ggRM7evfAJiiSSF1dH@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767884084034,"env":"test","module":"intake-service","runId":"d10c9502-4753-4ac9-a6a7-9204ccdd1ca8","slug":"hybrid-anon--8G_ev4rJq97p-K0Guw9q","msg":"Created intake run"}
{"level":30,"time":1767884084136,"env":"test","module":"user-credentials-repository","userId":"1578a7df-7429-482a-9095-c35f63ec2b60","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767884084239,"env":"test","module":"email-queue","jobId":"4d731086-1781-4bf4-8e9c-cf0b70ec4b86","to":"session-test-QxbsheGopaXR16mz31YJm@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884084286,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884084291,"env":"test","module":"auth-routes","userId":"1578a7df-7429-482a-9095-c35f63ec2b60","email":"session-test-QxbsheGopaXR16mz31YJm@example.com","msg":"User registered"}
{"level":30,"time":1767884084326,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884084485,"env":"test","module":"user-credentials-repository","userId":"5899e268-d5e1-459d-bdce-f380ba63ff8b","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884084588,"env":"test","module":"email-queue","jobId":"7e865c20-7959-4e50-bf0f-77ff3a75877e","to":"middleware-test-bkC62k9qqCXfNl785QASG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884084645,"env":"test","module":"auth-routes","userId":"5899e268-d5e1-459d-bdce-f380ba63ff8b","email":"middleware-test-bkC62k9qqCXfNl785QASG@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884084655,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/session.management.integration.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 22877[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create refresh token on login[39m[33m 902[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track device metadata in session[39m[33m 1257[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create separate sessions for multiple device logins[39m[33m 916[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions for user[39m[33m 976[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current session correctly[39m[33m 1002[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not include revoked sessions[39m[33m 1499[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should order sessions by last used (most recent first)[39m[33m 1564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 677[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 923[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent revoking current session [33m 1432[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow revoking other users sessions[39m[33m 1579[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent session ID[39m[33m 924[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all sessions except current[39m[33m 929[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all trusted devices [33m 1888[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require active session [33m 727[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject refresh token after 30 days[39m[33m 1001[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle multiple concurrent logins [33m 1538[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle concurrent token refreshes[39m[33m 933[2mms[22m[39m
{"level":30,"time":1767884084713,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884084721,"env":"test","module":"user-credentials-repository","userId":"346667da-af72-42d5-9a16-51ad5b8e906f","msg":"User credentials created"}
{"level":30,"time":1767884084830,"env":"test","module":"email-queue","jobId":"8e006fef-6697-465f-94e9-0241ca600692","to":"protected-test-ZoRIyS8Bu2qSVO3rBKHe4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884084884,"env":"test","module":"auth-routes","userId":"346667da-af72-42d5-9a16-51ad5b8e906f","email":"protected-test-ZoRIyS8Bu2qSVO3rBKHe4@example.com","msg":"User registered"}
{"level":30,"time":1767884084892,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767884085054,"env":"test","module":"auth-routes","userId":"fdbf0bbe4dc51108aafd3ef55a416941","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884085116,"env":"test","module":"audit-log-service","userId":"fdbf0bbe4dc51108aafd3ef55a416941","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884085231,"env":"test","module":"auth-routes","userId":"fdbf0bbe4dc51108aafd3ef55a416941","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1767884085249,"env":"test","module":"auth-routes","userId":"5899e268-d5e1-459d-bdce-f380ba63ff8b","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767884085302,"env":"test","module":"audit-log-service","userId":"5899e268-d5e1-459d-bdce-f380ba63ff8b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884085314,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884085332,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.projects.test.ts[2m > [22m[2mProjects API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884085337,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1767884085320,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884085321,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884085325,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884085336,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884085336,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884085336,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884085336,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767884085353,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884085340,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884085340,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884085345,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884085353,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884085353,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884085353,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884085353,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767884085469,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884085489,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884085498,"env":"test","module":"auth-routes","userId":"346667da-af72-42d5-9a16-51ad5b8e906f","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.projects.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 1017[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should create a new project
       [2m[90mÎ“Ã¥Ã´[39m[22m should reject without authentication
       [2m[90mÎ“Ã¥Ã´[39m[22m should reject with invalid data
       [2m[90mÎ“Ã¥Ã´[39m[22m should list projects for tenant
       [2m[90mÎ“Ã¥Ã´[39m[22m should support pagination
       [2m[90mÎ“Ã¥Ã´[39m[22m should get project by ID
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for non-existent project
       [2m[90mÎ“Ã¥Ã´[39m[22m should update project
       [2m[90mÎ“Ã¥Ã´[39m[22m should soft-delete project
       [2m[90mÎ“Ã¥Ã´[39m[22m should not allow cross-tenant access
{"level":30,"time":1767884085477,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884085478,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884085483,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884085489,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884085489,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884085489,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884085489,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.runs.docx.test.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 1020[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should execute workflow with template node and generate DOCX
       [2m[90mÎ“Ã¥Ã´[39m[22m should handle missing template data gracefully
       [2m[90mÎ“Ã¥Ã´[39m[22m should download DOCX output from successful run
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for PDF when not generated
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for non-existent run
       [2m[90mÎ“Ã¥Ã´[39m[22m should extract placeholders from uploaded template
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests[2m > [22m[2mPOST /api/ai/doc/analyze[2m > [22m[2mshould analyze a DOCX file and return variables
[22m[39mFAIL_STATUS: 500
FAIL_BODY: {}

{"level":30,"time":1767884085551,"env":"test","module":"audit-log-service","userId":"346667da-af72-42d5-9a16-51ad5b8e906f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884085555,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884085588,"env":"test","module":"auth-routes","userId":"bbfdb510eb19eb84eef15cb953741761","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.ai.doc.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1038[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should analyze a DOCX file and return variables[39m[32m 60[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fail if no file is provided[39m[32m 37[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should suggest mappings between template and workflow variables[32m 46[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return improvement suggestions[32m 7[2mms[22m[39m
{"level":40,"time":1767884085696,"env":"test","module":"mfa-service","userId":"bbfdb510eb19eb84eef15cb953741761","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884085696,"env":"test","module":"auth-routes","userId":"bbfdb510eb19eb84eef15cb953741761","msg":"MFA verification failed during login"}
{"level":50,"time":1767884085702,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767884085828,"env":"test","module":"intake-service","runId":"81f4b289-59cb-4511-8054-c5a36582cea4","slug":"hybrid-invalid-94hp92RcSb4-p1UArvIE2","msg":"Created intake run"}
{"level":30,"time":1767884085841,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767884085841,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":6,"totalTokens":1207,"durationMs":0,"estimatedCostUSD":0.01219,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884085841,"env":"test","module":"ai-service","error":{},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1767884085846,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767884085846,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"responseTokens":68,"totalTokens":1280,"durationMs":0,"estimatedCostUSD":0.004656,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884085846,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1767884085848,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767884085848,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"responseTokens":33,"totalTokens":1234,"durationMs":0,"estimatedCostUSD":0.004098,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767884085849,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767884085859,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"maxTokens":4000,"msg":"AI request started"}
{"level":30,"time":1767884085859,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"responseTokens":44,"totalTokens":302,"durationMs":1,"estimatedCostUSD":0.0039,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1767884085859,"env":"test","module":"ai-service","duration":1,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
 [31mÎ“Â¥Â»[39m tests/unit/ai.service.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 31781[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with OpenAI configuration[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate a valid workflow from description[39m[32m 19[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate unique section IDs[39m[32m 93[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate unique step IDs[39m[32m 35[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate logic rules reference existing steps[39m[32m 31[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle rate limit errors[39m[33m 30006[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle JSON parsing errors[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with Anthropic configuration[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate a valid workflow from description[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should strip markdown code blocks from Anthropic responses[39m[32m 9[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should generate binding suggestions[32m 4[2mms[22m[39m
{"level":30,"time":1767884085989,"env":"test","module":"user-credentials-repository","userId":"c9218573-c21d-483e-9823-785071195177","msg":"User credentials created"}
{"level":30,"time":1767884086099,"env":"test","module":"email-queue","jobId":"ed3e3ee5-4f7b-4763-817b-22a85b8d5b2c","to":"protected-test-ywPjsuXTXLqPT-Ya1drl6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1767884086158,"env":"test","module":"auth-routes","userId":"c9218573-c21d-483e-9823-785071195177","email":"protected-test-ywPjsuXTXLqPT-Ya1drl6@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767884086273,"env":"test","module":"user-credentials-repository","userId":"9d41a5b2-8ab7-4b31-a9a7-e6528ca954cb","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884086368,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":50,"time":1767884086372,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884086383,"env":"test","module":"email-queue","jobId":"469f08f1-38d6-4045-8113-46787eb58dd5","to":"middleware-test-l89WQASqsVhaUL1VrjLLi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884086438,"env":"test","module":"auth-routes","userId":"9d41a5b2-8ab7-4b31-a9a7-e6528ca954cb","email":"middleware-test-l89WQASqsVhaUL1VrjLLi@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":50,"time":1767884086523,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767884086935,"env":"test","module":"user-credentials-repository","userId":"c5748ec6-4107-41aa-8461-63e1d688e1cc","msg":"User credentials created"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884087016,"env":"test","module":"auth-routes","userId":"9d41a5b2-8ab7-4b31-a9a7-e6528ca954cb","msg":"User logged in successfully"}
{"level":30,"time":1767884087047,"env":"test","module":"email-queue","jobId":"980d27a9-6faf-4971-aafe-d0a31f12067a","to":"protected-test-v_Y0Z1oWowRDPERRoh-1W@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884087074,"env":"test","module":"audit-log-service","userId":"9d41a5b2-8ab7-4b31-a9a7-e6528ca954cb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884087099,"env":"test","module":"auth-routes","userId":"c5748ec6-4107-41aa-8461-63e1d688e1cc","email":"protected-test-v_Y0Z1oWowRDPERRoh-1W@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884087160,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884087216,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884087240,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":40,"time":1767884087334,"env":"test","module":"mfa-service","userId":"7cc06045014936519d35d651223dd31b","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884087334,"env":"test","module":"auth-routes","userId":"7cc06045014936519d35d651223dd31b","msg":"MFA verification failed during login"}
{"level":50,"time":1767884087339,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884087459,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884087661,"env":"test","module":"user-credentials-repository","userId":"628f820b-57c4-457a-8dae-15034ade4247","msg":"User credentials created"}
{"level":30,"time":1767884087715,"env":"test","module":"auth-routes","userId":"c5748ec6-4107-41aa-8461-63e1d688e1cc","msg":"User logged in successfully"}
{"level":30,"time":1767884087767,"env":"test","module":"audit-log-service","userId":"c5748ec6-4107-41aa-8461-63e1d688e1cc","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884087768,"env":"test","module":"auth-routes","userId":"0b6421514308e080ce96e8a8e397b572","msg":"User logged in successfully"}
{"level":30,"time":1767884087769,"env":"test","module":"email-queue","jobId":"d10f3afe-d734-4e5a-8757-743e66e8a34f","to":"middleware-test-f7NmdFW2L-d35E8p7WFo9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884087772,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884087822,"env":"test","module":"auth-routes","userId":"628f820b-57c4-457a-8dae-15034ade4247","email":"middleware-test-f7NmdFW2L-d35E8p7WFo9@example.com","msg":"User registered"}
{"level":30,"time":1767884087828,"env":"test","module":"audit-log-service","userId":"0b6421514308e080ce96e8a8e397b572","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/unit/server/transferOwnership.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:189:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

{"level":30,"time":1767884087939,"env":"test","module":"auth-routes","userId":"0b6421514308e080ce96e8a8e397b572","sessionCount":1,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/session.management.real.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 31363[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions for current user[39m[33m 2697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark current session correctly [33m 2031[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude revoked sessions[39m[33m 1735[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should order sessions by last used (most recent first)[39m[33m 2057[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter sessions by current user only[39m[33m 2008[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 425[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1619[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 1457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent session [33m 1517[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking other user's session[39m[33m 2046[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all other sessions[39m[33m 1868[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should keep current session active[39m[33m 1686[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 if no active session found [33m 1485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all trusted devices [33m 1896[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle user with single session gracefully [33m 1765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should include device metadata in sessions [33m 1589[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not expose sensitive token data[39m[33m 1141[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track session activity timestamps [33m 1567[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884088134,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884088201,"env":"test","module":"user-credentials-repository","userId":"80756291-96a7-46cd-b136-f5a0ecddf5f5","msg":"User credentials created"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884088304,"env":"test","module":"email-queue","jobId":"1eb25928-abd0-410b-8817-7908fbdcc03c","to":"protected-test-6exQIZVe3V9OnhB2H1NAQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884088357,"env":"test","module":"auth-routes","userId":"80756291-96a7-46cd-b136-f5a0ecddf5f5","email":"protected-test-6exQIZVe3V9OnhB2H1NAQ@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767884088532,"env":"test","module":"user-credentials-repository","userId":"95de13c6-c09b-45a6-9951-e5f914557417","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884088637,"env":"test","module":"email-queue","jobId":"584a12be-b01a-4700-8ef8-d5b6b15c6f2e","to":"middleware-test-gNeAhwuWAmy7iR0cZcXLY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884088691,"env":"test","module":"auth-routes","userId":"95de13c6-c09b-45a6-9951-e5f914557417","email":"middleware-test-gNeAhwuWAmy7iR0cZcXLY@example.com","msg":"User registered"}
{"level":50,"time":1767884088784,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884088784,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767884088893,"env":"test","module":"mfa-service","userId":"2a3d9edfac36ecbd307ba59d02221f20","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767884088894,"env":"test","module":"auth-routes","userId":"2a3d9edfac36ecbd307ba59d02221f20","msg":"MFA verification failed during login"}
{"level":50,"time":1767884088898,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1767884088922,"env":"test","module":"user-credentials-repository","userId":"9ee483eb-155b-4768-93dc-b2bb98d1d3cb","msg":"User credentials created"}
{"level":30,"time":1767884089031,"env":"test","module":"email-queue","jobId":"4229b9fa-5216-402f-9f4e-a85cbd9dd6fb","to":"test-1767884088518-w0p9v@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/js_helpers.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 778[2mms[22m[39m
     [2m[90mÎ“Ã¥Ã´[39m[22m should execute a JS block that uses helper functions
{"level":30,"time":1767884089084,"env":"test","module":"auth-routes","userId":"9ee483eb-155b-4768-93dc-b2bb98d1d3cb","email":"test-1767884088518-w0p9v@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884089162,"env":"test","module":"user-credentials-repository","userId":"e0b7ab2e-a4dc-4ee5-b0aa-71fc7e75cc13","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.snapshots.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 780[2mms[22m[39m
     [2m[90mÎ“Ã¥Ã´[39m[22m should maintain immutability of runs across versions
{"level":30,"time":1767884089217,"env":"test","module":"auth-routes","userId":"95de13c6-c09b-45a6-9951-e5f914557417","msg":"User logged in successfully"}
{"level":30,"time":1767884089263,"env":"test","module":"email-queue","jobId":"3a0d6b07-7675-4e48-8cc0-7297551fd303","to":"protected-test-t_fGIWaf65tTPyHYqSBoR@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884089272,"env":"test","module":"audit-log-service","userId":"95de13c6-c09b-45a6-9951-e5f914557417","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884089317,"env":"test","module":"auth-routes","userId":"e0b7ab2e-a4dc-4ee5-b0aa-71fc7e75cc13","email":"protected-test-t_fGIWaf65tTPyHYqSBoR@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.runs.graph.test.ts [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[33m 741[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should list all runs with pagination
       [2m[90mÎ“Ã¥Ã´[39m[22m should filter runs by status
       [2m[90mÎ“Ã¥Ã´[39m[22m should filter runs by workflow
       [2m[90mÎ“Ã¥Ã´[39m[22m should filter runs by project
       [2m[90mÎ“Ã¥Ã´[39m[22m should filter runs by date range
       [2m[90mÎ“Ã¥Ã´[39m[22m should search runs by query string
       [2m[90mÎ“Ã¥Ã´[39m[22m should get run by ID with all details
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for non-existent run
       [2m[90mÎ“Ã¥Ã´[39m[22m should get logs for a run
       [2m[90mÎ“Ã¥Ã´[39m[22m should re-run workflow with same inputs
       [2m[90mÎ“Ã¥Ã´[39m[22m should re-run workflow with override inputs
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for non-existent run
       [2m[90mÎ“Ã¥Ã´[39m[22m should export runs to CSV
       [2m[90mÎ“Ã¥Ã´[39m[22m should export runs with filters applied
       [2m[90mÎ“Ã¥Ã´[39m[22m should compare two runs
       [2m[90mÎ“Ã¥Ã´[39m[22m should identify changed input keys
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 if run A not found
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 if run B not found
       [2m[90mÎ“Ã¥Ã´[39m[22m should enforce tenant isolation on runs list
[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":50,"time":1767884089671,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767884089770,"env":"test","module":"user-credentials-repository","userId":"2a0e7199-959d-4c8a-8c3e-b1158dba2f2b","msg":"User credentials created"}
{"level":30,"time":1767884089870,"env":"test","module":"email-queue","jobId":"2004a1df-5ff5-474d-a737-11da1f723fa1","to":"middleware-test-a7lTAtuQRLXoX6a6klIT1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767884089922,"env":"test","module":"auth-routes","userId":"2a0e7199-959d-4c8a-8c3e-b1158dba2f2b","email":"middleware-test-a7lTAtuQRLXoX6a6klIT1@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1767884090070,"env":"test","module":"user-credentials-repository","userId":"d528ab48-8746-4129-a238-311ceb8a0362","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767884090168,"env":"test","module":"email-queue","jobId":"37ed1a58-f5b4-4e58-94bf-5c4ca23e27be","to":"protected-test-Nm6GyYDGQn618e10vzi--@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884090184,"env":"test","module":"auth-routes","userId":"b918dee88397b40d0a75424e29a6308f","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884090218,"env":"test","module":"auth-routes","userId":"d528ab48-8746-4129-a238-311ceb8a0362","email":"protected-test-Nm6GyYDGQn618e10vzi--@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884090235,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884090255,"env":"test","module":"audit-log-service","userId":"b918dee88397b40d0a75424e29a6308f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884090564,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884090603,"env":"test","module":"user-credentials-repository","userId":"db30a32d-bdeb-4e15-a081-50a6a757c975","msg":"User credentials created"}
{"level":30,"time":1767884090709,"env":"test","module":"email-queue","jobId":"3e648f14-62b9-4323-a626-73571bc9975c","to":"middleware-test-77BcD4jeaaVPadtlZ97In@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884090764,"env":"test","module":"auth-routes","userId":"db30a32d-bdeb-4e15-a081-50a6a757c975","email":"middleware-test-77BcD4jeaaVPadtlZ97In@example.com","msg":"User registered"}
{"level":30,"time":1767884090880,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884090893,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884090885,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884090886,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884090889,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884090892,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884090892,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884090893,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884090893,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767884090933,"env":"test","module":"user-credentials-repository","userId":"c0a71ee2-8a4a-49f8-8c42-42a50615edae","msg":"User credentials created"}
{"level":30,"time":1767884091040,"env":"test","module":"email-queue","jobId":"42902cc9-ad01-49de-bd74-0369b7ea91cf","to":"protected-test-QlvmD1oDtAW1jiwk8zedG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884091078,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884091089,"env":"test","module":"auth-routes","userId":"c0a71ee2-8a4a-49f8-8c42-42a50615edae","email":"protected-test-QlvmD1oDtAW1jiwk8zedG@example.com","msg":"User registered"}
{"level":30,"time":1767884091335,"env":"test","module":"user-credentials-repository","userId":"67a56e12-4bbd-4223-9d8e-7b9f8f488077","msg":"User credentials created"}
{"level":30,"time":1767884091438,"env":"test","module":"email-queue","jobId":"bd6d5c22-be80-4733-9725-db632e960124","to":"test-Wn7bP4NVMjEPBLNGh-OJq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884091443,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884091451,"env":"test","module":"user-credentials-repository","userId":"f0a2db5c-18d6-41b5-84f8-31fd9e82b7b3","msg":"User credentials created"}
{"level":30,"time":1767884091489,"env":"test","module":"auth-routes","userId":"67a56e12-4bbd-4223-9d8e-7b9f8f488077","email":"test-Wn7bP4NVMjEPBLNGh-OJq@example.com","msg":"User registered"}
{"level":50,"time":1767884091519,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/mfa.flow.real.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 34777[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete full MFA setup flow[39m[33m 2338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid TOTP code during setup [33m 1972[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow MFA setup if already enabled [33m 1624[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate unique backup codes[39m[33m 1078[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should store hashed backup codes [33m 1834[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require MFA for enabled users [33m 1747[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete MFA login with valid TOTP[39m[33m 1399[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid TOTP during login [33m 1545[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept TOTP codes within 60-second window[39m[33m 1773[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with valid backup code[39m[33m 2471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark backup code as used [33m 1243[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent backup code reuse[39m[33m 1190[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should try TOTP before backup code[39m[33m 2348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return MFA status for user [33m 1551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return backup codes count for MFA users [33m 2213[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should disable MFA with password verification[39m[33m 1856[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require correct password to disable MFA[39m[33m 1637[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should regenerate backup codes[39m[33m 1558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return error if MFA not enabled [33m 1463[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce MFA for tenant users when required by tenant[39m[33m 1158[2mms[22m[39m
{"level":30,"time":1767884091553,"env":"test","module":"email-queue","jobId":"0a9a03e5-3e76-4748-9755-bf314e7d60a3","to":"middleware-test-DhqLu9qOpTb29HTud2T0i@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884091608,"env":"test","module":"auth-routes","userId":"f0a2db5c-18d6-41b5-84f8-31fd9e82b7b3","email":"middleware-test-DhqLu9qOpTb29HTud2T0i@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884091812,"env":"test","module":"user-credentials-repository","userId":"3ee92a77-6436-4cbe-bf18-7d99206b9c87","msg":"User credentials created"}
{"level":30,"time":1767884091914,"env":"test","module":"email-queue","jobId":"6e8b23f8-aa80-4187-ae01-f00e68540262","to":"protected-test-xarHPzmIF20FUTokGwSi3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767884091915,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884091966,"env":"test","module":"auth-routes","userId":"3ee92a77-6436-4cbe-bf18-7d99206b9c87","email":"protected-test-xarHPzmIF20FUTokGwSi3@example.com","msg":"User registered"}
{"level":30,"time":1767884092047,"env":"test","module":"user-credentials-repository","userId":"840fde0e-c98d-414d-96a4-ce7e7ff57bab","msg":"User credentials created"}
{"level":30,"time":1767884092148,"env":"test","module":"email-queue","jobId":"601aa5b7-8fac-4086-a3dc-a6aeca07a7a1","to":"test-1767884091672-hdibqp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884092199,"env":"test","module":"auth-routes","userId":"840fde0e-c98d-414d-96a4-ce7e7ff57bab","email":"test-1767884091672-hdibqp@example.com","msg":"User registered"}
{"level":30,"time":1767884092287,"env":"test","module":"user-credentials-repository","userId":"404bb94b-f43e-47ad-8ffb-c6dff1e2fe02","msg":"User credentials created"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767884092405,"env":"test","module":"email-queue","jobId":"b07cf243-7e5c-4c2e-a8a0-f69264d65e1b","to":"middleware-test-kFITkcByzeso4pirL-8YS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884092454,"env":"test","module":"auth-routes","userId":"404bb94b-f43e-47ad-8ffb-c6dff1e2fe02","email":"middleware-test-kFITkcByzeso4pirL-8YS@example.com","msg":"User registered"}
{"level":30,"time":1767884092522,"env":"test","module":"user-credentials-repository","userId":"bdb4d1ef-0be4-4425-8d3a-40b5293e39af","msg":"User credentials created"}
{"level":30,"time":1767884092540,"env":"test","module":"auth-routes","userId":"3ee92a77-6436-4cbe-bf18-7d99206b9c87","msg":"User logged in successfully"}
{"level":30,"time":1767884092593,"env":"test","module":"audit-log-service","userId":"3ee92a77-6436-4cbe-bf18-7d99206b9c87","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884092628,"env":"test","module":"email-queue","jobId":"93d5004e-32d7-48f3-9bfc-1a52c3bd91d8","to":"viewer-yNFp5qM0iROlsG6x2FSXv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884092680,"env":"test","module":"auth-routes","userId":"bdb4d1ef-0be4-4425-8d3a-40b5293e39af","email":"viewer-yNFp5qM0iROlsG6x2FSXv@example.com","msg":"User registered"}
{"level":40,"time":1767884092794,"env":"test","module":"rbac-middleware","userId":"bdb4d1ef-0be4-4425-8d3a-40b5293e39af","userRole":"viewer","permission":"workflow:create","path":"/projects/4a1e29c1-8432-4ded-8d6d-df30319637af/workflows","msg":"Permission denied"}
{"level":30,"time":1767884092983,"env":"test","module":"auth-routes","userId":"404bb94b-f43e-47ad-8ffb-c6dff1e2fe02","msg":"User logged in successfully"}
{"level":30,"time":1767884093035,"env":"test","module":"audit-log-service","userId":"404bb94b-f43e-47ad-8ffb-c6dff1e2fe02","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884093063,"env":"test","module":"user-credentials-repository","userId":"efc53387-65c7-4d23-a587-04f9e1674a18","msg":"User credentials created"}
{"level":40,"time":1767884093141,"env":"test","workflowId":"3c377310-ec21-4ba3-9d21-ed1a9942f835","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":30,"time":1767884093162,"env":"test","module":"email-queue","jobId":"71911f4d-0ead-4c0e-a98a-b4c45a634cfa","to":"protected-test-AkBBUbZJ3q55DYBfBIaGz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884093213,"env":"test","module":"auth-routes","userId":"efc53387-65c7-4d23-a587-04f9e1674a18","email":"protected-test-AkBBUbZJ3q55DYBfBIaGz@example.com","msg":"User registered"}
{"level":30,"time":1767884093257,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1767884093296,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"Failed to render template"}
{"level":30,"time":1767884093466,"env":"test","workflowId":"9acf9cb5-b85c-4b9d-bec8-5b5c856da8b4","userId":"2d15c914-903c-4d3e-930a-b00df406f0d2","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1767884093482,"env":"test","module":"user-credentials-repository","userId":"3e05f95f-6cec-47cb-9983-74313455c8e4","msg":"User credentials created"}
{"level":50,"time":1767884093583,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884093595,"env":"test","module":"email-queue","jobId":"35484ba2-7379-4874-aae9-b1c539a3c707","to":"test-1767884093100-kabyjr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884093650,"env":"test","module":"auth-routes","userId":"3e05f95f-6cec-47cb-9983-74313455c8e4","email":"test-1767884093100-kabyjr@example.com","msg":"User registered"}
{"level":30,"time":1767884093885,"env":"test","workflowId":"9acf9cb5-b85c-4b9d-bec8-5b5c856da8b4","userId":"163b26bf-ee00-4fa5-81ef-06f660cb61cc","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1767884093955,"env":"test","module":"user-credentials-repository","userId":"d0f46ce9-138b-4b02-845d-ebc220199ab1","msg":"User credentials created"}
{"level":30,"time":1767884094052,"env":"test","module":"email-queue","jobId":"f0f58b03-75de-44c0-9934-44a54cbf18ea","to":"protected-test-f65kFc54QOIuE5uO3BMyW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884094109,"env":"test","module":"auth-routes","userId":"d0f46ce9-138b-4b02-845d-ebc220199ab1","email":"protected-test-f65kFc54QOIuE5uO3BMyW@example.com","msg":"User registered"}
{"level":50,"time":1767884094140,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests[2m > [22m[2mshould generate basic autonumber without prefix
[22m[39mRow 1 Basic Autonumber: 0001
Row 2 Basic Autonumber: 0002

{"level":50,"time":1767884094472,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884094508,"env":"test","module":"user-credentials-repository","userId":"58b18f6d-e023-469a-bd5a-ea6ec8b1c5b0","msg":"User credentials created"}
{"level":30,"time":1767884094611,"env":"test","module":"email-queue","jobId":"4a911977-142b-490c-a0bd-22b309667611","to":"middleware-test-igPOWOwfaLGjkxtu8ofu2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884094667,"env":"test","module":"auth-routes","userId":"58b18f6d-e023-469a-bd5a-ea6ec8b1c5b0","email":"middleware-test-igPOWOwfaLGjkxtu8ofu2@example.com","msg":"User registered"}
{"level":30,"time":1767884094671,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"mode":"create","tableId":"bdc124bc-a56b-42a9-9bbe-96b58028cf11","dataSourceId":"20259392-db8e-463c-91de-d700122871ca","columnMappings":[{"value":"{{8fbcf998-79e8-4612-81d4-3ecda9942df8}}","columnId":"57fa9cea-5718-43a6-9ce6-f707effaa0ff"}]},"tableId":"bdc124bc-a56b-42a9-9bbe-96b58028cf11","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767884094842,"env":"test","module":"user-credentials-repository","userId":"bf39c05d-9fed-4ec4-a309-54128ee67021","msg":"User credentials created"}
{"level":30,"time":1767884094947,"env":"test","module":"email-queue","jobId":"fce3a305-f22f-4bcd-9a08-3db5a9a9e299","to":"protected-test-OOG2T7l1Imt4jBjaEYhq3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884094999,"env":"test","module":"auth-routes","userId":"bf39c05d-9fed-4ec4-a309-54128ee67021","email":"protected-test-OOG2T7l1Imt4jBjaEYhq3@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884095194,"env":"test","module":"auth-routes","userId":"58b18f6d-e023-469a-bd5a-ea6ec8b1c5b0","msg":"User logged in successfully"}
{"level":30,"time":1767884095244,"env":"test","module":"audit-log-service","userId":"58b18f6d-e023-469a-bd5a-ea6ec8b1c5b0","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884095248,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884095329,"env":"test","module":"auth-routes","userId":"2a0de9ba1f791f015a718cbea6f5d616","msg":"User logged in successfully"}
{"level":30,"time":1767884095379,"env":"test","module":"audit-log-service","userId":"2a0de9ba1f791f015a718cbea6f5d616","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884095556,"env":"test","module":"auth-routes","userId":"bf39c05d-9fed-4ec4-a309-54128ee67021","msg":"User logged in successfully"}
{"level":30,"time":1767884095605,"env":"test","module":"audit-log-service","userId":"bf39c05d-9fed-4ec4-a309-54128ee67021","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767884095617,"env":"test","module":"user-credentials-repository","userId":"1f309513-63e8-484b-8b13-f2a89c3f192e","msg":"User credentials created"}
{"level":40,"time":1767884095670,"env":"test","workflowId":"97b3dea3-6040-42ee-843e-2cfe3b53996d","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":30,"time":1767884095721,"env":"test","module":"email-queue","jobId":"1c5d0643-141f-4fb0-beb8-ee9554fe1041","to":"middleware-test-9E7TpNPmIknfN_vSZrARA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884095764,"env":"test","workflowId":"9acf9cb5-b85c-4b9d-bec8-5b5c856da8b4","userId":"2d15c914-903c-4d3e-930a-b00df406f0d2","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1767884095770,"env":"test","module":"auth-routes","userId":"1f309513-63e8-484b-8b13-f2a89c3f192e","email":"middleware-test-9E7TpNPmIknfN_vSZrARA@example.com","msg":"User registered"}
{"level":30,"time":1767884095891,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884095903,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts[2m > [22m[2mIntake Workflow Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884095896,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884095897,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884095900,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884095903,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884095903,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884095903,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884095903,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767884096071,"env":"test","module":"auth-routes","userId":"bf39c05d-9fed-4ec4-a309-54128ee67021","msg":"User logged in successfully"}
{"level":50,"time":1767884096093,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884096124,"env":"test","module":"audit-log-service","userId":"bf39c05d-9fed-4ec4-a309-54128ee67021","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/auth.middleware.integration.test.ts:41:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(d383900e-bf0a-4c7f-a6d6-b4d6e320d55b) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/auth.middleware.integration.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m14 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 34315[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow access with valid JWT Bearer token[39m[33m 855[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when no token provided[39m[33m 921[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 with invalid token [33m 1148[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 with expired token [33m 2305[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should proceed without authentication if no token provided
[31m       [31mâ”œÃ¹[31m should authenticate with JWT Bearer token[39m[33m 885[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with refresh token cookie (GET only)[39m[33m 887[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject cookie auth for POST requests (mutation-strict) [33m 1169[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for PUT requests[39m[33m 925[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for DELETE requests[39m[33m 883[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow cookie auth for HEAD requests[39m[33m 855[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prioritize JWT over cookie when both present[39m[33m 2108[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when no auth provided[39m[33m 853[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when both JWT and cookie are invalid [33m 1243[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with JWT if provided [33m 1833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with cookie if JWT not provided [33m 1827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should proceed anonymously if no auth provided [33m 1806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should proceed anonymously if both JWT and cookie are invalid [33m 1794[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should only allow safe methods for cookie auth [33m 1411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should ignore cookies when Bearer token present[39m[33m 895[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should attach userId to request [33m 1250[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach userEmail to request[39m[33m 850[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent error format for missing token[39m[33m 843[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent error format for invalid token[39m[33m 837[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return consistent error format for expired token [33m 2224[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle malformed JWT gracefully [33m 1108[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle JWT with wrong algorithm[39m[33m 846[2mms[22m[39m
{"level":30,"time":1767884096353,"env":"test","module":"user-credentials-repository","userId":"f6e32b1a-ec65-4acb-aaa4-7aad5f36d507","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884096461,"env":"test","module":"email-queue","jobId":"124ab5ea-82a0-4aa3-aa6f-6f889693d012","to":"test-fgPbSXEfqvCV8slqFYEND@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884096520,"env":"test","module":"auth-routes","userId":"f6e32b1a-ec65-4acb-aaa4-7aad5f36d507","email":"test-fgPbSXEfqvCV8slqFYEND@example.com","msg":"User registered"}
{"level":30,"time":1767884096607,"env":"test","module":"user-credentials-repository","userId":"7e584d98-1b9d-4969-9e24-c018228691f4","msg":"User credentials created"}
{"level":30,"time":1767884096707,"env":"test","module":"email-queue","jobId":"c68f815c-b921-416e-905a-6709c70d5486","to":"protected-test-mJ1JMaNQzfHNUJ4YjqfJ-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884096763,"env":"test","module":"auth-routes","userId":"7e584d98-1b9d-4969-9e24-c018228691f4","email":"protected-test-mJ1JMaNQzfHNUJ4YjqfJ-@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884096844,"env":"test","workflowId":"97b3dea3-6040-42ee-843e-2cfe3b53996d","queryId":"0fe3e0e7-3007-4f87-9f62-ff60d6b024b2","outputVar":"my_results","msg":"Executing query block"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884097092,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/dataBlocks.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 5800[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should write data to DataVault via WriteBlock [33m 2503[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should query data from DataVault via QueryBlock and use in Logic [33m 1880[2mms[22m[39m
{"level":30,"time":1767884097335,"env":"test","module":"auth-routes","userId":"7e584d98-1b9d-4969-9e24-c018228691f4","msg":"User logged in successfully"}
{"level":30,"time":1767884097385,"env":"test","module":"audit-log-service","userId":"7e584d98-1b9d-4969-9e24-c018228691f4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884097657,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884097816,"env":"test","workflowId":"6fda71ef-28df-4985-9109-498e6b626ae6","userId":"f6e32b1a-ec65-4acb-aaa4-7aad5f36d507","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1767884098020,"env":"test","module":"user-credentials-repository","userId":"4e17d318-7d18-4314-b15c-23816a53edc5","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/server/organizationService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 8069[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create organization and auto-create admin membership [33m 413[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return all organizations for user [33m 407[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to update organization [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should deny non-admin from updating organization [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return all members of organization [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to promote member [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to demote other admin [33m 769[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent self-demotion [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to remove member [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent self-removal [33m 411[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow member to leave organization [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to leave organization [33m 841[2mms[22m[39m
{"level":50,"time":1767884098098,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884098128,"env":"test","module":"email-queue","jobId":"716c5380-de73-487f-a6d7-d5469cc48df9","to":"protected-test-yEib6DBYqGN7voDAtriE8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884098179,"env":"test","module":"auth-routes","userId":"4e17d318-7d18-4314-b15c-23816a53edc5","email":"protected-test-yEib6DBYqGN7voDAtriE8@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 8127[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 2: Invite member via email [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 3: Accept invite [33m 520[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 4: Create workflow owned by user [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 5: Transfer workflow to organization [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 6: Org member (user2) can access workflow [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 16: Re-add member and verify access restored [33m 425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot invite same email twice (pending invite exists) [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot accept expired invite [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot transfer workflow to org user is not a member of [33m 538[2mms[22m[39m
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767884098764,"env":"test","module":"auth-routes","userId":"4e17d318-7d18-4314-b15c-23816a53edc5","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884098816,"env":"test","module":"audit-log-service","userId":"4e17d318-7d18-4314-b15c-23816a53edc5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests
[22m[39mError cleaning up table: Error: Table not found
    at DatavaultTablesService.verifyTenantOwnership (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:150:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablesService.deleteTable (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:290:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/datavault.autonumber.test.ts:90:9

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.autonumber.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 9793[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate basic autonumber without prefix [33m 1134[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate autonumber with prefix [33m 1160[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate autonumber with yearly reset format [33m 1181[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should be atomic and prevent race conditions [33m 753[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should prevent manual updates to autonumber values [33m 1529[2mms[22m[39m
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767884099231,"env":"test","workflowId":"0d692fba-2db6-4367-b749-90c61ee8d9bf","userId":"67a56e12-4bbd-4223-9d8e-7b9f8f488077","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
stderr | tests/integration/intake.workflow.test.ts > Intake Workflow Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/intake.workflow.test.ts:20:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(f6e32b1a-ec65-4acb-aaa4-7aad5f36d507) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/intake.workflow.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 4163[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow designating a workflow as Intake [33m 1073[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow linking a downstream workflow to an intake workflow [33m 1374[2mms[22m[39m
{"level":30,"time":1767884099327,"env":"test","module":"intake-service","runId":"df6d1b2c-86ca-4b72-9406-45418deac681","slug":"public-HekVZafMnxd_uvp4tbJ_A","msg":"Created intake run"}
{"level":30,"time":1767884099328,"env":"test","module":"user-credentials-repository","userId":"352d2d18-ac79-457a-93a8-9889fa3ac258","msg":"User credentials created"}
{"level":30,"time":1767884099438,"env":"test","module":"email-queue","jobId":"ef2acba0-d1f4-4e1f-bccd-f048cf4b8d2a","to":"test-1767884098933-ce7nhb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884099487,"env":"test","module":"auth-routes","userId":"352d2d18-ac79-457a-93a8-9889fa3ac258","email":"test-1767884098933-ce7nhb@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 12158[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enqueue a PDF conversion job [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create output with empty storagePath initially [33m 698[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return job status for pending job [33m 695[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return null for non-existent job [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should parse attempt count from error field [33m 695[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should convert DOCX to PDF immediately [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle conversion errors gracefully [33m 672[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should start and stop service [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not start if already running [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle stop when not running [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should process pending jobs when queue is processed [33m 996[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should process multiple jobs in batch [33m 1257[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing DOCX output gracefully [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support enqueue within transaction [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support convertImmediate within transaction [33m 750[2mms[22m[39m
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 11690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve template by key from workflowTemplates mapping [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if template key not found [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should store output in runOutputs table [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve template by templateId directly [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if templateId not found [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use docxRenderer2 by default (v2 engine) [33m 674[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use legacy engine when engine="legacy" [33m 603[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should generate PDF when toPdf=true [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should default to DOCX when toPdf=false [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should skip execution when condition evaluates to false [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should execute when condition evaluates to true [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve simple bindings [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle binding resolution errors gracefully [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should record failed output in runOutputs table [33m 704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not throw errors (should return error in result) [33m 602[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should deny access to templates from different tenant [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require either templateKey or templateId [33m 525[2mms[22m[39m
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884099761,"env":"test","module":"user-credentials-repository","userId":"8cbbd2b6-a034-46e1-b78b-d229721ac9bb","msg":"User credentials created"}
{"level":30,"time":1767884099870,"env":"test","module":"email-queue","jobId":"ed4c5c06-2ae8-4706-8c3a-50be88d5f710","to":"protected-test-K5XsoacbkH_V1GPnlMpPX@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767884099892,"env":"test","module":"auth-routes","userId":"352d2d18-ac79-457a-93a8-9889fa3ac258","email":"test-1767884098933-ce7nhb@example.com","msg":"Login blocked: email not verified"}
{"level":50,"time":1767884099893,"env":"test","module":"auth-routes","error":{"name":"EmailNotVerifiedError","code":"AUTH_006","statusCode":403,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884099921,"env":"test","module":"auth-routes","userId":"8cbbd2b6-a034-46e1-b78b-d229721ac9bb","email":"protected-test-K5XsoacbkH_V1GPnlMpPX@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

stderr | tests/integration/externalSends.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:189:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767884100398,"env":"test","workflowId":"7c9a5649-e0c0-41f5-b677-1c8c176bd617","userId":"67a56e12-4bbd-4223-9d8e-7b9f8f488077","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1767884100524,"env":"test","module":"auth-routes","userId":"8cbbd2b6-a034-46e1-b78b-d229721ac9bb","msg":"User logged in successfully"}
{"level":30,"time":1767884100576,"env":"test","module":"audit-log-service","userId":"8cbbd2b6-a034-46e1-b78b-d229721ac9bb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":50,"time":1767884101114,"env":"test","error":{},"workflowId":"6b6c8cb6-f986-4c11-8d62-f3f53437aeca","userId":"67a56e12-4bbd-4223-9d8e-7b9f8f488077","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":30,"time":1767884101156,"env":"test","module":"intake-service","runId":"5757a3f4-eed3-4a0c-be96-e7129bddf9d4","slug":"optional-E5ohH17n1xMoI2qw9wppL","userId":"8cbbd2b6-a034-46e1-b78b-d229721ac9bb","msg":"Created intake run"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 2297[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m loads table schema and rows [33m 310[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/protected.routes.test.ts:37:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(8f78a989-f2f5-4975-aa66-c346cc479f90) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/protected.routes.test.ts [2m([22m[2m33 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 39533[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow access with valid Bearer token[39m[33m 906[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access without Authorization header[39m[33m 953[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with empty Bearer token[39m[33m 900[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with malformed Authorization header[39m[33m 915[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with wrong token type[39m[33m 913[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow POST with valid Bearer token[39m[33m 921[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject POST without Bearer token [33m 1206[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST with invalid token[39m[33m 902[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow PUT with valid Bearer token[39m[33m 924[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject PUT without Bearer token[39m[33m 911[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow DELETE with valid Bearer token[39m[33m 1246[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject DELETE without Bearer token [33m 1240[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow PATCH with valid Bearer token [33m 1837[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject PATCH without Bearer token [33m 1276[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle Bearer token with extra spaces [33m 1246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle token with newlines[39m[33m 949[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle very long invalid token [33m 1279[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle empty Authorization header [33m 1310[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle Authorization header with only Bearer[39m[33m 949[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle multiple Authorization headers [33m 1270[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with SQL injection attempt[39m[33m 967[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject token with XSS attempt [33m 1248[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with missing userId[39m[33m 1012[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with non-existent userId[39m[33m 887[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow user to access another user's resources[39m[33m 893[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should inject userId into request context[39m[33m 879[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should inject tenantId into request context [33m 1252[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should inject role into request context[39m[33m 887[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not apply general rate limiting to authenticated requests[39m[33m 889[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle request with both Bearer token and cookies [33m 1764[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prioritize Bearer token over cookie when both present[39m[33m 1420[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow unauthenticated access to optional auth routes [33m 1723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enhance optional auth routes with user context when authenticated [33m 1933[2mms[22m[39m
{"level":30,"time":1767884101567,"env":"test","blockId":"27554a02-5623-4ed2-87ed-b3fef40bb7d5","virtualStepId":"ebff805f-47fe-4db8-b407-fefb65aa6956","outputVar":"userList","msg":"Created read table block with virtual step"}
{"level":50,"time":1767884101594,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767884101606,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 14605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a workflow template mapping [33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create non-primary mapping by default [33m 649[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find all templates for a workflow version [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array for version with no templates [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should order by createdAt desc (newest first) [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find mapping by workflow version and key [33m 703[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined for non-existent key [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find primary template for workflow version [33m 764[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined when no primary template exists [33m 682[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set a template as primary and unset others [33m 886[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle setting primary when none existed before [33m 893[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not delete mapping if workflow version does not match [33m 848[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return true if key exists in workflow version [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return false if key does not exist [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should exclude specified id when checking existence [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return true if key exists on different mapping [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update mapping fields [33m 698[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find mapping by id [33m 686[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined for non-existent id [33m 639[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/server/transferOwnership.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 14632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer user-owned project to org [33m 1798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1207[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org-owned project to another org they belong to [33m 1595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should detach workflow from project when transferring to different owner [33m 1343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should keep workflow in project when transferring to same owner [33m 1401[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent non-member from transferring org workflow [33m 1271[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer database ownership [33m 985[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org database [33m 1098[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1260[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should only allow transfer to self when targetOwnerType is user [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow transfer from user to self (org member transferring org asset to themselves) [33m 1147[2mms[22m[39m
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 15607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if template belongs to different project [33m 585[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should automatically unset other primaries when setting new primary [33m 1034[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list all templates for workflow version [33m 774[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return empty array for version with no templates [33m 529[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get template mapping by id and version [33m 676[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 513[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get template by key [33m 653[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if key not found [33m 530[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get primary template for workflow version [33m 799[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return null when no primary template exists [33m 625[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update mapping key [33m 714[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update isPrimary flag [33m 756[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if new key already exists [33m 759[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 507[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should unset other primaries when setting isPrimary to true [33m 1027[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should detach template from workflow version [33m 717[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 519[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should set template as primary [33m 986[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 523[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support operations within a transaction [33m 768[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should rollback on transaction error [33m 762[2mms[22m[39m
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/server/ownershipAccess.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 5171[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow member of multiple orgs to access all their org assets [33m 317[2mms[22m[39m
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/dynamic_options_workflow.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 2089[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should successfully configure a workflow with Read Table -> Dynamic Choice [33m 433[2mms[22m[39m
{"level":30,"time":1767884102016,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":40,"time":1767884102035,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1767884102084,"env":"test","msg":"Simulating External Send","destination":"Test Webhook","payload":{"message":"Hello Preview"}}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767884102512,"env":"test","module":"user-credentials-repository","userId":"bafa6100-0054-43cd-9ca3-afcb208d82a1","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767884102636,"env":"test","module":"email-queue","jobId":"2b372833-72de-4918-a7e0-e61f9514d7a4","to":"test-workflows-lx-GY24vx45--hgU6uUu-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767884102672,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1767884102687,"env":"test","module":"auth-routes","userId":"bafa6100-0054-43cd-9ca3-afcb208d82a1","email":"test-workflows-lx-GY24vx45--hgU6uUu-@example.com","msg":"User registered"}
{"level":30,"time":1767884102715,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1767884102902,"env":"test","error":{},"workflowId":"061a168d-0c6b-448d-a78f-aa85e6b80573","userId":"bafa6100-0054-43cd-9ca3-afcb208d82a1","projectId":"e9a58166-43ab-444d-b558-ea3acd429b43","msg":"Error moving workflow"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":50,"time":1767884102974,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":50,"time":1767884102975,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google authentication failed"}
{"level":40,"time":1767884103035,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1767884103035,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google token verification failed"}
{"level":50,"time":1767884103035,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google authentication failed"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884103345,"env":"test","msg":"External Send Completed","destination":"Test Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/externalSends.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 3947[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m PREVIEW MODE: Should simulate send and NOT call fetch [33m 1434[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m LIVE MODE: Should call fetch with mapped payload [33m 1261[2mms[22m[39m
{"level":50,"time":1767884103463,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"6b78cad2-3b81-47a8-888c-cd163d2777b2","userId":"67a56e12-4bbd-4223-9d8e-7b9f8f488077","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":30,"time":1767884103470,"env":"test","module":"auth","email":"existing@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 4542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create multiple records [33m 430[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767884103809,"env":"test","module":"auth-routes","userId":"c3a7be0c4acabdede5a22bcfed463259","msg":"Login requires MFA verification"}
{"level":30,"time":1767884103929,"env":"test","module":"auth","email":"refresh@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1767884104008,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"7b76bc3a-6abd-4ba0-aea7-ce65535d4e59","userId":"67a56e12-4bbd-4223-9d8e-7b9f8f488077","msg":"Error moving workflow"}
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 1596[2mms[22m[39m
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/variableSafety.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 3601[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m REPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided [33m 640[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m ScriptEngine resolves alias 'input_variable' when aliasMap is provided [33m 644[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m REPRO: BlockRunner fails to resolve alias in CreateRecordConfig [33m 638[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m BlockRunner logic resolves alias with aliasMap [33m 644[2mms[22m[39m
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/server/organizationInvites.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 19195[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create placeholder user for non-existent email [33m 1029[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create invite for existing user without creating placeholder [33m 955[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent duplicate pending invites [33m 1241[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent inviting existing members [33m 843[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require admin access to create invite [33m 539[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set expiry to 7 days from now [33m 992[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should accept invite and create membership [33m 1457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should convert placeholder user to real user on accept [33m 1528[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired invite [33m 1094[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject already accepted invite [33m 1352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should verify email matches invite [33m 983[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid token [33m 518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return pending invites for user email [33m 999[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not return expired invites [33m 1062[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not return accepted invites [33m 1425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to revoke invite [33m 1178[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent accepting revoked invite [33m 1171[2mms[22m[39m
{"level":40,"time":1767884104354,"env":"test","error":{},"msg":"libreoffice-convert not available, trying system LibreOffice"}
{"level":30,"time":1767884104376,"env":"test","module":"auth","email":"idtoken@example.com","msg":"OAuth2 login successful"}
{"level":40,"time":1767884104449,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"libreoffice --headless --convert-to pdf --outdir \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\" \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\\simple-template-1767884104331.docx\"","stdout":"","stderr":"'libreoffice' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"System LibreOffice conversion failed"}
{"level":40,"time":1767884104449,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF conversion failed"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1913[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767884104465,"env":"test","connectionId":"6e06eb99-2af2-429d-9f9d-b4db03350bdf","projectId":"5180c780-09ce-4dc5-a597-138da8eb72cb","name":"Test OAuth2 Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884104810,"env":"test","module":"auth","email":"minimal@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1767884104919,"env":"test","module":"auth","err":{"type":"Error","message":"Token verification failed","stack":"Error: Token verification failed\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:425:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884104944,"env":"test","module":"user-credentials-repository","userId":"b0aa375a-56e3-46ad-a561-58abafe2c601","msg":"User credentials created"}
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1767884104971,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1767884104971,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884105021,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token payload","stack":"Error: Invalid token payload\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:85:25)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
{"level":30,"time":1767884105046,"env":"test","module":"email-queue","jobId":"95f33cd1-561f-4001-97d9-e75c7e09e3a1","to":"test-workflows-wFX6eToi4KjB4vt7B-YiT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 3747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should successfully authenticate with valid Google ID token [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update existing user on subsequent logins [33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create refresh token record in database [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support both "token" and "idToken" fields [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing profile information gracefully [33m 380[2mms[22m[39m
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1767884105102,"env":"test","module":"auth-routes","userId":"b0aa375a-56e3-46ad-a561-58abafe2c601","email":"test-workflows-wFX6eToi4KjB4vt7B-YiT@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884105624,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767884105655,"env":"test","connectionId":"78294911-2aa8-43ca-add6-7b2cb33f2346","projectId":"5180c780-09ce-4dc5-a597-138da8eb72cb","name":"Status Test Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884105730,"env":"test","module":"auth-routes","userId":"b0aa375a-56e3-46ad-a561-58abafe2c601","msg":"User logged in successfully"}
{"level":30,"time":1767884105787,"env":"test","module":"audit-log-service","userId":"b0aa375a-56e3-46ad-a561-58abafe2c601","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx > TableGridView - Drag & Drop > renders DndContext wrapper
Warning: validateDOMNesting(...): <th> cannot appear as a child of <div>.
    at th
    at SortableColumnHeader (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/SortableColumnHeader.tsx:12:33)
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
Warning: validateDOMNesting(...): <div> cannot appear as a child of <tr>.
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

{"level":50,"time":1767884106160,"env":"test","error":{},"workflowId":"03bb5253-ac2e-4c0f-99ad-948eebbb69ba","userId":"67a56e12-4bbd-4223-9d8e-7b9f8f488077","projectId":"f39c13ee-34e5-4748-87ab-7c875075ddc1","msg":"Error moving workflow"}
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:29:5 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(67a56e12-4bbd-4223-9d8e-7b9f8f488077) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 16120[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 528[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 545[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 873[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 682[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 848[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 915[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 1359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 1171[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 662[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 1296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 545[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 2152[2mms[22m[39m
{"level":50,"time":1767884106231,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884106241,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767884106259,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts[2m > [22m[2mExpression Validation API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884106248,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884106249,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884106253,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884106258,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884106258,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884106259,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884106259,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 3300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should initiate OAuth2 3-legged flow and generate authorization URL [33m 362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track OAuth2 connection status [33m 400[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/RunExecutionCoordinator.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1628[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 2541[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m renders boolean value as Yes/No [33m 353[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1659[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[33m 2949[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should add a comment [33m 352[2mms[22m[39m
{"level":50,"time":1767884106771,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767884106779,"env":"test","module":"user-credentials-repository","userId":"763e22e4-d606-4e74-95e9-b8f60888b0f8","msg":"User credentials created"}
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767884106888,"env":"test","module":"email-queue","jobId":"e0fd202a-244e-4744-8d1f-ae646a55ca85","to":"test-LY452iG7aur_wmW-Ebr_y@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 2427[2mms[22m[39m
{"level":30,"time":1767884106948,"env":"test","module":"auth-routes","userId":"763e22e4-d606-4e74-95e9-b8f60888b0f8","email":"test-LY452iG7aur_wmW-Ebr_y@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 2737[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m displays columns in order based on orderIndex [33m 560[2mms[22m[39m
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 1714[2mms[22m[39m
{"level":30,"time":1767884107033,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":50,"time":1767884107307,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts [2m([22m[2m32 tests[22m[2m)[22m[33m 1759[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 1946[2mms[22m[39m
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884107937,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767884107948,"env":"test","module":"account-lockout","userId":"e19588619816b6b9ef643657535a73fb","email":"test-1767884104670-zieeh8@example.com","lockedUntil":"2026-01-08T15:10:07.894Z","msg":"Account locked due to too many failed attempts"}
{"level":50,"time":1767884107949,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1767884108062,"env":"test","module":"auth-routes","userId":"e19588619816b6b9ef643657535a73fb","email":"test-1767884104670-zieeh8@example.com","msg":"Login blocked: account locked"}
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884108063,"env":"test","module":"auth-routes","error":{"name":"AccountLockedError","code":"AUTH_005","statusCode":423,"isOperational":true,"lockedUntil":"2026-01-08T15:10:07.894Z","remainingMinutes":15},"msg":"Login failed"}
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884108161,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767884108338,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/integration/api.expression-validation.test.ts > Expression Validation API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.expression-validation.test.ts:75:5 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(763e22e4-d606-4e74-95e9-b8f60888b0f8) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2954[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx [2m([22m[2m27 tests[22m[2m)[22m[33m 1895[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 1815[2mms[22m[39m
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 1737[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1731[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts [2m([22m[2m66 tests[22m[2m)[22m[33m 1758[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts [2m([22m[2m39 tests[22m[2m)[22m[33m 1834[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767884109344,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767884109346,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating skipIf condition"}
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 1763[2mms[22m[39m
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 1711[2mms[22m[39m
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 1836[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/PageValidator.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1715[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884109857,"env":"test","module":"auth-routes","userId":"0e326cc6a6edf34f736c04f07788a5eb","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767884109913,"env":"test","module":"audit-log-service","userId":"0e326cc6a6edf34f736c04f07788a5eb","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1627[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/builder.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 1671[2mms[22m[39m
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1767[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflow/QueryBlock.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1781[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowOptimizationService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 1684[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts [2m([22m[2m60 tests[22m[2m)[22m[33m 1844[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1767884111480,"env":"test","module":"rbac-middleware","path":"/api/workflows","permission":"workflow:create","msg":"Unauthenticated user attempted to access protected resource"}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1767884111484,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permission":"workflow:create","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1767884111485,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"permission":"workflow:view","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1767884111486,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permissions":["workflow:create","workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (none of required permissions)"}
{"level":40,"time":1767884111488,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","permissions":["workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (missing some required permissions)"}
{"level":40,"time":1767884111489,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1767884111490,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"requiredRoles":["owner"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1767884111491,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","requiredRoles":["owner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767884111492,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"runner","requiredRoles":["owner","builder"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767884111494,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder","runner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767884111498,"env":"test","module":"rbac-middleware","path":"/api/test","permission":"workflow:view","msg":"Unauthenticated user attempted to access protected resource"}
{"level":40,"time":1767884111498,"env":"test","module":"rbac-middleware","userId":"user-123","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":40,"time":1767884111499,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"invalid-role","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts [2m([22m[2m44 tests[22m[2m)[22m[33m 1704[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/unit/shared/conditionEvaluator.test.ts > conditionEvaluator > Comparison operators > Unknown operator > should default to true and log warning
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts [2m([22m[2m70 tests[22m[2m)[22m[33m 1953[2mms[22m[39m
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767884111766,"env":"test","module":"auth-routes","userId":"357f5807721950e3a26979e80b1d9272","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884111819,"env":"test","module":"audit-log-service","userId":"357f5807721950e3a26979e80b1d9272","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1687[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1712[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 1695[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/Performance.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1754[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 1655[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767884112684,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884112701,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts[2m > [22m[2mData Sources API - Native Catalog
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884112691,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884112691,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884112695,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767884112700,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767884112700,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767884112700,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767884112700,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 1700[2mms[22m[39m
[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 1624[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 1806[2mms[22m[39m
{"level":30,"time":1767884113233,"env":"test","module":"user-credentials-repository","userId":"2d95507c-012c-411b-866b-755ffa9b1dc4","msg":"User credentials created"}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884113338,"env":"test","module":"email-queue","jobId":"f4c2ef5c-f949-4fe0-a304-7019fe8e906a","to":"test-6XJG2ZwLMrqwf6-qIDR-l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767884113395,"env":"test","module":"auth-routes","userId":"2d95507c-012c-411b-866b-755ffa9b1dc4","email":"test-6XJG2ZwLMrqwf6-qIDR-l@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1732[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 1777[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/MfaService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts [2m([22m[2m41 tests[22m[2m)[22m[33m 1760[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 1778[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic-simple.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1697[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767884114284,"env":"test","status":401,"statusText":"Unauthorized","error":"Invalid client credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
 [32mÎ“Â£Ã´[39m tests/integration/api.dataSources.native.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 3024[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should list databases and databases' tables in the catalog [33m 378[2mms[22m[39m
{"level":50,"time":1767884114284,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114286,"env":"test","data":{"token_type":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1767884114286,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114287,"env":"test","data":{"access_token":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1767884114287,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114289,"env":"test","error":"Network error: ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":50,"time":1767884114403,"env":"test","error":"Invalid credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767884114403,"env":"test","error":"ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114405,"env":"test","status":400,"statusText":"Bad Request","error":"Invalid grant_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767884114405,"env":"test","error":"OAuth2 token request failed: 400 Bad Request","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114405,"env":"test","status":401,"statusText":"Unauthorized","error":"Client authentication failed","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767884114405,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114406,"env":"test","status":403,"statusText":"Forbidden","error":"Access denied","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767884114406,"env":"test","error":"OAuth2 token request failed: 403 Forbidden","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114406,"env":"test","status":500,"statusText":"Internal Server Error","error":"Server error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767884114406,"env":"test","error":"OAuth2 token request failed: 500 Internal Server Error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114407,"env":"test","error":"Unexpected token in JSON","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767884114407,"env":"test","error":"Request timeout","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1730[2mms[22m[39m
stderr | tests/unit/shared/workflowLogic.test.ts > workflowLogic > evaluateRules > Operators > Unknown operator > should return false and log warning for unknown operator
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts [2m([22m[2m65 tests[22m[2m)[22m[33m 1704[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 1760[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767884114735,"env":"test","module":"auth-routes","userId":"672a90e8ec1cec5bc57df5f885ec8017","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1767884114791,"env":"test","module":"audit-log-service","userId":"672a90e8ec1cec5bc57df5f885ec8017","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":40,"time":1767884115068,"env":"test","module":"auth-service","userId":"672a90e8ec1cec5bc57df5f885ec8017","tokenHash":"9ba3576899ea4bec5b4902a2c80b9a67c55bc123bed822d020f5c8a5595fbb06","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 1476[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should try multiple codes if first doesn't match [33m 371[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/analytics_preservation.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1333[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should preserve lifetime user count when a user is deleted [33m 486[2mms[22m[39m
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/WorkflowService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts[2m > [22m[2mDatavaultColumnsService[2m > [22m[2mgetColumns[2m > [22m[2mshould throw 404 if table not found
[22m[39m[DEBUG] Table not found: 660e8400-e29b-41d4-a716-446655440001

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1030[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1109[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1131[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 963[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767884116434,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767884116424,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 901[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return workflow if user is the creator [33m 853[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767884116591,"env":"test","module":"email-queue","jobId":"2a8ebb28-b32e-4467-a4d7-84fa76c6d66f","to":"test-1767884115926-rvauts@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884116591,"env":"test","module":"auth-service","email":"test-1767884115926-rvauts@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 987[2mms[22m[39m
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts [2m([22m[2m33 tests[22m[2m)[22m[33m 964[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 904[2mms[22m[39m
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 826[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip question when condition is false
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q1 executed. Key: has_code, Value: true. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q2 executed. Key: code, Value: ABC123. Context keys: 5

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip compute node when condition is false
[DEBUG Question] Node q1 executed. Key: amount, Value: 0. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute compute node when condition is true
[DEBUG Question] Node q1 executed. Key: amount, Value: 100. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q3 executed. Key: amount, Value: 1000. Context keys: 5

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should return trace when debug is enabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should not return trace when debug is disabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1017[2mms[22m[39m
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 862[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 895[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 854[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 821[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767884118934,"env":"test","module":"email-queue","jobId":"187e2ee1-ebf1-4b9f-b07a-33eca695ed4c","to":"test-1767884118303-uxal7d@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884118934,"env":"test","module":"auth-service","email":"test-1767884118303-uxal7d@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 839[2mms[22m[39m
stderr | tests/unit/external/ExternalSendRunner.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

{"level":30,"time":1767884119002,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767884119019,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
 [32mÎ“Â£Ã´[39m tests/unit/external/ExternalSendRunner.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/writes/WriteRunner.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:119:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1767884119215,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767884119225,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767884119226,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1767884119227,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767884119229,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1767884119230,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
 [32mÎ“Â£Ã´[39m tests/unit/writes/WriteRunner.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767884119350,"env":"test","module":"user-credentials-repository","userId":"fb3a67a38df91e368c7a5454c30edfc2","msg":"User password updated"}
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 951[2mms[22m[39m
{"level":30,"time":1767884119507,"env":"test","module":"audit-log-service","userId":"fb3a67a38df91e368c7a5454c30edfc2","eventType":"password_reset","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflow/PreviewExecution.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 833[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/PortalAuthService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 873[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":40,"time":1767884119729,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767884119733,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1767884119736,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1767884119741,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1767884119746,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 870[2mms[22m[39m
[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts [2m([22m[2m42 tests[22m[2m)[22m[32m 118[2mms[22m[39m
[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

stderr | tests/unit/services/EmailTemplateMetadataService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 28[2mms[22m[39m
{"level":30,"time":1767884120058,"env":"test","module":"auth-routes","userId":"fb3a67a38df91e368c7a5454c30edfc2","msg":"User logged in successfully"}
{"level":30,"time":1767884120114,"env":"test","module":"audit-log-service","userId":"fb3a67a38df91e368c7a5454c30edfc2","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/debug_import.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 823[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 855[2mms[22m[39m
stderr | tests/unit/services/AccountLockoutService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 31[2mms[22m[39m
[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":50,"time":1767884120668,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

stderr | tests/unit/services/BrandingService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 36[2mms[22m[39m
stderr | tests/unit/services/Guardrail.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stderr | tests/unit/repositories/DatavaultRowsRepository.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/Guardrail.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 50[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 44[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1767884121233,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
stderr | tests/unit/services/DatavaultRowsService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

stderr | tests/unit/services/DatavaultReferenceColumns.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts[2m > [22m[2mPersonalization API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767884121241,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767884121242,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767884121251,"env":"test","module":"documents-routes","msg":"Document routes registered"}
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 26[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/AuditLogService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 20[2mms[22m[39m
[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/BlockRunner.validate.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:119:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 18[2mms[22m[39m
stderr | tests/unit/engine/FinalBlockSnapshot.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/FinalBlockSnapshot.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 19[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.ai.personalization.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1282[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 822[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 796[2mms[22m[39m
{"level":30,"time":1767884122966,"env":"test","module":"email-queue","jobId":"3e26fbbc-bbf3-4c70-8416-32fff5913f36","to":"test-1767884122384-rmrl6u@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767884122966,"env":"test","module":"auth-service","email":"test-1767884122384-rmrl6u@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767884124708,"env":"test","module":"auth-routes","userId":"c575553f63212dbfa25e574440401a98","msg":"User logged in successfully"}
{"level":30,"time":1767884124762,"env":"test","module":"audit-log-service","userId":"c575553f63212dbfa25e574440401a98","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767884125698,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767884126486,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767884128428,"env":"test","module":"auth-routes","userId":"28f41313da4004da8547d4625edb808f","msg":"Login requires MFA verification"}
{"level":30,"time":1767884128538,"env":"test","module":"mfa-service","userId":"28f41313da4004da8547d4625edb808f","msg":"TOTP verification successful"}
{"level":30,"time":1767884128594,"env":"test","module":"auth-routes","userId":"28f41313da4004da8547d4625edb808f","msg":"MFA login successful"}
{"level":40,"time":1767884130175,"env":"test","module":"mfa-service","userId":"3c2c510c51edbbdf2c1d4c8a53b6c7ff","msg":"TOTP verification failed"}
{"level":40,"time":1767884130176,"env":"test","module":"auth-routes","userId":"3c2c510c51edbbdf2c1d4c8a53b6c7ff","msg":"MFA verification failed during login"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 43303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should register a new user successfully [33m 1498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for invalid email format [33m 845[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for weak password [33m 851[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 409 for duplicate email [33m 1423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set httpOnly refresh token cookie [33m 1372[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should login with valid credentials [33m 1730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid password [33m 1723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for non-existent user [33m 1012[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 403 for unverified email [33m 1782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should record failed login attempt [33m 1772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return requiresMfa=true for MFA-enabled users [33m 2172[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should lock account after 5 failed attempts [33m 4241[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should logout and clear refresh token cookie [33m 1909[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should refresh access token with valid refresh token [33m 2074[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for missing refresh token [33m 845[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should rotate refresh token after use [33m 2202[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should send password reset email for existing user [33m 1489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not reveal if email exists (security) [33m 883[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reset password with valid token [33m 3204[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for invalid token [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for weak new password [33m 1507[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return current user for valid token [33m 1807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for missing token [33m 813[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid token [33m 781[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should complete MFA login with valid TOTP code [33m 2111[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject invalid MFA code [33m 1579[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 10 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.projects.test.ts > Projects API Integration Tests
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.projects.test.ts:61:8
     59|         lastName: "User",
     60|       })
     61|       .expect(201);
       |        ^
     62| 
     63|     authToken = registerResponse.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/239]Î“Ã„Â»

 FAIL  tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.runs.docx.test.ts:110:8
    108|       .post('/api/auth/register')
    109|       .send({ email, password: 'TestPassword123' })
    110|       .expect(201);
       |        ^
    111| 
    112|     authToken = registerResponse.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/239]Î“Ã„Â»

 FAIL  tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests
TypeError: actual.getSession is not a function
 Î“Â¥Â» setupAuth tests/integration/api.runs.graph.test.ts:35:24
     33|       ...actual,
     34|       setupAuth: (app: Express) => {
     35|         app.use(actual.getSession());
       |                        ^
     36| 
     37|         // Debug middleware to log cookies and session AND restore reqÎ“Ã‡Âª
 Î“Â¥Â» Module.registerRoutes server/routes.ts:19:9
 Î“Â¥Â» tests/integration/api.runs.graph.test.ts:67:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/239]Î“Ã„Â»

 FAIL  tests/integration/api.snapshots.test.ts > Stage 13: Workflow Snapshots & Versioning
TypeError: actual.getSession is not a function
 Î“Â¥Â» setupAuth tests/integration/api.snapshots.test.ts:28:32
     26|             ...actual,
     27|             setupAuth: (app: Express) => {
     28|                 app.use(actual.getSession());
       |                                ^
     29| 
     30|                 // Debug middleware to log cookies and session AND resÎ“Ã‡Âª
 Î“Â¥Â» Module.registerRoutes server/routes.ts:19:9
 Î“Â¥Â» tests/integration/api.snapshots.test.ts:62:24

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/239]Î“Ã„Â»

 FAIL  tests/integration/js_helpers.test.ts > Detailed Verification: JS Helper Availability
TypeError: actual.getSession is not a function
 Î“Â¥Â» setupAuth tests/integration/js_helpers.test.ts:18:28
     16|         ...actual,
     17|         setupAuth: (app: Express) => {
     18|             app.use(actual.getSession());
       |                            ^
     19|             app.use((req, res, next) => {
     20|                 const r = req as any;
 Î“Â¥Â» Module.registerRoutes server/routes.ts:19:9
 Î“Â¥Â» tests/integration/js_helpers.test.ts:54:15

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/239]Î“Ã„Â»

 FAIL  tests/integration/ai/workflowEdit.test.ts > POST /api/workflows/:workflowId/ai/edit - Integration Test
error: invalid input syntax for type uuid: "test-tenant"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/ai/workflowEdit.test.ts:64:20
     62| 
     63|     // Create test user
     64|     const [user] = await db.insert(users).values({
       |                    ^
     65|       email: 'test@example.com',
     66|       fullName: 'Test User',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management
error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:72:7
     70|   afterAll(async () => {
     71|     if (testTenantId) {
     72|       await db.delete(tenants).where(eq(tenants.id, testTenantId));
       |       ^
     73|     }
     74|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/239]Î“Ã„Â»

 FAIL  tests/integration/auth/portal.authentication.test.ts [ tests/integration/auth/portal.authentication.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/auth/portal.authentication.test.ts
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/239]Î“Ã„Â»

 FAIL  tests/integration/workflows/runtime-pipelines.test.ts > Runtime Pipelines Integration Tests
error: insert or update on table "projects" violates foreign key constraint "projects_creator_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/workflows/runtime-pipelines.test.ts:69:23
     67| 
     68|     // Create test project
     69|     const [project] = await db
       |                       ^
     70|       .insert(projects)
     71|       .values({

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/239]Î“Ã„Â»

 FAIL  tests/integration/workflows/runtime-pipelines.test.ts > Runtime Pipelines Integration Tests
error: syntax error at end of input
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/workflows/runtime-pipelines.test.ts:212:5
    210|     await db.delete(datavaultValues).where(sql`1=1`);
    211|     await db.delete(datavaultRows).where(sql`1=1`);
    212|     await db.delete(datavaultColumns).where(sql`table_id = ${testTableÎ“Ã‡Âª
       |     ^
    213|     await db.delete(datavaultTables).where(sql`id = ${testTableId}`);
    214|     await db.delete(workflowRuns).where(sql`id = ${testRunId}`);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/239]Î“Ã„Â»

 FAIL  tests/unit/services/WorkflowPatchService.test.ts [ tests/unit/services/WorkflowPatchService.test.ts ]
TypeError: () => ({
    createTable: __vite_ssr_import_0__.vi.fn(),
    requirePermission: __vite_ssr_import_0__.vi.fn()
  }) is not a constructor
 Î“Â¥Â» new WorkflowPatchService server/services/WorkflowPatchService.ts:27:36
     25| export class WorkflowPatchService {
     26|   private tempIdMap: Map<string, string> = new Map();
     27|   private datavaultTablesService = new DatavaultTablesService();
       |                                    ^
     28|   private datavaultColumnsService = new DatavaultColumnsService();
     29| 
 Î“Â¥Â» server/services/WorkflowPatchService.ts:773:37
 Î“Â¥Â» tests/unit/services/WorkflowPatchService.test.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/239]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 228 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter rows by equals condition
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:85:30
     83|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
     84| 
     85|       expect(result.success).toBe(true);
       |                              ^
     86|       expect(result.data?.filtered_users.count).toBe(3);
     87|       expect(result.data?.filtered_users.rows.every((r: any) => r.cityÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with greater_than operator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:116:30
    114|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    115| 
    116|       expect(result.success).toBe(true);
       |                              ^
    117|       expect(result.data?.senior_users.count).toBe(2);
    118|       expect(result.data?.senior_users.rows.every((r: any) => r.age > Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with AND combinator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:148:30
    146|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    147| 
    148|       expect(result.success).toBe(true);
       |                              ^
    149|       expect(result.data?.active_nyc.count).toBe(2);
    150|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with OR combinator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:179:30
    177|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    178| 
    179|       expect(result.success).toBe(true);
       |                              ^
    180|       expect(result.data?.young_or_sf.count).toBe(2); // Bob (25) and Î“Ã‡Âª
    181|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by single key ascending
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:208:30
    206|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    207| 
    208|       expect(result.success).toBe(true);
       |                              ^
    209|       const ages = result.data?.sorted_users.rows.map((r: any) => r.agÎ“Ã‡Âª
    210|       expect(ages).toEqual([25, 28, 30, 32, 35]);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by single key descending
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:236:30
    234|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    235| 
    236|       expect(result.success).toBe(true);
       |                              ^
    237|       const names = result.data?.sorted_users.rows.map((r: any) => r.nÎ“Ã‡Âª
    238|       expect(names).toEqual(['Eve', 'Diana', 'Charlie', 'Bob', 'Alice'Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by multiple keys
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:265:30
    263|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    264| 
    265|       expect(result.success).toBe(true);
       |                              ^
    266|       const rows = result.data?.sorted_users.rows;
    267|       expect(rows[0].city).toBe('LA');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply limit
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:295:30
    293|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    294| 
    295|       expect(result.success).toBe(true);
       |                              ^
    296|       expect(result.data?.limited_users.count).toBe(3);
    297|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply offset
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:320:30
    318|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    319| 
    320|       expect(result.success).toBe(true);
       |                              ^
    321|       expect(result.data?.offset_users.count).toBe(3);
    322|       expect(result.data?.offset_users.rows[0].name).toBe('Charlie');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[20/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply offset and limit together
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:347:30
    345|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    346| 
    347|       expect(result.success).toBe(true);
       |                              ^
    348|       expect(result.data?.paged_users.count).toBe(2);
    349|       expect(result.data?.paged_users.rows[0].name).toBe('Bob');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[21/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Select Operations > should select specific columns
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:376:30
    374|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    375| 
    376|       expect(result.success).toBe(true);
       |                              ^
    377|       const row = result.data?.name_age_only.rows[0];
    378|       expect(row).toHaveProperty('name');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[22/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Dedupe Operations > should deduplicate by field
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:414:30
    412|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    413| 
    414|       expect(result.success).toBe(true);
       |                              ^
    415|       // NYC, LA, SF = 3 unique cities
    416|       expect(result.data?.unique_cities.count).toBe(3);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[23/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Derived Outputs > should output count variable
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:447:30
    445|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    446| 
    447|       expect(result.success).toBe(true);
       |                              ^
    448|       expect(result.data?.user_count).toBe(5);
    449|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[24/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Derived Outputs > should output first row variable
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:475:30
    473|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    474| 
    475|       expect(result.success).toBe(true);
       |                              ^
    476|       expect(result.data?.youngest_user).toBeDefined();
    477|       expect(result.data?.youngest_user.name).toBe('Bob');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[25/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Comprehensive Pipeline > should apply all operations in sequence
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:519:30
    517|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    518| 
    519|       expect(result.success).toBe(true);
       |                              ^
    520|       expect(result.data?.processed_users.count).toBe(2); // Limit of 2
    521|       expect(result.data?.active_count).toBe(2);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[26/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Edge Cases > should handle empty input list
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:567:30
    565|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    566| 
    567|       expect(result.success).toBe(true);
       |                              ^
    568|       expect(result.data?.filtered_users.count).toBe(0);
    569|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[27/239]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Edge Cases > should handle plain arrays
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:621:30
    619|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    620| 
    621|       expect(result.success).toBe(true);
       |                              ^
    622|       expect(result.data?.sorted_array.rows[0].score).toBe(90);
    623|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[28/239]Î“Ã„Â»

 FAIL  tests/integration/analytics_service.test.ts > Analytics Service Integration > should generate events and metrics on run completion
Error: Workflow is not active
 Î“Â¥Â» RunAuthResolver.verifyCreateAccess server/services/runs/RunAuthResolver.ts:110:53
    108| 
    109|             if (!workflow) throw new Error('Workflow not found');
    110|             if (workflow.status !== 'active') throw new Error('WorkfloÎ“Ã‡Âª
       |                                                     ^
    111|             if (!workflow.isPublic) throw new Error('Workflow is not pÎ“Ã‡Âª
    112| 
 Î“Â¥Â» RunService.createRun server/services/RunService.ts:202:22
 Î“Â¥Â» tests/integration/analytics_service.test.ts:42:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[29/239]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should analyze a DOCX file and return variables
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:143:37
    141|                 } catch (e) { console.log("FAIL_BODY: " + response.texÎ“Ã‡Âª
    142|             }
    143|             expect(response.status).toBe(200);
       |                                     ^
    144| 
    145|             expect(response.body.data).toHaveProperty("variables");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[30/239]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should fail if no file is provided
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:168:18
    166|             await request(baseURL)
    167|                 .post("/api/ai/doc/analyze")
    168|                 .expect(400);
       |                  ^
    169|         });
    170|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[31/239]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Templates API > POST /api/projects/:ctx.projectId/templates > should reject non-docx files
Error: expected 500 "Internal Server Error", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:119:12
    117|           .field("name", "Test Template")
    118|           .attach("file", mockPdf, "test.pdf")
    119|           .expect(500); // Multer rejects before handler
       |            ^
    120|       });
    121| 
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[32/239]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Runs API > POST /api/workflows/:id/run > should reject without required permission
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:289:12
    287|           .post("/api/auth/register")
    288|           .send({ email: viewerEmail, password: "TestPassword123" })
    289|           .expect(201);
       |            ^
    290| 
    291|         await db.update(schema.users)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[33/239]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should lock account after 5 failed attempts, then unlock after waiting
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:110:36
    108|         });
    109| 
    110|       expect(lockedAttempt.status).toBe(423);
       |                                    ^
    111|       expect(lockedAttempt.body.message || lockedAttempt.body.error).tÎ“Ã‡Âª
    112| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[34/239]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should record all login attempts
AssertionError: expected +0 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 0

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:145:31
    143|       });
    144| 
    145|       expect(attempts.length).toBe(3);
       |                               ^
    146|       expect(attempts.filter(a => !a.successful).length).toBe(2);
    147|       expect(attempts.filter(a => a.successful).length).toBe(1);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[35/239]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should complete MFA setup and login with TOTP
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:203:37
    201|         .send({ email, password });
    202| 
    203|       expect(login2Response.status).toBe(200);
       |                                     ^
    204|       expect(login2Response.body.requiresMfa).toBe(true);
    205|       expect(login2Response.body.userId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[36/239]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should login with backup code when TOTP unavailable
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:248:52
    246|       });
    247| 
    248|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    249| 
    250|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[37/239]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Password Reset Flow > should complete full password reset flow
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:332:36
    330|         });
    331| 
    332|       expect(resetResponse.status).toBe(200);
       |                                    ^
    333| 
    334|       // Step 4: Verify old password no longer works

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[38/239]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should rotate refresh token on each use
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:405:40
    403| 
    404|       let cookies = loginResponse.headers['set-cookie'] as unknown as Î“Ã‡Âª
    405|       let refreshTokenCookie = cookies.find(c => c.startsWith('refreshÎ“Ã‡Âª
       |                                        ^
    406| 
    407|       expect(refreshTokenCookie).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[39/239]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should list all active sessions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:492:39
    490|         .set("Authorization", `Bearer ${token}`);
    491| 
    492|       expect(sessionsResponse.status).toBe(200);
       |                                       ^
    493|       expect(sessionsResponse.body.sessions).toBeDefined();
    494|       expect(sessionsResponse.body.sessions.length).toBeGreaterThanOrEÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[40/239]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:517:40
    515| 
    516|       const sessions = sessionsResponse.body.sessions;
    517|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    518| 
    519|       // Revoke first session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[41/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow owner to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:154:26
    152|         .set('Cookie', ownerCookie);
    153| 
    154|       expect(res.status).toBe(200);
       |                          ^
    155|       expect(res.body.id).toBe(tableId);
    156|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[42/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow writer to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:163:26
    161|         .set('Cookie', writerCookie);
    162| 
    163|       expect(res.status).toBe(200);
       |                          ^
    164|       expect(res.body.id).toBe(tableId);
    165|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[43/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow reader to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:172:26
    170|         .set('Cookie', readerCookie);
    171| 
    172|       expect(res.status).toBe(200);
       |                          ^
    173|       expect(res.body.id).toBe(tableId);
    174|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[44/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should deny non-member from reading table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:181:26
    179|         .set('Cookie', nonMemberCookie);
    180| 
    181|       expect(res.status).toBe(403);
       |                          ^
    182|       expect(res.body.message).toContain('Access denied');
    183|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[45/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should allow owner to update table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:193:26
    191|         .send({ description: 'Updated by owner' });
    192| 
    193|       expect(res.status).toBe(200);
       |                          ^
    194|     });
    195| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[46/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should deny writer from updating table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:202:26
    200|         .send({ description: 'Attempt by writer' });
    201| 
    202|       expect(res.status).toBe(403);
       |                          ^
    203|       expect(res.body.message).toContain('Access denied');
    204|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[47/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should deny reader from updating table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:212:26
    210|         .send({ description: 'Attempt by reader' });
    211| 
    212|       expect(res.status).toBe(403);
       |                          ^
    213|       expect(res.body.message).toContain('Access denied');
    214|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[48/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny writer from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:223:26
    221|         .set('Cookie', writerCookie);
    222| 
    223|       expect(res.status).toBe(403);
       |                          ^
    224|       expect(res.body.message).toContain('Access denied');
    225|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[49/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny reader from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:232:26
    230|         .set('Cookie', readerCookie);
    231| 
    232|       expect(res.status).toBe(403);
       |                          ^
    233|       expect(res.body.message).toContain('Access denied');
    234|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[50/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny non-member from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:241:26
    239|         .set('Cookie', nonMemberCookie);
    240| 
    241|       expect(res.status).toBe(403);
       |                          ^
    242|       expect(res.body.message).toContain('Access denied');
    243|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[51/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should allow owner to view permissions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:252:26
    250|         .set('Cookie', ownerCookie);
    251| 
    252|       expect(res.status).toBe(200);
       |                          ^
    253|       expect(Array.isArray(res.body)).toBe(true);
    254|       expect(res.body.length).toBe(2); // writer and reader

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[52/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should deny writer from viewing permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:262:26
    260|         .set('Cookie', writerCookie);
    261| 
    262|       expect(res.status).toBe(403);
       |                          ^
    263|       expect(res.body.message).toContain('Access denied');
    264|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[53/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should deny reader from viewing permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:271:26
    269|         .set('Cookie', readerCookie);
    270| 
    271|       expect(res.status).toBe(403);
       |                          ^
    272|       expect(res.body.message).toContain('Access denied');
    273|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[54/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should allow owner to grant permissions
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:283:26
    281|         .send({ userId: nonMemberId, role: 'read' });
    282| 
    283|       expect(res.status).toBe(201);
       |                          ^
    284|       expect(res.body.userId).toBe(nonMemberId);
    285|       expect(res.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[55/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should allow owner to update existing permission (upsert)
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:301:26
    299|         .send({ userId: readerId, role: 'write' }); // Upgrade reader Î“Ã‡Âª
    300| 
    301|       expect(res.status).toBe(201);
       |                          ^
    302|       expect(res.body.role).toBe('write');
    303| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[56/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should deny writer from granting permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:317:26
    315|         .send({ userId: nonMemberId, role: 'read' });
    316| 
    317|       expect(res.status).toBe(403);
       |                          ^
    318|       expect(res.body.message).toContain('Access denied');
    319|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[57/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should prevent modifying table owner permissions
AssertionError: expected 401 to be 500 // Object.is equality

- Expected
+ Received

- 500
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:327:26
    325|         .send({ userId: ownerId, role: 'read' });
    326| 
    327|       expect(res.status).toBe(500);
       |                          ^
    328|       expect(res.body.message).toContain('Cannot modify permissions foÎ“Ã‡Âª
    329|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[58/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/permissions/:permissionId > should allow owner to revoke permissions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:347:26
    345|         .set('Cookie', ownerCookie);
    346| 
    347|       expect(res.status).toBe(200);
       |                          ^
    348|       expect(res.body.success).toBe(true);
    349| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[59/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/permissions/:permissionId > should deny writer from revoking permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:370:26
    368|         .set('Cookie', writerCookie);
    369| 
    370|       expect(res.status).toBe(403);
       |                          ^
    371|       expect(res.body.message).toContain('Access denied');
    372|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[60/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce owner includes write and read
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:381:30
    379|         .get(`/api/datavault/tables/${tableId}`)
    380|         .set('Cookie', ownerCookie);
    381|       expect(readRes.status).toBe(200);
       |                              ^
    382| 
    383|       // Owner can update table

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[61/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce write includes read but not owner
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:396:30
    394|         .get(`/api/datavault/tables/${tableId}`)
    395|         .set('Cookie', writerCookie);
    396|       expect(readRes.status).toBe(200);
       |                              ^
    397| 
    398|       // Writer cannot update table schema

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[62/239]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce read is read-only
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:411:30
    409|         .get(`/api/datavault/tables/${tableId}`)
    410|         .set('Cookie', readerCookie);
    411|       expect(readRes.status).toBe(200);
       |                              ^
    412| 
    413|       // Reader cannot update

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[63/239]Î“Ã„Â»

 FAIL  tests/integration/metrics.test.ts > Metrics Integration > should expose /metrics endpoint
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/metrics.test.ts:33:33
     31|         const response = await request(app).get('/metrics');
     32| 
     33|         expect(response.status).toBe(200);
       |                                 ^
     34|         expect(response.headers['content-type']).toContain('text/plainÎ“Ã‡Âª
     35|         // Prometheus metrics usually contain comments like # HELP or Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[64/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should complete full MFA setup flow
TypeError: Cannot read properties of undefined (reading 'enabled')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:87:29
     85|       });
     86| 
     87|       expect(updatedSecret!.enabled).toBe(true);
       |                             ^
     88|       expect(updatedSecret!.enabledAt).toBeDefined();
     89| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[65/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should generate unique backup codes
AssertionError: expected +0 to be 10 // Object.is equality

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:156:32
    154|       // All codes should be unique
    155|       const uniqueCodes = new Set(backupCodes);
    156|       expect(uniqueCodes.size).toBe(10);
       |                                ^
    157|     });
    158| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[66/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should complete MFA login with valid TOTP
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:209:46
    207|         .send({ email, password });
    208| 
    209|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    210| 
    211|       // Step 2: Verify MFA

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[67/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should accept TOTP codes within 60-second window
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:264:32
    262|         .send({ userId, token: totpCode });
    263| 
    264|       expect(response1.status).toBe(200);
       |                                ^
    265| 
    266|       // Login again for second test

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[68/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should login with valid backup code
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:319:47
    317|         .send({ email, password });
    318| 
    319|       expect(login2Response.body.requiresMfa).toBe(true);
       |                                               ^
    320| 
    321|       // Use backup code

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[69/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should prevent backup code reuse
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:375:52
    373|       });
    374| 
    375|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    376| 
    377|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[70/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should try TOTP before backup code
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:430:31
    428| 
    429|       // Should succeed with TOTP (backup code ignored)
    430|       expect(response.status).toBe(200);
       |                               ^
    431|     });
    432|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[71/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should disable MFA with password verification
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:510:38
    508|         .send({ password });
    509| 
    510|       expect(disableResponse.status).toBe(200);
       |                                      ^
    511| 
    512|       // Verify MFA is disabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[72/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should require correct password to disable MFA
AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:557:44
    555| 
    556|       expect(disableResponse.status).toBe(401);
    557|       expect(disableResponse.body.message).toContain("Invalid passwordÎ“Ã‡Âª
       |                                            ^
    558| 
    559|       // MFA should still be enabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[73/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should regenerate backup codes
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:588:41
    586|         .set("Authorization", `Bearer ${token}`);
    587| 
    588|       expect(regenerateResponse.status).toBe(200);
       |                                         ^
    589|       expect(regenerateResponse.body.backupCodes).toHaveLength(10);
    590| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[74/239]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Tenant-Level MFA Enforcement > should enforce MFA for tenant users when required by tenant
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:638:36
    636|         .send({ email, password });
    637| 
    638|       expect(loginResponse.status).toBe(200);
       |                                    ^
    639|       expect(loginResponse.body.requiresMfa).toBe(true);
    640|       expect(loginResponse.body.userId).toBe(userId);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[75/239]Î“Ã„Â»

 FAIL  tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #7: Delete organization > should prevent deletion if org owns assets
AssertionError: promise resolved "undefined" instead of rejecting

- Expected: 
Error {
  "message": "rejected promise",
}

+ Received: 
undefined

 Î“Â¥Â» tests/integration/organizations-audit-fixes.test.ts:246:7
    244|       await expect(
    245|         organizationService.deleteOrganization(org.id, user1Id)
    246|       ).rejects.toThrow(/owns workflows/i);
       |       ^
    247| 
    248|       // Cleanup

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[76/239]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 1. Required + Show/Hide (Questions) > should NOT block Next when required question is hidden
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:197:31
    195|             // Check visibility
    196|             const isVisible = evaluateVisibilityExpression("show_triggÎ“Ã‡Âª
    197|             expect(isVisible).toBe(false);
       |                               ^
    198| 
    199|             // Required question is hidden, should not block

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[77/239]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 2. Required + Show/Hide (Pages) > should skip hidden required page entirely
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:330:31
    328|             const isVisible = evaluateVisibilityExpression((section2.vÎ“Ã‡Âª
    329| 
    330|             expect(isVisible).toBe(false); // Section 2 should be hiddÎ“Ã‡Âª
       |                               ^
    331| 
    332|             // Get all sections

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[78/239]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 3. Preview/Snapshot/Live Parity > should evaluate visibility consistently across modes
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:445:64
    443|             // Change data
    444|             const data2 = { trigger: false, value: 10 };
    445|             expect(evaluateVisibilityExpression(expr1, data2)).toBe(faÎ“Ã‡Âª
       |                                                                ^
    446|             expect(evaluateVisibilityExpression(expr2, data2)).toBe(trÎ“Ã‡Âª
    447|             expect(evaluateVisibilityExpression(expr3, data2)).toBe(faÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[79/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should list all active sessions for current user
AssertionError: expected +0 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 0

 Î“Â¥Â» tests/integration/session.management.real.test.ts:55:45
     53|       expect(response.status).toBe(200);
     54|       expect(response.body.sessions).toBeDefined();
     55|       expect(response.body.sessions.length).toBe(3);
       |                                             ^
     56| 
     57|       // Verify session properties

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[80/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should exclude revoked sessions
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:128:37
    126| 
    127|       // Should only show 1 session (non-revoked)
    128|       expect(response.body.sessions.length).toBe(1);
       |                                     ^
    129|     });
    130| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[81/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should order sessions by last used (most recent first)
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:154:36
    152| 
    153|       // Should be ordered by lastUsedAt descending
    154|       for (let i = 1; i < sessions.length; i++) {
       |                                    ^
    155|         const prev = new Date(sessions[i - 1].lastUsedAt);
    156|         const curr = new Date(sessions[i].lastUsedAt);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[82/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should filter sessions by current user only
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:184:37
    182|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    183| 
    184|       expect(response.body.sessions.length).toBe(2);
       |                                     ^
    185|     });
    186| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[83/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:215:40
    213| 
    214|       const sessions = sessionsResponse.body.sessions;
    215|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    216| 
    217|       // Revoke non-current session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[84/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:263:54
    261|       // Try to revoke current session
    262|       const revokeResponse = await request(app)
    263|         .delete(`/api/auth/sessions/${currentSession.id}`)
       |                                                      ^
    264|         .set("Authorization", `Bearer ${token}`);
    265| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[85/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking other user's session
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:303:49
    301|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    302| 
    303|       const user1SessionId = user1Sessions.body.sessions[0].id;
       |                                                 ^
    304| 
    305|       // Try to revoke user 1's session as user 2

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[86/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all other sessions
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:329:30
    327|       const token = currentLogin.body.token;
    328|       const cookies = (currentLogin.headers as any)["set-cookie"] as sÎ“Ã‡Âª
    329|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    330| 
    331|       // Revoke all except current

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[87/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should keep current session active
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:360:30
    358|       const token = currentLogin.body.token;
    359|       const cookies = (currentLogin.headers as any)["set-cookie"] as sÎ“Ã‡Âª
    360|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    361| 
    362|       // Revoke all others

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[88/239]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > Session Security > should not expose sensitive token data
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:493:37
    491|         .set("Authorization", `Bearer ${login.body.token}`);
    492| 
    493|       const session = response.body.sessions[0];
       |                                     ^
    494| 
    495|       // Should NOT include token hash or metadata

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[89/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should trust current device
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:64:30
     62|       });
     63| 
     64|       expect(devices.length).toBe(1);
       |                              ^
     65|       expect(devices[0].deviceName).toBeDefined();
     66|       expect(devices[0].ipAddress).toBe("192.168.1.100");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[90/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should update expiry if device already trusted
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:132:42
    130| 
    131|       // Should have extended expiry
    132|       expect(secondExpiry > firstExpiry).toBe(true);
       |                                          ^
    133| 
    134|       // Should still only have 1 device record

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[91/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should list all trusted devices
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:193:31
    191|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    192| 
    193|       expect(response.status).toBe(200);
       |                               ^
    194|       expect(response.body.devices).toBeDefined();
    195|       expect(response.body.devices.length).toBe(2);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[92/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should mark current device
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:236:51
    234|         .set("X-Forwarded-For", "192.168.1.100");
    235| 
    236|       const currentDevice = response.body.devices.find((d: any) => d.cÎ“Ã‡Âª
       |                                                   ^
    237|       expect(currentDevice).toBeDefined();
    238|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[93/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude revoked devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:269:36
    267|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    268| 
    269|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    270|     });
    271| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[94/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude expired devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:302:36
    300|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    301| 
    302|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    303|     });
    304|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[95/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should revoke specific device
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:332:45
    330|         .set("Authorization", `Bearer ${token}`);
    331| 
    332|       const deviceId = devicesResponse.body.devices[0].id;
       |                                             ^
    333| 
    334|       // Revoke device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[96/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should return 404 for non-existent device
AssertionError: expected 401 to be 404 // Object.is equality

- Expected
+ Received

- 404
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:371:31
    369|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    370| 
    371|       expect(response.status).toBe(404);
       |                               ^
    372|     });
    373| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[97/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should prevent revoking other user's device
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:399:43
    397|         .set("Authorization", `Bearer ${mfaLogin1.body.token}`);
    398| 
    399|       const user1DeviceId = devices1.body.devices[0].id;
       |                                           ^
    400| 
    401|       // User 2 tries to revoke user 1's device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[98/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should skip MFA for trusted device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:453:42
    451| 
    452|       // Should not require MFA
    453|       expect(secondLoginResponse.status).toBe(200);
       |                                          ^
    454|       expect(secondLoginResponse.body.requiresMfa).toBeUndefined();
    455|       expect(secondLoginResponse.body.token).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[99/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should require MFA for untrusted device
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:485:51
    483| 
    484|       // Should require MFA
    485|       expect(loginFromNewDevice.body.requiresMfa).toBe(true);
       |                                                   ^
    486|     });
    487| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[100/239]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should update lastUsedAt on trusted device login
TypeError: Cannot read properties of undefined (reading 'lastUsedAt')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:528:39
    526|       });
    527| 
    528|       const secondLastUsed = device2!.lastUsedAt;
       |                                       ^
    529| 
    530|       // lastUsedAt should be updated

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[101/239]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should create a version and populate changelog
Error: Validation failed: Schema Error: id - Required, Schema Error: title - Required, Schema Error: pages.0.title - Required, Schema Error: pages.0.order - Required
 Î“Â¥Â» VersionService.publishVersion server/services/VersionService.ts:287:13
    285| 
    286|     if (!validation.valid && !force) {
    287|       throw new Error(`Validation failed: ${validation.errors.join(', Î“Ã‡Âª
       |             ^
    288|     }
    289| 
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:97:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[102/239]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should track execution lineage via snapshot
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:117:143
    115| 
    116|         // Create Snapshot
    117|         const snapshot = await snapshotService.createSnapshot(workflowÎ“Ã‡Âª
       |                                                                                                                                               ^
    118| 
    119|         expect(snapshot.workflowVersionId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[103/239]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:68:43
     66| 
     67|       // Should be validating immediately
     68|       expect(result.current.isValidating).toBe(true);
       |                                           ^
     69| 
     70|       // Wait for debounce and validation

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[104/239]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:114:38
    112|       );
    113| 
    114|       expect(result.current.isValid).toBe(false);
       |                                      ^
    115|       expect(result.current.errors.length).toBeGreaterThan(0);
    116|       expect(result.current.errors[0].message).toContain('unknown_var'Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[105/239]Î“Ã„Â»

 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
ReferenceError: React is not defined
 Î“Â¥Â» RunsTable client/src/components/runs/RunsTable.tsx:41:3
     39|   };
     40| 
     41|   return (
       |   ^
     42|     <div className="rounded-md border">
     43|       <Table>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[106/239]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should generate a valid workflow from description
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.generateWorkflow server/services/AIService.ts:127:20
 Î“Â¥Â» tests/unit/ai.service.test.ts:86:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[107/239]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate unique section IDs
AssertionError: expected [Function] to throw error including 'Duplicate section IDs' but got 'AI response does not match expected sÎ“Ã‡Âª'

- Expected
+ Received

- Duplicate section IDs
+ AI response does not match expected schema
+
+ â‰¡Æ’Ã¶Âº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Î“Â¥Â» tests/unit/ai.service.test.ts:136:7
    134|       } as any;
    135| 
    136|       await expect(
       |       ^
    137|         openaiService.generateWorkflow({
    138|           description: 'Test',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[108/239]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate unique step IDs
AssertionError: expected [Function] to throw error including 'Duplicate step ID' but got 'AI response does not match expected sÎ“Ã‡Âª'

- Expected
+ Received

- Duplicate step ID
+ AI response does not match expected schema
+
+ â‰¡Æ’Ã¶Âº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Î“Â¥Â» tests/unit/ai.service.test.ts:190:7
    188|       } as any;
    189| 
    190|       await expect(
       |       ^
    191|         openaiService.generateWorkflow({
    192|           description: 'Test',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[109/239]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate logic rules reference existing steps
AssertionError: expected [Function] to throw error including 'references non-existent step alias' but got 'AI response does not match expected sÎ“Ã‡Âª'

- Expected
+ Received

- references non-existent step alias
+ AI response does not match expected schema
+
+ â‰¡Æ’Ã¶Âº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Î“Â¥Â» tests/unit/ai.service.test.ts:248:7
    246|       } as any;
    247| 
    248|       await expect(
       |       ^
    249|         openaiService.generateWorkflow({
    250|           description: 'Test',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[110/239]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should handle rate limit errors
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/unit/ai.service.test.ts:256:5
    254|     });
    255| 
    256|     it('should handle rate limit errors', async () => {
       |     ^
    257|       const rateLimitError = new Error('Rate limit exceeded');
    258|       // @ts-ignore

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[111/239]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > Anthropic Provider > should generate a valid workflow from description
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.generateWorkflow server/services/AIService.ts:127:20
 Î“Â¥Â» tests/unit/ai.service.test.ts:369:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[112/239]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > Anthropic Provider > should strip markdown code blocks from Anthropic responses
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.generateWorkflow server/services/AIService.ts:127:20
 Î“Â¥Â» tests/unit/ai.service.test.ts:409:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[113/239]Î“Ã„Â»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/generate-logic > should return generated logic
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Î“Â¥Â» tests/unit/api.ai.logic.test.ts:89:32
     87|                 if (!res.body || Object.keys(res.body).length === 0) cÎ“Ã‡Âª
     88|             }
     89|             expect(res.status).toBe(200);
       |                                ^
     90|             expect(res.body.success).toBe(true);
     91|             expect(mockGenerateLogic).toHaveBeenCalled();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[114/239]Î“Ã„Â»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/debug-logic > should return debug issues
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Î“Â¥Â» tests/unit/api.ai.logic.test.ts:110:32
    108|                 });
    109| 
    110|             expect(res.status).toBe(200);
       |                                ^
    111|             expect(res.body.success).toBe(true);
    112|             expect(res.body.issues).toHaveLength(1);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[115/239]Î“Ã„Â»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/visualize-logic > should return graph data
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Î“Â¥Â» tests/unit/api.ai.logic.test.ts:129:32
    127|                 });
    128| 
    129|             expect(res.status).toBe(200);
       |                                ^
    130|             expect(res.body.graph.nodes).toHaveLength(1);
    131|         });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[116/239]Î“Ã„Â»

 FAIL  tests/unit/api.ai.revise.test.ts > AI Routes Integration > POST /api/ai/workflows/revise > should call AIService.reviseWorkflow with correct parameters
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Î“Â¥Â» tests/unit/api.ai.revise.test.ts:89:32
     87|                 if (!res.body || Object.keys(res.body).length === 0) cÎ“Ã‡Âª
     88|             }
     89|             expect(res.status).toBe(200);
       |                                ^
     90|             expect(mockReviseWorkflow).toHaveBeenCalledTimes(1);
     91| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[117/239]Î“Ã„Â»

 FAIL  tests/unit/isolatedVmBridge.test.ts > isolated-vm Bridge Verification > should execute JS and capture console logs
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/unit/isolatedVmBridge.test.ts:86:36
     84| 
     85|         expect(result.ok).toBe(true);
     86|         expect(result.consoleLogs).toBeDefined();
       |                                    ^
     87|         // @ts-ignore
     88|         expect(result.consoleLogs[0]).toEqual(["hello log"]);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[118/239]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should allow access with valid JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 when no token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with refresh token cookie (GET only)
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for PUT requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for DELETE requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should allow cookie auth for HEAD requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should return 401 when no auth provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Cookie Strategy Security > should ignore cookies when Bearer token present
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach userEmail to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for missing token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for invalid token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should handle JWT with wrong algorithm
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:70:14
     68|                 password: testUser.password,
     69|             })
     70|             .expect(200);
       |              ^
     71| 
     72|         userToken = loginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[119/239]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should prioritize JWT over cookie when both present
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:209:18
    207|                     password: user2.password,
    208|                 })
    209|                 .expect(200);
       |                  ^
    210| 
    211|             // Use user1's cookie with user2's Bearer token
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[120/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should generate valid JWT token on successful login
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:54:18
     52|                 .post("/api/auth/register")
     53|                 .send(testUser)
     54|                 .expect(201);
       |                  ^
     55| 
     56|             // Verify email
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[121/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should include correct payload in JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:90:18
     88|                 .post("/api/auth/register")
     89|                 .send(testUser)
     90|                 .expect(201);
       |                  ^
     91| 
     92|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[122/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should set JWT expiry to 15 minutes
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:122:18
    120|                 .post("/api/auth/register")
    121|                 .send(testUser)
    122|                 .expect(201);
       |                  ^
    123| 
    124|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[123/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should accept valid JWT token on protected routes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:153:18
    151|                     password: testUser.password,
    152|                 })
    153|                 .expect(200);
       |                  ^
    154| 
    155|             const meRes = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[124/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should reject request with missing Bearer prefix
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:183:18
    181|                     password: testUser.password,
    182|                 })
    183|                 .expect(200);
       |                  ^
    184| 
    185|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[125/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Expiration > should return token_expired error code for expired tokens
AssertionError: expected { code: 'AUTH_008', Î“Ã‡Âª(3) } to be 'token_expired' // Object.is equality

- Expected: 
"token_expired"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-08T14:54:31.379Z",
}

 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:237:36
    235|                 .expect(401);
    236| 
    237|             expect(res.body.error).toBe("token_expired");
       |                                    ^
    238|         });
    239|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[126/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on PUT requests
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:268:18
    266|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    267|                 .send({ firstName: "Updated" })
    268|                 .expect(200);
       |                  ^
    269| 
    270|             expect(updateRes.body).toBeDefined();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[127/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on DELETE requests
Error: expected 200 "OK", got 204 "No Content"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:285:18
    283|                 .delete(`/api/projects/${projectRes.body.id}`)
    284|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    285|                 .expect(200);
       |                  ^
    286|         });
    287|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:847:12
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[128/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Cookie-to-Token Exchange > should exchange valid session cookie for JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:295:18
    293|                 .post("/api/auth/register")
    294|                 .send(testUser)
    295|                 .expect(201);
       |                  ^
    296| 
    297|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[129/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should prefer Bearer token over cookie when both present
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:330:18
    328|                     email: `user1-${nanoid()}@example.com`,
    329|                 })
    330|                 .expect(201);
       |                  ^
    331| 
    332|             const user2Res = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[130/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should fall back to cookie if Bearer token is invalid
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:358:18
    356|                 .post("/api/auth/register")
    357|                 .send(testUser)
    358|                 .expect(201);
       |                  ^
    359| 
    360|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[131/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should allow GET requests with cookie auth only
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:377:18
    375|                 .post("/api/auth/register")
    376|                 .send(testUser)
    377|                 .expect(201);
       |                  ^
    378| 
    379|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[132/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should reject POST requests with cookie auth only (mutation-strict)
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:406:18
    404|                 .post("/api/auth/register")
    405|                 .send(testUser)
    406|                 .expect(201);
       |                  ^
    407| 
    408|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[133/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should allow anonymous access to public workflows
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:432:18
    430|                     publicLink: `public-${nanoid()}`,
    431|                 })
    432|                 .expect(201);
       |                  ^
    433| 
    434|             // Access without authentication
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[134/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should attach user info if authenticated on optional auth routes
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:451:18
    449|                     publicLink: `optional-${nanoid()}`,
    450|                 })
    451|                 .expect(201);
       |                  ^
    452| 
    453|             // Access with authentication
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[135/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should refresh access token using refresh token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:469:18
    467|                 .post("/api/auth/register")
    468|                 .send(testUser)
    469|                 .expect(201);
       |                  ^
    470| 
    471|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[136/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should rotate refresh token on use
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:503:18
    501|                 .post("/api/auth/register")
    502|                 .send(testUser)
    503|                 .expect(201);
       |                  ^
    504| 
    505|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[137/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should detect token reuse and revoke all user tokens
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:544:18
    542|                 .post("/api/auth/register")
    543|                 .send(testUser)
    544|                 .expect(201);
       |                  ^
    545| 
    546|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[138/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should revoke refresh token on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:595:18
    593|                 .post("/api/auth/register")
    594|                 .send(testUser)
    595|                 .expect(201);
       |                  ^
    596| 
    597|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[139/239]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should clear refresh token cookie on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:628:18
    626|                 .post("/api/auth/register")
    627|                 .send(testUser)
    628|                 .expect(201);
       |                  ^
    629| 
    630|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[140/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > GET /api/auth/sessions - List Active Sessions > should parse device name from user agent
AssertionError: expected 0 to be greater than 0
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:186:45
    184| 
    185|       expect(response.status).toBe(200);
    186|       expect(response.body.sessions.length).toBeGreaterThan(0);
       |                                             ^
    187|       expect(response.body.sessions[0].deviceName).toBeTruthy();
    188|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[141/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should revoke a specific session
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:210:29
    208|       });
    209| 
    210|       expect(sessionRecord).toBeDefined();
       |                             ^
    211| 
    212|       const response = await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[142/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should prevent revoking current session
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:243:54
    241| 
    242|       const response = await request(app)
    243|         .delete(`/api/auth/sessions/${sessionRecord!.id}`)
       |                                                      ^
    244|         .set('Authorization', `Bearer ${authToken}`)
    245|         .set('Cookie', `refresh_token=${token}`);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[143/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should prevent revoking another user's session
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:275:53
    273|       // Try to revoke other user's session
    274|       const response = await request(app)
    275|         .delete(`/api/auth/sessions/${otherSession!.id}`)
       |                                                     ^
    276|         .set('Authorization', `Bearer ${authToken}`);
    277| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[144/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/all - Logout All Other Devices > should revoke all sessions except current
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:316:37
    314|         ));
    315| 
    316|       expect(activeSessions.length).toBe(1);
       |                                     ^
    317|       expect(activeSessions[0].token).toBe(currentToken);
    318|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[145/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > POST /api/auth/trust-device > should update existing trusted device expiry
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:419:32
    417| 
    418|         // Should still be only one device
    419|         expect(devices.length).toBe(1);
       |                                ^
    420| 
    421|         // Expiry should be updated

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[146/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > GET /api/auth/trusted-devices > should list all trusted devices
AssertionError: expected +0 to be 2 // Object.is equality

- Expected
+ Received

- 2
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:456:46
    454|         expect(response.status).toBe(200);
    455|         expect(response.body.devices).toBeInstanceOf(Array);
    456|         expect(response.body.devices.length).toBe(2);
       |                                              ^
    457| 
    458|         response.body.devices.forEach((device: any) => {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[147/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should track IP address for sessions
AssertionError: expected undefined to be '192.168.1.100' // Object.is equality

- Expected: 
"192.168.1.100"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:535:34
    533|       });
    534| 
    535|       expect(session?.ipAddress).toBe('192.168.1.100');
       |                                  ^
    536|     });
    537| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[148/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should track user agent for sessions
AssertionError: expected undefined to be 'Mozilla/5.0 (Windows NT 10.0; Win64; Î“Ã‡Âª' // Object.is equality

- Expected: 
"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:549:35
    547| 
    548|       const metadata = session?.metadata as any;
    549|       expect(metadata?.userAgent).toBe(userAgent);
       |                                   ^
    550|     });
    551| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[149/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should refresh access token with valid refresh token
AssertionError: expected { Î“Ã‡Âª(2) } to match object { token: Any<String>, user: { Î“Ã‡Âª(3) } }
(1 matching property omitted from actual)

- Expected
+ Received

  {
    "token": Any<String>,
    "user": {
      "email": "refresh-test-yy_J6nGwy0tA_19eFR3dp@example.com",
      "id": "yUG4pFElnAzmW98lSUQ7n",
-     "role": "owner",
+     "role": "creator",
    },
  }

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:88:29
     86| 
     87|       expect(response.status).toBe(200);
     88|       expect(response.body).toMatchObject({
       |                             ^
     89|         token: expect.any(String),
     90|         user: {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[150/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should rotate refresh token after use
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:126:33
    124|         where: eq(refreshTokens.token, testRefreshToken),
    125|       });
    126|       expect(oldToken?.revoked).toBe(true);
       |                                 ^
    127| 
    128|       // New token should exist and not be revoked

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[151/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should return 401 for revoked refresh token
AssertionError: expected 200 to be 401 // Object.is equality

- Expected
+ Received

- 401
+ 200

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:193:31
    191|         .set('Cookie', `refresh_token=${testRefreshToken}`);
    192| 
    193|       expect(response.status).toBe(401);
       |                               ^
    194|       expect(response.body.message).toBe('Invalid refresh token');
    195|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[152/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should return 401 when user is not found
AssertionError: expected 'Invalid refresh token' to be 'User not found' // Object.is equality

Expected: "User not found"
Received: "Invalid refresh token"

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:206:37
    204| 
    205|       expect(response.status).toBe(401);
    206|       expect(response.body.message).toBe('User not found');
       |                                     ^
    207|     });
    208| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[153/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should update refresh token metadata on rotation
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:226:24
    224|       });
    225| 
    226|       expect(newToken).toBeDefined();
       |                        ^
    227|       expect(newToken?.lastUsedAt).toBeDefined();
    228|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[154/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should set proper cookie attributes
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:274:31
    272|         .set('Cookie', `refresh_token=${testRefreshToken}`);
    273| 
    274|       expect(response.status).toBe(200);
       |                               ^
    275| 
    276|       const setCookieHeader = response.headers['set-cookie']?.[0];

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[155/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should include user role information in response
AssertionError: expected { id: 'cXWlWuGUyFKs_F1s-QFF-', Î“Ã‡Âª(3) } to match object { id: 'cXWlWuGUyFKs_F1s-QFF-', Î“Ã‡Âª(2) }
(1 matching property omitted from actual)

- Expected
+ Received

  {
    "email": "refresh-test-tj4CTco0hLXwIWfIW9-xF@example.com",
    "id": "cXWlWuGUyFKs_F1s-QFF-",
-   "role": "owner",
+   "role": "creator",
  }

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:290:34
    288| 
    289|       expect(response.status).toBe(200);
    290|       expect(response.body.user).toMatchObject({
       |                                  ^
    291|         id: testUserId,
    292|         email: testUserEmail,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[156/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should create refresh token on login
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:307:31
    305|         });
    306| 
    307|       expect(response.status).toBe(200);
       |                               ^
    308| 
    309|       // Verify refresh token cookie is set

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[157/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should revoke refresh token on logout
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:333:30
    331|         where: eq(refreshTokens.token, testRefreshToken),
    332|       });
    333|       expect(token?.revoked).toBe(true);
       |                              ^
    334| 
    335|       // Verify cookie is cleared

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[158/239]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Security > should validate token ownership
AssertionError: expected undefined to be '_n_JEQW05OIjD9LLWRQjF' // Object.is equality

- Expected: 
"_n_JEQW05OIjD9LLWRQjF"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:465:29
    463|       });
    464| 
    465|       expect(token?.userId).toBe(testUserId);
       |                             ^
    466|       expect(token?.userId).not.toBe(otherUser.id);
    467|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[159/239]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should allow access with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access without Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with empty Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with malformed Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with wrong token type
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should allow POST with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST with invalid token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should allow PUT with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should reject PUT without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle token with newlines
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle Authorization header with only Bearer
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should reject token with SQL injection attempt
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Payload Validation > should reject token with missing userId
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Payload Validation > should reject token with non-existent userId
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Cross-User Authorization > should not allow user to access another user's resources
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > User Context Injection > should inject userId into request context
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > User Context Injection > should inject role into request context
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Rate Limiting on Protected Routes > should not apply general rate limiting to authenticated requests
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:76:14
     74|                 password: testUser.password,
     75|             })
     76|             .expect(200);
       |              ^
     77| 
     78|         userToken = loginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[160/239]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > DELETE Protected Routes > should allow DELETE with valid Bearer token
Error: expected 201 "Created", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:168:18
    166|                 .set("Authorization", `Bearer ${userToken}`)
    167|                 .send({ name: "Delete Test Project" })
    168|                 .expect(201);
       |                  ^
    169| 
    170|             // Delete it
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[161/239]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Mixed Auth Scenarios > should prioritize Bearer token over cookie when both present
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:436:18
    434|                     password: testUser.password,
    435|                 })
    436|                 .expect(200);
       |                  ^
    437| 
    438|             const user2 = {
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[162/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create refresh token on login
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:74:18
     72|                     password: testUser.password,
     73|                 })
     74|                 .expect(200);
       |                  ^
     75| 
     76|             expect(loginRes.headers['set-cookie']).toBeDefined();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[163/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should track device metadata in session
AssertionError: expected 0 to be greater than 0
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:106:35
    104|             });
    105| 
    106|             expect(tokens.length).toBeGreaterThan(0);
       |                                   ^
    107|             expect(tokens[0].deviceName).toBeDefined();
    108|             expect(tokens[0].ipAddress).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[164/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create separate sessions for multiple device logins
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:120:18
    118|                     password: testUser.password,
    119|                 })
    120|                 .expect(200);
       |                  ^
    121| 
    122|             // Login from device 2
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[165/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should list all active sessions for user
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:163:18
    161|                     password: testUser.password,
    162|                 })
    163|                 .expect(200);
       |                  ^
    164| 
    165|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[166/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should mark current session correctly
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:208:18
    206|                     password: testUser.password,
    207|                 })
    208|                 .expect(200);
       |                  ^
    209| 
    210|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[167/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should not include revoked sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:246:18
    244|                     password: testUser.password,
    245|                 })
    246|                 .expect(200);
       |                  ^
    247| 
    248|             // Get all sessions to find session2's ID
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[168/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should order sessions by last used (most recent first)
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:293:18
    291|                     password: testUser.password,
    292|                 })
    293|                 .expect(200);
       |                  ^
    294| 
    295|             await new Promise(resolve => setTimeout(resolve, 100));
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[169/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should revoke specific session
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:332:18
    330|                     password: testUser.password,
    331|                 })
    332|                 .expect(200);
       |                  ^
    333| 
    334|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[170/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should not allow revoking other users sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:417:18
    415|                     password: user2.password,
    416|                 })
    417|                 .expect(200);
       |                  ^
    418| 
    419|             // User1 tries to get user2's sessions
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[171/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should return 404 for non-existent session ID
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:452:18
    450|                     password: testUser.password,
    451|                 })
    452|                 .expect(200);
       |                  ^
    453| 
    454|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[172/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/all > should revoke all sessions except current
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:471:18
    469|                     password: testUser.password,
    470|                 })
    471|                 .expect(200);
       |                  ^
    472| 
    473|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[173/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Expiration > should reject refresh token after 30 days
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:564:18
    562|                     password: testUser.password,
    563|                 })
    564|                 .expect(200);
       |                  ^
    565| 
    566|             // Get the refresh token from database (non-revoked only)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[174/239]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Concurrent Session Handling > should handle concurrent token refreshes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:631:18
    629|                     password: testUser.password,
    630|                 })
    631|                 .expect(200);
       |                  ^
    632| 
    633|             const cookies = session.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[175/239]Î“Ã„Â»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Boolean Type (Checkbox) > shows loading spinner when saving checkbox
Error: expect(received).toBeInTheDocument()

received value must be an HTMLElement or an SVGElement.
Received has type:  Null
Received has value: null

Ignored nodes: comments, script, style
<html>
  <head />
  <body>
    <div>
      <div
        aria-label="Is Active: No"
        class="px-3 py-2 min-h-[40px] flex items-center gap-2 cursor-pointer hover:bg-accent/50"
        role="gridcell"
      >
        <button
          aria-checked="false"
          aria-label="Is Active"
          class="peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground"
          data-state="unchecked"
          role="checkbox"
          type="button"
          value="on"
        />
      </div>
    </div>
  </body>
</html>
 Î“Â¥Â» tests/ui/datavault/EditableCell.test.tsx:279:77
    277| 
    278|       await waitFor(() => {
    279|         expect(screen.getByRole('gridcell').querySelector('.animate-spÎ“Ã‡Âª
       |                                                                             ^
    280|       });
    281| 
 Î“Â¥Â» runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:47:12
 Î“Â¥Â» checkCallback node_modules/@testing-library/dom/dist/wait-for.js:124:77
 Î“Â¥Â» Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:118:16

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[176/239]Î“Ã„Â»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Value Formatting > formats date values for display
AssertionError: expected '1/14/2000' to contain '1/15/2000'

Expected: "1/15/2000"
Received: "1/14/2000"

 Î“Â¥Â» tests/ui/datavault/EditableCell.test.tsx:334:32
    332| 
    333|       const cell = screen.getByRole('gridcell');
    334|       expect(cell.textContent).toContain('1/15/2000');
       |                                ^
    335|     });
    336| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[177/239]Î“Ã„Â»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Value Formatting > formats boolean values as Yes/No
Error: expect(element).toHaveAttribute("aria-label", "Verified: Yes") // element.getAttribute("aria-label") === "Verified: Yes"

Expected the element to have attribute:
  aria-label="Verified: Yes"
Received:
  aria-label="Verified: true"
 Î“Â¥Â» tests/ui/datavault/EditableCell.test.tsx:342:20
    340| 
    341|       const cell = screen.getByRole('gridcell');
    342|       expect(cell).toHaveAttribute('aria-label', 'Verified: Yes');
       |                    ^
    343|     });
    344| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[178/239]Î“Ã„Â»

 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table name and description
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table slug
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render column and row counts
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onClick when card is clicked
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onDelete when delete button is clicked
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should show placeholder when description is missing
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should format dates correctly
ReferenceError: React is not defined
 Î“Â¥Â» TableCard client/src/components/datavault/TableCard.tsx:38:3
     36|   };
     37| 
     38|   return (
       |   ^
     39|     <Card className="cursor-pointer hover:shadow-md transition-shadow Î“Ã‡Âª
     40|       <div onClick={onClick}>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[179/239]Î“Ã„Â»

 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render template name and description
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should show "Coming Soon" badge
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render preview columns
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should limit preview columns to 5 and show count for remaining
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should handle empty preview columns
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should have cursor-not-allowed style
ReferenceError: React is not defined
 Î“Â¥Â» TemplateCard client/src/components/datavault/TemplateCard.tsx:19:3
     17| 
     18| export function TemplateCard({ name, description, icon, previewColumnsÎ“Ã‡Âª
     19|   return (
       |   ^
     20|     <TooltipProvider>
     21|       <Tooltip>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[180/239]Î“Ã„Â»

 FAIL  tests/ui/common/Breadcrumbs.test.tsx > Breadcrumbs Component > should apply font-medium to last item
Error: expect(element).toHaveClass("font-medium")

Expected the element to have class:
  font-medium
Received:

 Î“Â¥Â» tests/ui/common/Breadcrumbs.test.tsx:101:38
     99| 
    100|     const lastItem = screen.getByText('Test Database');
    101|     expect(lastItem.closest('span')).toHaveClass('font-medium');
       |                                      ^
    102|   });
    103| });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[181/239]Î“Ã„Â»

 FAIL  tests/unit/client/choice-utils.test.ts > choice-utils > uses label template with column names
AssertionError: expected ' ()' to be 'Alice (Admin)' // Object.is equality

Expected: "Alice (Admin)"
Received: " ()"

 Î“Â¥Â» tests/unit/client/choice-utils.test.ts:116:31
    114|         };
    115|         const opts = generateOptionsFromList(mockList, config);
    116|         expect(opts[0].label).toBe("Alice (Admin)");
       |                               ^
    117|         expect(opts[1].label).toBe("Bob (User)");
    118|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[182/239]Î“Ã„Â»

 FAIL  tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should track skipped blocks in trace
AssertionError: expected 'condition false' to be 'condition evaluated to false' // Object.is equality

Expected: "condition evaluated to false"
Received: "condition false"

 Î“Â¥Â» tests/unit/debugging/Lineage.test.ts:133:36
    131| 
    132|         expect(step.status).toBe('skipped');
    133|         expect(step.skippedReason).toBe('condition evaluated to false'Î“Ã‡Âª
       |                                    ^
    134|         expect(result.executionTrace!.variableLineage['skippedVar']).tÎ“Ã‡Âª
    135|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[183/239]Î“Ã„Â»

 FAIL  tests/unit/schema/collections.test.ts > Collections Schema > Insert Schemas > insertCollectionSchema > should omit id, createdAt, and updatedAt
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/unit/schema/collections.test.ts:139:32
    137|         const result = insertCollectionSchema.safeParse(dataWithOmitteÎ“Ã‡Âª
    138|         // Should be invalid because id, createdAt, updatedAt are omitÎ“Ã‡Âª
    139|         expect(result.success).toBe(false);
       |                                ^
    140|       });
    141| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[184/239]Î“Ã„Â»

 FAIL  tests/unit/middleware/auth.middleware.test.ts > Auth Middleware > requireAuth > should return 401 for missing token
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{Î“Ã‡Âª} ]

Received: 

  1st vi.fn() call:

  [
-   ObjectContaining {
-     "error": "missing_token",
+   {
+     "error": {
+       "code": "AUTH_008",
+       "details": {
+         "errorType": "UnauthorizedError",
+       },
        "message": "Authentication required",
+       "timestamp": "2026-01-08T14:54:16.298Z",
+     },
+     "success": false,
    },
  ]


Number of calls: 1

 Î“Â¥Â» tests/unit/middleware/auth.middleware.test.ts:74:24
     72|       expect(mockNext).not.toHaveBeenCalled();
     73|       expect(statusMock).toHaveBeenCalledWith(401);
     74|       expect(jsonMock).toHaveBeenCalledWith(
       |                        ^
     75|         expect.objectContaining({
     76|           message: 'Authentication required',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[185/239]Î“Ã„Â»

 FAIL  tests/unit/services/AIService.test.ts > AIService Unit Tests > reviseWorkflow should parse valid JSON response correctly
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.reviseWorkflowSingleShot server/services/AIService.ts:1418:20
 Î“Â¥Â» AIService.reviseWorkflow server/services/AIService.ts:1298:16
 Î“Â¥Â» tests/unit/services/AIService.test.ts:61:24

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[186/239]Î“Ã„Â»

 FAIL  tests/unit/services/AIService.test.ts > AIService Unit Tests > reviseWorkflow should handle JSON markdown code blocks
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.reviseWorkflowSingleShot server/services/AIService.ts:1418:20
 Î“Â¥Â» AIService.reviseWorkflow server/services/AIService.ts:1298:16
 Î“Â¥Â» tests/unit/services/AIService.test.ts:95:24

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[187/239]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for invalid token signature
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:514:62
    512|         }
    513| 
    514|         expect(() => authService.verifyToken(tamperedToken)).toThrow("Î“Ã‡Âª
       |                                                              ^
    515|       });
    516| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[188/239]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for malformed token
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:518:68
    516| 
    517|       it("should throw error for malformed token", () => {
    518|         expect(() => authService.verifyToken("not.a.valid.token")).toTÎ“Ã‡Âª
       |                                                                    ^
    519|       });
    520| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[189/239]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for invalid token
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:523:64
    521|       it("should throw error for invalid token", () => {
    522|         // Test with a malformed token
    523|         expect(() => authService.verifyToken("invalid.token")).toThrowÎ“Ã‡Âª
       |                                                                ^
    524|       });
    525|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[190/239]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > Security Edge Cases > Token Manipulation > should reject token with valid structure but invalid signature
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:1065:58
    1063|         const fakeToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2Î“Ã‡Âª
    1064| 
    1065|         expect(() => authService.verifyToken(fakeToken)).toThrow("InvaÎ“Ã‡Âª
       |                                                          ^
    1066|       });
    1067|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[191/239]Î“Ã„Â»

 FAIL  tests/unit/services/intakeQuestionVisibility.test.ts > IntakeQuestionVisibilityService > Hidden question value clearing > should clear values for hidden questions
TypeError: this.stepValueRepo.deleteWhere is not a function
 Î“Â¥Â» IntakeQuestionVisibilityService.clearHiddenQuestionValues server/services/IntakeQuestionVisibilityService.ts:339:32
    337|       const { stepValues } = await import("../../shared/schema");
    338| 
    339|       await this.stepValueRepo.deleteWhere(inArray(stepValues.id, idsTÎ“Ã‡Âª
       |                                ^
    340| 
    341|       logger.debug(
 Î“Â¥Â» tests/unit/services/intakeQuestionVisibility.test.ts:425:23

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[192/239]Î“Ã„Â»

 FAIL  tests/unit/services/intakeQuestionVisibility.test.ts > IntakeQuestionVisibilityService > Cascading visibility > should handle questions that depend on each other
AssertionError: expected [ 'q1' ] to deeply equal [ 'q1', 'q2', 'q3' ]

- Expected
+ Received

  [
    "q1",
-   "q2",
-   "q3",
  ]

 Î“Â¥Â» tests/unit/services/intakeQuestionVisibility.test.ts:615:40
    613|       const result2 = await service.evaluatePageQuestions('section1', Î“Ã‡Âª
    614| 
    615|       expect(result2.visibleQuestions).toEqual(['q1', 'q2', 'q3']); //Î“Ã‡Âª
       |                                        ^
    616|     });
    617|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[193/239]Î“Ã„Â»

 FAIL  tests/unit/services/StepService.test.ts > StepService > createStep > should create a step with auto-incrementing order
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{Î“Ã‡Âª} ]

Received: 

  1st vi.fn() call:

  [
-   ObjectContaining {
-     "order": 3,
+   {
+     "options": {},
+     "order": 1,
+     "required": false,
      "sectionId": "section-t75itb",
+     "title": "New Step",
+     "type": "short_text",
    },
  ]


Number of calls: 1

 Î“Â¥Â» tests/unit/services/StepService.test.ts:65:35
     63| 
     64|       expect(result.order).toBe(3);
     65|       expect(mockStepRepo.create).toHaveBeenCalledWith(
       |                                   ^
     66|         expect.objectContaining({
     67|           sectionId: section.id,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[194/239]Î“Ã„Â»


[2m Test Files [22m [1m[31m46 failed[39m[22m[2m | [22m[1m[32m108 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (155)[39m
[2m      Tests [22m [1m[31m228 failed[39m[22m[2m | [22m[1m[32m2231 passed[39m[22m[2m | [22m[33m68 skipped[39m[90m (2527)[39m
[2m   Start at [22m 08:54:11
[2m   Duration [22m 79.22s[2m (transform 31.54s, setup 36.04s, import 246.79s, tests 692.47s, environment 16.37s)[22m

