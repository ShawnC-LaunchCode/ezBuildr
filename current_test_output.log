npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

> ezbuildr@1.0.0 test
> vitest run --coverage --no-color

 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

 RUN  v4.0.16 C:/Users/scoot/poll/VaultLogic
      Coverage enabled with v8

stdout | tests/integration/mfa.flow.real.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/integration/auth/auth.middleware.integration.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/integration/auth.routes.real.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/ai.service.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/integration/auth/oauth2.sessions.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/auth/protected.routes.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/integration/session.management.real.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/integration/auth/oauth2.token-refresh.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/integration/auth.flows.real.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/integration/api.workflows.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/integration/organizations-audit-fixes.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/unit/server/transferOwnership.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/integration/auth/session.management.integration.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/integration/trusted.devices.real.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/integration/datavault.autonumber.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/auth/oauth2.token-refresh.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/integration/datavault.autonumber.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/integration/organizations-audit-fixes.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/integration/auth.routes.real.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/integration/auth/oauth2.sessions.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/unit/server/transferOwnership.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/integration/auth.flows.real.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/integration/trusted.devices.real.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/integration/auth/protected.routes.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/integration/session.management.real.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/integration/api.workflows.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/integration/auth/session.management.integration.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/integration/auth/auth.middleware.integration.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/integration/mfa.flow.real.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/ai.service.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/ai.service.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/ai.service.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/organizations-audit-fixes.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/datavault.autonumber.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/organizations-audit-fixes.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/server/transferOwnership.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/datavault.autonumber.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/ai.service.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/server/transferOwnership.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":40,"time":1767814128592,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128601,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128603,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128604,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814128616,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1767814128609,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128618,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128634,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128622,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128623,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128637,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814128638,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814128617,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"responseTokens":90,"totalTokens":1302,"durationMs":2,"estimatedCostUSD":0.01482,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814128621,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":5,"msg":"AI workflow generation failed"}
{"level":30,"time":1767814128636,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767814128637,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":49,"totalTokens":1250,"durationMs":1,"estimatedCostUSD":0.013479999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814128638,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":2,"msg":"AI workflow generation failed"}
{"level":30,"time":1767814128678,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767814128679,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":68,"totalTokens":1269,"durationMs":1,"estimatedCostUSD":0.01405,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814128680,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":2,"msg":"AI workflow generation failed"}
{"level":30,"time":1767814128687,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767814128687,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":89,"totalTokens":1290,"durationMs":0,"estimatedCostUSD":0.014679999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814128688,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767814128696,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1767814128696,"env":"test","module":"ai-service","attempt":0,"waitMs":1000,"msg":"Rate limit hit, retrying..."}
stderr | tests/integration/organizations-audit-fixes.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/datavault.autonumber.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/server/transferOwnership.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814129698,"env":"test","module":"ai-service","attempt":1,"waitMs":2000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767814129915,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814129935,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814129947,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814129979,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814129994,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814130012,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814130028,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stdout | tests/integration/auth/oauth2.sessions.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814130035,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stdout | tests/integration/session.management.real.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/mfa.flow.real.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/trusted.devices.real.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth.flows.real.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814130066,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814130071,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814130077,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stdout | tests/integration/auth.routes.real.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/trusted.devices.real.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/session.management.real.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/auth/oauth2.sessions.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/auth.flows.real.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/mfa.flow.real.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/auth/oauth2.token-refresh.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth.routes.real.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/auth/oauth2.token-refresh.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/integration/trusted.devices.real.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/session.management.real.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth.flows.real.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth/oauth2.sessions.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/mfa.flow.real.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth.routes.real.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth/oauth2.token-refresh.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/mfa.flow.real.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:184:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:164:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:126:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

stderr | tests/integration/auth/oauth2.sessions.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:184:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:164:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:126:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

stderr | tests/integration/session.management.real.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:184:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:164:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:126:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

stdout | tests/integration/auth/oauth2.token-refresh.test.ts
ΓÜá∩╕Å Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1767814131248,"env":"test","module":"user-credentials-repository","userId":"FSrAwEVbPRL0ldxi0eqXs","msg":"User credentials created"}
{"level":30,"time":1767814131453,"env":"test","module":"auth-routes","userId":"FSrAwEVbPRL0ldxi0eqXs","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1767814131688,"env":"test","module":"user-credentials-repository","userId":"cvKq4s1urgSI51hj73cJy","msg":"User credentials created"}
{"level":40,"time":1767814131701,"env":"test","module":"ai-service","attempt":2,"waitMs":4000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767814131742,"env":"test","module":"user-credentials-repository","userId":"S_WAA4DOZq8ghJdHObTYp","msg":"User credentials created"}
{"level":30,"time":1767814131796,"env":"test","module":"email-queue","jobId":"43c0c46d-9f35-4d7e-9afe-0e798e7f13d0","to":"test-1767814131262-8051go@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814131801,"env":"test","module":"user-credentials-repository","userId":"3hDn8KhY-l3maKHaHGobg","msg":"User credentials created"}
{"level":30,"time":1767814131847,"env":"test","module":"email-queue","jobId":"d8feb355-c6d8-4684-890b-f167d98a2316","to":"test-1767814131309-eds4fb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814131854,"env":"test","module":"auth-routes","userId":"cvKq4s1urgSI51hj73cJy","email":"test-1767814131262-8051go@example.com","msg":"User registered"}
{"level":30,"time":1767814131903,"env":"test","module":"auth-routes","userId":"S_WAA4DOZq8ghJdHObTYp","email":"test-1767814131309-eds4fb@example.com","msg":"User registered"}
{"level":30,"time":1767814131912,"env":"test","module":"auth-routes","userId":"3hDn8KhY-l3maKHaHGobg","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1767814131938,"env":"test","module":"user-credentials-repository","userId":"RXJGAWvLz0y9NQBiUYbRp","msg":"User credentials created"}
{"level":30,"time":1767814132214,"env":"test","module":"auth-routes","userId":"7c2154fc76deeae54b2dc673021dd24b","msg":"User logged in successfully"}
{"level":30,"time":1767814132221,"env":"test","module":"auth-routes","userId":"9af6d1f82bd15cf84690c93ed2aec4b9","msg":"User logged in successfully"}
{"level":40,"time":1767814132243,"env":"test","module":"auth-routes","userId":"cvKq4s1urgSI51hj73cJy","email":"test-1767814131262-8051go@example.com","msg":"Login blocked: email not verified"}
{"level":50,"time":1767814132244,"env":"test","module":"auth-routes","error":{"name":"EmailNotVerifiedError","code":"AUTH_006","statusCode":403,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814132254,"env":"test","module":"user-credentials-repository","userId":"D5VN2xGBX8ACYIO4gdYoF","msg":"User credentials created"}
{"level":30,"time":1767814132274,"env":"test","module":"audit-log-service","userId":"7c2154fc76deeae54b2dc673021dd24b","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814132275,"env":"test","module":"audit-log-service","userId":"9af6d1f82bd15cf84690c93ed2aec4b9","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814132361,"env":"test","module":"auth-routes","userId":"D5VN2xGBX8ACYIO4gdYoF","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767814132512,"env":"test","module":"auth-routes","userId":"1dd1492416d994117ca927af71db5dda","msg":"Login requires MFA verification"}
{"level":50,"time":1767814132552,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814132562,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814132606,"env":"test","module":"user-credentials-repository","userId":"DWDUeZWhhB9eMXVKVl8Iq","msg":"User credentials created"}
{"level":40,"time":1767814132630,"env":"test","module":"mfa-service","userId":"1dd1492416d994117ca927af71db5dda","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814132630,"env":"test","module":"auth-routes","userId":"1dd1492416d994117ca927af71db5dda","msg":"MFA verification failed during login"}
{"level":50,"time":1767814132641,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814132716,"env":"test","module":"user-credentials-repository","userId":"tIh0E_c5Eev_87P9odIYI","msg":"User credentials created"}
{"level":40,"time":1767814132722,"env":"test","module":"auth-service","tokenHash":"fd552bfab6e9d374671219b3f2b4ad90eaf14ebaffcf66ce27a78acb5ce9a054","msg":"Security: Unknown refresh token used"}
stdout | tests/integration/datavault.autonumber.test.ts > DataVault Autonumber Integration Tests > should generate basic autonumber without prefix
Row 1 Basic Autonumber: 0001
Row 2 Basic Autonumber: 0002

{"level":50,"time":1767814132809,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814132814,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814132828,"env":"test","module":"auth-routes","userId":"tIh0E_c5Eev_87P9odIYI","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767814132843,"env":"test","module":"mfa-service","userId":"7c2154fc76deeae54b2dc673021dd24b","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767814132843,"env":"test","module":"mfa-service","userId":"7c2154fc76deeae54b2dc673021dd24b","msg":"Generated TOTP secret"}
{"level":30,"time":1767814132843,"env":"test","module":"auth-routes","userId":"7c2154fc76deeae54b2dc673021dd24b","msg":"MFA setup initiated"}
{"level":30,"time":1767814133043,"env":"test","module":"user-credentials-repository","userId":"W3S-k1MHj5qJ7-5RyuykS","msg":"User credentials created"}
{"level":30,"time":1767814133153,"env":"test","module":"user-credentials-repository","userId":"rdzsVGLinmo5FpCYclLt3","msg":"User credentials created"}
{"level":30,"time":1767814133309,"env":"test","module":"auth-routes","userId":"rdzsVGLinmo5FpCYclLt3","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767814133460,"env":"test","module":"user-credentials-repository","userId":"t53Vw3YmL60og6fWOQLLp","msg":"User credentials created"}
{"level":40,"time":1767814133572,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1767814133633,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814133673,"env":"test","module":"user-credentials-repository","userId":"cELSVlzT0hLRtJuAeU8eZ","msg":"User credentials created"}
{"level":30,"time":1767814133782,"env":"test","module":"auth-routes","userId":"cELSVlzT0hLRtJuAeU8eZ","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1767814133901,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814133914,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814133932,"env":"test","module":"user-credentials-repository","userId":"oQCDgpWoo-GY_5yAy-8kq","msg":"User credentials created"}
{"level":50,"time":1767814134050,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814134088,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767814134122,"env":"test","module":"user-credentials-repository","userId":"1GhaEST0sb6Rm6C-y1yTx","msg":"User credentials created"}
{"level":50,"time":1767814134126,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767814134153,"env":"test","module":"mfa-service","userId":"10288fda5f154e16521b0fcde9a45182","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814134153,"env":"test","module":"auth-routes","userId":"10288fda5f154e16521b0fcde9a45182","msg":"MFA verification failed during login"}
{"level":50,"time":1767814134160,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814134168,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814134181,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814134254,"env":"test","module":"auth-routes","userId":"dbce7ce778d10e714d3a51ffd42436f2","msg":"User logged in successfully"}
{"level":30,"time":1767814134305,"env":"test","module":"audit-log-service","userId":"dbce7ce778d10e714d3a51ffd42436f2","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814134423,"env":"test","module":"user-credentials-repository","userId":"9uzHqhV-I15FnOEkYaOLX","msg":"User credentials created"}
{"level":50,"time":1767814134447,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814134460,"env":"test","module":"user-credentials-repository","userId":"fiX8MOhUPR2mW-IJzqXNK","msg":"User credentials created"}
{"level":50,"time":1767814134710,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814134822,"env":"test","module":"mfa-service","userId":"dbce7ce778d10e714d3a51ffd42436f2","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767814134823,"env":"test","module":"mfa-service","userId":"dbce7ce778d10e714d3a51ffd42436f2","msg":"Generated TOTP secret"}
{"level":30,"time":1767814134823,"env":"test","module":"auth-routes","userId":"dbce7ce778d10e714d3a51ffd42436f2","msg":"MFA setup initiated"}
{"level":30,"time":1767814134868,"env":"test","module":"user-credentials-repository","userId":"Bm0w4qjI9Or4O0Rhoq27v","msg":"User credentials created"}
{"level":30,"time":1767814134899,"env":"test","module":"user-credentials-repository","userId":"7PuanD2imOLxaDLLXkVFE","msg":"User credentials created"}
{"level":40,"time":1767814134936,"env":"test","module":"mfa-service","userId":"dbce7ce778d10e714d3a51ffd42436f2","msg":"Invalid TOTP token provided"}
{"level":30,"time":1767814134977,"env":"test","module":"email-queue","jobId":"2b7659f8-a5d4-45e5-94e3-070fcd8fe5a5","to":"test-1767814134478-0jhrn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814134983,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814135028,"env":"test","module":"auth-routes","userId":"Bm0w4qjI9Or4O0Rhoq27v","email":"test-1767814134478-0jhrn@example.com","msg":"User registered"}
{"level":30,"time":1767814135066,"env":"test","module":"user-credentials-repository","userId":"WVWu2czkekEvUqIV3deJw","msg":"User credentials created"}
{"level":40,"time":1767814135231,"env":"test","module":"auth-service","tokenHash":"38722c0ed7906c6069330f52e3566ee59d612455486c66c1245f928b70cb4bd7","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767814135238,"env":"test","module":"user-credentials-repository","userId":"73sAH_jcvhVERS0AWs17c","msg":"User credentials created"}
stdout | tests/integration/api.workflows.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/protected.routes.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/session.management.integration.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/auth.middleware.integration.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/api.workflows.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/auth/auth.middleware.integration.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/auth/protected.routes.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/auth/session.management.integration.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814135461,"env":"test","module":"auth-routes","userId":"a39f6d2b8f64ddea2e6b71841c76e904","msg":"User logged in successfully"}
stdout | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #8: Placeholder user cleanup > should cleanup placeholder user when invite is revoked
Cleaned up placeholder user 13c8bc32-8fcd-49b2-855e-379c1e80ec7c (no pending invites or memberships)

{"level":30,"time":1767814135516,"env":"test","module":"audit-log-service","userId":"a39f6d2b8f64ddea2e6b71841c76e904","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814135548,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814135561,"env":"test","module":"user-credentials-repository","userId":"Hx72D6LPgRLoACuPsTYYK","msg":"User credentials created"}
{"level":40,"time":1767814135659,"env":"test","module":"mfa-service","userId":"0e8e8eb7acebcd804c7e49cf7538d9ec","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814135659,"env":"test","module":"auth-routes","userId":"0e8e8eb7acebcd804c7e49cf7538d9ec","msg":"MFA verification failed during login"}
{"level":50,"time":1767814135663,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814135671,"env":"test","module":"user-credentials-repository","userId":"GRfh5SdjFnCIiuY1RmWEq","msg":"User credentials created"}
{"level":40,"time":1767814135702,"env":"test","module":"ai-service","attempt":3,"waitMs":8000,"msg":"Rate limit hit, retrying..."}
{"level":50,"time":1767814135768,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814135784,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/api.workflows.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth/auth.middleware.integration.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth/protected.routes.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth/session.management.integration.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":50,"time":1767814135894,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/integration/auth/auth.middleware.integration.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:184:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:164:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:126:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1767814135964,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814135984,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814135973,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814135973,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814135978,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814135983,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814135984,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814135984,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814135984,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stdout | tests/integration/auth/protected.routes.test.ts
ΓÜá∩╕Å Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1767814136121,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814136134,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814136139,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/api.workflows.test.ts > Workflows API Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814136128,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814136129,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814136133,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814136138,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814136139,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814136139,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814136139,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767814136152,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814136142,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814136142,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814136147,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814136151,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814136151,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814136151,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814136151,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767814136157,"env":"test","module":"user-credentials-repository","userId":"RggTiBSHkPqGZ1Hx2n3dp","msg":"User credentials created"}
{"level":50,"time":1767814136160,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814136185,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814136209,"env":"test","module":"user-credentials-repository","userId":"93_qgr3M6AhdHy2U8JwGZ","msg":"User credentials created"}
{"level":50,"time":1767814136276,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814136337,"env":"test","module":"user-credentials-repository","userId":"WhsqTVN4fNcZMXU6T06On","msg":"User credentials created"}
{"level":50,"time":1767814136386,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:70:7 {
  length: 336,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(339a3a51-164a-4b44-9053-5f845fdae64a) is still referenced from table "workflows".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflows',
  column: undefined,
  dataType: undefined,
  constraint: 'workflows_creator_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

stdout | tests/integration/organizations-audit-fixes.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814136447,"env":"test","module":"email-queue","jobId":"99d475ce-63b5-411f-bbf5-87c97e8d2036","to":"test-1767814135956-z83bis@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 Γ¥» tests/integration/organizations-audit-fixes.test.ts (8 tests | 1 failed) 8200ms
       Γ£ô should cascade ownership to workflow runs when project is transferred  1168ms
       Γ£ô should prevent double-acceptance via transaction  950ms
       Γ£ô should not create invite if email fails  526ms
       Γ£ô should allow re-invite after invite expires  1111ms
       Γ£ô should allow last admin to delete empty organization  627ms
       ├ù should prevent deletion if org owns assets 907ms
       Γ£ô should cleanup placeholder user when invite is revoked  1086ms
       Γ£ô should fail fast on non-existent org  480ms
{"level":40,"time":1767814136481,"env":"test","module":"auth-service","userId":"93_qgr3M6AhdHy2U8JwGZ","tokenHash":"b794e82f576077cf580cac07f40d6cca660ea2b014c6446ebb8be632fc06ae02","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1767814136485,"env":"test","module":"user-credentials-repository","userId":"DPiLah0ud-OZDCe8QsO-x","msg":"User credentials created"}
{"level":30,"time":1767814136501,"env":"test","module":"auth-routes","userId":"WhsqTVN4fNcZMXU6T06On","email":"test-1767814135956-z83bis@example.com","msg":"User registered"}
{"level":50,"time":1767814136534,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814136606,"env":"test","module":"user-credentials-repository","userId":"oWDWbYmV_soGP3rDaEMsL","msg":"User credentials created"}
{"level":30,"time":1767814136611,"env":"test","module":"user-credentials-repository","userId":"FG9J5BXkN7dHtQn_kteLm","msg":"User credentials created"}
{"level":30,"time":1767814136625,"env":"test","module":"user-credentials-repository","userId":"Dz6ohgk7uvVe7NJJ0R_Ng","msg":"User credentials created"}
{"level":30,"time":1767814136708,"env":"test","module":"email-queue","jobId":"de35e0e4-a448-4383-ac99-c18026ac7461","to":"test-h5WJnbb8rRxW5tUFQlM-v@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814136711,"env":"test","module":"email-queue","jobId":"48b34065-21fe-491b-8acf-5eb9c11656a1","to":"test-ZHxZHncgEMA-o2kymbzZO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814136721,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814136734,"env":"test","module":"email-queue","jobId":"5647d802-e65f-4feb-aae6-91533f31d5ff","to":"test-GoP36-Tb9TqWMqjZLhGep@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814136744,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814136731,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814136731,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814136737,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814136743,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814136743,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814136744,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814136744,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767814136763,"env":"test","module":"auth-routes","userId":"oWDWbYmV_soGP3rDaEMsL","email":"test-h5WJnbb8rRxW5tUFQlM-v@example.com","msg":"User registered"}
{"level":30,"time":1767814136769,"env":"test","module":"auth-routes","userId":"FG9J5BXkN7dHtQn_kteLm","email":"test-ZHxZHncgEMA-o2kymbzZO@example.com","msg":"User registered"}
{"level":30,"time":1767814136795,"env":"test","module":"auth-routes","userId":"Dz6ohgk7uvVe7NJJ0R_Ng","email":"test-GoP36-Tb9TqWMqjZLhGep@example.com","msg":"User registered"}
{"level":50,"time":1767814136798,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814136807,"env":"test","module":"auth-routes","userId":"DPiLah0ud-OZDCe8QsO-x","msg":"All other sessions revoked"}
{"level":30,"time":1767814136865,"env":"test","module":"audit-log-service","userId":"DPiLah0ud-OZDCe8QsO-x","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767814136888,"env":"test","module":"user-credentials-repository","userId":"HHlXQP8RgdP6NB-ibIjiQ","msg":"User credentials created"}
stdout | tests/unit/services/AuthService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":50,"time":1767814136954,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814137277,"env":"test","module":"user-credentials-repository","userId":"jSGz4XvZHBkS_YhoccYaP","msg":"User credentials created"}
{"level":30,"time":1767814137278,"env":"test","module":"user-credentials-repository","userId":"4URTUamBXgrJTJ958HSKP","msg":"User credentials created"}
{"level":50,"time":1767814137323,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814137341,"env":"test","module":"user-credentials-repository","userId":"YSkGqgf68Sqam5cbSVqT4","msg":"User credentials created"}
{"level":30,"time":1767814137341,"env":"test","module":"user-credentials-repository","userId":"eTtJni98mDlHvqbP1_JLQ","msg":"User credentials created"}
{"level":30,"time":1767814137383,"env":"test","module":"email-queue","jobId":"f542bfea-6e69-4fe8-8de9-0f5215270ede","to":"session-test-bTcDeMPTUwYCNyiUq0bJD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814137436,"env":"test","module":"auth-routes","userId":"jSGz4XvZHBkS_YhoccYaP","email":"session-test-bTcDeMPTUwYCNyiUq0bJD@example.com","msg":"User registered"}
stdout | tests/integration/datavault.autonumber.test.ts > DataVault Autonumber Integration Tests
Error cleaning up table: Error: Table not found
    at DatavaultTablesService.verifyTenantOwnership (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:150:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablesService.deleteTable (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:290:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/datavault.autonumber.test.ts:90:9

stdout | tests/integration/datavault.autonumber.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814137445,"env":"test","module":"email-queue","jobId":"81d5c213-f9de-4ccb-9aa3-b3b7ca10457f","to":"test-fgGRVy4oompfItOEOdGPW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814137446,"env":"test","module":"email-queue","jobId":"d667ede5-6262-4c91-b955-f2a0142a6ee6","to":"middleware-test-kGRI2GINmEBtZPv-nhOzu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814137485,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 Γ£ô tests/integration/datavault.autonumber.test.ts (5 tests) 9159ms
     Γ£ô should generate basic autonumber without prefix  1169ms
     Γ£ô should generate autonumber with prefix  1176ms
     Γ£ô should generate autonumber with yearly reset format  1159ms
     Γ£ô should be atomic and prevent race conditions  776ms
     Γ£ô should prevent manual updates to autonumber values  1533ms
{"level":50,"time":1767814137492,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814137492,"env":"test","module":"auth-routes","userId":"4URTUamBXgrJTJ958HSKP","msg":"All other sessions revoked"}
{"level":30,"time":1767814137495,"env":"test","module":"auth-routes","userId":"eTtJni98mDlHvqbP1_JLQ","email":"middleware-test-kGRI2GINmEBtZPv-nhOzu@example.com","msg":"User registered"}
{"level":30,"time":1767814137503,"env":"test","module":"auth-routes","userId":"YSkGqgf68Sqam5cbSVqT4","email":"test-fgGRVy4oompfItOEOdGPW@example.com","msg":"User registered"}
{"level":30,"time":1767814137509,"env":"test","module":"user-credentials-repository","userId":"s_EDFRPPM4xdFLBKhpmfb","msg":"User credentials created"}
{"level":30,"time":1767814137544,"env":"test","module":"audit-log-service","userId":"4URTUamBXgrJTJ958HSKP","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":50,"time":1767814137601,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814137697,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814137702,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767814137708,"env":"test","module":"mfa-service","userId":"ff6c4463bec6008582d2872e8e9e0e87","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814137708,"env":"test","module":"auth-routes","userId":"ff6c4463bec6008582d2872e8e9e0e87","msg":"MFA verification failed during login"}
{"level":50,"time":1767814137714,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767814137755,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stderr | tests/unit/services/AuthService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

{"level":50,"time":1767814137815,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/unit/middleware/auth.middleware.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

{"level":30,"time":1767814137934,"env":"test","module":"user-credentials-repository","userId":"9t3uvCsY-iFoSK6COmZZW","msg":"User credentials created"}
{"level":50,"time":1767814137986,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814138039,"env":"test","module":"auth-routes","userId":"eTtJni98mDlHvqbP1_JLQ","msg":"User logged in successfully"}
{"level":30,"time":1767814138059,"env":"test","module":"user-credentials-repository","userId":"4IsYJ_WQFz9jZG8vXajng","msg":"User credentials created"}
{"level":40,"time":1767814138092,"env":"test","module":"mfa-service","userId":"ff6c4463bec6008582d2872e8e9e0e87","msg":"No enabled MFA secret found for user"}
{"level":30,"time":1767814138092,"env":"test","module":"audit-log-service","userId":"eTtJni98mDlHvqbP1_JLQ","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767814138092,"env":"test","module":"auth-routes","userId":"ff6c4463bec6008582d2872e8e9e0e87","msg":"MFA verification failed during login"}
{"level":50,"time":1767814138095,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814138129,"env":"test","module":"user-credentials-repository","userId":"SDjPqFWR-D4ljDiL2IS--","msg":"User credentials created"}
{"level":30,"time":1767814138162,"env":"test","module":"email-queue","jobId":"99e5ade9-bdb8-49b4-ac2d-98343835c1da","to":"protected-test-K6h9Kfo1LVnBTblvTGFNP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814138170,"env":"test","module":"auth-routes","userId":"ad8498721cc39a1ceb3f0b69f51536db","msg":"User logged in successfully"}
{"level":30,"time":1767814138204,"env":"test","module":"auth-routes","userId":"d9a612bf0528679699a0a0855814bfe7","msg":"User logged in successfully"}
{"level":30,"time":1767814138214,"env":"test","module":"auth-routes","userId":"4IsYJ_WQFz9jZG8vXajng","email":"protected-test-K6h9Kfo1LVnBTblvTGFNP@example.com","msg":"User registered"}
{"level":30,"time":1767814138216,"env":"test","module":"user-credentials-repository","userId":"Ag_kb65plNLzuIgVslNso","msg":"User credentials created"}
{"level":30,"time":1767814138223,"env":"test","module":"audit-log-service","userId":"ad8498721cc39a1ceb3f0b69f51536db","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814138253,"env":"test","module":"audit-log-service","userId":"d9a612bf0528679699a0a0855814bfe7","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814138267,"env":"test","module":"user-credentials-repository","userId":"LzFru70zFX4WGPzYK0pR0","msg":"User credentials created"}
{"level":50,"time":1767814138270,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814138317,"env":"test","module":"email-queue","jobId":"190b366b-a046-4f19-aa9a-c0243972c702","to":"session-test-gtQXATCiJ6y9C_hInElgj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814138357,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814138370,"env":"test","module":"auth-routes","userId":"Ag_kb65plNLzuIgVslNso","email":"session-test-gtQXATCiJ6y9C_hInElgj@example.com","msg":"User registered"}
stdout | tests/unit/middleware/auth.middleware.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

{"level":40,"time":1767814138469,"env":"test","module":"mfa-service","userId":"ff6c4463bec6008582d2872e8e9e0e87","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814138469,"env":"test","module":"auth-routes","userId":"ff6c4463bec6008582d2872e8e9e0e87","msg":"MFA verification failed during login"}
{"level":50,"time":1767814138473,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814138527,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814138589,"env":"test","module":"user-credentials-repository","userId":"DnWOcires0M-z1YCsZkBM","msg":"User credentials created"}
{"level":30,"time":1767814138609,"env":"test","module":"user-credentials-repository","userId":"5__D4cL3VRau-Clfuf1sT","msg":"User credentials created"}
{"level":30,"time":1767814138694,"env":"test","module":"email-queue","jobId":"c5fad514-85c4-4baa-9fb2-f399468d2537","to":"middleware-test-_vJf2AebLPJDA48AOsEho@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814138712,"env":"test","module":"auth-routes","userId":"5__D4cL3VRau-Clfuf1sT","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":40,"time":1767814138721,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814138722,"env":"test","module":"user-credentials-repository","userId":"v71P2oSpZS4C8UGBzIXiU","msg":"User credentials created"}
{"level":30,"time":1767814138746,"env":"test","module":"auth-routes","userId":"DnWOcires0M-z1YCsZkBM","email":"middleware-test-_vJf2AebLPJDA48AOsEho@example.com","msg":"User registered"}
{"level":30,"time":1767814138762,"env":"test","module":"mfa-service","userId":"ad8498721cc39a1ceb3f0b69f51536db","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767814138762,"env":"test","module":"mfa-service","userId":"ad8498721cc39a1ceb3f0b69f51536db","msg":"Generated TOTP secret"}
{"level":30,"time":1767814138762,"env":"test","module":"auth-routes","userId":"ad8498721cc39a1ceb3f0b69f51536db","msg":"MFA setup initiated"}
stdout | tests/unit/middleware/auth.middleware.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814138807,"env":"test","module":"auth-routes","userId":"5dc135c4e2953a09bb98aaf7ee6c9ed4","msg":"User logged in successfully"}
stdout | tests/unit/middleware/auth.middleware.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814138858,"env":"test","module":"audit-log-service","userId":"5dc135c4e2953a09bb98aaf7ee6c9ed4","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814138905,"env":"test","module":"user-credentials-repository","userId":"Qu2obVfKLL63MVyBnYxBf","msg":"User credentials created"}
{"level":30,"time":1767814138970,"env":"test","module":"auth-routes","userId":"Ag_kb65plNLzuIgVslNso","msg":"User logged in successfully"}
{"level":30,"time":1767814139008,"env":"test","module":"email-queue","jobId":"5efcc240-0fb1-4a1c-95d1-332067737548","to":"protected-test-5jUrwi_O6hiIEZIrgLgSS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814139021,"env":"test","module":"audit-log-service","userId":"Ag_kb65plNLzuIgVslNso","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814139046,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814139058,"env":"test","module":"auth-routes","userId":"Qu2obVfKLL63MVyBnYxBf","email":"protected-test-5jUrwi_O6hiIEZIrgLgSS@example.com","msg":"User registered"}
{"level":50,"time":1767814139064,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814139085,"env":"test","module":"user-credentials-repository","userId":"6up19jbI089IcBZ6qSWKh","msg":"User credentials created"}
{"level":50,"time":1767814139156,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814139195,"env":"test","module":"auth-routes","userId":"6up19jbI089IcBZ6qSWKh","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
stderr | tests/unit/middleware/auth.middleware.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814139353,"env":"test","module":"mfa-service","userId":"5dc135c4e2953a09bb98aaf7ee6c9ed4","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767814139353,"env":"test","module":"auth-routes","userId":"6up19jbI089IcBZ6qSWKh","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Trusted device expiry updated"}
{"level":30,"time":1767814139353,"env":"test","module":"mfa-service","userId":"5dc135c4e2953a09bb98aaf7ee6c9ed4","msg":"Generated TOTP secret"}
{"level":30,"time":1767814139353,"env":"test","module":"auth-routes","userId":"5dc135c4e2953a09bb98aaf7ee6c9ed4","msg":"MFA setup initiated"}
{"level":50,"time":1767814139362,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814139381,"env":"test","module":"user-credentials-repository","userId":"PHJBrLHpurDUXIF1R7mxZ","msg":"User credentials created"}
{"level":50,"time":1767814139415,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814139452,"env":"test","module":"user-credentials-repository","userId":"9yZBgD9GlmamvBe3F47Ud","msg":"User credentials created"}
{"level":30,"time":1767814139464,"env":"test","module":"user-credentials-repository","userId":"8qvbaIHvpEGTZf4djzvKd","msg":"User credentials created"}
{"level":30,"time":1767814139555,"env":"test","module":"email-queue","jobId":"bd5352f7-6c36-4efa-a405-63ce958f983f","to":"middleware-test-AsVBvcvhy5l9PP8DV_Bim@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814139570,"env":"test","module":"email-queue","jobId":"349183bc-4626-41d1-8f1d-d71e66bcf0e6","to":"session-test-uh34LnhxWLvQhi6NXfzH5@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814139608,"env":"test","module":"auth-routes","userId":"9yZBgD9GlmamvBe3F47Ud","email":"middleware-test-AsVBvcvhy5l9PP8DV_Bim@example.com","msg":"User registered"}
{"level":30,"time":1767814139624,"env":"test","module":"auth-routes","userId":"8qvbaIHvpEGTZf4djzvKd","email":"session-test-uh34LnhxWLvQhi6NXfzH5@example.com","msg":"User registered"}
{"level":50,"time":1767814139679,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814139682,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814139728,"env":"test","module":"user-credentials-repository","userId":"f4XiB7SDS8nFwDiXm2wWl","msg":"User credentials created"}
{"level":30,"time":1767814139740,"env":"test","module":"user-credentials-repository","userId":"5BcxEbfITA20zitGVxds1","msg":"User credentials created"}
{"level":50,"time":1767814139836,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814139837,"env":"test","module":"auth-routes","userId":"f4XiB7SDS8nFwDiXm2wWl","deviceCount":2,"msg":"Listed trusted devices"}
{"level":30,"time":1767814139843,"env":"test","module":"email-queue","jobId":"4706793b-cf3c-4321-abd9-594e59ebb6d8","to":"protected-test-gL2RDN3e2lB-ilVpeaC-a@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814139859,"env":"test","module":"user-credentials-repository","userId":"z_2PEPwzT5uNrERnWssGb","msg":"User credentials created"}
{"level":30,"time":1767814139893,"env":"test","module":"auth-routes","userId":"5BcxEbfITA20zitGVxds1","email":"protected-test-gL2RDN3e2lB-ilVpeaC-a@example.com","msg":"User registered"}
{"level":50,"time":1767814139921,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814139946,"env":"test","module":"mfa-service","userId":"2375cad10815e5292b4748973907b7e9","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814139946,"env":"test","module":"auth-routes","userId":"2375cad10815e5292b4748973907b7e9","msg":"MFA verification failed during login"}
{"level":50,"time":1767814139949,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767814139951,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
{"level":50,"time":1767814139952,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814139983,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814140119,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814140134,"env":"test","module":"auth-routes","userId":"9yZBgD9GlmamvBe3F47Ud","msg":"User logged in successfully"}
{"level":30,"time":1767814140135,"env":"test","module":"auth-routes","userId":"b7ee156b2d03332b0a022b262bbb07bd","msg":"User logged in successfully"}
{"level":30,"time":1767814140161,"env":"test","module":"user-credentials-repository","userId":"xRHMBIsFhPufELLvX4uBT","msg":"User credentials created"}
{"level":30,"time":1767814140186,"env":"test","module":"audit-log-service","userId":"9yZBgD9GlmamvBe3F47Ud","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814140186,"env":"test","module":"audit-log-service","userId":"b7ee156b2d03332b0a022b262bbb07bd","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814140191,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814140197,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814140243,"env":"test","module":"user-credentials-repository","userId":"qbLtkJMvHIWpqNr6-zNCc","msg":"User credentials created"}
{"level":30,"time":1767814140269,"env":"test","module":"auth-routes","userId":"xRHMBIsFhPufELLvX4uBT","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1767814140364,"env":"test","module":"user-credentials-repository","userId":"4ahDxYrXzEmk51JVTk7cD","msg":"User credentials created"}
{"level":30,"time":1767814140468,"env":"test","module":"email-queue","jobId":"2029923b-4fb3-465d-b27e-172df02e9c9e","to":"session-test-dsHqyl4jSyVhxmD5M7dOk@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814140526,"env":"test","module":"auth-routes","userId":"4ahDxYrXzEmk51JVTk7cD","email":"session-test-dsHqyl4jSyVhxmD5M7dOk@example.com","msg":"User registered"}
{"level":30,"time":1767814140588,"env":"test","module":"user-credentials-repository","userId":"1eJvzcsllL0lcmuBy9TPE","msg":"User credentials created"}
{"level":30,"time":1767814140601,"env":"test","module":"user-credentials-repository","userId":"J3AqSV-oTcLorZF2JsRjW","msg":"User credentials created"}
{"level":30,"time":1767814140612,"env":"test","module":"user-credentials-repository","userId":"060iuvT4GgmjAkU1Ja0Vr","msg":"User credentials created"}
{"level":30,"time":1767814140685,"env":"test","module":"email-queue","jobId":"44c32b39-3f59-4c93-8afa-ed379defbb3d","to":"middleware-test-UoHOeNplXovpO9pkqqCaE@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814140691,"env":"test","module":"mfa-service","userId":"b7ee156b2d03332b0a022b262bbb07bd","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767814140691,"env":"test","module":"mfa-service","userId":"b7ee156b2d03332b0a022b262bbb07bd","msg":"Generated TOTP secret"}
{"level":30,"time":1767814140692,"env":"test","module":"auth-routes","userId":"b7ee156b2d03332b0a022b262bbb07bd","msg":"MFA setup initiated"}
{"level":30,"time":1767814140713,"env":"test","module":"email-queue","jobId":"ffa03e0a-dc96-4b07-80d6-8469a00f3ded","to":"protected-test-yKA473YdozfViN8qiv7Tc@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814140736,"env":"test","module":"auth-routes","userId":"1eJvzcsllL0lcmuBy9TPE","email":"middleware-test-UoHOeNplXovpO9pkqqCaE@example.com","msg":"User registered"}
{"level":30,"time":1767814140765,"env":"test","module":"auth-routes","userId":"J3AqSV-oTcLorZF2JsRjW","email":"protected-test-yKA473YdozfViN8qiv7Tc@example.com","msg":"User registered"}
{"level":50,"time":1767814140772,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814140773,"env":"test","module":"auth-routes","userId":"060iuvT4GgmjAkU1Ja0Vr","deviceId":"6caf6ba5-62e8-4c64-a3e4-66b975c7b1f9","msg":"Trusted device revoked"}
{"level":30,"time":1767814140797,"env":"test","module":"user-credentials-repository","userId":"FmlN2EO52FW1sHf7CRLwn","msg":"User credentials created"}
{"level":50,"time":1767814140895,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814140903,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814141038,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814141063,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814141155,"env":"test","module":"user-credentials-repository","userId":"6LXdrcssxwkvLcvMTHZdg","msg":"User credentials created"}
{"level":30,"time":1767814141276,"env":"test","module":"user-credentials-repository","userId":"3q1laRUN0td4gM2LGtzjM","msg":"User credentials created"}
{"level":50,"time":1767814141346,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814141380,"env":"test","module":"email-queue","jobId":"73ad06ab-c7de-46bc-84a5-0c95b61c3c76","to":"session-test-pBjTsLOFtgkwmLM_atSP8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814141386,"env":"test","module":"user-credentials-repository","userId":"ONrFxKnsKy-V5Pi2yNbDM","msg":"User credentials created"}
{"level":30,"time":1767814141395,"env":"test","module":"auth-routes","userId":"90d230ccda67b601228e3346a42216e1","msg":"User logged in successfully"}
{"level":30,"time":1767814141423,"env":"test","module":"user-credentials-repository","userId":"QRMIjuEmvudGuI23M0gUJ","msg":"User credentials created"}
{"level":30,"time":1767814141434,"env":"test","module":"auth-routes","userId":"3q1laRUN0td4gM2LGtzjM","email":"session-test-pBjTsLOFtgkwmLM_atSP8@example.com","msg":"User registered"}
{"level":30,"time":1767814141446,"env":"test","module":"user-credentials-repository","userId":"g-gaJ4ZOp1ygFEWNcprvn","msg":"User credentials created"}
{"level":30,"time":1767814141448,"env":"test","module":"audit-log-service","userId":"90d230ccda67b601228e3346a42216e1","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767814141452,"env":"test","module":"mfa-service","userId":"e6054a51f019376c83078492ee48ebd0","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814141452,"env":"test","module":"auth-routes","userId":"e6054a51f019376c83078492ee48ebd0","msg":"MFA verification failed during login"}
{"level":50,"time":1767814141458,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814141510,"env":"test","module":"user-credentials-repository","userId":"SIX2dsC2sl_uCHsYIi3xX","msg":"User credentials created"}
{"level":50,"time":1767814141511,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814141520,"env":"test","module":"email-queue","jobId":"60b50ec7-9fda-4e3d-bc70-beeb7507f2a1","to":"middleware-test-XEsIF8LDtY0QxISHx8Usj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814141547,"env":"test","module":"email-queue","jobId":"19b5cba8-7423-4d01-81cd-a2c93ee5e408","to":"protected-test-kBQwOZWlu3d7JXmESAKr0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814141575,"env":"test","module":"auth-routes","userId":"QRMIjuEmvudGuI23M0gUJ","email":"middleware-test-XEsIF8LDtY0QxISHx8Usj@example.com","msg":"User registered"}
{"level":30,"time":1767814141598,"env":"test","module":"auth-routes","userId":"g-gaJ4ZOp1ygFEWNcprvn","email":"protected-test-kBQwOZWlu3d7JXmESAKr0@example.com","msg":"User registered"}
{"level":50,"time":1767814141721,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814141725,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814141806,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814141825,"env":"test","module":"email-queue","jobId":"67e57a40-b95b-4b0d-9c72-2363643541ff","to":"test-1767814141202-0h74k@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814141826,"env":"test","module":"auth-service","email":"test-1767814141202-0h74k@example.com","msg":"Password reset email sent"}
{"level":50,"time":1767814141873,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814141903,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814141935,"env":"test","module":"user-credentials-repository","userId":"CMiT2YEahwgFU5ghrVX0w","msg":"User credentials created"}
{"level":30,"time":1767814142113,"env":"test","module":"user-credentials-repository","userId":"uu5F7P5Jvo7tbpq3Z3V2h","msg":"User credentials created"}
{"level":30,"time":1767814142136,"env":"test","module":"email-queue","jobId":"ebcf70e5-93da-4930-99d2-9b3c380234df","to":"test-1767814141202-0h74k@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814142136,"env":"test","module":"auth-service","email":"test-1767814141202-0h74k@example.com","msg":"Password reset email sent"}
{"level":50,"time":1767814142160,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814142196,"env":"test","module":"user-credentials-repository","userId":"D4TLlV3PgcHUMC12HzyRY","msg":"User credentials created"}
{"level":30,"time":1767814142215,"env":"test","module":"email-queue","jobId":"c8639441-7634-44a8-9983-8e522eecfc74","to":"test-1767814141732-uq9p6t@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814142252,"env":"test","module":"user-credentials-repository","userId":"zobAcdJfFUYs4pIZRp8an","msg":"User credentials created"}
{"level":30,"time":1767814142263,"env":"test","module":"auth-routes","userId":"uu5F7P5Jvo7tbpq3Z3V2h","email":"test-1767814141732-uq9p6t@example.com","msg":"User registered"}
{"level":30,"time":1767814142275,"env":"test","module":"user-credentials-repository","userId":"X4ZPM_7DMExQyH3gAx57I","msg":"User credentials created"}
{"level":30,"time":1767814142300,"env":"test","module":"email-queue","jobId":"f51c672b-bc6c-4582-9a11-7f5905b85d26","to":"session-test-Uf-uLVlDkLnu3o2bogEmT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814142355,"env":"test","module":"auth-routes","userId":"D4TLlV3PgcHUMC12HzyRY","email":"session-test-Uf-uLVlDkLnu3o2bogEmT@example.com","msg":"User registered"}
{"level":30,"time":1767814142356,"env":"test","module":"email-queue","jobId":"f43f886d-12f1-4cea-8e62-f81ba0653349","to":"middleware-test-YKDWs9NKJHXTa4L4y-9Ky@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814142376,"env":"test","module":"email-queue","jobId":"8f9bd727-b5b2-416b-8637-da79a90036f2","to":"protected-test-N8F4fL1cVDbkUXEkLUTyY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814142378,"env":"test","module":"user-credentials-repository","userId":"pm7LKqyQ5UmaHC57RfddY","msg":"User credentials created"}
{"level":30,"time":1767814142403,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767814142407,"env":"test","module":"auth-routes","userId":"zobAcdJfFUYs4pIZRp8an","email":"middleware-test-YKDWs9NKJHXTa4L4y-9Ky@example.com","msg":"User registered"}
{"level":30,"time":1767814142405,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":40,"time":1767814142423,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used"}
stdout | tests/unit/server/transferOwnership.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814142431,"env":"test","module":"auth-routes","userId":"X4ZPM_7DMExQyH3gAx57I","email":"protected-test-N8F4fL1cVDbkUXEkLUTyY@example.com","msg":"User registered"}
{"level":40,"time":1767814142424,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1767814142426,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1767814142429,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767814142430,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767814142431,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767814142432,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
 Γ¥» tests/unit/server/transferOwnership.test.ts (11 tests | 3 failed) 14091ms
       Γ£ô should transfer user-owned project to org  1633ms
       Γ£ô should prevent transfer to org if user is not a member  1208ms
       ├ù should allow org member to transfer org-owned project to another org they belong to 1160ms
       Γ£ô should detach workflow from project when transferring to different owner  1360ms
       ├ù should keep workflow in project when transferring to same owner 1394ms
       Γ£ô should prevent non-member from transferring org workflow  1313ms
       Γ£ô should transfer database ownership  996ms
       Γ£ô should allow org member to transfer org database  1098ms
       Γ£ô should prevent transfer to org if user is not a member  1373ms
       Γ£ô should only allow transfer to self when targetOwnerType is user  869ms
       ├ù should allow transfer from user to self (org member transferring org asset to themselves) 820ms
{"level":50,"time":1767814142525,"env":"test","module":"user-credentials-repository","error":{},"userId":"b803f271d1e9af0adf258f2a89f59f42","msg":"Failed to update user password"}
{"level":50,"time":1767814142525,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":50,"time":1767814142538,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814142642,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"FG9J5BXkN7dHtQn_kteLm","msg":"Error creating workflow"}
{"level":40,"time":1767814142643,"env":"test","module":"auth-service","tokenHash":"8195cff0e0eede6897ed8c0d97652eb79e50b62bdb96f5438996bf2988deee84","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1767814142718,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814142726,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814142731,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814142743,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/auth/oauth2.sessions.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814142780,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/api.templates-runs.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1767814142851,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"FG9J5BXkN7dHtQn_kteLm","msg":"Error creating workflow"}
 Γ¥» tests/integration/auth/oauth2.sessions.test.ts (25 tests | 7 failed) 12729ms
       Γ£ô should list all active sessions for current user  549ms
       Γ£ô should mark current session as current  451ms
       Γ£ô should return empty array when user has no active sessions  450ms
       Γ£ô should not include expired sessions  466ms
       Γ£ô should not include revoked sessions  481ms
       Γ£ô should parse device name from user agent  474ms
       Γ£ô should return 401 for unauthenticated request  344ms
       ├ù should revoke a specific session 438ms
       Γ£ô should return 404 for non-existent session  338ms
       ├ù should prevent revoking current session 446ms
       ├ù should prevent revoking another user's session 474ms
       Γ£ô should return 401 for unauthenticated request  336ms
       ├ù should revoke all sessions except current 764ms
       Γ£ô should revoke all trusted devices  676ms
       Γ£ô should return 400 when no active session found  336ms
       Γ£ô should return 401 for unauthenticated request  333ms
         Γ£ô should mark current device as trusted  496ms
         Γ£ô should update existing trusted device expiry  641ms
         Γ£ô should list all trusted devices  431ms
         Γ£ô should not include revoked devices  431ms
         Γ£ô should revoke a trusted device  562ms
         Γ£ô should return 404 for non-existent device  328ms
       ├ù should track IP address for sessions 454ms
       ├ù should track user agent for sessions 432ms
       ├ù should update lastUsedAt on token refresh 653ms
{"level":50,"time":1767814142899,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814143006,"env":"test","module":"mfa-service","userId":"dff7bac0c75fe6fa5aa247c750272de6","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814143006,"env":"test","module":"auth-routes","userId":"dff7bac0c75fe6fa5aa247c750272de6","msg":"MFA verification failed during login"}
{"level":50,"time":1767814143011,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814143058,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"FG9J5BXkN7dHtQn_kteLm","msg":"Error creating workflow"}
{"level":50,"time":1767814143067,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814143123,"env":"test","module":"user-credentials-repository","userId":"jhqoot5jEN9ETmlMq04kC","msg":"User credentials created"}
{"level":30,"time":1767814143124,"env":"test","module":"user-credentials-repository","userId":"fymp3ZdqIXFPokpD5vR7V","msg":"User credentials created"}
{"level":30,"time":1767814143143,"env":"test","module":"user-credentials-repository","userId":"lil0GjPBzcFuWB8iVSAyV","msg":"User credentials created"}
{"level":30,"time":1767814143226,"env":"test","module":"email-queue","jobId":"1ef1b63c-53b8-49f8-8f64-97e2d0da59e7","to":"middleware-test-CQH7CGFxOmRkq4ObE9MCf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814143227,"env":"test","module":"email-queue","jobId":"91ca80c0-d0b0-4d93-95d4-8c4c4b9e0ac2","to":"session-test-WjYpXMOrpRiXLkxai5ruQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814143242,"env":"test","module":"email-queue","jobId":"369049af-9677-4562-83aa-98e74486d51f","to":"protected-test-PxGBTa_2qn5v9ZVmGFVMp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814143257,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"FG9J5BXkN7dHtQn_kteLm","msg":"Error creating workflow"}
{"level":30,"time":1767814143279,"env":"test","module":"auth-routes","userId":"jhqoot5jEN9ETmlMq04kC","email":"middleware-test-CQH7CGFxOmRkq4ObE9MCf@example.com","msg":"User registered"}
{"level":30,"time":1767814143280,"env":"test","module":"auth-routes","userId":"fymp3ZdqIXFPokpD5vR7V","email":"session-test-WjYpXMOrpRiXLkxai5ruQ@example.com","msg":"User registered"}
stdout | tests/integration/auth/jwt.authentication.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767814143298,"env":"test","module":"auth-routes","userId":"lil0GjPBzcFuWB8iVSAyV","email":"protected-test-PxGBTa_2qn5v9ZVmGFVMp@example.com","msg":"User registered"}
{"level":50,"time":1767814143470,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"FG9J5BXkN7dHtQn_kteLm","msg":"Error creating workflow"}
{"level":50,"time":1767814143539,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814143581,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814143589,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814143598,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814143647,"env":"test","module":"mfa-service","userId":"86b38e49a962e942915565d481b92a4d","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814143647,"env":"test","module":"auth-routes","userId":"86b38e49a962e942915565d481b92a4d","msg":"MFA verification failed during login"}
stdout | tests/integration/api.templates-runs.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

{"level":50,"time":1767814143673,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814143682,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"FG9J5BXkN7dHtQn_kteLm","msg":"Error creating workflow"}
{"level":40,"time":1767814143703,"env":"test","module":"ai-service","attempt":4,"waitMs":16000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767814143806,"env":"test","module":"email-queue","jobId":"e3ebf59a-e8d6-4276-9faa-bcd9ccd7eebb","to":"test-1767814142939-6z3ggk@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814143806,"env":"test","module":"auth-service","email":"test-1767814142939-6z3ggk@example.com","msg":"Password reset email sent"}
{"level":50,"time":1767814143888,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"FG9J5BXkN7dHtQn_kteLm","msg":"Error creating workflow"}
{"level":30,"time":1767814143969,"env":"test","module":"user-credentials-repository","userId":"kAGj-FeKVrddyhQ4NNAH-","msg":"User credentials created"}
{"level":30,"time":1767814143984,"env":"test","module":"user-credentials-repository","userId":"-RbRfT-dLPBh_73s6Y6rE","msg":"User credentials created"}
{"level":40,"time":1767814144002,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814144060,"env":"test","module":"user-credentials-repository","userId":"DBZx94C-dvop-LexzDPMF","msg":"User credentials created"}
{"level":30,"time":1767814144081,"env":"test","module":"email-queue","jobId":"57104432-0654-421e-8c07-db83a6d8e6ab","to":"protected-test-3RyjBBWyzFbOf5Bj3gqKa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814144081,"env":"test","module":"email-queue","jobId":"47d44619-56cb-4095-8df5-e67cf1054d94","to":"middleware-test-gnL1wrFdLj1U5oBUzt53j@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814144087,"env":"test","module":"auth-routes","userId":"bfa50faf21978ecdb71d2a96eff09cbd","msg":"User logged in successfully"}
{"level":50,"time":1767814144100,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"FG9J5BXkN7dHtQn_kteLm","msg":"Error creating workflow"}
stdout | tests/integration/auth/jwt.authentication.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767814144132,"env":"test","module":"auth-routes","userId":"kAGj-FeKVrddyhQ4NNAH-","email":"middleware-test-gnL1wrFdLj1U5oBUzt53j@example.com","msg":"User registered"}
{"level":30,"time":1767814144133,"env":"test","module":"auth-routes","userId":"-RbRfT-dLPBh_73s6Y6rE","email":"protected-test-3RyjBBWyzFbOf5Bj3gqKa@example.com","msg":"User registered"}
{"level":30,"time":1767814144141,"env":"test","module":"audit-log-service","userId":"bfa50faf21978ecdb71d2a96eff09cbd","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:29:5 {
  length: 361,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(FG9J5BXkN7dHtQn_kteLm) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

stdout | tests/integration/api.workflows.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814144174,"env":"test","module":"email-queue","jobId":"6f065379-06a6-4ba9-b93b-d983c1720ef3","to":"session-test-MO1IfkrC3na4MDQFYSPQa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814144197,"env":"test","module":"user-credentials-repository","error":{},"userId":"01cdf5584701e499b09378f7889ed37c","msg":"Failed to update user password"}
{"level":50,"time":1767814144197,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":50,"time":1767814144201,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814144228,"env":"test","module":"auth-routes","userId":"DBZx94C-dvop-LexzDPMF","email":"session-test-MO1IfkrC3na4MDQFYSPQa@example.com","msg":"User registered"}
{"level":50,"time":1767814144267,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814144272,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":50,"time":1767814144337,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814144356,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814144357,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814144357,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814144358,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814144359,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 Γ¥» tests/integration/api.workflows.test.ts (17 tests | 9 failed) 8801ms
       Γ£ô should create a new draft workflow  375ms
       ├ù should reject without permission 10ms
       Γ£ô should list workflows  540ms
       Γ£ô should filter by status  514ms
       Γ£ô should search by name  883ms
       Γ£ô should update draft workflow  670ms
       Γ£ô should not allow editing published workflow  833ms
       Γ£ô should publish workflow  751ms
       Γ£ô should list workflow versions  913ms
       ├ù should move workflow to a project 214ms
       ├ù should move workflow to Main Folder (projectId = null) 209ms
       ├ù should reject move to non-existent project 207ms
       ├ù should reject move without authentication 199ms
       ├ù should reject move of workflow user does not own 213ms
       ├ù should reject move with invalid projectId format 212ms
       ├ù should reject move without projectId in body 206ms
       ├ù should reject move to project user does not have access to 212ms
{"level":50,"time":1767814144439,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814144439,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814144473,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814144493,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814144595,"env":"test","module":"mfa-service","userId":"d3f886dfda060c11691999f9893b5605","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814144595,"env":"test","module":"auth-routes","userId":"d3f886dfda060c11691999f9893b5605","msg":"MFA verification failed during login"}
{"level":50,"time":1767814144599,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814144603,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814144734,"env":"test","module":"user-credentials-repository","userId":"lSnOKatR0GP2v5QycGlHx","msg":"User credentials created"}
{"level":30,"time":1767814144754,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767814144842,"env":"test","module":"email-queue","jobId":"a8c814ac-f634-45d5-b5e1-0d1ad29ca686","to":"session-test-B5aB72vuDyI3B4hiLJx-P@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814144853,"env":"test","module":"user-credentials-repository","userId":"QVpmzKc336bHMXo2PrwRo","msg":"User credentials created"}
{"level":30,"time":1767814144858,"env":"test","module":"user-credentials-repository","userId":"GLPAIoFx5ZGDf52wDKn2w","msg":"User credentials created"}
{"level":30,"time":1767814144896,"env":"test","module":"auth-routes","userId":"lSnOKatR0GP2v5QycGlHx","email":"session-test-B5aB72vuDyI3B4hiLJx-P@example.com","msg":"User registered"}
{"level":30,"time":1767814144923,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814144953,"env":"test","module":"email-queue","jobId":"b092d382-362d-4c79-8db4-d6be2b2b2bcb","to":"protected-test-NITyJ1p1NsTvBP9NBTN-c@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814144959,"env":"test","module":"email-queue","jobId":"b8528c8f-af27-4ef9-8107-60b87e9069fa","to":"middleware-test-S1LtgOPJSWABiGZ1yDSZt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814145015,"env":"test","module":"auth-routes","userId":"GLPAIoFx5ZGDf52wDKn2w","email":"middleware-test-S1LtgOPJSWABiGZ1yDSZt@example.com","msg":"User registered"}
{"level":30,"time":1767814145021,"env":"test","module":"auth-routes","userId":"QVpmzKc336bHMXo2PrwRo","email":"protected-test-NITyJ1p1NsTvBP9NBTN-c@example.com","msg":"User registered"}
{"level":50,"time":1767814145059,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814145169,"env":"test","module":"mfa-service","userId":"1337cf70ae5232e0860a0a9c3168eae4","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814145170,"env":"test","module":"auth-routes","userId":"1337cf70ae5232e0860a0a9c3168eae4","msg":"MFA verification failed during login"}
{"level":50,"time":1767814145283,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814145322,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814145327,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814145400,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814145433,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stdout | tests/unit/services/AuthService.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ¥» tests/unit/services/AuthService.test.ts (113 tests | 7 failed) 7722ms
         Γ£ô should hash a password using bcrypt with 12 rounds 236ms
         Γ£ô should generate different hashes for same password  439ms
         Γ£ô should handle empty passwords 228ms
         Γ£ô should handle long passwords 211ms
         Γ£ô should handle unicode characters in password 209ms
         Γ£ô should return true for correct password  443ms
         Γ£ô should return false for incorrect password  439ms
         Γ£ô should be case-sensitive  452ms
         Γ£ô should handle empty password comparison  447ms
         Γ£ô should accept valid email addresses 1ms
         Γ£ô should reject emails longer than 254 characters (RFC 5321) 1ms
         Γ£ô should reject emails shorter than 3 characters 1ms
         Γ£ô should reject emails with consecutive dots 1ms
         Γ£ô should reject emails without @ symbol 0ms
         Γ£ô should reject emails without domain 1ms
         Γ£ô should reject emails with spaces 1ms
         Γ£ô should reject emails without TLD 0ms
         Γ£ô should reject null or undefined 1ms
         Γ£ô should reject emails with local part longer than 64 characters 1ms
         Γ£ô should accept valid strong passwords 20ms
         Γ£ô should reject passwords shorter than 8 characters 1ms
         Γ£ô should reject passwords longer than 128 characters 1ms
         Γ£ô should reject weak passwords with zxcvbn score < 3 4ms
         Γ£ô should provide helpful feedback for weak passwords 2ms
         Γ£ô should reject password containing user's email 3ms
         Γ£ô should reject password containing user's name 2ms
         Γ£ô should accept strong password even with user inputs provided 4ms
         Γ£ô should accept password with exactly 8 characters if strong enough 1ms
         Γ£ô should accept password with exactly 128 characters if strong 106ms
         Γ£ô should return score in result object 3ms
         Γ£ô should create a valid JWT token for a user 5ms
         ├ù should include userId, email, tenantId, and role in token payload 7ms
         Γ£ô should set token expiry to 15 minutes by default 1ms
         Γ£ô should throw error if JWT_SECRET is not configured 1ms
         ├ù should handle null tenantId and role 1ms
         ├ù should verify and decode a valid token 3ms
         Γ£ô should throw error for expired token  1105ms
         ├ù should throw error for invalid token signature 4ms
         ├ù should throw error for malformed token 1ms
         ├ù should throw error for invalid token 1ms
         Γ£ô should extract token from Bearer authorization header 1ms
         Γ£ô should return token if no Bearer prefix 0ms
         Γ£ô should return null for undefined header 1ms
         Γ£ô should return null for empty header 0ms
         Γ£ô should handle Bearer with multiple spaces 0ms
         Γ£ô should return true for JWT-like tokens 1ms
         Γ£ô should return false for non-JWT tokens 1ms
         Γ£ô should return false for empty token 1ms
         Γ£ô should return false for null/undefined 1ms
         Γ£ô should create a valid portal token for an email 1ms
         Γ£ô should include email and portal flag in token payload 1ms
         Γ£ô should set token expiry to 24 hours 1ms
         Γ£ô should verify and decode a valid portal token 1ms
         Γ£ô should throw error for non-portal token 1ms
         Γ£ô should throw error for token without email 1ms
         Γ£ô should throw error for expired portal token 1ms
         Γ£ô should generate password reset token for existing user 221ms
         Γ£ô should return null for non-existent user 1ms
         Γ£ô should invalidate previous reset tokens 1ms
         Γ£ô should return userId for valid token 2ms
         Γ£ô should return null for invalid token 1ms
         Γ£ô should return null for expired token 1ms
         Γ£ô should return null for used token 1ms
         Γ£ô should mark token as used 1ms
         Γ£ô should generate verification token 1ms
         Γ£ô should have 24 hour expiry 1ms
         Γ£ô should verify email with valid token 1ms
         Γ£ô should return false for invalid token 1ms
         Γ£ô should return false for expired token 1ms
         Γ£ô should delete token after successful verification 1ms
         Γ£ô should create refresh token with 30-day expiry 2ms
         Γ£ô should store device metadata 1ms
         Γ£ô should return userId for valid token 1ms
         Γ£ô should return null for revoked token 1ms
         Γ£ô should return null for expired token 1ms
         Γ£ô should rotate valid token and return new one 1ms
         Γ£ô should return null for unknown token 1ms
         Γ£ô should revoke all tokens on reuse detection 2ms
         Γ£ô should return null for expired token 1ms
         Γ£ô should revoke specific token 1ms
         Γ£ô should revoke all tokens for user 1ms
         Γ£ô should cleanup expired refresh tokens 1ms
         Γ£ô should cleanup expired password reset tokens 1ms
         Γ£ô should cleanup expired email verification tokens 1ms
         Γ£ô should cleanup old login attempts via accountLockoutService 1ms
         Γ£ô should use JWT_SECRET if provided 1ms
         Γ£ô should warn if JWT_SECRET is less than 32 characters 1ms
         Γ£ô should reject token with modified payload 1ms
         ├ù should reject token with valid structure but invalid signature 1ms
         Γ£ô should handle password with special characters  449ms
         Γ£ô should handle password with only spaces 230ms
         Γ£ô should handle password with newlines and tabs  452ms
         Γ£ô should reject password with null bytes (if validation exists)  459ms
         Γ£ô should reject email with unicode domain (security fix) 1ms
         Γ£ô should reject email starting with dot (security fix) 1ms
         Γ£ô should reject email ending with dot before @ (security fix) 1ms
         Γ£ô should handle email with plus addressing 1ms
         Γ£ô should handle email with subdomain 1ms
         Γ£ô should reject email with invalid TLD (single char) 0ms
         Γ£ô should accept email with numeric TLD 1ms
         Γ£ô should prevent timing attacks on token validation 1ms
         Γ£ô should support full user authentication lifecycle 236ms
         Γ£ô should support complete password reset workflow  482ms
         Γ£ô should prevent reuse of password reset tokens 2ms
         Γ£ô should support multiple valid refresh tokens per user 1ms
         Γ£ô should revoke all user tokens on security event 1ms
         Γ£ô should handle database connection failures gracefully 2ms
         Γ£ô should handle transaction failures 2ms
         Γ£ô should throw error if JWT signing fails 2ms
         Γ£ô should hash password in reasonable time (< 500ms) 277ms
         Γ£ô should compare password in reasonable time (< 500ms)  446ms
         Γ£ô should create JWT token in < 10ms 2ms
         Γ£ô should verify JWT token in < 10ms 2ms
{"level":50,"time":1767814145665,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814145703,"env":"test","module":"user-credentials-repository","userId":"6USZ6dC8IayXX2ym69KGz","msg":"User credentials created"}
{"level":30,"time":1767814145759,"env":"test","module":"user-credentials-repository","userId":"vPGUtGeu44BYa5JiZG_EX","msg":"User credentials created"}
{"level":30,"time":1767814145775,"env":"test","module":"user-credentials-repository","userId":"LAr4La1aXSlz7F1eI2iJz","msg":"User credentials created"}
{"level":30,"time":1767814145812,"env":"test","module":"email-queue","jobId":"d1a85c68-8cf0-4138-b6c3-cb5653ff40ea","to":"session-test--BB7VdJ-kjuHQWy8YfU-l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814145862,"env":"test","module":"email-queue","jobId":"9b981fb8-1939-480f-987d-34747e4447e8","to":"middleware-test-irtQS5UY-aMHAr4wVgLA0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814145864,"env":"test","module":"auth-routes","userId":"6USZ6dC8IayXX2ym69KGz","email":"session-test--BB7VdJ-kjuHQWy8YfU-l@example.com","msg":"User registered"}
{"level":30,"time":1767814145877,"env":"test","module":"email-queue","jobId":"d913b337-d3d1-4991-9540-29eb2484bf84","to":"protected-test-XkTug54YAWtUDMo3kPM2F@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814145915,"env":"test","module":"auth-routes","userId":"vPGUtGeu44BYa5JiZG_EX","email":"middleware-test-irtQS5UY-aMHAr4wVgLA0@example.com","msg":"User registered"}
{"level":30,"time":1767814145928,"env":"test","module":"auth-routes","userId":"LAr4La1aXSlz7F1eI2iJz","email":"protected-test-XkTug54YAWtUDMo3kPM2F@example.com","msg":"User registered"}
{"level":50,"time":1767814145928,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814145934,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814146059,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/ui/datavault/EditableCell.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

{"level":50,"time":1767814146140,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814146165,"env":"test","module":"mfa-service","userId":"172d990be983d6d3418612436b3ea41c","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814146166,"env":"test","module":"auth-routes","userId":"172d990be983d6d3418612436b3ea41c","msg":"MFA verification failed during login"}
{"level":50,"time":1767814146172,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814146197,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/unit/middleware/auth.middleware.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814146197,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814146198,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814146199,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767814146201,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
{"level":50,"time":1767814146225,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814146232,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814146236,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 Γ¥» tests/unit/middleware/auth.middleware.test.ts (22 tests | 1 failed) 7423ms
       Γ£ô should authenticate with valid JWT token  432ms
       ├ù should return 401 for missing token 10ms
       Γ£ô should return 401 for invalid token 1ms
       Γ£ô should return 401 for expired token  469ms
       Γ£ô should extract token without Bearer prefix  445ms
       Γ£ô should authenticate with valid token  423ms
       Γ£ô should proceed without auth when no token provided 1ms
       Γ£ô should proceed even with invalid token 0ms
       Γ£ô should authenticate with JWT Bearer token  464ms
       Γ£ô should authenticate with refresh token cookie for GET requests  534ms
       Γ£ô should reject cookie auth for POST requests  434ms
       Γ£ô should prioritize JWT over cookie when both present  882ms
       Γ£ô should allow cookie auth only for safe methods  744ms
       Γ£ô should return 401 when no auth provided 1ms
       Γ£ô should authenticate with JWT  444ms
       Γ£ô should authenticate with cookie for GET  571ms
       Γ£ô should proceed without auth when none provided 2ms
       Γ£ô should proceed even with invalid auth 1ms
       Γ£ô should not allow token tampering  387ms
       Γ£ô should not allow cookie auth for mutations (CSRF protection)  436ms
       Γ£ô should reject malformed JWT 1ms
       Γ£ô should handle missing authorization header gracefully 1ms
{"level":50,"time":1767814146496,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814146497,"env":"test","module":"auth-routes","userId":"d3e33fdd87b6c9d7fac4aeb9e9839196","msg":"User logged in successfully"}
{"level":30,"time":1767814146554,"env":"test","module":"audit-log-service","userId":"d3e33fdd87b6c9d7fac4aeb9e9839196","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814146633,"env":"test","module":"user-credentials-repository","userId":"8LzMDix5ScsdBXPPdhhyk","msg":"User credentials created"}
{"level":30,"time":1767814146639,"env":"test","module":"user-credentials-repository","userId":"hr6xrykhZyMQtCnTHAXbF","msg":"User credentials created"}
{"level":30,"time":1767814146646,"env":"test","module":"user-credentials-repository","userId":"cJy4HU32BjGmnOVYLczfR","msg":"User credentials created"}
{"level":30,"time":1767814146738,"env":"test","module":"email-queue","jobId":"1c023d1a-6cc8-4b1a-9c90-c79e304344a0","to":"middleware-test-dJARr9oke4WFPX0qy69tP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814146745,"env":"test","module":"email-queue","jobId":"b69b2478-7ddb-43b0-bb0c-cc568d8f7921","to":"protected-test-jWzaBZ3VOKdIr6evHdb7Y@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814146751,"env":"test","module":"email-queue","jobId":"05a1d79e-bac2-4768-bf70-9c9f7f01ff6c","to":"session-test-51rqbhyIF1PUVJyoYV-2t@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/integration/regression-REG-1.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767814146792,"env":"test","module":"auth-routes","userId":"8LzMDix5ScsdBXPPdhhyk","email":"middleware-test-dJARr9oke4WFPX0qy69tP@example.com","msg":"User registered"}
{"level":30,"time":1767814146797,"env":"test","module":"auth-routes","userId":"hr6xrykhZyMQtCnTHAXbF","email":"protected-test-jWzaBZ3VOKdIr6evHdb7Y@example.com","msg":"User registered"}
{"level":30,"time":1767814146804,"env":"test","module":"auth-routes","userId":"cJy4HU32BjGmnOVYLczfR","email":"session-test-51rqbhyIF1PUVJyoYV-2t@example.com","msg":"User registered"}
{"level":50,"time":1767814147100,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814147100,"env":"test","module":"mfa-service","userId":"d3e33fdd87b6c9d7fac4aeb9e9839196","count":10,"msg":"Stored backup codes"}
{"level":50,"time":1767814147104,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814147100,"env":"test","module":"mfa-service","userId":"d3e33fdd87b6c9d7fac4aeb9e9839196","msg":"Generated TOTP secret"}
{"level":30,"time":1767814147100,"env":"test","module":"auth-routes","userId":"d3e33fdd87b6c9d7fac4aeb9e9839196","msg":"MFA setup initiated"}
{"level":30,"time":1767814147205,"env":"test","module":"user-credentials-repository","userId":"BsA8357S1WH5x6sZ5hbOI","msg":"User credentials created"}
stdout | tests/ui/runs.components.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1767814147281,"env":"test","module":"auth-routes","userId":"c1ff0cb19f5eb1632979ff9b15b9e948","msg":"User logged in successfully"}
{"level":30,"time":1767814147332,"env":"test","module":"user-credentials-repository","userId":"Pzv9L3AoDyB4NnM9WHXt3","msg":"User credentials created"}
{"level":30,"time":1767814147332,"env":"test","module":"audit-log-service","userId":"c1ff0cb19f5eb1632979ff9b15b9e948","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/ui/datavault/EditableCell.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/ui/datavault/EditableCell.test.tsx
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814147434,"env":"test","module":"email-queue","jobId":"41cc87bc-a9af-46fd-88d3-967841a847ff","to":"user2-Ly1e12isCkU9mpO948f_K@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/integration/regression-REG-1.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

{"level":30,"time":1767814147487,"env":"test","module":"auth-routes","userId":"Pzv9L3AoDyB4NnM9WHXt3","email":"user2-Ly1e12isCkU9mpO948f_K@example.com","msg":"User registered"}
{"level":30,"time":1767814147505,"env":"test","module":"user-credentials-repository","userId":"QX7BIOno9tfqvHdtckZke","msg":"User credentials created"}
{"level":30,"time":1767814147511,"env":"test","module":"user-credentials-repository","userId":"2E3UJYHqQ7UrTf8xJ6wGl","msg":"User credentials created"}
stdout | tests/ui/datavault/EditableCell.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":50,"time":1767814147604,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814147608,"env":"test","module":"email-queue","jobId":"5fb92200-9db4-475e-9831-f96e0286398b","to":"middleware-test-MaLcpDIvp4p4NbntOkTem@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/integration/regression-REG-1.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814147626,"env":"test","module":"email-queue","jobId":"a6a55bc5-4324-4591-aca3-12b069083b46","to":"protected-test-yjyYDpY7CLJyXyb74MN5w@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/integration/regression-REG-1.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814147662,"env":"test","module":"auth-routes","userId":"QX7BIOno9tfqvHdtckZke","email":"middleware-test-MaLcpDIvp4p4NbntOkTem@example.com","msg":"User registered"}
{"level":30,"time":1767814147681,"env":"test","module":"auth-routes","userId":"2E3UJYHqQ7UrTf8xJ6wGl","email":"protected-test-yjyYDpY7CLJyXyb74MN5w@example.com","msg":"User registered"}
{"level":30,"time":1767814147714,"env":"test","module":"user-credentials-repository","userId":"h9iMS0A5_wEeLF2zTtRXg","msg":"User credentials created"}
{"level":50,"time":1767814147803,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814147844,"env":"test","module":"auth-routes","userId":"ce98d8a5b6f9c055a967816c20b7a069","msg":"User logged in successfully"}
{"level":50,"time":1767814147873,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/api.templates-runs.test.ts
≡ƒº¬ Setting up test environment...

{"level":50,"time":1767814147896,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814147897,"env":"test","module":"audit-log-service","userId":"ce98d8a5b6f9c055a967816c20b7a069","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/integration/api.templates-runs.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":50,"time":1767814147973,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814147986,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/datavault/EditableCell.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814148040,"env":"test","module":"auth-service","userId":"h9iMS0A5_wEeLF2zTtRXg","tokenHash":"d0fa021675e64c76628b49a3da53f35d15397ec395d934058bf05f5e4e02b172","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
stderr | tests/integration/regression-REG-1.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":50,"time":1767814148136,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814148169,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814148170,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814148174,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814148183,"env":"test","module":"user-credentials-repository","userId":"g8zOIArmmjTzwWMVQnaXH","msg":"User credentials created"}
{"level":30,"time":1767814148289,"env":"test","module":"email-queue","jobId":"9e0f5bac-a17c-44b0-9fe2-0f2fb1f20ecb","to":"session-test-61QG5eapU0A4wne0-vh3l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814148318,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814148342,"env":"test","module":"auth-routes","userId":"g8zOIArmmjTzwWMVQnaXH","email":"session-test-61QG5eapU0A4wne0-vh3l@example.com","msg":"User registered"}
{"level":30,"time":1767814148365,"env":"test","module":"user-credentials-repository","userId":"ENkkjol-gjsxFWm9iPxrl","msg":"User credentials created"}
{"level":30,"time":1767814148378,"env":"test","module":"user-credentials-repository","userId":"ZNU5JI7tYAoLRJs5xDerU","msg":"User credentials created"}
stderr | tests/integration/api.templates-runs.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814148430,"env":"test","module":"mfa-service","userId":"3b1969d95a3856adc1c45edb11e51771","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814148431,"env":"test","module":"auth-routes","userId":"3b1969d95a3856adc1c45edb11e51771","msg":"MFA verification failed during login"}
{"level":50,"time":1767814148435,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814148439,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814148440,"env":"test","module":"user-credentials-repository","userId":"Ex1Jswvor9b42uOlbtBsp","msg":"User credentials created"}
{"level":50,"time":1767814148441,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/integration/auth/jwt.authentication.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814148473,"env":"test","module":"email-queue","jobId":"f2f9b3c1-23ae-4a11-a7c5-64cc42610599","to":"middleware-test-hueVue8gdT3uFNOharw_V@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814148478,"env":"test","module":"email-queue","jobId":"895f9767-5ce5-49e3-844d-253b2f7bb9e7","to":"protected-test-RbV095k0-kAUd8Birxv4V@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/integration/auth/jwt.authentication.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814148530,"env":"test","module":"auth-routes","userId":"ZNU5JI7tYAoLRJs5xDerU","email":"protected-test-RbV095k0-kAUd8Birxv4V@example.com","msg":"User registered"}
{"level":30,"time":1767814148532,"env":"test","module":"auth-routes","userId":"ENkkjol-gjsxFWm9iPxrl","email":"middleware-test-hueVue8gdT3uFNOharw_V@example.com","msg":"User registered"}
stdout | tests/ui/runs.components.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/ui/runs.components.test.tsx
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814148638,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814148659,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814148647,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814148647,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814148652,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814148659,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814148659,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814148659,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814148659,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stdout | tests/ui/runs.components.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":50,"time":1767814148705,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814148713,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814148838,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814148838,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814148938,"env":"test","module":"user-credentials-repository","userId":"O7_vD2iH9Uz6DEiknlKv1","msg":"User credentials created"}
stderr | tests/integration/auth/jwt.authentication.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":50,"time":1767814148984,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814149113,"env":"test","module":"user-credentials-repository","userId":"I_QYEVzftJCiXDC_XagRm","msg":"User credentials created"}
stderr | tests/ui/runs.components.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814149149,"env":"test","module":"user-credentials-repository","userId":"IVxE6gHCDaaRafK-ztkas","msg":"User credentials created"}
{"level":40,"time":1767814149203,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767814149220,"env":"test","module":"email-queue","jobId":"fa646cb9-2e70-46de-8341-266e3cbca644","to":"session-test-cs6OrVnDNw_nf231HKag8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814149232,"env":"test","module":"user-credentials-repository","userId":"Qp2VCIBozdnAjbk2dZcd2","msg":"User credentials created"}
{"level":30,"time":1767814149237,"env":"test","module":"user-credentials-repository","userId":"1qDxTeFNNFZxXWrwuCnvN","msg":"User credentials created"}
{"level":50,"time":1767814149252,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814149253,"env":"test","module":"email-queue","jobId":"2692a6c5-703f-44a6-984b-c251a8657e64","to":"test--Ajg1D0sAJ3rVio9-PEpd@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814149257,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814149276,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814149278,"env":"test","module":"auth-routes","userId":"I_QYEVzftJCiXDC_XagRm","email":"session-test-cs6OrVnDNw_nf231HKag8@example.com","msg":"User registered"}
{"level":30,"time":1767814149265,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814149265,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814149270,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814149275,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814149275,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814149276,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814149276,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767814149312,"env":"test","module":"auth-routes","userId":"IVxE6gHCDaaRafK-ztkas","email":"test--Ajg1D0sAJ3rVio9-PEpd@example.com","msg":"User registered"}
{"level":30,"time":1767814149337,"env":"test","module":"email-queue","jobId":"8ceecfe3-0bbd-47ec-97a2-ce8d1a4c6361","to":"middleware-test-TyXL2M684-aTw8mkpqSfZ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814149337,"env":"test","module":"email-queue","jobId":"2d83f594-42fb-4853-a06b-10e9f5d0730f","to":"protected-test-Q7WFSB0FD4WL4IDjM8K1D@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814149392,"env":"test","module":"auth-routes","userId":"1qDxTeFNNFZxXWrwuCnvN","email":"protected-test-Q7WFSB0FD4WL4IDjM8K1D@example.com","msg":"User registered"}
{"level":30,"time":1767814149391,"env":"test","module":"auth-routes","userId":"Qp2VCIBozdnAjbk2dZcd2","email":"middleware-test-TyXL2M684-aTw8mkpqSfZ@example.com","msg":"User registered"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1767814149445,"env":"test","module":"auth-routes","userId":"17bb4000c60bbe0f93c7fcf8e61fb16f","msg":"User logged in successfully"}
{"level":30,"time":1767814149479,"env":"test","module":"auth-routes","userId":"0d4ab2b6fe7966014e542dd3cbacf35a","msg":"User logged in successfully"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > reverts value on save error
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:204:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":30,"time":1767814149497,"env":"test","module":"audit-log-service","userId":"17bb4000c60bbe0f93c7fcf8e61fb16f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767814149520,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767814149538,"env":"test","module":"audit-log-service","userId":"0d4ab2b6fe7966014e542dd3cbacf35a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814149599,"env":"test","module":"user-credentials-repository","userId":"hmy4Krj-sIN9Otu96ILZi","msg":"User credentials created"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > displays error indicator on save failure
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:220:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":30,"time":1767814149738,"env":"test","module":"auth-routes","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"User logged in successfully"}
{"level":30,"time":1767814149789,"env":"test","module":"audit-log-service","userId":"d70ff8be8a255aa7f2dfd763386652db","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814149797,"env":"test","module":"user-credentials-repository","userId":"Unv3KGT8wY5jLDU8MVYPK","msg":"User credentials created"}
{"level":50,"time":1767814149809,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814149814,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/integration/auth.flows.real.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":40,"time":1767814149876,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":50,"time":1767814149881,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814149899,"env":"test","module":"email-queue","jobId":"86a9da3a-565c-41c1-ab30-864134c19057","to":"test-yHIvklN4hh5sIOqzzQE94@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814149909,"env":"test","module":"auth-routes","userId":"I_QYEVzftJCiXDC_XagRm","msg":"User logged in successfully"}
 Γ¥» tests/integration/auth.flows.real.test.ts (11 tests | 10 failed) 19769ms
       ├ù should complete registration, verify email, then login 1723ms
       ├ù should lock account after 5 failed attempts, then unlock after waiting 2410ms
       ├ù should record all login attempts 1875ms
       ├ù should complete MFA setup and login with TOTP 2008ms
       ├ù should login with backup code when TOTP unavailable 1929ms
       ├ù should complete full password reset flow 1731ms
       Γ£ô should invalidate all sessions after password reset  1777ms
       ├ù should rotate refresh token on each use 1100ms
       ├ù should detect and prevent refresh token reuse (token theft) 1095ms
       ├ù should list all active sessions 1676ms
       ├ù should revoke specific session 1639ms
{"level":30,"time":1767814149934,"env":"test","module":"auth-routes","userId":"1qDxTeFNNFZxXWrwuCnvN","msg":"User logged in successfully"}
{"level":30,"time":1767814149941,"env":"test","module":"auth-routes","userId":"Qp2VCIBozdnAjbk2dZcd2","msg":"User logged in successfully"}
{"level":30,"time":1767814149955,"env":"test","module":"auth-routes","userId":"Unv3KGT8wY5jLDU8MVYPK","email":"test-yHIvklN4hh5sIOqzzQE94@example.com","msg":"User registered"}
{"level":30,"time":1767814149961,"env":"test","module":"audit-log-service","userId":"I_QYEVzftJCiXDC_XagRm","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814149984,"env":"test","module":"audit-log-service","userId":"1qDxTeFNNFZxXWrwuCnvN","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767814149984,"env":"test","module":"mfa-service","userId":"862d52c9ebbfdc5ccea92c4c49accfef","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814149984,"env":"test","module":"auth-routes","userId":"862d52c9ebbfdc5ccea92c4c49accfef","msg":"MFA verification failed during login"}
{"level":50,"time":1767814149989,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814149990,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814150001,"env":"test","module":"auth-routes","userId":"17bb4000c60bbe0f93c7fcf8e61fb16f","msg":"User logged in successfully"}
{"level":30,"time":1767814150001,"env":"test","module":"audit-log-service","userId":"Qp2VCIBozdnAjbk2dZcd2","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814150051,"env":"test","module":"audit-log-service","userId":"17bb4000c60bbe0f93c7fcf8e61fb16f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814150055,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814150205,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814150211,"env":"test","module":"user-credentials-repository","userId":"wEjlN_aVFc7QLIJQcsZKh","msg":"User credentials created"}
{"level":50,"time":1767814150211,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814150216,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814150218,"env":"test","module":"auth-routes","userId":"17bb4000c60bbe0f93c7fcf8e61fb16f","msg":"All other sessions revoked"}
{"level":50,"time":1767814150225,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814150248,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":50,"time":1767814150256,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814150270,"env":"test","module":"audit-log-service","userId":"17bb4000c60bbe0f93c7fcf8e61fb16f","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767814150302,"env":"test","module":"mfa-service","userId":"d70ff8be8a255aa7f2dfd763386652db","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767814150302,"env":"test","module":"mfa-service","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"Generated TOTP secret"}
{"level":30,"time":1767814150302,"env":"test","module":"auth-routes","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"MFA setup initiated"}
{"level":40,"time":1767814150313,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767814150313,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767814150313,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767814150313,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767814150316,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767814150316,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767814150317,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
stderr | tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/regression-REG-1.test.ts:79:13 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(f0686205-8339-4fe3-8648-873ed98a3743) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

stdout | tests/integration/regression-REG-1.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814150382,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814150390,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814150393,"env":"test","module":"user-credentials-repository","userId":"WlZxs80zideFUdBMpjsr3","msg":"User credentials created"}
 Γ¥» tests/integration/regression-REG-1.test.ts (8 tests | 3 failed) 2755ms
       Γ£ô should block Next when required visible question is empty  322ms
       ├ù should NOT block Next when required question is hidden 330ms
       Γ£ô should block when required becomes visible and is empty  308ms
       ├ù should skip hidden required page entirely 356ms
       Γ£ô should enforce required on visible page  436ms
       ├ù should evaluate visibility consistently across modes 2ms
       Γ£ô should handle malformed visibility expression gracefully 2ms
       Γ£ô should handle missing variable in visibility expression 0ms
{"level":30,"time":1767814150464,"env":"test","module":"user-credentials-repository","userId":"e3q5I7ZPdz0Lz_SgG7UDJ","msg":"User credentials created"}
{"level":30,"time":1767814150495,"env":"test","module":"email-queue","jobId":"55254eb8-e8f4-40b6-897c-3d859836e35d","to":"protected-test-kXsiq4SgGWDKWQUZ7mu2K@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814150551,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"qpdf --decrypt \"C:\\Users\\scoot\\AppData\\Local\\Temp\\locked-1767814150525.pdf\" \"C:\\Users\\scoot\\AppData\\Local\\Temp\\unlocked-1767814150525.pdf\"","stdout":"","stderr":"'qpdf' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"Failed to unlock PDF with qpdf"}
{"level":40,"time":1767814150551,"env":"test","msg":"Returning original PDF buffer due to unlock failure"}
{"level":50,"time":1767814150553,"env":"test","error":{},"msg":"Failed to extract PDF fields"}
{"level":50,"time":1767814150554,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF processing failed"}
{"level":50,"time":1767814150554,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"a93e76eb-2168-4d81-8265-8cb040b68d10"},"file":{"fieldname":"file","originalname":"test.pdf","encoding":"7bit","mimetype":"application/pdf","buffer":{"type":"Buffer","data":[37,80,68,70]},"size":4},"msg":"Error creating template"}
{"level":30,"time":1767814150561,"env":"test","module":"auth-routes","userId":"WlZxs80zideFUdBMpjsr3","email":"protected-test-kXsiq4SgGWDKWQUZ7mu2K@example.com","msg":"User registered"}
{"level":30,"time":1767814150578,"env":"test","module":"email-queue","jobId":"539247f8-8a1c-409a-952b-2d75ea355bee","to":"middleware-test-AG5-rPD2DqbW2dvB1cDve@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/ui/runs.components.test.tsx
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814150629,"env":"test","module":"auth-routes","userId":"e3q5I7ZPdz0Lz_SgG7UDJ","email":"middleware-test-AG5-rPD2DqbW2dvB1cDve@example.com","msg":"User registered"}
{"level":30,"time":1767814150644,"env":"test","module":"user-credentials-repository","userId":"YF6VUskbc2Ysi6mxf4LCx","msg":"User credentials created"}
{"level":30,"time":1767814150644,"env":"test","module":"mfa-service","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"MFA enabled successfully"}
{"level":30,"time":1767814150644,"env":"test","module":"auth-routes","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"MFA enabled successfully"}
{"level":50,"time":1767814150668,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"a93e76eb-2168-4d81-8265-8cb040b68d10"},"msg":"Error creating template"}
 Γ¥» tests/ui/runs.components.test.tsx (19 tests | 6 failed) 2593ms
       ├ù should render runs table with correct columns 34ms
       ├ù should render run data correctly 4ms
       ├ù should show success badge for successful runs 4ms
       ├ù should show error badge for failed runs 5ms
       ├ù should format duration correctly 14ms
       ├ù should show download options for successful runs 5ms
       Γ£ô should render all filter controls 189ms
       Γ£ô should call onChange when status filter changes  526ms
       Γ£ô should call onChange when search is submitted 109ms
       Γ£ô should show clear filters button when filters are active 29ms
       Γ£ô should clear all filters when clear button is clicked 46ms
       Γ£ô should render all trace entries 60ms
       Γ£ô should show executed badge for executed nodes 28ms
       Γ£ô should show skipped badge for skipped nodes 23ms
       Γ£ô should display conditions and their results 30ms
       Γ£ô should display error messages 20ms
       Γ£ô should toggle show skipped nodes 30ms
       Γ£ô should expand outputs delta when clicked 43ms
       Γ£ô should copy trace as JSON 24ms
{"level":30,"time":1767814150694,"env":"test","module":"audit-log-service","userId":"d70ff8be8a255aa7f2dfd763386652db","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814150750,"env":"test","module":"email-queue","jobId":"87535bbc-5918-46f2-b44c-ee9312db2852","to":"session-test-gwcgjrIbarn376YQgsihm@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814150805,"env":"test","module":"auth-routes","userId":"YF6VUskbc2Ysi6mxf4LCx","email":"session-test-gwcgjrIbarn376YQgsihm@example.com","msg":"User registered"}
{"level":30,"time":1767814150830,"env":"test","module":"user-credentials-repository","userId":"zeppwy4iqJT-D0M443qoF","msg":"User credentials created"}
{"level":50,"time":1767814150870,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/api.dataSources.native.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

{"level":40,"time":1767814150944,"env":"test","module":"auth-service","tokenHash":"73f586087f7a8df742e29ad067ddc7a86812ffcb94bc7e5b5afc761e565fa450","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1767814150949,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814150977,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814151011,"env":"test","module":"auth-routes","userId":"b782c4132b73b947ddce84d09e60ab4c","msg":"User logged in successfully"}
stdout | tests/integration/auth/oauth2.token-refresh.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814151063,"env":"test","module":"audit-log-service","userId":"b782c4132b73b947ddce84d09e60ab4c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767814151087,"env":"test","module":"mfa-service","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"No unused backup codes available"}
{"level":40,"time":1767814151087,"env":"test","module":"auth-routes","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"MFA verification failed during login"}
 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts (25 tests | 11 failed) 20913ms
       ├ù should refresh access token with valid refresh token 654ms
       ├ù should rotate refresh token after use 462ms
       Γ£ô should return 401 when refresh token is missing  382ms
       Γ£ô should return 401 for invalid refresh token  466ms
       Γ£ô should return 401 for expired refresh token  516ms
       ├ù should return 401 for revoked refresh token 657ms
       ├ù should return 401 when user is not found 487ms
       ├ù should update refresh token metadata on rotation 643ms
       Γ£ô should handle concurrent refresh token requests (token reuse detection)  657ms
       Γ£ô should set secure cookie in production  629ms
       Γ£ô should set proper cookie attributes  633ms
       ├ù should include user role information in response 592ms
       ├ù should create refresh token on login 659ms
       ├ù should revoke refresh token on logout 487ms
       Γ£ô should handle logout without refresh token gracefully  379ms
       ├ù should support multiple active refresh tokens per user 552ms
       Γ£ô should revoke all user tokens on password reset  592ms
       Γ£ô should use cryptographically strong random tokens  5759ms
       Γ£ô should hash refresh tokens before storing in database  547ms
       Γ£ô should prevent refresh token reuse after rotation  732ms
       ├ù should validate token ownership 505ms
       Γ£ô should set HttpOnly flag to prevent XSS  614ms
       Γ£ô should set SameSite=Strict to prevent CSRF  655ms
       Γ£ô should set proper cookie path  629ms
       ├ù should set appropriate expiry (30 days) 448ms
{"level":50,"time":1767814151176,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/ui/datavault/EditableCell.test.tsx
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/metrics.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

{"level":30,"time":1767814151288,"env":"test","module":"user-credentials-repository","userId":"-yqt-M7KYQYvg2U3PJw_S","msg":"User credentials created"}
 Γ¥» tests/ui/datavault/EditableCell.test.tsx (29 tests | 3 failed) 4621ms
       Γ£ô renders value in display mode initially 45ms
       Γ£ô shows double-click hint on hover 216ms
       Γ£ô does not show hint for read-only cells 25ms
       Γ£ô includes proper ARIA label with column name and value 21ms
       Γ£ô indicates read-only status in ARIA label 19ms
       Γ£ô is focusable when editable 19ms
       Γ£ô is not focusable when read-only 19ms
       Γ£ô enters edit mode on double-click 90ms
       Γ£ô enters edit mode on Enter key press 55ms
       Γ£ô enters edit mode on Space key press 41ms
       Γ£ô does not enter edit mode when read-only 18ms
       Γ£ô focuses and selects input text on edit mode entry 47ms
       Γ£ô saves on blur 142ms
       Γ£ô saves on Enter key press 121ms
       Γ£ô does not save if value unchanged 60ms
       Γ£ô cancels edit on Escape key press 109ms
       Γ£ô reverts value on save error 199ms
       Γ£ô displays error indicator on save failure 170ms
       Γ£ô renders checkbox for boolean type 49ms
       Γ£ô saves immediately on checkbox change 48ms
       Γ£ô disables checkbox when read-only 35ms
       ├ù shows loading spinner when saving checkbox 1057ms
       Γ£ô renders number input for number type 79ms
       Γ£ô renders email input for email type 64ms
       Γ£ô renders url input for url type 51ms
       Γ£ô includes placeholder text in edit mode 63ms
       ├ù formats date values for display 52ms
       ├ù formats boolean values as Yes/No 23ms
       Γ£ô handles null values gracefully 27ms
{"level":30,"time":1767814151369,"env":"test","module":"user-credentials-repository","userId":"iUvtdbo3HDoCl-8lP_kxI","msg":"User credentials created"}
{"level":50,"time":1767814151371,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814151393,"env":"test","module":"email-queue","jobId":"19961ca1-eb61-4b8b-8683-4a4cc51b2bfb","to":"protected-test-QBCk5wLiy7D2vj6iWhsL1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814151444,"env":"test","module":"auth-routes","userId":"-yqt-M7KYQYvg2U3PJw_S","email":"protected-test-QBCk5wLiy7D2vj6iWhsL1@example.com","msg":"User registered"}
{"level":30,"time":1767814151470,"env":"test","module":"email-queue","jobId":"cff41d16-c88a-4a26-81ce-4890fdf6e709","to":"middleware-test-lpXdbo_wUVTZdeGFoDiDO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767814151483,"env":"test","module":"mfa-service","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"No unused backup codes available"}
{"level":40,"time":1767814151483,"env":"test","module":"auth-routes","userId":"d70ff8be8a255aa7f2dfd763386652db","msg":"MFA verification failed during login"}
{"level":50,"time":1767814151497,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814151522,"env":"test","module":"auth-routes","userId":"iUvtdbo3HDoCl-8lP_kxI","email":"middleware-test-lpXdbo_wUVTZdeGFoDiDO@example.com","msg":"User registered"}
{"level":30,"time":1767814151564,"env":"test","module":"user-credentials-repository","userId":"3085daNWNRG-_mBkzuT82","msg":"User credentials created"}
stdout | tests/ui/expression-editor.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767814151666,"env":"test","module":"email-queue","jobId":"a79c5d42-b52b-463e-9df4-42d566de3d55","to":"session-test-cZRaCqjp5jLjNqdHJkZMf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814151709,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814151716,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814151716,"env":"test","module":"auth-routes","userId":"3085daNWNRG-_mBkzuT82","email":"session-test-cZRaCqjp5jLjNqdHJkZMf@example.com","msg":"User registered"}
{"level":50,"time":1767814151721,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814151746,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767814151816,"env":"test","module":"mfa-service","userId":"8fc494af87069496420711de8735c901","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814151816,"env":"test","module":"auth-routes","userId":"8fc494af87069496420711de8735c901","msg":"MFA verification failed during login"}
{"level":50,"time":1767814151822,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814151829,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814151829,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/integration/api.dataSources.native.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

{"level":50,"time":1767814152085,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814152129,"env":"test","module":"user-credentials-repository","userId":"J89aT82-GwccOOE3p58hN","msg":"User credentials created"}
{"level":30,"time":1767814152230,"env":"test","module":"user-credentials-repository","userId":"eK6kVEITjSpln0pxS9QmW","msg":"User credentials created"}
{"level":30,"time":1767814152230,"env":"test","module":"email-queue","jobId":"399ef60f-27e2-47dd-87bf-7329e70f797d","to":"protected-test-k5HtaGzvtZPactStv3Om_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814152231,"env":"test","module":"user-credentials-repository","userId":"Z_EQhSyzxMC209z3rypaP","msg":"User credentials created"}
{"level":30,"time":1767814152281,"env":"test","module":"auth-routes","userId":"J89aT82-GwccOOE3p58hN","email":"protected-test-k5HtaGzvtZPactStv3Om_@example.com","msg":"User registered"}
{"level":40,"time":1767814152285,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814152330,"env":"test","module":"email-queue","jobId":"7946707a-7c36-462d-972e-e40aac770055","to":"middleware-test-ZsjZHb0cH49PhAlwLG6ju@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814152331,"env":"test","module":"email-queue","jobId":"4345c423-2d46-41f6-bf43-9726243f3529","to":"session-test-7vFTh3rNfxv5Oy6ZTbUUh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814152385,"env":"test","module":"auth-routes","userId":"eK6kVEITjSpln0pxS9QmW","email":"middleware-test-ZsjZHb0cH49PhAlwLG6ju@example.com","msg":"User registered"}
{"level":30,"time":1767814152386,"env":"test","module":"auth-routes","userId":"Z_EQhSyzxMC209z3rypaP","email":"session-test-7vFTh3rNfxv5Oy6ZTbUUh@example.com","msg":"User registered"}
stdout | tests/ui/expression-editor.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/ui/expression-editor.test.tsx
≡ƒº¬ Setting up test environment...

stdout | tests/ui/expression-editor.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":50,"time":1767814152603,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814152618,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814152703,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/ui/datavault/TableCard.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

{"level":50,"time":1767814152762,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814152770,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814152823,"env":"test","module":"auth-routes","userId":"J89aT82-GwccOOE3p58hN","msg":"User logged in successfully"}
stdout | tests/ui/common/Breadcrumbs.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

{"level":30,"time":1767814152875,"env":"test","module":"audit-log-service","userId":"J89aT82-GwccOOE3p58hN","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814152881,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814152891,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/metrics.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/metrics.test.ts
≡ƒº¬ Setting up test environment...

{"level":40,"time":1767814153012,"env":"test","module":"mfa-service","userId":"055bc7998e9254ed40173a74ade4702a","msg":"No enabled MFA secret found for user"}
stderr | tests/ui/expression-editor.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814153063,"env":"test","module":"mfa-service","userId":"055bc7998e9254ed40173a74ade4702a","msg":"No unused backup codes available"}
{"level":40,"time":1767814153063,"env":"test","module":"auth-routes","userId":"055bc7998e9254ed40173a74ade4702a","msg":"MFA verification failed during login"}
{"level":30,"time":1767814153161,"env":"test","module":"user-credentials-repository","userId":"Im0unfBXGu7BPMWsxzkxs","msg":"User credentials created"}
stdout | tests/integration/metrics.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":50,"time":1767814153182,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814153203,"env":"test","module":"user-credentials-repository","userId":"buHTj2h9QH_B8CIhfPhWM","msg":"User credentials created"}
{"level":30,"time":1767814153259,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814153264,"env":"test","module":"email-queue","jobId":"d21fda80-4447-4643-be3b-efe52048a0d2","to":"middleware-test-thx5BXV1F8YlLnzro7tsM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814153302,"env":"test","module":"email-queue","jobId":"97fd3f92-f479-4f3a-8fe1-f9c579dc5b39","to":"session-test-g8hzD-Jhhck8Fpog6mbwX@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814153314,"env":"test","module":"auth-routes","userId":"Im0unfBXGu7BPMWsxzkxs","email":"middleware-test-thx5BXV1F8YlLnzro7tsM@example.com","msg":"User registered"}
{"level":30,"time":1767814153321,"env":"test","module":"user-credentials-repository","userId":"5_h8dPFTdYclyFTMXHXQM","msg":"User credentials created"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767814153354,"env":"test","module":"auth-routes","userId":"buHTj2h9QH_B8CIhfPhWM","email":"session-test-g8hzD-Jhhck8Fpog6mbwX@example.com","msg":"User registered"}
{"level":30,"time":1767814153423,"env":"test","module":"email-queue","jobId":"51a2357b-74a5-4701-828a-81f0efd9ccaa","to":"protected-test-xNahQQETeszax0tw2Q0oh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/integration/auth/jwt.authentication.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814153471,"env":"test","module":"auth-routes","userId":"5_h8dPFTdYclyFTMXHXQM","email":"protected-test-xNahQQETeszax0tw2Q0oh@example.com","msg":"User registered"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should debounce validation calls
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1767814153539,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814153612,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":40,"time":1767814153646,"env":"test","module":"mfa-service","userId":"dd007f65fe6ddf1354941d1284c9d80f","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814153646,"env":"test","module":"auth-routes","userId":"dd007f65fe6ddf1354941d1284c9d80f","msg":"MFA verification failed during login"}
{"level":50,"time":1767814153651,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/integration/metrics.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/trusted.devices.real.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ¥» tests/integration/auth/jwt.authentication.test.ts (27 tests | 20 failed) 4966ms
       ├ù should generate valid JWT token on successful login 14ms
       ├ù should include correct payload in JWT token 7ms
       ├ù should set JWT expiry to 15 minutes 7ms
       ├ù should accept valid JWT token on protected routes 160ms
       Γ£ô should reject request without authorization header 6ms
       Γ£ô should reject request with malformed token 5ms
       ├ù should reject request with missing Bearer prefix 166ms
       Γ£ô should reject token with invalid signature 8ms
       Γ£ô should reject expired JWT token  1107ms
       ├ù should return token_expired error code for expired tokens 1112ms
       Γ£ô should authenticate with Bearer token in Authorization header 109ms
       Γ£ô should work with Bearer token on POST requests 114ms
       ├ù should work with Bearer token on PUT requests 68ms
       ├ù should work with Bearer token on DELETE requests 269ms
       ├ù should exchange valid session cookie for JWT token 8ms
       Γ£ô should reject token exchange without valid cookie 5ms
       ├ù should prefer Bearer token over cookie when both present 7ms
       ├ù should fall back to cookie if Bearer token is invalid 6ms
       ├ù should allow GET requests with cookie auth only 7ms
       ├ù should reject POST requests with cookie auth only (mutation-strict) 7ms
       ├ù should allow anonymous access to public workflows 58ms
       ├ù should attach user info if authenticated on optional auth routes 60ms
       ├ù should refresh access token using refresh token 11ms
       ├ù should rotate refresh token on use 9ms
       ├ù should detect token reuse and revoke all user tokens 7ms
       ├ù should revoke refresh token on logout 8ms
       ├ù should clear refresh token cookie on logout 7ms
stdout | tests/ui/common/Breadcrumbs.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

{"level":50,"time":1767814153725,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/ui/common/Breadcrumbs.test.tsx
≡ƒº¬ Setting up test environment...

{"level":50,"time":1767814153773,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate helper functions in expressions
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stdout | tests/ui/datavault/TableCard.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

 Γ¥» tests/integration/trusted.devices.real.test.ts (14 tests | 13 failed) 23653ms
       ├ù should trust current device 1815ms
       ├ù should set trust expiry to 30 days 1508ms
       ├ù should update expiry if device already trusted 1607ms
       Γ£ô should require authentication  417ms
       ├ù should list all trusted devices 2288ms
       ├ù should mark current device 1478ms
       ├ù should exclude revoked devices 1560ms
       ├ù should exclude expired devices 1556ms
       ├ù should revoke specific device 1536ms
       ├ù should return 404 for non-existent device 1570ms
       ├ù should prevent revoking other user's device 2269ms
       ├ù should skip MFA for trusted device 1815ms
       ├ù should require MFA for untrusted device 1828ms
       ├ù should update lastUsedAt on trusted device login 1611ms
stdout | tests/ui/datavault/TableCard.test.tsx
≡ƒº¬ Setting up test environment...

{"level":50,"time":1767814153881,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/ui/common/Breadcrumbs.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate complex expressions with multiple helpers
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1767814153932,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/ui/datavault/TableCard.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814154040,"env":"test","module":"user-credentials-repository","userId":"fOsWRt_025r_ICzC0cX0e","msg":"User credentials created"}
{"level":30,"time":1767814154046,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should handle syntax errors
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767814154047,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1767814154049,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1767814154064,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1767814154086,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
{"level":30,"time":1767814154119,"env":"test","module":"auth-routes","userId":"e69c016d6e7df559c8bcd61735efff5e","msg":"User logged in successfully"}
{"level":30,"time":1767814154140,"env":"test","module":"email-queue","jobId":"e812b104-8c49-46c1-9967-4e324e54f714","to":"middleware-test-CRQtKHFK_5zlFj0WWnuqT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814154142,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814154142,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1767814154142,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1767814154143,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":50,"time":1767814154148,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767814154149,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1767814154159,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
stdout | tests/integration/metrics.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814154171,"env":"test","module":"audit-log-service","userId":"e69c016d6e7df559c8bcd61735efff5e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814154181,"env":"test","module":"user-credentials-repository","userId":"j-PNfKOP3aCwwECBrgXrn","msg":"User credentials created"}
{"level":30,"time":1767814154194,"env":"test","module":"auth-routes","userId":"fOsWRt_025r_ICzC0cX0e","email":"middleware-test-CRQtKHFK_5zlFj0WWnuqT@example.com","msg":"User registered"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

 Γ¥» tests/integration/metrics.test.ts (2 tests | 1 failed) 1724ms
     ├ù should expose /metrics endpoint 134ms
     Γ£ô should protect /metrics if API key is set 72ms
{"level":30,"time":1767814154284,"env":"test","module":"email-queue","jobId":"d35432db-d985-45ab-b903-3663b18d926b","to":"protected-test-uz94eyjTJ5jfqV0e33Rtl@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/services/intakeQuestionVisibility.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

{"level":30,"time":1767814154338,"env":"test","module":"auth-routes","userId":"j-PNfKOP3aCwwECBrgXrn","email":"protected-test-uz94eyjTJ5jfqV0e33Rtl@example.com","msg":"User registered"}
{"level":30,"time":1767814154341,"env":"test","module":"auth-routes","userId":"e69c016d6e7df559c8bcd61735efff5e","msg":"All other sessions revoked"}
{"level":30,"time":1767814154359,"env":"test","module":"user-credentials-repository","userId":"J0WGLJ-zD_zU_c1VZsg5l","msg":"User credentials created"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/common/Breadcrumbs.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814154393,"env":"test","module":"audit-log-service","userId":"e69c016d6e7df559c8bcd61735efff5e","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767814154470,"env":"test","module":"email-queue","jobId":"675a5359-c083-4d97-a1ef-319875c5d020","to":"session-test-GeIh6-R8u5SEpZR9T39Yp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stderr | tests/ui/datavault/TableCard.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":50,"time":1767814154507,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814154510,"env":"test","module":"auth-routes","userId":"e69c016d6e7df559c8bcd61735efff5e","sessionCount":0,"msg":"Listed active sessions"}
stdout | tests/ui/expression-editor.test.tsx
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814154523,"env":"test","module":"auth-routes","userId":"J0WGLJ-zD_zU_c1VZsg5l","email":"session-test-GeIh6-R8u5SEpZR9T39Yp@example.com","msg":"User registered"}
 Γ¥» tests/ui/expression-editor.test.tsx (10 tests | 2 failed) 2610ms
       Γ£ô should initialize with null validation result 29ms
       ├ù should validate expression after debounce 16ms
       ├ù should return validation errors for invalid expression 161ms
       Γ£ô should debounce validation calls 110ms
       Γ£ô should not validate when workflowId or nodeId is missing 159ms
       Γ£ô should validate helper functions in expressions 114ms
       Γ£ô should validate complex expressions with multiple helpers 157ms
       Γ£ô should handle syntax errors 155ms
       Γ£ô should handle empty expressions 3ms
       Γ£ô should update validation when expression changes  313ms
stderr | tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.templates-runs.test.ts:83:5 {
  length: 296,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(IVxE6gHCDaaRafK-ztkas) is still referenced from table "runs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'runs',
  column: undefined,
  dataType: undefined,
  constraint: 'runs_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

stdout | tests/integration/api.templates-runs.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814154656,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table name and description
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stdout | tests/integration/datavault.permissions.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table slug
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render column and row counts
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onClick when card is clicked
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onDelete when delete button is clicked
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should show placeholder when description is missing
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should format dates correctly
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

stdout | tests/ui/datavault/TableCard.test.tsx
≡ƒº╣ Cleaning up test environment...

stdout | tests/ui/common/Breadcrumbs.test.tsx
≡ƒº╣ Cleaning up test environment...

 Γ¥» tests/ui/datavault/TableCard.test.tsx (7 tests | 7 failed) 1586ms
     ├ù should render table name and description 36ms
     ├ù should render table slug 5ms
     ├ù should render column and row counts 4ms
     ├ù should call onClick when card is clicked 5ms
     ├ù should call onDelete when delete button is clicked 5ms
     ├ù should show placeholder when description is missing 14ms
     ├ù should format dates correctly 5ms
{"level":50,"time":1767814154900,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814154927,"env":"test","module":"user-credentials-repository","userId":"hUC9xuCXQDTPeYk2D7S-p","msg":"User credentials created"}
 Γ¥» tests/integration/api.templates-runs.test.ts (15 tests | 2 failed) 6730ms
         Γ£ô should create template with file upload 183ms
         ├ù should reject non-docx files 145ms
         Γ£ô should reject without file 112ms
         Γ£ô should list templates  334ms
         Γ£ô should get template by ID 274ms
         Γ£ô should extract placeholders 263ms
         Γ£ô should update template name  326ms
         Γ£ô should delete template  426ms
         Γ£ô should execute workflow 274ms
         Γ£ô should include logs in debug mode 266ms
         ├ù should reject without required permission 9ms
         Γ£ô should list runs  389ms
         Γ£ô should filter by workflowId  376ms
         Γ£ô should get run by ID  447ms
         Γ£ô should get run logs  498ms
 Γ¥» tests/ui/common/Breadcrumbs.test.tsx (10 tests | 1 failed) 1729ms
     Γ£ô should render all breadcrumb items 88ms
     Γ£ô should render without home when showHome is false 11ms
     Γ£ô should render icons for items that have them 14ms
     Γ£ô should render links for non-last items with href 30ms
     Γ£ô should render last item without link 18ms
     Γ£ô should apply custom className 24ms
     Γ£ô should render chevron separators between items 6ms
     Γ£ô should handle single item 7ms
     Γ£ô should handle empty items array with home 9ms
     ├ù should apply font-medium to last item 14ms
stdout | tests/integration/auth/session.management.integration.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814155033,"env":"test","module":"email-queue","jobId":"e55c8ba0-fc1c-4170-b39c-992f497e397e","to":"middleware-test-BfMw5YxzhXSVLJ4IH9MR2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814155069,"env":"test","module":"user-credentials-repository","userId":"Dmak3kL8epiRfKGldav6q","msg":"User credentials created"}
stdout | tests/unit/services/intakeQuestionVisibility.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/unit/services/intakeQuestionVisibility.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814155083,"env":"test","module":"auth-routes","userId":"hUC9xuCXQDTPeYk2D7S-p","email":"middleware-test-BfMw5YxzhXSVLJ4IH9MR2@example.com","msg":"User registered"}
{"level":30,"time":1767814155180,"env":"test","module":"email-queue","jobId":"7d878f38-2c02-4183-9a1a-7a9f245f94e7","to":"protected-test-ugzdsGvpUAdV2H9OEbvfN@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814155180,"env":"test","module":"auth-routes","userId":"bde9fe70a11724a956840fad6b2e631e","msg":"User logged in successfully"}
{"level":30,"time":1767814155232,"env":"test","module":"audit-log-service","userId":"bde9fe70a11724a956840fad6b2e631e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814155232,"env":"test","module":"auth-routes","userId":"Dmak3kL8epiRfKGldav6q","email":"protected-test-ugzdsGvpUAdV2H9OEbvfN@example.com","msg":"User registered"}
stdout | tests/unit/services/intakeQuestionVisibility.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/intakeNavigation.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

 Γ¥» tests/integration/auth/session.management.integration.test.ts (18 tests | 15 failed) 19607ms
       ├ù should create refresh token on login 959ms
       Γ£ô should track device metadata in session  1255ms
       ├ù should create separate sessions for multiple device logins 910ms
       ├ù should list all active sessions for user 913ms
       ├ù should mark current session correctly 911ms
       ├ù should not include revoked sessions 920ms
       ├ù should order sessions by last used (most recent first) 948ms
       Γ£ô should require authentication  663ms
       ├ù should revoke specific session 945ms
       ├ù should prevent revoking current session 944ms
       ├ù should not allow revoking other users sessions 1577ms
       ├ù should return 404 for non-existent session ID 903ms
       ├ù should revoke all sessions except current 1520ms
       ├ù should revoke all trusted devices 950ms
       Γ£ô should require active session  653ms
       ├ù should reject refresh token after 30 days 932ms
       ├ù should handle multiple concurrent logins 1175ms
       ├ù should handle concurrent token refreshes 964ms
stdout | tests/unit/isolatedVmBridge.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1767814155516,"env":"test","module":"auth-service","userId":"bde9fe70a11724a956840fad6b2e631e","tokenHash":"fab2b6c0733cc65d937dd981d765320b12a59ae0eb31079b51080e23b5ac59ec","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
stdout | tests/unit/client/choice-utils.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767814155671,"env":"test","module":"auth-routes","userId":"hUC9xuCXQDTPeYk2D7S-p","msg":"User logged in successfully"}
stderr | tests/unit/services/intakeQuestionVisibility.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814155725,"env":"test","module":"audit-log-service","userId":"hUC9xuCXQDTPeYk2D7S-p","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/ui/datavault/TemplateCard.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/integration/datavault.permissions.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767814155826,"env":"test","module":"auth-routes","userId":"Dmak3kL8epiRfKGldav6q","msg":"User logged in successfully"}
{"level":30,"time":1767814155876,"env":"test","module":"audit-log-service","userId":"Dmak3kL8epiRfKGldav6q","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814155882,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814155894,"env":"test","module":"auth-routes","userId":"873298a7594f2fd8956dabfb1efacd1d","msg":"Login requires MFA verification"}
stdout | tests/unit/services/AIService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

{"level":30,"time":1767814155927,"env":"test","module":"auth-routes","userId":"a93c7bc233788c0a48bea230e1c7441d","msg":"User logged in successfully"}
stdout | tests/unit/services/intakeQuestionVisibility.test.ts > IntakeQuestionVisibilityService > Helper methods > should get visible question count
MOCK SETUP DONE. Mock questions: [
  {
    id: [32m'q1'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q1'[39m,
    order: [33m0[39m,
    isVirtual: [33mfalse[39m,
    alias: [32m'show'[39m,
    visibleIf: [1mnull[22m
  },
  {
    id: [32m'q2'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q2'[39m,
    order: [33m1[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: { op: [32m'equals'[39m, left: [36m[Object][39m, right: [36m[Object][39m }
  },
  {
    id: [32m'q3'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q3'[39m,
    order: [33m2[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: [1mnull[22m
  }
]
Calling getVisibleQuestionCount...

stdout | tests/unit/services/intakeQuestionVisibility.test.ts > IntakeQuestionVisibilityService > Helper methods > should get visible question count
COUNT RESULT: [33m0[39m
Mock called times: [33m1[39m
Mock last call args: [ [ [32m'section1'[39m ] ]

{"level":30,"time":1767814155981,"env":"test","module":"audit-log-service","userId":"a93c7bc233788c0a48bea230e1c7441d","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814155990,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
stdout | tests/unit/services/intakeQuestionVisibility.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ¥» tests/unit/services/intakeQuestionVisibility.test.ts (19 tests | 2 failed) 1588ms
       Γ£ô should return all questions as visible when no conditions 5ms
       Γ£ô should exclude virtual steps from visibility evaluation 1ms
       Γ£ô should maintain question order 1ms
       Γ£ô should hide questions when visibleIf is false 2ms
       Γ£ô should show questions when visibleIf is true 1ms
       Γ£ô should handle complex visibleIf conditions 1ms
       Γ£ô should handle OR conditions 1ms
       Γ£ô should handle NOT conditions 0ms
       Γ£ô should include visible required questions in validation 1ms
       Γ£ô should skip hidden questions in validation 1ms
       Γ£ô should check if question is visible 1ms
       Γ£ô should get visible question count 2ms
       ├ù should clear values for hidden questions 8ms
       Γ£ô should not clear values for visible questions 1ms
       Γ£ô should warn if required question has visibility condition 1ms
       Γ£ô should warn if virtual step has visibility condition 0ms
       Γ£ô should return no warnings for valid configuration 0ms
       Γ£ô should default to visible on condition evaluation error 2ms
       ├ù should handle questions that depend on each other 8ms
{"level":50,"time":1767814156099,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814156116,"env":"test","module":"auth-routes","userId":"a93c7bc233788c0a48bea230e1c7441d","sessionCount":1,"msg":"Listed active sessions"}
stdout | tests/unit/services/intakeNavigation.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/unit/services/intakeNavigation.test.ts
≡ƒº¬ Setting up test environment...

{"level":40,"time":1767814156231,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814156316,"env":"test","module":"user-credentials-repository","userId":"7v-zl993TG6xstdldbd7Z","msg":"User credentials created"}
stdout | tests/unit/services/intakeNavigation.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814156414,"env":"test","module":"email-queue","jobId":"16a2cd63-b68b-4609-9fb0-1890403e2540","to":"protected-test--jqtTbogepoRrSXv_4rj_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/client/choice-utils.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/client/choice-utils.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814156465,"env":"test","module":"auth-routes","userId":"7v-zl993TG6xstdldbd7Z","email":"protected-test--jqtTbogepoRrSXv_4rj_@example.com","msg":"User registered"}
stdout | tests/unit/isolatedVmBridge.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/isolatedVmBridge.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814156531,"env":"test","module":"user-credentials-repository","userId":"yh3m1urHxWpV012gUhakG","msg":"User credentials created"}
stdout | tests/unit/client/choice-utils.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/workflow_versioning.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767814156662,"env":"test","module":"email-queue","jobId":"7530fb82-ade6-43fa-a273-56e38a6fc83b","to":"middleware-test-1qycjUdh_b9-3A90YfGGq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/isolatedVmBridge.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814156714,"env":"test","module":"auth-routes","userId":"yh3m1urHxWpV012gUhakG","email":"middleware-test-1qycjUdh_b9-3A90YfGGq@example.com","msg":"User registered"}
{"level":50,"time":1767814156778,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/ui/datavault/TemplateCard.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/ui/datavault/TemplateCard.test.tsx
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/AIService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/unit/services/AIService.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/unit/services/intakeNavigation.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/api.dataSources.native.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/integration/api.dataSources.native.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/ui/datavault/TemplateCard.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/AIService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814157007,"env":"test","module":"email-queue","jobId":"f185a9a0-6883-460f-b100-1f0eeab91b87","to":"test-1767814156364-mac17f@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814157007,"env":"test","module":"auth-service","email":"test-1767814156364-mac17f@example.com","msg":"Password reset email sent"}
stderr | tests/unit/client/choice-utils.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/intakeNavigation.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/isolatedVmBridge.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814157177,"env":"test","module":"user-credentials-repository","userId":"KQVSBGvqieTgJEhm2wfre","msg":"User credentials created"}
 Γ¥» tests/unit/services/intakeNavigation.test.ts (17 tests | 17 failed) 1721ms
       ├ù should return all pages in order when no conditions 7ms
       ├ù should handle empty workflow 1ms
       ├ù should calculate correct current page index 1ms
       ├ù should hide pages when visibleIf is false 1ms
       ├ù should show pages when visibleIf is true 1ms
       ├ù should handle complex visibleIf conditions 1ms
       ├ù should skip pages when skipIf is true 0ms
       ├ù should not skip pages when skipIf is false 0ms
       ├ù should apply visibleIf before skipIf 1ms
       ├ù should get first page 1ms
       ├ù should return null for first page if all pages hidden 1ms
       ├ù should validate page navigability 1ms
       ├ù should get page sequence 1ms
       ├ù should default to visible on visibleIf evaluation error 1ms
       ├ù should default to not skipping on skipIf evaluation error 1ms
       ├ù should calculate correct progress for multi-page workflow 1ms
       ├ù should adjust progress when pages are skipped 1ms
{"level":30,"time":1767814157277,"env":"test","module":"email-queue","jobId":"167d248e-ddad-499b-be90-55ebaf0fbd14","to":"protected-test-9l3hjAegcXzYBkzpweJhW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814157287,"env":"test","module":"auth-routes","userId":"yh3m1urHxWpV012gUhakG","msg":"User logged in successfully"}
stdout | tests/integration/workflow_versioning.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1767814157328,"env":"test","module":"auth-routes","userId":"KQVSBGvqieTgJEhm2wfre","email":"protected-test-9l3hjAegcXzYBkzpweJhW@example.com","msg":"User registered"}
{"level":30,"time":1767814157341,"env":"test","module":"audit-log-service","userId":"yh3m1urHxWpV012gUhakG","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/unit/client/choice-utils.test.ts > choice-utils > handles missing content gracefully
[generateOptionsFromList] Invalid list data: null

stdout | tests/unit/client/choice-utils.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ¥» tests/unit/client/choice-utils.test.ts (10 tests | 1 failed) 1629ms
     Γ£ô generates options with basic mapping 5ms
     Γ£ô sorts by label asc 1ms
     Γ£ô sorts by label desc 0ms
     Γ£ô dedupes by label 1ms
     Γ£ô dedupes by value (alias) 1ms
     ├ù uses label template with column names 9ms
     Γ£ô handles missing content gracefully 1ms
     Γ£ô includes blank option at the top 1ms
     Γ£ô sorts by specific column asc 0ms
     Γ£ô sorts by specific column desc 0ms
{"level":40,"time":1767814157442,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1767814157448,"env":"test","module":"auth-routes","userId":"4e0adc157c57718f7e14d779dad85afd","msg":"User logged in successfully"}
stdout | tests/unit/isolatedVmBridge.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":40,"time":1767814157446,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767814157448,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767814157457,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767814157464,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1767814157500,"env":"test","module":"audit-log-service","userId":"4e0adc157c57718f7e14d779dad85afd","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/integration/api.dataSources.native.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/ui/datavault/TemplateCard.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/services/AIService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ¥» tests/unit/isolatedVmBridge.test.ts (5 tests | 1 failed) 1686ms
     Γ£ô should execute JS and use simple helpers (string) 9ms
     Γ£ô should execute JS and use complex helpers (math.sum) 2ms
     ├ù should execute JS and capture console logs 8ms
     Γ£ô should access context data 7ms
     Γ£ô should fail on missing helper 5ms
stdout | tests/integration/workflow_versioning.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/workflow_versioning.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814157616,"env":"test","module":"auth-routes","userId":"4e0adc157c57718f7e14d779dad85afd","sessionCount":1,"msg":"Listed active sessions"}
stderr | tests/ui/datavault/TemplateCard.test.tsx
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:184:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:164:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:126:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":50,"time":1767814157633,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814157634,"env":"test","module":"auth-routes","userId":"7ad8965cc27cce96cee43ec6eea90011","msg":"Login requires MFA verification"}
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render template name and description
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should show "Coming Soon" badge
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render preview columns
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should limit preview columns to 5 and show count for remaining
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should handle empty preview columns
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should have cursor-not-allowed style
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

stdout | tests/ui/datavault/TemplateCard.test.tsx
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/datavault.permissions.test.ts
≡ƒº¬ Setting up test environment...

{"level":50,"time":1767814157707,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/integration/ai/workflowEdit.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1767814157744,"env":"test","module":"mfa-service","userId":"7ad8965cc27cce96cee43ec6eea90011","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814157744,"env":"test","module":"auth-routes","userId":"7ad8965cc27cce96cee43ec6eea90011","msg":"MFA verification failed during login"}
{"level":50,"time":1767814157750,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/integration/datavault.permissions.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ¥» tests/ui/datavault/TemplateCard.test.tsx (6 tests | 6 failed) 1575ms
     ├ù should render template name and description 31ms
     ├ù should show "Coming Soon" badge 5ms
     ├ù should render preview columns 6ms
     ├ù should limit preview columns to 5 and show count for remaining 5ms
     ├ù should handle empty preview columns 5ms
     ├ù should have cursor-not-allowed style 6ms
{"level":30,"time":1767814157784,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814157803,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767814157805,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/api.dataSources.native.test.ts > Data Sources API - Native Catalog
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814157793,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814157793,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814157799,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814157805,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814157805,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814157805,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814157805,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stdout | tests/unit/services/AIService.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814157805,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767814157805,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":66,"totalTokens":878,"durationMs":1,"estimatedCostUSD":0.00010760000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814157810,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"},"duration":6,"msg":"AI workflow revision failed"}
{"level":50,"time":1767814157811,"env":"test","module":"ai-service","duration":8,"error":{"code":"VALIDATION_ERROR","details":{"originalError":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"}},"troubleshooting":"≡ƒöº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"msg":"AI workflow revision failed"}
{"level":30,"time":1767814157823,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767814157823,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767814157823,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":45,"totalTokens":857,"durationMs":0,"estimatedCostUSD":0.00009920000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814157824,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow revision failed"}
{"level":50,"time":1767814157824,"env":"test","module":"ai-service","duration":1,"error":{"code":"VALIDATION_ERROR","details":{"originalError":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"}},"troubleshooting":"≡ƒöº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"msg":"AI workflow revision failed"}
{"level":30,"time":1767814157825,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767814157825,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767814157826,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":1,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1767814157826,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1767814157826,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1767814157827,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":2,"msg":"AI workflow revision failed"}
{"level":40,"time":1767814157827,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"actualOutputTokens":4,"responseLength":13,"msg":"Single-shot revision truncated - automatically retrying with chunking"}
{"level":30,"time":1767814157827,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767814157827,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1767814157827,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1767814157827,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1767814157827,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":0,"msg":"AI workflow revision failed"}
{"level":50,"time":1767814157827,"env":"test","module":"ai-service","duration":2,"error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"msg":"AI workflow revision failed"}
 Γ¥» tests/unit/services/AIService.test.ts (3 tests | 2 failed) 1678ms
     ├ù reviseWorkflow should parse valid JSON response correctly 21ms
     ├ù reviseWorkflow should handle JSON markdown code blocks 2ms
     Γ£ô reviseWorkflow should throw on invalid JSON 5ms
stdout | tests/integration/workflows/runtime-pipelines.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/integration/analytics_service.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767814158040,"env":"test","module":"user-credentials-repository","userId":"INyRJ9PXBS_0FyVcHcIin","msg":"User credentials created"}
stderr | tests/integration/workflow_versioning.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814158127,"env":"test","module":"user-credentials-repository","userId":"VTtbWLcV0urqiNL33IaZy","msg":"User credentials created"}
{"level":30,"time":1767814158142,"env":"test","module":"email-queue","jobId":"eb329cb1-8360-47fa-8ac4-f01614948851","to":"protected-test-lweGPrDbuYNnad8b_LIus@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814158197,"env":"test","module":"auth-routes","userId":"INyRJ9PXBS_0FyVcHcIin","email":"protected-test-lweGPrDbuYNnad8b_LIus@example.com","msg":"User registered"}
stderr | tests/integration/datavault.permissions.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814158230,"env":"test","module":"email-queue","jobId":"e686d8eb-cb8c-482a-8a74-be0f45d3bb2c","to":"middleware-test-LRzYLli3pJQJErdlf3252@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814158281,"env":"test","module":"auth-routes","userId":"VTtbWLcV0urqiNL33IaZy","email":"middleware-test-LRzYLli3pJQJErdlf3252@example.com","msg":"User registered"}
stdout | tests/ListTools.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

{"level":30,"time":1767814158311,"env":"test","module":"user-credentials-repository","userId":"CNKnEUNNSEdEgJHgeq3vs","msg":"User credentials created"}
stdout | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/ui/datavault/DatabaseSettingsPage.test.tsx
≡ƒº¬ Setting up test environment...

stdout | tests/integration/api.runs.docx.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767814158430,"env":"test","module":"email-queue","jobId":"b85f9bb9-bdca-4f04-ba92-fbb93c009e04","to":"test-0R1HM7qMhn5CdeqyMStyl@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814158496,"env":"test","module":"auth-routes","userId":"CNKnEUNNSEdEgJHgeq3vs","email":"test-0R1HM7qMhn5CdeqyMStyl@example.com","msg":"User registered"}
{"level":50,"time":1767814158513,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/ui/datavault/DatabaseSettingsPage.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":50,"time":1767814158611,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/workflows/runtime-pipelines.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

{"level":30,"time":1767814158704,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
stdout | tests/integration/ai/workflowEdit.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/ai.service.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814158705,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":6,"totalTokens":1207,"durationMs":1,"estimatedCostUSD":0.01219,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814158705,"env":"test","module":"ai-service","error":{},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767814158710,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767814158710,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"responseTokens":68,"totalTokens":1280,"durationMs":0,"estimatedCostUSD":0.004656,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814158711,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767814158713,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767814158713,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"responseTokens":33,"totalTokens":1234,"durationMs":0,"estimatedCostUSD":0.004098,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767814158714,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767814158732,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"maxTokens":4000,"msg":"AI request started"}
{"level":30,"time":1767814158733,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"responseTokens":44,"totalTokens":302,"durationMs":16,"estimatedCostUSD":0.0039,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1767814158734,"env":"test","module":"ai-service","duration":17,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
stdout | tests/integration/analytics_service.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

 Γ¥» tests/unit/ai.service.test.ts (11 tests | 7 failed) 31994ms
       Γ£ô should initialize with OpenAI configuration 4ms
       ├ù should generate a valid workflow from description 21ms
       ├ù should validate unique section IDs 41ms
       ├ù should validate unique step IDs 9ms
       ├ù should validate logic rules reference existing steps 9ms
       ├ù should handle rate limit errors 30009ms
       Γ£ô should handle JSON parsing errors 3ms
       Γ£ô should initialize with Anthropic configuration 3ms
       ├ù should generate a valid workflow from description 3ms
       ├ù should strip markdown code blocks from Anthropic responses 2ms
       Γ£ô should generate binding suggestions 20ms
stdout | tests/integration/workflow_versioning.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/ai/workflowEdit.test.ts
≡ƒº¬ Setting up test environment...

{"level":50,"time":1767814158868,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814158891,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814158902,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814158911,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 Γ¥» tests/integration/workflow_versioning.test.ts (3 tests | 2 failed) 1319ms
     Γ£ô should diff two versions correctly 3ms
     ├ù should create a version and populate changelog 9ms
     ├ù should track execution lineage via snapshot 57ms
{"level":50,"time":1767814158930,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/integration/ai/workflowEdit.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":50,"time":1767814158939,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814158944,"env":"test","module":"user-credentials-repository","userId":"H9Cb2M3JnOERccNU6QBRa","msg":"User credentials created"}
{"level":50,"time":1767814158947,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814158957,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814158969,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814158977,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814158984,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814158994,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814158997,"env":"test","module":"auth-routes","userId":"fbf1c56acfa64848fad70f9094d5a347","msg":"User logged in successfully"}
{"level":50,"time":1767814159002,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814159010,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814159018,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814159026,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814159033,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814159036,"env":"test","module":"user-credentials-repository","userId":"7OO_W4TqjUAM_mgUZQk4e","msg":"User credentials created"}
{"level":50,"time":1767814159038,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error fetching native catalog"}
{"level":30,"time":1767814159041,"env":"test","module":"email-queue","jobId":"9f76edc8-03a2-42fb-84a1-5cbbd0cca9d4","to":"protected-test-hGvgmCGNinYrZttxSu295@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814159051,"env":"test","module":"audit-log-service","userId":"fbf1c56acfa64848fad70f9094d5a347","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":50,"time":1767814159095,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814159094,"env":"test","module":"auth-routes","userId":"H9Cb2M3JnOERccNU6QBRa","email":"protected-test-hGvgmCGNinYrZttxSu295@example.com","msg":"User registered"}
stdout | tests/ListTools.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767814159141,"env":"test","module":"email-queue","jobId":"9a1cc34f-ad48-4690-8334-2654ad0a7679","to":"middleware-test-ssdoYbHMaHz86mDIkywEt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814159156,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814159161,"env":"test","module":"auth-routes","userId":"fbf1c56acfa64848fad70f9094d5a347","sessionCount":1,"msg":"Listed active sessions"}
stdout | tests/integration/session.management.real.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814159164,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814159171,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767814159177,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814159196,"env":"test","module":"auth-routes","userId":"7OO_W4TqjUAM_mgUZQk4e","email":"middleware-test-ssdoYbHMaHz86mDIkywEt@example.com","msg":"User registered"}
{"level":50,"time":1767814159231,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 Γ¥» tests/integration/session.management.real.test.ts (18 tests | 12 failed) 29120ms
       ├ù should list all active sessions for current user 2115ms
       ├ù should mark current session correctly 1346ms
       ├ù should exclude revoked sessions 1725ms
       ├ù should order sessions by last used (most recent first) 1808ms
       ├ù should filter sessions by current user only 1979ms
       Γ£ô should return 401 for unauthenticated request  436ms
       ├ù should revoke specific session 1606ms
       ├ù should prevent revoking current session 1056ms
       Γ£ô should return 404 for non-existent session  1424ms
       ├ù should prevent revoking other user's session 1730ms
       ├ù should revoke all other sessions 2201ms
       Γ£ô should keep current session active  2476ms
       ├ù should return 400 if no active session found 1111ms
       ├ù should revoke all trusted devices 1048ms
       ├ù should handle user with single session gracefully 1740ms
       Γ£ô should include device metadata in sessions  1605ms
       Γ£ô should not expose sensitive token data  1500ms
       Γ£ô should track session activity timestamps  1546ms
{"level":30,"time":1767814159346,"env":"test","module":"mfa-service","userId":"97c235136fecb124dec70e36369ecf13","msg":"TOTP verification successful"}
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
{"level":30,"time":1767814159391,"env":"test","module":"email-queue","jobId":"e1414652-762a-4386-8578-e196286da16e","to":"test-1767814158743-s6ilr4@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render database settings page with breadcrumbs
The above error occurred in the <DatabaseSettingsPage> component:

    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:28:3)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1767814159392,"env":"test","module":"auth-service","email":"test-1767814158743-s6ilr4@example.com","msg":"Password reset email sent"}
stdout | tests/integration/datavault.permissions.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814159399,"env":"test","module":"auth-routes","userId":"97c235136fecb124dec70e36369ecf13","msg":"MFA login successful"}
stderr | tests/integration/ai/workflowEdit.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render DatabaseSettings component with database data
The above error occurred in the <DatabaseSettingsPage> component:

    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:28:3)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

stdout | tests/unit/api.ai.logic.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should display database name in header
The above error occurred in the <DatabaseSettingsPage> component:

    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:28:3)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

stdout | tests/integration/api.projects.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/integration/api.dataSources.native.test.ts
≡ƒº╣ Cleaning up test environment...

ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render sidebar
The above error occurred in the <DatabaseSettingsPage> component:

    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:28:3)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

stdout | tests/ui/datavault/DatabaseSettingsPage.test.tsx
≡ƒº╣ Cleaning up test environment...

 Γ¥» tests/ui/datavault/DatabaseSettingsPage.test.tsx (7 tests | 7 failed) 1745ms
     ├ù should render database settings page with breadcrumbs 42ms
     ├ù should show loading state 9ms
     ├ù should show not found state when database does not exist 2ms
     ├ù should render DatabaseSettings component with database data 9ms
     ├ù should navigate back when back button is clicked 12ms
     ├ù should display database name in header 6ms
     ├ù should render sidebar 10ms
 Γ¥» tests/integration/datavault.permissions.test.ts (22 tests | 22 failed) 1693ms
       ├ù should allow owner to read table 35ms
       ├ù should allow writer to read table 12ms
       ├ù should allow reader to read table 8ms
       ├ù should deny non-member from reading table 8ms
       ├ù should allow owner to update table 19ms
       ├ù should deny writer from updating table 9ms
       ├ù should deny reader from updating table 9ms
       ├ù should deny writer from deleting table 12ms
       ├ù should deny reader from deleting table 8ms
       ├ù should deny non-member from deleting table 8ms
       ├ù should allow owner to view permissions 8ms
       ├ù should deny writer from viewing permissions 10ms
       ├ù should deny reader from viewing permissions 7ms
       ├ù should allow owner to grant permissions 9ms
       ├ù should allow owner to update existing permission (upsert) 8ms
       ├ù should deny writer from granting permissions 8ms
       ├ù should prevent modifying table owner permissions 7ms
       ├ù should allow owner to revoke permissions 62ms
       ├ù should deny writer from revoking permissions 62ms
       ├ù should enforce owner includes write and read 7ms
       ├ù should enforce write includes read but not owner 6ms
       ├ù should enforce read is read-only 7ms
stdout | tests/integration/api.runs.docx.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

{"level":30,"time":1767814159664,"env":"test","module":"auth-routes","userId":"H9Cb2M3JnOERccNU6QBRa","msg":"User logged in successfully"}
stdout | tests/ListTools.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814159716,"env":"test","module":"audit-log-service","userId":"H9Cb2M3JnOERccNU6QBRa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/ListTools.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ¥» tests/integration/api.dataSources.native.test.ts (2 tests | 1 failed) 2509ms
     ├ù should list databases and databases' tables in the catalog 361ms
     Γ£ô should create a native_table data source  343ms
{"level":30,"time":1767814159790,"env":"test","module":"auth-routes","userId":"7OO_W4TqjUAM_mgUZQk4e","msg":"User logged in successfully"}
{"level":30,"time":1767814159834,"env":"test","module":"user-credentials-repository","userId":"b88b8efe02a5fa6e2a0bf2f2bdfb7f4d","msg":"User password updated"}
{"level":30,"time":1767814159844,"env":"test","module":"audit-log-service","userId":"7OO_W4TqjUAM_mgUZQk4e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/integration/workflows/runtime-pipelines.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/schema/collections.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/integration/workflows/runtime-pipelines.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814160009,"env":"test","module":"audit-log-service","userId":"b88b8efe02a5fa6e2a0bf2f2bdfb7f4d","eventType":"password_reset","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/integration/analytics_service.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/analytics_service.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":40,"time":1767814160114,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stdout | tests/unit/api.ai.revise.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/integration/ai/workflowEdit.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/api.ai.doc.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

 Γ¥» tests/integration/ai/workflowEdit.test.ts (8 tests | 8 skipped) 1282ms
     Γåô should create draft version on successful AI edit
     Γåô should enforce draft mode (revert active workflow to draft)
     Γåô should not create version when no changes detected (checksum match)
     Γåô should reject unauthorized access
     Γåô should reject unsafe DataVault operations
     Γåô should handle multi-operation edits with tempId resolution
     Γåô should create BEFORE and AFTER snapshots
     Γåô should rollback on validation failure
stderr | tests/ListTools.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814160267,"env":"test","module":"user-credentials-repository","userId":"rszTEeycNPafC4ttR44BN","msg":"User credentials created"}
{"level":30,"time":1767814160267,"env":"test","module":"user-credentials-repository","userId":"vLTzalOPX662uzexBm2fS","msg":"User credentials created"}
{"level":50,"time":1767814160279,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814160369,"env":"test","module":"email-queue","jobId":"62a8b55f-d348-4d0a-bf17-74f90d529fd7","to":"protected-test-6PFlWjZ3AWuPoAAf5AyxX@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814160369,"env":"test","module":"email-queue","jobId":"8b02ea7f-1b36-4e77-9d7f-e9183fb28b6d","to":"cookie-test-FFIkrqJI8xeU-Q_2mjed_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/debugging/Lineage.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

{"level":30,"time":1767814160422,"env":"test","module":"auth-routes","userId":"vLTzalOPX662uzexBm2fS","email":"cookie-test-FFIkrqJI8xeU-Q_2mjed_@example.com","msg":"User registered"}
{"level":30,"time":1767814160422,"env":"test","module":"auth-routes","userId":"rszTEeycNPafC4ttR44BN","email":"protected-test-6PFlWjZ3AWuPoAAf5AyxX@example.com","msg":"User registered"}
stderr | tests/integration/workflows/runtime-pipelines.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/api.ai.logic.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

{"level":50,"time":1767814160514,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"filtered_users","filters":{"combinator":"and","rules":[{"fieldPath":"city","op":"equals","valueSource":"const","value":"NYC"}]}},"msg":"List tools block failed"}
stdout | tests/ListTools.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814160525,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"senior_users","filters":{"combinator":"and","rules":[{"fieldPath":"age","op":"greater_than","valueSource":"const","value":30}]}},"msg":"List tools block failed"}
{"level":50,"time":1767814160527,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"active_nyc","filters":{"combinator":"and","rules":[{"fieldPath":"city","op":"equals","valueSource":"const","value":"NYC"},{"fieldPath":"active","op":"equals","valueSource":"const","value":true}]}},"msg":"List tools block failed"}
{"level":50,"time":1767814160529,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"young_or_sf","filters":{"combinator":"or","rules":[{"fieldPath":"age","op":"less_than","valueSource":"const","value":28},{"fieldPath":"city","op":"equals","valueSource":"const","value":"SF"}]}},"msg":"List tools block failed"}
{"level":50,"time":1767814160531,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"age","direction":"asc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767814160533,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"name","direction":"desc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767814160535,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"city","direction":"asc"},{"fieldPath":"age","direction":"desc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767814160537,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"limited_users","limit":3},"msg":"List tools block failed"}
{"level":50,"time":1767814160539,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"offset_users","offset":2},"msg":"List tools block failed"}
{"level":50,"time":1767814160542,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"paged_users","offset":1,"limit":2},"msg":"List tools block failed"}
{"level":50,"time":1767814160551,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"name_age_only","select":["name","age"]},"msg":"List tools block failed"}
{"level":50,"time":1767814160553,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"unique_cities","dedupe":{"fieldPath":"city"}},"msg":"List tools block failed"}
{"level":50,"time":1767814160555,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"all_users","outputs":{"countVar":"user_count"}},"msg":"List tools block failed"}
{"level":50,"time":1767814160565,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"all_users","sort":[{"fieldPath":"age","direction":"asc"}],"outputs":{"firstVar":"youngest_user"}},"msg":"List tools block failed"}
{"level":50,"time":1767814160567,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"processed_users","filters":{"combinator":"and","rules":[{"fieldPath":"active","op":"equals","valueSource":"const","value":true}]},"sort":[{"fieldPath":"age","direction":"desc"}],"offset":0,"limit":2,"select":["name","age"],"outputs":{"countVar":"active_count","firstVar":"oldest_active"}},"msg":"List tools block failed"}
{"level":50,"time":1767814160569,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"filtered_users","filters":{"combinator":"and","rules":[{"fieldPath":"age","op":"greater_than","valueSource":"const","value":30}]}},"msg":"List tools block failed"}
{"level":40,"time":1767814160570,"env":"test","sourceListVar":"nonexistent_list","inputKey":"nonexistent_list","msg":"Input list not found, treating as empty array"}
{"level":50,"time":1767814160571,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"simple_array","outputListVar":"sorted_array","sort":[{"fieldPath":"score","direction":"desc"}]},"msg":"List tools block failed"}
stdout | tests/integration/api.projects.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stderr | tests/integration/analytics_service.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ¥» tests/ListTools.test.ts (18 tests | 17 failed) 903ms
       ├ù should filter rows by equals condition 12ms
       ├ù should filter with greater_than operator 2ms
       ├ù should filter with AND combinator 2ms
       ├ù should filter with OR combinator 2ms
       ├ù should sort by single key ascending 2ms
       ├ù should sort by single key descending 2ms
       ├ù should sort by multiple keys 2ms
       ├ù should apply limit 2ms
       ├ù should apply offset 2ms
       ├ù should apply offset and limit together 10ms
       ├ù should select specific columns 2ms
       ├ù should deduplicate by field 2ms
       ├ù should output count variable 2ms
       ├ù should output first row variable 10ms
       ├ù should apply all operations in sequence 2ms
       ├ù should handle empty input list 2ms
       Γ£ô should handle missing source list 1ms
       ├ù should handle plain arrays 2ms
stdout | tests/unit/services/StepService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/unit/schema/collections.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/schema/collections.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/schema/collections.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/api.ai.logic.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/api.ai.logic.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814160994,"env":"test","module":"auth-routes","userId":"rszTEeycNPafC4ttR44BN","msg":"User logged in successfully"}
{"level":30,"time":1767814161005,"env":"test","module":"auth-routes","userId":"vLTzalOPX662uzexBm2fS","msg":"User logged in successfully"}
{"level":30,"time":1767814161046,"env":"test","module":"audit-log-service","userId":"rszTEeycNPafC4ttR44BN","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814161054,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814161061,"env":"test","module":"audit-log-service","userId":"vLTzalOPX662uzexBm2fS","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767814161082,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814161160,"env":"test","module":"mfa-service","userId":"7a57186d6c642860c2fd73dfcb133daf","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767814161160,"env":"test","module":"auth-routes","userId":"7a57186d6c642860c2fd73dfcb133daf","msg":"MFA verification failed during login"}
{"level":50,"time":1767814161165,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/unit/api.ai.revise.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/integration/workflows/runtime-pipelines.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/analytics_service.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/debugging/Lineage.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/integration/api.snapshots.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767814161320,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 Γ¥» tests/integration/workflows/runtime-pipelines.test.ts (4 tests | 4 skipped) 1279ms
       Γåô should create DataVault row on workflow completion
       Γåô should execute writebacks via RunService.completeRun()
       Γåô should skip document generation when visibleIf condition is false
       Γåô should generate document when visibleIf condition is true
 Γ¥» tests/integration/analytics_service.test.ts (1 test | 1 failed) 1181ms
     ├ù should generate events and metrics on run completion 66ms
stderr | tests/unit/schema/collections.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/api.ai.doc.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stderr | tests/unit/api.ai.logic.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814161477,"env":"test","module":"user-credentials-repository","userId":"tVRvEQxc7Ar7ANHLbeYTr","msg":"User credentials created"}
stdout | tests/unit/services/StepService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767814161581,"env":"test","module":"email-queue","jobId":"c9e6c7a4-47bb-46a0-bc10-450cb4c17072","to":"user2-hU1Hlsd7bMvNK7sAndKQ-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814161597,"env":"test","module":"user-credentials-repository","userId":"zHTpC8MD3SvmcKsnDw8kG","msg":"User credentials created"}
{"level":30,"time":1767814161631,"env":"test","module":"auth-routes","userId":"tVRvEQxc7Ar7ANHLbeYTr","email":"user2-hU1Hlsd7bMvNK7sAndKQ-@example.com","msg":"User registered"}
stdout | tests/unit/api.ai.revise.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/api.ai.revise.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814161698,"env":"test","module":"email-queue","jobId":"50d492b0-d69b-4b4a-a430-a8ab75b1b777","to":"middleware-test-HfNTWjjNHr3SPR_xHD0Kb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814161723,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
stdout | tests/unit/schema/collections.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814161756,"env":"test","module":"auth-routes","userId":"zHTpC8MD3SvmcKsnDw8kG","email":"middleware-test-HfNTWjjNHr3SPR_xHD0Kb@example.com","msg":"User registered"}
{"level":50,"time":1767814161763,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI logic generation failed"}
stderr | tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/generate-logic > should return generated logic
Logic Test Failed: {
  "success": false,
  "message": "Invalid request data",
  "error": "validation_error",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": [
        "currentWorkflow",
        "title"
      ],
      "message": "Required"
    }
  ]
}

 Γ¥» tests/unit/schema/collections.test.ts (34 tests | 1 failed) 994ms
       Γ£ô should have correct table name 3ms
       Γ£ô should have required columns 2ms
       Γ£ô should have correct table name 0ms
       Γ£ô should have required columns 1ms
       Γ£ô should have correct table name 0ms
       Γ£ô should have required columns 1ms
       Γ£ô should have all expected field types 1ms
         Γ£ô should validate valid collection data 3ms
         Γ£ô should require tenantId, name, and slug 1ms
         ├ù should omit id, createdAt, and updatedAt 9ms
         Γ£ô should allow description to be null 0ms
         Γ£ô should validate valid field data 1ms
         Γ£ô should require collectionId, name, slug, and type 0ms
         Γ£ô should validate field type enum 1ms
         Γ£ô should reject invalid field type 0ms
         Γ£ô should allow options for select types 2ms
         Γ£ô should allow defaultValue 0ms
         Γ£ô should validate valid record data 1ms
         Γ£ô should require tenantId, collectionId, and data 0ms
         Γ£ô should allow empty data object 0ms
         Γ£ô should allow createdBy and updatedBy to be null 0ms
         Γ£ô should allow complex nested data structures 1ms
       Γ£ô should enforce unique slug per tenant for collections 0ms
       Γ£ô should enforce unique slug per collection for fields 0ms
       Γ£ô should cascade delete fields when collection is deleted 0ms
       Γ£ô should cascade delete records when collection is deleted 0ms
       Γ£ô should cascade delete records when tenant is deleted 0ms
       Γ£ô should set null on createdBy/updatedBy when user is deleted 0ms
       Γ£ô should support JSONB for field options 0ms
       Γ£ô should support JSONB for field default values 0ms
       Γ£ô should support JSONB for record data with fieldSlug ΓåÆ value mapping 0ms
       Γ£ô should correctly infer Collection type 0ms
       Γ£ô should correctly infer CollectionField type 0ms
       Γ£ô should correctly infer CollectionRecord type 0ms
{"level":30,"time":1767814161820,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767814161830,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI debug logic failed"}
{"level":30,"time":1767814161834,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767814161840,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI visualize logic failed"}
stdout | tests/unit/api.ai.logic.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/StepService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/StepService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/api.runs.graph.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

 Γ¥» tests/unit/api.ai.logic.test.ts (3 tests | 3 failed) 906ms
       ├ù should return generated logic 64ms
       ├ù should return debug issues 51ms
       ├ù should return graph data 12ms
stdout | tests/integration/js_helpers.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1767814161952,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":50,"time":1767814161962,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/unit/api.ai.revise.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":50,"time":1767814162257,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814162263,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814162339,"env":"test","module":"auth-routes","userId":"zHTpC8MD3SvmcKsnDw8kG","msg":"User logged in successfully"}
{"level":30,"time":1767814162361,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814162376,"env":"test","module":"user-credentials-repository","userId":"wFC-mKjTCy1MavX8xRkGd","msg":"User credentials created"}
{"level":30,"time":1767814162393,"env":"test","module":"audit-log-service","userId":"zHTpC8MD3SvmcKsnDw8kG","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/unit/services/StepService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814162445,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
stdout | tests/unit/writes/WriteRunner.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/integration/api.snapshots.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":50,"time":1767814162481,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
{"level":30,"time":1767814162490,"env":"test","module":"email-queue","jobId":"d602acfb-c022-4940-be9f-f67d904d502c","to":"protected-test-Li9goxcIpmEWRoMJXpspC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/api.ai.revise.test.ts > AI Routes Integration > POST /api/ai/workflows/revise > should call AIService.reviseWorkflow with correct parameters
Revise Test Failed: {
  "success": false,
  "message": "Invalid request data",
  "error": "validation_error",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": [
        "currentWorkflow",
        "title"
      ],
      "message": "Required"
    }
  ]
}

{"level":30,"time":1767814162503,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767814162514,"env":"test","module":"ai-controller","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["workflowId"]},{"code":"invalid_type","expected":"object","received":"undefined","path":["currentWorkflow"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["userInstruction"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
stdout | tests/unit/api.ai.revise.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814162543,"env":"test","module":"auth-routes","userId":"wFC-mKjTCy1MavX8xRkGd","email":"protected-test-Li9goxcIpmEWRoMJXpspC@example.com","msg":"User registered"}
stdout | tests/unit/writes/WriteRunner.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/writes/WriteRunner.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/writes/WriteRunner.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:119:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1767814162566,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767814162578,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
stdout | tests/unit/writes/WriteRunner.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814162578,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1767814162580,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767814162583,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1767814162584,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
 Γ¥» tests/unit/api.ai.revise.test.ts (2 tests | 1 failed) 871ms
       ├ù should call AIService.reviseWorkflow with correct parameters 61ms
       Γ£ô should return 400 for invalid request usage 16ms
 Γ¥» tests/unit/writes/WriteRunner.test.ts (4 tests | 2 failed) 35ms
       ├ù should resolve values and call createRowWithValues 14ms
       Γ£ô should simulate write in preview mode 2ms
       ├ù should find row by PK and update 3ms
       Γ£ô should return failure result if row not found 1ms
stdout | tests/integration/auth/portal.authentication.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767814162677,"env":"test","module":"email-queue","jobId":"4d265a96-3335-4e5f-80ad-4621254a49eb","to":"test-1767814162021-1vdb5t@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814162677,"env":"test","module":"auth-service","email":"test-1767814162021-1vdb5t@example.com","msg":"Password reset email sent"}
stdout | tests/unit/services/StepService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/debugging/Lineage.test.ts
≡ƒº¬ Setting up test environment...

 Γ¥» tests/unit/services/StepService.test.ts (14 tests | 1 failed) 878ms
       ├ù should create a step with auto-incrementing order 17ms
       Γ£ô should create step with order 1 if section is empty 2ms
       Γ£ô should validate alias uniqueness before creating 3ms
       Γ£ô should allow creating step with null alias 1ms
       Γ£ô should throw error if section not found 1ms
       Γ£ô should verify workflow ownership 1ms
       Γ£ô should update step successfully 2ms
       Γ£ô should validate alias uniqueness when updating alias 1ms
       Γ£ô should allow updating step without changing alias 1ms
       Γ£ô should throw error if step not found 1ms
       Γ£ô should throw error if step does not belong to workflow 1ms
       Γ£ô should delete step successfully 1ms
       Γ£ô should throw error if step not found 1ms
       Γ£ô should throw error if step does not belong to workflow 1ms
{"level":50,"time":1767814162849,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/unit/debugging/Lineage.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814162972,"env":"test","module":"user-credentials-repository","userId":"6JrLEK27TKfMh9AM4R-6N","msg":"User credentials created"}
{"level":40,"time":1767814162977,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814163078,"env":"test","module":"email-queue","jobId":"7bcd2e84-4a15-4b26-a1b4-3cee0614a1dc","to":"middleware-test-DJefB_Y6VEw3V-gk9IgGv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814163135,"env":"test","module":"auth-routes","userId":"6JrLEK27TKfMh9AM4R-6N","email":"middleware-test-DJefB_Y6VEw3V-gk9IgGv@example.com","msg":"User registered"}
stdout | tests/integration/js_helpers.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/unit/server/organizationInvites.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/integration/api.runs.graph.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

{"level":30,"time":1767814163288,"env":"test","module":"user-credentials-repository","userId":"0mtYevf5Z373tsHGfrvZc","msg":"User credentials created"}
stdout | tests/unit/services/WorkflowPatchService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stderr | tests/unit/debugging/Lineage.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/WorkflowTemplateService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1767814163399,"env":"test","module":"email-queue","jobId":"b0adad9f-d03b-412c-b546-76de212a9a85","to":"protected-test-8xIyXsoh_4N-FHuoHMLGn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814163444,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/datavault-v4-regression.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1767814163450,"env":"test","module":"auth-routes","userId":"0mtYevf5Z373tsHGfrvZc","email":"protected-test-8xIyXsoh_4N-FHuoHMLGn@example.com","msg":"User registered"}
{"level":30,"time":1767814163454,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1767814163495,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/mfa.flow.real.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/services/WorkflowPatchService.test.ts
[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

stderr | tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should generate execution trace with lineage
[DEBUG Question] Node q1 executed. Key: userName, Value: Alice. Context keys: 3

stdout | tests/unit/debugging/Lineage.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ¥» tests/integration/mfa.flow.real.test.ts (20 tests | 16 failed) 33454ms
       ├ù should complete full MFA setup flow 2258ms
       Γ£ô should reject invalid TOTP code during setup  2026ms
       ├ù should not allow MFA setup if already enabled 1402ms
       ├ù should generate unique backup codes 1106ms
       Γ£ô should store hashed backup codes  1911ms
       ├ù should require MFA for enabled users 1365ms
       ├ù should complete MFA login with valid TOTP 1388ms
       Γ£ô should reject invalid TOTP during login  1487ms
       ├ù should accept TOTP codes within 60-second window 1523ms
       ├ù should login with valid backup code 2034ms
       ├ù should mark backup code as used 1196ms
       Γ£ô should prevent backup code reuse  3083ms
       ├ù should try TOTP before backup code 1580ms
       ├ù should return MFA status for user 1086ms
       ├ù should return backup codes count for MFA users 1796ms
       ├ù should disable MFA with password verification 1805ms
       ├ù should require correct password to disable MFA 1808ms
       ├ù should regenerate backup codes 1607ms
       ├ù should return error if MFA not enabled 1098ms
       ├ù should enforce MFA for tenant users when required by tenant 1232ms
{"level":50,"time":1767814163768,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 Γ¥» tests/unit/debugging/Lineage.test.ts (2 tests | 1 failed) 892ms
     Γ£ô should generate execution trace with lineage 20ms
     ├ù should track skipped blocks in trace 9ms
{"level":40,"time":1767814163828,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814163857,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814163912,"env":"test","module":"user-credentials-repository","userId":"lmiHtHG1Kt5e360p3UeGb","msg":"User credentials created"}
{"level":30,"time":1767814164017,"env":"test","module":"email-queue","jobId":"bf62283d-4864-49c9-8020-63abc8f166da","to":"middleware-test-gPnW1DYEMA3_f3v6YaypH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/server/organizationInvites.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

{"level":30,"time":1767814164069,"env":"test","module":"auth-routes","userId":"lmiHtHG1Kt5e360p3UeGb","email":"middleware-test-gPnW1DYEMA3_f3v6YaypH@example.com","msg":"User registered"}
stdout | tests/unit/server/organizationInvites.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814164217,"env":"test","module":"user-credentials-repository","userId":"Pr4L8h9zasm5pSZSVQ-FF","msg":"User credentials created"}
stdout | tests/unit/server/organizationInvites.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814164317,"env":"test","module":"email-queue","jobId":"2abb9286-2e47-4a18-9e31-ebee0595a035","to":"protected-test-Dmq7-lD11SWuwyHlIhUwa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/services/WorkflowTemplateService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767814164365,"env":"test","module":"auth-routes","userId":"Pr4L8h9zasm5pSZSVQ-FF","email":"protected-test-Dmq7-lD11SWuwyHlIhUwa@example.com","msg":"User registered"}
stdout | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1767814164482,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stdout | tests/unit/services/PdfQueueService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1767814164546,"env":"test","module":"auth-routes","userId":"43adbf9ae85b7ff7945aa676952c53b3","msg":"User logged in successfully"}
stdout | tests/unit/services/WorkflowTemplateService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/engine/templateNode.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

{"level":30,"time":1767814164602,"env":"test","module":"audit-log-service","userId":"43adbf9ae85b7ff7945aa676952c53b3","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814164646,"env":"test","module":"auth-routes","userId":"lmiHtHG1Kt5e360p3UeGb","msg":"User logged in successfully"}
stdout | tests/unit/services/WorkflowTemplateService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814164700,"env":"test","module":"audit-log-service","userId":"lmiHtHG1Kt5e360p3UeGb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/unit/server/organizationInvites.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/datavault-v4-regression.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767814164921,"env":"test","module":"auth-routes","userId":"Pr4L8h9zasm5pSZSVQ-FF","msg":"User logged in successfully"}
{"level":30,"time":1767814164969,"env":"test","module":"audit-log-service","userId":"Pr4L8h9zasm5pSZSVQ-FF","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/unit/services/WorkflowTemplateService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814165141,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767814165232,"env":"test","module":"user-credentials-repository","userId":"hOxUHBs_Rw8BeOq_lBBmB","msg":"User credentials created"}
{"level":30,"time":1767814165244,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stdout | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1767814165342,"env":"test","module":"email-queue","jobId":"bed7b907-3cd3-48cc-a21b-47135e1c2400","to":"middleware-test-PwSHvDnUSkBlh_zN8XVB2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/services/PdfQueueService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

{"level":40,"time":1767814165357,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814165398,"env":"test","module":"auth-routes","userId":"hOxUHBs_Rw8BeOq_lBBmB","email":"middleware-test-PwSHvDnUSkBlh_zN8XVB2@example.com","msg":"User registered"}
stdout | tests/unit/repositories/WorkflowTemplateRepository.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/engine/templateNode.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/repositories/WorkflowTemplateRepository.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814165512,"env":"test","module":"user-credentials-repository","userId":"ZgdLj6Ks8vLU-_5x06D8d","msg":"User credentials created"}
stdout | tests/integration/api.runs.docx.test.ts
≡ƒº¬ Setting up test environment...

{"level":50,"time":1767814165557,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/integration/api.runs.docx.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/PdfQueueService.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814165618,"env":"test","module":"email-queue","jobId":"f1caecc4-3975-4cba-a5b0-4cd9ebb4f4bd","to":"protected-test-Ebz1wm0jIqAvTaYKz712a@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/services/PdfQueueService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814165667,"env":"test","module":"auth-routes","userId":"ZgdLj6Ks8vLU-_5x06D8d","email":"protected-test-Ebz1wm0jIqAvTaYKz712a@example.com","msg":"User registered"}
{"level":50,"time":1767814165712,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814165978,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/unit/repositories/WorkflowTemplateRepository.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/api.runs.docx.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/engine/templateNode.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/unit/services/PdfQueueService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814166153,"env":"test","module":"user-credentials-repository","userId":"yqiaBhRFSZ_GFNCkRkXrf","msg":"User credentials created"}
stdout | tests/unit/engine/templateNode.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814166252,"env":"test","module":"email-queue","jobId":"8c72996f-96db-4253-8b15-7172d5f4b73e","to":"middleware-test-vLl4Bz3g2dbWxLSZ3DQhw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814166301,"env":"test","module":"auth-routes","userId":"yqiaBhRFSZ_GFNCkRkXrf","email":"middleware-test-vLl4Bz3g2dbWxLSZ3DQhw@example.com","msg":"User registered"}
{"level":30,"time":1767814166334,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814166359,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814166344,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814166345,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814166351,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814166358,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814166358,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814166359,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814166359,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1767814166367,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814166395,"env":"test","module":"user-credentials-repository","userId":"2mo1FNhP564UU00oI5p6W","msg":"User credentials created"}
{"level":30,"time":1767814166494,"env":"test","module":"email-queue","jobId":"f0383653-6305-48f8-9985-3b0fe9180e95","to":"protected-test-iQCYCJfTWJBpM0nArFXrC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814166545,"env":"test","module":"auth-routes","userId":"2mo1FNhP564UU00oI5p6W","email":"protected-test-iQCYCJfTWJBpM0nArFXrC@example.com","msg":"User registered"}
stdout | tests/integration/api.runs.docx.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814166613,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814166657,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stderr | tests/unit/engine/templateNode.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/api.projects.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/api.projects.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ¥» tests/integration/api.runs.docx.test.ts (6 tests | 6 skipped) 1020ms
       Γåô should execute workflow with template node and generate DOCX
       Γåô should handle missing template data gracefully
       Γåô should download DOCX output from successful run
       Γåô should return 404 for PDF when not generated
       Γåô should return 404 for non-existent run
       Γåô should extract placeholders from uploaded template
{"level":30,"time":1767814167036,"env":"test","module":"user-credentials-repository","userId":"dlQI96wX2bsNRU1Q6FR6i","msg":"User credentials created"}
{"level":30,"time":1767814167109,"env":"test","module":"auth-routes","userId":"2mo1FNhP564UU00oI5p6W","msg":"User logged in successfully"}
{"level":30,"time":1767814167144,"env":"test","module":"email-queue","jobId":"01225e03-c619-4192-883e-5b9ffe3f54e9","to":"middleware-test-eyXI7s_E1JH1E0JKxQCfI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814167161,"env":"test","module":"audit-log-service","userId":"2mo1FNhP564UU00oI5p6W","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/integration/api.ai.doc.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814167197,"env":"test","module":"auth-routes","userId":"dlQI96wX2bsNRU1Q6FR6i","email":"middleware-test-eyXI7s_E1JH1E0JKxQCfI@example.com","msg":"User registered"}
stdout | tests/integration/api.ai.doc.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/integration/api.projects.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":50,"time":1767814167428,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767814167512,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/organizations-workflow.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767814167568,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
stdout | tests/integration/api.projects.test.ts > Projects API Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814167593,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1767814167577,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814167578,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814167586,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814167592,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814167593,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814167593,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814167593,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stderr | tests/integration/api.ai.doc.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/api.projects.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814167858,"env":"test","module":"user-credentials-repository","userId":"vqezvHCwB0wjmp7Z7AbzN","msg":"User credentials created"}
{"level":30,"time":1767814167945,"env":"test","module":"user-credentials-repository","userId":"xwbRWu2JegrLYRCAF-GR5","msg":"User credentials created"}
{"level":30,"time":1767814167962,"env":"test","module":"email-queue","jobId":"bce18250-f739-47b9-9330-7923b6447a2f","to":"protected-test-GPys7a6xCEQMwjTtUGoaI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814168003,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814168015,"env":"test","module":"auth-routes","userId":"vqezvHCwB0wjmp7Z7AbzN","email":"protected-test-GPys7a6xCEQMwjTtUGoaI@example.com","msg":"User registered"}
{"level":30,"time":1767814168028,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814168048,"env":"test","module":"email-queue","jobId":"586869fd-aa62-432f-9c3b-7ec0e8f3c6ec","to":"middleware-test-7nbFPnd4tlIeXSf3B2WzU@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814168013,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814168014,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814168020,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814168027,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814168027,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814168027,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814168027,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stdout | tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should analyze a DOCX file and return variables
FAIL_STATUS: 500
FAIL_BODY: {}

{"level":30,"time":1767814168101,"env":"test","module":"auth-routes","userId":"xwbRWu2JegrLYRCAF-GR5","email":"middleware-test-7nbFPnd4tlIeXSf3B2WzU@example.com","msg":"User registered"}
 Γ¥» tests/integration/api.projects.test.ts (10 tests | 10 skipped) 1076ms
       Γåô should create a new project
       Γåô should reject without authentication
       Γåô should reject with invalid data
       Γåô should list projects for tenant
       Γåô should support pagination
       Γåô should get project by ID
       Γåô should return 404 for non-existent project
       Γåô should update project
       Γåô should soft-delete project
       Γåô should not allow cross-tenant access
stdout | tests/integration/api.ai.doc.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/organizations-workflow.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/integration/api.snapshots.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/api.snapshots.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ¥» tests/integration/api.ai.doc.test.ts (4 tests | 2 failed) 964ms
       ├ù should analyze a DOCX file and return variables 59ms
       ├ù should fail if no file is provided 21ms
       Γ£ô should suggest mappings between template and workflow variables 30ms
       Γ£ô should return improvement suggestions 9ms
{"level":30,"time":1767814168599,"env":"test","module":"auth-routes","userId":"0898bb492fc28c8fd291215556a3d5dd","msg":"Login requires MFA verification"}
{"level":30,"time":1767814168643,"env":"test","module":"auth-routes","userId":"vqezvHCwB0wjmp7Z7AbzN","msg":"User logged in successfully"}
stdout | tests/integration/organizations-workflow.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814168678,"env":"test","module":"auth-routes","userId":"xwbRWu2JegrLYRCAF-GR5","msg":"User logged in successfully"}
{"level":30,"time":1767814168695,"env":"test","module":"audit-log-service","userId":"vqezvHCwB0wjmp7Z7AbzN","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/integration/organizations-workflow.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814168709,"env":"test","module":"mfa-service","userId":"0898bb492fc28c8fd291215556a3d5dd","msg":"TOTP verification successful"}
{"level":30,"time":1767814168731,"env":"test","module":"audit-log-service","userId":"xwbRWu2JegrLYRCAF-GR5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814168760,"env":"test","module":"auth-routes","userId":"0898bb492fc28c8fd291215556a3d5dd","msg":"MFA login successful"}
stdout | tests/unit/server/organizationService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stderr | tests/integration/api.snapshots.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/js_helpers.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/js_helpers.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/api.runs.graph.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/api.runs.graph.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/dataBlocks.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/integration/api.snapshots.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814169194,"env":"test","module":"auth-routes","userId":"vqezvHCwB0wjmp7Z7AbzN","msg":"User logged in successfully"}
stderr | tests/integration/organizations-workflow.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814169226,"env":"test","module":"user-credentials-repository","userId":"w3ctTOBwQAYin_Re5Bh_6","msg":"User credentials created"}
{"level":30,"time":1767814169251,"env":"test","module":"audit-log-service","userId":"vqezvHCwB0wjmp7Z7AbzN","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814169333,"env":"test","module":"email-queue","jobId":"4928bbd5-e8c4-4f17-b84e-a6d9f37a8160","to":"middleware-test-hEUPVo9mnuyVSwZCH3Wti@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814169383,"env":"test","module":"auth-routes","userId":"w3ctTOBwQAYin_Re5Bh_6","email":"middleware-test-hEUPVo9mnuyVSwZCH3Wti@example.com","msg":"User registered"}
stdout | tests/unit/server/organizationService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

 Γ¥» tests/integration/api.snapshots.test.ts (1 test | 1 skipped) 820ms
     Γåô should maintain immutability of runs across versions
stderr | tests/integration/js_helpers.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/api.runs.graph.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/server/organizationService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/server/organizationService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814169668,"env":"test","module":"user-credentials-repository","userId":"WT7chVs8QVg8eJRFLMcpp","msg":"User credentials created"}
{"level":50,"time":1767814169694,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stdout | tests/integration/dataBlocks.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767814169769,"env":"test","module":"email-queue","jobId":"a60ae583-fc6f-447f-80b9-db938555e5fe","to":"user2-cDlVQzrfMno2UiOYw9DId@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/integration/js_helpers.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814169825,"env":"test","module":"auth-routes","userId":"WT7chVs8QVg8eJRFLMcpp","email":"user2-cDlVQzrfMno2UiOYw9DId@example.com","msg":"User registered"}
stdout | tests/integration/api.runs.graph.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ¥» tests/integration/js_helpers.test.ts (1 test | 1 skipped) 800ms
     Γåô should execute a JS block that uses helper functions
{"level":30,"time":1767814170100,"env":"test","module":"user-credentials-repository","userId":"2ykz2YLEZ0t1X_nfvOGFb","msg":"User credentials created"}
stderr | tests/unit/server/organizationService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/server/ownershipAccess.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

 Γ¥» tests/integration/api.runs.graph.test.ts (19 tests | 19 skipped) 805ms
       Γåô should list all runs with pagination
       Γåô should filter runs by status
       Γåô should filter runs by workflow
       Γåô should filter runs by project
       Γåô should filter runs by date range
       Γåô should search runs by query string
       Γåô should get run by ID with all details
       Γåô should return 404 for non-existent run
       Γåô should get logs for a run
       Γåô should re-run workflow with same inputs
       Γåô should re-run workflow with override inputs
       Γåô should return 404 for non-existent run
       Γåô should export runs to CSV
       Γåô should export runs with filters applied
       Γåô should compare two runs
       Γåô should identify changed input keys
       Γåô should return 404 if run A not found
       Γåô should return 404 if run B not found
       Γåô should enforce tenant isolation on runs list
{"level":30,"time":1767814170204,"env":"test","module":"email-queue","jobId":"40be3b25-0ceb-4481-b85a-8c3473a3f33b","to":"middleware-test-ubN4VE-3G_mxgcLlnYsfU@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814170258,"env":"test","module":"auth-routes","userId":"2ykz2YLEZ0t1X_nfvOGFb","email":"middleware-test-ubN4VE-3G_mxgcLlnYsfU@example.com","msg":"User registered"}
stdout | tests/integration/datavault-v4-regression.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/datavault-v4-regression.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814170379,"env":"test","module":"auth-routes","userId":"WT7chVs8QVg8eJRFLMcpp","msg":"User logged in successfully"}
{"level":30,"time":1767814170435,"env":"test","module":"audit-log-service","userId":"WT7chVs8QVg8eJRFLMcpp","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767814170497,"env":"test","module":"mfa-service","userId":"3aff4302cb39d05c1a1e66dc35dfb6a5","msg":"TOTP verification failed"}
{"level":40,"time":1767814170497,"env":"test","module":"auth-routes","userId":"3aff4302cb39d05c1a1e66dc35dfb6a5","msg":"MFA verification failed during login"}
stdout | tests/integration/intake.workflow.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767814170815,"env":"test","module":"auth-routes","userId":"2ykz2YLEZ0t1X_nfvOGFb","msg":"User logged in successfully"}
stdout | tests/unit/server/ownershipAccess.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stderr | tests/integration/datavault-v4-regression.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814170870,"env":"test","module":"audit-log-service","userId":"2ykz2YLEZ0t1X_nfvOGFb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814170875,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/unit/server/ownershipAccess.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814170942,"env":"test","module":"user-credentials-repository","userId":"j43GyV9u2oU2Z-AZxsnxy","msg":"User credentials created"}
stdout | tests/integration/auth.routes.real.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/server/ownershipAccess.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814171048,"env":"test","module":"email-queue","jobId":"9b0e94e2-b63f-47a2-9f6f-eb33fcb1657c","to":"protected-test-DVNDOom6wUK2EzDbztRHH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 Γ¥» tests/integration/auth.routes.real.test.ts (26 tests | 6 failed) 40864ms
       Γ£ô should register a new user successfully  1492ms
       Γ£ô should return 400 for invalid email format  823ms
       Γ£ô should return 400 for weak password  867ms
       Γ£ô should return 409 for duplicate email  1457ms
       Γ£ô should set httpOnly refresh token cookie  1387ms
       Γ£ô should login with valid credentials  1736ms
       Γ£ô should return 401 for invalid password  1673ms
       Γ£ô should return 401 for non-existent user  984ms
       ├ù should return 403 for unverified email 1667ms
       ├ù should record failed login attempt 1758ms
       ├ù should return requiresMfa=true for MFA-enabled users 1821ms
       ├ù should lock account after 5 failed attempts 3110ms
       Γ£ô should logout and clear refresh token cookie  1883ms
       ├ù should refresh access token with valid refresh token 1480ms
       Γ£ô should return 401 for missing refresh token  826ms
       Γ£ô should rotate refresh token after use  2117ms
       Γ£ô should send password reset email for existing user  1472ms
       Γ£ô should not reveal if email exists (security)  893ms
       ├ù should reset password with valid token 2379ms
       Γ£ô should return 400 for invalid token  876ms
       Γ£ô should return 400 for weak new password  1605ms
       Γ£ô should return current user for valid token  1938ms
       Γ£ô should return 401 for missing token  832ms
       Γ£ô should return 401 for invalid token  831ms
         Γ£ô should complete MFA login with valid TOTP code  2382ms
         Γ£ô should reject invalid MFA code  1767ms
{"level":30,"time":1767814171097,"env":"test","module":"auth-routes","userId":"j43GyV9u2oU2Z-AZxsnxy","email":"protected-test-DVNDOom6wUK2EzDbztRHH@example.com","msg":"User registered"}
{"level":30,"time":1767814171142,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814171162,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814171150,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814171151,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814171156,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814171161,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814171162,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814171162,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814171162,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767814171255,"env":"test","module":"user-credentials-repository","userId":"QdmvW1u118axRamUm5XE8","msg":"User credentials created"}
{"level":30,"time":1767814171356,"env":"test","module":"email-queue","jobId":"3bf6fe76-715f-4c01-8e80-384fc11a9c77","to":"middleware-test-Dho6-UlHvmKLbqTQAncjR@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767814171399,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767814171407,"env":"test","module":"auth-routes","userId":"QdmvW1u118axRamUm5XE8","email":"middleware-test-Dho6-UlHvmKLbqTQAncjR@example.com","msg":"User registered"}
{"level":50,"time":1767814171499,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"Failed to render template"}
stderr | tests/unit/server/ownershipAccess.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/collections.e2e.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1767814171604,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
stdout | tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests
Login Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjAyZDkyODg3LTAzYjktNGZjMi05YzZjLTBmYjE2ODY2NjMzZSIsInJvbGUiOiJhZG1pbiIsInRlbmFudFJvbGUiOiJvd25lciIsImlhdCI6MTc2NzgxNDE3MSwiZXhwIjoxNzY3ODE1MDcxfQ.meKuyGE2F3GrXHl5a4NARXHel26-KbEtsvrs3SKCWGs",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": null,
    "lastName": null,
    "profileImageUrl": null,
    "tenantId": "02d92887-03b9-4fc2-9c6c-0fb16866633e",
    "role": "admin",
    "tenantRole": "owner"
  }
}

stdout | tests/integration/intake.workflow.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767814171779,"env":"test","module":"user-credentials-repository","userId":"J1V7wf87RVl9eHNXLS5yC","msg":"User credentials created"}
{"level":30,"time":1767814171835,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1767814171885,"env":"test","module":"email-queue","jobId":"2461219c-3ef0-4fb2-aaff-d8c23f4bd61e","to":"protected-test-0293iZec5ytm5SsbqkzOW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/components/datavault/TableGridView.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767814171935,"env":"test","module":"auth-routes","userId":"J1V7wf87RVl9eHNXLS5yC","email":"protected-test-0293iZec5ytm5SsbqkzOW@example.com","msg":"User registered"}
{"level":30,"time":1767814171980,"env":"test","module":"auth-routes","userId":"QdmvW1u118axRamUm5XE8","msg":"User logged in successfully"}
{"level":30,"time":1767814172029,"env":"test","module":"audit-log-service","userId":"QdmvW1u118axRamUm5XE8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stdout | tests/integration/collections.e2e.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

{"level":40,"time":1767814172149,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":30,"time":1767814172164,"env":"test","workflowId":"fa9c49e3-961a-403e-bd02-d8cb0c1788a5","userId":"2c6ce132-a544-4e53-ba38-9958549252ae","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
stdout | tests/integration/dataBlocks.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/dataBlocks.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/collections.e2e.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/collections.e2e.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814172473,"env":"test","module":"auth-routes","userId":"J1V7wf87RVl9eHNXLS5yC","msg":"User logged in successfully"}
{"level":30,"time":1767814172524,"env":"test","module":"audit-log-service","userId":"J1V7wf87RVl9eHNXLS5yC","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767814172598,"env":"test","workflowId":"fa9c49e3-961a-403e-bd02-d8cb0c1788a5","userId":"7ddb69ac-a57c-4733-8122-651309801cba","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
stderr | tests/integration/dataBlocks.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/collections.e2e.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/protected.routes.test.ts:37:9 {
  length: 361,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(YSkGqgf68Sqam5cbSVqT4) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

stdout | tests/integration/auth/protected.routes.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814173103,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1767814173135,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/unit/components/datavault/TableGridView.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/components/datavault/TableGridView.test.tsx
≡ƒº¬ Setting up test environment...

 Γ¥» tests/integration/auth/protected.routes.test.ts (33 tests | 27 failed) 37700ms
       ├ù should allow access with valid Bearer token 864ms
       ├ù should reject access without Authorization header 833ms
       ├ù should reject access with empty Bearer token 835ms
       ├ù should reject access with malformed Authorization header 866ms
       ├ù should reject access with wrong token type 840ms
       ├ù should allow POST with valid Bearer token 839ms
       ├ù should reject POST without Bearer token 855ms
       ├ù should reject POST with invalid token 842ms
       ├ù should allow PUT with valid Bearer token 888ms
       ├ù should reject PUT without Bearer token 910ms
       ├ù should allow DELETE with valid Bearer token 867ms
       ├ù should reject DELETE without Bearer token 882ms
       ├ù should allow PATCH with valid Bearer token 852ms
       Γ£ô should reject PATCH without Bearer token  1153ms
       ├ù should handle Bearer token with extra spaces 880ms
       ├ù should handle token with newlines 875ms
       Γ£ô should handle very long invalid token  1134ms
       ├ù should handle empty Authorization header 893ms
       ├ù should handle Authorization header with only Bearer 883ms
       Γ£ô should handle multiple Authorization headers  1227ms
       ├ù should reject token with SQL injection attempt 895ms
       ├ù should reject token with XSS attempt 855ms
       ├ù should reject token with missing userId 880ms
       Γ£ô should reject token with non-existent userId  1315ms
       ├ù should not allow user to access another user's resources 2133ms
       ├ù should inject userId into request context 886ms
       ├ù should inject tenantId into request context 919ms
       Γ£ô should inject role into request context  1314ms
       ├ù should not apply general rate limiting to authenticated requests 897ms
       ├ù should handle request with both Bearer token and cookies 1449ms
       Γ£ô should prioritize Bearer token over cookie when both present  3123ms
       ├ù should allow unauthenticated access to optional auth routes 848ms
       ├ù should enhance optional auth routes with user context when authenticated 1600ms
stdout | tests/unit/components/datavault/TableGridView.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814173527,"env":"test","module":"user-credentials-repository","userId":"Y6q9-mPN2EOSOp5LPf-JD","msg":"User credentials created"}
{"level":30,"time":1767814173629,"env":"test","module":"email-queue","jobId":"da6d3517-854e-4bc4-ad35-af73454c5220","to":"middleware-test-iYBjDb37WLq3y3ts1-0ti@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814173684,"env":"test","module":"auth-routes","userId":"Y6q9-mPN2EOSOp5LPf-JD","email":"middleware-test-iYBjDb37WLq3y3ts1-0ti@example.com","msg":"User registered"}
stdout | tests/integration/externalSends.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stderr | tests/unit/components/datavault/TableGridView.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814173944,"env":"test","workflowId":"4ce124a8-ef94-4d9c-ae23-f8c594810743","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":50,"time":1767814174095,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":30,"time":1767814174215,"env":"test","module":"auth-routes","userId":"Y6q9-mPN2EOSOp5LPf-JD","msg":"User logged in successfully"}
stdout | tests/integration/externalSends.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767814174268,"env":"test","module":"audit-log-service","userId":"Y6q9-mPN2EOSOp5LPf-JD","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814174274,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767814174550,"env":"test","workflowId":"fa9c49e3-961a-403e-bd02-d8cb0c1788a5","userId":"2c6ce132-a544-4e53-ba38-9958549252ae","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1767814174664,"env":"test","module":"user-credentials-repository","userId":"ZTPZR-nOvFWarI2VSJQTk","msg":"User credentials created"}
stdout | tests/integration/externalSends.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/externalSends.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814174769,"env":"test","module":"email-queue","jobId":"bfadf64f-d63b-4ca9-b618-50364e9a157b","to":"middleware-test-6m6cLiOVzBMpHQjnH7jdS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814174819,"env":"test","module":"auth-routes","userId":"ZTPZR-nOvFWarI2VSJQTk","email":"middleware-test-6m6cLiOVzBMpHQjnH7jdS@example.com","msg":"User registered"}
stderr | tests/integration/externalSends.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814175352,"env":"test","module":"auth-routes","userId":"ZTPZR-nOvFWarI2VSJQTk","msg":"User logged in successfully"}
{"level":30,"time":1767814175400,"env":"test","module":"audit-log-service","userId":"ZTPZR-nOvFWarI2VSJQTk","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767814175405,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/auth.middleware.integration.test.ts:41:9 {
  length: 361,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(oWDWbYmV_soGP3rDaEMsL) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

stdout | tests/integration/auth/auth.middleware.integration.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/components/datavault/TableGridView.test.tsx
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814175524,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"mode":"create","tableId":"8c8786b9-ed27-4be8-b64b-a32b7ee0f102","dataSourceId":"9d007a0f-0c1e-4595-9da6-45d729ebfc08","columnMappings":[{"value":"{{95ba37cc-4e44-49cc-9254-8e25da8bf010}}","columnId":"ba64b18b-82b7-4d0f-808b-ca2b66eeed0f"}]},"tableId":"8c8786b9-ed27-4be8-b64b-a32b7ee0f102","preview":false,"msg":"Starting write execution"}
 Γ£ô tests/unit/components/datavault/TableGridView.test.tsx (9 tests) 2787ms
     Γ£ô loads table schema and rows  338ms
     Γ£ô updates cell value on blur  304ms
 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts (35 tests | 29 failed) 40104ms
       Γ£ô should allow access with valid JWT Bearer token  1269ms
       ├ù should return 401 when no token provided 862ms
       ├ù should return 401 with invalid token 1131ms
       ├ù should return 401 with expired token 843ms
       ├ù should extract token without Bearer prefix 834ms
       ├ù should proceed without authentication if no token provided 844ms
       ├ù should attach user context if valid token provided 864ms
       ├ù should proceed without auth if invalid token provided 858ms
       ├ù should authenticate with JWT Bearer token 883ms
       ├ù should authenticate with refresh token cookie (GET only) 910ms
       ├ù should reject cookie auth for POST requests (mutation-strict) 867ms
       ├ù should reject cookie auth for PUT requests 874ms
       ├ù should reject cookie auth for DELETE requests 864ms
       ├ù should allow cookie auth for HEAD requests 1220ms
       ├ù should prioritize JWT over cookie when both present 893ms
       ├ù should return 401 when no auth provided 878ms
       ├ù should return 401 when both JWT and cookie are invalid 874ms
       ├ù should authenticate with JWT if provided 909ms
       ├ù should authenticate with cookie if JWT not provided 897ms
       ├ù should proceed anonymously if no auth provided 1590ms
       ├ù should proceed anonymously if both JWT and cookie are invalid 1608ms
       ├ù should only allow safe methods for cookie auth 904ms
       Γ£ô should ignore cookies when Bearer token present  2552ms
       Γ£ô should validate refresh token from cookie  1385ms
       ├ù should reject expired refresh token from cookie 896ms
       Γ£ô should attach userId to request  1363ms
       ├ù should attach userEmail to request 904ms
       ├ù should attach tenantId to request 902ms
       ├ù should attach userRole to request 897ms
       Γ£ô should lookup tenantId from database if missing from token  1320ms
       ├ù should return consistent error format for missing token 863ms
       ├ù should return consistent error format for invalid token 1181ms
       ├ù should return consistent error format for expired token 2260ms
       Γ£ô should handle malformed JWT gracefully  1138ms
       ├ù should handle JWT with wrong algorithm 1132ms
stdout | tests/integration/intake.workflow.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/oauth2.google.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/intake.workflow.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/variableSafety.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/server/ownershipAccess.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/server/ownershipAccess.test.ts (19 tests) 5323ms
       Γ£ô should allow member of multiple orgs to access all their org assets  313ms
stderr | tests/integration/intake.workflow.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/variableSafety.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1767814176603,"env":"test","workflowId":"d826256e-d2af-49de-8f08-8035b9cf8c07","msg":"No current or pinned version found for workflow, run might be unstable"}
stdout | tests/integration/auth/oauth2.google.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767814176713,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814176732,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/intake.workflow.test.ts > Intake Workflow Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814176721,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814176722,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814176727,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814176732,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814176732,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814176732,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814176732,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stdout | tests/integration/collections.e2e.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/integration/collections.e2e.test.ts (22 tests) 4407ms
       Γ£ô should create multiple records  418ms
stdout | tests/integration/variableSafety.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/variableSafety.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should create a note for a row
Created note: 980b553e-f5ce-4069-b173-d51180bff2c5 tenantId: 02d92887-03b9-4fc2-9c6c-0fb16866633e userId: google-user-id

{"level":40,"time":1767814177020,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stdout | tests/integration/auth/oauth2.google.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/oauth2.google.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/organizations-workflow.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814177200,"env":"test","module":"user-credentials-repository","userId":"khnUXnU47Y9YyglXabEXG","msg":"User credentials created"}
 Γ£ô tests/integration/organizations-workflow.test.ts (23 tests) 8531ms
       Γ£ô Step 2: Invite member via email  506ms
       Γ£ô Step 3: Accept invite  545ms
       Γ£ô Step 4: Create workflow owned by user  498ms
       Γ£ô Step 5: Transfer workflow to organization  360ms
       Γ£ô Step 6: Org member (user2) can access workflow  444ms
       Γ£ô Step 16: Re-add member and verify access restored  442ms
       Γ£ô Cannot invite same email twice (pending invite exists)  774ms
       Γ£ô Cannot accept expired invite  647ms
       Γ£ô Cannot transfer workflow to org user is not a member of  536ms
{"level":30,"time":1767814177300,"env":"test","msg":"Simulating External Send","destination":"Test Webhook","payload":{"message":"Hello Preview"}}
{"level":30,"time":1767814177312,"env":"test","module":"email-queue","jobId":"3fa42c5b-df1e-403a-8f60-ff23697be23d","to":"test-Kxc7Kgk8DJ1xB0mDD5gaC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814177372,"env":"test","module":"auth-routes","userId":"khnUXnU47Y9YyglXabEXG","email":"test-Kxc7Kgk8DJ1xB0mDD5gaC@example.com","msg":"User registered"}
stderr | tests/integration/variableSafety.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
Created note: 59e0793b-0108-4e71-a707-343f510d2872 tenantId: 02d92887-03b9-4fc2-9c6c-0fb16866633e userId: google-user-id

stderr | tests/integration/auth/oauth2.google.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/collab.client.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
Created note: e2209b59-e925-4512-a423-ba384af72be9 tenantId: 02d92887-03b9-4fc2-9c6c-0fb16866633e userId: google-user-id

stdout | tests/integration/auth/oauth2.callback.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/unit/server/organizationService.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/server/organizationService.test.ts (13 tests) 8154ms
       Γ£ô should create organization and auto-create admin membership  435ms
       Γ£ô should return all organizations for user  405ms
       Γ£ô should allow admin to update organization  470ms
       Γ£ô should deny non-admin from updating organization  473ms
       Γ£ô should return all members of organization  616ms
       Γ£ô should allow admin to promote member  774ms
       Γ£ô should allow admin to demote other admin  777ms
       Γ£ô should prevent self-demotion  411ms
       Γ£ô should allow admin to remove member  761ms
       Γ£ô should prevent self-removal  432ms
       Γ£ô should allow member to leave organization  764ms
       Γ£ô should allow admin to leave organization  828ms
{"level":30,"time":1767814177804,"env":"test","workflowId":"d826256e-d2af-49de-8f08-8035b9cf8c07","queryId":"d6f8653a-ac6a-4772-8a77-7f6c6d0c29bf","outputVar":"my_results","msg":"Executing query block"}
stdout | tests/unit/services/PdfQueueService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/engine/templateNode.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/PdfQueueService.test.ts (15 tests) 12456ms
       Γ£ô should enqueue a PDF conversion job  721ms
       Γ£ô should create output with empty storagePath initially  720ms
       Γ£ô should return job status for pending job  706ms
       Γ£ô should return null for non-existent job  664ms
       Γ£ô should parse attempt count from error field  694ms
       Γ£ô should convert DOCX to PDF immediately  774ms
       Γ£ô should handle conversion errors gracefully  696ms
       Γ£ô should start and stop service  770ms
       Γ£ô should not start if already running  611ms
       Γ£ô should handle stop when not running  589ms
       Γ£ô should process pending jobs when queue is processed  1036ms
       Γ£ô should process multiple jobs in batch  1264ms
       Γ£ô should handle missing DOCX output gracefully  806ms
       Γ£ô should support enqueue within transaction  822ms
       Γ£ô should support convertImmediate within transaction  758ms
 Γ£ô tests/unit/engine/templateNode.test.ts (17 tests) 11948ms
       Γ£ô should resolve template by key from workflowTemplates mapping  764ms
       Γ£ô should throw error if template key not found  618ms
       Γ£ô should store output in runOutputs table  771ms
       Γ£ô should resolve template by templateId directly  619ms
       Γ£ô should throw error if templateId not found  612ms
       Γ£ô should use docxRenderer2 by default (v2 engine)  657ms
       Γ£ô should use legacy engine when engine="legacy"  671ms
       Γ£ô should generate PDF when toPdf=true  788ms
       Γ£ô should default to DOCX when toPdf=false  779ms
       Γ£ô should skip execution when condition evaluates to false  550ms
       Γ£ô should execute when condition evaluates to true  598ms
       Γ£ô should resolve simple bindings  621ms
       Γ£ô should handle binding resolution errors gracefully  549ms
       Γ£ô should record failed output in runOutputs table  718ms
       Γ£ô should not throw errors (should return error in result)  615ms
       Γ£ô should deny access to templates from different tenant  613ms
       Γ£ô should require either templateKey or templateId  549ms
stdout | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/integration/dataBlocks.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":40,"time":1767814178360,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
stdout | tests/integration/auth/oauth2.callback.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

{"level":30,"time":1767814178444,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
 Γ£ô tests/integration/dataBlocks.test.ts (2 tests) 6120ms
     Γ£ô should write data to DataVault via WriteBlock  2640ms
     Γ£ô should query data from DataVault via QueryBlock and use in Logic  1962ms
{"level":50,"time":1767814178577,"env":"test","error":{"length":371,"name":"error","severity":"ERROR","code":"23503","detail":"Key (row_id)=(6602a1ad-f548-4e41-8f27-bc7a56597ca3) is not present in table \"datavault_rows\".","schema":"public","table":"datavault_row_notes","constraint":"datavault_row_notes_row_id_datavault_rows_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Error creating row note"}
{"level":30,"time":1767814178598,"env":"test","msg":"External Send Completed","destination":"Test Webhook","success":true,"status":200}
stdout | tests/integration/api.expression-validation.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

{"level":30,"time":1767814178634,"env":"test","workflowId":"03e9d765-3789-4dfe-bf28-8ee5b411bd76","userId":"khnUXnU47Y9YyglXabEXG","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
stdout | tests/unit/docxRenderer.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":50,"time":1767814178704,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":50,"time":1767814178705,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google authentication failed"}
stdout | tests/integration/externalSends.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":40,"time":1767814178769,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1767814178769,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google token verification failed"}
{"level":50,"time":1767814178769,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google authentication failed"}
 Γ£ô tests/integration/externalSends.test.ts (2 tests) 4034ms
     Γ£ô PREVIEW MODE: Should simulate send and NOT call fetch  1460ms
     Γ£ô LIVE MODE: Should call fetch with mapped payload  1298ms
{"level":50,"time":1767814178803,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"msg":"Error deleting row note"}
{"level":40,"time":1767814178884,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stdout | tests/unit/collab.client.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/unit/collab.client.test.tsx
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/oauth2.callback.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/oauth2.callback.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":40,"time":1767814179041,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
stdout | tests/unit/collab.client.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/client/list-choice-options.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

{"level":30,"time":1767814179231,"env":"test","module":"auth","email":"existing@example.com","msg":"OAuth2 login successful"}
stdout | tests/unit/shared/conditionEvaluator.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/unit/docxRenderer.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/docxRenderer.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/integration/auth/oauth2.callback.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
≡ƒº¬ Setting up test environment...

stderr | tests/unit/collab.client.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/components/datavault/CellRenderer.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/unit/docxRenderer.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814179716,"env":"test","module":"auth","email":"refresh@example.com","msg":"OAuth2 login successful"}
stdout | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/api.expression-validation.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/unit/client/list-choice-options.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/unit/client/list-choice-options.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/client/list-choice-options.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/shared/conditionEvaluator.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/shared/conditionEvaluator.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814180170,"env":"test","module":"auth","email":"idtoken@example.com","msg":"OAuth2 login successful"}
stderr | tests/unit/docxRenderer.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/intake.workflow.test.ts > Intake Workflow Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/intake.workflow.test.ts:20:9 {
  length: 361,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(khnUXnU47Y9YyglXabEXG) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

stdout | tests/integration/intake.workflow.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814180260,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stdout | tests/unit/shared/conditionEvaluator.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814180318,"env":"test","connectionId":"2b348ea2-6583-441b-8387-e887b3045df8","projectId":"94c66aa7-e6cc-4900-ae61-fac487d6edea","name":"Test OAuth2 Connection","type":"oauth2_3leg","msg":"Connection created:"}
 Γ£ô tests/integration/intake.workflow.test.ts (2 tests) 4312ms
     Γ£ô should allow designating a workflow as Intake  1143ms
     Γ£ô should allow linking a downstream workflow to an intake workflow  1475ms
stdout | tests/unit/repositories/WorkflowTemplateRepository.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/client/list-choice-options.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814180602,"env":"test","error":{},"msg":"libreoffice-convert not available, trying system LibreOffice"}
 Γ£ô tests/unit/repositories/WorkflowTemplateRepository.test.ts (19 tests) 15165ms
       Γ£ô should create a workflow template mapping  672ms
       Γ£ô should create non-primary mapping by default  658ms
       Γ£ô should find all templates for a workflow version  774ms
       Γ£ô should return empty array for version with no templates  671ms
       Γ£ô should order by createdAt desc (newest first)  801ms
       Γ£ô should find mapping by workflow version and key  750ms
       Γ£ô should return undefined for non-existent key  655ms
       Γ£ô should find primary template for workflow version  811ms
       Γ£ô should return undefined when no primary template exists  708ms
       Γ£ô should set a template as primary and unset others  940ms
       Γ£ô should handle setting primary when none existed before  941ms
       Γ£ô should not delete mapping if workflow version does not match  896ms
       Γ£ô should return true if key exists in workflow version  715ms
       Γ£ô should return false if key does not exist  658ms
       Γ£ô should exclude specified id when checking existence  728ms
       Γ£ô should return true if key exists on different mapping  778ms
       Γ£ô should update mapping fields  730ms
       Γ£ô should find mapping by id  725ms
       Γ£ô should return undefined for non-existent id  685ms
{"level":30,"time":1767814180619,"env":"test","module":"auth","email":"minimal@example.com","msg":"OAuth2 login successful"}
{"level":40,"time":1767814180637,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"libreoffice --headless --convert-to pdf --outdir \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\" \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\\simple-template-1767814180584.docx\"","stdout":"","stderr":"'libreoffice' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"System LibreOffice conversion failed"}
{"level":40,"time":1767814180637,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF conversion failed"}
stdout | tests/unit/docxRenderer.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/variableSafety.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx > TableGridView - Drag & Drop > renders DndContext wrapper
Warning: validateDOMNesting(...): <th> cannot appear as a child of <div>.
    at th
    at SortableColumnHeader (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/SortableColumnHeader.tsx:12:33)
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
Warning: validateDOMNesting(...): <div> cannot appear as a child of <tr>.
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

{"level":50,"time":1767814180689,"env":"test","error":{},"msg":"Error granting table permission"}
 Γ£ô tests/unit/docxRenderer.test.ts (12 tests) 1846ms
 Γ£ô tests/integration/variableSafety.test.ts (4 tests) 3772ms
     Γ£ô REPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided  679ms
     Γ£ô ScriptEngine resolves alias 'input_variable' when aliasMap is provided  681ms
     Γ£ô REPRO: BlockRunner fails to resolve alias in CreateRecordConfig  688ms
     Γ£ô BlockRunner logic resolves alias with aliasMap  647ms
{"level":50,"time":1767814180735,"env":"test","module":"auth","err":{"type":"Error","message":"Token verification failed","stack":"Error: Token verification failed\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:425:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
stderr | tests/unit/shared/conditionEvaluator.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814180792,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1767814180792,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
stdout | tests/unit/services/WorkflowTemplateService.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814180847,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token payload","stack":"Error: Invalid token payload\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:85:25)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
stdout | tests/unit/client/list-choice-options.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/WorkflowTemplateService.test.ts (21 tests) 16241ms
       Γ£ô should throw error if template belongs to different project  597ms
       Γ£ô should automatically unset other primaries when setting new primary  1082ms
         Γ£ô should list all templates for workflow version  792ms
         Γ£ô should return empty array for version with no templates  532ms
         Γ£ô should get template mapping by id and version  705ms
         Γ£ô should throw error if mapping not found  538ms
         Γ£ô should get template by key  709ms
         Γ£ô should throw error if key not found  544ms
         Γ£ô should get primary template for workflow version  801ms
         Γ£ô should return null when no primary template exists  635ms
         Γ£ô should update mapping key  767ms
         Γ£ô should update isPrimary flag  827ms
         Γ£ô should throw error if new key already exists  800ms
         Γ£ô should throw error if mapping not found  555ms
         Γ£ô should unset other primaries when setting isPrimary to true  1048ms
         Γ£ô should detach template from workflow version  740ms
         Γ£ô should throw error if mapping not found  520ms
         Γ£ô should set template as primary  1007ms
         Γ£ô should throw error if mapping not found  550ms
         Γ£ô should support operations within a transaction  827ms
         Γ£ô should rollback on transaction error  810ms
 Γ£ô tests/unit/client/list-choice-options.test.ts (14 tests) 1718ms
stdout | tests/integration/auth/oauth2.google.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/integration/auth/oauth2.google.test.ts (14 tests) 3871ms
       Γ£ô should successfully authenticate with valid Google ID token  621ms
       Γ£ô should update existing user on subsequent logins  519ms
       Γ£ô should create refresh token record in database  483ms
       Γ£ô should support both "token" and "idToken" fields  398ms
       Γ£ô should handle missing profile information gracefully  392ms
stderr | tests/unit/shared/conditionEvaluator.test.ts > conditionEvaluator > Comparison operators > Unknown operator > should default to true and log warning
Unknown operator: unknown_operator

stdout | tests/unit/shared/conditionEvaluator.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/shared/conditionEvaluator.test.ts (70 tests) 1659ms
stdout | tests/integration/dynamic_options_workflow.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/unit/collab.client.test.tsx
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/components/datavault/CellRenderer.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/components/datavault/CellRenderer.test.tsx
≡ƒº¬ Setting up test environment...

 Γ£ô tests/unit/collab.client.test.tsx (17 tests) 3034ms
     Γ£ô should add a comment  322ms
     Γ£ô should allow comment owner to delete their comment  332ms
{"level":30,"time":1767814181499,"env":"test","connectionId":"11830a10-6084-421a-bcc5-7bbbff71eff4","projectId":"94c66aa7-e6cc-4900-ae61-fac487d6edea","name":"Status Test Connection","type":"oauth2_3leg","msg":"Connection created:"}
stdout | tests/unit/WorkflowChangeAnalyzer.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/components/datavault/CellRenderer.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814181632,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stdout | tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
Update permission failed: {
  id: [32m'14bf779d-64aa-4aba-b34e-6c743d2f55fc'[39m,
  tableId: [32m'98f6d53d-5264-4123-80c1-cc7791250b32'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2026-01-07T19:29:42.852Z'[39m
}

stdout | tests/unit/shared/validation/Validator.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/integration/conditions/conditionEvaluation.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/unit/shared/workflowLogic.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/auth/oauth2.client-credentials.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

 Γ£ô tests/unit/components/datavault/TableGridViewDragDrop.test.tsx (7 tests) 3078ms
     Γ£ô displays columns in order based on orderIndex  689ms
stderr | tests/unit/components/datavault/CellRenderer.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/dynamic_options_workflow.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/integration/auth/oauth2.callback.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/workflows/conditionTruthTable.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

 Γ£ô tests/integration/auth/oauth2.callback.test.ts (16 tests) 3269ms
       Γ£ô should initiate OAuth2 3-legged flow and generate authorization URL  377ms
       Γ£ô should track OAuth2 connection status  388ms
stdout | tests/integration/dynamic_options_workflow.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/WorkflowChangeAnalyzer.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/unit/WorkflowChangeAnalyzer.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/shared/validation/Validator.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/unit/shared/validation/Validator.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/dynamic_options_workflow.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/conditions/conditionEvaluation.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/integration/conditions/conditionEvaluation.test.ts
≡ƒº¬ Setting up test environment...

{"level":50,"time":1767814182663,"env":"test","error":{},"msg":"Error granting table permission"}
stdout | tests/unit/WorkflowChangeAnalyzer.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/shared/validation/Validator.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/conditions/conditionEvaluation.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/ui/builder.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/shared/workflowLogic.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/shared/workflowLogic.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/oauth2.client-credentials.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/integration/auth/oauth2.client-credentials.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stderr | tests/integration/dynamic_options_workflow.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/shared/workflowLogic.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/workflows/conditionTruthTable.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/unit/workflows/conditionTruthTable.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/auth/oauth2.client-credentials.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/ui/datavault/ColumnTypeIcon.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/ScriptEngine.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stderr | tests/unit/WorkflowChangeAnalyzer.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/components/datavault/CellRenderer.test.tsx
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/workflows/conditionTruthTable.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/shared/validation/Validator.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/conditions/conditionEvaluation.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/unit/components/datavault/CellRenderer.test.tsx (12 tests) 2922ms
     Γ£ô renders boolean value as Yes/No  414ms
stdout | tests/unit/WorkflowChangeAnalyzer.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/WorkflowChangeAnalyzer.test.ts (5 tests) 1881ms
stdout | tests/unit/shared/validation/Validator.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/shared/workflowLogic.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/conditions/conditionEvaluation.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/shared/validation/Validator.test.ts (13 tests) 1899ms
stderr | tests/integration/auth/oauth2.client-credentials.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/integration/conditions/conditionEvaluation.test.ts (18 tests) 1798ms
stdout | tests/ui/builder.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/ui/builder.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/server/organizationInvites.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/server/organizationInvites.test.ts (17 tests) 19591ms
       Γ£ô should create placeholder user for non-existent email  1044ms
       Γ£ô should create invite for existing user without creating placeholder  974ms
       Γ£ô should prevent duplicate pending invites  1246ms
       Γ£ô should prevent inviting existing members  853ms
       Γ£ô should require admin access to create invite  537ms
       Γ£ô should set expiry to 7 days from now  1007ms
       Γ£ô should accept invite and create membership  1498ms
       Γ£ô should convert placeholder user to real user on accept  1541ms
       Γ£ô should reject expired invite  1126ms
       Γ£ô should reject already accepted invite  1395ms
       Γ£ô should verify email matches invite  1027ms
       Γ£ô should reject invalid token  532ms
       Γ£ô should return pending invites for user email  1023ms
       Γ£ô should not return expired invites  1102ms
       Γ£ô should not return accepted invites  1451ms
       Γ£ô should allow admin to revoke invite  1183ms
       Γ£ô should prevent accepting revoked invite  1181ms
stderr | tests/unit/workflows/conditionTruthTable.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/shared/workflowLogic.test.ts > workflowLogic > evaluateRules > Operators > Unknown operator > should return false and log warning for unknown operator
Unknown operator: unknown_operator

stdout | tests/unit/shared/workflowLogic.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/ui/builder.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":50,"time":1767814183961,"env":"test","status":401,"statusText":"Unauthorized","error":"Invalid client credentials","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token request failed"}
{"level":50,"time":1767814183962,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814183964,"env":"test","data":{"token_type":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1767814183965,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814183965,"env":"test","data":{"access_token":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1767814183966,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814183967,"env":"test","error":"Network error: ECONNREFUSED","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
 Γ£ô tests/unit/shared/workflowLogic.test.ts (65 tests) 1848ms
{"level":50,"time":1767814184082,"env":"test","error":"Invalid credentials","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
stdout | tests/integration/auth/oauth2.client-credentials.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814184083,"env":"test","error":"ECONNREFUSED","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814184086,"env":"test","status":400,"statusText":"Bad Request","error":"Invalid grant_type","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token request failed"}
{"level":50,"time":1767814184086,"env":"test","error":"OAuth2 token request failed: 400 Bad Request","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814184087,"env":"test","status":401,"statusText":"Unauthorized","error":"Client authentication failed","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token request failed"}
{"level":50,"time":1767814184087,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814184088,"env":"test","status":403,"statusText":"Forbidden","error":"Access denied","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token request failed"}
{"level":50,"time":1767814184088,"env":"test","error":"OAuth2 token request failed: 403 Forbidden","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814184089,"env":"test","status":500,"statusText":"Internal Server Error","error":"Server error","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token request failed"}
{"level":50,"time":1767814184089,"env":"test","error":"OAuth2 token request failed: 500 Internal Server Error","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814184090,"env":"test","error":"Unexpected token in JSON","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767814184091,"env":"test","error":"Request timeout","tokenUrl":"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó","msg":"OAuth2 token fetch error"}
stdout | tests/unit/workflows/conditionTruthTable.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/integration/auth/oauth2.client-credentials.test.ts (29 tests) 1972ms
 Γ£ô tests/unit/workflows/conditionTruthTable.test.ts (51 tests) 1711ms
{"level":50,"time":1767814184298,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
{"level":30,"time":1767814184306,"env":"test","blockId":"471f9339-667f-484a-a315-b2d845695eee","virtualStepId":"e2dcafd2-a80e-42a2-a3e4-64ea16f97d14","outputVar":"userList","msg":"Created read table block with virtual step"}
stdout | tests/ui/datavault/ColumnTypeIcon.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/ui/datavault/ColumnTypeIcon.test.tsx
≡ƒº¬ Setting up test environment...

stdout | tests/integration/session.management.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/unit/components/datavault/SortableColumnHeader.test.tsx
≡ƒº¬ Setting up test environment...

stderr | tests/ui/builder.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/ScriptEngine.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/unit/ScriptEngine.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/utils/conditionalLogic-simple.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/services/docxRenderer2.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/ui/datavault/ColumnTypeIcon.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/components/datavault/SortableColumnHeader.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/ui/builder.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/ui/builder.test.ts (4 tests) 1726ms
stdout | tests/integration/dynamic_options_workflow.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/ScriptEngine.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ£ô tests/integration/dynamic_options_workflow.test.ts (1 test) 2237ms
     Γ£ô should successfully configure a workflow with Read Table -> Dynamic Choice  444ms
stdout | tests/unit/middleware/rbac.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/unit/shared/validation/stepConfigSchemas.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":50,"time":1767814185083,"env":"test","error":{},"msg":"Error creating DataVault row"}
stderr | tests/ui/datavault/ColumnTypeIcon.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/repeater.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/HelperLibrary.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/integration/session.management.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/integration/session.management.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/unit/components/datavault/SortableColumnHeader.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/ScriptEngine.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/datavault-v4-regression.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/utils/conditionalLogic-simple.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/unit/utils/conditionalLogic-simple.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/session.management.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/RunExecutionCoordinator.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/ScriptEngine.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/docxRenderer2.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/services/docxRenderer2.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/utils/encryption.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

 Γ£ô tests/unit/ScriptEngine.test.ts (26 tests | 4 skipped) 2047ms
stdout | tests/ui/datavault/ColumnTypeIcon.test.tsx
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/utils/conditionalLogic-simple.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/components/datavault/SortableColumnHeader.test.tsx
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/ui/datavault/ColumnTypeIcon.test.tsx (27 tests) 2228ms
 Γ¥» tests/integration/datavault-v4-regression.test.ts (23 tests | 6 failed) 15065ms
       Γ£ô should create a select column with options  540ms
       Γ£ô should create a multiselect column with options  507ms
       Γ£ô should validate select value against options  1266ms
       Γ£ô should validate multiselect values as array  944ms
       Γ£ô should create an autonumber column with sequence  502ms
       Γ£ô should format autonumber with prefix  981ms
       Γ£ô should create a note for a row  448ms
       Γ£ô should get all notes for a row  786ms
       ├ù should delete a note 389ms
       ├ù should not allow deleting notes by other users 826ms
       Γ£ô should create an API token  452ms
       Γ£ô should validate API token scopes 259ms
       ├ù should revoke (delete) an API token 363ms
       ├ù should deny access with expired token 372ms
       ├ù should grant table permission 267ms
       ├ù should list table permissions 399ms
       Γ£ô should update table permission role  562ms
       Γ£ô should revoke table permission  686ms
       Γ£ô should enforce RBAC - only owners can manage permissions  334ms
       Γ£ô should paginate rows efficiently  1347ms
       Γ£ô should return user-friendly error for invalid column type 283ms
       Γ£ô should return user-friendly error for missing required fields  784ms
       Γ£ô should handle network errors gracefully 244ms
stdout | tests/unit/shared/validation/stepConfigSchemas.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/unit/shared/validation/stepConfigSchemas.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/middleware/rbac.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/middleware/rbac.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/unit/components/datavault/SortableColumnHeader.test.tsx (10 tests) 2361ms
stdout | tests/unit/services/docxRenderer2.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/integration/session.management.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/unit/shared/validation/stepConfigSchemas.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/middleware/rbac.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/utils/conditionalLogic-simple.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/session.management.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/repeater.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/unit/services/repeater.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/integration/session.management.test.ts (22 tests) 1855ms
stdout | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/api.expression-validation.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/unit/services/docxRenderer2.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/HelperLibrary.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/HelperLibrary.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/api.expression-validation.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/repeater.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/utils/conditionalLogic-simple.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/shared/validation/stepConfigSchemas.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/middleware/rbac.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/unit/utils/conditionalLogic-simple.test.ts (3 tests) 1925ms
stdout | tests/unit/services/RunExecutionCoordinator.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/unit/services/RunExecutionCoordinator.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/HelperLibrary.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/WorkflowOptimizationService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stderr | tests/unit/middleware/rbac.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:184:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:164:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:126:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

stdout | tests/unit/services/docxRenderer2.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":40,"time":1767814186702,"env":"test","module":"rbac-middleware","path":"/api/workflows","permission":"workflow:create","msg":"Unauthenticated user attempted to access protected resource"}
stdout | tests/unit/middleware/rbac.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":40,"time":1767814186707,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permission":"workflow:create","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1767814186708,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"permission":"workflow:view","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1767814186710,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permissions":["workflow:create","workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (none of required permissions)"}
{"level":40,"time":1767814186712,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","permissions":["workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (missing some required permissions)"}
{"level":40,"time":1767814186714,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1767814186715,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"requiredRoles":["owner"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1767814186715,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","requiredRoles":["owner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767814186717,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"runner","requiredRoles":["owner","builder"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767814186718,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder","runner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767814186723,"env":"test","module":"rbac-middleware","path":"/api/test","permission":"workflow:view","msg":"Unauthenticated user attempted to access protected resource"}
{"level":40,"time":1767814186724,"env":"test","module":"rbac-middleware","userId":"user-123","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":40,"time":1767814186725,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"invalid-role","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
 Γ£ô tests/unit/services/docxRenderer2.test.ts (27 tests) 1891ms
 Γ£ô tests/unit/middleware/rbac.test.ts (44 tests) 1793ms
stdout | tests/unit/utils/pagination.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/unit/shared/validation/stepConfigSchemas.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/utils/encryption.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/unit/utils/encryption.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/RunExecutionCoordinator.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ£ô tests/unit/shared/validation/stepConfigSchemas.test.ts (8 tests) 1833ms
stderr | tests/integration/api.expression-validation.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/services/repeater.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/docxHelpers.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/utils/encryption.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/workflows/validation.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stderr | tests/unit/HelperLibrary.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814187217,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
stdout | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
≡ƒº¬ Setting up test environment...

{"level":30,"time":1767814187244,"env":"test","msg":"Real-time collaboration server initialized"}
stdout | tests/integration/api.expression-validation.test.ts > Expression Validation API Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814187227,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814187228,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814187235,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814187243,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814187243,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814187244,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814187244,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stdout | tests/unit/services/repeater.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/repeater.test.ts (18 tests) 1902ms
stderr | tests/unit/services/RunExecutionCoordinator.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/HelperLibrary.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/intake.portal.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stderr | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/unit/HelperLibrary.test.ts (60 tests) 1918ms
stdout | tests/unit/WorkflowOptimizationService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/unit/WorkflowOptimizationService.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/unit/utils/encryption.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/captcha.service.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/shared/validation/PageValidator.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/unit/services/TemplateAnalysisService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/services/RunExecutionCoordinator.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/RunExecutionCoordinator.test.ts (2 tests) 2000ms
stdout | tests/unit/WorkflowOptimizationService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":30,"time":1767814187804,"env":"test","module":"user-credentials-repository","userId":"yYo2wUlsZnIS4gk2Rf9H0","msg":"User credentials created"}
stdout | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/docxHelpers.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/unit/services/docxHelpers.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/utils/encryption.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/ui/blocks/SendDataToTableBlockEditor.test.tsx (12 tests) 1783ms
{"level":30,"time":1767814187917,"env":"test","module":"email-queue","jobId":"42aeaade-a99c-41cb-adbc-92c6b6c9c5a0","to":"test-V4TG0RMwELXcae8S_YW5Y@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stdout | tests/unit/utils/pagination.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stdout | tests/unit/utils/pagination.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/unit/utils/encryption.test.ts (29 tests) 1922ms
{"level":30,"time":1767814187978,"env":"test","module":"auth-routes","userId":"yYo2wUlsZnIS4gk2Rf9H0","email":"test-V4TG0RMwELXcae8S_YW5Y@example.com","msg":"User registered"}
stderr | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/workflow/QueryBlock.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/unit/workflows/validation.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/unit/workflows/validation.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/docxHelpers.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/utils/pagination.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/workflows/validation.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/WorkflowOptimizationService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/ui/blocks/SendDataBlockEditorRouting.test.ts (10 tests) 1913ms
stdout | tests/unit/engine/Performance.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/integration/intake.portal.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/integration/intake.portal.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/utils/conditionalLogic.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/unit/captcha.service.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/captcha.service.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/WorkflowOptimizationService.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/services/docxHelpers.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/unit/WorkflowOptimizationService.test.ts (4 tests) 1795ms
stdout | tests/integration/intake.portal.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/utils/pagination.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/auth.routes.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/unit/shared/validation/PageValidator.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/unit/shared/validation/PageValidator.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/captcha.service.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/TemplateAnalysisService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/services/TemplateAnalysisService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/engine.expr.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stderr | tests/unit/workflows/validation.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/shared/validation/PageValidator.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/docxHelpers.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/TemplateAnalysisService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ£ô tests/unit/services/docxHelpers.test.ts (39 tests) 1839ms
stdout | tests/unit/utils/pagination.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814188951,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/integration/mfa.flow.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/unit/workflow/QueryBlock.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/unit/workflow/QueryBlock.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/unit/utils/pagination.test.ts (24 tests) 1827ms
stdout | tests/unit/workflows/validation.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/integration/intake.portal.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/unit/workflows/validation.test.ts (66 tests) 1855ms
{"level":50,"time":1767814189142,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stdout | tests/unit/workflow/QueryBlock.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/captcha.service.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/api.ai.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/engine/Performance.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/engine/Performance.test.ts
≡ƒº¬ Setting up test environment...

{"level":50,"time":1767814189336,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/unit/shared/validation/PageValidator.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/api.expression-validation.test.ts > Expression Validation API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.expression-validation.test.ts:75:5 {
  length: 361,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(yYo2wUlsZnIS4gk2Rf9H0) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

stdout | tests/integration/api.expression-validation.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/services/TemplateAnalysisService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/intake.portal.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/auth.routes.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/auth.routes.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/integration/intake.portal.test.ts (18 tests) 1831ms
stdout | tests/unit/utils/conditionalLogic.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/unit/utils/conditionalLogic.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/captcha.service.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/captcha.service.test.ts (11 tests) 1812ms
stdout | tests/unit/utils/variableResolver.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/engine/Performance.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/auth.routes.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/engine.expr.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/unit/engine.expr.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/utils/conditionalLogic.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/workflow/QueryBlock.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/shared/validation/PageValidator.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/TemplateAnalysisService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/MfaService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

 Γ£ô tests/unit/shared/validation/PageValidator.test.ts (3 tests) 1912ms
 Γ£ô tests/unit/services/TemplateAnalysisService.test.ts (27 tests) 1786ms
 Γ£ô tests/integration/api.expression-validation.test.ts (10 tests) 3002ms
stdout | tests/unit/engine.expr.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/mfa.flow.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/integration/mfa.flow.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/workflow/QueryBlock.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/analytics_preservation.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

 Γ£ô tests/unit/workflow/QueryBlock.test.ts (3 tests) 1793ms
stdout | tests/integration/mfa.flow.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/engine/Performance.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/auth.routes.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/utils/conditionalLogic.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/api.ai.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/integration/api.ai.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/WorkflowService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

stderr | tests/unit/engine.expr.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/services/WorkflowService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/engine/Performance.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/api.ai.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/api.ai.personalization.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

 Γ£ô tests/unit/engine/Performance.test.ts (3 tests) 1903ms
stdout | tests/integration/auth.routes.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/utils/variableResolver.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/unit/services/DatavaultColumnsService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/utils/variableResolver.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/integration/auth.routes.test.ts (41 tests) 1714ms
stdout | tests/unit/utils/conditionalLogic.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/engine.run-conditions.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

 Γ£ô tests/unit/utils/conditionalLogic.test.ts (29 tests) 1832ms
stderr | tests/integration/mfa.flow.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/repositories/DatavaultTablesRepository.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/engine.expr.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/engine.expr.test.ts (26 tests) 1845ms
stdout | tests/unit/utils/variableResolver.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/services/MfaService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/services/DataSourceService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/integration/analytics_preservation.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/integration/mfa.flow.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/integration/api.ai.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/integration/mfa.flow.test.ts (16 tests) 1845ms
stdout | tests/integration/analytics_preservation.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/api.ai.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/analytics_preservation.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/repositories/DocumentTemplateRepository.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

 Γ£ô tests/integration/api.ai.test.ts (32 tests) 1868ms
stderr | tests/unit/utils/variableResolver.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/lib/queries/QueryRunner.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767814191364,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
stdout | tests/unit/services/WorkflowService.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/WorkflowService.test.ts (15 tests) 1049ms
       Γ£ô should return workflow if user is the creator  993ms
stdout | tests/unit/utils/variableResolver.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/utils/variableResolver.test.ts (20 tests) 1875ms
stdout | tests/unit/repositories/DatavaultTablesRepository.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/unit/services/DatavaultColumnsService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/unit/repositories/DatavaultTablesRepository.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/DatavaultTablesService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/unit/services/DatavaultColumnsService.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/integration/analytics_preservation.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/DataSourceService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/unit/engine.run-conditions.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/services/DataSourceService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/schema/documentEngine.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/integration/api.ai.personalization.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/unit/services/DatavaultColumnsService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/DataSourceService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/repositories/DatavaultTablesRepository.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/lib/queries/QueryRunner.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/services/EmailTemplateMetadataService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/unit/repositories/DocumentTemplateRepository.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/unit/repositories/DocumentTemplateRepository.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/lib/queries/QueryRunner.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/unit/repositories/DatavaultColumnsRepository.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/CollectionService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stderr | tests/unit/services/DatavaultColumnsService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/MfaService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/analytics_preservation.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/workflow/PreviewExecution.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stderr | tests/unit/services/DataSourceService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/unit/services/MfaService.test.ts (23 tests) 1671ms
         Γ£ô should try multiple codes if first doesn't match  320ms
stdout | tests/unit/lib/queries/QueryRunner.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":40,"time":1767814192432,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stderr | tests/unit/repositories/DatavaultTablesRepository.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/integration/analytics_preservation.test.ts (1 test) 1378ms
     Γ£ô should preserve lifetime user count when a user is deleted  515ms
stdout | tests/unit/repositories/DatavaultColumnsRepository.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/repositories/DocumentTemplateRepository.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/DatavaultColumnsService.test.ts > DatavaultColumnsService > getColumns > should throw 404 if table not found
[DEBUG] Table not found: 660e8400-e29b-41d4-a716-446655440001

stdout | tests/unit/services/DataSourceService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/repositories/DatavaultTablesRepository.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/DatavaultColumnsService.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/DataSourceService.test.ts (9 tests) 961ms
 Γ£ô tests/unit/repositories/DatavaultTablesRepository.test.ts (12 tests) 1162ms
 Γ£ô tests/unit/services/DatavaultColumnsService.test.ts (14 tests) 1122ms
stdout | tests/unit/services/DatavaultTablesService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stdout | tests/unit/schema/documentEngine.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/unit/schema/documentEngine.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/unit/lib/queries/QueryRunner.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/services/EmailTemplateMetadataService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stderr | tests/unit/repositories/DatavaultColumnsRepository.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/repositories/DocumentTemplateRepository.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/DatavaultTablesService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/schema/documentEngine.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/CollectionFieldService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/services/EmailTemplateMetadataService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/CollectionService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/lib/queries/QueryRunner.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/DatavaultTablesService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/services/EmailTemplateMetadataService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ£ô tests/unit/lib/queries/QueryRunner.test.ts (5 tests) 1003ms
stdout | tests/unit/repositories/DatavaultColumnsRepository.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/repositories/DocumentTemplateRepository.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/repositories/DatavaultColumnsRepository.test.ts (13 tests) 1008ms
 Γ£ô tests/unit/repositories/DocumentTemplateRepository.test.ts (15 tests) 1112ms
stdout | tests/unit/services/RecordService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit

stdout | tests/unit/services/CollectionService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/workflow/PreviewExecution.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/unit/LifecycleHookService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/services/CollectionService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/schema/documentEngine.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/datavault.routes.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }

stderr | tests/unit/services/DatavaultTablesService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/DocumentTemplateService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/engine.run-conditions.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/services/EmailTemplateMetadataService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/engine.run-conditions.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/schema/documentEngine.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/DatavaultTablesService.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/schema/documentEngine.test.ts (33 tests) 1094ms
stderr | tests/unit/services/CollectionService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/services/EmailTemplateMetadataService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/CollectionFieldService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

 Γ£ô tests/services/EmailTemplateMetadataService.test.ts (13 tests) 948ms
 Γ£ô tests/unit/services/DatavaultTablesService.test.ts (12 tests) 891ms
stdout | tests/integration/datavault.api-tokens.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/integration/datavault.row-notes.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stderr | tests/unit/engine.run-conditions.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/CollectionService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/services/BrandingService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767814194470,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
stdout | tests/unit/services/CollectionFieldService.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/unit/services/CollectionService.test.ts (14 tests) 849ms
stdout | tests/unit/services/RecordService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stdout | tests/unit/LifecycleHookService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip question when condition is false
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q1 executed. Key: has_code, Value: true. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q2 executed. Key: code, Value: ABC123. Context keys: 5

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip compute node when condition is false
[DEBUG Question] Node q1 executed. Key: amount, Value: 0. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute compute node when condition is true
[DEBUG Question] Node q1 executed. Key: amount, Value: 100. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q3 executed. Key: amount, Value: 1000. Context keys: 5

stdout | tests/unit/services/CollectionFieldService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should return trace when debug is enabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should not return trace when debug is disabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

stdout | tests/unit/engine.run-conditions.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/DocumentTemplateService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/services/RecordService.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/unit/engine.run-conditions.test.ts (15 tests) 976ms
stdout | tests/unit/services/RecordService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/LifecycleHookService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/datavault.routes.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/debug_import.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops

stdout | tests/unit/services/PortalAuthService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stderr | tests/unit/services/CollectionFieldService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/branding.routes.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/LifecycleHookService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/DocumentTemplateService.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/services/AccountLockoutService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/unit/services/DocumentTemplateService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/CollectionFieldService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/datavault.row-notes.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

 Γ£ô tests/unit/services/CollectionFieldService.test.ts (23 tests) 993ms
stderr | tests/unit/services/RecordService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":40,"time":1767814195656,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stdout | tests/services/BrandingService.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

stdout | tests/unit/workflow/PreviewExecution.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/unit/LifecycleHookService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/RecordService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/workflow/PreviewExecution.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/EmailTemplateMetadataService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

 Γ£ô tests/unit/services/RecordService.test.ts (17 tests) 969ms
stderr | tests/unit/services/DocumentTemplateService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/services/BrandingService.test.ts
≡ƒº¬ Setting up test environment...

{"level":40,"time":1767814195983,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stdout | tests/services/BrandingService.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":40,"time":1767814196049,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
stdout | tests/unit/LifecycleHookService.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":50,"time":1767814196054,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1767814196057,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1767814196064,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1767814196066,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
stdout | tests/unit/debug_import.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops

 Γ£ô tests/unit/LifecycleHookService.test.ts (17 tests) 952ms
stdout | tests/integration/datavault.api-tokens.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops

stdout | tests/unit/services/DocumentTemplateService.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/services/AccountLockoutService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

 Γ£ô tests/unit/services/DocumentTemplateService.test.ts (14 tests) 923ms
stdout | tests/unit/services/AccountLockoutService.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/services/PortalAuthService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

 Γ£ô tests/unit/services/AccountLockoutService.test.ts (23 tests) 31ms
stderr | tests/unit/workflow/PreviewExecution.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/services/BrandingService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com

stdout | tests/unit/services/PortalAuthService.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/PortalAuthService.test.ts (42 tests) 145ms
stderr | tests/services/BrandingService.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/branding.routes.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops

stdout | tests/unit/workflow/PreviewExecution.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":40,"time":1767814196701,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
{"level":40,"time":1767814196754,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stdout | tests/unit/services/DatavaultReferenceColumns.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }

 Γ£ô tests/unit/workflow/PreviewExecution.test.ts (3 tests) 920ms
stdout | tests/services/BrandingService.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/services/BrandingService.test.ts (16 tests) 884ms
stderr | tests/unit/services/EmailTemplateMetadataService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/services/EmailTemplateMetadataService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/datavault.api-tokens.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/unit/services/EmailTemplateMetadataService.test.ts (21 tests) 34ms
stdout | tests/unit/services/DatavaultRowsService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

stdout | tests/integration/datavault.api-tokens.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

{"level":40,"time":1767814197151,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
stdout | tests/unit/services/Guardrail.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild

stdout | tests/unit/repositories/DatavaultRowsRepository.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops

stdout | tests/unit/debug_import.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/integration/branding.routes.test.ts
≡ƒº¬ Setting up test environment...

stderr | tests/unit/services/BrandingService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/debug_import.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/BrandingService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/integration/branding.routes.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

 Γ£ô tests/unit/services/BrandingService.test.ts (21 tests) 38ms
stderr | tests/integration/datavault.api-tokens.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/unit/external/ExternalSendRunner.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }

stdout | tests/unit/services/AuditLogService.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stderr | tests/unit/services/Guardrail.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/services/Guardrail.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/external/ExternalSendRunner.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

{"level":30,"time":1767814197682,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
 Γ£ô tests/unit/services/Guardrail.test.ts (3 tests) 21ms
stdout | tests/unit/external/ExternalSendRunner.test.ts
≡ƒº╣ Cleaning up test environment...

{"level":30,"time":1767814197701,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
 Γ£ô tests/unit/external/ExternalSendRunner.test.ts (3 tests) 36ms
stdout | tests/unit/engine/FinalBlockSnapshot.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops

stdout | tests/unit/BlockRunner.validate.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }

stdout | tests/integration/datavault.api-tokens.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/unit/debug_import.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/integration/branding.routes.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stdout | tests/integration/datavault.routes.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/integration/datavault.api-tokens.test.ts (16 tests) 857ms
stderr | tests/unit/services/DatavaultReferenceColumns.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/integration/datavault.routes.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/unit/services/DatavaultReferenceColumns.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/DatavaultReferenceColumns.test.ts (10 tests) 31ms
stderr | tests/unit/repositories/DatavaultRowsRepository.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stderr | tests/unit/services/DatavaultRowsService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/debug_import.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/repositories/DatavaultRowsRepository.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/services/DatavaultRowsService.test.ts
≡ƒº╣ Cleaning up test environment...

stdout | tests/unit/collab.server.test.ts
[dotenv@17.2.3] injecting env (20) from .env -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }

 Γ£ô tests/unit/repositories/DatavaultRowsRepository.test.ts (13 tests) 26ms
 Γ£ô tests/unit/services/DatavaultRowsService.test.ts (8 tests) 25ms
stdout | tests/integration/branding.routes.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/debug_import.test.ts (1 test) 834ms
stdout | tests/integration/datavault.row-notes.test.ts
≡ƒº¬ Setting up test environment...

 Γ£ô tests/integration/branding.routes.test.ts (21 tests) 864ms
stdout | tests/integration/datavault.row-notes.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stderr | tests/integration/datavault.routes.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

stderr | tests/unit/services/AuditLogService.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/services/AuditLogService.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/services/AuditLogService.test.ts (11 tests) 23ms
stderr | tests/unit/BlockRunner.validate.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/BlockRunner.validate.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/BlockRunner.validate.test.ts (7 tests) 20ms
stderr | tests/unit/engine/FinalBlockSnapshot.test.ts
ΓÜá∩╕Å Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

stdout | tests/unit/engine/FinalBlockSnapshot.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/unit/engine/FinalBlockSnapshot.test.ts (3 tests) 23ms
stdout | tests/integration/datavault.routes.test.ts
≡ƒº╣ Cleaning up test environment...

stderr | tests/integration/datavault.row-notes.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

 Γ£ô tests/integration/datavault.routes.test.ts (29 tests) 817ms
stdout | tests/integration/api.ai.personalization.test.ts
≡ƒº¬ Setting up test environment...

stdout | tests/unit/collab.server.test.ts
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`

stdout | tests/integration/api.ai.personalization.test.ts
Γ£à Database initialized for tests
≡ƒöä Running test migrations...

stdout | tests/integration/datavault.row-notes.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/integration/datavault.row-notes.test.ts (12 tests) 847ms
{"level":40,"time":1767814199311,"env":"test","module":"auth-service","msg":"JWT_SECRET is less than 32 characters"}
 Γåô tests/unit/collab.server.test.ts (14 tests | 14 skipped)
stderr | tests/integration/api.ai.personalization.test.ts
ΓÜá∩╕Å Migrations failed (non-fatal if DB exists): error: type "auth_provider" already exists
    at cn.parseErrorMessage (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1182:6)
    at cn.handlePacket (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1143:13)
    at cn.parse (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1127:36)
    at v.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1190:16)
    at v.emit (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:397:12)
    at WebSocket.<anonymous> (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:987:80)
    at callListener (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:290:14)
    at WebSocket.onMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\event-target.js:209:9)
    at WebSocket.emit (node:events:508:28)
    at Receiver.receiverOnMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\websocket.js:1220:20)
    at Receiver.emit (node:events:508:28)
    at Receiver.dataMessage (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:569:14)
    at Receiver.getData (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:496:10)
    at Receiver.startLoop (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:167:16)
    at Receiver._write (C:\Users\scoot\poll\VaultLogic\node_modules\ws\lib\receiver.js:94:10)
    at writeOrBuffer (node:internal/streams/writable:570:12) {
  length: 93,
  severity: 'ERROR',
  code: '42710',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'typecmds.c',
  line: '1177',
  routine: 'DefineEnum'
}

{"level":30,"time":1767814199701,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
stdout | tests/integration/api.ai.personalization.test.ts > Personalization API Integration Tests
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814199710,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814199710,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814199714,"env":"test","module":"documents-routes","msg":"Document routes registered"}
stdout | tests/integration/api.ai.personalization.test.ts
≡ƒº╣ Cleaning up test environment...

 Γ£ô tests/integration/api.ai.personalization.test.ts (3 tests) 1160ms

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ» Failed Suites 10 ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»

 FAIL  tests/integration/api.projects.test.ts > Projects API Integration Tests
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/api.projects.test.ts:61:8
     59|         lastName: "User",
     60|       })
     61|       .expect(201);
       |        ^
     62| 
     63|     authToken = registerResponse.body.token;
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[1/326]ΓÄ»

 FAIL  tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/api.runs.docx.test.ts:110:8
    108|       .post('/api/auth/register')
    109|       .send({ email, password: 'TestPassword123' })
    110|       .expect(201);
       |        ^
    111| 
    112|     authToken = registerResponse.body.token;
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[2/326]ΓÄ»

 FAIL  tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests
TypeError: actual.getSession is not a function
 Γ¥» setupAuth tests/integration/api.runs.graph.test.ts:35:24
     33|       ...actual,
     34|       setupAuth: (app: Express) => {
     35|         app.use(actual.getSession());
       |                        ^
     36| 
     37|         // Debug middleware to log cookies and session AND restore reqΓÇª
 Γ¥» Module.registerRoutes server/routes.ts:19:9
 Γ¥» tests/integration/api.runs.graph.test.ts:67:20

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[3/326]ΓÄ»

 FAIL  tests/integration/api.snapshots.test.ts > Stage 13: Workflow Snapshots & Versioning
TypeError: actual.getSession is not a function
 Γ¥» setupAuth tests/integration/api.snapshots.test.ts:28:32
     26|             ...actual,
     27|             setupAuth: (app: Express) => {
     28|                 app.use(actual.getSession());
       |                                ^
     29| 
     30|                 // Debug middleware to log cookies and session AND resΓÇª
 Γ¥» Module.registerRoutes server/routes.ts:19:9
 Γ¥» tests/integration/api.snapshots.test.ts:62:24

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[4/326]ΓÄ»

 FAIL  tests/integration/js_helpers.test.ts > Detailed Verification: JS Helper Availability
TypeError: actual.getSession is not a function
 Γ¥» setupAuth tests/integration/js_helpers.test.ts:18:28
     16|         ...actual,
     17|         setupAuth: (app: Express) => {
     18|             app.use(actual.getSession());
       |                            ^
     19|             app.use((req, res, next) => {
     20|                 const r = req as any;
 Γ¥» Module.registerRoutes server/routes.ts:19:9
 Γ¥» tests/integration/js_helpers.test.ts:54:15

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[5/326]ΓÄ»

 FAIL  tests/integration/ai/workflowEdit.test.ts > POST /api/workflows/:workflowId/ai/edit - Integration Test
error: invalid input syntax for type uuid: "test-tenant"
 Γ¥» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Γ¥» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Γ¥» tests/integration/ai/workflowEdit.test.ts:64:20
     62| 
     63|     // Create test user
     64|     const [user] = await db.insert(users).values({
       |                    ^
     65|       email: 'test@example.com',
     66|       fullName: 'Test User',

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[6/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management
error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
 Γ¥» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Γ¥» tests/integration/auth/oauth2.sessions.test.ts:72:7
     70|   afterAll(async () => {
     71|     if (testTenantId) {
     72|       await db.delete(tenants).where(eq(tenants.id, testTenantId));
       |       ^
     73|     }
     74|   });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[7/326]ΓÄ»

 FAIL  tests/integration/auth/portal.authentication.test.ts [ tests/integration/auth/portal.authentication.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/auth/portal.authentication.test.ts
ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[8/326]ΓÄ»

 FAIL  tests/integration/workflows/runtime-pipelines.test.ts > Runtime Pipelines Integration Tests
error: insert or update on table "projects" violates foreign key constraint "projects_creator_id_users_id_fk"
 Γ¥» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Γ¥» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Γ¥» tests/integration/workflows/runtime-pipelines.test.ts:69:23
     67| 
     68|     // Create test project
     69|     const [project] = await db
       |                       ^
     70|       .insert(projects)
     71|       .values({

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[9/326]ΓÄ»

 FAIL  tests/integration/workflows/runtime-pipelines.test.ts > Runtime Pipelines Integration Tests
error: syntax error at end of input
 Γ¥» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Γ¥» tests/integration/workflows/runtime-pipelines.test.ts:212:5
    210|     await db.delete(datavaultValues).where(sql`1=1`);
    211|     await db.delete(datavaultRows).where(sql`1=1`);
    212|     await db.delete(datavaultColumns).where(sql`table_id = ${testTableΓÇª
       |     ^
    213|     await db.delete(datavaultTables).where(sql`id = ${testTableId}`);
    214|     await db.delete(workflowRuns).where(sql`id = ${testRunId}`);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[10/326]ΓÄ»

 FAIL  tests/unit/services/WorkflowPatchService.test.ts [ tests/unit/services/WorkflowPatchService.test.ts ]
TypeError: () => ({
    createTable: __vite_ssr_import_0__.vi.fn(),
    requirePermission: __vite_ssr_import_0__.vi.fn()
  }) is not a constructor
 Γ¥» new WorkflowPatchService server/services/WorkflowPatchService.ts:27:36
     25| export class WorkflowPatchService {
     26|   private tempIdMap: Map<string, string> = new Map();
     27|   private datavaultTablesService = new DatavaultTablesService();
       |                                    ^
     28|   private datavaultColumnsService = new DatavaultColumnsService();
     29| 
 Γ¥» server/services/WorkflowPatchService.ts:773:37
 Γ¥» tests/unit/services/WorkflowPatchService.test.ts:2:1

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[11/326]ΓÄ»


ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ» Failed Tests 315 ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter rows by equals condition
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:85:30
     83|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
     84| 
     85|       expect(result.success).toBe(true);
       |                              ^
     86|       expect(result.data?.filtered_users.count).toBe(3);
     87|       expect(result.data?.filtered_users.rows.every((r: any) => r.cityΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[12/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with greater_than operator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:116:30
    114|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    115| 
    116|       expect(result.success).toBe(true);
       |                              ^
    117|       expect(result.data?.senior_users.count).toBe(2);
    118|       expect(result.data?.senior_users.rows.every((r: any) => r.age > ΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[13/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with AND combinator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:148:30
    146|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    147| 
    148|       expect(result.success).toBe(true);
       |                              ^
    149|       expect(result.data?.active_nyc.count).toBe(2);
    150|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[14/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with OR combinator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:179:30
    177|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    178| 
    179|       expect(result.success).toBe(true);
       |                              ^
    180|       expect(result.data?.young_or_sf.count).toBe(2); // Bob (25) and ΓÇª
    181|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[15/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by single key ascending
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:208:30
    206|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    207| 
    208|       expect(result.success).toBe(true);
       |                              ^
    209|       const ages = result.data?.sorted_users.rows.map((r: any) => r.agΓÇª
    210|       expect(ages).toEqual([25, 28, 30, 32, 35]);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[16/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by single key descending
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:236:30
    234|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    235| 
    236|       expect(result.success).toBe(true);
       |                              ^
    237|       const names = result.data?.sorted_users.rows.map((r: any) => r.nΓÇª
    238|       expect(names).toEqual(['Eve', 'Diana', 'Charlie', 'Bob', 'Alice'ΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[17/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by multiple keys
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:265:30
    263|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    264| 
    265|       expect(result.success).toBe(true);
       |                              ^
    266|       const rows = result.data?.sorted_users.rows;
    267|       expect(rows[0].city).toBe('LA');

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[18/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply limit
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:295:30
    293|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    294| 
    295|       expect(result.success).toBe(true);
       |                              ^
    296|       expect(result.data?.limited_users.count).toBe(3);
    297|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[19/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply offset
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:320:30
    318|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    319| 
    320|       expect(result.success).toBe(true);
       |                              ^
    321|       expect(result.data?.offset_users.count).toBe(3);
    322|       expect(result.data?.offset_users.rows[0].name).toBe('Charlie');

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[20/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply offset and limit together
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:347:30
    345|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    346| 
    347|       expect(result.success).toBe(true);
       |                              ^
    348|       expect(result.data?.paged_users.count).toBe(2);
    349|       expect(result.data?.paged_users.rows[0].name).toBe('Bob');

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[21/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Select Operations > should select specific columns
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:376:30
    374|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    375| 
    376|       expect(result.success).toBe(true);
       |                              ^
    377|       const row = result.data?.name_age_only.rows[0];
    378|       expect(row).toHaveProperty('name');

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[22/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Dedupe Operations > should deduplicate by field
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:414:30
    412|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    413| 
    414|       expect(result.success).toBe(true);
       |                              ^
    415|       // NYC, LA, SF = 3 unique cities
    416|       expect(result.data?.unique_cities.count).toBe(3);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[23/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Derived Outputs > should output count variable
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:447:30
    445|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    446| 
    447|       expect(result.success).toBe(true);
       |                              ^
    448|       expect(result.data?.user_count).toBe(5);
    449|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[24/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Derived Outputs > should output first row variable
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:475:30
    473|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    474| 
    475|       expect(result.success).toBe(true);
       |                              ^
    476|       expect(result.data?.youngest_user).toBeDefined();
    477|       expect(result.data?.youngest_user.name).toBe('Bob');

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[25/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Comprehensive Pipeline > should apply all operations in sequence
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:519:30
    517|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    518| 
    519|       expect(result.success).toBe(true);
       |                              ^
    520|       expect(result.data?.processed_users.count).toBe(2); // Limit of 2
    521|       expect(result.data?.active_count).toBe(2);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[26/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Edge Cases > should handle empty input list
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:567:30
    565|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    566| 
    567|       expect(result.success).toBe(true);
       |                              ^
    568|       expect(result.data?.filtered_users.count).toBe(0);
    569|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[27/326]ΓÄ»

 FAIL  tests/ListTools.test.ts > List Tools Block > Edge Cases > should handle plain arrays
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ListTools.test.ts:621:30
    619|       const result = await (blockRunner as any).executeListToolsBlock(ΓÇª
    620| 
    621|       expect(result.success).toBe(true);
       |                              ^
    622|       expect(result.data?.sorted_array.rows[0].score).toBe(90);
    623|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[28/326]ΓÄ»

 FAIL  tests/integration/analytics_service.test.ts > Analytics Service Integration > should generate events and metrics on run completion
Error: Workflow is not active
 Γ¥» RunAuthResolver.verifyCreateAccess server/services/runs/RunAuthResolver.ts:110:53
    108| 
    109|             if (!workflow) throw new Error('Workflow not found');
    110|             if (workflow.status !== 'active') throw new Error('WorkfloΓÇª
       |                                                     ^
    111|             if (!workflow.isPublic) throw new Error('Workflow is not pΓÇª
    112| 
 Γ¥» RunService.createRun server/services/RunService.ts:202:22
 Γ¥» tests/integration/analytics_service.test.ts:42:21

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[29/326]ΓÄ»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should analyze a DOCX file and return variables
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Γ¥» tests/integration/api.ai.doc.test.ts:143:37
    141|                 } catch (e) { console.log("FAIL_BODY: " + response.texΓÇª
    142|             }
    143|             expect(response.status).toBe(200);
       |                                     ^
    144| 
    145|             expect(response.body.data).toHaveProperty("variables");

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[30/326]ΓÄ»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should fail if no file is provided
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 Γ¥» tests/integration/api.ai.doc.test.ts:168:18
    166|             await request(baseURL)
    167|                 .post("/api/ai/doc/analyze")
    168|                 .expect(400);
       |                  ^
    169|         });
    170|     });
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[31/326]ΓÄ»

 FAIL  tests/integration/api.dataSources.native.test.ts > Data Sources API - Native Catalog > should list databases and databases' tables in the catalog
Error: expected 200 "OK", got 500 "Internal Server Error"
 Γ¥» tests/integration/api.dataSources.native.test.ts:60:14
     58|             .get("/api/data-sources/native/catalog")
     59|             .set("Authorization", `Bearer ${ctx.authToken}`)
     60|             .expect(200);
       |              ^
     61| 
     62|         const catalog = response.body;
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[32/326]ΓÄ»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Templates API > POST /api/projects/:ctx.projectId/templates > should reject non-docx files
Error: expected 500 "Internal Server Error", got 400 "Bad Request"
 Γ¥» tests/integration/api.templates-runs.test.ts:119:12
    117|           .field("name", "Test Template")
    118|           .attach("file", mockPdf, "test.pdf")
    119|           .expect(500); // Multer rejects before handler
       |            ^
    120|       });
    121| 
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[33/326]ΓÄ»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Runs API > POST /api/workflows/:id/run > should reject without required permission
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/api.templates-runs.test.ts:289:12
    287|           .post("/api/auth/register")
    288|           .send({ email: viewerEmail, password: "TestPassword123" })
    289|           .expect(201);
       |            ^
    290| 
    291|         await db.update(schema.users)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[34/326]ΓÄ»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:ctx.projectId/workflows > should reject without permission
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/api.workflows.test.ts:56:10
     54|         .post("/api/auth/register")
     55|         .send({ email: viewerEmail, password: "TestPassword123" })
     56|         .expect(201);
       |          ^
     57| 
     58|       await db.update(schema.users)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[35/326]ΓÄ»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without authentication
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Γ¥» tests/integration/api.workflows.test.ts:229:15
    227| 
    228|       if (workflowResponse.status !== 201) {
    229|         throw new Error(`Failed to create workflow: ${workflowResponseΓÇª
       |               ^
    230|       }
    231|       workflowId = workflowResponse.body.id;

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[36/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Complete Registration ΓåÆ Login Flow > should complete registration, verify email, then login
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/auth.flows.real.test.ts:70:36
     68|         .send({ email, password });
     69| 
     70|       expect(loginAttempt2.status).toBe(200);
       |                                    ^
     71|       expect(loginAttempt2.body.token).toBeDefined();
     72|       expect(loginAttempt2.body.user.emailVerified).toBe(true);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[37/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should lock account after 5 failed attempts, then unlock after waiting
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Γ¥» tests/integration/auth.flows.real.test.ts:110:36
    108|         });
    109| 
    110|       expect(lockedAttempt.status).toBe(423);
       |                                    ^
    111|       expect(lockedAttempt.body.message || lockedAttempt.body.error).tΓÇª
    112| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[38/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should record all login attempts
AssertionError: expected 1 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 1

 Γ¥» tests/integration/auth.flows.real.test.ts:145:31
    143|       });
    144| 
    145|       expect(attempts.length).toBe(3);
       |                               ^
    146|       expect(attempts.filter(a => !a.successful).length).toBe(2);
    147|       expect(attempts.filter(a => a.successful).length).toBe(1);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[39/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should complete MFA setup and login with TOTP
AssertionError: expected undefined to be defined
 Γ¥» tests/integration/auth.flows.real.test.ts:182:25
    180|       });
    181| 
    182|       expect(mfaSecret).toBeDefined();
       |                         ^
    183|       expect(mfaSecret!.enabled).toBe(false); // Not enabled until verΓÇª
    184| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[40/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should login with backup code when TOTP unavailable
TypeError: Cannot read properties of undefined (reading 'secret')
 Γ¥» tests/integration/auth.flows.real.test.ts:248:52
    246|       });
    247| 
    248|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    249| 
    250|       await request(app)

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[41/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Password Reset Flow > should complete full password reset flow
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Γ¥» tests/integration/auth.flows.real.test.ts:332:36
    330|         });
    331| 
    332|       expect(resetResponse.status).toBe(200);
       |                                    ^
    333| 
    334|       // Step 4: Verify old password no longer works

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[42/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should rotate refresh token on each use
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/auth.flows.real.test.ts:405:40
    403| 
    404|       let cookies = loginResponse.headers['set-cookie'] as unknown as ΓÇª
    405|       let refreshTokenCookie = cookies.find(c => c.startsWith('refreshΓÇª
       |                                        ^
    406| 
    407|       expect(refreshTokenCookie).toBeDefined();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[43/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should detect and prevent refresh token reuse (token theft)
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/auth.flows.real.test.ts:438:44
    436| 
    437|       const cookies = loginResponse.headers['set-cookie'] as unknown aΓÇª
    438|       const originalRefreshToken = cookies.find(c => c.startsWith('refΓÇª
       |                                            ^
    439| 
    440|       // Use token once (rotation happens)

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[44/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should list all active sessions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/auth.flows.real.test.ts:492:39
    490|         .set("Authorization", `Bearer ${token}`);
    491| 
    492|       expect(sessionsResponse.status).toBe(200);
       |                                       ^
    493|       expect(sessionsResponse.body.sessions).toBeDefined();
    494|       expect(sessionsResponse.body.sessions.length).toBeGreaterThanOrEΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[45/326]ΓÄ»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/auth.flows.real.test.ts:517:40
    515| 
    516|       const sessions = sessionsResponse.body.sessions;
    517|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    518| 
    519|       // Revoke first session

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[46/326]ΓÄ»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return 403 for unverified email
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/auth.routes.real.test.ts:192:31
    190|         .send({ email, password });
    191| 
    192|       expect(response.status).toBe(403);
       |                               ^
    193|       expect(response.body.message || response.body.error).toBeDefinedΓÇª
    194|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[47/326]ΓÄ»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should record failed login attempt
AssertionError: expected 0 to be greater than 0
 Γ¥» tests/integration/auth.routes.real.test.ts:211:31
    209|       });
    210| 
    211|       expect(attempts.length).toBeGreaterThan(0);
       |                               ^
    212|       const failedAttempt = attempts.find(a => !a.successful);
    213|       expect(failedAttempt).toBeDefined();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[48/326]ΓÄ»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return requiresMfa=true for MFA-enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/auth.routes.real.test.ts:223:31
    221|         .send({ email, password });
    222| 
    223|       expect(response.status).toBe(200);
       |                               ^
    224|       expect(response.body.requiresMfa).toBe(true);
    225|       expect(response.body.userId).toBeDefined();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[49/326]ΓÄ»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should lock account after 5 failed attempts
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Γ¥» tests/integration/auth.routes.real.test.ts:250:31
    248|         });
    249| 
    250|       expect(response.status).toBe(423);
       |                               ^
    251|       expect(response.body).toBeDefined();
    252|       expect(response.body.error || response.body.message).toBeDefinedΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[50/326]ΓÄ»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/refresh-token > should refresh access token with valid refresh token
AssertionError: expected undefined to be defined
 Γ¥» tests/integration/auth.routes.real.test.ts:295:23
    293| 
    294|       const cookies = (loginResponse.headers as any)['set-cookie'] as ΓÇª
    295|       expect(cookies).toBeDefined();
       |                       ^
    296|       const refreshTokenCookie = cookies!.find(c => c.startsWith('refrΓÇª
    297|       expect(refreshTokenCookie).toBeDefined();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[51/326]ΓÄ»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/reset-password > should reset password with valid token
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/auth.routes.real.test.ts:405:36
    403|         .send({ email, password: newPassword });
    404| 
    405|       expect(loginResponse.status).toBe(200);
       |                                    ^
    406| 
    407|       // Old password should not work

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[52/326]ΓÄ»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should deny access with expired token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Γ¥» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Γ¥» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Γ¥» tests/integration/datavault-v4-regression.test.ts:186:21
    184|     testDatabaseId = database.id;
    185| 
    186|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    187|       name: 'Test Table',
    188|       slug: 'test-table-' + uniqueSuffix,

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[53/326]ΓÄ»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
AssertionError: expected 500 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 500

 Γ¥» tests/integration/datavault-v4-regression.test.ts:478:37
    476|         .set('Authorization', `Bearer ${otherUserToken}`);
    477| 
    478|       expect(deleteResponse.status).toBe(403);
       |                                     ^
    479|     });
    480|   });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[54/326]ΓÄ»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Γ¥» tests/integration/datavault-v4-regression.test.ts:592:31
    590|         });
    591| 
    592|       expect(response.status).toBe(201);
       |                               ^
    593|       expect(response.body).toBeDefined();
    594|       expect(response.body.role).toBe('read');

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[55/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow owner to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:154:26
    152|         .set('Cookie', ownerCookie);
    153| 
    154|       expect(res.status).toBe(200);
       |                          ^
    155|       expect(res.body.id).toBe(tableId);
    156|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[56/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow writer to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:163:26
    161|         .set('Cookie', writerCookie);
    162| 
    163|       expect(res.status).toBe(200);
       |                          ^
    164|       expect(res.body.id).toBe(tableId);
    165|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[57/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow reader to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:172:26
    170|         .set('Cookie', readerCookie);
    171| 
    172|       expect(res.status).toBe(200);
       |                          ^
    173|       expect(res.body.id).toBe(tableId);
    174|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[58/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should deny non-member from reading table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:181:26
    179|         .set('Cookie', nonMemberCookie);
    180| 
    181|       expect(res.status).toBe(403);
       |                          ^
    182|       expect(res.body.message).toContain('Access denied');
    183|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[59/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should allow owner to update table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:193:26
    191|         .send({ description: 'Updated by owner' });
    192| 
    193|       expect(res.status).toBe(200);
       |                          ^
    194|     });
    195| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[60/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should deny writer from updating table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:202:26
    200|         .send({ description: 'Attempt by writer' });
    201| 
    202|       expect(res.status).toBe(403);
       |                          ^
    203|       expect(res.body.message).toContain('Access denied');
    204|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[61/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should deny reader from updating table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:212:26
    210|         .send({ description: 'Attempt by reader' });
    211| 
    212|       expect(res.status).toBe(403);
       |                          ^
    213|       expect(res.body.message).toContain('Access denied');
    214|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[62/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny writer from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:223:26
    221|         .set('Cookie', writerCookie);
    222| 
    223|       expect(res.status).toBe(403);
       |                          ^
    224|       expect(res.body.message).toContain('Access denied');
    225|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[63/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny reader from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:232:26
    230|         .set('Cookie', readerCookie);
    231| 
    232|       expect(res.status).toBe(403);
       |                          ^
    233|       expect(res.body.message).toContain('Access denied');
    234|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[64/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny non-member from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:241:26
    239|         .set('Cookie', nonMemberCookie);
    240| 
    241|       expect(res.status).toBe(403);
       |                          ^
    242|       expect(res.body.message).toContain('Access denied');
    243|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[65/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should allow owner to view permissions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:252:26
    250|         .set('Cookie', ownerCookie);
    251| 
    252|       expect(res.status).toBe(200);
       |                          ^
    253|       expect(Array.isArray(res.body)).toBe(true);
    254|       expect(res.body.length).toBe(2); // writer and reader

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[66/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should deny writer from viewing permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:262:26
    260|         .set('Cookie', writerCookie);
    261| 
    262|       expect(res.status).toBe(403);
       |                          ^
    263|       expect(res.body.message).toContain('Access denied');
    264|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[67/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should deny reader from viewing permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:271:26
    269|         .set('Cookie', readerCookie);
    270| 
    271|       expect(res.status).toBe(403);
       |                          ^
    272|       expect(res.body.message).toContain('Access denied');
    273|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[68/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should allow owner to grant permissions
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:283:26
    281|         .send({ userId: nonMemberId, role: 'read' });
    282| 
    283|       expect(res.status).toBe(201);
       |                          ^
    284|       expect(res.body.userId).toBe(nonMemberId);
    285|       expect(res.body.role).toBe('read');

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[69/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should allow owner to update existing permission (upsert)
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:301:26
    299|         .send({ userId: readerId, role: 'write' }); // Upgrade reader ΓÇª
    300| 
    301|       expect(res.status).toBe(201);
       |                          ^
    302|       expect(res.body.role).toBe('write');
    303| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[70/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should deny writer from granting permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:317:26
    315|         .send({ userId: nonMemberId, role: 'read' });
    316| 
    317|       expect(res.status).toBe(403);
       |                          ^
    318|       expect(res.body.message).toContain('Access denied');
    319|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[71/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should prevent modifying table owner permissions
AssertionError: expected 401 to be 500 // Object.is equality

- Expected
+ Received

- 500
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:327:26
    325|         .send({ userId: ownerId, role: 'read' });
    326| 
    327|       expect(res.status).toBe(500);
       |                          ^
    328|       expect(res.body.message).toContain('Cannot modify permissions foΓÇª
    329|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[72/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/permissions/:permissionId > should allow owner to revoke permissions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:347:26
    345|         .set('Cookie', ownerCookie);
    346| 
    347|       expect(res.status).toBe(200);
       |                          ^
    348|       expect(res.body.success).toBe(true);
    349| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[73/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/permissions/:permissionId > should deny writer from revoking permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:370:26
    368|         .set('Cookie', writerCookie);
    369| 
    370|       expect(res.status).toBe(403);
       |                          ^
    371|       expect(res.body.message).toContain('Access denied');
    372|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[74/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce owner includes write and read
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:381:30
    379|         .get(`/api/datavault/tables/${tableId}`)
    380|         .set('Cookie', ownerCookie);
    381|       expect(readRes.status).toBe(200);
       |                              ^
    382| 
    383|       // Owner can update table

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[75/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce write includes read but not owner
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:396:30
    394|         .get(`/api/datavault/tables/${tableId}`)
    395|         .set('Cookie', writerCookie);
    396|       expect(readRes.status).toBe(200);
       |                              ^
    397| 
    398|       // Writer cannot update table schema

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[76/326]ΓÄ»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce read is read-only
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/datavault.permissions.test.ts:411:30
    409|         .get(`/api/datavault/tables/${tableId}`)
    410|         .set('Cookie', readerCookie);
    411|       expect(readRes.status).toBe(200);
       |                              ^
    412| 
    413|       // Reader cannot update

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[77/326]ΓÄ»

 FAIL  tests/integration/metrics.test.ts > Metrics Integration > should expose /metrics endpoint
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/metrics.test.ts:33:33
     31|         const response = await request(app).get('/metrics');
     32| 
     33|         expect(response.status).toBe(200);
       |                                 ^
     34|         expect(response.headers['content-type']).toContain('text/plainΓÇª
     35|         // Prometheus metrics usually contain comments like # HELP or ΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[78/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should complete full MFA setup flow
AssertionError: expected undefined to be defined
 Γ¥» tests/integration/mfa.flow.real.test.ts:68:25
     66|       });
     67| 
     68|       expect(mfaSecret).toBeDefined();
       |                         ^
     69|       expect(mfaSecret!.enabled).toBe(false); // Not enabled until verΓÇª
     70| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[79/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should not allow MFA setup if already enabled
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Γ¥» tests/integration/mfa.flow.real.test.ts:135:46
    133|         .send({ email, password });
    134| 
    135|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    136| 
    137|       // Can't test setup with MFA user since we can't login without MΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[80/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should generate unique backup codes
AssertionError: expected +0 to be 10 // Object.is equality

- Expected
+ Received

- 10
+ 0

 Γ¥» tests/integration/mfa.flow.real.test.ts:156:32
    154|       // All codes should be unique
    155|       const uniqueCodes = new Set(backupCodes);
    156|       expect(uniqueCodes.size).toBe(10);
       |                                ^
    157|     });
    158| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[81/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should require MFA for enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/mfa.flow.real.test.ts:195:36
    193|         .send({ email, password });
    194| 
    195|       expect(loginResponse.status).toBe(200);
       |                                    ^
    196|       expect(loginResponse.body.requiresMfa).toBe(true);
    197|       expect(loginResponse.body.userId).toBe(userId);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[82/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should complete MFA login with valid TOTP
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Γ¥» tests/integration/mfa.flow.real.test.ts:209:46
    207|         .send({ email, password });
    208| 
    209|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    210| 
    211|       // Step 2: Verify MFA

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[83/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should accept TOTP codes within 60-second window
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/mfa.flow.real.test.ts:264:32
    262|         .send({ userId, token: totpCode });
    263| 
    264|       expect(response1.status).toBe(200);
       |                                ^
    265| 
    266|       // Login again for second test

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[84/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should login with valid backup code
TypeError: Cannot read properties of undefined (reading 'secret')
 Γ¥» tests/integration/mfa.flow.real.test.ts:305:52
    303|       });
    304| 
    305|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    306| 
    307|       await request(app)

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[85/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should mark backup code as used
TypeError: Cannot read properties of undefined (reading 'used')
 Γ¥» tests/integration/mfa.flow.real.test.ts:346:29
    344| 
    345|       // For this test, let's verify the used flag logic
    346|       expect(storedCodes[0].used).toBe(false);
       |                             ^
    347| 
    348|       // After using a code, it should be marked as used

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[86/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should try TOTP before backup code
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/mfa.flow.real.test.ts:430:31
    428| 
    429|       // Should succeed with TOTP (backup code ignored)
    430|       expect(response.status).toBe(200);
       |                               ^
    431|     });
    432|   });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[87/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Status > should return MFA status for user
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/mfa.flow.real.test.ts:446:37
    444|         .set("Authorization", `Bearer ${loginResponse.body.token}`);
    445| 
    446|       expect(statusResponse.status).toBe(200);
       |                                     ^
    447|       expect(statusResponse.body.mfaEnabled).toBe(false);
    448|       expect(statusResponse.body.backupCodesRemaining).toBe(0);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[88/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Status > should return backup codes count for MFA users
TypeError: Cannot read properties of undefined (reading 'secret')
 Γ¥» tests/integration/mfa.flow.real.test.ts:464:52
    462|       });
    463| 
    464|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    465| 
    466|       const mfaLoginResponse = await request(app)

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[89/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should disable MFA with password verification
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/mfa.flow.real.test.ts:510:38
    508|         .send({ password });
    509| 
    510|       expect(disableResponse.status).toBe(200);
       |                                      ^
    511| 
    512|       // Verify MFA is disabled

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[90/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should require correct password to disable MFA
AssertionError: expected 400 to be 401 // Object.is equality

- Expected
+ Received

- 401
+ 400

 Γ¥» tests/integration/mfa.flow.real.test.ts:556:38
    554|         .send({ password: "WrongPassword123" });
    555| 
    556|       expect(disableResponse.status).toBe(401);
       |                                      ^
    557|       expect(disableResponse.body.message).toContain("Invalid passwordΓÇª
    558| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[91/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should regenerate backup codes
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/mfa.flow.real.test.ts:588:41
    586|         .set("Authorization", `Bearer ${token}`);
    587| 
    588|       expect(regenerateResponse.status).toBe(200);
       |                                         ^
    589|       expect(regenerateResponse.body.backupCodes).toHaveLength(10);
    590| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[92/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should return error if MFA not enabled
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Γ¥» tests/integration/mfa.flow.real.test.ts:612:31
    610|         .set("Authorization", `Bearer ${loginResponse.body.token}`);
    611| 
    612|       expect(response.status).toBe(400);
       |                               ^
    613|       expect(response.body.message).toContain("not enabled");
    614|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[93/326]ΓÄ»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Tenant-Level MFA Enforcement > should enforce MFA for tenant users when required by tenant
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/mfa.flow.real.test.ts:638:36
    636|         .send({ email, password });
    637| 
    638|       expect(loginResponse.status).toBe(200);
       |                                    ^
    639|       expect(loginResponse.body.requiresMfa).toBe(true);
    640|       expect(loginResponse.body.userId).toBe(userId);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[94/326]ΓÄ»

 FAIL  tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #7: Delete organization > should prevent deletion if org owns assets
AssertionError: promise resolved "undefined" instead of rejecting

- Expected: 
Error {
  "message": "rejected promise",
}

+ Received: 
undefined

 Γ¥» tests/integration/organizations-audit-fixes.test.ts:246:7
    244|       await expect(
    245|         organizationService.deleteOrganization(org.id, user1Id)
    246|       ).rejects.toThrow(/owns workflows/i);
       |       ^
    247| 
    248|       // Cleanup

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[95/326]ΓÄ»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 1. Required + Show/Hide (Questions) > should NOT block Next when required question is hidden
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Γ¥» tests/integration/regression-REG-1.test.ts:197:31
    195|             // Check visibility
    196|             const isVisible = evaluateVisibilityExpression("show_triggΓÇª
    197|             expect(isVisible).toBe(false);
       |                               ^
    198| 
    199|             // Required question is hidden, should not block

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[96/326]ΓÄ»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 2. Required + Show/Hide (Pages) > should skip hidden required page entirely
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Γ¥» tests/integration/regression-REG-1.test.ts:330:31
    328|             const isVisible = evaluateVisibilityExpression((section2.vΓÇª
    329| 
    330|             expect(isVisible).toBe(false); // Section 2 should be hiddΓÇª
       |                               ^
    331| 
    332|             // Get all sections

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[97/326]ΓÄ»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 3. Preview/Snapshot/Live Parity > should evaluate visibility consistently across modes
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Γ¥» tests/integration/regression-REG-1.test.ts:445:64
    443|             // Change data
    444|             const data2 = { trigger: false, value: 10 };
    445|             expect(evaluateVisibilityExpression(expr1, data2)).toBe(faΓÇª
       |                                                                ^
    446|             expect(evaluateVisibilityExpression(expr2, data2)).toBe(trΓÇª
    447|             expect(evaluateVisibilityExpression(expr3, data2)).toBe(faΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[98/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should list all active sessions for current user
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/session.management.real.test.ts:53:31
     51|         .set("Authorization", `Bearer ${token}`);
     52| 
     53|       expect(response.status).toBe(200);
       |                               ^
     54|       expect(response.body.sessions).toBeDefined();
     55|       expect(response.body.sessions.length).toBe(3);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[99/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should mark current session correctly
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/session.management.real.test.ts:85:30
     83|       const token = login2.body.token;
     84|       const cookies = (login2.headers as any)["set-cookie"] as string[ΓÇª
     85|       const cookie = cookies.find((c) => c.startsWith("refresh_token="ΓÇª
       |                              ^
     86| 
     87|       // List sessions with cookie (should identify current session)

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[100/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should exclude revoked sessions
TypeError: Cannot read properties of undefined (reading 'length')
 Γ¥» tests/integration/session.management.real.test.ts:128:37
    126| 
    127|       // Should only show 1 session (non-revoked)
    128|       expect(response.body.sessions.length).toBe(1);
       |                                     ^
    129|     });
    130| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[101/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should order sessions by last used (most recent first)
TypeError: Cannot read properties of undefined (reading 'length')
 Γ¥» tests/integration/session.management.real.test.ts:154:36
    152| 
    153|       // Should be ordered by lastUsedAt descending
    154|       for (let i = 1; i < sessions.length; i++) {
       |                                    ^
    155|         const prev = new Date(sessions[i - 1].lastUsedAt);
    156|         const curr = new Date(sessions[i].lastUsedAt);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[102/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should filter sessions by current user only
TypeError: Cannot read properties of undefined (reading 'length')
 Γ¥» tests/integration/session.management.real.test.ts:184:37
    182|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    183| 
    184|       expect(response.body.sessions.length).toBe(2);
       |                                     ^
    185|     });
    186| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[103/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/session.management.real.test.ts:215:40
    213| 
    214|       const sessions = sessionsResponse.body.sessions;
    215|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    216| 
    217|       // Revoke non-current session

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[104/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/session.management.real.test.ts:249:30
    247|       const token = login.body.token;
    248|       const cookies = (login.headers as any)["set-cookie"] as string[];
    249|       const cookie = cookies.find((c) => c.startsWith("refresh_token="ΓÇª
       |                              ^
    250| 
    251|       // Get sessions

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[105/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking other user's session
TypeError: Cannot read properties of undefined (reading '0')
 Γ¥» tests/integration/session.management.real.test.ts:303:49
    301|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    302| 
    303|       const user1SessionId = user1Sessions.body.sessions[0].id;
       |                                                 ^
    304| 
    305|       // Try to revoke user 1's session as user 2

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[106/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all other sessions
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/session.management.real.test.ts:329:30
    327|       const token = currentLogin.body.token;
    328|       const cookies = (currentLogin.headers as any)["set-cookie"] as sΓÇª
    329|       const cookie = cookies.find((c) => c.startsWith("refresh_token="ΓÇª
       |                              ^
    330| 
    331|       // Revoke all except current

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[107/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should return 400 if no active session found
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Γ¥» tests/integration/session.management.real.test.ts:397:31
    395|         .set("Authorization", `Bearer ${token}`);
    396| 
    397|       expect(response.status).toBe(400);
       |                               ^
    398|       expect(response.body.message).toContain("No active session");
    399|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[108/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all trusted devices
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/session.management.real.test.ts:410:30
    408|       const token = login.body.token;
    409|       const cookies = (login.headers as any)["set-cookie"] as string[];
    410|       const cookie = cookies.find((c) => c.startsWith("refresh_token="ΓÇª
       |                              ^
    411| 
    412|       // Trust a device

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[109/326]ΓÄ»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should handle user with single session gracefully
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Γ¥» tests/integration/session.management.real.test.ts:456:53
    454|         .set("Authorization", `Bearer ${token}`);
    455| 
    456|       expect(sessionsResponse.body.sessions.length).toBe(1);
       |                                                     ^
    457|     });
    458|   });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[110/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should trust current device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/trusted.devices.real.test.ts:52:36
     50|         .set("X-Forwarded-For", "192.168.1.100");
     51| 
     52|       expect(trustResponse.status).toBe(200);
       |                                    ^
     53|       expect(trustResponse.body.message).toContain("trusted");
     54|       expect(trustResponse.body.trustedUntil).toBeDefined();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[111/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should set trust expiry to 30 days
AssertionError: expected NaN to be 30 // Object.is equality

- Expected
+ Received

- 30
+ NaN

 Γ¥» tests/integration/trusted.devices.real.test.ts:92:24
     90|       );
     91| 
     92|       expect(diffDays).toBe(30);
       |                        ^
     93|     });
     94| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[112/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should update expiry if device already trusted
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/integration/trusted.devices.real.test.ts:132:42
    130| 
    131|       // Should have extended expiry
    132|       expect(secondExpiry > firstExpiry).toBe(true);
       |                                          ^
    133| 
    134|       // Should still only have 1 device record

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[113/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should list all trusted devices
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/trusted.devices.real.test.ts:193:31
    191|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    192| 
    193|       expect(response.status).toBe(200);
       |                               ^
    194|       expect(response.body.devices).toBeDefined();
    195|       expect(response.body.devices.length).toBe(2);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[114/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should mark current device
TypeError: Cannot read properties of undefined (reading 'find')
 Γ¥» tests/integration/trusted.devices.real.test.ts:236:51
    234|         .set("X-Forwarded-For", "192.168.1.100");
    235| 
    236|       const currentDevice = response.body.devices.find((d: any) => d.cΓÇª
       |                                                   ^
    237|       expect(currentDevice).toBeDefined();
    238|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[115/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude revoked devices
TypeError: Cannot read properties of undefined (reading 'length')
 Γ¥» tests/integration/trusted.devices.real.test.ts:269:36
    267|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    268| 
    269|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    270|     });
    271| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[116/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude expired devices
TypeError: Cannot read properties of undefined (reading 'length')
 Γ¥» tests/integration/trusted.devices.real.test.ts:302:36
    300|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    301| 
    302|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    303|     });
    304|   });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[117/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should revoke specific device
TypeError: Cannot read properties of undefined (reading '0')
 Γ¥» tests/integration/trusted.devices.real.test.ts:332:45
    330|         .set("Authorization", `Bearer ${token}`);
    331| 
    332|       const deviceId = devicesResponse.body.devices[0].id;
       |                                             ^
    333| 
    334|       // Revoke device

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[118/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should return 404 for non-existent device
AssertionError: expected 401 to be 404 // Object.is equality

- Expected
+ Received

- 404
+ 401

 Γ¥» tests/integration/trusted.devices.real.test.ts:371:31
    369|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    370| 
    371|       expect(response.status).toBe(404);
       |                               ^
    372|     });
    373| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[119/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should prevent revoking other user's device
TypeError: Cannot read properties of undefined (reading '0')
 Γ¥» tests/integration/trusted.devices.real.test.ts:399:43
    397|         .set("Authorization", `Bearer ${mfaLogin1.body.token}`);
    398| 
    399|       const user1DeviceId = devices1.body.devices[0].id;
       |                                           ^
    400| 
    401|       // User 2 tries to revoke user 1's device

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[120/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should skip MFA for trusted device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/trusted.devices.real.test.ts:453:42
    451| 
    452|       // Should not require MFA
    453|       expect(secondLoginResponse.status).toBe(200);
       |                                          ^
    454|       expect(secondLoginResponse.body.requiresMfa).toBeUndefined();
    455|       expect(secondLoginResponse.body.token).toBeDefined();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[121/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should require MFA for untrusted device
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Γ¥» tests/integration/trusted.devices.real.test.ts:485:51
    483| 
    484|       // Should require MFA
    485|       expect(loginFromNewDevice.body.requiresMfa).toBe(true);
       |                                                   ^
    486|     });
    487| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[122/326]ΓÄ»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should update lastUsedAt on trusted device login
TypeError: Cannot read properties of undefined (reading 'lastUsedAt')
 Γ¥» tests/integration/trusted.devices.real.test.ts:512:38
    510|       });
    511| 
    512|       const firstLastUsed = device1!.lastUsedAt;
       |                                      ^
    513| 
    514|       // Wait a bit

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[123/326]ΓÄ»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should create a version and populate changelog
Error: Validation failed: Schema Error: id - Required, Schema Error: title - Required, Schema Error: pages.0.title - Required, Schema Error: pages.0.order - Required
 Γ¥» VersionService.publishVersion server/services/VersionService.ts:287:13
    285| 
    286|     if (!validation.valid && !force) {
    287|       throw new Error(`Validation failed: ${validation.errors.join(', ΓÇª
       |             ^
    288|     }
    289| 
 Γ¥» tests/integration/workflow_versioning.test.ts:97:20

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[124/326]ΓÄ»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should track execution lineage via snapshot
TypeError: Cannot read properties of undefined (reading 'id')
 Γ¥» tests/integration/workflow_versioning.test.ts:117:143
    115| 
    116|         // Create Snapshot
    117|         const snapshot = await snapshotService.createSnapshot(workflowΓÇª
       |                                                                                                                                               ^
    118| 
    119|         expect(snapshot.workflowVersionId).toBeDefined();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[125/326]ΓÄ»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Γ¥» tests/ui/expression-editor.test.tsx:68:43
     66| 
     67|       // Should be validating immediately
     68|       expect(result.current.isValidating).toBe(true);
       |                                           ^
     69| 
     70|       // Wait for debounce and validation

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[126/326]ΓÄ»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Γ¥» tests/ui/expression-editor.test.tsx:114:38
    112|       );
    113| 
    114|       expect(result.current.isValid).toBe(false);
       |                                      ^
    115|       expect(result.current.errors.length).toBeGreaterThan(0);
    116|       expect(result.current.errors[0].message).toContain('unknown_var'ΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[127/326]ΓÄ»

 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
ReferenceError: React is not defined
 Γ¥» RunsTable client/src/components/runs/RunsTable.tsx:41:3
     39|   };
     40| 
     41|   return (
       |   ^
     42|     <div className="rounded-md border">
     43|       <Table>
 Γ¥» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Γ¥» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Γ¥» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Γ¥» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Γ¥» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Γ¥» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Γ¥» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Γ¥» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Γ¥» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[128/326]ΓÄ»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should generate a valid workflow from description
Error: AI response does not match expected schema

≡ƒöº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Γ¥» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublΓÇª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Γ¥» AIService.generateWorkflow server/services/AIService.ts:127:20
 Γ¥» tests/unit/ai.service.test.ts:86:22

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[129/326]ΓÄ»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate unique section IDs
AssertionError: expected [Function] to throw error including 'Duplicate section IDs' but got 'AI response does not match expected sΓÇª'

- Expected
+ Received

- Duplicate section IDs
+ AI response does not match expected schema
+
+ ≡ƒöº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Γ¥» tests/unit/ai.service.test.ts:136:7
    134|       } as any;
    135| 
    136|       await expect(
       |       ^
    137|         openaiService.generateWorkflow({
    138|           description: 'Test',

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[130/326]ΓÄ»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate unique step IDs
AssertionError: expected [Function] to throw error including 'Duplicate step ID' but got 'AI response does not match expected sΓÇª'

- Expected
+ Received

- Duplicate step ID
+ AI response does not match expected schema
+
+ ≡ƒöº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Γ¥» tests/unit/ai.service.test.ts:190:7
    188|       } as any;
    189| 
    190|       await expect(
       |       ^
    191|         openaiService.generateWorkflow({
    192|           description: 'Test',

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[131/326]ΓÄ»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate logic rules reference existing steps
AssertionError: expected [Function] to throw error including 'references non-existent step alias' but got 'AI response does not match expected sΓÇª'

- Expected
+ Received

- references non-existent step alias
+ AI response does not match expected schema
+
+ ≡ƒöº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Γ¥» tests/unit/ai.service.test.ts:248:7
    246|       } as any;
    247| 
    248|       await expect(
       |       ^
    249|         openaiService.generateWorkflow({
    250|           description: 'Test',

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[132/326]ΓÄ»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should handle rate limit errors
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Γ¥» tests/unit/ai.service.test.ts:256:5
    254|     });
    255| 
    256|     it('should handle rate limit errors', async () => {
       |     ^
    257|       const rateLimitError = new Error('Rate limit exceeded');
    258|       // @ts-ignore

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[133/326]ΓÄ»

 FAIL  tests/unit/ai.service.test.ts > AIService > Anthropic Provider > should generate a valid workflow from description
Error: AI response does not match expected schema

≡ƒöº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Γ¥» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublΓÇª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Γ¥» AIService.generateWorkflow server/services/AIService.ts:127:20
 Γ¥» tests/unit/ai.service.test.ts:369:22

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[134/326]ΓÄ»

 FAIL  tests/unit/ai.service.test.ts > AIService > Anthropic Provider > should strip markdown code blocks from Anthropic responses
Error: AI response does not match expected schema

≡ƒöº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Γ¥» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublΓÇª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Γ¥» AIService.generateWorkflow server/services/AIService.ts:127:20
 Γ¥» tests/unit/ai.service.test.ts:409:22

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[135/326]ΓÄ»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/generate-logic > should return generated logic
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Γ¥» tests/unit/api.ai.logic.test.ts:89:32
     87|                 if (!res.body || Object.keys(res.body).length === 0) cΓÇª
     88|             }
     89|             expect(res.status).toBe(200);
       |                                ^
     90|             expect(res.body.success).toBe(true);
     91|             expect(mockGenerateLogic).toHaveBeenCalled();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[136/326]ΓÄ»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/debug-logic > should return debug issues
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Γ¥» tests/unit/api.ai.logic.test.ts:110:32
    108|                 });
    109| 
    110|             expect(res.status).toBe(200);
       |                                ^
    111|             expect(res.body.success).toBe(true);
    112|             expect(res.body.issues).toHaveLength(1);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[137/326]ΓÄ»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/visualize-logic > should return graph data
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Γ¥» tests/unit/api.ai.logic.test.ts:129:32
    127|                 });
    128| 
    129|             expect(res.status).toBe(200);
       |                                ^
    130|             expect(res.body.graph.nodes).toHaveLength(1);
    131|         });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[138/326]ΓÄ»

 FAIL  tests/unit/api.ai.revise.test.ts > AI Routes Integration > POST /api/ai/workflows/revise > should call AIService.reviseWorkflow with correct parameters
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Γ¥» tests/unit/api.ai.revise.test.ts:89:32
     87|                 if (!res.body || Object.keys(res.body).length === 0) cΓÇª
     88|             }
     89|             expect(res.status).toBe(200);
       |                                ^
     90|             expect(mockReviseWorkflow).toHaveBeenCalledTimes(1);
     91| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[139/326]ΓÄ»

 FAIL  tests/unit/isolatedVmBridge.test.ts > isolated-vm Bridge Verification > should execute JS and capture console logs
AssertionError: expected undefined to be defined
 Γ¥» tests/unit/isolatedVmBridge.test.ts:86:36
     84| 
     85|         expect(result.ok).toBe(true);
     86|         expect(result.consoleLogs).toBeDefined();
       |                                    ^
     87|         // @ts-ignore
     88|         expect(result.consoleLogs[0]).toEqual(["hello log"]);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[140/326]ΓÄ»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 when no token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 with expired token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should extract token without Bearer prefix
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalAuth Middleware > should proceed without authentication if no token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalAuth Middleware > should attach user context if valid token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalAuth Middleware > should proceed without auth if invalid token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with refresh token cookie (GET only)
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for POST requests (mutation-strict)
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for PUT requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for DELETE requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should prioritize JWT over cookie when both present
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should return 401 when no auth provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should return 401 when both JWT and cookie are invalid
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should authenticate with JWT if provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should authenticate with cookie if JWT not provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Cookie Strategy Security > should only allow safe methods for cookie auth
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Cookie Strategy Security > should reject expired refresh token from cookie
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach userEmail to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach tenantId to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach userRole to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for missing token
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts:70:14
     68|                 password: testUser.password,
     69|             })
     70|             .expect(200);
       |              ^
     71| 
     72|         userToken = loginRes.body.token;
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[141/326]ΓÄ»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 with invalid token
AssertionError: expected { code: 'AUTH_008', ΓÇª(3) } to be 'invalid_token' // Object.is equality

- Expected: 
"invalid_token"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T19:29:00.192Z",
}

 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts:100:36
     98|                 .expect(401);
     99| 
    100|             expect(res.body.error).toBe("invalid_token");
       |                                    ^
    101|         });
    102| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[142/326]ΓÄ»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should allow cookie auth for HEAD requests
AssertionError: expected [ 200, 404 ] to include 401
 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts:241:32
    239|                 .set("Cookie", refreshCookie);
    240| 
    241|             expect([200, 404]).toContain(res.status);
       |                                ^
    242|         });
    243| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[143/326]ΓÄ»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should proceed anonymously if no auth provided
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts:343:18
    341|             await request(ctx.baseURL)
    342|                 .get(`/api/workflows/${workflowRes.body.id}/public`)
    343|                 .expect(200);
       |                  ^
    344|         });
    345| 
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[144/326]ΓÄ»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should proceed anonymously if both JWT and cookie are invalid
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts:360:18
    358|                 .set("Authorization", "Bearer invalid-token")
    359|                 .set("Cookie", ["refresh_token=invalid-cookie"])
    360|                 .expect(200);
       |                  ^
    361|         });
    362|     });
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[145/326]ΓÄ»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for invalid token
AssertionError: expected { success: false, error: { ΓÇª(4) } } to have property "message"
 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts:535:30
    533|                 .expect(401);
    534| 
    535|             expect(res.body).toHaveProperty("message");
       |                              ^
    536|             expect(res.body).toHaveProperty("error");
    537|             expect(res.body.error).toBe("invalid_token");

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[146/326]ΓÄ»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for expired token
AssertionError: expected { success: false, error: { ΓÇª(4) } } to have property "message"
 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts:560:30
    558|                 .expect(401);
    559| 
    560|             expect(res.body).toHaveProperty("message");
       |                              ^
    561|             expect(res.body).toHaveProperty("error");
    562|             expect(res.body.error).toBe("token_expired");

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[147/326]ΓÄ»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should handle JWT with wrong algorithm
AssertionError: expected { code: 'AUTH_008', ΓÇª(3) } to be 'invalid_token' // Object.is equality

- Expected: 
"invalid_token"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T19:29:35.405Z",
}

 Γ¥» tests/integration/auth/auth.middleware.integration.test.ts:592:36
    590|                 .expect(401);
    591| 
    592|             expect(res.body.error).toBe("invalid_token");
       |                                    ^
    593|         });
    594|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[148/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should generate valid JWT token on successful login
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:54:18
     52|                 .post("/api/auth/register")
     53|                 .send(testUser)
     54|                 .expect(201);
       |                  ^
     55| 
     56|             // Verify email
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[149/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should include correct payload in JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:90:18
     88|                 .post("/api/auth/register")
     89|                 .send(testUser)
     90|                 .expect(201);
       |                  ^
     91| 
     92|             await db.update(db.query.users as any)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[150/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should set JWT expiry to 15 minutes
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:122:18
    120|                 .post("/api/auth/register")
    121|                 .send(testUser)
    122|                 .expect(201);
       |                  ^
    123| 
    124|             await db.update(db.query.users as any)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[151/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should accept valid JWT token on protected routes
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:153:18
    151|                     password: testUser.password,
    152|                 })
    153|                 .expect(200);
       |                  ^
    154| 
    155|             const meRes = await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[152/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should reject request with missing Bearer prefix
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:183:18
    181|                     password: testUser.password,
    182|                 })
    183|                 .expect(200);
       |                  ^
    184| 
    185|             await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[153/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Expiration > should return token_expired error code for expired tokens
AssertionError: expected { code: 'AUTH_008', ΓÇª(3) } to be 'token_expired' // Object.is equality

- Expected: 
"token_expired"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T19:29:12.603Z",
}

 Γ¥» tests/integration/auth/jwt.authentication.test.ts:237:36
    235|                 .expect(401);
    236| 
    237|             expect(res.body.error).toBe("token_expired");
       |                                    ^
    238|         });
    239|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[154/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on PUT requests
Error: expected 200 "OK", got 404 "Not Found"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:268:18
    266|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    267|                 .send({ firstName: "Updated" })
    268|                 .expect(200);
       |                  ^
    269| 
    270|             expect(updateRes.body).toBeDefined();
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[155/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on DELETE requests
Error: expected 200 "OK", got 204 "No Content"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:285:18
    283|                 .delete(`/api/projects/${projectRes.body.id}`)
    284|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    285|                 .expect(200);
       |                  ^
    286|         });
    287|     });
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:847:12
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[156/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Cookie-to-Token Exchange > should exchange valid session cookie for JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:295:18
    293|                 .post("/api/auth/register")
    294|                 .send(testUser)
    295|                 .expect(201);
       |                  ^
    296| 
    297|             const cookies = registerRes.headers['set-cookie'];
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[157/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should prefer Bearer token over cookie when both present
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:330:18
    328|                     email: `user1-${nanoid()}@example.com`,
    329|                 })
    330|                 .expect(201);
       |                  ^
    331| 
    332|             const user2Res = await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[158/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should fall back to cookie if Bearer token is invalid
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:358:18
    356|                 .post("/api/auth/register")
    357|                 .send(testUser)
    358|                 .expect(201);
       |                  ^
    359| 
    360|             const cookies = registerRes.headers['set-cookie'];
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[159/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should allow GET requests with cookie auth only
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:377:18
    375|                 .post("/api/auth/register")
    376|                 .send(testUser)
    377|                 .expect(201);
       |                  ^
    378| 
    379|             await db.update(db.query.users as any)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[160/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should reject POST requests with cookie auth only (mutation-strict)
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:406:18
    404|                 .post("/api/auth/register")
    405|                 .send(testUser)
    406|                 .expect(201);
       |                  ^
    407| 
    408|             const cookies = registerRes.headers['set-cookie'];
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[161/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should allow anonymous access to public workflows
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:432:18
    430|                     publicLink: `public-${nanoid()}`,
    431|                 })
    432|                 .expect(201);
       |                  ^
    433| 
    434|             // Access without authentication
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[162/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should attach user info if authenticated on optional auth routes
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:451:18
    449|                     publicLink: `optional-${nanoid()}`,
    450|                 })
    451|                 .expect(201);
       |                  ^
    452| 
    453|             // Access with authentication
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[163/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should refresh access token using refresh token
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:469:18
    467|                 .post("/api/auth/register")
    468|                 .send(testUser)
    469|                 .expect(201);
       |                  ^
    470| 
    471|             await db.update(db.query.users as any)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[164/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should rotate refresh token on use
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:503:18
    501|                 .post("/api/auth/register")
    502|                 .send(testUser)
    503|                 .expect(201);
       |                  ^
    504| 
    505|             await db.update(db.query.users as any)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[165/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should detect token reuse and revoke all user tokens
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:544:18
    542|                 .post("/api/auth/register")
    543|                 .send(testUser)
    544|                 .expect(201);
       |                  ^
    545| 
    546|             await db.update(db.query.users as any)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[166/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should revoke refresh token on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:595:18
    593|                 .post("/api/auth/register")
    594|                 .send(testUser)
    595|                 .expect(201);
       |                  ^
    596| 
    597|             await db.update(db.query.users as any)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[167/326]ΓÄ»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should clear refresh token cookie on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Γ¥» tests/integration/auth/jwt.authentication.test.ts:628:18
    626|                 .post("/api/auth/register")
    627|                 .send(testUser)
    628|                 .expect(201);
       |                  ^
    629| 
    630|             await db.update(db.query.users as any)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[168/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should revoke a specific session
AssertionError: expected undefined to be defined
 Γ¥» tests/integration/auth/oauth2.sessions.test.ts:210:29
    208|       });
    209| 
    210|       expect(sessionRecord).toBeDefined();
       |                             ^
    211| 
    212|       const response = await request(app)

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[169/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should prevent revoking current session
TypeError: Cannot read properties of undefined (reading 'id')
 Γ¥» tests/integration/auth/oauth2.sessions.test.ts:243:54
    241| 
    242|       const response = await request(app)
    243|         .delete(`/api/auth/sessions/${sessionRecord!.id}`)
       |                                                      ^
    244|         .set('Authorization', `Bearer ${authToken}`)
    245|         .set('Cookie', `refresh_token=${token}`);

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[170/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should prevent revoking another user's session
TypeError: Cannot read properties of undefined (reading 'id')
 Γ¥» tests/integration/auth/oauth2.sessions.test.ts:275:53
    273|       // Try to revoke other user's session
    274|       const response = await request(app)
    275|         .delete(`/api/auth/sessions/${otherSession!.id}`)
       |                                                     ^
    276|         .set('Authorization', `Bearer ${authToken}`);
    277| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[171/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/all - Logout All Other Devices > should revoke all sessions except current
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Γ¥» tests/integration/auth/oauth2.sessions.test.ts:316:37
    314|         ));
    315| 
    316|       expect(activeSessions.length).toBe(1);
       |                                     ^
    317|       expect(activeSessions[0].token).toBe(currentToken);
    318|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[172/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should track IP address for sessions
AssertionError: expected undefined to be '192.168.1.100' // Object.is equality

- Expected: 
"192.168.1.100"

+ Received: 
undefined

 Γ¥» tests/integration/auth/oauth2.sessions.test.ts:535:34
    533|       });
    534| 
    535|       expect(session?.ipAddress).toBe('192.168.1.100');
       |                                  ^
    536|     });
    537| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[173/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should track user agent for sessions
AssertionError: expected undefined to be 'Mozilla/5.0 (Windows NT 10.0; Win64; ΓÇª' // Object.is equality

- Expected: 
"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"

+ Received: 
undefined

 Γ¥» tests/integration/auth/oauth2.sessions.test.ts:549:35
    547| 
    548|       const metadata = session?.metadata as any;
    549|       expect(metadata?.userAgent).toBe(userAgent);
       |                                   ^
    550|     });
    551| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[174/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should update lastUsedAt on token refresh
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Γ¥» tests/integration/auth/oauth2.sessions.test.ts:574:31
    572|         ));
    573| 
    574|       expect(sessions.length).toBe(1);
       |                               ^
    575|       expect(sessions[0].lastUsedAt).toBeDefined();
    576|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[175/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should refresh access token with valid refresh token
AssertionError: expected { ΓÇª(2) } to match object { token: Any<String>, user: { ΓÇª(3) } }
(1 matching property omitted from actual)

- Expected
+ Received

  {
    "token": Any<String>,
    "user": {
      "email": "refresh-test-2ZqPWQELsnUFx7MeyCw-Y@example.com",
      "id": "RXJGAWvLz0y9NQBiUYbRp",
-     "role": "owner",
+     "role": "creator",
    },
  }

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:88:29
     86| 
     87|       expect(response.status).toBe(200);
     88|       expect(response.body).toMatchObject({
       |                             ^
     89|         token: expect.any(String),
     90|         user: {

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[176/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should rotate refresh token after use
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:111:31
    109|         .set('Cookie', `refresh_token=${testRefreshToken}`);
    110| 
    111|       expect(response.status).toBe(200);
       |                               ^
    112| 
    113|       // Extract new refresh token from cookie

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[177/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should return 401 for revoked refresh token
AssertionError: expected 200 to be 401 // Object.is equality

- Expected
+ Received

- 401
+ 200

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:193:31
    191|         .set('Cookie', `refresh_token=${testRefreshToken}`);
    192| 
    193|       expect(response.status).toBe(401);
       |                               ^
    194|       expect(response.body.message).toBe('Invalid refresh token');
    195|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[178/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should return 401 when user is not found
AssertionError: expected 'Invalid refresh token' to be 'User not found' // Object.is equality

Expected: "User not found"
Received: "Invalid refresh token"

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:206:37
    204| 
    205|       expect(response.status).toBe(401);
    206|       expect(response.body.message).toBe('User not found');
       |                                     ^
    207|     });
    208| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[179/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should update refresh token metadata on rotation
AssertionError: expected undefined to be defined
 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:226:24
    224|       });
    225| 
    226|       expect(newToken).toBeDefined();
       |                        ^
    227|       expect(newToken?.lastUsedAt).toBeDefined();
    228|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[180/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should include user role information in response
AssertionError: expected { id: 'SDjPqFWR-D4ljDiL2IS--', ΓÇª(3) } to match object { id: 'SDjPqFWR-D4ljDiL2IS--', ΓÇª(2) }
(1 matching property omitted from actual)

- Expected
+ Received

  {
    "email": "refresh-test-aKVJvBOtug-3uzeBleTyU@example.com",
    "id": "SDjPqFWR-D4ljDiL2IS--",
-   "role": "owner",
+   "role": "creator",
  }

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:290:34
    288| 
    289|       expect(response.status).toBe(200);
    290|       expect(response.body.user).toMatchObject({
       |                                  ^
    291|         id: testUserId,
    292|         email: testUserEmail,

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[181/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should create refresh token on login
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:307:31
    305|         });
    306| 
    307|       expect(response.status).toBe(200);
       |                               ^
    308| 
    309|       // Verify refresh token cookie is set

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[182/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should revoke refresh token on logout
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:333:30
    331|         where: eq(refreshTokens.token, testRefreshToken),
    332|       });
    333|       expect(token?.revoked).toBe(true);
       |                              ^
    334| 
    335|       // Verify cookie is cleared

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[183/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should support multiple active refresh tokens per user
AssertionError: expected 0 to be greater than or equal to 3
 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:368:35
    366|         ));
    367| 
    368|       expect(activeTokens.length).toBeGreaterThanOrEqual(3);
       |                                   ^
    369|     });
    370| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[184/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Security > should validate token ownership
AssertionError: expected undefined to be 'Ex1Jswvor9b42uOlbtBsp' // Object.is equality

- Expected: 
"Ex1Jswvor9b42uOlbtBsp"

+ Received: 
undefined

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:465:29
    463|       });
    464| 
    465|       expect(token?.userId).toBe(testUserId);
       |                             ^
    466|       expect(token?.userId).not.toBe(otherUser.id);
    467|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[185/326]ΓÄ»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Cookie Security > should set appropriate expiry (30 days)
AssertionError: expected 'refresh_token=; Max-Age=0; Path=/' to contain 'Max-Age=2592000'

Expected: "Max-Age=2592000"
Received: "refresh_token=; Max-Age=0; Path=/"

 Γ¥» tests/integration/auth/oauth2.token-refresh.test.ts:505:31
    503|       const setCookieHeader = response.headers['set-cookie']?.[0];
    504|       // 30 days = 2592000 seconds
    505|       expect(setCookieHeader).toContain('Max-Age=2592000');
       |                               ^
    506|     });
    507|   });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[186/326]ΓÄ»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should allow access with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access without Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with empty Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with malformed Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with wrong token type
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should allow POST with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST with invalid token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should allow PUT with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should reject PUT without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > DELETE Protected Routes > should allow DELETE with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > DELETE Protected Routes > should reject DELETE without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PATCH Protected Routes > should allow PATCH with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle Bearer token with extra spaces
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle token with newlines
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle empty Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle Authorization header with only Bearer
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should reject token with SQL injection attempt
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should reject token with XSS attempt
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Payload Validation > should reject token with missing userId
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > User Context Injection > should inject userId into request context
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > User Context Injection > should inject tenantId into request context
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Rate Limiting on Protected Routes > should not apply general rate limiting to authenticated requests
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Optional Auth Routes > should allow unauthenticated access to optional auth routes
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/protected.routes.test.ts:66:14
     64|                 password: testUser.password,
     65|             })
     66|             .expect(200);
       |              ^
     67| 
     68|         userToken = loginRes.body.token;
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[187/326]ΓÄ»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Cross-User Authorization > should not allow user to access another user's resources
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/protected.routes.test.ts:323:18
    321|                     password: user2.password,
    322|                 })
    323|                 .expect(200);
       |                  ^
    324| 
    325|             const user2Token = user2LoginRes.body.token;
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[188/326]ΓÄ»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Mixed Auth Scenarios > should handle request with both Bearer token and cookies
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/protected.routes.test.ts:400:18
    398|                     password: testUser.password,
    399|                 })
    400|                 .expect(200);
       |                  ^
    401| 
    402|             const cookies = loginRes.headers['set-cookie'];
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[189/326]ΓÄ»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Optional Auth Routes > should enhance optional auth routes with user context when authenticated
Error: expected 200 "OK", got 404 "Not Found"
 Γ¥» tests/integration/auth/protected.routes.test.ts:492:18
    490|                 .get(`/api/workflows/${workflowRes.body.id}/public`)
    491|                 .set("Authorization", `Bearer ${userToken}`)
    492|                 .expect(200);
       |                  ^
    493|         });
    494|     });
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[190/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create refresh token on login
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:74:18
     72|                     password: testUser.password,
     73|                 })
     74|                 .expect(200);
       |                  ^
     75| 
     76|             expect(loginRes.headers['set-cookie']).toBeDefined();
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[191/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create separate sessions for multiple device logins
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:120:18
    118|                     password: testUser.password,
    119|                 })
    120|                 .expect(200);
       |                  ^
    121| 
    122|             // Login from device 2
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[192/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should list all active sessions for user
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:163:18
    161|                     password: testUser.password,
    162|                 })
    163|                 .expect(200);
       |                  ^
    164| 
    165|             await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[193/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should mark current session correctly
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:208:18
    206|                     password: testUser.password,
    207|                 })
    208|                 .expect(200);
       |                  ^
    209| 
    210|             await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[194/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should not include revoked sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:237:18
    235|                     password: testUser.password,
    236|                 })
    237|                 .expect(200);
       |                  ^
    238| 
    239|             const session2 = await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[195/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should order sessions by last used (most recent first)
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:282:18
    280|                     password: testUser.password,
    281|                 })
    282|                 .expect(200);
       |                  ^
    283| 
    284|             await new Promise(resolve => setTimeout(resolve, 100));
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[196/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should revoke specific session
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:332:18
    330|                     password: testUser.password,
    331|                 })
    332|                 .expect(200);
       |                  ^
    333| 
    334|             const session2 = await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[197/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:373:18
    371|                     password: testUser.password,
    372|                 })
    373|                 .expect(200);
       |                  ^
    374| 
    375|             const sessionsRes = await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[198/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should not allow revoking other users sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:417:18
    415|                     password: user2.password,
    416|                 })
    417|                 .expect(200);
       |                  ^
    418| 
    419|             // User1 tries to get user2's sessions
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[199/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should return 404 for non-existent session ID
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:452:18
    450|                     password: testUser.password,
    451|                 })
    452|                 .expect(200);
       |                  ^
    453| 
    454|             await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[200/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/all > should revoke all sessions except current
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:480:18
    478|                     password: testUser.password,
    479|                 })
    480|                 .expect(200);
       |                  ^
    481| 
    482|             const session3 = await request(ctx.baseURL)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[201/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/all > should revoke all trusted devices
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:523:18
    521|                     password: testUser.password,
    522|                 })
    523|                 .expect(200);
       |                  ^
    524| 
    525|             // Trust device
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[202/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Expiration > should reject refresh token after 30 days
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:564:18
    562|                     password: testUser.password,
    563|                 })
    564|                 .expect(200);
       |                  ^
    565| 
    566|             // Get the refresh token from database (non-revoked only)
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[203/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Concurrent Session Handling > should handle multiple concurrent logins
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Γ¥» tests/integration/auth/session.management.integration.test.ts:610:36
    608| 
    609|             logins.forEach(res => {
    610|                 expect(res.status).toBe(200);
       |                                    ^
    611|                 expect(res.body.token).toBeDefined();
    612|             });
 Γ¥» tests/integration/auth/session.management.integration.test.ts:609:20

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[204/326]ΓÄ»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Concurrent Session Handling > should handle concurrent token refreshes
Error: expected 200 "OK", got 401 "Unauthorized"
 Γ¥» tests/integration/auth/session.management.integration.test.ts:631:18
    629|                     password: testUser.password,
    630|                 })
    631|                 .expect(200);
       |                  ^
    632| 
    633|             const cookies = session.headers['set-cookie'];
 Γ¥» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Γ¥» node_modules/supertest/lib/test.js:365:13
 Γ¥» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Γ¥» Test.assert node_modules/supertest/lib/test.js:195:23
 Γ¥» localAssert node_modules/supertest/lib/test.js:138:14
 Γ¥» node_modules/supertest/lib/test.js:156:7
 Γ¥» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Γ¥» node_modules/superagent/lib/node/index.js:1102:18
 Γ¥» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[205/326]ΓÄ»

 FAIL  tests/ui/common/Breadcrumbs.test.tsx > Breadcrumbs Component > should apply font-medium to last item
Error: expect(element).toHaveClass("font-medium")

Expected the element to have class:
  font-medium
Received:

 Γ¥» tests/ui/common/Breadcrumbs.test.tsx:101:38
     99| 
    100|     const lastItem = screen.getByText('Test Database');
    101|     expect(lastItem.closest('span')).toHaveClass('font-medium');
       |                                      ^
    102|   });
    103| });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[206/326]ΓÄ»

 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render database settings page with breadcrumbs
 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render DatabaseSettings component with database data
 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should display database name in header
 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render sidebar
ReferenceError: React is not defined
 Γ¥» DatabaseSettingsPage client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3
     54|   }
     55| 
     56|   return (
       |   ^
     57|     <div className="flex h-screen bg-background overflow-hidden">
     58|       <Sidebar />
 Γ¥» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Γ¥» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Γ¥» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Γ¥» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Γ¥» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Γ¥» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Γ¥» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Γ¥» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Γ¥» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[207/326]ΓÄ»

 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should show loading state
Error: Cannot find module '@/lib/datavault-hooks'
Require stack:
- C:\Users\scoot\poll\VaultLogic\tests\ui\datavault\DatabaseSettingsPage.test.tsx
 Γ¥» tests/ui/datavault/DatabaseSettingsPage.test.tsx:83:38
     81| 
     82|   it('should show loading state', () => {
     83|     const { useDatavaultDatabase } = require('@/lib/datavault-hooks');
       |                                      ^
     84|     useDatavaultDatabase.mockReturnValue({
     85|       data: null,

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[208/326]ΓÄ»

 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should show not found state when database does not exist
Error: Cannot find module '@/lib/datavault-hooks'
Require stack:
- C:\Users\scoot\poll\VaultLogic\tests\ui\datavault\DatabaseSettingsPage.test.tsx
 Γ¥» tests/ui/datavault/DatabaseSettingsPage.test.tsx:95:38
     93| 
     94|   it('should show not found state when database does not exist', () =>ΓÇª
     95|     const { useDatavaultDatabase } = require('@/lib/datavault-hooks');
       |                                      ^
     96|     useDatavaultDatabase.mockReturnValue({
     97|       data: null,

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[209/326]ΓÄ»

 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should navigate back when back button is clicked
TypeError: useLocation.mockReturnValue is not a function
 Γ¥» tests/ui/datavault/DatabaseSettingsPage.test.tsx:120:17
    118|     const mockSetLocation = vi.fn();
    119|     const { useLocation } = require('wouter');
    120|     useLocation.mockReturnValue(['/datavault/databases/db-1/settings',ΓÇª
       |                 ^
    121| 
    122|     renderPage();

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[210/326]ΓÄ»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Boolean Type (Checkbox) > shows loading spinner when saving checkbox
Error: expect(received).toBeInTheDocument()

received value must be an HTMLElement or an SVGElement.
Received has type:  Null
Received has value: null

Ignored nodes: comments, script, style
<html>
  <head />
  <body>
    <div>
      <div
        aria-label="Is Active: No"
        class="px-3 py-2 min-h-[40px] flex items-center gap-2 cursor-pointer hover:bg-accent/50"
        role="gridcell"
      >
        <button
          aria-checked="false"
          aria-label="Is Active"
          class="peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground"
          data-state="unchecked"
          role="checkbox"
          type="button"
          value="on"
        />
      </div>
    </div>
  </body>
</html>
 Γ¥» tests/ui/datavault/EditableCell.test.tsx:279:77
    277| 
    278|       await waitFor(() => {
    279|         expect(screen.getByRole('gridcell').querySelector('.animate-spΓÇª
       |                                                                             ^
    280|       });
    281| 
 Γ¥» runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:47:12
 Γ¥» checkCallback node_modules/@testing-library/dom/dist/wait-for.js:124:77
 Γ¥» Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:118:16

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[211/326]ΓÄ»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Value Formatting > formats date values for display
AssertionError: expected '1/14/2000' to contain '1/15/2000'

Expected: "1/15/2000"
Received: "1/14/2000"

 Γ¥» tests/ui/datavault/EditableCell.test.tsx:334:32
    332| 
    333|       const cell = screen.getByRole('gridcell');
    334|       expect(cell.textContent).toContain('1/15/2000');
       |                                ^
    335|     });
    336| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[212/326]ΓÄ»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Value Formatting > formats boolean values as Yes/No
Error: expect(element).toHaveAttribute("aria-label", "Verified: Yes") // element.getAttribute("aria-label") === "Verified: Yes"

Expected the element to have attribute:
  aria-label="Verified: Yes"
Received:
  aria-label="Verified: true"
 Γ¥» tests/ui/datavault/EditableCell.test.tsx:342:20
    340| 
    341|       const cell = screen.getByRole('gridcell');
    342|       expect(cell).toHaveAttribute('aria-label', 'Verified: Yes');
       |                    ^
    343|     });
    344| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[213/326]ΓÄ»

 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table name and description
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table slug
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render column and row counts
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onClick when card is clicked
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onDelete when delete button is clicked
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should show placeholder when description is missing
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should format dates correctly
ReferenceError: React is not defined
 Γ¥» TableCard client/src/components/datavault/TableCard.tsx:38:3
     36|   };
     37| 
     38|   return (
       |   ^
     39|     <Card className="cursor-pointer hover:shadow-md transition-shadow ΓÇª
     40|       <div onClick={onClick}>
 Γ¥» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Γ¥» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Γ¥» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Γ¥» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Γ¥» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Γ¥» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Γ¥» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Γ¥» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Γ¥» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[214/326]ΓÄ»

 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render template name and description
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should show "Coming Soon" badge
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render preview columns
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should limit preview columns to 5 and show count for remaining
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should handle empty preview columns
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should have cursor-not-allowed style
ReferenceError: React is not defined
 Γ¥» TemplateCard client/src/components/datavault/TemplateCard.tsx:19:3
     17| 
     18| export function TemplateCard({ name, description, icon, previewColumnsΓÇª
     19|   return (
       |   ^
     20|     <TooltipProvider>
     21|       <Tooltip>
 Γ¥» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Γ¥» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Γ¥» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Γ¥» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Γ¥» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Γ¥» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Γ¥» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Γ¥» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Γ¥» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[215/326]ΓÄ»

 FAIL  tests/unit/client/choice-utils.test.ts > choice-utils > uses label template with column names
AssertionError: expected ' ()' to be 'Alice (Admin)' // Object.is equality

Expected: "Alice (Admin)"
Received: " ()"

 Γ¥» tests/unit/client/choice-utils.test.ts:116:31
    114|         };
    115|         const opts = generateOptionsFromList(mockList, config);
    116|         expect(opts[0].label).toBe("Alice (Admin)");
       |                               ^
    117|         expect(opts[1].label).toBe("Bob (User)");
    118|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[216/326]ΓÄ»

 FAIL  tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should track skipped blocks in trace
AssertionError: expected 'condition false' to be 'condition evaluated to false' // Object.is equality

Expected: "condition evaluated to false"
Received: "condition false"

 Γ¥» tests/unit/debugging/Lineage.test.ts:133:36
    131| 
    132|         expect(step.status).toBe('skipped');
    133|         expect(step.skippedReason).toBe('condition evaluated to false'ΓÇª
       |                                    ^
    134|         expect(result.executionTrace!.variableLineage['skippedVar']).tΓÇª
    135|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[217/326]ΓÄ»

 FAIL  tests/unit/middleware/auth.middleware.test.ts > Auth Middleware > requireAuth > should return 401 for missing token
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{ΓÇª} ]

Received: 

  1st vi.fn() call:

  [
-   ObjectContaining {
-     "error": "missing_token",
+   {
+     "error": {
+       "code": "AUTH_008",
+       "details": {
+         "errorType": "UnauthorizedError",
+       },
        "message": "Authentication required",
+       "timestamp": "2026-01-07T19:28:59.951Z",
+     },
+     "success": false,
    },
  ]


Number of calls: 1

 Γ¥» tests/unit/middleware/auth.middleware.test.ts:74:24
     72|       expect(mockNext).not.toHaveBeenCalled();
     73|       expect(statusMock).toHaveBeenCalledWith(401);
     74|       expect(jsonMock).toHaveBeenCalledWith(
       |                        ^
     75|         expect.objectContaining({
     76|           message: 'Authentication required',

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[218/326]ΓÄ»

 FAIL  tests/unit/schema/collections.test.ts > Collections Schema > Insert Schemas > insertCollectionSchema > should omit id, createdAt, and updatedAt
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Γ¥» tests/unit/schema/collections.test.ts:139:32
    137|         const result = insertCollectionSchema.safeParse(dataWithOmitteΓÇª
    138|         // Should be invalid because id, createdAt, updatedAt are omitΓÇª
    139|         expect(result.success).toBe(false);
       |                                ^
    140|       });
    141| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[219/326]ΓÄ»

 FAIL  tests/unit/server/transferOwnership.test.ts > Transfer Ownership > Project Transfer > should allow org member to transfer org-owned project to another org they belong to
Error: Access denied - you do not have permission to access this project
 Γ¥» ProjectService.verifyOwnership server/services/ProjectService.ts:50:11
     48|     }
     49| 
     50|     throw new Error("Access denied - you do not have permission to accΓÇª
       |           ^
     51|   }
     52| 
 Γ¥» ProjectService.transferOwnership server/services/ProjectService.ts:274:21
 Γ¥» tests/unit/server/transferOwnership.test.ts:157:27

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[220/326]ΓÄ»

 FAIL  tests/unit/server/transferOwnership.test.ts > Transfer Ownership > Workflow Transfer > should keep workflow in project when transferring to same owner
AssertionError: expected null to be 'a64bbe63-e37a-4ada-9ec0-c8e248b1cac9' // Object.is equality

- Expected: 
"a64bbe63-e37a-4ada-9ec0-c8e248b1cac9"

+ Received: 
null

 Γ¥» tests/unit/server/transferOwnership.test.ts:227:37
    225|       expect(transferred.ownerType).toBe('org');
    226|       expect(transferred.ownerUuid).toBe(testOrgId);
    227|       expect(transferred.projectId).toBe(testProjectId); // Still in pΓÇª
       |                                     ^
    228|     });
    229| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[221/326]ΓÄ»

 FAIL  tests/unit/server/transferOwnership.test.ts > Transfer Ownership > Transfer Validation > should allow transfer from user to self (org member transferring org asset to themselves)
Error: Access denied - you do not have permission to access this project
 Γ¥» ProjectService.verifyOwnership server/services/ProjectService.ts:50:11
     48|     }
     49| 
     50|     throw new Error("Access denied - you do not have permission to accΓÇª
       |           ^
     51|   }
     52| 
 Γ¥» ProjectService.transferOwnership server/services/ProjectService.ts:274:21
 Γ¥» tests/unit/server/transferOwnership.test.ts:359:27

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[222/326]ΓÄ»

 FAIL  tests/unit/services/AIService.test.ts > AIService Unit Tests > reviseWorkflow should parse valid JSON response correctly
Error: AI response does not match expected schema

≡ƒöº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Γ¥» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublΓÇª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Γ¥» AIService.reviseWorkflowSingleShot server/services/AIService.ts:1418:20
 Γ¥» AIService.reviseWorkflow server/services/AIService.ts:1298:16
 Γ¥» tests/unit/services/AIService.test.ts:61:24

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[223/326]ΓÄ»

 FAIL  tests/unit/services/AIService.test.ts > AIService Unit Tests > reviseWorkflow should handle JSON markdown code blocks
Error: AI response does not match expected schema

≡ƒöº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Γ¥» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublΓÇª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Γ¥» AIService.reviseWorkflowSingleShot server/services/AIService.ts:1418:20
 Γ¥» AIService.reviseWorkflow server/services/AIService.ts:1298:16
 Γ¥» tests/unit/services/AIService.test.ts:95:24

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[224/326]ΓÄ»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > createToken() > should include userId, email, tenantId, and role in token payload
AssertionError: expected undefined to be 'builder' // Object.is equality

- Expected: 
"builder"

+ Received: 
undefined

 Γ¥» tests/unit/services/AuthService.test.ts:349:30
    347|         expect(decoded.email).toBe("owner@example.com");
    348|         expect(decoded.tenantId).toBe("tenant-789");
    349|         expect(decoded.role).toBe("builder");
       |                              ^
    350|       });
    351| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[225/326]ΓÄ»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > createToken() > should handle null tenantId and role
AssertionError: expected undefined to be null

- Expected: 
null

+ Received: 
undefined

 Γ¥» tests/unit/services/AuthService.test.ts:432:30
    430| 
    431|         expect(decoded.tenantId).toBeNull();
    432|         expect(decoded.role).toBeNull();
       |                              ^
    433|       });
    434|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[226/326]ΓÄ»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should verify and decode a valid token
AssertionError: expected undefined to be 'owner' // Object.is equality

- Expected: 
"owner"

+ Received: 
undefined

 Γ¥» tests/unit/services/AuthService.test.ts:463:30
    461|         expect(payload.email).toBe("test@example.com");
    462|         expect(payload.tenantId).toBe("tenant-123");
    463|         expect(payload.role).toBe("owner");
       |                              ^
    464|       });
    465| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[227/326]ΓÄ»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for invalid token signature
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Γ¥» tests/unit/services/AuthService.test.ts:502:62
    500|         const tamperedToken = token.slice(0, -5) + "XXXXX";
    501| 
    502|         expect(() => authService.verifyToken(tamperedToken)).toThrow("ΓÇª
       |                                                              ^
    503|       });
    504| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[228/326]ΓÄ»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for malformed token
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Γ¥» tests/unit/services/AuthService.test.ts:506:68
    504| 
    505|       it("should throw error for malformed token", () => {
    506|         expect(() => authService.verifyToken("not.a.valid.token")).toTΓÇª
       |                                                                    ^
    507|       });
    508| 

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[229/326]ΓÄ»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for invalid token
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Γ¥» tests/unit/services/AuthService.test.ts:511:64
    509|       it("should throw error for invalid token", () => {
    510|         // Test with a malformed token
    511|         expect(() => authService.verifyToken("invalid.token")).toThrowΓÇª
       |                                                                ^
    512|       });
    513|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[230/326]ΓÄ»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > Security Edge Cases > Token Manipulation > should reject token with valid structure but invalid signature
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Γ¥» tests/unit/services/AuthService.test.ts:1053:58
    1051|         const fakeToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2ΓÇª
    1052| 
    1053|         expect(() => authService.verifyToken(fakeToken)).toThrow("InvaΓÇª
       |                                                          ^
    1054|       });
    1055|     });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[231/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Basic navigation (no conditions) > should return all pages in order when no conditions
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:49:71
     47|       ];
     48| 
     49|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
     50|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
     51|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[232/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Basic navigation (no conditions) > should handle empty workflow
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:65:71
     63| 
     64|     it('should handle empty workflow', async () => {
     65|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
     66|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
     67|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[233/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Basic navigation (no conditions) > should calculate correct current page index
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:85:71
     83|       ];
     84| 
     85|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
     86|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
     87|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[234/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > visibleIf conditions > should hide pages when visibleIf is false
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:125:71
    123|       ];
    124| 
    125|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    126|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    127|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[235/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > visibleIf conditions > should show pages when visibleIf is true
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:158:71
    156|       ];
    157| 
    158|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    159|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    160|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[236/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > visibleIf conditions > should handle complex visibleIf conditions
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:196:71
    194|       ];
    195| 
    196|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    197|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    198|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[237/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > skipIf conditions > should skip pages when skipIf is true
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:233:71
    231|       ];
    232| 
    233|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    234|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    235|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[238/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > skipIf conditions > should not skip pages when skipIf is false
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:266:71
    264|       ];
    265| 
    266|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    267|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    268|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[239/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Combined visibleIf and skipIf > should apply visibleIf before skipIf
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:306:71
    304|       ];
    305| 
    306|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    307|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    308|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[240/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Helper methods > should get first page
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:343:71
    341|       ];
    342| 
    343|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    344|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    345|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[241/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Helper methods > should return null for first page if all pages hidden
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:367:71
    365|       const mockValues = [{ runId: 'run1', stepId: 'step1', value: falΓÇª
    366| 
    367|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    368|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    369|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[242/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Helper methods > should validate page navigability
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:392:71
    390|       const mockValues = [{ runId: 'run1', stepId: 'step1', value: falΓÇª
    391| 
    392|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    393|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    394|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[243/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Helper methods > should get page sequence
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:420:71
    418|       const mockValues = [{ runId: 'run1', stepId: 'step1', value: truΓÇª
    419| 
    420|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    421|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    422|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[244/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Error handling > should default to visible on visibleIf evaluation error
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:447:71
    445|       ];
    446| 
    447|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    448|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    449|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[245/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Error handling > should default to not skipping on skipIf evaluation error
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:470:71
    468|       ];
    469| 
    470|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    471|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    472|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[246/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Progress calculation > should calculate correct progress for multi-page workflow
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:495:71
    493|       ];
    494| 
    495|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    496|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    497|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[247/326]ΓÄ»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Progress calculation > should adjust progress when pages are skipped
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Γ¥» tests/unit/services/intakeNavigation.test.ts:533:71
    531|       const mockValues = [{ runId: 'run1', stepId: 'step1', value: truΓÇª
    532| 
    533|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyΓÇª
       |                                                                       ^
    534|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseΓÇª
    535|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mΓÇª

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[248/326]ΓÄ»

 FAIL  tests/unit/services/intakeQuestionVisibility.test.ts > IntakeQuestionVisibilityService > Hidden question value clearing > should clear values for hidden questions
TypeError: this.stepValueRepo.deleteWhere is not a function
 Γ¥» IntakeQuestionVisibilityService.clearHiddenQuestionValues server/services/IntakeQuestionVisibilityService.ts:339:32
    337|       const { stepValues } = await import("../../shared/schema");
    338| 
    339|       await this.stepValueRepo.deleteWhere(inArray(stepValues.id, idsTΓÇª
       |                                ^
    340| 
    341|       logger.debug(
 Γ¥» tests/unit/services/intakeQuestionVisibility.test.ts:425:23

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[249/326]ΓÄ»

 FAIL  tests/unit/services/intakeQuestionVisibility.test.ts > IntakeQuestionVisibilityService > Cascading visibility > should handle questions that depend on each other
AssertionError: expected [ 'q1' ] to deeply equal [ 'q1', 'q2', 'q3' ]

- Expected
+ Received

  [
    "q1",
-   "q2",
-   "q3",
  ]

 Γ¥» tests/unit/services/intakeQuestionVisibility.test.ts:615:40
    613|       const result2 = await service.evaluatePageQuestions('section1', ΓÇª
    614| 
    615|       expect(result2.visibleQuestions).toEqual(['q1', 'q2', 'q3']); //ΓÇª
       |                                        ^
    616|     });
    617|   });

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[250/326]ΓÄ»

 FAIL  tests/unit/services/StepService.test.ts > StepService > createStep > should create a step with auto-incrementing order
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{ΓÇª} ]

Received: 

  1st vi.fn() call:

  [
-   ObjectContaining {
-     "order": 3,
+   {
+     "options": {},
+     "order": 1,
+     "required": false,
      "sectionId": "section-pymtbf",
+     "title": "New Step",
+     "type": "short_text",
    },
  ]


Number of calls: 1

 Γ¥» tests/unit/services/StepService.test.ts:65:35
     63| 
     64|       expect(result.order).toBe(3);
     65|       expect(mockStepRepo.create).toHaveBeenCalledWith(
       |                                   ^
     66|         expect.objectContaining({
     67|           sectionId: section.id,

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[251/326]ΓÄ»

 FAIL  tests/unit/writes/WriteRunner.test.ts > WriteRunner > Mode: Create > should resolve values and call createRowWithValues
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{ΓÇª}, ΓÇª(1) ]

Number of calls: 0

 Γ¥» tests/unit/writes/WriteRunner.test.ts:143:65
    141|                 { columnId: "col-age", value: 30 }
    142|             ];
    143|             expect(datavaultRowsRepository.createRowWithValues).toHaveΓÇª
       |                                                                 ^
    144|                 expect.objectContaining({ tableId: "table-users", tenaΓÇª
    145|                 expect.arrayContaining([

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[252/326]ΓÄ»

 FAIL  tests/unit/writes/WriteRunner.test.ts > WriteRunner > Mode: Update > should find row by PK and update
AssertionError: expected "vi.fn()" to be called with arguments: [ 'row-existing-1', [ { ΓÇª(2) } ] ]

Number of calls: 0

 Γ¥» tests/unit/writes/WriteRunner.test.ts:192:61
    190|                 "table-users", "col-email", "test@example.com", mockTeΓÇª
    191|             );
    192|             expect(datavaultRowsRepository.updateRowValues).toHaveBeenΓÇª
       |                                                             ^
    193|                 "row-existing-1",
    194|                 [{ columnId: "col-status", value: "Active" }]

ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[253/326]ΓÄ»


 Test Files  54 failed | 100 passed | 1 skipped (155)
      Tests  315 failed | 2153 passed | 67 skipped (2535)
   Start at  13:28:44
   Duration  83.82s (transform 33.55s, setup 40.44s, import 268.82s, tests 687.24s, environment 17.92s)

