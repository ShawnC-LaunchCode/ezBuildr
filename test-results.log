
> vault-logic@1.0.0 test
> vitest run --coverage


[1m[46m RUN [49m[22m [36mv4.0.5 [39m[90m/home/user/VaultLogic[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/utils/conditionalLogic.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 14[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":50,"time":1763474932877,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
 [32mâœ“[39m tests/unit/workflows/conditionTruthTable.test.ts [2m([22m[2m51 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":50,"time":1763474932880,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating skipIf condition"}
{"level":50,"time":1763474932908,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/intakeNavigation.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [31mâ¯[39m tests/unit/services/intakeQuestionVisibility.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 45[2mms[22m[39m
       [32mâœ“[39m should return all questions as visible when no conditions[32m 3[2mms[22m[39m
       [32mâœ“[39m should exclude virtual steps from visibility evaluation[32m 0[2mms[22m[39m
       [32mâœ“[39m should maintain question order[32m 0[2mms[22m[39m
       [32mâœ“[39m should hide questions when visibleIf is false[32m 1[2mms[22m[39m
       [32mâœ“[39m should show questions when visibleIf is true[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle complex visibleIf conditions[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle OR conditions[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle NOT conditions[32m 0[2mms[22m[39m
       [32mâœ“[39m should include visible required questions in validation[32m 0[2mms[22m[39m
       [32mâœ“[39m should skip hidden questions in validation[32m 0[2mms[22m[39m
       [32mâœ“[39m should check if question is visible[32m 1[2mms[22m[39m
       [32mâœ“[39m should get visible question count[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should clear values for hidden questions[39m[32m 26[2mms[22m[39m
       [32mâœ“[39m should not clear values for visible questions[32m 1[2mms[22m[39m
       [32mâœ“[39m should warn if required question has visibility condition[32m 1[2mms[22m[39m
       [32mâœ“[39m should warn if virtual step has visibility condition[32m 1[2mms[22m[39m
       [32mâœ“[39m should return no warnings for valid configuration[32m 0[2mms[22m[39m
       [32mâœ“[39m should default to visible on condition evaluation error[32m 3[2mms[22m[39m
       [32mâœ“[39m should handle questions that depend on each other[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/auth-oauth.integration.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mðŸ§ª Setting up test environment...

 [32mâœ“[39m tests/unit/schema/documentEngine.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/schema/collections.test.ts [2m([22m[2m34 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 32[2mms[22m[39m
       [32mâœ“[39m should have correct table name[32m 2[2mms[22m[39m
       [32mâœ“[39m should have required columns[32m 1[2mms[22m[39m
       [32mâœ“[39m should have correct table name[32m 0[2mms[22m[39m
       [32mâœ“[39m should have required columns[32m 1[2mms[22m[39m
       [32mâœ“[39m should have correct table name[32m 0[2mms[22m[39m
       [32mâœ“[39m should have required columns[32m 0[2mms[22m[39m
       [32mâœ“[39m should have all expected field types[32m 1[2mms[22m[39m
         [32mâœ“[39m should validate valid collection data[32m 1[2mms[22m[39m
         [32mâœ“[39m should require tenantId, name, and slug[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should omit id, createdAt, and updatedAt[39m[32m 9[2mms[22m[39m
         [32mâœ“[39m should allow description to be null[32m 0[2mms[22m[39m
         [32mâœ“[39m should validate valid field data[32m 0[2mms[22m[39m
         [32mâœ“[39m should require collectionId, name, slug, and type[32m 0[2mms[22m[39m
         [32mâœ“[39m should validate field type enum[32m 0[2mms[22m[39m
         [32mâœ“[39m should reject invalid field type[32m 0[2mms[22m[39m
         [32mâœ“[39m should allow options for select types[32m 1[2mms[22m[39m
         [32mâœ“[39m should allow defaultValue[32m 0[2mms[22m[39m
         [32mâœ“[39m should validate valid record data[32m 0[2mms[22m[39m
         [32mâœ“[39m should require tenantId, collectionId, and data[32m 0[2mms[22m[39m
         [32mâœ“[39m should allow empty data object[32m 4[2mms[22m[39m
         [32mâœ“[39m should allow createdBy and updatedBy to be null[32m 0[2mms[22m[39m
         [32mâœ“[39m should allow complex nested data structures[32m 0[2mms[22m[39m
       [32mâœ“[39m should enforce unique slug per tenant for collections[32m 0[2mms[22m[39m
       [32mâœ“[39m should enforce unique slug per collection for fields[32m 0[2mms[22m[39m
       [32mâœ“[39m should cascade delete fields when collection is deleted[32m 0[2mms[22m[39m
       [32mâœ“[39m should cascade delete records when collection is deleted[32m 0[2mms[22m[39m
       [32mâœ“[39m should cascade delete records when tenant is deleted[32m 0[2mms[22m[39m
       [32mâœ“[39m should set null on createdBy/updatedBy when user is deleted[32m 0[2mms[22m[39m
       [32mâœ“[39m should support JSONB for field options[32m 0[2mms[22m[39m
       [32mâœ“[39m should support JSONB for field default values[32m 0[2mms[22m[39m
       [32mâœ“[39m should support JSONB for record data with fieldSlug â†’ value mapping[32m 0[2mms[22m[39m
       [32mâœ“[39m should correctly infer Collection type[32m 0[2mms[22m[39m
       [32mâœ“[39m should correctly infer CollectionField type[32m 0[2mms[22m[39m
       [32mâœ“[39m should correctly infer CollectionRecord type[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/BrandingService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 20[2mms[22m[39m
 [32mâœ“[39m tests/unit/services/EmailTemplateMetadataService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | tests/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [2m[90mâ†“[39m[22m tests/unit/services/WorkflowTemplateService.test.ts [2m([22m[2m24 tests[22m[2m | [22m[33m24 skipped[39m[2m)[22m
 [2m[90mâ†“[39m[22m tests/unit/engine/templateNode.test.ts [2m([22m[2m17 tests[22m[2m | [22m[33m17 skipped[39m[2m)[22m
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/auth/googleAuth.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/auth-oauth.integration.test.ts[2m > [22m[2mOAuth2 Integration Tests
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/api.runs.stage8.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/RecordService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 20[2mms[22m[39m
[90mstdout[2m | tests/engine.run-conditions.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/engine.run-conditions.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/engine.run-conditions.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[32m 26[2mms[22m[39m
       [32mâœ“[39m should validate a simple graph[32m 3[2mms[22m[39m
       [32mâœ“[39m should detect duplicate node IDs[32m 0[2mms[22m[39m
       [32mâœ“[39m should detect invalid edge references[32m 0[2mms[22m[39m
       [32mâœ“[39m should validate node conditions[32m 3[2mms[22m[39m
       [32mâœ“[39m should detect typos in variable names[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should validate compute node expressions[39m[32m 9[2mms[22m[39m
       [32mâœ“[39m should validate branch conditions[32m 0[2mms[22m[39m
       [32mâœ“[39m should validate template bindings[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should skip question when condition is false[39m[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m should execute question when condition is true[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should skip compute node when condition is false[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should execute compute node when condition is true[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should handle complex workflow with multiple conditions[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should return trace when debug is enabled[32m 1[2mms[22m[39m
       [32mâœ“[39m should not return trace when debug is disabled[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.stage12.5.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/intake.stage12.5.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mðŸ§ª Setting up test environment...

 [32mâœ“[39m tests/integration/intake.stage12.5.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 9[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/DocumentTemplateService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":30,"time":1763474935059,"env":"test","module":"ai-service","duration":3,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"msg":"AI workflow generation succeeded"}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":50,"time":1763474935064,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR"},"duration":0,"msg":"AI workflow generation failed"}
{"level":50,"time":1763474935067,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR"},"duration":0,"msg":"AI workflow generation failed"}
{"level":50,"time":1763474935069,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR"},"duration":0,"msg":"AI workflow generation failed"}
{"level":50,"time":1763474935070,"env":"test","module":"ai-service","error":{"code":"RATE_LIMIT","details":{"originalError":"Rate limit exceeded"}},"duration":0,"msg":"AI workflow generation failed"}
{"level":50,"time":1763474935072,"env":"test","module":"ai-service","error":{},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1763474935075,"env":"test","module":"ai-service","duration":0,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1763474935076,"env":"test","module":"ai-service","duration":0,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1763474935078,"env":"test","module":"ai-service","duration":0,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
 [32mâœ“[39m tests/unit/ai.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 30[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/auth/googleAuth.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/auth/googleAuth.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/services/CollectionFieldService.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 31[2mms[22m[39m
       [32mâœ“[39m should create text field with generated slug[32m 4[2mms[22m[39m
       [32mâœ“[39m should create select field with options[32m 1[2mms[22m[39m
       [32mâœ“[39m should throw error if select field missing options[32m 2[2mms[22m[39m
       [32mâœ“[39m should throw error if options is not an array[32m 0[2mms[22m[39m
       [32mâœ“[39m should throw error if options array is empty[32m 0[2mms[22m[39m
       [32mâœ“[39m should create field with default value[32m 0[2mms[22m[39m
       [32mâœ“[39m should throw error if default value type mismatch[32m 0[2mms[22m[39m
       [32mâœ“[39m should ensure unique slug by appending counter[32m 1[2mms[22m[39m
       [32mâœ“[39m should throw error if collection does not exist[32m 0[2mms[22m[39m
       [32mâœ“[39m should return field if it belongs to collection[32m 0[2mms[22m[39m
       [32mâœ“[39m should throw error if field not found[32m 0[2mms[22m[39m
       [32mâœ“[39m should throw error if field belongs to different collection[32m 1[2mms[22m[39m
       [32mâœ“[39m should update field and regenerate slug if name changed[32m 0[2mms[22m[39m
       [32mâœ“[39m should verify field ownership before updating[32m 0[2mms[22m[39m
       [32mâœ“[39m should delete field after verifying ownership[32m 1[2mms[22m[39m
       [32mâœ“[39m should create multiple fields[32m 1[2mms[22m[39m
       [32mâœ“[39m should use underscores instead of dashes for field slugs[32m 0[2mms[22m[39m
       [32mâœ“[39m should validate text default value[32m 1[2mms[22m[39m
       [32mâœ“[39m should validate number default value[32m 0[2mms[22m[39m
       [32mâœ“[39m should validate boolean default value[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should validate date default value[39m[32m 11[2mms[22m[39m
       [32mâœ“[39m should validate select default value[32m 1[2mms[22m[39m
       [32mâœ“[39m should validate multi_select default value[32m 1[2mms[22m[39m
 [32mâœ“[39m tests/unit/auth/googleAuth.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [2m[90mâ†“[39m[22m tests/unit/repositories/WorkflowTemplateRepository.test.ts [2m([22m[2m21 tests[22m[2m | [22m[33m21 skipped[39m[2m)[22m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/analytics.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/analytics.test.ts
[22m[39mâœ“ Test database initialized

[90mstdout[2m | tests/analytics.test.ts
[22m[39mâœ“ Test database cleaned up

[90mstdout[2m | tests/analytics.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/analytics.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 83[2mms[22m[39m
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/TemplateAnalysisService.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 23[2mms[22m[39m
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/repeater.test.ts [2m([22m[2m18 tests[22m[2m)[22m[32m 14[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1763474936203,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
{"level":30,"time":1763474936204,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
{"level":30,"time":1763474936204,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

 [32mâœ“[39m tests/integration/datavault.routes.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 12[2mms[22m[39m
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [31mâ¯[39m tests/unit/services/DatavaultRowsService.test.ts [2m([22m[2m9 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[32m 27[2mms[22m[39m
[31m       [31mÃ—[31m should get rows with values and pagination[39m[32m 8[2mms[22m[39m
[31m       [31mÃ—[31m should get a single row by ID[39m[32m 2[2mms[22m[39m
       [32mâœ“[39m should throw 404 if row not found[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m should create row with validated values[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if required field is missing[39m[32m 6[2mms[22m[39m
[31m       [31mÃ—[31m should update row values[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should delete row[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should coerce number values[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should coerce boolean values[39m[32m 1[2mms[22m[39m
 [32mâœ“[39m tests/integration/branding.routes.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [2m[90mâ†“[39m[22m tests/unit/services/PdfQueueService.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m
[90mstdout[2m | tests/unit/services/AnalyticsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/CollectionService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 16[2mms[22m[39m
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/integration/collections.e2e.test.ts [2m([22m[2m23 tests[22m[2m | [22m[33m23 skipped[39m[2m)[22m[32m 25[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a collection
       [2m[90mâ†“[39m[22m should list collections
       [2m[90mâ†“[39m[22m should get a collection by ID
       [2m[90mâ†“[39m[22m should update a collection
       [2m[90mâ†“[39m[22m should create text field
       [2m[90mâ†“[39m[22m should create email field
       [2m[90mâ†“[39m[22m should create number field
       [2m[90mâ†“[39m[22m should create select field with options
       [2m[90mâ†“[39m[22m should create boolean field
       [2m[90mâ†“[39m[22m should list all fields
       [2m[90mâ†“[39m[22m should update field
       [2m[90mâ†“[39m[22m should create a record
       [2m[90mâ†“[39m[22m should create multiple records
       [2m[90mâ†“[39m[22m should list records with pagination
       [2m[90mâ†“[39m[22m should get a single record
       [2m[90mâ†“[39m[22m should update a record
       [2m[90mâ†“[39m[22m should find records by filters
       [2m[90mâ†“[39m[22m should delete a record
       [2m[90mâ†“[39m[22m should get collection with stats
       [2m[90mâ†“[39m[22m should list collections with stats
       [2m[90mâ†“[39m[22m should enforce required fields
       [2m[90mâ†“[39m[22m should validate field types
       [2m[90mâ†“[39m[22m should delete collection (cascade fields and records)
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/engine.expr.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/engine.expr.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/engine.expr.test.ts [2m([22m[2m26 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[32m 35[2mms[22m[39m
       [32mâœ“[39m should allow known variables and helpers[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should allow helper functions[39m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m should allow complex expressions with multiple helpers[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should reject unknown identifiers[32m 0[2mms[22m[39m
       [32mâœ“[39m should reject forbidden identifiers[32m 0[2mms[22m[39m
       [32mâœ“[39m should handle syntax errors gracefully[32m 0[2mms[22m[39m
       [32mâœ“[39m should validate boolean expressions[32m 0[2mms[22m[39m
       [32mâœ“[39m should validate string operations[32m 0[2mms[22m[39m
       [32mâœ“[39m should evaluate simple arithmetic[32m 1[2mms[22m[39m
       [32mâœ“[39m should be deterministic with fixed clock[32m 2[2mms[22m[39m
[31m       [31mÃ—[31m should evaluate with helper functions[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should support math helpers[32m 1[2mms[22m[39m
       [32mâœ“[39m should support string helpers[32m 1[2mms[22m[39m
       [32mâœ“[39m should support array helpers[32m 1[2mms[22m[39m
       [32mâœ“[39m should support logic helpers[32m 1[2mms[22m[39m
       [32mâœ“[39m should support date helpers with deterministic clock[32m 0[2mms[22m[39m
       [32mâœ“[39m should reject invalid property access[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle evaluation errors gracefully[32m 1[2mms[22m[39m
       [32mâœ“[39m should enforce timeout on long-running expressions[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should support complex nested expressions[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle boolean comparisons[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle string concatenation[32m 0[2mms[22m[39m
       [32mâœ“[39m should have all helpers listed in AllowedHelperNames[32m 0[2mms[22m[39m
       [32mâœ“[39m round should handle edge cases[32m 0[2mms[22m[39m
       [32mâœ“[39m dateDiff should calculate differences correctly[32m 0[2mms[22m[39m
       [32mâœ“[39m isEmpty should handle various types[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AnalyticsService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/AnalyticsService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth-jwt.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

 [31mâ¯[39m tests/unit/services/AnalyticsService.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 36[2mms[22m[39m
[31m       [31mÃ—[31m should return comprehensive survey analytics[39m[32m 11[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if user is not the creator[39m[32m 7[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if survey not found[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should return question-level metrics[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if not authorized[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should return page-level analytics[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should calculate drop-off rates between pages[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should handle single-page surveys[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should return time spent metrics[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should handle surveys with no completed responses[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should calculate engagement metrics[39m[32m 2[2mms[22m[39m
[31m       [31mÃ—[31m should handle zero responses gracefully[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should return aggregated question data[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if unauthorized[39m[32m 2[2mms[22m[39m
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1763474937604,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
 [32mâœ“[39m tests/unit/services/StepService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 18[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/utils/encryption.test.ts [2m([22m[2m29 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [31mâ¯[39m tests/unit/repositories/DocumentTemplateRepository.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[32m 20[2mms[22m[39m
       [32mâœ“[39m should find templates by project ID[32m 3[2mms[22m[39m
       [32mâœ“[39m should return empty array when no templates found[32m 1[2mms[22m[39m
       [32mâœ“[39m should find templates by type[32m 1[2mms[22m[39m
       [32mâœ“[39m should find template by ID and project ID[32m 1[2mms[22m[39m
       [32mâœ“[39m should return undefined when template not found[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should update template name and description[39m[32m 6[2mms[22m[39m
[31m       [31mÃ—[31m should return undefined when template not found[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should update template file reference[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should delete template and return true[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should return false when template not found[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should return true when template name exists[32m 1[2mms[22m[39m
       [32mâœ“[39m should return false when template name does not exist[32m 0[2mms[22m[39m
       [32mâœ“[39m should exclude specific template ID when checking existence[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should create a new template[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should find template by ID[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/docxRenderer.test.ts[2m > [22m[2mDOCX Renderer Service[2m > [22m[2mextractPlaceholdersFromDocx[2m > [22m[2mshould extract placeholders from a template
[22m[39m{
  "error": [
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{clie",
        "id": "duplicate_open_tag",
        "context": "{{clie",
        "offset": 6,
        "explanation": "The tag beginning with \"{{clie\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "name}}",
        "id": "duplicate_close_tag",
        "context": "name}}",
        "offset": 19,
        "explanation": "The tag ending with \"name}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{amou",
        "id": "duplicate_open_tag",
        "context": "{{amou",
        "offset": 45,
        "explanation": "The tag beginning with \"{{amou\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "ount}}",
        "id": "duplicate_close_tag",
        "context": "ount}}",
        "offset": 53,
        "explanation": "The tag ending with \"ount}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    }
  ]
}

[90mstdout[2m | tests/unit/docxRenderer.test.ts[2m > [22m[2mDOCX Renderer Service[2m > [22m[2mextractPlaceholdersFromDocx[2m > [22m[2mshould extract placeholders including formatters
[22m[39m{
  "error": [
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{name",
        "id": "duplicate_open_tag",
        "context": "{{name",
        "offset": 6,
        "explanation": "The tag beginning with \"{{name\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "name}}",
        "id": "duplicate_close_tag",
        "context": "name}}",
        "offset": 12,
        "explanation": "The tag ending with \"name}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{date",
        "id": "duplicate_open_tag",
        "context": "{{date",
        "offset": 23,
        "explanation": "The tag beginning with \"{{date\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "date}}",
        "id": "duplicate_close_tag",
        "context": "date}}",
        "offset": 29,
        "explanation": "The tag ending with \"date}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{uppe",
        "id": "duplicate_open_tag",
        "context": "{{uppe",
        "offset": 42,
        "explanation": "The tag beginning with \"{{uppe\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "atus}}",
        "id": "duplicate_close_tag",
        "context": "atus}}",
        "offset": 56,
        "explanation": "The tag ending with \"atus}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    }
  ]
}

[90mstdout[2m | tests/unit/docxRenderer.test.ts[2m > [22m[2mDOCX Renderer Service[2m > [22m[2mrenderDocx[2m > [22m[2mshould render a template with simple data
[22m[39m{
  "error": [
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{clie",
        "id": "duplicate_open_tag",
        "context": "{{clie",
        "offset": 6,
        "explanation": "The tag beginning with \"{{clie\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "name}}",
        "id": "duplicate_close_tag",
        "context": "name}}",
        "offset": 19,
        "explanation": "The tag ending with \"name}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{amou",
        "id": "duplicate_open_tag",
        "context": "{{amou",
        "offset": 45,
        "explanation": "The tag beginning with \"{{amou\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "ount}}",
        "id": "duplicate_close_tag",
        "context": "ount}}",
        "offset": 53,
        "explanation": "The tag ending with \"ount}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    }
  ]
}

[90mstdout[2m | tests/unit/docxRenderer.test.ts[2m > [22m[2mDOCX Renderer Service[2m > [22m[2mrenderDocx[2m > [22m[2mshould use formatters in templates
[22m[39m{
  "error": [
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{name",
        "id": "duplicate_open_tag",
        "context": "{{name",
        "offset": 6,
        "explanation": "The tag beginning with \"{{name\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "name}}",
        "id": "duplicate_close_tag",
        "context": "name}}",
        "offset": 12,
        "explanation": "The tag ending with \"name}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{date",
        "id": "duplicate_open_tag",
        "context": "{{date",
        "offset": 23,
        "explanation": "The tag beginning with \"{{date\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "date}}",
        "id": "duplicate_close_tag",
        "context": "date}}",
        "offset": 29,
        "explanation": "The tag ending with \"date}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{uppe",
        "id": "duplicate_open_tag",
        "context": "{{uppe",
        "offset": 42,
        "explanation": "The tag beginning with \"{{uppe\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "atus}}",
        "id": "duplicate_close_tag",
        "context": "atus}}",
        "offset": 56,
        "explanation": "The tag ending with \"atus}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    }
  ]
}

[90mstdout[2m | tests/unit/docxRenderer.test.ts[2m > [22m[2mDOCX Renderer Service[2m > [22m[2mrenderDocx[2m > [22m[2mshould handle missing data gracefully
[22m[39m{
  "error": [
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{clie",
        "id": "duplicate_open_tag",
        "context": "{{clie",
        "offset": 6,
        "explanation": "The tag beginning with \"{{clie\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "name}}",
        "id": "duplicate_close_tag",
        "context": "name}}",
        "offset": 19,
        "explanation": "The tag ending with \"name}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{amou",
        "id": "duplicate_open_tag",
        "context": "{{amou",
        "offset": 45,
        "explanation": "The tag beginning with \"{{amou\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "ount}}",
        "id": "duplicate_close_tag",
        "context": "ount}}",
        "offset": 53,
        "explanation": "The tag ending with \"ount}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    }
  ]
}

[90mstdout[2m | tests/unit/docxRenderer.test.ts[2m > [22m[2mDOCX Renderer Service[2m > [22m[2mrenderDocx[2m > [22m[2mshould use custom output name
[22m[39m{
  "error": [
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{clie",
        "id": "duplicate_open_tag",
        "context": "{{clie",
        "offset": 6,
        "explanation": "The tag beginning with \"{{clie\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "name}}",
        "id": "duplicate_close_tag",
        "context": "name}}",
        "offset": 19,
        "explanation": "The tag ending with \"name}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{amou",
        "id": "duplicate_open_tag",
        "context": "{{amou",
        "offset": 45,
        "explanation": "The tag beginning with \"{{amou\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "ount}}",
        "id": "duplicate_close_tag",
        "context": "ount}}",
        "offset": 53,
        "explanation": "The tag ending with \"ount}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    }
  ]
}

[90mstdout[2m | tests/unit/docxRenderer.test.ts[2m > [22m[2mDOCX Renderer Service[2m > [22m[2mPDF conversion[2m > [22m[2mshould attempt PDF conversion when requested
[22m[39m{
  "error": [
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{clie",
        "id": "duplicate_open_tag",
        "context": "{{clie",
        "offset": 6,
        "explanation": "The tag beginning with \"{{clie\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "name}}",
        "id": "duplicate_close_tag",
        "context": "name}}",
        "offset": 19,
        "explanation": "The tag ending with \"name}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate open tag, expected one open tag",
      "stack": "Error: Duplicate open tag, expected one open tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateOpenTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:83:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:136:23\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "{{amou",
        "id": "duplicate_open_tag",
        "context": "{{amou",
        "offset": 45,
        "explanation": "The tag beginning with \"{{amou\" has duplicate open tags",
        "file": "word/document.xml"
      }
    },
    {
      "name": "TemplateError",
      "message": "Duplicate close tag, expected one close tag",
      "stack": "Error: Duplicate close tag, expected one close tag\n    at new XTTemplateError (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:21:16)\n    at getDuplicateCloseTagException (/home/user/VaultLogic/node_modules/docxtemplater/js/errors.js:95:13)\n    at /home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:166:21\n    at Array.reduce (<anonymous>)\n    at getDelimiterErrors (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:126:46)\n    at parseDelimiters (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:333:29)\n    at Object.parse (/home/user/VaultLogic/node_modules/docxtemplater/js/lexer.js:424:28)\n    at XmlTemplater.preparse (/home/user/VaultLogic/node_modules/docxtemplater/js/xml-templater.js:124:32)\n    at Docxtemplater.precompileFile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:409:19)\n    at Docxtemplater.compile (/home/user/VaultLogic/node_modules/docxtemplater/js/docxtemplater.js:511:16)",
      "properties": {
        "xtag": "ount}}",
        "id": "duplicate_close_tag",
        "context": "ount}}",
        "offset": 53,
        "explanation": "The tag ending with \"ount}}\" has duplicate close tags",
        "file": "word/document.xml"
      }
    }
  ]
}

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/docxRenderer.test.ts [2m([22m[2m12 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[32m 130[2mms[22m[39m
[31m       [31mÃ—[31m should extract placeholders from a template[39m[32m 34[2mms[22m[39m
[31m       [31mÃ—[31m should extract placeholders including formatters[39m[32m 7[2mms[22m[39m
       [32mâœ“[39m should throw error if template does not exist[32m 3[2mms[22m[39m
       [32mâœ“[39m should validate complete data[32m 1[2mms[22m[39m
       [32mâœ“[39m should detect missing data[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should allow formatters as valid placeholders[39m[32m 6[2mms[22m[39m
[31m       [31mÃ—[31m should render a template with simple data[39m[32m 8[2mms[22m[39m
[31m       [31mÃ—[31m should use formatters in templates[39m[32m 8[2mms[22m[39m
[31m       [31mÃ—[31m should handle missing data gracefully[39m[32m 8[2mms[22m[39m
       [32mâœ“[39m should throw error if template does not exist[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should use custom output name[39m[32m 6[2mms[22m[39m
[31m       [31mÃ—[31m should attempt PDF conversion when requested[39m[32m 6[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/docxHelpers.test.ts [2m([22m[2m39 tests[22m[2m)[22m[32m 36[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1763474938169,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/services/DatavaultColumnsService.test.ts [2m([22m[2m9 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 22[2mms[22m[39m
[31m       [31mÃ—[31m should get all columns for a table[39m[32m 6[2mms[22m[39m
[31m       [31mÃ—[31m should throw 404 if table not found[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should create column with generated slug[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should ensure unique slug by appending counter[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should use provided slug if given[39m[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should update column[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if trying to change column type[39m[32m 7[2mms[22m[39m
[31m       [31mÃ—[31m should delete column[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should reorder columns[39m[32m 1[2mms[22m[39m
 [31mâ¯[39m tests/unit/services/WorkflowService.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[32m 36[2mms[22m[39m
[31m       [31mÃ—[31m should return workflow if user is the creator[39m[32m 10[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if workflow not found[39m[32m 7[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if user is not the creator[39m[32m 2[2mms[22m[39m
       [32mâœ“[39m should create workflow with default first section[32m 3[2mms[22m[39m
[31m       [31mÃ—[31m should return workflow with sections, steps, and logic rules[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if user does not own workflow[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should return all workflows for a user[32m 1[2mms[22m[39m
       [32mâœ“[39m should return empty array if user has no workflows[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should update workflow if user is the owner[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if user does not own workflow[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should delete workflow if user is the owner[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if user does not own workflow[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should change workflow status to open[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should change workflow status to closed[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should throw error if user does not own workflow[39m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/utils/pagination.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 20[2mms[22m[39m
{"level":30,"time":1763474939203,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
[90mstdout[2m | tests/collab.server.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1763474939352,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/docxRenderer2.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 17[2mms[22m[39m
{"level":30,"time":1763474939612,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.stage8.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":30,"time":1763474939627,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1763474939629,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1763474939631,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1763474939620,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474939620,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474939620,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474939620,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1763474939635,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474939635,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474939635,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474939635,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1763474939637,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474939637,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474939637,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474939637,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1763474939638,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474939639,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474939639,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474939639,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.runs.stage8.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":30,"time":1763474939679,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939679,"env":"test","module":"auth","email":"success@example.com","msg":"Token verified successfully"}
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":50,"time":1763474939688,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-success","userEmail":"success@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474939689,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"http://localhost:5000","msg":"Google authentication failed"}
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1763474939709,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939709,"env":"test","module":"auth","email":"tokenfield@example.com","msg":"Token verified successfully"}
{"level":50,"time":1763474939713,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-token-field","userEmail":"tokenfield@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474939713,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"http://localhost:5000","msg":"Google authentication failed"}
 [31mâ¯[39m tests/unit/repositories/DatavaultRowsRepository.test.ts [2m([22m[2m13 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[32m 30[2mms[22m[39m
       [32mâœ“[39m should find rows by table ID[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should support limit and offset[39m[32m 6[2mms[22m[39m
       [32mâœ“[39m should find row by ID[32m 1[2mms[22m[39m
       [32mâœ“[39m should return undefined if row not found[32m 1[2mms[22m[39m
       [32mâœ“[39m should create a new row[32m 1[2mms[22m[39m
       [32mâœ“[39m should delete a row[32m 1[2mms[22m[39m
       [32mâœ“[39m should count rows by table ID[32m 1[2mms[22m[39m
       [32mâœ“[39m should return 0 if no rows found[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should create row and values in transaction[39m[32m 2[2mms[22m[39m
       [32mâœ“[39m should handle empty values array[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should get rows with their values[39m[32m 10[2mms[22m[39m
[31m       [31mÃ—[31m should upsert row values[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should handle empty values array[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/auth-jwt.integration.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":30,"time":1763474939719,"env":"test","module":"auth","hasToken":true,"ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":40,"time":1763474939719,"env":"test","module":"auth","msg":"OAuth2 login failed: Invalid origin"}
{"level":30,"time":1763474939721,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1763474939725,"env":"test","module":"auth","hasToken":true,"origin":"https://malicious-site.com","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":40,"time":1763474939725,"env":"test","module":"auth","origin":"https://malicious-site.com","msg":"OAuth2 login failed: Invalid origin"}
{"level":30,"time":1763474939730,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939730,"env":"test","module":"auth","email":"localhost@example.com","msg":"Token verified successfully"}
{"level":50,"time":1763474939732,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-localhost","userEmail":"localhost@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474939733,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939737,"env":"test","module":"auth","hasToken":true,"ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939737,"env":"test","module":"auth","email":"referer@example.com","msg":"Token verified successfully"}
 [31mâ¯[39m tests/unit/services/DatavaultTablesService.test.ts [2m([22m[2m12 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 26[2mms[22m[39m
[31m       [31mÃ—[31m should get all tables for a tenant[39m[32m 6[2mms[22m[39m
[31m       [31mÃ—[31m should get tables with stats when requested[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should get a table by ID[32m 2[2mms[22m[39m
       [32mâœ“[39m should throw 404 if table not found[32m 2[2mms[22m[39m
[31m       [31mÃ—[31m should throw 403 if table belongs to different tenant[39m[32m 5[2mms[22m[39m
       [32mâœ“[39m should create table with generated slug[32m 1[2mms[22m[39m
       [32mâœ“[39m should ensure unique slug by appending counter[32m 1[2mms[22m[39m
       [32mâœ“[39m should use provided slug if given[32m 0[2mms[22m[39m
       [32mâœ“[39m should update table[32m 0[2mms[22m[39m
       [32mâœ“[39m should throw 404 if table not found[32m 0[2mms[22m[39m
       [32mâœ“[39m should delete table[32m 5[2mms[22m[39m
       [32mâœ“[39m should throw 404 if table not found[32m 0[2mms[22m[39m
 [31mâ¯[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[33m17 skipped[39m[2m)[22m[32m 37[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new draft workflow
       [2m[90mâ†“[39m[22m should reject without permission
       [2m[90mâ†“[39m[22m should list workflows
       [2m[90mâ†“[39m[22m should filter by status
       [2m[90mâ†“[39m[22m should search by name
       [2m[90mâ†“[39m[22m should update draft workflow
       [2m[90mâ†“[39m[22m should not allow editing published workflow
       [2m[90mâ†“[39m[22m should publish workflow
       [2m[90mâ†“[39m[22m should list workflow versions
       [2m[90mâ†“[39m[22m should move workflow to a project
       [2m[90mâ†“[39m[22m should move workflow to Main Folder (projectId = null)
       [2m[90mâ†“[39m[22m should reject move to non-existent project
       [2m[90mâ†“[39m[22m should reject move without authentication
       [2m[90mâ†“[39m[22m should reject move of workflow user does not own
       [2m[90mâ†“[39m[22m should reject move with invalid projectId format
       [2m[90mâ†“[39m[22m should reject move without projectId in body
       [2m[90mâ†“[39m[22m should reject move to project user does not have access to
 [31mâ¯[39m tests/integration/api.runs.stage8.test.ts [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[32m 35[2mms[22m[39m
       [2m[90mâ†“[39m[22m should list all runs with pagination
       [2m[90mâ†“[39m[22m should filter runs by status
       [2m[90mâ†“[39m[22m should filter runs by workflow
       [2m[90mâ†“[39m[22m should filter runs by project
       [2m[90mâ†“[39m[22m should filter runs by date range
       [2m[90mâ†“[39m[22m should search runs by query string
       [2m[90mâ†“[39m[22m should get run by ID with all details
       [2m[90mâ†“[39m[22m should return 404 for non-existent run
       [2m[90mâ†“[39m[22m should get logs for a run
       [2m[90mâ†“[39m[22m should re-run workflow with same inputs
       [2m[90mâ†“[39m[22m should re-run workflow with override inputs
       [2m[90mâ†“[39m[22m should return 404 for non-existent run
       [2m[90mâ†“[39m[22m should export runs to CSV
       [2m[90mâ†“[39m[22m should export runs with filters applied
       [2m[90mâ†“[39m[22m should compare two runs
       [2m[90mâ†“[39m[22m should identify changed input keys
       [2m[90mâ†“[39m[22m should return 404 if run A not found
       [2m[90mâ†“[39m[22m should return 404 if run B not found
       [2m[90mâ†“[39m[22m should enforce tenant isolation on runs list
 [31mâ¯[39m tests/integration/api.templates-runs.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m[32m 34[2mms[22m[39m
         [2m[90mâ†“[39m[22m should create template with file upload
         [2m[90mâ†“[39m[22m should reject non-docx files
         [2m[90mâ†“[39m[22m should reject without file
         [2m[90mâ†“[39m[22m should list templates
         [2m[90mâ†“[39m[22m should get template by ID
         [2m[90mâ†“[39m[22m should extract placeholders
         [2m[90mâ†“[39m[22m should update template name
         [2m[90mâ†“[39m[22m should delete template
         [2m[90mâ†“[39m[22m should execute workflow
         [2m[90mâ†“[39m[22m should include logs in debug mode
         [2m[90mâ†“[39m[22m should reject without required permission
         [2m[90mâ†“[39m[22m should list runs
         [2m[90mâ†“[39m[22m should filter by workflowId
         [2m[90mâ†“[39m[22m should get run by ID
         [2m[90mâ†“[39m[22m should get run logs
{"level":30,"time":1763474939729,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474939729,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474939729,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474939729,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":50,"time":1763474939790,"env":"test","module":"auth-routes","error":{"errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"msg":"Registration failed"}
{"level":50,"time":1763474939818,"env":"test","module":"auth-routes","error":{"errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"msg":"Registration failed"}
{"level":50,"time":1763474939824,"env":"test","module":"auth-routes","error":{"errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"msg":"Registration failed"}
{"level":50,"time":1763474939829,"env":"test","module":"auth-routes","error":{"errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"msg":"Registration failed"}
{"level":30,"time":1763474939833,"env":"test","module":"auth","msg":"User logged out"}
{"level":50,"time":1763474939838,"env":"test","module":"auth-routes","error":{"errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/auth-jwt.integration.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":50,"time":1763474939843,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-referer","userEmail":"referer@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474939843,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","msg":"Google authentication failed"}
{"level":30,"time":1763474939848,"env":"test","module":"auth","hasToken":true,"origin":"https://app.example.com","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939848,"env":"test","module":"auth","email":"allowed@example.com","msg":"Token verified successfully"}
{"level":50,"time":1763474939851,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-allowed","userEmail":"allowed@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474939851,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"https://app.example.com","msg":"Google authentication failed"}
{"level":30,"time":1763474939856,"env":"test","module":"auth","hasToken":false,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":40,"time":1763474939856,"env":"test","module":"auth","msg":"OAuth2 login failed: No token provided"}
{"level":30,"time":1763474939861,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":50,"time":1763474939861,"env":"test","module":"auth","err":{"type":"Error","message":"Token used too late, exp=1234567890","stack":"Error: Token used too late, exp=1234567890\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:300:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"msg":"Google token verification failed"}
{"level":50,"time":1763474939861,"env":"test","module":"auth","err":{"type":"Error","message":"Token used too late, exp=1234567890","stack":"Error: Token used too late, exp=1234567890\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:300:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"errorCode":"token_expired","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939866,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":50,"time":1763474939866,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token signature","stack":"Error: Invalid token signature\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:315:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"msg":"Google token verification failed"}
{"level":50,"time":1763474939866,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token signature","stack":"Error: Invalid token signature\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:315:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"errorCode":"invalid_token_signature","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939871,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":50,"time":1763474939871,"env":"test","module":"auth","err":{"type":"Error","message":"Wrong number of segments in token: abc","stack":"Error: Wrong number of segments in token: abc\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:329:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"msg":"Google token verification failed"}
{"level":50,"time":1763474939871,"env":"test","module":"auth","err":{"type":"Error","message":"Wrong number of segments in token: abc","stack":"Error: Wrong number of segments in token: abc\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:329:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"errorCode":"malformed_token","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939876,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":50,"time":1763474939876,"env":"test","module":"auth","err":{"type":"Error","message":"Token audience mismatch","stack":"Error: Token audience mismatch\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:343:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"hint":"Token audience mismatch - check GOOGLE_CLIENT_ID configuration","msg":"Google token verification failed"}
{"level":50,"time":1763474939876,"env":"test","module":"auth","err":{"type":"Error","message":"Token audience mismatch","stack":"Error: Token audience mismatch\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:343:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"errorCode":"audience_mismatch","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939880,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":40,"time":1763474939880,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1763474939880,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (/home/user/VaultLogic/server/googleAuth.ts:168:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:295:23"},"msg":"Google token verification failed"}
{"level":50,"time":1763474939881,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (/home/user/VaultLogic/server/googleAuth.ts:168:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:295:23"},"errorCode":"email_not_verified","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939894,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":50,"time":1763474939894,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid issuer","stack":"Error: Invalid issuer\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:382:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"hint":"Invalid issuer - token may not be from Google","msg":"Google token verification failed"}
{"level":50,"time":1763474939894,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid issuer","stack":"Error: Invalid issuer\n    at /home/user/VaultLogic/tests/integration/auth-oauth.integration.test.ts:382:9\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:157:11\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:753:26\n    at file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1636:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1602:10)\n    at runTest (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1309:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)\n    at runSuite (file:///home/user/VaultLogic/node_modules/@vitest/runner/dist/index.js:1468:8)"},"errorCode":"invalid_issuer","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939899,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939899,"env":"test","module":"auth","email":"session@example.com","msg":"Token verified successfully"}
{"level":50,"time":1763474939935,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-session","userEmail":"session@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474939936,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"http://localhost:5000","msg":"Google authentication failed"}
 [31mâ¯[39m tests/integration/auth-jwt.integration.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m | [22m[33m11 skipped[39m[2m)[22m[32m 126[2mms[22m[39m
[31m       [31mÃ—[31m should register a new user with email and password[39m[32m 68[2mms[22m[39m
       [32mâœ“[39m should reject registration with weak password[32m 6[2mms[22m[39m
       [32mâœ“[39m should reject registration with invalid email[32m 4[2mms[22m[39m
       [32mâœ“[39m should reject registration with missing fields[32m 4[2mms[22m[39m
[31m       [31mÃ—[31m should reject duplicate email registration[39m[32m 6[2mms[22m[39m
       [2m[90mâ†“[39m[22m should login with valid credentials
       [2m[90mâ†“[39m[22m should reject login with wrong password
       [2m[90mâ†“[39m[22m should reject login with non-existent email
       [2m[90mâ†“[39m[22m should reject login with missing fields
       [2m[90mâ†“[39m[22m should return current user with valid token
       [2m[90mâ†“[39m[22m should reject request without token
       [2m[90mâ†“[39m[22m should reject request with invalid token
       [32mâœ“[39m should logout successfully[32m 4[2mms[22m[39m
       [2m[90mâ†“[39m[22m should allow owner to access tenant information
       [2m[90mâ†“[39m[22m should allow builder to access tenant information
       [2m[90mâ†“[39m[22m should allow viewer to access tenant information
       [2m[90mâ†“[39m[22m should only allow owner to update tenant
{"level":30,"time":1763474939942,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939943,"env":"test","module":"auth","email":"protected@example.com","msg":"Token verified successfully"}
{"level":50,"time":1763474939983,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-protected","userEmail":"protected@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474939984,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939989,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939990,"env":"test","module":"auth","email":"multiple@example.com","msg":"Token verified successfully"}
{"level":50,"time":1763474939992,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-multiple","userEmail":"multiple@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474939993,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474939998,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474939998,"env":"test","module":"auth","email":"logout@example.com","msg":"Token verified successfully"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":50,"time":1763474940001,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-logout","userEmail":"logout@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474940002,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"http://localhost:5000","msg":"Google authentication failed"}
{"level":30,"time":1763474940006,"env":"test","module":"auth","hasToken":true,"origin":"http://localhost:5000","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":30,"time":1763474940007,"env":"test","module":"auth","email":"cookieclear@example.com","msg":"Token verified successfully"}
{"level":50,"time":1763474940025,"env":"test","module":"auth","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///home/user/VaultLogic/node_modules/drizzle-orm/node-postgres/session.js:83:22\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:106:29)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"userId":"google-user-cookie-clear","userEmail":"cookieclear@example.com","msg":"Failed to upsert user during authentication"}
{"level":50,"time":1763474940026,"env":"test","module":"auth","err":{"type":"Error","message":"Failed to create or update user account","stack":"Error: Failed to create or update user account\n    at upsertUser (/home/user/VaultLogic/server/googleAuth.ts:134:11)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at /home/user/VaultLogic/server/googleAuth.ts:302:7"},"errorCode":"unknown_error","origin":"http://localhost:5000","msg":"Google authentication failed"}
[90mstdout[2m | tests/integration/auth-oauth.integration.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mðŸ§ª Setting up test environment...

 [31mâ¯[39m tests/integration/auth-oauth.integration.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 6795[2mms[22m[39m
[31m       [31mÃ—[31m should successfully authenticate with valid Google token and origin[39m[32m 81[2mms[22m[39m
[31m       [31mÃ—[31m should accept both 'token' and 'idToken' field names[39m[32m 11[2mms[22m[39m
       [32mâœ“[39m should reject requests without Origin or Referer header[32m 6[2mms[22m[39m
       [32mâœ“[39m should reject requests from unauthorized origins[32m 5[2mms[22m[39m
[31m       [31mÃ—[31m should accept requests from localhost variants[39m[32m 8[2mms[22m[39m
[31m       [31mÃ—[31m should accept Referer header when Origin is missing[39m[32m 111[2mms[22m[39m
[31m       [31mÃ—[31m should accept requests from ALLOWED_ORIGIN environment variable[39m[32m 8[2mms[22m[39m
       [32mâœ“[39m should return 400 when token is missing[32m 5[2mms[22m[39m
       [32mâœ“[39m should categorize expired token errors[32m 5[2mms[22m[39m
       [32mâœ“[39m should categorize invalid signature errors[32m 5[2mms[22m[39m
       [32mâœ“[39m should categorize malformed token errors[32m 5[2mms[22m[39m
       [32mâœ“[39m should categorize audience mismatch as configuration error[32m 5[2mms[22m[39m
       [32mâœ“[39m should reject unverified email[32m 13[2mms[22m[39m
       [32mâœ“[39m should categorize invalid issuer errors[32m 5[2mms[22m[39m
[31m       [31mÃ—[31m should regenerate session ID on login (session fixation protection)[39m[32m 43[2mms[22m[39m
[31m       [31mÃ—[31m should allow accessing protected routes after authentication[39m[32m 47[2mms[22m[39m
[31m       [31mÃ—[31m should maintain session across multiple requests[39m[32m 9[2mms[22m[39m
[31m       [31mÃ—[31m should successfully logout and destroy session[39m[32m 9[2mms[22m[39m
[31m       [31mÃ—[31m should clear session cookie on logout[39m[32m 25[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/integration/api.ai.test.ts [2m([22m[2m32 tests[22m[2m)[22m[32m 11[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/routes/US-AN-042-export-results.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/utils/variableResolver.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 12[2mms[22m[39m
 [31mâ¯[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts [2m([22m[2m13 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 22[2mms[22m[39m
       [32mâœ“[39m should find columns by table ID in order[32m 4[2mms[22m[39m
       [32mâœ“[39m should return empty array if no columns found[32m 1[2mms[22m[39m
       [32mâœ“[39m should find column by ID[32m 0[2mms[22m[39m
       [32mâœ“[39m should return undefined if column not found[32m 0[2mms[22m[39m
       [32mâœ“[39m should return true if slug exists[32m 1[2mms[22m[39m
       [32mâœ“[39m should return false if slug does not exist[32m 0[2mms[22m[39m
       [32mâœ“[39m should exclude specific column ID when checking slug[32m 0[2mms[22m[39m
       [32mâœ“[39m should create a new column[32m 1[2mms[22m[39m
       [32mâœ“[39m should update an existing column[32m 0[2mms[22m[39m
       [32mâœ“[39m should delete a column[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should update order indices for multiple columns[39m[32m 6[2mms[22m[39m
[31m       [31mÃ—[31m should return max order index[39m[32m 5[2mms[22m[39m
[31m       [31mÃ—[31m should return 0 if no columns exist[39m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/captcha.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 12[2mms[22m[39m
{"level":30,"time":1763474940666,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/ui/builder.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[32m 16[2mms[22m[39m
[31m     [31mÃ—[31m should add a question node[39m[32m 9[2mms[22m[39m
[31m     [31mÃ—[31m should add a compute node[39m[32m 1[2mms[22m[39m
     [32mâœ“[39m should export graph in correct format[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should load graph from API format[39m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":30,"time":1763474940939,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1763474940940,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1763474940946,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474940946,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474940947,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474940947,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1763474940948,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474940948,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474940948,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474940949,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1763474941010,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mðŸ§ª Setting up test environment...

 [31mâ¯[39m tests/integration/api.expression-validation.test.ts [2m([22m[2m13 tests[22m[2m | [22m[33m13 skipped[39m[2m)[22m[32m 38[2mms[22m[39m
       [2m[90mâ†“[39m[22m should validate a correct expression
       [2m[90mâ†“[39m[22m should reject expression with unknown variable
       [2m[90mâ†“[39m[22m should validate expression with helper function
       [2m[90mâ†“[39m[22m should reject invalid syntax
       [2m[90mâ†“[39m[22m should reject without authentication
       [2m[90mâ†“[39m[22m should reject missing required fields
       [2m[90mâ†“[39m[22m should return available variables for a node
       [2m[90mâ†“[39m[22m should return empty array for first node
       [2m[90mâ†“[39m[22m should reject without authentication
       [2m[90mâ†“[39m[22m should reject non-existent workflow
       [2m[90mâ†“[39m[22m should return list of helper functions
       [2m[90mâ†“[39m[22m should reject without authentication
       [2m[90mâ†“[39m[22m should validate expressions with variables from multiple upstream nodes
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/integration/api.runs.docx.test.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[32m 47[2mms[22m[39m
       [2m[90mâ†“[39m[22m should execute workflow with template node and generate DOCX
       [2m[90mâ†“[39m[22m should handle missing template data gracefully
       [2m[90mâ†“[39m[22m should download DOCX output from successful run
       [2m[90mâ†“[39m[22m should return 404 for PDF when not generated
       [2m[90mâ†“[39m[22m should return 404 for non-existent run
       [2m[90mâ†“[39m[22m should extract placeholders from uploaded template
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [32mâœ“[39m tests/unit/utils/conditionalLogic-simple.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/repositories/AnalyticsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/repositories/DatavaultTablesRepository.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/AnalyticsRepository.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/repositories/AnalyticsRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/unit/repositories/AnalyticsRepository.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[32m 20[2mms[22m[39m
       [32mâœ“[39m should track a page view event[32m 3[2mms[22m[39m
       [32mâœ“[39m should track a question answer event with duration[32m 0[2mms[22m[39m
       [32mâœ“[39m should track survey start event[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should get all events for a survey[39m[32m 7[2mms[22m[39m
[31m       [31mÃ—[31m should filter events by type[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should get complete journey for a response[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should aggregate question interaction metrics[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should aggregate page-level metrics[39m[32m 1[2mms[22m[39m
       [32mâœ“[39m should calculate drop-off rates per page[32m 2[2mms[22m[39m
[31m       [31mÃ—[31m should calculate average time from start to complete[39m[32m 1[2mms[22m[39m
[31m       [31mÃ—[31m should return null if no completions[39m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/services/BrandingService.test.ts [2m([22m[2m16 tests[22m[2m)[22m[32m 7[2mms[22m[39m
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1763474941639,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
 [32mâœ“[39m tests/services/EmailTemplateMetadataService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 5[2mms[22m[39m
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":30,"time":1763474941821,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/integration/routes/US-A-001-login.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

{"level":30,"time":1763474941828,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474941828,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474941828,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474941828,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/integration/api.projects.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[32m 34[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new project
       [2m[90mâ†“[39m[22m should reject without authentication
       [2m[90mâ†“[39m[22m should reject with invalid data
       [2m[90mâ†“[39m[22m should list projects for tenant
       [2m[90mâ†“[39m[22m should support pagination
       [2m[90mâ†“[39m[22m should get project by ID
       [2m[90mâ†“[39m[22m should return 404 for non-existent project
       [2m[90mâ†“[39m[22m should update project
       [2m[90mâ†“[39m[22m should soft-delete project
       [2m[90mâ†“[39m[22m should not allow cross-tenant access
[90mstdout[2m | tests/integration/routes/US-AN-042-export-results.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1763474941982,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1763474941990,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474941990,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474941990,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474941990,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1763474941990,"env":"test","msg":"Loading Vite for development..."}
{"level":30,"time":1763474942265,"env":"test","msg":"GEMINI_API_KEY not configured - AI features will be unavailable"}
[90mstdout[2m | tests/integration/routes/US-AN-042-export-results.test.ts
[22m[39mðŸ§ª Setting up test environment...

[90mstdout[2m | tests/integration/routes/US-AN-042-export-results.test.ts
[22m[39mâœ“ Test database initialized

{"level":30,"time":1763474942505,"env":"test","msg":"Vite module loaded, calling setupVite..."}
[90mstdout[2m | tests/integration/auth.integration.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":30,"time":1763474942535,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/integration/routes/US-AN-042-export-results.test.ts
[22m[39mâœ“ Test database cleaned up

[90mstdout[2m | tests/integration/routes/US-AN-042-export-results.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1763474942543,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1763474942543,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1763474942543,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1763474942543,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1763474942579,"env":"test","msg":"Vite setup complete"}
{"level":30,"time":1763474942581,"env":"test","source":"express","msg":"serving on port 5000"}
{"level":30,"time":1763474942604,"env":"test","module":"auth","hasToken":false,"ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":40,"time":1763474942604,"env":"test","module":"auth","msg":"OAuth2 login failed: No token provided"}
{"level":30,"time":1763474942609,"env":"test","module":"auth","hasToken":true,"origin":"https://malicious-site.com","ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":40,"time":1763474942609,"env":"test","module":"auth","origin":"https://malicious-site.com","msg":"OAuth2 login failed: Invalid origin"}
{"level":30,"time":1763474942614,"env":"test","module":"auth","hasToken":true,"ip":"::ffff:127.0.0.1","msg":"OAuth2 login attempt"}
{"level":40,"time":1763474942614,"env":"test","module":"auth","msg":"OAuth2 login failed: Invalid origin"}
{"level":50,"time":1763474942626,"env":"test","err":{"type":"Error","message":"connect ECONNREFUSED 127.0.0.1:5432","stack":"Error: connect ECONNREFUSED 127.0.0.1:5432\n    at /home/user/VaultLogic/node_modules/pg-pool/index.js:45:11\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at UserRepository.ping (/home/user/VaultLogic/server/repositories/UserRepository.ts:143:7)\n    at /home/user/VaultLogic/server/routes.ts:40:27","errno":-111,"code":"ECONNREFUSED","syscall":"connect","address":"127.0.0.1","port":5432},"msg":"Database ping failed"}
[90mstdout[2m | tests/integration/auth.integration.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/integration/routes/US-AN-042-export-results.test.ts [2m([22m[2m9 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 63[2mms[22m[39m
[31m     [31mÃ—[31m should export responses as CSV[39m[32m 24[2mms[22m[39m
[31m     [31mÃ—[31m should export responses as PDF[39m[32m 10[2mms[22m[39m
[31m     [31mÃ—[31m should include all response data in CSV[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should default to CSV format if not specified[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should reject invalid export format[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should prevent exporting other user's surveys[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should export empty CSV if no responses[39m[32m 0[2mms[22m[39m
[31m     [31mÃ—[31m should include anonymous responses in export[39m[32m 1[2mms[22m[39m
[31m     [31mÃ—[31m should handle special characters in responses[39m[32m 1[2mms[22m[39m
 [32mâœ“[39m tests/integration/auth.integration.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 102[2mms[22m[39m
[90mstdout[2m | tests/integration/routes/US-A-001-login.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/routes/US-A-001-login.test.ts
[22m[39mðŸ§ª Setting up test environment...

{"level":30,"time":1763474943171,"env":"test","source":"express","msg":"POST /api/login 404 in 3ms"}
{"level":30,"time":1763474943179,"env":"test","source":"express","msg":"POST /api/login 404 in 0ms"}
{"level":30,"time":1763474943183,"env":"test","source":"express","msg":"POST /api/login 404 in 1ms"}
{"level":30,"time":1763474943185,"env":"test","source":"express","msg":"POST /api/login 404 in 0ms"}
{"level":30,"time":1763474943188,"env":"test","source":"express","msg":"POST /api/login 404 in 0ms"}
{"level":30,"time":1763474943192,"env":"test","source":"express","msg":"POST /api/login 404 in 1ms"}
{"level":30,"time":1763474943195,"env":"test","source":"express","msg":"GET /api/user 404 in 1ms"}
{"level":30,"time":1763474943198,"env":"test","source":"express","msg":"GET /api/user 404 in 1ms"}
{"level":30,"time":1763474943200,"env":"test","source":"express","msg":"POST /api/login 404 in 0ms"}
{"level":30,"time":1763474943202,"env":"test","source":"express","msg":"POST /api/logout 404 in 0ms"}
{"level":30,"time":1763474943205,"env":"test","source":"express","msg":"POST /api/logout 404 in 0ms"}
[90mstdout[2m | tests/integration/routes/US-A-001-login.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/integration/routes/US-A-001-login.test.ts [2m([22m[2m9 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[32m 76[2mms[22m[39m
[31m     [31mÃ—[31m should successfully log in with valid Google ID token[39m[32m 43[2mms[22m[39m
[31m     [31mÃ—[31m should reject login with invalid ID token[39m[32m 4[2mms[22m[39m
[31m     [31mÃ—[31m should reject login with missing ID token[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should create new user on first login[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should retrieve existing user on subsequent logins[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should return current user if authenticated[39m[32m 6[2mms[22m[39m
[31m     [31mÃ—[31m should return 401 if not authenticated[39m[32m 3[2mms[22m[39m
[31m     [31mÃ—[31m should successfully log out authenticated user[39m[32m 5[2mms[22m[39m
[31m     [31mÃ—[31m should handle logout when not logged in[39m[32m 3[2mms[22m[39m
[90mstdout[2m | tests/collab.server.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [31mâ¯[39m tests/collab.server.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 256066[2mms[22m[39m
[31m       [31mÃ—[31m should accept connection with valid JWT token[39m[32m 28[2mms[22m[39m
[31m       [31mÃ—[31m should reject connection without JWT token[39m[33m 2009[2mms[22m[39m
[31m       [31mÃ—[31m should reject connection with invalid JWT token[39m[33m 2002[2mms[22m[39m
[31m       [31mÃ—[31m should reject cross-tenant access[39m[33m 2004[2mms[22m[39m
[31m       [31mÃ—[31m should sync document updates between two clients[39m[33m 30003[2mms[22m[39m
[31m       [31mÃ—[31m should track presence of multiple users[39m[33m 30002[2mms[22m[39m
[31m       [31mÃ—[31m should allow owner to make changes[39m[33m 30001[2mms[22m[39m
[31m       [31mÃ—[31m should allow builder to make changes[39m[33m 30002[2mms[22m[39m
[31m       [31mÃ—[31m should allow viewer to connect but not mutate[39m[33m 30003[2mms[22m[39m
       [32mâœ“[39m should persist document updates to database[32m 0[2mms[22m[39m
       [32mâœ“[39m should create snapshots after N updates[32m 0[2mms[22m[39m
       [32mâœ“[39m should load document from snapshot on reconnect[32m 0[2mms[22m[39m
[31m       [31mÃ—[31m should create room on first connection[39m[33m 30002[2mms[22m[39m
[31m       [31mÃ—[31m should cleanup room when all users disconnect[39m[33m 70002[2mms[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Suites 11 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5432[39m
[90m [2mâ¯[22m node_modules/pg-pool/index.js:[2m45:11[22m[39m
[90m [2mâ¯[22m node_modules/drizzle-orm/node-postgres/session.js:[2m83:22[22m[39m
[36m [2mâ¯[22m tests/integration/api.expression-validation.test.ts:[2m42:22[22m[39m
    [90m 40| [39m
    [90m 41| [39m    [90m// Setup tenant, user, and project[39m
    [90m 42| [39m    [35mconst[39m [tenant] [33m=[39m [35mawait[39m db[33m.[39m[34minsert[39m(schema[33m.[39mtenants)[33m.[39m[34mvalues[39m({
    [90m   | [39m                     [31m^[39m
    [90m 43| [39m      name[33m:[39m [32m"Test Tenant for Expression Validation"[39m[33m,[39m
    [90m 44| [39m      plan[33m:[39m [32m"free"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5432[39m
[90m [2mâ¯[22m node_modules/pg-pool/index.js:[2m45:11[22m[39m
[90m [2mâ¯[22m node_modules/drizzle-orm/node-postgres/session.js:[2m83:22[22m[39m
[36m [2mâ¯[22m tests/integration/api.projects.test.ts:[2m43:22[22m[39m
    [90m 41| [39m
    [90m 42| [39m    [90m// Create test tenant[39m
    [90m 43| [39m    [35mconst[39m [tenant] [33m=[39m [35mawait[39m db[33m.[39m[34minsert[39m(schema[33m.[39mtenants)[33m.[39m[34mvalues[39m({
    [90m   | [39m                     [31m^[39m
    [90m 44| [39m      name[33m:[39m [32m"Test Tenant for Projects"[39m[33m,[39m
    [90m 45| [39m      plan[33m:[39m [32m"free"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.runs.docx.test.ts[2m > [22mRuns API - DOCX Generation Integration Tests
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5432[39m
[90m [2mâ¯[22m node_modules/pg-pool/index.js:[2m45:11[22m[39m
[90m [2mâ¯[22m node_modules/drizzle-orm/node-postgres/session.js:[2m83:22[22m[39m
[36m [2mâ¯[22m tests/integration/api.runs.docx.test.ts:[2m97:22[22m[39m
    [90m 95| [39m
    [90m 96| [39m    [90m// Setup tenant, user, project[39m
    [90m 97| [39m    [35mconst[39m [tenant] [33m=[39m [35mawait[39m db
    [90m   | [39m                     [31m^[39m
    [90m 98| [39m      [33m.[39m[34minsert[39m(schema[33m.[39mtenants)
    [90m 99| [39m      [33m.[39m[34mvalues[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.runs.stage8.test.ts[2m > [22mStage 8: Runs API Integration Tests
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5432[39m
[90m [2mâ¯[22m node_modules/pg-pool/index.js:[2m45:11[22m[39m
[90m [2mâ¯[22m node_modules/drizzle-orm/node-postgres/session.js:[2m83:22[22m[39m
[36m [2mâ¯[22m tests/integration/api.runs.stage8.test.ts:[2m46:22[22m[39m
    [90m 44| [39m
    [90m 45| [39m    [90m// Setup tenant[39m
    [90m 46| [39m    [35mconst[39m [tenant] [33m=[39m [35mawait[39m db[33m.[39m[34minsert[39m(schema[33m.[39mtenants)[33m.[39m[34mvalues[39m({
    [90m   | [39m                     [31m^[39m
    [90m 47| [39m      name[33m:[39m [32m"Test Tenant for Runs Stage 8"[39m[33m,[39m
    [90m 48| [39m      plan[33m:[39m [32m"pro"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5432[39m
[90m [2mâ¯[22m node_modules/pg-pool/index.js:[2m45:11[22m[39m
[90m [2mâ¯[22m node_modules/drizzle-orm/node-postgres/session.js:[2m83:22[22m[39m
[36m [2mâ¯[22m tests/integration/api.templates-runs.test.ts:[2m44:22[22m[39m
    [90m 42| [39m
    [90m 43| [39m    [90m// Setup tenant, user, project, and workflow[39m
    [90m 44| [39m    [35mconst[39m [tenant] [33m=[39m [35mawait[39m db[33m.[39m[34minsert[39m(schema[33m.[39mtenants)[33m.[39m[34mvalues[39m({
    [90m   | [39m                     [31m^[39m
    [90m 45| [39m      name[33m:[39m [32m"Test Tenant for Templates"[39m[33m,[39m
    [90m 46| [39m      plan[33m:[39m [32m"free"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5432[39m
[90m [2mâ¯[22m node_modules/pg-pool/index.js:[2m45:11[22m[39m
[90m [2mâ¯[22m node_modules/drizzle-orm/node-postgres/session.js:[2m83:22[22m[39m
[36m [2mâ¯[22m tests/integration/api.workflows.test.ts:[2m41:22[22m[39m
    [90m 39| [39m
    [90m 40| [39m    [90m// Setup tenant, user, and project[39m
    [90m 41| [39m    [35mconst[39m [tenant] [33m=[39m [35mawait[39m db[33m.[39m[34minsert[39m(schema[33m.[39mtenants)[33m.[39m[34mvalues[39m({
    [90m   | [39m                     [31m^[39m
    [90m 42| [39m      name[33m:[39m [32m"Test Tenant for Workflows"[39m[33m,[39m
    [90m 43| [39m      plan[33m:[39m [32m"free"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-jwt.integration.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mPOST /api/auth/login
[31m[1mError[22m: expected 201 "Created", got 500 "Internal Server Error"[39m
[36m [2mâ¯[22m tests/integration/auth-jwt.integration.test.ts:[2m146:10[22m[39m
    [90m144| [39m          lastName[33m:[39m [32m"Test"[39m[33m,[39m
    [90m145| [39m        })
    [90m146| [39m        [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m147| [39m    })[33m;[39m
    [90m148| [39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-jwt.integration.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mGET /api/auth/me
[31m[1mError[22m: expected 201 "Created", got 500 "Internal Server Error"[39m
[36m [2mâ¯[22m tests/integration/auth-jwt.integration.test.ts:[2m211:10[22m[39m
    [90m209| [39m          lastName[33m:[39m [32m"Test"[39m[33m,[39m
    [90m210| [39m        })
    [90m211| [39m        [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m212| [39m
    [90m213| [39m      authToken [33m=[39m registerResponse[33m.[39mbody[33m.[39mtoken[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-jwt.integration.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mRBAC and Tenant Tests
[31m[1mError[22m: expected 201 "Created", got 500 "Internal Server Error"[39m
[36m [2mâ¯[22m tests/integration/auth-jwt.integration.test.ts:[2m278:10[22m[39m
    [90m276| [39m          tenantRole[33m:[39m [32m"owner"[39m[33m,[39m
    [90m277| [39m        })
    [90m278| [39m        [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m279| [39m
    [90m280| [39m      ownerToken [33m=[39m ownerRegisterResponse[33m.[39mbody[33m.[39mtoken[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5432[39m
[90m [2mâ¯[22m node_modules/pg-pool/index.js:[2m45:11[22m[39m
[90m [2mâ¯[22m node_modules/drizzle-orm/node-postgres/session.js:[2m83:22[22m[39m
[36m [2mâ¯[22m tests/integration/collections.e2e.test.ts:[2m25:22[22m[39m
    [90m 23| [39m  [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 24| [39m    [90m// Create test tenant[39m
    [90m 25| [39m    [35mconst[39m [tenant] [33m=[39m [35mawait[39m db[33m.[39m[34minsert[39m(tenants)[33m.[39m[34mvalues[39m({
    [90m   | [39m                     [31m^[39m
    [90m 26| [39m      name[33m:[39m [32m'E2E Test Tenant'[39m[33m,[39m
    [90m 27| [39m    })[33m.[39m[34mreturning[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/ui/expression-editor.test.ts[2m [ tests/ui/expression-editor.test.ts ][22m
[31m[1mError[22m: Transform failed with 1 error:
/home/user/VaultLogic/tests/ui/expression-editor.test.ts:22:25: ERROR: Expected ">" but found "client"[39m
  Plugin: [35mvite:esbuild[39m
  File: [36m/home/user/VaultLogic/tests/ui/expression-editor.test.ts[39m:22:25
[33m  
  Expected ">" but found "client"
  20 |  
  21 |    return ({ children }: { children: React.ReactNode }) => (
  22 |      <QueryClientProvider client={queryClient}>
     |                           ^
  23 |        {children}
  24 |      </QueryClientProvider>
  [39m
[90m [2mâ¯[22m failureErrorWithLog node_modules/esbuild/lib/main.js:[2m1467:15[22m[39m
[90m [2mâ¯[22m node_modules/esbuild/lib/main.js:[2m736:50[22m[39m
[90m [2mâ¯[22m responseCallbacks.<computed> node_modules/esbuild/lib/main.js:[2m603:9[22m[39m
[90m [2mâ¯[22m handleIncomingPacket node_modules/esbuild/lib/main.js:[2m658:12[22m[39m
[90m [2mâ¯[22m Socket.readFromStdout node_modules/esbuild/lib/main.js:[2m581:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/142]âŽ¯[22m[39m


[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 131 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mAuthentication[2m > [22mshould accept connection with valid JWT token
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mAuthentication[2m > [22mshould reject connection without JWT token
[31m[1mAssertionError[22m: expected 2 to be 3 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 2[39m

[36m [2mâ¯[22m tests/collab.server.test.ts:[2m76:29[22m[39m
    [90m 74| [39m      })[33m;[39m
    [90m 75| [39m
    [90m 76| [39m      [34mexpect[39m(ws[33m.[39mreadyState)[33m.[39m[34mtoBe[39m([33mWebSocket[39m[33m.[39m[33mCLOSED[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 77| [39m    })[33m;[39m
    [90m 78| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mAuthentication[2m > [22mshould reject connection with invalid JWT token
[31m[1mAssertionError[22m: expected 2 to be 3 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 2[39m

[36m [2mâ¯[22m tests/collab.server.test.ts:[2m88:29[22m[39m
    [90m 86| [39m      })[33m;[39m
    [90m 87| [39m
    [90m 88| [39m      [34mexpect[39m(ws[33m.[39mreadyState)[33m.[39m[34mtoBe[39m([33mWebSocket[39m[33m.[39m[33mCLOSED[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m 89| [39m    })[33m;[39m
    [90m 90| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mAuthentication[2m > [22mshould reject cross-tenant access
[31m[1mAssertionError[22m: expected 2 to be 3 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 2[39m

[36m [2mâ¯[22m tests/collab.server.test.ts:[2m100:29[22m[39m
    [90m 98| [39m      })[33m;[39m
    [90m 99| [39m
    [90m100| [39m      [34mexpect[39m(ws[33m.[39mreadyState)[33m.[39m[34mtoBe[39m([33mWebSocket[39m[33m.[39m[33mCLOSED[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m101| [39m    })[33m;[39m
    [90m102| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mMulti-user Collaboration[2m > [22mshould sync document updates between two clients
[31m[1mError[22m: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/collab.server.test.ts:[2m105:5[22m[39m
    [90m103| [39m
    [90m104| [39m  [34mdescribe[39m([32m'Multi-user Collaboration'[39m[33m,[39m () [33m=>[39m {
    [90m105| [39m    it('should sync document updates between two clients', async () =>â€¦
    [90m   | [39m    [31m^[39m
    [90m106| [39m      [35mconst[39m roomKey [33m=[39m [32m'tenant:tenant-test:workflow:workflow-sync-test'[39m[33m;[39m
    [90m107| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mMulti-user Collaboration[2m > [22mshould track presence of multiple users
[31m[1mError[22m: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/collab.server.test.ts:[2m143:5[22m[39m
    [90m141| [39m    })[33m;[39m
    [90m142| [39m
    [90m143| [39m    [34mit[39m([32m'should track presence of multiple users'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m144| [39m      const roomKey = 'tenant:tenant-test:workflow:workflow-presence-tâ€¦
    [90m145| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mRBAC Permissions[2m > [22mshould allow owner to make changes
[31m[1mError[22m: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/collab.server.test.ts:[2m165:5[22m[39m
    [90m163| [39m
    [90m164| [39m  [34mdescribe[39m([32m'RBAC Permissions'[39m[33m,[39m () [33m=>[39m {
    [90m165| [39m    [34mit[39m([32m'should allow owner to make changes'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m166| [39m      const roomKey = 'tenant:tenant-test:workflow:workflow-rbac-ownerâ€¦
    [90m167| [39m      const ws = new WebSocket(`${WS_URL}?room=${roomKey}&token=${owneâ€¦

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mRBAC Permissions[2m > [22mshould allow builder to make changes
[31m[1mError[22m: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/collab.server.test.ts:[2m176:5[22m[39m
    [90m174| [39m    })[33m;[39m
    [90m175| [39m
    [90m176| [39m    [34mit[39m([32m'should allow builder to make changes'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m177| [39m      const roomKey = 'tenant:tenant-test:workflow:workflow-rbac-buildâ€¦
    [90m178| [39m      const ws = new WebSocket(`${WS_URL}?room=${roomKey}&token=${builâ€¦

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mRBAC Permissions[2m > [22mshould allow viewer to connect but not mutate
[31m[1mError[22m: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/collab.server.test.ts:[2m187:5[22m[39m
    [90m185| [39m    })[33m;[39m
    [90m186| [39m
    [90m187| [39m    [34mit[39m([32m'should allow viewer to connect but not mutate'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m188| [39m      const roomKey = 'tenant:tenant-test:workflow:workflow-rbac-vieweâ€¦
    [90m189| [39m      const ws = new WebSocket(`${WS_URL}?room=${roomKey}&token=${viewâ€¦

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mRoom Management[2m > [22mshould create room on first connection
[31m[1mError[22m: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/collab.server.test.ts:[2m220:5[22m[39m
    [90m218| [39m
    [90m219| [39m  [34mdescribe[39m([32m'Room Management'[39m[33m,[39m () [33m=>[39m {
    [90m220| [39m    [34mit[39m([32m'should create room on first connection'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m221| [39m      const roomKey = 'tenant:tenant-test:workflow:workflow-room-creatâ€¦
    [90m222| [39m      const ws = new WebSocket(`${WS_URL}?room=${roomKey}&token=${owneâ€¦

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/collab.server.test.ts[2m > [22mCollaboration Server[2m > [22mRoom Management[2m > [22mshould cleanup room when all users disconnect
[31m[1mError[22m: Test timed out in 70000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".[39m
[36m [2mâ¯[22m tests/collab.server.test.ts:[2m231:5[22m[39m
    [90m229| [39m    })[33m;[39m
    [90m230| [39m
    [90m231| [39m    [34mit[39m([32m'should cleanup room when all users disconnect'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m   | [39m    [31m^[39m
    [90m232| [39m      const roomKey = 'tenant:tenant-test:workflow:workflow-room-cleanâ€¦
    [90m233| [39m      const ws = new WebSocket(`${WS_URL}?room=${roomKey}&token=${owneâ€¦

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould allow helper functions
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/engine.expr.test.ts:[2m19:25[22m[39m
    [90m 17| [39m    [34mit[39m([32m'should allow helper functions'[39m[33m,[39m () [33m=>[39m {
    [90m 18| [39m      const result = validateExpression('round(amount, 2)', ['amount']â€¦
    [90m 19| [39m      [34mexpect[39m(result[33m.[39mok)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 20| [39m    })[33m;[39m
    [90m 21| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould allow complex expressions with multiple helpers
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/engine.expr.test.ts:[2m27:25[22m[39m
    [90m 25| [39m        [[32m'amount'[39m[33m,[39m [32m'discount'[39m]
    [90m 26| [39m      )[33m;[39m
    [90m 27| [39m      [34mexpect[39m(result[33m.[39mok)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m 28| [39m    })[33m;[39m
    [90m 29| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould evaluate with helper functions
[31m[1mError[22m: Expression error: parse error [1:14]: Expected )[39m
[36m [2mâ¯[22m evaluateExpression server/engine/expr.ts:[2m248:11[22m[39m
    [90m246| [39m    [90m// Sanitize error message (no stack traces)[39m
    [90m247| [39m    const message = error instanceof Error ? error.message : 'Expressiâ€¦
    [90m248| [39m    [35mthrow[39m [35mnew[39m [33mError[39m([32m`Expression error: [39m[36m${[39mmessage[36m}[39m[32m`[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m249| [39m  }
    [90m250| [39m}
[90m [2mâ¯[22m tests/engine.expr.test.ts:[2m85:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould support complex nested expressions
[31m[1mError[22m: Expression error: parse error [1:54]: Expected )[39m
[36m [2mâ¯[22m evaluateExpression server/engine/expr.ts:[2m248:11[22m[39m
    [90m246| [39m    [90m// Sanitize error message (no stack traces)[39m
    [90m247| [39m    const message = error instanceof Error ? error.message : 'Expressiâ€¦
    [90m248| [39m    [35mthrow[39m [35mnew[39m [33mError[39m([32m`Expression error: [39m[36m${[39mmessage[36m}[39m[32m`[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m249| [39m  }
    [90m250| [39m}
[90m [2mâ¯[22m tests/engine.expr.test.ts:[2m200:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mExpression Validation[2m > [22mshould validate compute node expressions
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m tests/engine.run-conditions.test.ts:[2m162:28[22m[39m
    [90m160| [39m
    [90m161| [39m      [35mconst[39m result [33m=[39m [34mvalidateNodeConditions[39m(graph)[33m;[39m
    [90m162| [39m      [34mexpect[39m(result[33m.[39mvalid)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                           [31m^[39m
    [90m163| [39m    })[33m;[39m
    [90m164| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould skip question when condition is false
[31m[1mAssertionError[22m: expected 'error' to be 'success' // Object.is equality[39m

Expected: [32m"success"[39m
Received: [31m"error"[39m

[36m [2mâ¯[22m tests/engine.run-conditions.test.ts:[2m274:29[22m[39m
    [90m272| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mrunGraph[39m(input)[33m;[39m
    [90m273| [39m
    [90m274| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'success'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m275| [39m      [34mexpect[39m(result[33m.[39mtrace)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m276| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould execute question when condition is true
[31m[1mAssertionError[22m: expected 'error' to be 'success' // Object.is equality[39m

Expected: [32m"success"[39m
Received: [31m"error"[39m

[36m [2mâ¯[22m tests/engine.run-conditions.test.ts:[2m328:29[22m[39m
    [90m326| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mrunGraph[39m(input)[33m;[39m
    [90m327| [39m
    [90m328| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'success'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m329| [39m      [34mexpect[39m(result[33m.[39mtrace)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m330| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould skip compute node when condition is false
[31m[1mAssertionError[22m: expected 'error' to be 'success' // Object.is equality[39m

Expected: [32m"success"[39m
Received: [31m"error"[39m

[36m [2mâ¯[22m tests/engine.run-conditions.test.ts:[2m381:29[22m[39m
    [90m379| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mrunGraph[39m(input)[33m;[39m
    [90m380| [39m
    [90m381| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'success'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m382| [39m      [34mexpect[39m(result[33m.[39mtrace)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m383| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould execute compute node when condition is true
[31m[1mAssertionError[22m: expected 'error' to be 'success' // Object.is equality[39m

Expected: [32m"success"[39m
Received: [31m"error"[39m

[36m [2mâ¯[22m tests/engine.run-conditions.test.ts:[2m435:29[22m[39m
    [90m433| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mrunGraph[39m(input)[33m;[39m
    [90m434| [39m
    [90m435| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'success'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m436| [39m      [34mexpect[39m(result[33m.[39mtrace)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m437| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould handle complex workflow with multiple conditions
[31m[1mAssertionError[22m: expected 'error' to be 'success' // Object.is equality[39m

Expected: [32m"success"[39m
Received: [31m"error"[39m

[36m [2mâ¯[22m tests/engine.run-conditions.test.ts:[2m523:29[22m[39m
    [90m521| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mrunGraph[39m(input)[33m;[39m
    [90m522| [39m
    [90m523| [39m      [34mexpect[39m(result[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'success'[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m524| [39m      [34mexpect[39m(result[33m.[39mtrace)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m525| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-jwt.integration.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould register a new user with email and password
[31m[1mError[22m: expected 201 "Created", got 500 "Internal Server Error"[39m
[36m [2mâ¯[22m tests/integration/auth-jwt.integration.test.ts:[2m60:10[22m[39m
    [90m 58| [39m        })
    [90m 59| [39m        [33m.[39m[34mexpect[39m([32m"Content-Type"[39m[33m,[39m [36m/json/[39m)
    [90m 60| [39m        [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m 61| [39m
    [90m 62| [39m      expect(response.body).toHaveProperty("message", "Registration suâ€¦
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-jwt.integration.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould reject duplicate email registration
[31m[1mError[22m: expected 201 "Created", got 500 "Internal Server Error"[39m
[36m [2mâ¯[22m tests/integration/auth-jwt.integration.test.ts:[2m119:10[22m[39m
    [90m117| [39m        [33m.[39m[34mpost[39m([32m"/api/auth/register"[39m)
    [90m118| [39m        [33m.[39m[34msend[39m({ email[33m,[39m password[33m,[39m firstName[33m:[39m [32m"Test"[39m[33m,[39m lastName[33m:[39m [32m"User"[39m })
    [90m119| [39m        [33m.[39m[34mexpect[39m([34m201[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m120| [39m
    [90m121| [39m      [90m// Second registration with same email[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/google - Successful Authentication[2m > [22mshould successfully authenticate with valid Google token and origin
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m112:10[22m[39m
    [90m110| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"valid-google-token"[39m })
    [90m111| [39m        [33m.[39m[34mexpect[39m([32m"Content-Type"[39m[33m,[39m [36m/json/[39m)
    [90m112| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m113| [39m
    [90m114| [39m      expect(response.body).toHaveProperty("message", "Authentication â€¦
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/google - Successful Authentication[2m > [22mshould accept both 'token' and 'idToken' field names
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m153:10[22m[39m
    [90m151| [39m        [33m.[39m[35mset[39m([32m"Origin"[39m[33m,[39m [32m"http://localhost:5000"[39m)
    [90m152| [39m        [33m.[39m[34msend[39m({ token[33m:[39m [32m"valid-token-1"[39m })
    [90m153| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m154| [39m
    [90m155| [39m      [34mexpect[39m(response1[33m.[39mbody[33m.[39muser[33m.[39mid)[33m.[39m[34mtoBe[39m([32m"google-user-token-field"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/google - Origin Validation[2m > [22mshould accept requests from localhost variants
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m210:10[22m[39m
    [90m208| [39m        [33m.[39m[35mset[39m([32m"Origin"[39m[33m,[39m [32m"http://localhost:5000"[39m)
    [90m209| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"localhost-token"[39m })
    [90m210| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m211| [39m
    [90m212| [39m      [90m// Test 127.0.0.1[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/google - Origin Validation[2m > [22mshould accept Referer header when Origin is missing
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m246:10[22m[39m
    [90m244| [39m        [33m.[39m[35mset[39m([32m"Referer"[39m[33m,[39m [32m"http://localhost:5000/login"[39m)
    [90m245| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"referer-token"[39m })
    [90m246| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m247| [39m
    [90m248| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39muser[33m.[39memail)[33m.[39m[34mtoBe[39m([32m"referer@example.com"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/google - Origin Validation[2m > [22mshould accept requests from ALLOWED_ORIGIN environment variable
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m273:10[22m[39m
    [90m271| [39m        [33m.[39m[35mset[39m([32m"Origin"[39m[33m,[39m [32m"https://app.example.com"[39m)
    [90m272| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"allowed-origin-token"[39m })
    [90m273| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m274| [39m
    [90m275| [39m      [34mexpect[39m(response[33m.[39mbody[33m.[39muser[33m.[39memail)[33m.[39m[34mtoBe[39m([32m"allowed@example.com"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/google - Session Management[2m > [22mshould regenerate session ID on login (session fixation protection)
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m415:10[22m[39m
    [90m413| [39m        [33m.[39m[35mset[39m([32m"Origin"[39m[33m,[39m [32m"http://localhost:5000"[39m)
    [90m414| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"session-token"[39m })
    [90m415| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m416| [39m
    [90m417| [39m      [35mconst[39m cookies [33m=[39m response[33m.[39mheaders[[32m"set-cookie"[39m][33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/google - Session Management[2m > [22mshould allow accessing protected routes after authentication
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m447:10[22m[39m
    [90m445| [39m        [33m.[39m[35mset[39m([32m"Origin"[39m[33m,[39m [32m"http://localhost:5000"[39m)
    [90m446| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"protected-token"[39m })
    [90m447| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m448| [39m
    [90m449| [39m      [35mconst[39m cookies [33m=[39m loginResponse[33m.[39mheaders[[32m"set-cookie"[39m][33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/google - Session Management[2m > [22mshould maintain session across multiple requests
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m480:10[22m[39m
    [90m478| [39m        [33m.[39m[35mset[39m([32m"Origin"[39m[33m,[39m [32m"http://localhost:5000"[39m)
    [90m479| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"multiple-token"[39m })
    [90m480| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m481| [39m
    [90m482| [39m      [35mconst[39m cookies [33m=[39m loginResponse[33m.[39mheaders[[32m"set-cookie"[39m][33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/logout[2m > [22mshould successfully logout and destroy session
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m544:10[22m[39m
    [90m542| [39m        [33m.[39m[35mset[39m([32m"Origin"[39m[33m,[39m [32m"http://localhost:5000"[39m)
    [90m543| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"logout-token"[39m })
    [90m544| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m545| [39m
    [90m546| [39m      [35mconst[39m cookies [33m=[39m loginResponse[33m.[39mheaders[[32m"set-cookie"[39m][33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/auth-oauth.integration.test.ts[2m > [22mOAuth2 Integration Tests[2m > [22mPOST /api/auth/logout[2m > [22mshould clear session cookie on logout
[31m[1mError[22m: expected 200 "OK", got 401 "Unauthorized"[39m
[36m [2mâ¯[22m tests/integration/auth-oauth.integration.test.ts:[2m581:10[22m[39m
    [90m579| [39m        [33m.[39m[35mset[39m([32m"Origin"[39m[33m,[39m [32m"http://localhost:5000"[39m)
    [90m580| [39m        [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"cookie-clear-token"[39m })
    [90m581| [39m        [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m         [31m^[39m
    [90m582| [39m
    [90m583| [39m      [35mconst[39m cookies [33m=[39m loginResponse[33m.[39mheaders[[32m"set-cookie"[39m][33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m156:7[22m[39m
[90m [2mâ¯[22m Test.Request.callback node_modules/superagent/lib/node/index.js:[2m857:3[22m[39m
[90m [2mâ¯[22m node_modules/superagent/lib/node/index.js:[2m1102:18[22m[39m
[90m [2mâ¯[22m IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:[2m21:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mextractPlaceholdersFromDocx[2m > [22mshould extract placeholders from a template
[31m[1mApiError[22m: Failed to extract placeholders: Multi error[39m
[36m [2mâ¯[22m Object.internal server/utils/errors.ts:[2m116:12[22m[39m
    [90m114| [39m
    [90m115| [39m  internal(message = 'Internal server error', details?: any): ApiErrorâ€¦
    [90m116| [39m    return new ApiError(ErrorCode.INTERNAL_ERROR, message, details, 50â€¦
    [90m   | [39m           [31m^[39m
    [90m117| [39m  }[33m,[39m
    [90m118| [39m
[90m [2mâ¯[22m extractPlaceholdersFromDocx server/services/docxRenderer.ts:[2m243:23[22m[39m
[90m [2mâ¯[22m tests/unit/docxRenderer.test.ts:[2m97:28[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mextractPlaceholdersFromDocx[2m > [22mshould extract placeholders including formatters
[31m[1mApiError[22m: Failed to extract placeholders: Multi error[39m
[36m [2mâ¯[22m Object.internal server/utils/errors.ts:[2m116:12[22m[39m
    [90m114| [39m
    [90m115| [39m  internal(message = 'Internal server error', details?: any): ApiErrorâ€¦
    [90m116| [39m    return new ApiError(ErrorCode.INTERNAL_ERROR, message, details, 50â€¦
    [90m   | [39m           [31m^[39m
    [90m117| [39m  }[33m,[39m
    [90m118| [39m
[90m [2mâ¯[22m extractPlaceholdersFromDocx server/services/docxRenderer.ts:[2m243:23[22m[39m
[90m [2mâ¯[22m tests/unit/docxRenderer.test.ts:[2m106:28[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mvalidateTemplateData[2m > [22mshould allow formatters as valid placeholders
[31m[1mAssertionError[22m: expected [] to deeply equal [ 'upper', 'lower' ][39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [[39m
[32m-   "upper",[39m
[32m-   "lower",[39m
[32m- ][39m
[31m+ [][39m

[36m [2mâ¯[22m tests/unit/docxRenderer.test.ts:[2m143:23[22m[39m
    [90m141| [39m
    [90m142| [39m      [35mconst[39m missing [33m=[39m [34mvalidateTemplateData[39m(placeholders[33m,[39m data)[33m;[39m
    [90m143| [39m      [34mexpect[39m(missing)[33m.[39m[34mtoEqual[39m([[32m'upper'[39m[33m,[39m [32m'lower'[39m])[33m;[39m
    [90m   | [39m                      [31m^[39m
    [90m144| [39m      // Note: formatters should be handled separately in real validatâ€¦
    [90m145| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould render a template with simple data
[31m[1mApiError[22m: Failed to render template: Multi error[39m
[36m [2mâ¯[22m Object.internal server/utils/errors.ts:[2m116:12[22m[39m
    [90m114| [39m
    [90m115| [39m  internal(message = 'Internal server error', details?: any): ApiErrorâ€¦
    [90m116| [39m    return new ApiError(ErrorCode.INTERNAL_ERROR, message, details, 50â€¦
    [90m   | [39m           [31m^[39m
    [90m117| [39m  }[33m,[39m
    [90m118| [39m
[90m [2mâ¯[22m renderDocx server/services/docxRenderer.ts:[2m136:23[22m[39m
[90m [2mâ¯[22m tests/unit/docxRenderer.test.ts:[2m156:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould use formatters in templates
[31m[1mApiError[22m: Failed to render template: Multi error[39m
[36m [2mâ¯[22m Object.internal server/utils/errors.ts:[2m116:12[22m[39m
    [90m114| [39m
    [90m115| [39m  internal(message = 'Internal server error', details?: any): ApiErrorâ€¦
    [90m116| [39m    return new ApiError(ErrorCode.INTERNAL_ERROR, message, details, 50â€¦
    [90m   | [39m           [31m^[39m
    [90m117| [39m  }[33m,[39m
    [90m118| [39m
[90m [2mâ¯[22m renderDocx server/services/docxRenderer.ts:[2m136:23[22m[39m
[90m [2mâ¯[22m tests/unit/docxRenderer.test.ts:[2m193:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould handle missing data gracefully
[31m[1mApiError[22m: Failed to render template: Multi error[39m
[36m [2mâ¯[22m Object.internal server/utils/errors.ts:[2m116:12[22m[39m
    [90m114| [39m
    [90m115| [39m  internal(message = 'Internal server error', details?: any): ApiErrorâ€¦
    [90m116| [39m    return new ApiError(ErrorCode.INTERNAL_ERROR, message, details, 50â€¦
    [90m   | [39m           [31m^[39m
    [90m117| [39m  }[33m,[39m
    [90m118| [39m
[90m [2mâ¯[22m renderDocx server/services/docxRenderer.ts:[2m136:23[22m[39m
[90m [2mâ¯[22m tests/unit/docxRenderer.test.ts:[2m221:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould use custom output name
[31m[1mApiError[22m: Failed to render template: Multi error[39m
[36m [2mâ¯[22m Object.internal server/utils/errors.ts:[2m116:12[22m[39m
    [90m114| [39m
    [90m115| [39m  internal(message = 'Internal server error', details?: any): ApiErrorâ€¦
    [90m116| [39m    return new ApiError(ErrorCode.INTERNAL_ERROR, message, details, 50â€¦
    [90m   | [39m           [31m^[39m
    [90m117| [39m  }[33m,[39m
    [90m118| [39m
[90m [2mâ¯[22m renderDocx server/services/docxRenderer.ts:[2m136:23[22m[39m
[90m [2mâ¯[22m tests/unit/docxRenderer.test.ts:[2m246:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mPDF conversion[2m > [22mshould attempt PDF conversion when requested
[31m[1mApiError[22m: Failed to render template: Multi error[39m
[36m [2mâ¯[22m Object.internal server/utils/errors.ts:[2m116:12[22m[39m
    [90m114| [39m
    [90m115| [39m  internal(message = 'Internal server error', details?: any): ApiErrorâ€¦
    [90m116| [39m    return new ApiError(ErrorCode.INTERNAL_ERROR, message, details, 50â€¦
    [90m   | [39m           [31m^[39m
    [90m117| [39m  }[33m,[39m
    [90m118| [39m
[90m [2mâ¯[22m renderDocx server/services/docxRenderer.ts:[2m136:23[22m[39m
[90m [2mâ¯[22m tests/unit/docxRenderer.test.ts:[2m265:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/ui/builder.test.ts[2m > [22mVisual Workflow Builder Store[2m > [22mshould add a question node
[31m[1mAssertionError[22m: expected +0 to be 1 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m tests/ui/builder.test.ts:[2m21:32[22m[39m
    [90m 19| [39m    store[33m.[39m[34maddNode[39m([32m'question'[39m[33m,[39m { x[33m:[39m [34m100[39m[33m,[39m y[33m:[39m [34m100[39m })[33m;[39m
    [90m 20| [39m
    [90m 21| [39m    [34mexpect[39m(store[33m.[39mnodes[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 22| [39m    [34mexpect[39m(store[33m.[39mnodes[[34m0[39m][33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'question'[39m)[33m;[39m
    [90m 23| [39m    [34mexpect[39m(store[33m.[39mnodes[[34m0[39m][33m.[39mdata[33m.[39mconfig[33m.[39mkey)[33m.[39m[34mtoMatch[39m([36m/^q_/[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[53/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/ui/builder.test.ts[2m > [22mVisual Workflow Builder Store[2m > [22mshould add a compute node
[31m[1mAssertionError[22m: expected +0 to be 1 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m tests/ui/builder.test.ts:[2m30:32[22m[39m
    [90m 28| [39m    store[33m.[39m[34maddNode[39m([32m'compute'[39m[33m,[39m { x[33m:[39m [34m200[39m[33m,[39m y[33m:[39m [34m200[39m })[33m;[39m
    [90m 29| [39m
    [90m 30| [39m    [34mexpect[39m(store[33m.[39mnodes[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 31| [39m    [34mexpect[39m(store[33m.[39mnodes[[34m0[39m][33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'compute'[39m)[33m;[39m
    [90m 32| [39m    [34mexpect[39m(store[33m.[39mnodes[[34m0[39m][33m.[39mdata[33m.[39mconfig[33m.[39moutputKey)[33m.[39m[34mtoMatch[39m([36m/^c_/[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[54/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/ui/builder.test.ts[2m > [22mVisual Workflow Builder Store[2m > [22mshould load graph from API format
[31m[1mAssertionError[22m: expected +0 to be 1 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m tests/ui/builder.test.ts:[2m65:32[22m[39m
    [90m 63| [39m    store[33m.[39m[34mloadGraph[39m(graphJson)[33m;[39m
    [90m 64| [39m
    [90m 65| [39m    [34mexpect[39m(store[33m.[39mnodes[33m.[39mlength)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m 66| [39m    [34mexpect[39m(store[33m.[39mnodes[[34m0[39m][33m.[39mid)[33m.[39m[34mtoBe[39m([32m'node1'[39m)[33m;[39m
    [90m 67| [39m    [34mexpect[39m(store[33m.[39mnodes[[34m0[39m][33m.[39mtype)[33m.[39m[34mtoBe[39m([32m'question'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[55/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-001: User Login[2m > [22mshould successfully log in with valid Google ID token
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m40:8[22m[39m
    [90m 38| [39m      [33m.[39m[34mpost[39m([32m"/api/login"[39m)
    [90m 39| [39m      [33m.[39m[34msend[39m({ idToken[33m:[39m mockIdToken })
    [90m 40| [39m      [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 41| [39m
    [90m 42| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"id"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[56/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-001: User Login[2m > [22mshould reject login with invalid ID token
[31m[1mError[22m: expected 401 "Unauthorized", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m54:8[22m[39m
    [90m 52| [39m      [33m.[39m[34mpost[39m([32m"/api/login"[39m)
    [90m 53| [39m      [33m.[39m[34msend[39m({ idToken[33m:[39m [32m"invalid.token"[39m })
    [90m 54| [39m      [33m.[39m[34mexpect[39m([34m401[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 55| [39m
    [90m 56| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"error"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[57/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-001: User Login[2m > [22mshould reject login with missing ID token
[31m[1mError[22m: expected 400 "Bad Request", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m63:8[22m[39m
    [90m 61| [39m      [33m.[39m[34mpost[39m([32m"/api/login"[39m)
    [90m 62| [39m      [33m.[39m[34msend[39m({})
    [90m 63| [39m      [33m.[39m[34mexpect[39m([34m400[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 64| [39m
    [90m 65| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"error"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[58/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-001: User Login[2m > [22mshould create new user on first login
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m74:8[22m[39m
    [90m 72| [39m      [33m.[39m[34mpost[39m([32m"/api/login"[39m)
    [90m 73| [39m      [33m.[39m[34msend[39m({ idToken[33m:[39m mockIdToken })
    [90m 74| [39m      [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 75| [39m
    [90m 76| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"id"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[59/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-001: User Login[2m > [22mshould retrieve existing user on subsequent logins
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m87:8[22m[39m
    [90m 85| [39m      [33m.[39m[34mpost[39m([32m"/api/login"[39m)
    [90m 86| [39m      [33m.[39m[34msend[39m({ idToken[33m:[39m mockIdToken })
    [90m 87| [39m      [33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 88| [39m
    [90m 89| [39m    [90m// Second login[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[60/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-002: Get Current User[2m > [22mshould return current user if authenticated
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m106:51[22m[39m
    [90m104| [39m    [35mawait[39m agent[33m.[39m[34mpost[39m([32m"/api/login"[39m)[33m.[39m[34msend[39m({ idToken[33m:[39m [32m"valid.token"[39m })[33m;[39m
    [90m105| [39m
    [90m106| [39m    [35mconst[39m response [33m=[39m [35mawait[39m agent[33m.[39m[35mget[39m([32m"/api/user"[39m)[33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                                  [31m^[39m
    [90m107| [39m
    [90m108| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"id"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[61/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-002: Get Current User[2m > [22mshould return 401 if not authenticated
[31m[1mError[22m: expected 401 "Unauthorized", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m113:58[22m[39m
    [90m111| [39m
    [90m112| [39m  [34mit[39m([32m"should return 401 if not authenticated"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m113| [39m    [35mconst[39m response [33m=[39m [35mawait[39m [34mrequest[39m(app)[33m.[39m[35mget[39m([32m"/api/user"[39m)[33m.[39m[34mexpect[39m([34m401[39m)[33m;[39m
    [90m   | [39m                                                         [31m^[39m
    [90m114| [39m
    [90m115| [39m    [34mexpect[39m(response[33m.[39mbody)[33m.[39m[34mtoHaveProperty[39m([32m"error"[39m[33m,[39m [32m"Not authenticated"[39m)[33m;[39m
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[62/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-003: User Logout[2m > [22mshould successfully log out authenticated user
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m126:54[22m[39m
    [90m124| [39m
    [90m125| [39m    [90m// Logout[39m
    [90m126| [39m    [35mconst[39m response [33m=[39m [35mawait[39m agent[33m.[39m[34mpost[39m([32m"/api/logout"[39m)[33m.[39m[34mexpect[39m([34m200[39m)[33m;[39m
    [90m   | [39m                                                     [31m^[39m
    [90m127| [39m
    [90m128| [39m    expect(response.body).toHaveProperty("message", "Logged out succesâ€¦
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[63/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-A-001-login.test.ts[2m > [22mUS-A-003: User Logout[2m > [22mshould handle logout when not logged in
[31m[1mError[22m: expected 200 "OK", got 404 "Not Found"[39m
[36m [2mâ¯[22m tests/integration/routes/US-A-001-login.test.ts:[2m135:61[22m[39m
    [90m133| [39m
    [90m134| [39m  [34mit[39m([32m"should handle logout when not logged in"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m135| [39m    const response = await request(app).post("/api/logout").expect(200â€¦
    [90m   | [39m                                                            [31m^[39m
    [90m136| [39m
    [90m137| [39m    expect(response.body).toHaveProperty("message", "Logged out succesâ€¦
[90m [2mâ¯[22m Test._assertStatus node_modules/supertest/lib/test.js:[2m309:14[22m[39m
[90m [2mâ¯[22m node_modules/supertest/lib/test.js:[2m365:13[22m[39m
[90m [2mâ¯[22m Test._assertFunction node_modules/supertest/lib/test.js:[2m342:13[22m[39m
[90m [2mâ¯[22m Test.assert node_modules/supertest/lib/test.js:[2m195:23[22m[39m
[90m [2mâ¯[22m localAssert node_modules/supertest/lib/test.js:[2m138:14[22m[39m
[90m [2mâ¯[22m Server.<anonymous> node_modules/supertest/lib/test.js:[2m152:11[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[64/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould export responses as CSV
[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould export responses as PDF
[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould include all response data in CSV
[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould default to CSV format if not specified
[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould reject invalid export format
[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould prevent exporting other user's surveys
[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould export empty CSV if no responses
[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould include anonymous responses in export
[41m[1m FAIL [22m[49m tests/integration/routes/US-AN-042-export-results.test.ts[2m > [22mUS-AN-042: Export Survey Results[2m > [22mshould handle special characters in responses
[31m[1mTypeError[22m: (0 , __vite_ssr_import_4__.createAuthenticatedAgent) is not a function[39m
[36m [2mâ¯[22m tests/integration/routes/US-AN-042-export-results.test.ts:[2m21:19[22m[39m
    [90m 19| [39m  [34mbeforeEach[39m([35masync[39m () [33m=>[39m {
    [90m 20| [39m    user [33m=[39m [34mcreateTestUser[39m()[33m;[39m
    [90m 21| [39m    agent [33m=[39m [35mawait[39m [34mcreateAuthenticatedAgent[39m(app[33m,[39m user)[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m 22| [39m
    [90m 23| [39m    [90m// Create survey with questions and responses[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[65/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/AnalyticsRepository.test.ts[2m > [22mAnalyticsRepository[2m > [22mgetEventsBySurveyId[2m > [22mshould get all events for a survey
[31m[1mTypeError[22m: database.select(...).from(...).where(...).orderBy is not a function[39m
[36m [2mâ¯[22m AnalyticsRepository.findBySurvey server/repositories/AnalyticsRepository.ts:[2m83:8[22m[39m
    [90m 81| [39m      [33m.[39m[35mfrom[39m(analyticsEvents)
    [90m 82| [39m      [33m.[39m[34mwhere[39m([34meq[39m(analyticsEvents[33m.[39msurveyId[33m,[39m surveyId))
    [90m 83| [39m      [33m.[39m[34morderBy[39m([34mdesc[39m(analyticsEvents[33m.[39mtimestamp))[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 84| [39m
    [90m 85| [39m    [35mif[39m (limit) {
[90m [2mâ¯[22m AnalyticsRepository.getEventsBySurveyId server/repositories/AnalyticsRepository.ts:[2m736:17[22m[39m
[90m [2mâ¯[22m tests/unit/repositories/AnalyticsRepository.test.ts:[2m90:39[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[66/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/AnalyticsRepository.test.ts[2m > [22mAnalyticsRepository[2m > [22mgetEventsBySurveyId[2m > [22mshould filter events by type
[31m[1mTypeError[22m: database.select(...).from(...).where(...).orderBy is not a function[39m
[36m [2mâ¯[22m AnalyticsRepository.findBySurveyAndEvent server/repositories/AnalyticsRepository.ts:[2m105:8[22m[39m
    [90m103| [39m      [33m.[39m[35mfrom[39m(analyticsEvents)
    [90m104| [39m      .where(and(eq(analyticsEvents.surveyId, surveyId), eq(analyticsEâ€¦
    [90m105| [39m      [33m.[39m[34morderBy[39m([34mdesc[39m(analyticsEvents[33m.[39mtimestamp))[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m106| [39m  }
    [90m107| [39m
[90m [2mâ¯[22m AnalyticsRepository.getEventsBySurveyId server/repositories/AnalyticsRepository.ts:[2m734:19[22m[39m
[90m [2mâ¯[22m tests/unit/repositories/AnalyticsRepository.test.ts:[2m103:39[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[67/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/AnalyticsRepository.test.ts[2m > [22mAnalyticsRepository[2m > [22mgetEventsByResponseId[2m > [22mshould get complete journey for a response
[31m[1mTypeError[22m: database.select(...).from(...).where(...).orderBy is not a function[39m
[36m [2mâ¯[22m AnalyticsRepository.findByResponse server/repositories/AnalyticsRepository.ts:[2m67:8[22m[39m
    [90m 65| [39m      [33m.[39m[35mfrom[39m(analyticsEvents)
    [90m 66| [39m      [33m.[39m[34mwhere[39m([34meq[39m(analyticsEvents[33m.[39mresponseId[33m,[39m responseId))
    [90m 67| [39m      [33m.[39m[34morderBy[39m(analyticsEvents[33m.[39mtimestamp)[33m;[39m
    [90m   | [39m       [31m^[39m
    [90m 68| [39m  }
    [90m 69| [39m
[90m [2mâ¯[22m AnalyticsRepository.getEventsByResponseId server/repositories/AnalyticsRepository.ts:[2m743:17[22m[39m
[90m [2mâ¯[22m tests/unit/repositories/AnalyticsRepository.test.ts:[2m121:39[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[68/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/AnalyticsRepository.test.ts[2m > [22mAnalyticsRepository[2m > [22mgetQuestionMetrics[2m > [22mshould aggregate question interaction metrics
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'viewCount')[39m
[36m [2mâ¯[22m tests/unit/repositories/AnalyticsRepository.test.ts:[2m144:24[22m[39m
    [90m142| [39m
    [90m143| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m144| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mviewCount)[33m.[39m[34mtoBe[39m([34m100[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m145| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mavgDuration)[33m.[39m[34mtoBe[39m([34m45[39m)[33m;[39m
    [90m146| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[69/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/AnalyticsRepository.test.ts[2m > [22mAnalyticsRepository[2m > [22mgetPageMetrics[2m > [22mshould aggregate page-level metrics
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'pageId')[39m
[36m [2mâ¯[22m tests/unit/repositories/AnalyticsRepository.test.ts:[2m163:24[22m[39m
    [90m161| [39m
    [90m162| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBeDefined[39m()[33m;[39m
    [90m163| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mpageId)[33m.[39m[34mtoBe[39m([32m"page-1"[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m164| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mviewCount)[33m.[39m[34mtoBe[39m([34m150[39m)[33m;[39m
    [90m165| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[70/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/AnalyticsRepository.test.ts[2m > [22mAnalyticsRepository[2m > [22mgetAverageCompletionTime[2m > [22mshould calculate average time from start to complete
[31m[1mTypeError[22m: database.select(...).from(...).innerJoin is not a function[39m
[36m [2mâ¯[22m AnalyticsRepository.getAverageCompletionTime server/repositories/AnalyticsRepository.ts:[2m787:8[22m[39m
    [90m785| [39m        ) AS start_event
    [90m786| [39m      `[39m)
    [90m787| [39m      [33m.[39m[34minnerJoin[39m(
    [90m   | [39m       [31m^[39m
    [90m788| [39m        sql[32m`
    [90m789| [39m          (SELECT response_id, timestamp
[90m [2mâ¯[22m tests/unit/repositories/AnalyticsRepository.test.ts:[2m190:39[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[71/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/AnalyticsRepository.test.ts[2m > [22mAnalyticsRepository[2m > [22mgetAverageCompletionTime[2m > [22mshould return null if no completions
[31m[1mTypeError[22m: database.select(...).from(...).innerJoin is not a function[39m
[36m [2mâ¯[22m AnalyticsRepository.getAverageCompletionTime server/repositories/AnalyticsRepository.ts:[2m787:8[22m[39m
    [90m785| [39m        ) AS start_event
    [90m786| [39m      `[39m)
    [90m787| [39m      [33m.[39m[34minnerJoin[39m(
    [90m   | [39m       [31m^[39m
    [90m788| [39m        sql[32m`
    [90m789| [39m          (SELECT response_id, timestamp
[90m [2mâ¯[22m tests/unit/repositories/AnalyticsRepository.test.ts:[2m198:39[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[72/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mreorderColumns[2m > [22mshould update order indices for multiple columns
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m DatavaultColumnsRepository.reorderColumns server/repositories/DatavaultColumnsRepository.ts:[2m113:35[22m[39m
    [90m111| [39m
    [90m112| [39m    [90m// Update each column with its new order index[39m
    [90m113| [39m    [35mfor[39m ([35mlet[39m i [33m=[39m [34m0[39m[33m;[39m i [33m<[39m columnIds[33m.[39mlength[33m;[39m i[33m++[39m) {
    [90m   | [39m                                  [31m^[39m
    [90m114| [39m      [35mawait[39m database
    [90m115| [39m        [33m.[39m[34mupdate[39m(datavaultColumns)
[90m [2mâ¯[22m tests/unit/repositories/DatavaultColumnsRepository.test.ts:[2m216:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[73/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mgetMaxOrderIndex[2m > [22mshould return max order index
[31m[1mAssertionError[22m: expected -1 to be 5 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 5[39m
[31m+ -1[39m

[36m [2mâ¯[22m tests/unit/repositories/DatavaultColumnsRepository.test.ts:[2m228:22[22m[39m
    [90m226| [39m      [35mconst[39m result [33m=[39m [35mawait[39m repository[33m.[39m[34mgetMaxOrderIndex[39m(mockTableId)[33m;[39m
    [90m227| [39m
    [90m228| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([34m5[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m229| [39m    })[33m;[39m
    [90m230| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[74/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mgetMaxOrderIndex[2m > [22mshould return 0 if no columns exist
[31m[1mAssertionError[22m: expected -1 to be +0 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 0[39m
[31m+ -1[39m

[36m [2mâ¯[22m tests/unit/repositories/DatavaultColumnsRepository.test.ts:[2m236:22[22m[39m
    [90m234| [39m      [35mconst[39m result [33m=[39m [35mawait[39m repository[33m.[39m[34mgetMaxOrderIndex[39m(mockTableId)[33m;[39m
    [90m235| [39m
    [90m236| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([34m0[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m237| [39m    })[33m;[39m
    [90m238| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[75/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mfindByTableId[2m > [22mshould support limit and offset
[31m[1mTypeError[22m: database.select is not a function[39m
[36m [2mâ¯[22m DatavaultRowsRepository.findByTableId server/repositories/DatavaultRowsRepository.ts:[2m40:8[22m[39m
    [90m 38| [39m    [35mconst[39m database [33m=[39m [35mthis[39m[33m.[39m[34mgetDb[39m(tx)[33m;[39m
    [90m 39| [39m    [35mlet[39m query [33m=[39m database
    [90m 40| [39m      [33m.[39m[34mselect[39m()
    [90m   | [39m       [31m^[39m
    [90m 41| [39m      [33m.[39m[35mfrom[39m(datavaultRows)
    [90m 42| [39m      [33m.[39m[34mwhere[39m([34meq[39m(datavaultRows[33m.[39mtableId[33m,[39m tableId))
[90m [2mâ¯[22m tests/unit/repositories/DatavaultRowsRepository.test.ts:[2m74:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[76/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mcreateRowWithValues[2m > [22mshould create row and values in transaction
[31m[1mAssertionError[22m: expected "vi.fn()" to be called at least once[39m
[36m [2mâ¯[22m tests/unit/repositories/DatavaultRowsRepository.test.ts:[2m192:34[22m[39m
    [90m190| [39m      [34mexpect[39m(result[33m.[39mrow)[33m.[39m[34mtoEqual[39m(createdRow)[33m;[39m
    [90m191| [39m      [34mexpect[39m(result[33m.[39mvalues)[33m.[39m[34mtoEqual[39m(createdValues)[33m;[39m
    [90m192| [39m      [34mexpect[39m(mockDb[33m.[39mtransaction)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                 [31m^[39m
    [90m193| [39m    })[33m;[39m
    [90m194| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[77/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mgetRowsWithValues[2m > [22mshould get rows with their values
[31m[1mAssertionError[22m: expected [ { â€¦(2) } ] to deeply equal [ { row: { â€¦(4) }, value: { â€¦(6) } } ][39m

[32m- Expected[39m
[31m+ Received[39m

[2m  [[22m
[2m    {[22m
[2m      "row": {[22m
[31m+       "row": {[39m
[2m          "createdAt": 2025-11-18T14:08:59.670Z,[22m
[2m          "id": "770e8400-e29b-41d4-a716-446655440002",[22m
[2m          "tableId": "660e8400-e29b-41d4-a716-446655440001",[22m
[2m          "updatedAt": 2025-11-18T14:08:59.670Z,[22m
[2m        },[22m
[31m+       "value": {[39m
[31m+         "columnId": "880e8400-e29b-41d4-a716-446655440003",[39m
[31m+         "createdAt": 2025-11-18T14:08:59.670Z,[39m
[31m+         "id": "val-1",[39m
[31m+         "rowId": "770e8400-e29b-41d4-a716-446655440002",[39m
[31m+         "updatedAt": 2025-11-18T14:08:59.670Z,[39m
[2m          "value": {[22m
[31m+           "data": "John",[39m
[31m+         },[39m
[31m+       },[39m
[31m+     },[39m
[31m+     "values": {[39m
[31m+       "undefined": {[39m
[2m          "columnId": "880e8400-e29b-41d4-a716-446655440003",[22m
[2m          "createdAt": 2025-11-18T14:08:59.670Z,[22m
[2m          "id": "val-1",[22m
[2m          "rowId": "770e8400-e29b-41d4-a716-446655440002",[22m
[2m          "updatedAt": 2025-11-18T14:08:59.670Z,[22m
[2m          "value": {[22m
[2m            "data": "John",[22m
[31m+         },[39m
[2m        },[22m
[2m      },[22m
[2m    },[22m
[2m  ][22m

[36m [2mâ¯[22m tests/unit/repositories/DatavaultRowsRepository.test.ts:[2m241:22[22m[39m
    [90m239| [39m      [35mconst[39m result [33m=[39m [35mawait[39m repository[33m.[39m[34mgetRowsWithValues[39m(mockTableId)[33m;[39m
    [90m240| [39m
    [90m241| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(mockRowsWithValues)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m242| [39m      [34mexpect[39m(mockDb[33m.[39mselect)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m243| [39m      [34mexpect[39m(mockDb[33m.[39mleftJoin)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[78/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mupdateRowValues[2m > [22mshould upsert row values
[31m[1mTypeError[22m: database.insert(...).values(...).onConflictDoUpdate is not a function[39m
[36m [2mâ¯[22m DatavaultRowsRepository.updateRowValues server/repositories/DatavaultRowsRepository.ts:[2m189:10[22m[39m
    [90m187| [39m          value[33m,[39m
    [90m188| [39m        })
    [90m189| [39m        [33m.[39m[34monConflictDoUpdate[39m({
    [90m   | [39m         [31m^[39m
    [90m190| [39m          target[33m:[39m [datavaultValues[33m.[39mrowId[33m,[39m datavaultValues[33m.[39mcolumnId][33m,[39m
    [90m191| [39m          [35mset[39m[33m:[39m {
[90m [2mâ¯[22m tests/unit/repositories/DatavaultRowsRepository.test.ts:[2m264:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[79/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mupdateMetadata[2m > [22mshould update template name and description
[31m[1mTypeError[22m: (intermediate value) is not iterable[39m
[36m [2mâ¯[22m DocumentTemplateRepository.updateMetadata server/repositories/DocumentTemplateRepository.ts:[2m75:24[22m[39m
    [90m 73| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[33mTemplate[39m [33m|[39m undefined[33m>[39m {
    [90m 74| [39m    [35mconst[39m database [33m=[39m [35mthis[39m[33m.[39m[34mgetDb[39m(tx)[33m;[39m
    [90m 75| [39m    [35mconst[39m [template] [33m=[39m [35mawait[39m database
    [90m   | [39m                       [31m^[39m
    [90m 76| [39m      [33m.[39m[34mupdate[39m(templates)
    [90m 77| [39m      [33m.[39m[35mset[39m({
[90m [2mâ¯[22m tests/unit/repositories/DocumentTemplateRepository.test.ts:[2m169:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[80/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mupdateMetadata[2m > [22mshould return undefined when template not found
[31m[1mTypeError[22m: (intermediate value) is not iterable[39m
[36m [2mâ¯[22m DocumentTemplateRepository.updateMetadata server/repositories/DocumentTemplateRepository.ts:[2m75:24[22m[39m
    [90m 73| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[33mTemplate[39m [33m|[39m undefined[33m>[39m {
    [90m 74| [39m    [35mconst[39m database [33m=[39m [35mthis[39m[33m.[39m[34mgetDb[39m(tx)[33m;[39m
    [90m 75| [39m    [35mconst[39m [template] [33m=[39m [35mawait[39m database
    [90m   | [39m                       [31m^[39m
    [90m 76| [39m      [33m.[39m[34mupdate[39m(templates)
    [90m 77| [39m      [33m.[39m[35mset[39m({
[90m [2mâ¯[22m tests/unit/repositories/DocumentTemplateRepository.test.ts:[2m183:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[81/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mupdateFileRef[2m > [22mshould update template file reference
[31m[1mTypeError[22m: (intermediate value) is not iterable[39m
[36m [2mâ¯[22m DocumentTemplateRepository.updateFileRef server/repositories/DocumentTemplateRepository.ts:[2m96:24[22m[39m
    [90m 94| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[33mTemplate[39m [33m|[39m undefined[33m>[39m {
    [90m 95| [39m    [35mconst[39m database [33m=[39m [35mthis[39m[33m.[39m[34mgetDb[39m(tx)[33m;[39m
    [90m 96| [39m    [35mconst[39m [template] [33m=[39m [35mawait[39m database
    [90m   | [39m                       [31m^[39m
    [90m 97| [39m      [33m.[39m[34mupdate[39m(templates)
    [90m 98| [39m      [33m.[39m[35mset[39m({
[90m [2mâ¯[22m tests/unit/repositories/DocumentTemplateRepository.test.ts:[2m207:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[82/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mdeleteByIdAndProjectId[2m > [22mshould delete template and return true
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m DocumentTemplateRepository.deleteByIdAndProjectId server/repositories/DocumentTemplateRepository.ts:[2m120:19[22m[39m
    [90m118| [39m      .where(and(eq(templates.id, id), eq(templates.projectId, projectâ€¦
    [90m119| [39m      [33m.[39m[34mreturning[39m({ id[33m:[39m templates[33m.[39mid })[33m;[39m
    [90m120| [39m    [35mreturn[39m result[33m.[39mlength [33m>[39m [34m0[39m[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m121| [39m  }
    [90m122| [39m
[90m [2mâ¯[22m tests/unit/repositories/DocumentTemplateRepository.test.ts:[2m226:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[83/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mdeleteByIdAndProjectId[2m > [22mshould return false when template not found
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'length')[39m
[36m [2mâ¯[22m DocumentTemplateRepository.deleteByIdAndProjectId server/repositories/DocumentTemplateRepository.ts:[2m120:19[22m[39m
    [90m118| [39m      .where(and(eq(templates.id, id), eq(templates.projectId, projectâ€¦
    [90m119| [39m      [33m.[39m[34mreturning[39m({ id[33m:[39m templates[33m.[39mid })[33m;[39m
    [90m120| [39m    [35mreturn[39m result[33m.[39mlength [33m>[39m [34m0[39m[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m121| [39m  }
    [90m122| [39m
[90m [2mâ¯[22m tests/unit/repositories/DocumentTemplateRepository.test.ts:[2m236:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[84/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mcreate[2m > [22mshould create a new template
[31m[1mTypeError[22m: (intermediate value) is not iterable[39m
[36m [2mâ¯[22m DocumentTemplateRepository.create server/repositories/BaseRepository.ts:[2m85:22[22m[39m
    [90m 83| [39m    [35mconst[39m database [33m=[39m [35mthis[39m[33m.[39m[34mgetDb[39m(tx)[33m;[39m
    [90m 84| [39m
    [90m 85| [39m    [35mconst[39m [record] [33m=[39m [35mawait[39m database
    [90m   | [39m                     [31m^[39m
    [90m 86| [39m      [33m.[39m[34minsert[39m([35mthis[39m[33m.[39mtable)
    [90m 87| [39m      [33m.[39m[34mvalues[39m(data [35mas[39m any)
[90m [2mâ¯[22m tests/unit/repositories/DocumentTemplateRepository.test.ts:[2m301:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[85/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionSchema[2m > [22mshould omit id, createdAt, and updatedAt
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2mâ¯[22m tests/unit/schema/collections.test.ts:[2m139:32[22m[39m
    [90m137| [39m        const result = insertCollectionSchema.safeParse(dataWithOmitteâ€¦
    [90m138| [39m        // Should be invalid because id, createdAt, updatedAt are omitâ€¦
    [90m139| [39m        [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m140| [39m      })[33m;[39m
    [90m141| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[86/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetSurveyResults[2m > [22mshould return comprehensive survey analytics
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getSurveyResults server/services/AnalyticsService.ts:[2m68:42[22m[39m
    [90m 66| [39m  }[33m>[39m {
    [90m 67| [39m    [90m// Verify ownership[39m
    [90m 68| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m 69| [39m    [35mif[39m ([33m![39msurvey) {
    [90m 70| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m85:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[87/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetSurveyResults[2m > [22mshould throw error if user is not the creator
[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetQuestionAnalytics[2m > [22mshould throw error if not authorized
[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetQuestionAggregates[2m > [22mshould throw error if unauthorized
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Access denied' but got 'Cannot read properties of undefined (â€¦'[39m

Expected: [32m"Access denied"[39m
Received: [31m"Cannot read properties of undefined (reading 'findById')"[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[88/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetSurveyResults[2m > [22mshould throw error if survey not found
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Survey not found' but got 'Cannot read properties of undefined (â€¦'[39m

Expected: [32m"Survey not found"[39m
Received: [31m"Cannot read properties of undefined (reading 'findById')"[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[89/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetQuestionAnalytics[2m > [22mshould return question-level metrics
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getQuestionAnalytics server/services/AnalyticsService.ts:[2m183:42[22m[39m
    [90m181| [39m  async getQuestionAnalytics(surveyId: string, userId: string): Promisâ€¦
    [90m182| [39m    [90m// Verify ownership[39m
    [90m183| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m184| [39m    [35mif[39m ([33m![39msurvey) {
    [90m185| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m130:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[90/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetPageAnalytics[2m > [22mshould return page-level analytics
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getPageAnalytics server/services/AnalyticsService.ts:[2m386:42[22m[39m
    [90m384| [39m  async getPageAnalytics(surveyId: string, userId: string): Promise<Paâ€¦
    [90m385| [39m    [90m// Verify ownership[39m
    [90m386| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m387| [39m    [35mif[39m ([33m![39msurvey) {
    [90m388| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m163:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[91/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetCompletionFunnel[2m > [22mshould calculate drop-off rates between pages
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getCompletionFunnel server/services/AnalyticsService.ts:[2m483:42[22m[39m
    [90m481| [39m  async getCompletionFunnel(surveyId: string, userId: string): Promiseâ€¦
    [90m482| [39m    [90m// Verify ownership[39m
    [90m483| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m484| [39m    [35mif[39m ([33m![39msurvey) {
    [90m485| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m188:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[92/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetCompletionFunnel[2m > [22mshould handle single-page surveys
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getCompletionFunnel server/services/AnalyticsService.ts:[2m483:42[22m[39m
    [90m481| [39m  async getCompletionFunnel(surveyId: string, userId: string): Promiseâ€¦
    [90m482| [39m    [90m// Verify ownership[39m
    [90m483| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m484| [39m    [35mif[39m ([33m![39msurvey) {
    [90m485| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m203:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[93/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetTimeSpentData[2m > [22mshould return time spent metrics
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getTimeSpentData server/services/AnalyticsService.ts:[2m510:42[22m[39m
    [90m508| [39m  async getTimeSpentData(surveyId: string, userId: string): Promise<Tiâ€¦
    [90m509| [39m    [90m// Verify ownership[39m
    [90m510| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m511| [39m    [35mif[39m ([33m![39msurvey) {
    [90m512| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m226:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[94/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetTimeSpentData[2m > [22mshould handle surveys with no completed responses
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getTimeSpentData server/services/AnalyticsService.ts:[2m510:42[22m[39m
    [90m508| [39m  async getTimeSpentData(surveyId: string, userId: string): Promise<Tiâ€¦
    [90m509| [39m    [90m// Verify ownership[39m
    [90m510| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m511| [39m    [35mif[39m ([33m![39msurvey) {
    [90m512| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m243:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[95/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetEngagementMetrics[2m > [22mshould calculate engagement metrics
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getEngagementMetrics server/services/AnalyticsService.ts:[2m571:42[22m[39m
    [90m569| [39m  async getEngagementMetrics(surveyId: string, userId: string): Promisâ€¦
    [90m570| [39m    [90m// Verify ownership[39m
    [90m571| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m572| [39m    [35mif[39m ([33m![39msurvey) {
    [90m573| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m267:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[96/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetEngagementMetrics[2m > [22mshould handle zero responses gracefully
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getEngagementMetrics server/services/AnalyticsService.ts:[2m571:42[22m[39m
    [90m569| [39m  async getEngagementMetrics(surveyId: string, userId: string): Promisâ€¦
    [90m570| [39m    [90m// Verify ownership[39m
    [90m571| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m572| [39m    [35mif[39m ([33m![39msurvey) {
    [90m573| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m286:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[97/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/AnalyticsService.test.ts[2m > [22mAnalyticsService[2m > [22mgetQuestionAggregates[2m > [22mshould return aggregated question data
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'findById')[39m
[36m [2mâ¯[22m AnalyticsService.getQuestionAggregates server/services/AnalyticsService.ts:[2m646:42[22m[39m
    [90m644| [39m  [35masync[39m [34mgetQuestionAggregates[39m(surveyId[33m:[39m string[33m,[39m userId[33m:[39m string) {
    [90m645| [39m    [90m// Verify ownership[39m
    [90m646| [39m    [35mconst[39m survey [33m=[39m [35mawait[39m [35mthis[39m[33m.[39msurveyRepo[33m.[39m[34mfindById[39m(surveyId)[33m;[39m
    [90m   | [39m                                         [31m^[39m
    [90m647| [39m    [35mif[39m ([33m![39msurvey) {
    [90m648| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Survey not found"[39m)[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AnalyticsService.test.ts:[2m320:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[98/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mdefault value validation[2m > [22mshould validate date default value
[31m[1mAssertionError[22m: promise resolved "{ â€¦(6) }" instead of rejecting[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Error {[39m
[32m-   "message": "rejected promise",[39m
[31m+ {[39m
[31m+   "collectionId": "550e8400-e29b-41d4-a716-446655440000",[39m
[31m+   "defaultValue": "2025-01-01",[39m
[31m+   "id": "660e8400-e29b-41d4-a716-446655440001",[39m
[31m+   "isRequired": false,[39m
[31m+   "name": "Test Field",[39m
[31m+   "type": "date",[39m
[2m  }[22m

[36m [2mâ¯[22m tests/unit/services/CollectionFieldService.test.ts:[2m450:54[22m[39m
    [90m448| [39m        }[33m;[39m
    [90m449| [39m
    [90m450| [39m        await expect(service.createField(invalidData)).rejects.toThrowâ€¦
    [90m   | [39m                                                     [31m^[39m
    [90m451| [39m      })[33m;[39m
    [90m452| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[99/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mgetColumns[2m > [22mshould get all columns for a table
[31m[1mTypeError[22m: service.getColumns is not a function[39m
[36m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m70:36[22m[39m
    [90m 68| [39m      mockColumnsRepo[33m.[39mfindByTableId[33m.[39m[34mmockResolvedValue[39m(mockColumns)[33m;[39m
    [90m 69| [39m
    [90m 70| [39m      const result = await service.getColumns(mockTableId, mockTenantIâ€¦
    [90m   | [39m                                   [31m^[39m
    [90m 71| [39m
    [90m 72| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(mockColumns)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[100/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mgetColumns[2m > [22mshould throw 404 if table not found
[31m[1mTypeError[22m: service.getColumns is not a function[39m
[36m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m78:28[22m[39m
    [90m 76| [39m      mockTablesRepo[33m.[39mfindById[33m.[39m[34mmockResolvedValue[39m(undefined)[33m;[39m
    [90m 77| [39m
    [90m 78| [39m      [35mawait[39m [34mexpect[39m(service[33m.[39m[34mgetColumns[39m(mockTableId[33m,[39m mockTenantId))
    [90m   | [39m                           [31m^[39m
    [90m 79| [39m        [33m.[39mrejects
    [90m 80| [39m        [33m.[39m[34mtoThrow[39m([32m'Table not found'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[101/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mcreateColumn[2m > [22mshould create column with generated slug
[31m[1mError[22m: Table not found[39m
[36m [2mâ¯[22m DatavaultColumnsService.verifyTableOwnership server/services/DatavaultColumnsService.ts:[2m70:13[22m[39m
    [90m 68| [39m
    [90m 69| [39m    [35mif[39m ([33m![39mtable) {
    [90m 70| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Table not found"[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m 71| [39m    }
    [90m 72| [39m
[90m [2mâ¯[22m DatavaultColumnsService.createColumn server/services/DatavaultColumnsService.ts:[2m107:5[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m118:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[102/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mcreateColumn[2m > [22mshould ensure unique slug by appending counter
[31m[1mError[22m: Table not found[39m
[36m [2mâ¯[22m DatavaultColumnsService.verifyTableOwnership server/services/DatavaultColumnsService.ts:[2m70:13[22m[39m
    [90m 68| [39m
    [90m 69| [39m    [35mif[39m ([33m![39mtable) {
    [90m 70| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Table not found"[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m 71| [39m    }
    [90m 72| [39m
[90m [2mâ¯[22m DatavaultColumnsService.createColumn server/services/DatavaultColumnsService.ts:[2m107:5[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m157:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[103/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mcreateColumn[2m > [22mshould use provided slug if given
[31m[1mError[22m: Table not found[39m
[36m [2mâ¯[22m DatavaultColumnsService.verifyTableOwnership server/services/DatavaultColumnsService.ts:[2m70:13[22m[39m
    [90m 68| [39m
    [90m 69| [39m    [35mif[39m ([33m![39mtable) {
    [90m 70| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Table not found"[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m 71| [39m    }
    [90m 72| [39m
[90m [2mâ¯[22m DatavaultColumnsService.createColumn server/services/DatavaultColumnsService.ts:[2m107:5[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m194:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[104/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mupdateColumn[2m > [22mshould update column
[31m[1mError[22m: Access denied - table belongs to different tenant[39m
[36m [2mâ¯[22m DatavaultColumnsService.verifyTableOwnership server/services/DatavaultColumnsService.ts:[2m74:13[22m[39m
    [90m 72| [39m
    [90m 73| [39m    [35mif[39m (table[33m.[39mtenantId [33m!==[39m tenantId) {
    [90m 74| [39m      throw new Error("Access denied - table belongs to different tenaâ€¦
    [90m   | [39m            [31m^[39m
    [90m 75| [39m    }
    [90m 76| [39m  }
[90m [2mâ¯[22m DatavaultColumnsService.verifyColumnOwnership server/services/DatavaultColumnsService.ts:[2m93:5[22m[39m
[90m [2mâ¯[22m DatavaultColumnsService.updateColumn server/services/DatavaultColumnsService.ts:[2m162:20[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m239:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[105/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mupdateColumn[2m > [22mshould throw error if trying to change column type
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Cannot change column type' but got 'Access denied - table belongs to diffâ€¦'[39m

Expected: [32m"Cannot change column type"[39m
Received: [31m"Access denied - table belongs to different tenant"[39m

[36m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m271:7[22m[39m
    [90m269| [39m      mockTablesRepo[33m.[39mfindById[33m.[39m[34mmockResolvedValue[39m(mockTable)[33m;[39m
    [90m270| [39m
    [90m271| [39m      await expect(service.updateColumn(mockColumnId, mockTenantId, { â€¦
    [90m   | [39m      [31m^[39m
    [90m272| [39m        [33m.[39mrejects
    [90m273| [39m        [33m.[39m[34mtoThrow[39m([32m'Cannot change column type'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[106/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mdeleteColumn[2m > [22mshould delete column
[31m[1mError[22m: Access denied - table belongs to different tenant[39m
[36m [2mâ¯[22m DatavaultColumnsService.verifyTableOwnership server/services/DatavaultColumnsService.ts:[2m74:13[22m[39m
    [90m 72| [39m
    [90m 73| [39m    [35mif[39m (table[33m.[39mtenantId [33m!==[39m tenantId) {
    [90m 74| [39m      throw new Error("Access denied - table belongs to different tenaâ€¦
    [90m   | [39m            [31m^[39m
    [90m 75| [39m    }
    [90m 76| [39m  }
[90m [2mâ¯[22m DatavaultColumnsService.verifyColumnOwnership server/services/DatavaultColumnsService.ts:[2m93:5[22m[39m
[90m [2mâ¯[22m DatavaultColumnsService.deleteColumn server/services/DatavaultColumnsService.ts:[2m187:5[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m306:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[107/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mreorderColumns[2m > [22mshould reorder columns
[31m[1mError[22m: Table not found[39m
[36m [2mâ¯[22m DatavaultColumnsService.verifyTableOwnership server/services/DatavaultColumnsService.ts:[2m70:13[22m[39m
    [90m 68| [39m
    [90m 69| [39m    [35mif[39m ([33m![39mtable) {
    [90m 70| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m"Table not found"[39m)[33m;[39m
    [90m   | [39m            [31m^[39m
    [90m 71| [39m    }
    [90m 72| [39m
[90m [2mâ¯[22m DatavaultColumnsService.reorderColumns server/services/DatavaultColumnsService.ts:[2m205:5[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultColumnsService.test.ts:[2m330:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[108/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRows[2m > [22mshould get rows with values and pagination
[31m[1mTypeError[22m: service.getRows is not a function[39m
[36m [2mâ¯[22m tests/unit/services/DatavaultRowsService.test.ts:[2m97:36[22m[39m
    [90m 95| [39m      mockRowsRepo[33m.[39mcountByTableId[33m.[39m[34mmockResolvedValue[39m([34m1[39m)[33m;[39m
    [90m 96| [39m
    [90m 97| [39m      const result = await service.getRows(mockTableId, mockTenantId, â€¦
    [90m   | [39m                                   [31m^[39m
    [90m 98| [39m
    [90m 99| [39m      [34mexpect[39m(result[33m.[39mrows)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[109/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRow[2m > [22mshould get a single row by ID
[31m[1mTypeError[22m: this.tablesRepo.findById is not a function[39m
[36m [2mâ¯[22m DatavaultRowsService.verifyTableOwnership server/services/DatavaultRowsService.ts:[2m36:41[22m[39m
    [90m 34| [39m    tx[33m?[39m[33m:[39m [33mDbTransaction[39m
    [90m 35| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[35mvoid[39m[33m>[39m {
    [90m 36| [39m    [35mconst[39m table [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mtablesRepo[33m.[39m[34mfindById[39m(tableId[33m,[39m tx)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m 37| [39m
    [90m 38| [39m    [35mif[39m ([33m![39mtable) {
[90m [2mâ¯[22m DatavaultRowsService.verifyRowOwnership server/services/DatavaultRowsService.ts:[2m62:16[22m[39m
[90m [2mâ¯[22m DatavaultRowsService.getRow server/services/DatavaultRowsService.ts:[2m203:17[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultRowsService.test.ts:[2m163:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[110/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mcreateRow[2m > [22mshould create row with validated values
[31m[1mTypeError[22m: this.tablesRepo.findById is not a function[39m
[36m [2mâ¯[22m DatavaultRowsService.verifyTableOwnership server/services/DatavaultRowsService.ts:[2m36:41[22m[39m
    [90m 34| [39m    tx[33m?[39m[33m:[39m [33mDbTransaction[39m
    [90m 35| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[35mvoid[39m[33m>[39m {
    [90m 36| [39m    [35mconst[39m table [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mtablesRepo[33m.[39m[34mfindById[39m(tableId[33m,[39m tx)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m 37| [39m
    [90m 38| [39m    [35mif[39m ([33m![39mtable) {
[90m [2mâ¯[22m DatavaultRowsService.createRow server/services/DatavaultRowsService.ts:[2m180:16[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultRowsService.test.ts:[2m232:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[111/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mcreateRow[2m > [22mshould throw error if required field is missing
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Required column' but got 'this.tablesRepo.findById is not a funâ€¦'[39m

Expected: [32m"[7mRequired colum[27mn"[39m
Received: [31m"[7mthis.tablesRepo.findById is not a functio[27mn"[39m

[36m [2mâ¯[22m tests/unit/services/DatavaultRowsService.test.ts:[2m267:7[22m[39m
    [90m265| [39m      mockColumnsRepo[33m.[39mfindByTableId[33m.[39m[34mmockResolvedValue[39m(mockColumns)[33m;[39m
    [90m266| [39m
    [90m267| [39m      [35mawait[39m [34mexpect[39m(service[33m.[39m[34mcreateRow[39m(mockTableId[33m,[39m mockTenantId[33m,[39m {}))
    [90m   | [39m      [31m^[39m
    [90m268| [39m        [33m.[39mrejects
    [90m269| [39m        [33m.[39m[34mtoThrow[39m([32m'Required column'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[112/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mupdateRow[2m > [22mshould update row values
[31m[1mTypeError[22m: this.tablesRepo.findById is not a function[39m
[36m [2mâ¯[22m DatavaultRowsService.verifyTableOwnership server/services/DatavaultRowsService.ts:[2m36:41[22m[39m
    [90m 34| [39m    tx[33m?[39m[33m:[39m [33mDbTransaction[39m
    [90m 35| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[35mvoid[39m[33m>[39m {
    [90m 36| [39m    [35mconst[39m table [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mtablesRepo[33m.[39m[34mfindById[39m(tableId[33m,[39m tx)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m 37| [39m
    [90m 38| [39m    [35mif[39m ([33m![39mtable) {
[90m [2mâ¯[22m DatavaultRowsService.verifyRowOwnership server/services/DatavaultRowsService.ts:[2m62:16[22m[39m
[90m [2mâ¯[22m DatavaultRowsService.updateRow server/services/DatavaultRowsService.ts:[2m241:17[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultRowsService.test.ts:[2m316:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[113/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mdeleteRow[2m > [22mshould delete row
[31m[1mTypeError[22m: this.tablesRepo.findById is not a function[39m
[36m [2mâ¯[22m DatavaultRowsService.verifyTableOwnership server/services/DatavaultRowsService.ts:[2m36:41[22m[39m
    [90m 34| [39m    tx[33m?[39m[33m:[39m [33mDbTransaction[39m
    [90m 35| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[35mvoid[39m[33m>[39m {
    [90m 36| [39m    [35mconst[39m table [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mtablesRepo[33m.[39m[34mfindById[39m(tableId[33m,[39m tx)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m 37| [39m
    [90m 38| [39m    [35mif[39m ([33m![39mtable) {
[90m [2mâ¯[22m DatavaultRowsService.verifyRowOwnership server/services/DatavaultRowsService.ts:[2m62:16[22m[39m
[90m [2mâ¯[22m DatavaultRowsService.deleteRow server/services/DatavaultRowsService.ts:[2m254:5[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultRowsService.test.ts:[2m346:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[114/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mvalue type coercion[2m > [22mshould coerce number values
[31m[1mTypeError[22m: this.tablesRepo.findById is not a function[39m
[36m [2mâ¯[22m DatavaultRowsService.verifyTableOwnership server/services/DatavaultRowsService.ts:[2m36:41[22m[39m
    [90m 34| [39m    tx[33m?[39m[33m:[39m [33mDbTransaction[39m
    [90m 35| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[35mvoid[39m[33m>[39m {
    [90m 36| [39m    [35mconst[39m table [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mtablesRepo[33m.[39m[34mfindById[39m(tableId[33m,[39m tx)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m 37| [39m
    [90m 38| [39m    [35mif[39m ([33m![39mtable) {
[90m [2mâ¯[22m DatavaultRowsService.createRow server/services/DatavaultRowsService.ts:[2m180:16[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultRowsService.test.ts:[2m399:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[115/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mvalue type coercion[2m > [22mshould coerce boolean values
[31m[1mTypeError[22m: this.tablesRepo.findById is not a function[39m
[36m [2mâ¯[22m DatavaultRowsService.verifyTableOwnership server/services/DatavaultRowsService.ts:[2m36:41[22m[39m
    [90m 34| [39m    tx[33m?[39m[33m:[39m [33mDbTransaction[39m
    [90m 35| [39m  )[33m:[39m [33mPromise[39m[33m<[39m[35mvoid[39m[33m>[39m {
    [90m 36| [39m    [35mconst[39m table [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mtablesRepo[33m.[39m[34mfindById[39m(tableId[33m,[39m tx)[33m;[39m
    [90m   | [39m                                        [31m^[39m
    [90m 37| [39m
    [90m 38| [39m    [35mif[39m ([33m![39mtable) {
[90m [2mâ¯[22m DatavaultRowsService.createRow server/services/DatavaultRowsService.ts:[2m180:16[22m[39m
[90m [2mâ¯[22m tests/unit/services/DatavaultRowsService.test.ts:[2m457:23[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[116/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mgetTables[2m > [22mshould get all tables for a tenant
[31m[1mTypeError[22m: service.getTables is not a function[39m
[36m [2mâ¯[22m tests/unit/services/DatavaultTablesService.test.ts:[2m61:36[22m[39m
    [90m 59| [39m      mockTablesRepo[33m.[39mfindByTenantId[33m.[39m[34mmockResolvedValue[39m(mockTables)[33m;[39m
    [90m 60| [39m
    [90m 61| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgetTables[39m(mockTenantId[33m,[39m [35mfalse[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 62| [39m
    [90m 63| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(mockTables)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[117/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mgetTables[2m > [22mshould get tables with stats when requested
[31m[1mTypeError[22m: service.getTables is not a function[39m
[36m [2mâ¯[22m tests/unit/services/DatavaultTablesService.test.ts:[2m85:36[22m[39m
    [90m 83| [39m      mockRowsRepo[33m.[39mcountByTableId[33m.[39m[34mmockResolvedValue[39m([34m42[39m)[33m;[39m
    [90m 84| [39m
    [90m 85| [39m      [35mconst[39m result [33m=[39m [35mawait[39m service[33m.[39m[34mgetTables[39m(mockTenantId[33m,[39m [35mtrue[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m 86| [39m
    [90m 87| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[118/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mgetTable[2m > [22mshould throw 403 if table belongs to different tenant
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Forbidden' but got 'Access denied - table belongs to diffâ€¦'[39m

Expected: [32m"Forbidden"[39m
Received: [31m"Access denied - table belongs to different tenant"[39m

[36m [2mâ¯[22m tests/unit/services/DatavaultTablesService.test.ts:[2m135:7[22m[39m
    [90m133| [39m      mockTablesRepo[33m.[39mfindById[33m.[39m[34mmockResolvedValue[39m(mockTable)[33m;[39m
    [90m134| [39m
    [90m135| [39m      [35mawait[39m [34mexpect[39m(service[33m.[39m[34mgetTable[39m(mockTableId[33m,[39m mockTenantId))
    [90m   | [39m      [31m^[39m
    [90m136| [39m        [33m.[39mrejects
    [90m137| [39m        [33m.[39m[34mtoThrow[39m([32m'Forbidden'[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[119/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mverifyOwnership[2m > [22mshould return workflow if user is the creator
[31m[1mTypeError[22m: this.workflowRepo.findByIdOrSlug is not a function[39m
[36m [2mâ¯[22m WorkflowService.verifyOwnership server/services/WorkflowService.ts:[2m44:46[22m[39m
    [90m 42| [39m   */[39m
    [90m 43| [39m  async verifyOwnership(idOrSlug: string, userId: string): Promise<Worâ€¦
    [90m 44| [39m    [35mconst[39m workflow [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mworkflowRepo[33m.[39m[34mfindByIdOrSlug[39m(idOrSlug)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m 45| [39m
    [90m 46| [39m    [35mif[39m ([33m![39mworkflow) {
[90m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m58:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[120/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mverifyOwnership[2m > [22mshould throw error if workflow not found
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Workflow not found' but got 'this.workflowRepo.findByIdOrSlug is nâ€¦'[39m

Expected: [32m"[7mW[27morkflow not f[7mo[27mun[7md[27m"[39m
Received: [31m"[7mthis.w[27morkflow[7mRepo.findByIdOrSlug is[27m not [7ma [27mfun[7mction[27m"[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[121/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mverifyOwnership[2m > [22mshould throw error if user is not the creator
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Access denied - you do not own this wâ€¦' but got 'this.workflowRepo.findByIdOrSlug is nâ€¦'[39m

Expected: [32m"Access denied - you do not own this workflow"[39m
Received: [31m"this.workflowRepo.findByIdOrSlug is not a function"[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[122/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mgetWorkflowWithDetails[2m > [22mshould return workflow with sections, steps, and logic rules
[31m[1mTypeError[22m: this.workflowRepo.findByIdOrSlug is not a function[39m
[36m [2mâ¯[22m WorkflowService.verifyOwnership server/services/WorkflowService.ts:[2m44:46[22m[39m
    [90m 42| [39m   */[39m
    [90m 43| [39m  async verifyOwnership(idOrSlug: string, userId: string): Promise<Worâ€¦
    [90m 44| [39m    [35mconst[39m workflow [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mworkflowRepo[33m.[39m[34mfindByIdOrSlug[39m(idOrSlug)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m 45| [39m
    [90m 46| [39m    [35mif[39m ([33m![39mworkflow) {
[90m [2mâ¯[22m WorkflowService.getWorkflowWithDetails server/services/WorkflowService.ts:[2m91:33[22m[39m
[90m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m149:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[123/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mgetWorkflowWithDetails[2m > [22mshould throw error if user does not own workflow
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Access denied' but got 'this.workflowRepo.findByIdOrSlug is nâ€¦'[39m

Expected: [32m"Access denied"[39m
Received: [31m"this.workflowRepo.findByIdOrSlug is not a function"[39m

[36m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m162:7[22m[39m
    [90m160| [39m      mockWorkflowRepo[33m.[39mfindById[33m.[39m[34mmockResolvedValue[39m(workflow)[33m;[39m
    [90m161| [39m
    [90m162| [39m      await expect(service.getWorkflowWithDetails(workflow.id, "other-â€¦
    [90m   | [39m      [31m^[39m
    [90m163| [39m        [32m"Access denied"[39m
    [90m164| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[124/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mupdateWorkflow[2m > [22mshould update workflow if user is the owner
[31m[1mTypeError[22m: this.workflowRepo.findByIdOrSlug is not a function[39m
[36m [2mâ¯[22m WorkflowService.verifyOwnership server/services/WorkflowService.ts:[2m44:46[22m[39m
    [90m 42| [39m   */[39m
    [90m 43| [39m  async verifyOwnership(idOrSlug: string, userId: string): Promise<Worâ€¦
    [90m 44| [39m    [35mconst[39m workflow [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mworkflowRepo[33m.[39m[34mfindByIdOrSlug[39m(idOrSlug)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m 45| [39m
    [90m 46| [39m    [35mif[39m ([33m![39mworkflow) {
[90m [2mâ¯[22m WorkflowService.updateWorkflow server/services/WorkflowService.ts:[2m125:16[22m[39m
[90m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m201:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[125/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mupdateWorkflow[2m > [22mshould throw error if user does not own workflow
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Access denied' but got 'this.workflowRepo.findByIdOrSlug is nâ€¦'[39m

Expected: [32m"Access denied"[39m
Received: [31m"this.workflowRepo.findByIdOrSlug is not a function"[39m

[36m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m215:7[22m[39m
    [90m213| [39m      mockWorkflowRepo[33m.[39mfindById[33m.[39m[34mmockResolvedValue[39m(workflow)[33m;[39m
    [90m214| [39m
    [90m215| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m216| [39m        service.updateWorkflow(workflow.id, "other-user", { title: "Upâ€¦
    [90m217| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m([32m"Access denied"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[126/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mdeleteWorkflow[2m > [22mshould delete workflow if user is the owner
[31m[1mTypeError[22m: this.workflowRepo.findByIdOrSlug is not a function[39m
[36m [2mâ¯[22m WorkflowService.verifyOwnership server/services/WorkflowService.ts:[2m44:46[22m[39m
    [90m 42| [39m   */[39m
    [90m 43| [39m  async verifyOwnership(idOrSlug: string, userId: string): Promise<Worâ€¦
    [90m 44| [39m    [35mconst[39m workflow [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mworkflowRepo[33m.[39m[34mfindByIdOrSlug[39m(idOrSlug)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m 45| [39m
    [90m 46| [39m    [35mif[39m ([33m![39mworkflow) {
[90m [2mâ¯[22m WorkflowService.deleteWorkflow server/services/WorkflowService.ts:[2m133:16[22m[39m
[90m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m228:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[127/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mdeleteWorkflow[2m > [22mshould throw error if user does not own workflow
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Access denied' but got 'this.workflowRepo.findByIdOrSlug is nâ€¦'[39m

Expected: [32m"Access denied"[39m
Received: [31m"this.workflowRepo.findByIdOrSlug is not a function"[39m

[36m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m237:7[22m[39m
    [90m235| [39m      mockWorkflowRepo[33m.[39mfindById[33m.[39m[34mmockResolvedValue[39m(workflow)[33m;[39m
    [90m236| [39m
    [90m237| [39m      await expect(service.deleteWorkflow(workflow.id, "other-user")).â€¦
    [90m   | [39m      [31m^[39m
    [90m238| [39m        [32m"Access denied"[39m
    [90m239| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[128/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mchangeStatus[2m > [22mshould change workflow status to open
[31m[1mTypeError[22m: this.workflowRepo.findByIdOrSlug is not a function[39m
[36m [2mâ¯[22m WorkflowService.verifyOwnership server/services/WorkflowService.ts:[2m44:46[22m[39m
    [90m 42| [39m   */[39m
    [90m 43| [39m  async verifyOwnership(idOrSlug: string, userId: string): Promise<Worâ€¦
    [90m 44| [39m    [35mconst[39m workflow [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mworkflowRepo[33m.[39m[34mfindByIdOrSlug[39m(idOrSlug)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m 45| [39m
    [90m 46| [39m    [35mif[39m ([33m![39mworkflow) {
[90m [2mâ¯[22m WorkflowService.changeStatus server/services/WorkflowService.ts:[2m145:16[22m[39m
[90m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m251:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[129/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mchangeStatus[2m > [22mshould change workflow status to closed
[31m[1mTypeError[22m: this.workflowRepo.findByIdOrSlug is not a function[39m
[36m [2mâ¯[22m WorkflowService.verifyOwnership server/services/WorkflowService.ts:[2m44:46[22m[39m
    [90m 42| [39m   */[39m
    [90m 43| [39m  async verifyOwnership(idOrSlug: string, userId: string): Promise<Worâ€¦
    [90m 44| [39m    [35mconst[39m workflow [33m=[39m [35mawait[39m [35mthis[39m[33m.[39mworkflowRepo[33m.[39m[34mfindByIdOrSlug[39m(idOrSlug)[33m;[39m
    [90m   | [39m                                             [31m^[39m
    [90m 45| [39m
    [90m 46| [39m    [35mif[39m ([33m![39mworkflow) {
[90m [2mâ¯[22m WorkflowService.changeStatus server/services/WorkflowService.ts:[2m145:16[22m[39m
[90m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m264:36[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[130/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mchangeStatus[2m > [22mshould throw error if user does not own workflow
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Access denied' but got 'this.workflowRepo.findByIdOrSlug is nâ€¦'[39m

Expected: [32m"Access denied"[39m
Received: [31m"this.workflowRepo.findByIdOrSlug is not a function"[39m

[36m [2mâ¯[22m tests/unit/services/WorkflowService.test.ts:[2m273:7[22m[39m
    [90m271| [39m      mockWorkflowRepo[33m.[39mfindById[33m.[39m[34mmockResolvedValue[39m(workflow)[33m;[39m
    [90m272| [39m
    [90m273| [39m      await expect(service.changeStatus(workflow.id, "other-user", "opâ€¦
    [90m   | [39m      [31m^[39m
    [90m274| [39m        [32m"Access denied"[39m
    [90m275| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[131/142]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mHidden question value clearing[2m > [22mshould clear values for hidden questions
[31m[1mTypeError[22m: __vite_ssr_import_0__.stepValueRepository.findByRunAndStep is not a function[39m
[36m [2mâ¯[22m IntakeQuestionVisibilityService.clearHiddenQuestionValues server/services/IntakeQuestionVisibilityService.ts:[2m277:55[22m[39m
    [90m275| [39m    [90m// For each hidden question, check if it has a value and clear it[39m
    [90m276| [39m    [35mfor[39m ([35mconst[39m questionId [35mof[39m visibility[33m.[39mhiddenQuestions) {
    [90m277| [39m      const existingValue = await stepValueRepository.findByRunAndStepâ€¦
    [90m   | [39m                                                      [31m^[39m
    [90m278| [39m
    [90m279| [39m      [35mif[39m (existingValue) {
[90m [2mâ¯[22m tests/unit/services/intakeQuestionVisibility.test.ts:[2m406:23[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[132/142]âŽ¯[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Unhandled Errors [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1m
Vitest caught 11 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould reject connection without JWT token[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould reject connection with invalid JWT token[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Unhandled Rejection [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: [vitest] No "setupAuth" export is defined on the "../../../server/googleAuth" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:
[39m
vi.mock(import("../../../server/googleAuth"), async (importOriginal) => {
  const actual = await importOriginal()
  return {
    ...actual,
    // your mocked methods
  }
})

[90m [2mâ¯[22m VitestMocker.createError node_modules/vitest/dist/chunks/startModuleRunner.BqQUfEjB.js:[2m230:48[22m[39m
[90m [2mâ¯[22m Object.get node_modules/vitest/dist/chunks/startModuleRunner.BqQUfEjB.js:[2m279:16[22m[39m
[36m [2mâ¯[22m registerRoutes server/routes.ts:[2m34:9[22m[39m
    [90m 32| [39m[35mexport[39m [35masync[39m [35mfunction[39m [34mregisterRoutes[39m(app[33m:[39m [33mExpress[39m)[33m:[39m [33mPromise[39m[33m<[39m[33mServer[39m[33m>[39m {
    [90m 33| [39m  [90m// Setup authentication middleware[39m
    [90m 34| [39m  [35mawait[39m [34msetupAuth[39m(app)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m 35| [39m
    [90m 36| [39m  [90m// Health check endpoint for Docker health checks and monitoring[39m
[90m [2mâ¯[22m server/index.ts:[2m121:26[22m[39m
[90m [2mâ¯[22m processTicksAndRejections node:internal/process/task_queues:[2m105:5[22m[39m

[31mThis error originated in "[1mtests/integration/routes/US-A-001-login.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould reject cross-tenant access[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould sync document updates between two clients[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould track presence of multiple users[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould allow owner to make changes[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould allow builder to make changes[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould allow viewer to connect but not mutate[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould create room on first connection[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Uncaught Exception [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m
[31m[1mError[22m: connect ECONNREFUSED 127.0.0.1:5174[39m
[90m [2mâ¯[22m TCPConnectWrap.afterConnect [as oncomplete] node:net:[2m1637:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errno: -111, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 5174 }[39m
[31mThis error originated in "[1mtests/collab.server.test.ts[22m" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.[39m
[31mThe latest test that might've caused the error is "[1mshould cleanup room when all users disconnect[22m". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.[39m
[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m


[2m Test Files [22m [1m[31m29 failed[39m[22m[2m | [22m[1m[32m30 passed[39m[22m[2m | [22m[33m4 skipped[39m[90m (63)[39m
[2m      Tests [22m [1m[31m131 failed[39m[22m[2m | [22m[1m[32m803 passed[39m[22m[2m | [22m[33m191 skipped[39m[90m (1125)[39m
[2m     Errors [22m [1m[31m11 errors[39m[22m
[2m   Start at [22m 14:08:50
[2m   Duration [22m 268.20s[2m (transform 18.00s, setup 3.00s, collect 96.46s, tests 264.58s, environment 13ms, prepare 5.55s)[22m

