npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.
 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22mequals operator (uses ==, not ===)[2m > [22mshould coerce string "123" to equal number 123[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22mequals operator (uses ==, not ===)[2m > [22mshould treat null == undefined as true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22mequals operator (uses ==, not ===)[2m > [22mshould NOT coerce string "true" to boolean true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22min_list operator (uses == for comparisons)[2m > [22mshould coerce types when checking membership[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22min_list operator (uses == for comparisons)[2m > [22mshould return false if compareValue is not an array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22mnot_in_list operator[2m > [22mshould return true if compareValue is not an array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22mnumeric comparison operators[2m > [22mshould perform numeric comparison with proper types[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22mnumeric comparison operators[2m > [22mshould coerce string numbers to numeric comparison[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Type Coercion & Comparisons[2m > [22mnumeric comparison operators[2m > [22mshould handle boundary conditions with gte/lte[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mis_empty operator[2m > [22mshould catch null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mis_empty operator[2m > [22mshould catch undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mis_empty operator[2m > [22mshould catch empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mis_empty operator[2m > [22mshould NOT catch 0, false, [], or {}[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mis_not_empty operator[2m > [22mshould exclude null, undefined, and empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mis_not_empty operator[2m > [22mshould include 0, false, [], and {}[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mexists operator[2m > [22mshould return true for null (field exists with null value)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mexists operator[2m > [22mshould return false for undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mexists operator[2m > [22mshould return false for missing field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mgetFieldValue with null/undefined in path[2m > [22mshould return undefined when accessing nested field on null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mgetFieldValue with null/undefined in path[2m > [22mshould return undefined when accessing nested field on undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Null/Undefined/Empty String Handling[2m > [22mgetFieldValue with null/undefined in path[2m > [22mshould support dot notation for nested objects[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - String Operators Case Sensitivity[2m > [22mcontains operator[2m > [22mshould be CASE-SENSITIVE (SEMANTIC SURPRISE)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - String Operators Case Sensitivity[2m > [22mcontains operator[2m > [22mshould match with exact case[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - String Operators Case Sensitivity[2m > [22mstarts_with operator[2m > [22mshould be CASE-SENSITIVE[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - String Operators Case Sensitivity[2m > [22mends_with operator[2m > [22mshould be CASE-SENSITIVE[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Multi-Key Sorting[2m > [22mSort stability[2m > [22mshould maintain original order for equal values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Multi-Key Sorting[2m > [22mMulti-key priority[2m > [22mshould sort by first key, then second key for ties[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Multi-Key Sorting[2m > [22mNull placement in sorting[2m > [22mshould place nulls FIRST when sorting ascending[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Multi-Key Sorting[2m > [22mNull placement in sorting[2m > [22mshould place nulls LAST when sorting descending[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Multi-Key Sorting[2m > [22mNumeric vs lexicographic sorting[2m > [22mshould perform numeric comparison when values are numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Multi-Key Sorting[2m > [22mNumeric vs lexicographic sorting[2m > [22mshould perform lexicographic comparison when values are strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Offset & Limit[2m > [22mLimit behavior[2m > [22mshould return first N rows when limit is set[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Offset & Limit[2m > [22mLimit behavior[2m > [22mshould return ALL rows when limit = 0 (SEMANTIC SURPRISE)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Offset & Limit[2m > [22mLimit behavior[2m > [22mshould return all rows when limit is undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Offset & Limit[2m > [22mOffset behavior[2m > [22mshould skip first N rows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Offset & Limit[2m > [22mOffset behavior[2m > [22mshould return empty array when offset > total rows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Offset & Limit[2m > [22mOffset + Limit combined[2m > [22mshould skip N rows then take M rows (SQL-like pagination)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Offset & Limit[2m > [22mOffset + Limit combined[2m > [22mshould return partial result when limit exceeds remaining rows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Select (Column Projection)[2m > [22mColumn selection[2m > [22mshould return only selected columns[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Select (Column Projection)[2m > [22mColumn selection[2m > [22mshould always preserve id field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Select (Column Projection)[2m > [22mNon-existent field handling[2m > [22mshould silently ignore non-existent fields (SEMANTIC SURPRISE)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Select (Column Projection)[2m > [22mDot notation support[2m > [22mshould support nested field paths[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Deduplication[2m > [22mDedupe behavior[2m > [22mshould keep first occurrence only[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Deduplication[2m > [22mDedupe behavior[2m > [22mshould preserve order[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Deduplication[2m > [22mDedupe with nulls[2m > [22mshould treat all nulls as duplicates (only keep first)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Deduplication[2m > [22mDedupe with nulls[2m > [22mshould treat all undefineds as duplicates[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Full Transform Pipeline[2m > [22mPipeline order: filter Î“Ã¥Ã† sort Î“Ã¥Ã† offset/limit Î“Ã¥Ã† select Î“Ã¥Ã† dedupe[2m > [22mshould apply all transformations in correct order[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Full Transform Pipeline[2m > [22mInteraction: Filters with Pagination[2m > [22mshould apply pagination AFTER filtering[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Full Transform Pipeline[2m > [22mInteraction: Sort with Pagination[2m > [22mshould apply pagination AFTER sorting[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Full Transform Pipeline[2m > [22mInteraction: Dedupe after Select[2m > [22mshould apply dedupe AFTER select[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Variable Resolution[2m > [22mshould resolve variable references from context[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - Variable Resolution[2m > [22mshould handle missing variables gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - AND Combinator[2m > [22mshould require all conditions to be true with AND[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - AND Combinator[2m > [22mshould return false if any condition fails with AND[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/listPipeline.semantics.test.ts[2m > [22mList Pipeline - AND Combinator[2m > [22mshould return empty list for conflicting conditions[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/AuthService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

 [31mâ”œÃ¹[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mcreateInvite[2m > [22mshould create placeholder user for non-existent email[33m 570[2mms[22m[39m
[31m   Î“Ã¥Ã† update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"[39m
{"level":40,"time":1768088139174,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768088139186,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088139189,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088139189,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088139190,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088139190,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088139190,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768088139192,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088139194,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088139195,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088139195,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088139195,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768088139198,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mrequireAuth[2m > [22mshould authenticate with valid JWT token[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mrequireAuth[2m > [22mshould return 401 for missing token[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mrequireAuth[2m > [22mshould return 401 for invalid token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mrequireAuth[2m > [22mshould return 401 for expired token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mrequireAuth[2m > [22mshould extract token without Bearer prefix[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22moptionalAuth[2m > [22mshould authenticate with valid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22moptionalAuth[2m > [22mshould proceed without auth when no token provided[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22moptionalAuth[2m > [22mshould proceed even with invalid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mhybridAuth[2m > [22mshould authenticate with JWT Bearer token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mhybridAuth[2m > [22mshould authenticate with refresh token cookie for GET requests[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mhybridAuth[2m > [22mshould reject cookie auth for POST requests[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mhybridAuth[2m > [22mshould prioritize JWT over cookie when both present[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mhybridAuth[2m > [22mshould allow cookie auth only for safe methods[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mhybridAuth[2m > [22mshould return 401 when no auth provided[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22moptionalHybridAuth[2m > [22mshould authenticate with JWT[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22moptionalHybridAuth[2m > [22mshould authenticate with cookie for GET[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22moptionalHybridAuth[2m > [22mshould proceed without auth when none provided[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22moptionalHybridAuth[2m > [22mshould proceed even with invalid auth[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mSecurity Edge Cases[2m > [22mshould not allow token tampering[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mSecurity Edge Cases[2m > [22mshould not allow cookie auth for mutations (CSRF protection)[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mSecurity Edge Cases[2m > [22mshould reject malformed JWT[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts[2m > [22mAuth Middleware[2m > [22mSecurity Edge Cases[2m > [22mshould handle missing authorization header gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mhashPassword()[2m > [22mshould hash a password using bcrypt with 12 rounds[33m 379[2mms[22m[39m
{"level":30,"time":1768088139682,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088139683,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"responseTokens":91,"totalTokens":1303,"durationMs":1,"estimatedCostUSD":0.014849999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768088139686,"env":"test","module":"workflow-quality-validator","overall":99,"breakdown":{"aliases":100,"types":100,"structure":100,"ux":95,"completeness":100,"validation":100},"issuesCount":1,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768088139687,"env":"test","module":"ai-service","duration":6,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":99,"qualityBreakdown":{"aliases":100,"types":100,"structure":100,"ux":95,"completeness":100,"validation":100},"qualityPassed":true,"issuesCount":1,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768088139690,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768088139691,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":49,"totalTokens":1250,"durationMs":1,"estimatedCostUSD":0.013479999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768088139691,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768088139695,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768088139695,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":68,"totalTokens":1269,"durationMs":0,"estimatedCostUSD":0.01405,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768088139696,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768088139698,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768088139699,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":89,"totalTokens":1290,"durationMs":1,"estimatedCostUSD":0.014679999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768088139699,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768088139702,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1768088139702,"env":"test","module":"ai-service","attempt":0,"waitMs":1000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768088139702,"env":"test","module":"ai-service","attempt":1,"waitMs":2000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768088139703,"env":"test","module":"ai-service","attempt":2,"waitMs":4000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768088139703,"env":"test","module":"ai-service","attempt":3,"waitMs":8000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768088139703,"env":"test","module":"ai-service","attempt":4,"waitMs":16000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768088139703,"env":"test","module":"ai-service","attempt":5,"waitMs":32000,"msg":"Rate limit hit, retrying..."}
{"level":50,"time":1768088139703,"env":"test","module":"ai-service","event":"ai_request_failed","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","errorType":"RATE_LIMIT","durationMs":1,"attempts":7,"msg":"AI request failed: rate limit"}
{"level":50,"time":1768088139703,"env":"test","module":"ai-service","error":{"code":"RATE_LIMIT","details":{"originalError":"Rate limit exceeded","retryAfterSeconds":60},"troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. You've hit the AI provider's rate limit\n2. Solutions:\n   - Wait 60 seconds and try again\n   - Check your API key quota at your provider's dashboard\n   - Consider upgrading your API plan for higher limits\n   - If using free tier, you may need to wait until limits reset"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768088139705,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768088139705,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":6,"totalTokens":1207,"durationMs":0,"estimatedCostUSD":0.01219,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768088139705,"env":"test","module":"ai-service","error":{},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1768088139710,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768088139710,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"responseTokens":68,"totalTokens":1280,"durationMs":0,"estimatedCostUSD":0.004656,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768088139710,"env":"test","module":"workflow-quality-validator","overall":100,"breakdown":{"aliases":100,"types":100,"structure":100,"ux":100,"completeness":100,"validation":100},"issuesCount":0,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768088139710,"env":"test","module":"ai-service","duration":0,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":100,"qualityBreakdown":{"aliases":100,"types":100,"structure":100,"ux":100,"completeness":100,"validation":100},"qualityPassed":true,"issuesCount":0,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768088139713,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768088139713,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"responseTokens":33,"totalTokens":1234,"durationMs":0,"estimatedCostUSD":0.004098,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768088139714,"env":"test","module":"workflow-quality-validator","overall":96,"breakdown":{"aliases":100,"types":100,"structure":80,"ux":100,"completeness":90,"validation":100},"issuesCount":2,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768088139714,"env":"test","module":"ai-service","duration":1,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":96,"qualityBreakdown":{"aliases":100,"types":100,"structure":80,"ux":100,"completeness":90,"validation":100},"qualityPassed":true,"issuesCount":2,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768088139728,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"maxTokens":4000,"msg":"AI request started"}
{"level":30,"time":1768088139728,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"responseTokens":44,"totalTokens":302,"durationMs":1,"estimatedCostUSD":0.0039,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768088139742,"env":"test","module":"ai-service","duration":15,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould initialize with OpenAI configuration[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould generate a valid workflow from description[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould validate unique section IDs[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould validate unique step IDs[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould validate logic rules reference existing steps[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould handle rate limit errors[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mOpenAI Provider[2m > [22mshould handle JSON parsing errors[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mAnthropic Provider[2m > [22mshould initialize with Anthropic configuration[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mAnthropic Provider[2m > [22mshould generate a valid workflow from description[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mAnthropic Provider[2m > [22mshould strip markdown code blocks from Anthropic responses[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts[2m > [22mAIService[2m > [22mTemplate Binding Suggestions[2m > [22mshould generate binding suggestions[32m 20[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mhashPassword()[2m > [22mshould generate different hashes for same password[33m 600[2mms[22m[39m
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768088140171,"env":"test","module":"email-queue","jobId":"77be8dc0-8494-453b-bdfc-6b9933f9dcd2","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mhashPassword()[2m > [22mshould handle empty passwords[33m 308[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mhashPassword()[2m > [22mshould handle long passwords[32m 254[2mms[22m[39m
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [31mâ”œÃ¹[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mcreateInvite[2m > [22mshould create invite for existing user without creating placeholder[33m 1545[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be false // Object.is equality[39m
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mhashPassword()[2m > [22mshould handle unicode characters in password[33m 386[2mms[22m[39m
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768088141589,"env":"test","module":"email-queue","jobId":"fdaf3b2e-c9f0-471b-a888-899d85337aa8","to":"newuser_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mcomparePassword()[2m > [22mshould return true for correct password[33m 525[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mcomparePassword()[2m > [22mshould return false for incorrect password[33m 486[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 1: Create organization[33m 556[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mcreateInvite[2m > [22mshould prevent duplicate pending invites[33m 1433[2mms[22m[39m
[31m   Î“Ã¥Ã† expected [Function] to throw error including 'Pending invite already exists' but got 'Access denied: Organization admin rolÎ“Ã‡Âª'[39m
{"level":30,"time":1768088142706,"env":"test","module":"email-queue","jobId":"dd3e4d51-bd5d-424c-af4d-e6c8b2e29294","to":"org-member@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [31mâ”œÃ¹[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mcreateInvite[2m > [22mshould prevent inviting existing members[33m 797[2mms[22m[39m
[31m   Î“Ã¥Ã† Access denied: Organization admin role required[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mcomparePassword()[2m > [22mshould be case-sensitive[33m 616[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 2: Invite member via email[33m 650[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Hashing[2m > [22mcomparePassword()[2m > [22mshould handle empty password comparison[33m 558[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould accept valid email addresses[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject emails longer than 254 characters (RFC 5321)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject emails shorter than 3 characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject emails with consecutive dots[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject emails without @ symbol[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject emails without domain[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject emails with spaces[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject emails without TLD[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject null or undefined[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Validation[2m > [22mvalidateEmail()[2m > [22mshould reject emails with local part longer than 64 characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould accept valid strong passwords[32m 25[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould reject passwords shorter than 8 characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould reject passwords longer than 128 characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould reject weak passwords with zxcvbn score < 3[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould provide helpful feedback for weak passwords[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould reject password containing user's email[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould reject password containing user's name[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould accept strong password even with user inputs provided[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould accept password with exactly 8 characters if strong enough[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould accept password with exactly 128 characters if strong[32m 125[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Strength Validation (zxcvbn)[2m > [22mvalidatePasswordStrength()[2m > [22mshould return score in result object[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mcreateToken()[2m > [22mshould create a valid JWT token for a user[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mcreateToken()[2m > [22mshould include userId, email, tenantId, and role in token payload[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mcreateToken()[2m > [22mshould set token expiry to 15 minutes by default[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mcreateToken()[2m > [22mshould throw error if JWT_SECRET is not configured[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mcreateToken()[2m > [22mshould handle null tenantId and role[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould verify and decode a valid token[32m 3[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mcreateInvite[2m > [22mshould require admin access to create invite[33m 511[2mms[22m[39m
[31m   Î“Ã¥Ã† update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 3: Accept invite[33m 570[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 4: Create workflow owned by user[33m 317[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuthService.test.ts[2m > [22m[2mAuthService[2m > [22m[2mJWT Token Management[2m > [22m[2mverifyToken()[2m > [22m[2mshould throw error for invalid token signature
[22m[39mDEBUG: verifyToken threw: Invalid or malformed token InvalidTokenError

 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould throw error for expired token[33m 1134[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould throw error for invalid token signature[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould throw error for malformed token[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mverifyToken()[2m > [22mshould throw error for invalid token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mextractTokenFromHeader()[2m > [22mshould extract token from Bearer authorization header[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mextractTokenFromHeader()[2m > [22mshould return token if no Bearer prefix[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mextractTokenFromHeader()[2m > [22mshould return null for undefined header[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mextractTokenFromHeader()[2m > [22mshould return null for empty header[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mextractTokenFromHeader()[2m > [22mshould handle Bearer with multiple spaces[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mlooksLikeJwt()[2m > [22mshould return true for JWT-like tokens[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mlooksLikeJwt()[2m > [22mshould return false for non-JWT tokens[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mlooksLikeJwt()[2m > [22mshould return false for empty token[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Token Management[2m > [22mlooksLikeJwt()[2m > [22mshould return false for null/undefined[32m 44[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPortal Token Management[2m > [22mcreatePortalToken()[2m > [22mshould create a valid portal token for an email[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPortal Token Management[2m > [22mcreatePortalToken()[2m > [22mshould include email and portal flag in token payload[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPortal Token Management[2m > [22mcreatePortalToken()[2m > [22mshould set token expiry to 24 hours[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 5: Transfer workflow to organization[33m 623[2mms[22m[39m
{"level":30,"time":1768088144504,"env":"test","module":"email-queue","jobId":"76d0e4c5-8172-4ba8-991c-2e124de84ea8","to":"newuser_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPortal Token Management[2m > [22mverifyPortalToken()[2m > [22mshould verify and decode a valid portal token[32m 38[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPortal Token Management[2m > [22mverifyPortalToken()[2m > [22mshould throw error for non-portal token[32m 70[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPortal Token Management[2m > [22mverifyPortalToken()[2m > [22mshould throw error for token without email[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPortal Token Management[2m > [22mverifyPortalToken()[2m > [22mshould throw error for expired portal token[32m 1[2mms[22m[39m
{"level":30,"time":1768088144753,"env":"test","workflowId":"2aa3fecf-0eac-48c8-a754-8cc3f6a09c3d","userId":"b5215942-8362-4aa4-bd03-08d15fd904ff","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768088144759,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768088144764,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mgeneratePasswordResetToken()[2m > [22mshould generate password reset token for existing user[32m 253[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mgeneratePasswordResetToken()[2m > [22mshould return null for non-existent user[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mgeneratePasswordResetToken()[2m > [22mshould invalidate previous reset tokens[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mverifyPasswordResetToken()[2m > [22mshould return userId for valid token[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mverifyPasswordResetToken()[2m > [22mshould return null for invalid token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mverifyPasswordResetToken()[2m > [22mshould return null for expired token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mverifyPasswordResetToken()[2m > [22mshould return null for used token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mconsumePasswordResetToken()[2m > [22mshould mark token as used[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Verification[2m > [22mgenerateEmailVerificationToken()[2m > [22mshould generate verification token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Verification[2m > [22mgenerateEmailVerificationToken()[2m > [22mshould have 24 hour expiry[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Verification[2m > [22mverifyEmail()[2m > [22mshould verify email with valid token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Verification[2m > [22mverifyEmail()[2m > [22mshould return false for invalid token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Verification[2m > [22mverifyEmail()[2m > [22mshould return false for expired token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mEmail Verification[2m > [22mverifyEmail()[2m > [22mshould delete token after successful verification[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 6: Org member (user2) can access workflow[33m 418[2mms[22m[39m
{"level":40,"time":1768088145052,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used"}
{"level":40,"time":1768088145054,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1768088145056,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1768088145059,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768088145059,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768088145060,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768088145061,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mcreateRefreshToken()[2m > [22mshould create refresh token with 30-day expiry[32m 269[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mcreateRefreshToken()[2m > [22mshould store device metadata[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mvalidateRefreshToken()[2m > [22mshould return userId for valid token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mvalidateRefreshToken()[2m > [22mshould return null for revoked token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mvalidateRefreshToken()[2m > [22mshould return null for expired token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould rotate valid token and return new one[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould return null for unknown token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould revoke all tokens on reuse detection[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould return null for expired token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrevokeRefreshToken()[2m > [22mshould revoke specific token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrevokeAllUserTokens()[2m > [22mshould revoke all tokens for user[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired refresh tokens[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired password reset tokens[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired email verification tokens[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup old login attempts via accountLockoutService[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Secret Configuration[2m > [22mgetJwtSecret()[2m > [22mshould use JWT_SECRET if provided[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mJWT Secret Configuration[2m > [22mgetJwtSecret()[2m > [22mshould warn if JWT_SECRET is less than 32 characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mToken Manipulation[2m > [22mshould reject token with modified payload[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mToken Manipulation[2m > [22mshould reject token with valid structure but invalid signature[32m 1[2mms[22m[39m
{"level":30,"time":1768088145166,"env":"test","workflowId":"2aa3fecf-0eac-48c8-a754-8cc3f6a09c3d","userId":"e378ef7e-b2a7-460e-a5b0-0346e8322e0f","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 7: Org member (user2) can update workflow[32m 152[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mcreateInvite[2m > [22mshould set expiry to 7 days from now[33m 1602[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 8: Org admin (user1) can still access workflow after transfer[32m 264[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mPassword Edge Cases[2m > [22mshould handle password with special characters[33m 473[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 9: Non-member (user3) CANNOT access org workflow[32m 257[2mms[22m[39m
{"level":30,"time":1768088145889,"env":"test","module":"email-queue","jobId":"898dd714-f57f-47d2-bba4-5be073cf2397","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 10: Non-member (user3) CANNOT update org workflow[32m 271[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 11: Non-member (user3) CANNOT transfer org workflow[32m 257[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 12: Org member can see workflow in list[32m 102[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mPassword Edge Cases[2m > [22mshould handle password with only spaces[32m 240[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 13: Non-member CANNOT see workflow in list[32m 108[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mPassword Edge Cases[2m > [22mshould handle password with newlines and tabs[33m 465[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 14: Remove member from org[33m 327[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mPassword Edge Cases[2m > [22mshould reject password with null bytes (if validation exists)[33m 498[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mEmail Edge Cases[2m > [22mshould reject email with unicode domain (security fix)[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mEmail Edge Cases[2m > [22mshould reject email starting with dot (security fix)[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mEmail Edge Cases[2m > [22mshould reject email ending with dot before @ (security fix)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mEmail Edge Cases[2m > [22mshould handle email with plus addressing[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mEmail Edge Cases[2m > [22mshould handle email with subdomain[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mEmail Edge Cases[2m > [22mshould reject email with invalid TLD (single char)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mEmail Edge Cases[2m > [22mshould accept email with numeric TLD[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mSecurity Edge Cases[2m > [22mRefresh Token Security[2m > [22mshould prevent timing attacks on token validation[32m 2[2mms[22m[39m
{"level":30,"time":1768088147028,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mComplete Authentication Flow[2m > [22mshould support full user authentication lifecycle[32m 270[2mms[22m[39m
{"level":30,"time":1768088147199,"env":"test","workflowId":"2aa3fecf-0eac-48c8-a754-8cc3f6a09c3d","userId":"b5215942-8362-4aa4-bd03-08d15fd904ff","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 15: Removed member (user2) can no longer access workflow[32m 278[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mComplete Organization Workflow[2m > [22mStep 16: Re-add member and verify access restored[33m 438[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22macceptInvite[2m > [22mshould accept invite and create membership[33m 1935[2mms[22m[39m
{"level":30,"time":1768088147541,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768088147733,"env":"test","module":"email-queue","jobId":"bc9fe184-06db-44a1-ad5f-31b51e3cd64b","to":"duplicate@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
{"level":30,"time":1768088147902,"env":"test","module":"email-queue","jobId":"ef45080b-18c7-46d8-82a0-bc27bcec7d41","to":"newuser_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mPassword Reset Flow[2m > [22mshould support complete password reset workflow[33m 513[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mPassword Reset Flow[2m > [22mshould prevent reuse of password reset tokens[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mConcurrent Session Management[2m > [22mshould support multiple valid refresh tokens per user[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mConcurrent Session Management[2m > [22mshould revoke all user tokens on security event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mError Handling[2m > [22mDatabase Errors[2m > [22mshould handle database connection failures gracefully[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mError Handling[2m > [22mDatabase Errors[2m > [22mshould handle transaction failures[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mError Handling[2m > [22mToken Generation Failures[2m > [22mshould throw error if JWT signing fails[32m 2[2mms[22m[39m
{"level":30,"time":1768088148032,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPerformance & Scalability[2m > [22mBcrypt Performance[2m > [22mshould hash password in reasonable time (< 500ms)[33m 414[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mEdge Cases and Security[2m > [22mCannot invite same email twice (pending invite exists)[33m 938[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPerformance & Scalability[2m > [22mBcrypt Performance[2m > [22mshould compare password in reasonable time (< 500ms)[33m 499[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPerformance & Scalability[2m > [22mJWT Performance[2m > [22mshould create JWT token in < 10ms[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPerformance & Scalability[2m > [22mJWT Performance[2m > [22mshould verify JWT token in < 10ms[32m 2[2mms[22m[39m
{"level":30,"time":1768088148677,"env":"test","module":"email-queue","jobId":"c870851b-51d2-4659-8dad-2262fb64a45d","to":"expired@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
{"level":30,"time":1768088148700,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088149087,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088149169,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088149179,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088149204,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088149267,"env":"test","module":"user-credentials-repository","userId":"YhWybwpd1JAqWGeMI44Pq","msg":"User credentials created"}
{"level":30,"time":1768088149472,"env":"test","module":"auth-routes","userId":"YhWybwpd1JAqWGeMI44Pq","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1768088149495,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22macceptInvite[2m > [22mshould convert placeholder user to real user on accept[33m 2043[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mGET /api/auth/sessions - List Active Sessions[2m > [22mshould list all active sessions for current user[33m 625[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 0 to be greater than or equal to 2[39m
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mEdge Cases and Security[2m > [22mCannot accept expired invite[33m 804[2mms[22m[39m
{"level":30,"time":1768088149671,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mEdge Cases and Security[2m > [22mCannot transfer workflow to org user is not a member of[33m 656[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mEdge Cases and Security[2m > [22mMember cannot promote themselves to admin[32m 54[2mms[22m[39m
{"level":30,"time":1768088149791,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088149850,"env":"test","module":"user-credentials-repository","userId":"W3tvr7x719q48dOeL7d6W","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mEdge Cases and Security[2m > [22mMember cannot remove admin[32m 52[2mms[22m[39m
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088149958,"env":"test","module":"auth-routes","userId":"W3tvr7x719q48dOeL7d6W","sessionCount":0,"msg":"Listed active sessions"}
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mEdge Cases and Security[2m > [22mOnly members can view organization details[32m 110[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts[2m > [22mOrganization Workflow Integration Tests[2m > [22mEdge Cases and Security[2m > [22mOnly members can view organization members list[32m 50[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088150065,"env":"test","module":"email-queue","jobId":"f57a66ad-a08d-429d-9961-b5893d3465bc","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mGET /api/auth/sessions - List Active Sessions[2m > [22mshould mark current session as current[33m 474[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be defined[39m
stderr | tests/integration/organizations-workflow.test.ts > Organization Workflow Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-workflow.test.ts:81:7 {
  length: 335,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(e378ef7e-b2a7-460e-a5b0-0346e8322e0f) is still referenced from table "audit_logs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_user_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

stderr | tests/integration/session.management.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:286:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

{"level":30,"time":1768088150335,"env":"test","module":"user-credentials-repository","userId":"ByMge3fertIzPwpIRbLVC","msg":"User credentials created"}
{"level":30,"time":1768088150448,"env":"test","module":"auth-routes","userId":"ByMge3fertIzPwpIRbLVC","sessionCount":0,"msg":"Listed active sessions"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22macceptInvite[2m > [22mshould reject expired invite[33m 1745[2mms[22m[39m
{"level":30,"time":1768088150787,"env":"test","module":"user-credentials-repository","userId":"5cFLtHtmcwMhtraxE7gB8","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mGET /api/auth/sessions - List Active Sessions[2m > [22mshould return empty array when user has no active sessions[33m 490[2mms[22m[39m
{"level":30,"time":1768088150800,"env":"test","module":"user-credentials-repository","userId":"CUlLNNE8YxUIadk0YXU7_","msg":"User credentials created"}
{"level":30,"time":1768088150897,"env":"test","module":"auth-routes","userId":"5cFLtHtmcwMhtraxE7gB8","sessionCount":0,"msg":"Listed active sessions"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mGET /api/auth/sessions - List Active Sessions[2m > [22mshould not include expired sessions[33m 448[2mms[22m[39m
{"level":30,"time":1768088151180,"env":"test","module":"user-credentials-repository","userId":"52f5911a-d7d4-4422-93b6-a9f46189f8f0","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould refresh access token with valid refresh token[33m 685[2mms[22m[39m
{"level":30,"time":1768088151287,"env":"test","module":"email-queue","jobId":"95d28696-63b2-4315-9eb1-d787fcdc9fa2","to":"test-1768088150739-6fyd79@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088151331,"env":"test","module":"user-credentials-repository","userId":"F-2A6uQlU87cr6JPbacPn","msg":"User credentials created"}
{"level":30,"time":1768088151346,"env":"test","module":"auth-routes","userId":"52f5911a-d7d4-4422-93b6-a9f46189f8f0","email":"test-1768088150739-6fyd79@example.com","msg":"User registered"}
{"level":50,"time":1768088151406,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088151493,"env":"test","module":"auth-routes","userId":"F-2A6uQlU87cr6JPbacPn","sessionCount":0,"msg":"Listed active sessions"}
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould complete full MFA setup flow[33m 1114[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'mfaEnabled')[39m
{"level":30,"time":1768088151534,"env":"test","module":"user-credentials-repository","userId":"YGq1k-oT8PALVquvtmovs","msg":"User credentials created"}
{"level":30,"time":1768088151567,"env":"test","module":"user-credentials-repository","userId":"b283be36-7052-46a1-a46c-e2bb7e00b9a7","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mGET /api/auth/sessions - List Active Sessions[2m > [22mshould not include revoked sessions[33m 596[2mms[22m[39m
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould trust current device
[22m[39m[TEST UTILS] MFA Secret verified for f3cb5e3a40958318b0729a8f4d8f5f1f

{"level":30,"time":1768088151669,"env":"test","module":"email-queue","jobId":"87b43965-c3f2-44e5-bf7c-43d9e2e537cb","to":"test-1768088151101-vc2r8p@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1768088151715,"env":"test","module":"auth-service","userId":"YGq1k-oT8PALVquvtmovs","tokenHash":"9c0d13e29d8d3f1c7fdd8eb28a9b3b6346da77e9b044c581249ba3e18227ad17","msg":"Security: REUSED REFRESH TOKEN DETECTED (Concurrent). Revoking all sessions."}
{"level":50,"time":1768088151733,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088151729,"env":"test","module":"auth-routes","userId":"b283be36-7052-46a1-a46c-e2bb7e00b9a7","email":"test-1768088151101-vc2r8p@example.com","msg":"User registered"}
{"level":30,"time":1768088151798,"env":"test","module":"email-queue","jobId":"efca1e12-aa75-4b7d-b397-47169466c0db","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088151880,"env":"test","module":"user-credentials-repository","userId":"gXi1Zm-UWAO4g7x_gyC9l","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould rotate refresh token after use[33m 668[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/register[2m > [22mshould register a new user successfully[33m 1519[2mms[22m[39m
{"level":30,"time":1768088151995,"env":"test","module":"auth-routes","userId":"gXi1Zm-UWAO4g7x_gyC9l","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1768088152019,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088152019,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088152132,"env":"test","module":"user-credentials-repository","userId":"JyMRW9FCwHlhsBzj--QqA","msg":"User credentials created"}
{"level":50,"time":1768088152201,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088152291,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould return 401 when refresh token is missing[33m 408[2mms[22m[39m
{"level":50,"time":1768088152300,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768088152318,"env":"test","module":"mfa-service","userId":"f3cb5e3a40958318b0729a8f4d8f5f1f","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088152318,"env":"test","module":"auth-routes","userId":"f3cb5e3a40958318b0729a8f4d8f5f1f","msg":"MFA verification failed during login"}
{"level":50,"time":1768088152325,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould list all active sessions for current user[33m 1976[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
{"level":30,"time":1768088152413,"env":"test","module":"user-credentials-repository","userId":"pAR2T0SRFpcYBVVcHsZR8","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mGET /api/auth/sessions - List Active Sessions[2m > [22mshould parse device name from user agent[33m 502[2mms[22m[39m
{"level":50,"time":1768088152418,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mPOST /api/auth/trust-device[2m > [22mshould trust current device[33m 1659[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mComplete Registration Î“Ã¥Ã† Login Flow[2m > [22mshould complete registration, verify email, then login[33m 1344[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 403 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mGET /api/auth/sessions - List Active Sessions[2m > [22mshould return 401 for unauthenticated request[33m 423[2mms[22m[39m
{"level":50,"time":1768088152533,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088152540,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088152547,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088152553,"env":"test","module":"user-credentials-repository","userId":"1RDePsBJvegJsbLXvy_z1","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould reject invalid TOTP code during setup[33m 1135[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 400 // Object.is equality[39m
{"level":40,"time":1768088152669,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","msg":"Security: Unknown refresh token used"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22macceptInvite[2m > [22mshould reject already accepted invite[33m 2059[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould return 401 for invalid refresh token[33m 481[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/register[2m > [22mshould return 400 for invalid email format[33m 854[2mms[22m[39m
{"level":30,"time":1768088152803,"env":"test","module":"user-credentials-repository","userId":"WJcKknenx7ZBGi0rl3Nyx","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/:sessionId - Revoke Session[2m > [22mshould revoke a specific session[33m 487[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be defined[39m
{"level":30,"time":1768088153054,"env":"test","module":"user-credentials-repository","userId":"P6zjHzGgVDRDfi-xES9Wv","msg":"User credentials created"}
{"level":40,"time":1768088153228,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768088153265,"env":"test","module":"user-credentials-repository","userId":"dqA3UaMWQ1EFRynbdc-Ip","msg":"User credentials created"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould set trust expiry to 30 days
[22m[39m[TEST UTILS] MFA Secret verified for ec5aa8e2b849c70efd67da12985944f4

{"level":50,"time":1768088153298,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould return 401 for expired refresh token[33m 559[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/:sessionId - Revoke Session[2m > [22mshould return 404 for non-existent session[33m 363[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould not allow MFA setup if already enabled
[22m[39m[TEST UTILS] MFA Secret verified for bdfb0e18e18f5ab60a3464a520514d0a

{"level":50,"time":1768088153584,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088153602,"env":"test","module":"user-credentials-repository","userId":"z-x_BSm73WhZUJcMWS8T4","msg":"User credentials created"}
{"level":30,"time":1768088153666,"env":"test","module":"user-credentials-repository","userId":"QYYfyn6t-UO8GEUQul3KJ","msg":"User credentials created"}
{"level":40,"time":1768088153683,"env":"test","workflowId":"8d7548fe-5ea8-4bb3-b512-6600e1b08227","msg":"No current or pinned version found for workflow, run might be unstable"}
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/register[2m > [22mshould return 400 for weak password[33m 877[2mms[22m[39m
{"level":30,"time":1768088153727,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":40,"time":1768088153761,"env":"test","module":"auth-service","userId":"z-x_BSm73WhZUJcMWS8T4","tokenHash":"eb0cac8ce3cfa817a988158573bad95da2b158d2ceaab811986862932ca00575","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":50,"time":1768088153856,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088153860,"env":"test","module":"writeback-execution-service","runId":"c783814e-9531-482c-8129-e6e53bed1c36","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","msg":"Executing writeback mappings for completed run"}
{"level":30,"time":1768088153909,"env":"test","module":"writeback-execution-service","runId":"c783814e-9531-482c-8129-e6e53bed1c36","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","mappingCount":1,"msg":"Found writeback mappings"}
{"level":50,"time":1768088153862,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088153973,"env":"test","module":"mfa-service","userId":"ec5aa8e2b849c70efd67da12985944f4","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088153973,"env":"test","module":"auth-routes","userId":"ec5aa8e2b849c70efd67da12985944f4","msg":"MFA verification failed during login"}
{"level":50,"time":1768088153980,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088153888,"env":"test","module":"auth-routes","userId":"f3e8d399f8587775449fb362d922e8c2","msg":"User logged in successfully"}
{"level":30,"time":1768088153945,"env":"test","module":"audit-log-service","userId":"f3e8d399f8587775449fb362d922e8c2","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould return 401 for revoked refresh token[33m 585[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/:sessionId - Revoke Session[2m > [22mshould prevent revoking current session[33m 564[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mPOST /api/auth/trust-device[2m > [22mshould set trust expiry to 30 days[33m 1645[2mms[22m[39m
[31m   Î“Ã¥Ã† expected NaN to be 30 // Object.is equality[39m
{"level":50,"time":1768088154098,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088154123,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088154131,"env":"test","module":"writeback-execution-service","runId":"c783814e-9531-482c-8129-e6e53bed1c36","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","mappingId":"e195cec0-f5c3-4752-af38-b34892d06f17","tableId":"7b0d61b1-3c84-460c-bfee-5737a9dc8823","msg":"Executing writeback mapping"}
{"level":30,"time":1768088154157,"env":"test","module":"email-queue","jobId":"f9a63456-d5d2-4ba6-a031-f965c6ece36f","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould not allow MFA setup if already enabled[33m 1547[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be true // Object.is equality[39m
{"level":30,"time":1768088154219,"env":"test","module":"user-credentials-repository","userId":"0-bTVFgCOW9AYe-0XEvSV","msg":"User credentials created"}
{"level":50,"time":1768088154226,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088154237,"env":"test","module":"user-credentials-repository","userId":"q0P5lzVPkthh8-DJdTXa0","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould mark current session correctly[33m 1922[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'find')[39m
{"level":40,"time":1768088154401,"env":"test","module":"auth-service","tokenHash":"0ddcd74f57914eb7b481166ac6d6b4b2cd367390fc2f281d6823edc2dcd9bf7b","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1768088154401,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088154496,"env":"test","module":"user-credentials-repository","userId":"b634a446-f85f-4943-8973-88597f50cbd5","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould return 401 when user is not found[33m 587[2mms[22m[39m
{"level":30,"time":1768088154558,"env":"test","module":"writeback-execution-service","runId":"c783814e-9531-482c-8129-e6e53bed1c36","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","mappingId":"e195cec0-f5c3-4752-af38-b34892d06f17","columnCount":3,"msg":"Successfully created DataVault row"}
{"level":30,"time":1768088154558,"env":"test","module":"writeback-execution-service","runId":"c783814e-9531-482c-8129-e6e53bed1c36","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","rowsCreated":1,"errorCount":0,"msg":"Writeback execution completed"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/:sessionId - Revoke Session[2m > [22mshould prevent revoking another user's session[33m 612[2mms[22m[39m
{"level":30,"time":1768088154606,"env":"test","module":"email-queue","jobId":"ee2cc425-93ac-4604-a8bd-7c6b423d22e3","to":"test-1768088154018-9zq7l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088154665,"env":"test","module":"auth-routes","userId":"b634a446-f85f-4943-8973-88597f50cbd5","email":"test-1768088154018-9zq7l@example.com","msg":"User registered"}
{"level":50,"time":1768088154678,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088154815,"env":"test","module":"user-credentials-repository","userId":"ugyuFPrhUxCwZaitb6f_4","msg":"User credentials created"}
{"level":30,"time":1768088154840,"env":"test","module":"user-credentials-repository","userId":"c5LgzTSrl-1uc2xdQmlzU","msg":"User credentials created"}
{"level":50,"time":1768088154845,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/workflows/runtime-pipelines.test.ts[2m > [22mRuntime Pipelines Integration Tests[2m > [22mWriteback Execution Pipeline[2m > [22mshould create DataVault row on workflow completion[33m 972[2mms[22m[39m
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould update expiry if device already trusted
[22m[39m[TEST UTILS] MFA Secret verified for 2fcf38bdc0195a965053c88627f406d0

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/:sessionId - Revoke Session[2m > [22mshould return 401 for unauthenticated request[33m 399[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mAccount Lockout Flow[2m > [22mshould lock account after 5 failed attempts, then unlock after waiting[33m 2650[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 423 // Object.is equality[39m
{"level":50,"time":1768088155218,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088155223,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould update refresh token metadata on rotation[33m 732[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be defined[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22macceptInvite[2m > [22mshould verify email matches invite[33m 1926[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould generate unique backup codes[33m 1125[2mms[22m[39m
[31m   Î“Ã¥Ã† expected +0 to be 10 // Object.is equality[39m
{"level":30,"time":1768088155369,"env":"test","module":"user-credentials-repository","userId":"PyeMtVfkLfKPd7St9wQKP","msg":"User credentials created"}
{"level":50,"time":1768088155370,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088155498,"env":"test","module":"user-credentials-repository","userId":"ZcnVLWfjiTSsTnXdO9LT8","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/register[2m > [22mshould return 409 for duplicate email[33m 1585[2mms[22m[39m
{"level":30,"time":1768088155567,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"mode":"create","tableId":"bfcc7e6e-4904-493d-8365-f069b973e19c","dataSourceId":"d48e07b1-2852-407e-900f-a326f055665c","columnMappings":[{"value":"{{14a614c9-7ce0-485a-a808-3e286c767c35}}","columnId":"11a60f32-3304-47b9-b89a-d3aab6fc3d6e"}]},"tableId":"bfcc7e6e-4904-493d-8365-f069b973e19c","preview":false,"msg":"Starting write execution"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22macceptInvite[2m > [22mshould reject invalid token[33m 961[2mms[22m[39m
{"level":50,"time":1768088155670,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088155702,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088155716,"env":"test","module":"auth-routes","userId":"PyeMtVfkLfKPd7St9wQKP","msg":"All other sessions revoked"}
{"level":30,"time":1768088155770,"env":"test","module":"audit-log-service","userId":"PyeMtVfkLfKPd7St9wQKP","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":40,"time":1768088155781,"env":"test","module":"auth-service","userId":"ZcnVLWfjiTSsTnXdO9LT8","tokenHash":"6c998e2134434630415316a854b8d46baeb1bdf91d4a2ab7d80057cd266b5a62","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768088155784,"env":"test","module":"writeback-execution-service","runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","msg":"Executing writeback mappings for completed run"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1768088155812,"env":"test","module":"mfa-service","userId":"2fcf38bdc0195a965053c88627f406d0","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088155812,"env":"test","module":"auth-routes","userId":"2fcf38bdc0195a965053c88627f406d0","msg":"MFA verification failed during login"}
{"level":50,"time":1768088155818,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088155814,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould exclude revoked sessions[33m 1493[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'id')[39m
{"level":30,"time":1768088155835,"env":"test","module":"writeback-execution-service","runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","mappingCount":1,"msg":"Found writeback mappings"}
{"level":50,"time":1768088155937,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/all - Logout All Other Devices[2m > [22mshould revoke all sessions except current[33m 986[2mms[22m[39m
[31m   Î“Ã¥Ã† expected +0 to be 1 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould handle concurrent refresh token requests (token reuse detection)[33m 702[2mms[22m[39m
{"level":30,"time":1768088156022,"env":"test","module":"user-credentials-repository","userId":"f79b0053-a9b8-4861-901b-6ecc071cc647","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mPOST /api/auth/trust-device[2m > [22mshould update expiry if device already trusted[33m 1959[2mms[22m[39m
[31m   Î“Ã¥Ã† expected false to be true // Object.is equality[39m
{"level":30,"time":1768088156050,"env":"test","module":"writeback-execution-service","runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","mappingId":"e195cec0-f5c3-4752-af38-b34892d06f17","tableId":"7b0d61b1-3c84-460c-bfee-5737a9dc8823","msg":"Executing writeback mapping"}
{"level":50,"time":1768088156082,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088156126,"env":"test","module":"email-queue","jobId":"1eb098d9-7da3-4270-aa8e-e331ebc14cb2","to":"test-1768088155557-0oxrn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088156177,"env":"test","module":"auth-routes","userId":"f79b0053-a9b8-4861-901b-6ecc071cc647","email":"test-1768088155557-0oxrn@example.com","msg":"User registered"}
{"level":30,"time":1768088156213,"env":"test","module":"user-credentials-repository","userId":"iIa8P_89KRsEYm2i7TyR8","msg":"User credentials created"}
{"level":30,"time":1768088156236,"env":"test","module":"user-credentials-repository","userId":"e3WYZVcjC0E5vYrZ9PHsz","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/dataBlocks.test.ts[2m > [22mData Block Integration Tests[2m > [22mshould write data to DataVault via WriteBlock[33m 2872[2mms[22m[39m
{"level":50,"time":1768088156351,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088156354,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088156452,"env":"test","module":"auth-routes","userId":"e3WYZVcjC0E5vYrZ9PHsz","msg":"All other sessions revoked"}
 [32mÎ“Â£Ã´[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mPOST /api/auth/trust-device[2m > [22mshould require authentication[33m 414[2mms[22m[39m
{"level":30,"time":1768088156466,"env":"test","module":"writeback-execution-service","runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","mappingId":"e195cec0-f5c3-4752-af38-b34892d06f17","columnCount":3,"msg":"Successfully created DataVault row"}
{"level":30,"time":1768088156466,"env":"test","module":"writeback-execution-service","runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","workflowId":"099635cf-6c39-444d-b3f0-5bf3ce3f6113","rowsCreated":1,"errorCount":0,"msg":"Writeback execution completed"}
{"level":30,"time":1768088156466,"env":"test","runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","rowsCreated":1,"msg":"DataVault writeback completed"}
{"level":30,"time":1768088156466,"env":"test","runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","service":"DocumentGenerationService","msg":"Starting document generation for run"}
{"level":50,"time":1768088156490,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088156497,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768088156508,"env":"test","module":"audit-log-service","userId":"e3WYZVcjC0E5vYrZ9PHsz","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould set secure cookie in production[33m 650[2mms[22m[39m
{"level":40,"time":1768088156600,"env":"test","workflowId":"0d99da2c-603f-403a-9e19-01810ca2b70b","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":40,"time":1768088156622,"env":"test","runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","service":"DocumentGenerationService","allSections":[{"id":"38463fd8-1f0d-4d3f-a7fe-6de4ace02f64","config":{}}],"runId":"a7b98614-db37-4724-b5c8-8033f23f2f46","msg":"No Final Documents sections found, skipping generation. This might cause the frontend to hang."}
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Setup Flow[2m > [22mshould store hashed backup codes[33m 1326[2mms[22m[39m
[31m   Î“Ã¥Ã† expected [] to have a length of 10 but got +0[39m
{"level":30,"time":1768088156737,"env":"test","module":"email-queue","jobId":"88d94ecc-4f9d-4b6e-8022-3a9045831f6f","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mAccount Lockout Flow[2m > [22mshould record all login attempts[33m 1729[2mms[22m[39m
[31m   Î“Ã¥Ã† expected +0 to be 3 // Object.is equality[39m
{"level":30,"time":1768088156850,"env":"test","module":"user-credentials-repository","userId":"7UYYnY9_vCmvmnjApYCGa","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/all - Logout All Other Devices[2m > [22mshould revoke all trusted devices[33m 726[2mms[22m[39m
{"level":50,"time":1768088156944,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088156942,"env":"test","module":"user-credentials-repository","userId":"U0rnFcGkbIyyvbIoNhipM","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/register[2m > [22mshould set httpOnly refresh token cookie[33m 1460[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/all - Logout All Other Devices[2m > [22mshould return 400 when no active session found[33m 390[2mms[22m[39m
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould list all trusted devices
[22m[39m[TEST UTILS] MFA Secret verified for 71a468ee1fb0f363c5bca5c1c9261ae8

{"level":30,"time":1768088157292,"env":"test","module":"user-credentials-repository","userId":"NsoEZRpoi_qHGNJO9yMrQ","msg":"User credentials created"}
{"level":50,"time":1768088157297,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mDELETE /api/auth/sessions/all - Logout All Other Devices[2m > [22mshould return 401 for unauthenticated request[33m 351[2mms[22m[39m
{"level":50,"time":1768088157441,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/integration/workflows/runtime-pipelines.test.ts[2m > [22mRuntime Pipelines Integration Tests[2m > [22mWriteback Execution Pipeline[2m > [22mshould execute writebacks via RunService.completeRun()[33m 2402[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/workflows/runtime-pipelines.test.ts[2m > [22mRuntime Pipelines Integration Tests[2m > [22mDocument Generation Pipeline[2m > [22mshould skip document generation when visibleIf condition is false[32m 166[2mms[22m[39m
{"level":30,"time":1768088157558,"env":"test","module":"user-credentials-repository","userId":"qUyGJ4R-bjkaENVxZ9FHR","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould set proper cookie attributes[33m 641[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould require MFA for enabled users
[22m[39m[TEST UTILS] MFA Secret verified for 3d73ad436c1143bb826c1413e5e51292

{"level":30,"time":1768088157692,"env":"test","module":"user-credentials-repository","userId":"KszoQKlfFrJxSFXJvaz8l","msg":"User credentials created"}
{"level":50,"time":1768088157742,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/integration/workflows/runtime-pipelines.test.ts[2m > [22mRuntime Pipelines Integration Tests[2m > [22mDocument Generation Pipeline[2m > [22mshould generate document when visibleIf condition is true[32m 223[2mms[22m[39m
{"level":30,"time":1768088157805,"env":"test","module":"auth-routes","userId":"KszoQKlfFrJxSFXJvaz8l","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":50,"time":1768088157806,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088157807,"env":"test","workflowId":"0d99da2c-603f-403a-9e19-01810ca2b70b","queryId":"ab9d62a0-3d92-4636-8013-03a19b29dcdc","outputVar":"my_results","msg":"Executing query block"}
{"level":50,"time":1768088157813,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088157837,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mgetPendingInvitesForUser[2m > [22mshould return pending invites for user email[33m 1635[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould order sessions by last used (most recent first)[33m 2089[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'length')[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould include user role information in response[33m 713[2mms[22m[39m
{"level":40,"time":1768088157947,"env":"test","module":"mfa-service","userId":"71a468ee1fb0f363c5bca5c1c9261ae8","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088157947,"env":"test","module":"auth-routes","userId":"71a468ee1fb0f363c5bca5c1c9261ae8","msg":"MFA verification failed during login"}
{"level":50,"time":1768088157952,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088158067,"env":"test","module":"auth-routes","userId":"87c7ce0bf750847a8f846f090586143f","msg":"User logged in successfully"}
{"level":30,"time":1768088158125,"env":"test","module":"audit-log-service","userId":"87c7ce0bf750847a8f846f090586143f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [31mâ”œÃ¹[39m tests/integration/dataBlocks.test.ts[2m > [22mData Block Integration Tests[2m > [22mshould query data from DataVault via QueryBlock and use in Logic[33m 1854[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 0 to be greater than 0[39m
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768088158218,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088158230,"env":"test","module":"user-credentials-repository","userId":"j19e7HOewyJewLH6ZA1ZM","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould login with valid credentials[33m 1572[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
{"level":30,"time":1768088158284,"env":"test","module":"user-credentials-repository","userId":"LkAzPdxhiYhYDQQdV3lhT","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mTrusted Devices Management[2m > [22mPOST /api/auth/trust-device[2m > [22mshould mark current device as trusted[33m 566[2mms[22m[39m
{"level":50,"time":1768088158300,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088158330,"env":"test","module":"mfa-service","userId":"71a468ee1fb0f363c5bca5c1c9261ae8","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088158331,"env":"test","module":"auth-routes","userId":"71a468ee1fb0f363c5bca5c1c9261ae8","msg":"MFA verification failed during login"}
{"level":50,"time":1768088158337,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088158369,"env":"test","module":"email-queue","jobId":"870e8835-61a6-46ab-b3fe-9720b4d0b3a4","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768088158395,"env":"test","module":"auth-routes","userId":"LkAzPdxhiYhYDQQdV3lhT","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Login Flow[2m > [22mshould require MFA for enabled users[33m 1752[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
{"level":30,"time":1768088158556,"env":"test","module":"auth-routes","userId":"LkAzPdxhiYhYDQQdV3lhT","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":50,"time":1768088158563,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088158601,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Lifecycle[2m > [22mshould create refresh token on login[33m 724[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
{"level":30,"time":1768088158687,"env":"test","module":"mfa-service","userId":"87c7ce0bf750847a8f846f090586143f","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768088158688,"env":"test","module":"mfa-service","userId":"87c7ce0bf750847a8f846f090586143f","msg":"Generated TOTP secret"}
{"level":30,"time":1768088158688,"env":"test","module":"auth-routes","userId":"87c7ce0bf750847a8f846f090586143f","msg":"MFA setup initiated"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mTrusted Devices Management[2m > [22mPOST /api/auth/trust-device[2m > [22mshould update existing trusted device expiry[33m 749[2mms[22m[39m
{"level":40,"time":1768088158724,"env":"test","module":"mfa-service","userId":"71a468ee1fb0f363c5bca5c1c9261ae8","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088158724,"env":"test","module":"auth-routes","userId":"71a468ee1fb0f363c5bca5c1c9261ae8","msg":"MFA verification failed during login"}
{"level":50,"time":1768088158731,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould list all trusted devices[33m 2377[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
{"level":30,"time":1768088158946,"env":"test","module":"user-credentials-repository","userId":"kgh6iYmY8VPKKQmIs6wNt","msg":"User credentials created"}
{"level":30,"time":1768088158986,"env":"test","module":"user-credentials-repository","userId":"emV-T9MD-FuFBt2VRZpHC","msg":"User credentials created"}
{"level":30,"time":1768088159100,"env":"test","module":"auth-routes","userId":"emV-T9MD-FuFBt2VRZpHC","deviceCount":2,"msg":"Listed trusted devices"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mTrusted Devices Management[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould list all trusted devices[33m 489[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Lifecycle[2m > [22mshould revoke refresh token on logout[33m 542[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be true // Object.is equality[39m
 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mMFA Enrollment and Login Flow[2m > [22mshould complete MFA setup and login with TOTP[33m 2382[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be defined[39m
{"level":50,"time":1768088159294,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088159319,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould complete MFA login with valid TOTP
[22m[39m[TEST UTILS] MFA Secret verified for 9789513c7cb8419f777283ace885ceb5

{"level":30,"time":1768088159568,"env":"test","module":"user-credentials-repository","userId":"JzqSjIUWSH_yLjMP8ZKIr","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mgetPendingInvitesForUser[2m > [22mshould not return expired invites[33m 1691[2mms[22m[39m
{"level":50,"time":1768088159588,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088159603,"env":"test","module":"user-credentials-repository","userId":"B8pml89Qihiav20y9n38q","msg":"User credentials created"}
{"level":30,"time":1768088159677,"env":"test","module":"auth-routes","userId":"JzqSjIUWSH_yLjMP8ZKIr","deviceCount":0,"msg":"Listed trusted devices"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Lifecycle[2m > [22mshould handle logout without refresh token gracefully[33m 551[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mTrusted Devices Management[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould not include revoked devices[33m 575[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould return 401 for invalid password[33m 1523[2mms[22m[39m
{"level":50,"time":1768088159871,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088159877,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088159954,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088159981,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould filter sessions by current user only[33m 2065[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'length')[39m
{"level":50,"time":1768088159990,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088160055,"env":"test","module":"email-queue","jobId":"fafe5f5e-9132-43c1-b31f-6263d989f882","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768088160058,"env":"test","module":"user-credentials-repository","userId":"J84OQi4KW4lh-LPGFl1H3","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould mark current device[33m 938[2mms[22m[39m
[31m   Î“Ã¥Ã† [TEST UTILS] MFA Secret verification failed for 411762c67fbdd3586e9573b936311eda[39m
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Login Flow[2m > [22mshould complete MFA login with valid TOTP[33m 1652[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be true // Object.is equality[39m
{"level":30,"time":1768088160182,"env":"test","module":"user-credentials-repository","userId":"-PKFqJ2fG21fPNPzHZ2Zy","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mMFA Enrollment and Login Flow[2m > [22mshould login with backup code when TOTP unavailable[33m 1304[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'secret')[39m
{"level":30,"time":1768088160217,"env":"test","module":"auth-routes","userId":"J84OQi4KW4lh-LPGFl1H3","deviceId":"296706f8-f0b3-4556-a2f9-c10f1f16fcd3","msg":"Trusted device revoked"}
{"level":50,"time":1768088160282,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088160293,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mTrusted Devices Management[2m > [22mDELETE /api/auth/trusted-devices/:deviceId[2m > [22mshould revoke a trusted device[33m 590[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be true // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mGET /api/auth/sessions[2m > [22mshould return 401 for unauthenticated request[33m 416[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Lifecycle[2m > [22mshould support multiple active refresh tokens per user[33m 743[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 0 to be greater than or equal to 3[39m
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould exclude revoked devices[33m 897[2mms[22m[39m
[31m   Î“Ã¥Ã† [TEST UTILS] MFA Secret verification failed for 86c1055a81d190b409fbcb08e302081d[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould return 401 for non-existent user[33m 1002[2mms[22m[39m
{"level":30,"time":1768088160823,"env":"test","module":"user-credentials-repository","userId":"J4w6y03LyoWklkBvZZ7jF","msg":"User credentials created"}
{"level":30,"time":1768088160846,"env":"test","module":"user-credentials-repository","userId":"M3jir3AZsSHPlK0VRlmCW","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mTrusted Devices Management[2m > [22mDELETE /api/auth/trusted-devices/:deviceId[2m > [22mshould return 404 for non-existent device[33m 560[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould reject invalid TOTP during login
[22m[39m[TEST UTILS] MFA Secret verified for adce7c4bea2bbccfcd396829151a9a1b

 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mgetPendingInvitesForUser[2m > [22mshould not return accepted invites[33m 2084[2mms[22m[39m
{"level":30,"time":1768088161160,"env":"test","module":"email-queue","jobId":"8eaaa632-7e0f-449d-96ea-b8840beb4650","to":"test-1768088160505-pl88zl@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088161160,"env":"test","module":"auth-service","email":"test-1768088160505-pl88zl@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768088161355,"env":"test","module":"user-credentials-repository","userId":"XLNtnSo-epuJ0PqdM17LK","msg":"User credentials created"}
{"level":30,"time":1768088161473,"env":"test","module":"email-queue","jobId":"9530ae69-8aef-4ca5-88c2-0b371b18f769","to":"test-1768088160505-pl88zl@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088161473,"env":"test","module":"auth-service","email":"test-1768088160505-pl88zl@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude expired devices
[22m[39m[TEST UTILS] MFA Secret verified for a4c4ccf4992776e6c838a384c68a6871

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mSession Metadata Tracking[2m > [22mshould track IP address for sessions[33m 632[2mms[22m[39m
{"level":50,"time":1768088161662,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088161752,"env":"test","module":"user-credentials-repository","userId":"GtsiWZj2J7mRgFTyOciGb","msg":"User credentials created"}
{"level":40,"time":1768088161774,"env":"test","module":"mfa-service","userId":"adce7c4bea2bbccfcd396829151a9a1b","msg":"TOTP verification failed"}
{"level":40,"time":1768088161774,"env":"test","module":"auth-routes","userId":"adce7c4bea2bbccfcd396829151a9a1b","msg":"MFA verification failed during login"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Lifecycle[2m > [22mshould revoke all user tokens on password reset[33m 723[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088161835,"env":"test","module":"user-credentials-repository","userId":"7ff5FLfWbcq0RX5IFfR9o","msg":"User credentials created"}
{"level":30,"time":1768088161862,"env":"test","module":"auth-routes","userId":"156ca43eed7e0ca246877ae8dc551dd3","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Login Flow[2m > [22mshould reject invalid TOTP during login[33m 1820[2mms[22m[39m
{"level":30,"time":1768088161915,"env":"test","module":"audit-log-service","userId":"156ca43eed7e0ca246877ae8dc551dd3","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088161919,"env":"test","module":"user-credentials-repository","userId":"250f13e6-6f42-4574-b3cb-91b96c3a6af4","msg":"User credentials created"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088162030,"env":"test","module":"email-queue","jobId":"b106e77d-9005-4edc-9ff5-46de51c2971b","to":"test-1768088161124-yxmmeo@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088162088,"env":"test","module":"auth-routes","userId":"250f13e6-6f42-4574-b3cb-91b96c3a6af4","email":"test-1768088161124-yxmmeo@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mSession Metadata Tracking[2m > [22mshould track user agent for sessions[33m 534[2mms[22m[39m
{"level":30,"time":1768088162147,"env":"test","module":"email-queue","jobId":"5d9a8449-551a-4ce8-9db1-19820c3a1ce7","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768088162369,"env":"test","module":"user-credentials-repository","userId":"pjer98PwJ5foRg12lKU5Z","msg":"User credentials created"}
{"level":50,"time":1768088162365,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088162454,"env":"test","module":"auth-routes","userId":"156ca43eed7e0ca246877ae8dc551dd3","msg":"User logged in successfully"}
{"level":30,"time":1768088162498,"env":"test","module":"auth-routes","userId":"a4c4ccf4992776e6c838a384c68a6871","msg":"Login requires MFA verification"}
{"level":30,"time":1768088162510,"env":"test","module":"audit-log-service","userId":"156ca43eed7e0ca246877ae8dc551dd3","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/integration/organizationInvites.test.ts > Organization Invites > revokeInvite > should allow admin to revoke invite
Failed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:20:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:833:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizationInvites.test.ts:333:13
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:20 {
  length: 341,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (workspace_id)=(00000000-0000-0000-0000-000000000098) is not present in table "workspaces".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_workspace_id_workspaces_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}

{"level":50,"time":1768088162554,"env":"test","module":"user-credentials-repository","error":{},"userId":"d86ac1c9dd8bb18b3964ae29d619a9a5","msg":"Failed to update user password"}
{"level":50,"time":1768088162554,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":40,"time":1768088162614,"env":"test","module":"mfa-service","userId":"a4c4ccf4992776e6c838a384c68a6871","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088162614,"env":"test","module":"auth-routes","userId":"a4c4ccf4992776e6c838a384c68a6871","msg":"MFA verification failed during login"}
{"level":50,"time":1768088162622,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088162622,"env":"test","module":"auth-routes","userId":"156ca43eed7e0ca246877ae8dc551dd3","sessionCount":1,"msg":"Listed active sessions"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mPassword Reset Flow[2m > [22mshould complete full password reset flow[33m 2462[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 500 to be 200 // Object.is equality[39m
{"level":50,"time":1768088162674,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould accept TOTP codes within 60-second window
[22m[39m[TEST UTILS] MFA Secret verified for 341a036190fec409d5f23ca06f8b1b16

 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould exclude expired devices[33m 2108[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'length')[39m
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould revoke specific session[33m 2439[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 404 to be 200 // Object.is equality[39m
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.sessions.test.ts[2m > [22mOAuth2 Session Management[2m > [22mSession Metadata Tracking[2m > [22mshould update lastUsedAt on token refresh[33m 867[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould return 403 for unverified email[33m 2098[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 403 // Object.is equality[39m
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mrevokeInvite[2m > [22mshould allow admin to revoke invite[33m 2002[2mms[22m[39m
{"level":50,"time":1768088163457,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088163577,"env":"test","module":"mfa-service","userId":"341a036190fec409d5f23ca06f8b1b16","msg":"No enabled MFA secret found for user"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould revoke specific device
[22m[39m[TEST UTILS] MFA Secret verified for 4c3845d63d78f7c22b84968a02ee33dc

{"level":40,"time":1768088163578,"env":"test","module":"auth-routes","userId":"341a036190fec409d5f23ca06f8b1b16","msg":"MFA verification failed during login"}
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Login Flow[2m > [22mshould accept TOTP codes within 60-second window[33m 1804[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

 [32mÎ“Â£Ã´[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould initialize with null validation result[32m 24[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould validate expression after debounce[32m 26[2mms[22m[39m
[31m   Î“Ã¥Ã† expected false to be true // Object.is equality[39m
{"level":30,"time":1768088163950,"env":"test","module":"auth-routes","userId":"9851d5281d5939a02835a6301d3c44cb","msg":"User logged in successfully"}
{"level":30,"time":1768088164004,"env":"test","module":"audit-log-service","userId":"9851d5281d5939a02835a6301d3c44cb","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088164211,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088164232,"env":"test","module":"email-queue","jobId":"c028c8b3-2eff-4678-ab16-be31decfaff4","to":"test-1768088163003-shndo@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088164232,"env":"test","module":"auth-service","email":"test-1768088163003-shndo@example.com","msg":"Password reset email sent"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should debounce validation calls
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

 [31mâ”œÃ¹[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould return validation errors for invalid expression[33m 334[2mms[22m[39m
[31m   Î“Ã¥Ã† expected true to be false // Object.is equality[39m
{"level":30,"time":1768088164283,"env":"test","module":"email-queue","jobId":"20c26a5e-fb9c-4de8-9973-ead0f0895c48","to":"existing_1768088137138@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768088164292,"env":"test","module":"auth-routes","userId":"588a2a45edf90af0efd0627d919f2d86","msg":"User logged in successfully"}
{"level":30,"time":1768088164352,"env":"test","module":"audit-log-service","userId":"588a2a45edf90af0efd0627d919f2d86","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088164371,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088164460,"env":"test","module":"auth-routes","userId":"588a2a45edf90af0efd0627d919f2d86","sessionCount":1,"msg":"Listed active sessions"}
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mrenders value in display mode initially[32m 50[2mms[22m[39m
{"level":40,"time":1768088164485,"env":"test","module":"mfa-service","userId":"4c3845d63d78f7c22b84968a02ee33dc","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088164485,"env":"test","module":"auth-routes","userId":"4c3845d63d78f7c22b84968a02ee33dc","msg":"MFA verification failed during login"}
{"level":50,"time":1768088164492,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088164500,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

 [32mÎ“Â£Ã´[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould debounce validation calls[33m 416[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mshows double-click hint on hover[33m 943[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mdoes not show hint for read-only cells[32m 62[2mms[22m[39m
{"level":30,"time":1768088164634,"env":"test","module":"auth-routes","userId":"588a2a45edf90af0efd0627d919f2d86","sessionId":"320bf085-c9dc-4c0e-a115-c754b460e9c7","msg":"Session revoked"}
stderr | tests/integration/organizationInvites.test.ts > Organization Invites > revokeInvite > should prevent accepting revoked invite
Failed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:20:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:833:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizationInvites.test.ts:349:13
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:20 {
  length: 341,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (workspace_id)=(00000000-0000-0000-0000-000000000098) is not present in table "workspaces".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_workspace_id_workspaces_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}

{"level":50,"time":1768088164677,"env":"test","module":"user-credentials-repository","error":{},"userId":"9851d5281d5939a02835a6301d3c44cb","msg":"Failed to update user password"}
{"level":50,"time":1768088164678,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate helper functions in expressions
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mincludes proper ARIA label with column name and value[32m 62[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mindicates read-only status in ARIA label[32m 31[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mis focusable when editable[32m 39[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould prevent revoking current session[33m 1902[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 200 to be 400 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould record failed login attempt[33m 1890[2mms[22m[39m
{"level":50,"time":1768088164884,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22museExpressionValidation[2m > [22mshould not validate when workflowId or nodeId is missing[32m 170[2mms[22m[39m
{"level":50,"time":1768088164890,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDELETE /api/auth/trusted-devices/:deviceId[2m > [22mshould revoke specific device[33m 1826[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading '0')[39m
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate complex expressions with multiple helpers
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDisplay Mode[2m > [22mis not focusable when read-only[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mPassword Reset Flow[2m > [22mshould invalidate all sessions after password reset[33m 2347[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression validation integration[2m > [22mshould validate helper functions in expressions[32m 218[2mms[22m[39m
[31m   Î“Ã¥Ã† expected null not to be null

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div />[31m
  [36m</body>[31m
[36m</html>[31m[39m
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should handle syntax errors
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on double-click[32m 192[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Flow[2m > [22mshould login with valid backup code[33m 1432[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'secret')[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on Enter key press[32m 118[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression validation integration[2m > [22mshould validate complex expressions with multiple helpers[32m 128[2mms[22m[39m
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts[2m > [22mOrganization Invites[2m > [22mrevokeInvite[2m > [22mshould prevent accepting revoked invite[33m 2112[2mms[22m[39m
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22menters edit mode on Space key press[32m 120[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22mdoes not enter edit mode when read-only[32m 77[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression validation integration[2m > [22mshould handle syntax errors[32m 175[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression Editor component behavior[2m > [22mshould handle empty expressions[32m 2[2mms[22m[39m
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould return 404 for non-existent device
[22m[39m[TEST UTILS] MFA Secret verified for 3b4e3c38b5e1a6f2cc4f591bf15b4026

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mEdit Mode Activation[2m > [22mfocuses and selects input text on edit mode entry[32m 109[2mms[22m[39m
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mâ”œÃ¹[39m tests/ui/expression-editor.test.tsx[2m > [22mExpression Editor Hooks[2m > [22mExpression Editor component behavior[2m > [22mshould update validation when expression changes[33m 402[2mms[22m[39m
[31m   Î“Ã¥Ã† expected null not to be null

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div />[31m
  [36m</body>[31m
[36m</html>[31m[39m
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould mark backup code as used
[22m[39m[TEST UTILS] MFA Secret verified for 207e0904612b56ac90e9bf7209b203c5

{"level":50,"time":1768088166066,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return requiresMfa=true for MFA-enabled users
[22m[39m[TEST UTILS] MFA Secret verified for 4ae45d110b605958a3a5b047289d1ba3

{"level":30,"time":1768088166172,"env":"test","module":"mfa-service","userId":"3b4e3c38b5e1a6f2cc4f591bf15b4026","msg":"TOTP verification successful"}
{"level":30,"time":1768088166226,"env":"test","module":"auth-routes","userId":"3b4e3c38b5e1a6f2cc4f591bf15b4026","msg":"MFA login successful"}
{"level":30,"time":1768088166353,"env":"test","module":"auth-routes","userId":"d979cd6539e486cb0e6b6da2fb346406","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDELETE /api/auth/trusted-devices/:deviceId[2m > [22mshould return 404 for non-existent device[33m 1783[2mms[22m[39m
{"level":30,"time":1768088166405,"env":"test","module":"audit-log-service","userId":"d979cd6539e486cb0e6b6da2fb346406","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088166497,"env":"test","module":"auth-routes","userId":"ca535c71c02b64857159964aafb6526c","msg":"User logged in successfully"}
{"level":30,"time":1768088166550,"env":"test","module":"audit-log-service","userId":"ca535c71c02b64857159964aafb6526c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould return 404 for non-existent session[33m 1978[2mms[22m[39m
{"level":50,"time":1768088166814,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088166919,"env":"test","module":"auth-service","tokenHash":"89bfc2a3d5c65170934c448358b904fe5ac5206d094cb1fe83425b517f6ec9f5","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Flow[2m > [22mshould mark backup code as used[33m 1486[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'used')[39m
 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mToken Refresh Flow[2m > [22mshould rotate refresh token on each use[33m 2018[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
 [31mâ”œÃ¹[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould return requiresMfa=true for MFA-enabled users[33m 2564[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Security[2m > [22mshould use cryptographically strong random tokens[33m 6135[2mms[22m[39m
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould prevent revoking other user's device
[22m[39m[TEST UTILS] MFA Secret verified for 6475ab0a7f23bcd332a4e9b5e86a749c

{"level":50,"time":1768088167609,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088167616,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22msaves on blur[33m 1963[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Flow[2m > [22mshould prevent backup code reuse[33m 1225[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'secret')[39m
{"level":30,"time":1768088167838,"env":"test","module":"user-credentials-repository","userId":"Iwwp_vH7Dz1gzFdcM9M-G","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Security[2m > [22mshould hash refresh tokens before storing in database[33m 735[2mms[22m[39m
{"level":50,"time":1768088168221,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088168411,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088168417,"env":"test","module":"auth-routes","userId":"f004f9c87b3622fa3c0bb96f67807f32","msg":"User logged in successfully"}
{"level":30,"time":1768088168470,"env":"test","module":"audit-log-service","userId":"f004f9c87b3622fa3c0bb96f67807f32","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088168497,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088168503,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould prevent revoking other user's device
[22m[39m[TEST UTILS] MFA Secret verified for f07e3c1d4ab307339bbbb0c10e293c23

 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould prevent revoking other user's session[33m 1890[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading '0')[39m
{"level":50,"time":1768088168687,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088168765,"env":"test","module":"auth-service","userId":"f004f9c87b3622fa3c0bb96f67807f32","tokenHash":"5f410bd2d8fe7c5c6ec4adeb6d39dab834f6be4ff447a15f5f27ca1e2fb483d5","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1768088168952,"env":"test","module":"user-credentials-repository","userId":"LenvcMz59obc-fp8n_eOx","msg":"User credentials created"}
{"level":50,"time":1768088168962,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mToken Refresh Flow[2m > [22mshould detect and prevent refresh token reuse (token theft)[33m 2003[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould try TOTP before backup code
[22m[39m[TEST UTILS] MFA Secret verified for 650095d3250f680c37347605a2131263

{"level":50,"time":1768088169139,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088169238,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088169256,"env":"test","module":"mfa-service","userId":"6475ab0a7f23bcd332a4e9b5e86a749c","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088169256,"env":"test","module":"auth-routes","userId":"6475ab0a7f23bcd332a4e9b5e86a749c","msg":"MFA verification failed during login"}
{"level":50,"time":1768088169261,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088169266,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768088169282,"env":"test","module":"auth-service","tokenHash":"5a235d65a85ef080636e2e8d45486ebc69ebfac03d49f6e7a8fa84c70d6eca09","msg":"Security: Unknown refresh token used"}
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDELETE /api/auth/trusted-devices/:deviceId[2m > [22mshould prevent revoking other user's device[33m 2983[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading '0')[39m
{"level":50,"time":1768088169524,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088169793,"env":"test","module":"user-credentials-repository","userId":"rfqonDZmcyVby7JOqmW7a","msg":"User credentials created"}
{"level":50,"time":1768088169799,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22msaves on Enter key press[33m 2226[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Security[2m > [22mshould prevent refresh token reuse after rotation[33m 1290[2mms[22m[39m
{"level":50,"time":1768088169862,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1768088169974,"env":"test","module":"mfa-service","userId":"650095d3250f680c37347605a2131263","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088170027,"env":"test","module":"mfa-service","userId":"650095d3250f680c37347605a2131263","msg":"No unused backup codes available"}
{"level":40,"time":1768088170027,"env":"test","module":"auth-routes","userId":"650095d3250f680c37347605a2131263","msg":"MFA verification failed during login"}
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22mdoes not save if value unchanged[33m 357[2mms[22m[39m
{"level":30,"time":1768088170007,"env":"test","module":"auth-routes","userId":"c92257114ba9678c2fcf738e0e58e110","msg":"User logged in successfully"}
{"level":30,"time":1768088170065,"env":"test","module":"audit-log-service","userId":"c92257114ba9678c2fcf738e0e58e110","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mRefresh Token Security[2m > [22mshould validate token ownership[33m 680[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Flow[2m > [22mshould try TOTP before backup code[33m 2306[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould skip MFA for trusted device
[22m[39m[TEST UTILS] MFA Secret verified for 369850a64613d110264999e172c1708c

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mSaving Changes[2m > [22mcancels edit on Escape key press[32m 210[2mms[22m[39m
{"level":30,"time":1768088170317,"env":"test","module":"auth-routes","userId":"57f9ac031461655b9d4a76b4898a764b","msg":"User logged in successfully"}
{"level":50,"time":1768088170342,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mâ”œÃ¹[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/login[2m > [22mshould lock account after 5 failed attempts[33m 2983[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 423 // Object.is equality[39m
{"level":30,"time":1768088170362,"env":"test","module":"user-credentials-repository","userId":"G9Pjb0L4pudNjY39hUplp","msg":"User credentials created"}
{"level":30,"time":1768088170382,"env":"test","module":"audit-log-service","userId":"57f9ac031461655b9d4a76b4898a764b","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088170608,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088170647,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088170653,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mCookie Security[2m > [22mshould set HttpOnly flag to prevent XSS[33m 674[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mSession Management Flow[2m > [22mshould list all active sessions[33m 1730[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
{"level":50,"time":1768088170806,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088170886,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088170913,"env":"test","module":"mfa-service","userId":"369850a64613d110264999e172c1708c","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088170913,"env":"test","module":"auth-routes","userId":"369850a64613d110264999e172c1708c","msg":"MFA verification failed during login"}
{"level":50,"time":1768088170919,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all other sessions[33m 2382[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'find')[39m
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > reverts value on save error
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:204:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":30,"time":1768088171156,"env":"test","module":"user-credentials-repository","userId":"CTfcEJ0Zvb99PHX-12Yfc","msg":"User credentials created"}
{"level":50,"time":1768088171188,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDevice Trust with MFA Login[2m > [22mshould skip MFA for trusted device[33m 1923[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mError Handling[2m > [22mreverts value on save error[33m 1038[2mms[22m[39m
{"level":50,"time":1768088171385,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088171459,"env":"test","module":"auth-routes","userId":"0426bf999ec6591280a63a934a598016","msg":"User logged in successfully"}
{"level":30,"time":1768088171509,"env":"test","module":"audit-log-service","userId":"0426bf999ec6591280a63a934a598016","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Status[2m > [22mshould return MFA status for user[33m 1588[2mms[22m[39m
{"level":50,"time":1768088171850,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > displays error indicator on save failure
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:220:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":30,"time":1768088171865,"env":"test","module":"user-credentials-repository","userId":"0qsX6Jmd02OBRBIPVqbUh","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/logout[2m > [22mshould logout and clear refresh token cookie[33m 1567[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be defined[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mCookie Security[2m > [22mshould set SameSite=Strict to prevent CSRF[33m 797[2mms[22m[39m
{"level":50,"time":1768088172003,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mError Handling[2m > [22mdisplays error indicator on save failure[33m 733[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mrenders checkbox for boolean type[32m 76[2mms[22m[39m
{"level":50,"time":1768088172113,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088172119,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould require MFA for untrusted device
[22m[39m[TEST UTILS] MFA Secret verified for abc0a24eec5c5683f02be0904fe0a9d3

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mâ”œÃ¹[39m tests/integration/auth.flows.real.test.ts[2m > [22mAuth Flows Integration Tests (REAL)[2m > [22mSession Management Flow[2m > [22mshould revoke specific session[33m 1465[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'find')[39m
{"level":50,"time":1768088172275,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mCookie Security[2m > [22mshould set proper cookie path[33m 702[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould keep current session active[33m 1389[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'find')[39m
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Status[2m > [22mshould return backup codes count for MFA users[33m 965[2mms[22m[39m
[31m   Î“Ã¥Ã† [TEST UTILS] MFA Secret verification failed for 035ebc79c24dda5293793f74db01ae0f[39m
{"level":30,"time":1768088172737,"env":"test","module":"user-credentials-repository","userId":"neo1qIgcmKgZuh8sxd8NV","msg":"User credentials created"}
{"level":50,"time":1768088173000,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088173008,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088173099,"env":"test","module":"mfa-service","userId":"abc0a24eec5c5683f02be0904fe0a9d3","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088173099,"env":"test","module":"auth-routes","userId":"abc0a24eec5c5683f02be0904fe0a9d3","msg":"MFA verification failed during login"}
{"level":50,"time":1768088173106,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22mOAuth2 Token Refresh Flow[2m > [22mCookie Security[2m > [22mshould set appropriate expiry (30 days)[33m 872[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22msaves immediately on checkbox change[33m 930[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mdisables checkbox when read-only[32m 242[2mms[22m[39m
{"level":50,"time":1768088173368,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould disable MFA with password verification
[22m[39m[TEST UTILS] MFA Secret verified for b3ed0d9a47db80f1db893dd9e57cb76e

{"level":50,"time":1768088173572,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088173578,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Boolean Type (Checkbox) > shows loading spinner when saving checkbox
Warning: An update to EditableCell inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at EditableCell (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/EditableCell.tsx:12:25)

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mBoolean Type (Checkbox)[2m > [22mshows loading spinner when saving checkbox[32m 266[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders number input for number type[32m 70[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders email input for email type[32m 165[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mrenders url input for url type[32m 34[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDevice Trust with MFA Login[2m > [22mshould require MFA for untrusted device[33m 2180[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be true // Object.is equality[39m
 [31mâ”œÃ¹[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould refresh access token with valid refresh token[33m 1634[2mms[22m[39m
[31m   Î“Ã¥Ã† expected undefined to be defined[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mDifferent Input Types[2m > [22mincludes placeholder text in edit mode[32m 122[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mformats date values for display[32m 57[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mformats boolean values as Yes/No[32m 114[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx[2m > [22mEditableCell Component[2m > [22mValue Formatting[2m > [22mhandles null values gracefully[32m 19[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould return 400 if no active session found[33m 1304[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 400 // Object.is equality[39m
{"level":50,"time":1768088174239,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088174351,"env":"test","module":"mfa-service","userId":"b3ed0d9a47db80f1db893dd9e57cb76e","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088174351,"env":"test","module":"auth-routes","userId":"b3ed0d9a47db80f1db893dd9e57cb76e","msg":"MFA verification failed during login"}
{"level":50,"time":1768088174357,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould update lastUsedAt on trusted device login
[22m[39m[TEST UTILS] MFA Secret verified for b1968f52ecf9b6b442f59a06575e0b23

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould return 401 for missing refresh token[33m 833[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Disable Flow[2m > [22mshould disable MFA with password verification[33m 1777[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1768088174956,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768088175002,"env":"test","module":"auth-routes","userId":"17ee3164a59ee4339f9270fc629a691c","msg":"User logged in successfully"}
{"level":30,"time":1768088175056,"env":"test","module":"audit-log-service","userId":"17ee3164a59ee4339f9270fc629a691c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768088175059,"env":"test","module":"mfa-service","userId":"b1968f52ecf9b6b442f59a06575e0b23","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088175059,"env":"test","module":"auth-routes","userId":"b1968f52ecf9b6b442f59a06575e0b23","msg":"MFA verification failed during login"}
{"level":50,"time":1768088175066,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mâ”œÃ¹[39m tests/integration/trusted.devices.real.test.ts[2m > [22mTrusted Devices Integration Tests (REAL)[2m > [22mDevice Trust with MFA Login[2m > [22mshould update lastUsedAt on trusted device login[33m 1747[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'lastUsedAt')[39m
{"level":30,"time":1768088175227,"env":"test","module":"auth-routes","userId":"17ee3164a59ee4339f9270fc629a691c","deviceFingerprint":"5704edd074e9c212893f0aacd3ccb4ea052539cb69bd3f923d88aab5ed5844f1","msg":"Device marked as trusted"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould require correct password to disable MFA
[22m[39m[TEST UTILS] MFA Secret verified for cd96c7d313467a741544e957b5782ae3

{"level":30,"time":1768088175405,"env":"test","module":"auth-routes","userId":"17ee3164a59ee4339f9270fc629a691c","msg":"All other sessions revoked"}
{"level":30,"time":1768088175464,"env":"test","module":"audit-log-service","userId":"17ee3164a59ee4339f9270fc629a691c","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768088175675,"env":"test","module":"auth-routes","userId":"898dd5b4d5881eed5e942343743caf6c","msg":"User logged in successfully"}
{"level":30,"time":1768088175732,"env":"test","module":"audit-log-service","userId":"898dd5b4d5881eed5e942343743caf6c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768088175840,"env":"test","module":"auth-service","userId":"898dd5b4d5881eed5e942343743caf6c","tokenHash":"34be10ef240ba059031fa7c5795735b6279e748000575f1bfa2301f6be7b3a7b","msg":"Security: REUSED REFRESH TOKEN DETECTED (Concurrent). Revoking all sessions."}
 [32mÎ“Â£Ã´[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all trusted devices[33m 1944[2mms[22m[39m
{"level":40,"time":1768088175952,"env":"test","module":"auth-service","tokenHash":"34be10ef240ba059031fa7c5795735b6279e748000575f1bfa2301f6be7b3a7b","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768088176338,"env":"test","module":"auth-routes","userId":"cd96c7d313467a741544e957b5782ae3","msg":"Login requires MFA verification"}
{"level":40,"time":1768088176447,"env":"test","module":"mfa-service","userId":"cd96c7d313467a741544e957b5782ae3","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088176447,"env":"test","module":"auth-routes","userId":"cd96c7d313467a741544e957b5782ae3","msg":"MFA verification failed during login"}
{"level":50,"time":1768088176453,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould rotate refresh token after use[33m 2104[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mMFA Disable Flow[2m > [22mshould require correct password to disable MFA[33m 2096[2mms[22m[39m
[31m   Î“Ã¥Ã† the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string[39m
{"level":50,"time":1768088176674,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould handle user with single session gracefully[33m 1151[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'find')[39m
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1768088177439,"env":"test","module":"email-queue","jobId":"a93de0c0-6a4c-434b-aa3d-499461970a5d","to":"test-1768088176785-9htl9f@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088177439,"env":"test","module":"auth-service","email":"test-1768088176785-9htl9f@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Regeneration[2m > [22m[2mshould regenerate backup codes
[22m[39m[TEST UTILS] MFA Secret verified for aa86249cd5bb49a112df31440150ce61

{"level":30,"time":1768088178039,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088178109,"env":"test","module":"auth-routes","userId":"682cb66be25d252b922b58c3ed2a315b","msg":"User logged in successfully"}
{"level":30,"time":1768088178165,"env":"test","module":"audit-log-service","userId":"682cb66be25d252b922b58c3ed2a315b","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088178270,"env":"test","module":"auth-routes","userId":"682cb66be25d252b922b58c3ed2a315b","sessionCount":0,"msg":"Listed active sessions"}
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/forgot-password[2m > [22mshould send password reset email for existing user[33m 1491[2mms[22m[39m
{"level":50,"time":1768088178310,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768088178427,"env":"test","module":"mfa-service","userId":"aa86249cd5bb49a112df31440150ce61","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768088178427,"env":"test","module":"auth-routes","userId":"aa86249cd5bb49a112df31440150ce61","msg":"MFA verification failed during login"}
{"level":50,"time":1768088178432,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mSession Security[2m > [22mshould include device metadata in sessions[33m 1596[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'deviceName')[39m
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

 [31mâ”œÃ¹[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Regeneration[2m > [22mshould regenerate backup codes[33m 1978[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/forgot-password[2m > [22mshould not reveal if email exists (security)[33m 894[2mms[22m[39m
{"level":50,"time":1768088179437,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768088179442,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mSession Security[2m > [22mshould not expose sensitive token data[33m 1173[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading '0')[39m
{"level":30,"time":1768088179584,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088179815,"env":"test","module":"email-queue","jobId":"7e4e73cd-d50c-48b0-8fff-e04b14ea7d70","to":"test-1768088179181-zrcp98@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088179815,"env":"test","module":"auth-service","email":"test-1768088179181-zrcp98@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768088180175,"env":"test","module":"auth-routes","userId":"eedf3180d1e1af7894e04da09aef0306","msg":"User logged in successfully"}
{"level":30,"time":1768088180229,"env":"test","module":"audit-log-service","userId":"eedf3180d1e1af7894e04da09aef0306","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088180253,"env":"test","module":"user-credentials-repository","error":{},"userId":"ff69f088f2f2c4cbe28b7fd6f4260b6b","msg":"Failed to update user password"}
{"level":50,"time":1768088180253,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mBackup Code Regeneration[2m > [22mshould return error if MFA not enabled[33m 1905[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/reset-password[2m > [22mshould reset password with valid token[33m 1964[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 500 to be 200 // Object.is equality[39m
{"level":30,"time":1768088180951,"env":"test","module":"auth-routes","userId":"2ef92649c9cf2f50047ce3dcd729d69a","msg":"User logged in successfully"}
{"level":30,"time":1768088181004,"env":"test","module":"audit-log-service","userId":"2ef92649c9cf2f50047ce3dcd729d69a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088181117,"env":"test","module":"auth-routes","userId":"2ef92649c9cf2f50047ce3dcd729d69a","sessionCount":0,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mâ”œÃ¹[39m tests/integration/session.management.real.test.ts[2m > [22mSession Management Integration Tests (REAL)[2m > [22mSession Security[2m > [22mshould track session activity timestamps[33m 1674[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'createdAt')[39m
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/reset-password[2m > [22mshould return 400 for invalid token[33m 868[2mms[22m[39m
{"level":30,"time":1768088182003,"env":"test","module":"auth-routes","userId":"7e8bbd1e32ca5daf1610d62abb0891d3","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.real.test.ts[2m > [22mMFA Flow Integration Tests (REAL)[2m > [22mTenant-Level MFA Enforcement[2m > [22mshould enforce MFA for tenant users when required by tenant[33m 1750[2mms[22m[39m
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768088182644,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088182664,"env":"test","module":"email-queue","jobId":"3212f87c-5d15-4186-ba45-9a67ee92653b","to":"test-1768088181988-vwqvgo@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088182664,"env":"test","module":"auth-service","email":"test-1768088181988-vwqvgo@example.com","msg":"Password reset email sent"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mPOST /api/auth/reset-password[2m > [22mshould return 400 for weak new password[33m 1618[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould render runs table with correct columns[32m 33[2mms[22m[39m
[31m   Î“Ã¥Ã† React is not defined[39m
 [31mâ”œÃ¹[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould render run data correctly[32m 8[2mms[22m[39m
[31m   Î“Ã¥Ã† React is not defined[39m
 [31mâ”œÃ¹[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould show success badge for successful runs[32m 17[2mms[22m[39m
[31m   Î“Ã¥Ã† React is not defined[39m
 [31mâ”œÃ¹[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould show error badge for failed runs[32m 12[2mms[22m[39m
[31m   Î“Ã¥Ã† React is not defined[39m
 [31mâ”œÃ¹[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould format duration correctly[32m 6[2mms[22m[39m
[31m   Î“Ã¥Ã† React is not defined[39m
 [31mâ”œÃ¹[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunsTable[2m > [22mshould show download options for successful runs[32m 5[2mms[22m[39m
[31m   Î“Ã¥Ã† React is not defined[39m
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088185189,"env":"test","module":"auth-routes","userId":"18f912399c9e8d32b547c70df99c3718","msg":"User logged in successfully"}
{"level":30,"time":1768088185240,"env":"test","module":"audit-log-service","userId":"18f912399c9e8d32b547c70df99c3718","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mGET /api/auth/me[2m > [22mshould return current user for valid token[33m 2568[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768088186470,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mGET /api/auth/me[2m > [22mshould return 401 for missing token[33m 1108[2mms[22m[39m
{"level":50,"time":1768088187326,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould render all filter controls[32m 254[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould render template name and description[33m 723[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mGET /api/auth/me[2m > [22mshould return 401 for invalid token[33m 870[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould show "Coming Soon" badge[32m 42[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render all breadcrumb items[32m 282[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render without home when showHome is false[32m 125[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould render preview columns[32m 262[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould call onChange when status filter changes[33m 4026[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render icons for items that have them[32m 130[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render links for non-last items with href[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould limit preview columns to 5 and show count for remaining[32m 245[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould handle empty preview columns[32m 18[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TemplateCard.test.tsx[2m > [22mTemplateCard Component[2m > [22mshould have cursor-not-allowed style[32m 28[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render last item without link[32m 199[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould call onChange when search is submitted[33m 632[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould apply custom className[32m 92[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould render chevron separators between items[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould show clear filters button when filters are active[32m 193[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mRunFilters[2m > [22mshould clear all filters when clear button is clicked[32m 30[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould complete MFA login with valid TOTP code
[22m[39m[TEST UTILS] MFA Secret verified for fa19e40a207cc56775fa05d843b17062

 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould render all trace entries[33m 340[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould show executed badge for executed nodes[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould show skipped badge for skipped nodes[32m 27[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould display conditions and their results[32m 233[2mms[22m[39m
{"level":30,"time":1768088189859,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould display error messages[32m 237[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould handle single item[32m 169[2mms[22m[39m
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould handle empty items array with home[33m 1434[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx[2m > [22mBreadcrumbs Component[2m > [22mshould apply font-medium to last item[32m 12[2mms[22m[39m
{"level":30,"time":1768088190116,"env":"test","module":"auth-routes","userId":"fa19e40a207cc56775fa05d843b17062","msg":"Login requires MFA verification"}
{"level":30,"time":1768088190240,"env":"test","module":"mfa-service","userId":"fa19e40a207cc56775fa05d843b17062","msg":"TOTP verification successful"}
{"level":30,"time":1768088190297,"env":"test","module":"auth-routes","userId":"fa19e40a207cc56775fa05d843b17062","msg":"MFA login successful"}
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mMFA Routes[2m > [22mPOST /api/auth/mfa/verify-login[2m > [22mshould complete MFA login with valid TOTP code[33m 2982[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould toggle show skipped nodes[33m 600[2mms[22m[39m
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould expand outputs delta when clicked[33m 1007[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/runs.components.test.tsx[2m > [22mStage 8: Runs UI Components[2m > [22mTracePanel[2m > [22mshould copy trace as JSON[32m 23[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould reject invalid MFA code
[22m[39m[TEST UTILS] MFA Secret verified for 8a5206ef01d1ec87a04845fbdd4da7fc

{"level":40,"time":1768088192259,"env":"test","module":"mfa-service","userId":"8a5206ef01d1ec87a04845fbdd4da7fc","msg":"TOTP verification failed"}
{"level":40,"time":1768088192259,"env":"test","module":"auth-routes","userId":"8a5206ef01d1ec87a04845fbdd4da7fc","msg":"MFA verification failed during login"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.real.test.ts[2m > [22mAuth Routes Integration Tests (REAL)[2m > [22mMFA Routes[2m > [22mPOST /api/auth/mfa/verify-login[2m > [22mshould reject invalid MFA code[33m 1950[2mms[22m[39m
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768088193054,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088193308,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088194235,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768088195164,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/client/choice-utils.test.ts > choice-utils > handles missing content gracefully
[generateOptionsFromList] Invalid list data: null

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22mgenerates options with basic mapping[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22msorts by label asc[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22msorts by label desc[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22mdedupes by label[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22mdedupes by value (alias)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22muses label template with column names[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22mhandles missing content gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22mincludes blank option at the top[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22msorts by specific column asc[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts[2m > [22mchoice-utils[2m > [22msorts by specific column desc[32m 0[2mms[22m[39m
{"level":30,"time":1768088198971,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould render table name and description[32m 256[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould render table slug[32m 69[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould render table slug[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould render column and row counts[32m 46[2mms[22m[39m
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088204628,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould call onClick when card is clicked[32m 102[2mms[22m[39m
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088205209,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1768088205209,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768088205212,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1768088205225,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1768088205774,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1768088205793,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088205803,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088205804,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

 [31mâ”œÃ¹[39m tests/integration/metrics.test.ts[2m > [22mMetrics Integration[2m > [22mshould expose /metrics endpoint[33m 407[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
{"level":30,"time":1768088205816,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1768088205249,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
{"level":30,"time":1768088205810,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1768088205810,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768088205811,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1768088205819,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1768088205820,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088205802,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088205803,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088205810,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088205815,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088205816,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088205816,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088205816,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088205827,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts[2m > [22m[2mExpression Validation API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088205811,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088205812,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088205819,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088205826,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088205826,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088205827,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088205827,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088205839,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088205846,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088205850,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088205828,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088205829,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088205834,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088205840,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088205840,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088205850,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088205850,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088205865,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768088205847,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088205848,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088205852,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088205864,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088205864,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088205865,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088205865,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088205869,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts[2m > [22m[2mData Sources API - Native Catalog
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088205782,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088205783,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088205790,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088205804,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088205804,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088205804,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088205804,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088205854,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088205854,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088205859,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088205868,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088205869,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088205869,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088205869,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/metrics.test.ts[2m > [22mMetrics Integration[2m > [22mshould protect /metrics if API key is set[33m 780[2mms[22m[39m
{"level":30,"time":1768088206033,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
{"level":30,"time":1768088206365,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088206374,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088206376,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088206383,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088206386,"env":"test","module":"user-credentials-repository","userId":"56880b4d-b076-4a74-9b0b-1a5e6e0ff523","msg":"User credentials created"}
{"level":30,"time":1768088206373,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088206373,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088206377,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088206383,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088206383,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088206383,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088206383,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088206392,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts[2m > [22m[2mTemplates and Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088206396,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768088206383,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088206384,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088206387,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088206392,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088206392,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088206392,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088206392,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088206382,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088206382,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088206387,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088206394,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088206394,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088206396,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088206396,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088206415,"env":"test","module":"user-credentials-repository","userId":"3ed0bbab-e518-4338-ba17-812172949950","msg":"User credentials created"}
{"level":30,"time":1768088206437,"env":"test","module":"user-credentials-repository","userId":"2c810452-8318-4433-8158-bfd75119b6b2","msg":"User credentials created"}
{"level":30,"time":1768088206485,"env":"test","module":"email-queue","jobId":"c12dafb8-98cc-43ed-be36-88c6ad3cf554","to":"test-GKjrY-1G5T4YmLLSf07S1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088206487,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088206497,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088206506,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088206495,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088206495,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088206500,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088206506,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088206506,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088206506,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088206506,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088206515,"env":"test","module":"email-queue","jobId":"eeaeb962-f118-4495-9f33-cbc5ba7adddb","to":"test-twn7n30cnUXatkK0rF83l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts[2m > [22m[2mDataVault Table Permissions API (v4 Micro-Phase 6)
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088206518,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088206519,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768088206504,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088206505,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088206509,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088206518,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088206518,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088206518,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088206519,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088206543,"env":"test","module":"auth-routes","userId":"56880b4d-b076-4a74-9b0b-1a5e6e0ff523","email":"test-GKjrY-1G5T4YmLLSf07S1@example.com","msg":"User registered"}
{"level":30,"time":1768088206551,"env":"test","module":"email-queue","jobId":"bff805d7-1ee0-4ad9-a9e1-bcd7effc9040","to":"test-osDiIhyyTdnUWUG1LmTxe@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts[2m > [22m[2mIntake Workflow Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088206560,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768088206526,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088206527,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088206553,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088206560,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088206560,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088206560,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088206560,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088206573,"env":"test","module":"auth-routes","userId":"3ed0bbab-e518-4338-ba17-812172949950","email":"test-twn7n30cnUXatkK0rF83l@example.com","msg":"User registered"}
{"level":30,"time":1768088206613,"env":"test","module":"user-credentials-repository","userId":"69931448-2ee9-4dc9-a104-ab1017789938","msg":"User credentials created"}
{"level":30,"time":1768088206613,"env":"test","module":"auth-routes","userId":"2c810452-8318-4433-8158-bfd75119b6b2","email":"test-osDiIhyyTdnUWUG1LmTxe@example.com","msg":"User registered"}
{"level":30,"time":1768088206731,"env":"test","module":"email-queue","jobId":"9d298618-0a21-400a-9fb8-77b25b97fff7","to":"test-z__SZ1xWtiwQ-rKz8Yq60@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088206792,"env":"test","module":"auth-routes","userId":"69931448-2ee9-4dc9-a104-ab1017789938","email":"test-z__SZ1xWtiwQ-rKz8Yq60@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould call onDelete when delete button is clicked[33m 2779[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould show placeholder when description is missing[32m 18[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx[2m > [22mTableCard Component[2m > [22mshould format dates correctly[32m 14[2mms[22m[39m
{"level":30,"time":1768088206908,"env":"test","module":"user-credentials-repository","userId":"4edeb34d-5197-46a8-a4e4-a83972eb7f85","msg":"User credentials created"}
{"level":30,"time":1768088206922,"env":"test","module":"user-credentials-repository","userId":"1f278572-308e-4207-b58f-5cd25ae30cde","msg":"User credentials created"}
{"level":30,"time":1768088206922,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImYzZmQ3ODIzLWZjYzUtNDQ2NS1iMmIxLTU1ZmM3MGIzNGMyMCIsInJvbGUiOiJhZG1pbiIsInRlbmFudFJvbGUiOiJvd25lciIsImlhdCI6MTc2ODA4ODIwNiwiZXhwIjoxNzY4MDg5MTA2fQ.weGm2JNFRsT1bDcJQD6KELsVkc7VZXt2v4L8_F9Zfdw",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": null,
    "lastName": null,
    "profileImageUrl": null,
    "tenantId": "f3fd7823-fcc5-4465-b2b1-55fc70b34c20",
    "role": "admin",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1768088206997,"env":"test","module":"user-credentials-repository","userId":"8b5345f7-3622-45d4-b4e1-7bbf09a5fcc9","msg":"User credentials created"}
{"level":30,"time":1768088207001,"env":"test","module":"user-credentials-repository","userId":"9b4614eb-6baf-423a-bb13-e50fafb90e0c","msg":"User credentials created"}
{"level":30,"time":1768088207016,"env":"test","module":"email-queue","jobId":"17dfa8bd-b25d-4006-9028-e5b48854ff62","to":"test-m-HdRLcH2pTYEDgIBKR9d@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088207024,"env":"test","module":"email-queue","jobId":"a4a5f6e8-e23a-4cc8-b7e9-9d8f2598bc06","to":"test--mv08ihCYMujRpheHAxvn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088207075,"env":"test","module":"auth-routes","userId":"4edeb34d-5197-46a8-a4e4-a83972eb7f85","email":"test-m-HdRLcH2pTYEDgIBKR9d@example.com","msg":"User registered"}
{"level":30,"time":1768088207084,"env":"test","module":"auth-routes","userId":"1f278572-308e-4207-b58f-5cd25ae30cde","email":"test--mv08ihCYMujRpheHAxvn@example.com","msg":"User registered"}
{"level":30,"time":1768088207106,"env":"test","module":"email-queue","jobId":"f7c2c97f-2ce8-45c0-907c-1e72bc9a691b","to":"test-docx-qalHITdCpUgmtqLIpGHTo@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088207107,"env":"test","module":"email-queue","jobId":"bf6a355b-6102-4c3c-ae2d-aaf289c3fa26","to":"test-vAJKEiaRArIepN4w3NE_J@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088207149,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768088207163,"env":"test","module":"auth-routes","userId":"8b5345f7-3622-45d4-b4e1-7bbf09a5fcc9","email":"test-vAJKEiaRArIepN4w3NE_J@example.com","msg":"User registered"}
{"level":30,"time":1768088207162,"env":"test","module":"auth-routes","userId":"9b4614eb-6baf-423a-bb13-e50fafb90e0c","email":"test-docx-qalHITdCpUgmtqLIpGHTo@example.com","msg":"User registered"}
{"level":30,"time":1768088207225,"env":"test","module":"user-credentials-repository","userId":"c98ed41c-865d-4d7c-a2c8-e40d92f141e3","msg":"User credentials created"}
{"level":30,"time":1768088207333,"env":"test","module":"user-credentials-repository","userId":"dbefaa1f-7181-4aa9-baee-3e0dea27aa00","msg":"User credentials created"}
{"level":30,"time":1768088207335,"env":"test","module":"user-credentials-repository","userId":"ce81f2de-48f7-4450-9431-5f67d14ba9db","msg":"User credentials created"}
{"level":30,"time":1768088207335,"env":"test","module":"email-queue","jobId":"84048325-8547-4ece-9879-8f4fab1ed544","to":"test-rbsEpNaPBx4i-Wj-J_FdF@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088207383,"env":"test","module":"user-credentials-repository","userId":"25be478e-1d44-4ef3-b6f9-8c615cd0c98d","msg":"User credentials created"}
{"level":30,"time":1768088207395,"env":"test","module":"auth-routes","userId":"c98ed41c-865d-4d7c-a2c8-e40d92f141e3","email":"test-rbsEpNaPBx4i-Wj-J_FdF@example.com","msg":"User registered"}
{"level":30,"time":1768088207437,"env":"test","module":"email-queue","jobId":"d1ebb41f-bdb6-405f-8ba7-915b80347600","to":"session-test-BKPwFZpsEpkSTNEeZORMb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088207462,"env":"test","module":"email-queue","jobId":"7dec0099-8d44-46a4-96e4-c3b69aaf5d69","to":"protected-test-lq37KcFfmTNAB5YSndnGk@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088207486,"env":"test","module":"email-queue","jobId":"503e7727-abdb-4fc2-967b-9721701d2ef3","to":"test-lsiv1cIqusMIkF3qpoWgx@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088207495,"env":"test","module":"auth-routes","userId":"dbefaa1f-7181-4aa9-baee-3e0dea27aa00","email":"session-test-BKPwFZpsEpkSTNEeZORMb@example.com","msg":"User registered"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Deprecated method ".compile", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.compile (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:475:7)
    at TemplateScanner.validateBuffer (C:/Users/scoot/poll/VaultLogic/server/services/document/TemplateScanner.ts:190:13)
    at TemplateScanner.scanAndFix (C:/Users/scoot/poll/VaultLogic/server/services/document/TemplateScanner.ts:69:22)
    at C:/Users/scoot/poll/VaultLogic/server/api/templates.ts:328:52
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768088207515,"env":"test","module":"auth-routes","userId":"ce81f2de-48f7-4450-9431-5f67d14ba9db","email":"protected-test-lq37KcFfmTNAB5YSndnGk@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mPOST /api/workflows/validateExpression[2m > [22mshould validate a correct expression with valid variables[32m 131[2mms[22m[39m
{"level":30,"time":1768088207545,"env":"test","module":"auth-routes","userId":"25be478e-1d44-4ef3-b6f9-8c615cd0c98d","email":"test-lsiv1cIqusMIkF3qpoWgx@example.com","msg":"User registered"}
{"level":30,"time":1768088207549,"env":"test","module":"user-credentials-repository","userId":"98f34a51-c05c-4f66-8920-61d8ec0457c6","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/api.dataSources.native.test.ts[2m > [22mData Sources API - Native Catalog[2m > [22mshould list databases and databases' tables in the catalog[33m 399[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mPOST /api/workflows/validateExpression[2m > [22mshould validate expression with string concatenation[32m 124[2mms[22m[39m
{"level":30,"time":1768088207660,"env":"test","module":"email-queue","jobId":"ea90e07f-a944-4ee9-a0e3-596b14ebe342","to":"test-ClaNSbREiOv8rUn4ksSN5@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768088207673,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088207729,"env":"test","module":"auth-routes","userId":"98f34a51-c05c-4f66-8920-61d8ec0457c6","email":"test-ClaNSbREiOv8rUn4ksSN5@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/api.dataSources.native.test.ts[2m > [22mData Sources API - Native Catalog[2m > [22mshould create a native_table data source[32m 173[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mPOST /api/workflows/validateExpression[2m > [22mshould reject expression with invalid syntax[32m 122[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mPOST /api/workflows/validateExpression[2m > [22mshould reject without authentication[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mPOST /api/workflows/validateExpression[2m > [22mshould reject missing required fields[32m 61[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mSelect/Multiselect Columns[2m > [22mshould create a select column with options[33m 530[2mms[22m[39m
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":50,"time":1768088207858,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768088207880,"env":"test","module":"user-credentials-repository","userId":"5c671c1b-24d3-4390-a7e8-5bd0df80d232","msg":"User credentials created"}
{"level":30,"time":1768088207905,"env":"test","module":"user-credentials-repository","userId":"2b86efce-6a2d-4829-bb22-8e7b1af25e6c","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mGET /api/workflows/:id/availableVars/:nodeId[2m > [22mshould return available variables for a node[32m 117[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mGET /api/workflows/:id/availableVars/:nodeId[2m > [22mshould reject without authentication[32m 8[2mms[22m[39m
{"level":30,"time":1768088207991,"env":"test","module":"email-queue","jobId":"0172ace6-dbb1-42e6-a48a-d977fb622371","to":"middleware-test-ALDYzDaeVDTgmZExyNWsz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088208011,"env":"test","module":"email-queue","jobId":"1b10493b-8167-436c-855d-aebc90ee62e4","to":"jwt-test-lYY0F4cBvzuHn4URSqD8k@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088208034,"env":"test","module":"user-credentials-repository","userId":"2354fe21-d824-4fe1-9dbd-5d594d0e6bba","msg":"User credentials created"}
{"level":50,"time":1768088208046,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088208048,"env":"test","module":"auth-routes","userId":"5c671c1b-24d3-4390-a7e8-5bd0df80d232","email":"middleware-test-ALDYzDaeVDTgmZExyNWsz@example.com","msg":"User registered"}
{"level":30,"time":1768088208066,"env":"test","module":"auth-routes","userId":"2b86efce-6a2d-4829-bb22-8e7b1af25e6c","email":"jwt-test-lYY0F4cBvzuHn4URSqD8k@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mGET /api/workflows/:id/availableVars/:nodeId[2m > [22mshould reject non-existent workflow[32m 118[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mGET /api/engine/helpers[2m > [22mshould return list of helper functions with metadata[32m 63[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts[2m > [22mExpression Validation API Integration Tests[2m > [22mGET /api/engine/helpers[2m > [22mshould reject without authentication[32m 5[2mms[22m[39m
{"level":30,"time":1768088208131,"env":"test","module":"auth-routes","userId":"dbefaa1f-7181-4aa9-baee-3e0dea27aa00","msg":"User logged in successfully"}
{"level":30,"time":1768088208147,"env":"test","module":"email-queue","jobId":"195b8a9f-ee2a-462f-9668-3b93ea3a9a96","to":"test-w2T-6l02GpCdmOXIOkooV@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088208184,"env":"test","module":"audit-log-service","userId":"dbefaa1f-7181-4aa9-baee-3e0dea27aa00","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088208207,"env":"test","module":"auth-routes","userId":"2354fe21-d824-4fe1-9dbd-5d594d0e6bba","email":"test-w2T-6l02GpCdmOXIOkooV@example.com","msg":"User registered"}
{"level":30,"time":1768088208236,"env":"test","module":"auth-routes","userId":"ce81f2de-48f7-4450-9431-5f67d14ba9db","msg":"User logged in successfully"}
{"level":30,"time":1768088208287,"env":"test","module":"audit-log-service","userId":"ce81f2de-48f7-4450-9431-5f67d14ba9db","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mSelect/Multiselect Columns[2m > [22mshould create a multiselect column with options[33m 510[2mms[22m[39m
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mSession Creation and Tracking[2m > [22mshould create refresh token on login[33m 1496[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPOST /api/projects/:ctx.projectId/workflows[2m > [22mshould create a new draft workflow[33m 405[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould allow access with valid Bearer token[33m 1528[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mPOST /api/projects/:ctx.projectId/templates[2m > [22mshould create template with file upload[32m 189[2mms[22m[39m
{"level":50,"time":1768088208553,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"qpdf --decrypt \"C:\\Users\\scoot\\AppData\\Local\\Temp\\locked-1768088208455.pdf\" \"C:\\Users\\scoot\\AppData\\Local\\Temp\\unlocked-1768088208455.pdf\"","stdout":"","stderr":"'qpdf' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"Failed to unlock PDF with qpdf"}
{"level":40,"time":1768088208554,"env":"test","msg":"Returning original PDF buffer due to unlock failure"}
{"level":50,"time":1768088208556,"env":"test","error":{},"msg":"Failed to extract PDF fields"}
{"level":50,"time":1768088208556,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF processing failed"}
{"level":50,"time":1768088208556,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"81e7cc85-015d-4e42-803b-d2d121c34660"},"file":{"fieldname":"file","originalname":"test.pdf","encoding":"7bit","mimetype":"application/pdf","buffer":{"type":"Buffer","data":[37,80,68,70]},"size":4},"msg":"Error creating template"}
{"level":30,"time":1768088208641,"env":"test","module":"auth-routes","userId":"5c671c1b-24d3-4390-a7e8-5bd0df80d232","msg":"User logged in successfully"}
{"level":30,"time":1768088208666,"env":"test","module":"user-credentials-repository","userId":"2d659a53-9576-416e-b8ce-b63255ff1267","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mPOST /api/projects/:ctx.projectId/templates[2m > [22mshould reject non-docx files[32m 214[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 500 "Internal Server Error", got 400 "Bad Request"[39m
{"level":50,"time":1768088208681,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"81e7cc85-015d-4e42-803b-d2d121c34660"},"msg":"Error creating template"}
{"level":30,"time":1768088208687,"env":"test","module":"user-credentials-repository","userId":"bed98f65-7506-4e99-94b3-62b75725d3f4","msg":"User credentials created"}
{"level":30,"time":1768088208693,"env":"test","module":"audit-log-service","userId":"5c671c1b-24d3-4390-a7e8-5bd0df80d232","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768088208723,"env":"test","module":"auth-routes","userId":"2b86efce-6a2d-4829-bb22-8e7b1af25e6c","msg":"User logged in successfully"}
{"level":30,"time":1768088208774,"env":"test","module":"email-queue","jobId":"ead5f004-aa2c-45b9-84c7-f972e4c80848","to":"session-test-9NEQK529pXf4PJBfiZPWR@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088208775,"env":"test","module":"audit-log-service","userId":"2b86efce-6a2d-4829-bb22-8e7b1af25e6c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088208790,"env":"test","module":"user-credentials-repository","userId":"4a5a9cd8-fcc3-412e-8c28-80dc485ddc01","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mPOST /api/projects/:ctx.projectId/templates[2m > [22mshould reject without file[32m 124[2mms[22m[39m
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768088208804,"env":"test","module":"email-queue","jobId":"0dbd2b92-4748-4c18-8e6d-df0ffb865f4f","to":"viewer-iX5GV2-9I6TqbEoA-tuBe@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088208828,"env":"test","module":"auth-routes","userId":"2d659a53-9576-416e-b8ce-b63255ff1267","email":"session-test-9NEQK529pXf4PJBfiZPWR@example.com","msg":"User registered"}
{"level":30,"time":1768088208836,"env":"test","module":"auth-routes","userId":"2354fe21-d824-4fe1-9dbd-5d594d0e6bba","msg":"User logged in successfully"}
{"level":30,"time":1768088208855,"env":"test","module":"auth-routes","userId":"bed98f65-7506-4e99-94b3-62b75725d3f4","email":"viewer-iX5GV2-9I6TqbEoA-tuBe@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Generation[2m > [22mshould generate valid JWT token on successful login[33m 1421[2mms[22m[39m
{"level":30,"time":1768088208892,"env":"test","module":"email-queue","jobId":"bcd99f73-d333-44e0-9beb-2ac20aa9f391","to":"protected-test-bS9ChETw0_fTKduInBH1_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088208892,"env":"test","module":"audit-log-service","userId":"2354fe21-d824-4fe1-9dbd-5d594d0e6bba","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould allow access with valid JWT Bearer token[33m 1371[2mms[22m[39m
{"level":30,"time":1768088208948,"env":"test","module":"auth-routes","userId":"4a5a9cd8-fcc3-412e-8c28-80dc485ddc01","email":"protected-test-bS9ChETw0_fTKduInBH1_@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1768088208965,"env":"test","module":"rbac-middleware","userId":"bed98f65-7506-4e99-94b3-62b75725d3f4","userRole":"viewer","permission":"workflow:create","path":"/projects/608e6c3f-ea6a-43f4-be98-9947be96aff4/workflows","msg":"Permission denied"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPOST /api/projects/:ctx.projectId/workflows[2m > [22mshould reject without permission[33m 727[2mms[22m[39m
{"level":30,"time":1768088209088,"env":"test","workflowId":"9b44a89a-6634-41cf-aeb0-f6ee628bd83e","userId":"98f34a51-c05c-4f66-8920-61d8ec0457c6","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mGET /api/projects/:ctx.projectId/templates[2m > [22mshould list templates[33m 332[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.workflow.test.ts[2m > [22mIntake Workflow Integration Tests[2m > [22mshould allow designating a workflow as Intake[33m 1114[2mms[22m[39m
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mGET /api/templates/:id[2m > [22mshould get template by ID[32m 280[2mms[22m[39m
{"level":50,"time":1768088209429,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":30,"time":1768088209455,"env":"test","module":"user-credentials-repository","userId":"b2827fc0-679b-4530-aa41-df56d80691dd","msg":"User credentials created"}
{"level":30,"time":1768088209458,"env":"test","module":"user-credentials-repository","userId":"e7fcd28b-44e0-458b-9887-62e65f363260","msg":"User credentials created"}
{"level":30,"time":1768088209492,"env":"test","module":"auth-routes","userId":"2d659a53-9576-416e-b8ce-b63255ff1267","msg":"User logged in successfully"}
{"level":30,"time":1768088209522,"env":"test","module":"user-credentials-repository","userId":"e9d5ca61-0f92-45ab-a984-4ea7bbf64cc5","msg":"User credentials created"}
{"level":30,"time":1768088209542,"env":"test","module":"audit-log-service","userId":"2d659a53-9576-416e-b8ce-b63255ff1267","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088209556,"env":"test","module":"email-queue","jobId":"dbc1d0fa-d9bc-4557-a2f4-90a57590cf83","to":"jwt-test-gbAe3b7TQ-DG4BaTITcP9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088209573,"env":"test","module":"email-queue","jobId":"211a67cb-9c20-44da-aa80-fda8728d304d","to":"middleware-test-T2WUBMiboOCvgn0L2etqS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mSelect/Multiselect Columns[2m > [22mshould validate select value against options[33m 1293[2mms[22m[39m
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088209616,"env":"test","module":"auth-routes","userId":"b2827fc0-679b-4530-aa41-df56d80691dd","email":"jwt-test-gbAe3b7TQ-DG4BaTITcP9@example.com","msg":"User registered"}
{"level":30,"time":1768088209627,"env":"test","module":"auth-routes","userId":"e7fcd28b-44e0-458b-9887-62e65f363260","email":"middleware-test-T2WUBMiboOCvgn0L2etqS@example.com","msg":"User registered"}
{"level":30,"time":1768088209628,"env":"test","module":"auth-routes","userId":"4a5a9cd8-fcc3-412e-8c28-80dc485ddc01","msg":"User logged in successfully"}
{"level":30,"time":1768088209633,"env":"test","module":"email-queue","jobId":"5ebf9d07-88d3-4512-a26b-9a313d0ad073","to":"test-IRvWNi8qQn592Uj86gbdu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mGET /api/projects/:ctx.projectId/workflows[2m > [22mshould list workflows[33m 578[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mGET /api/templates/:id/placeholders[2m > [22mshould extract placeholders[32m 289[2mms[22m[39m
{"level":30,"time":1768088209688,"env":"test","module":"auth-routes","userId":"e9d5ca61-0f92-45ab-a984-4ea7bbf64cc5","email":"test-IRvWNi8qQn592Uj86gbdu@example.com","msg":"User registered"}
{"level":30,"time":1768088209689,"env":"test","module":"audit-log-service","userId":"4a5a9cd8-fcc3-412e-8c28-80dc485ddc01","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088209695,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mSession Creation and Tracking[2m > [22mshould track device metadata in session[33m 1359[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould reject access without Authorization header[33m 1354[2mms[22m[39m
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768088210058,"env":"test","module":"user-credentials-repository","userId":"a8b88cfa-fca8-480e-b7b3-958db0c42761","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mPATCH /api/templates/:id[2m > [22mshould update template name[33m 380[2mms[22m[39m
{"level":30,"time":1768088210164,"env":"test","module":"email-queue","jobId":"292113b5-8c2f-48db-a98b-c10d5d6c295d","to":"session-test-Ve08e0HPnXvLX_sJAjcNr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088210202,"env":"test","module":"user-credentials-repository","userId":"4bdd74a3-4557-4db1-8ead-c868d3db4334","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mGET /api/projects/:ctx.projectId/workflows[2m > [22mshould filter by status[33m 594[2mms[22m[39m
{"level":30,"time":1768088210244,"env":"test","module":"auth-routes","userId":"e7fcd28b-44e0-458b-9887-62e65f363260","msg":"User logged in successfully"}
{"level":30,"time":1768088210302,"env":"test","module":"audit-log-service","userId":"e7fcd28b-44e0-458b-9887-62e65f363260","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768088210306,"env":"test","module":"auth-routes","userId":"a8b88cfa-fca8-480e-b7b3-958db0c42761","email":"session-test-Ve08e0HPnXvLX_sJAjcNr@example.com","msg":"User registered"}
{"level":50,"time":1768088210308,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088210318,"env":"test","module":"email-queue","jobId":"8b36150a-aba4-4c1c-a5f7-6ae7ff1b89a1","to":"protected-test-sWD_O3Eyj-oQY0GRoCpGf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088210352,"env":"test","module":"auth-routes","userId":"b2827fc0-679b-4530-aa41-df56d80691dd","msg":"User logged in successfully"}
{"level":30,"time":1768088210376,"env":"test","module":"auth-routes","userId":"4bdd74a3-4557-4db1-8ead-c868d3db4334","email":"protected-test-sWD_O3Eyj-oQY0GRoCpGf@example.com","msg":"User registered"}
{"level":30,"time":1768088210400,"env":"test","module":"auth-routes","userId":"e9d5ca61-0f92-45ab-a984-4ea7bbf64cc5","msg":"User logged in successfully"}
{"level":30,"time":1768088210404,"env":"test","module":"audit-log-service","userId":"b2827fc0-679b-4530-aa41-df56d80691dd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould return 401 when no token provided[33m 1496[2mms[22m[39m
{"level":40,"time":1768088210441,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
 [32mÎ“Â£Ã´[39m tests/integration/workflow_versioning.test.ts[2m > [22mWorkflow Versioning & Lineage[2m > [22mshould diff two versions correctly[32m 2[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/workflow_versioning.test.ts[2m > [22mWorkflow Versioning & Lineage[2m > [22mshould create a version and populate changelog[32m 9[2mms[22m[39m
[31m   Î“Ã¥Ã† Validation failed: Schema Error: id - Required, Schema Error: title - Required, Schema Error: pages.0.title - Required, Schema Error: pages.0.order - Required[39m
 [31mâ”œÃ¹[39m tests/integration/workflow_versioning.test.ts[2m > [22mWorkflow Versioning & Lineage[2m > [22mshould track execution lineage via snapshot[32m 54[2mms[22m[39m
[31m   Î“Ã¥Ã† Cannot read properties of undefined (reading 'id')[39m
{"level":30,"time":1768088210456,"env":"test","module":"audit-log-service","userId":"e9d5ca61-0f92-45ab-a984-4ea7bbf64cc5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Generation[2m > [22mshould include correct payload in JWT token[33m 1627[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mSelect/Multiselect Columns[2m > [22mshould validate multiselect values as array[33m 937[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mTemplates API[2m > [22mDELETE /api/templates/:id[2m > [22mshould delete template[33m 460[2mms[22m[39m
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/intake.workflow.test.ts[2m > [22mIntake Workflow Integration Tests[2m > [22mshould allow linking a downstream workflow to an intake workflow[33m 1457[2mms[22m[39m
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > POST /api/workflows/:id/run - Template Node Execution > should execute workflow with template node and generate DOCX
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mRuns API[2m > [22mPOST /api/workflows/:id/run[2m > [22mshould execute workflow[32m 299[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/isolatedVmBridge.test.ts[2m > [22misolated-vm Bridge Verification[2m > [22mshould execute JS and use simple helpers (string)[32m 83[2mms[22m[39m
{"level":30,"time":1768088210870,"env":"test","module":"user-credentials-repository","userId":"c10e5d93-4e7e-4cf7-bd8d-9aa555eec25a","msg":"User credentials created"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088210893,"env":"test","module":"user-credentials-repository","userId":"569730f7-5f01-4acb-bcbd-2e31a0373abf","msg":"User credentials created"}
{"level":30,"time":1768088210918,"env":"test","module":"user-credentials-repository","userId":"0ed1c50d-9165-4c35-be92-27e732ba7454","msg":"User credentials created"}
{"level":30,"time":1768088210944,"env":"test","module":"auth-routes","userId":"a8b88cfa-fca8-480e-b7b3-958db0c42761","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/unit/isolatedVmBridge.test.ts[2m > [22misolated-vm Bridge Verification[2m > [22mshould execute JS and use complex helpers (math.sum)[33m 337[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/isolatedVmBridge.test.ts[2m > [22misolated-vm Bridge Verification[2m > [22mshould execute JS and capture console logs[32m 55[2mms[22m[39m
{"level":30,"time":1768088210980,"env":"test","module":"email-queue","jobId":"9fd1bd41-d97c-4f1e-9cf6-80a3b103e5ef","to":"jwt-test-VzSjwo_SDn6T16FVCaiMY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088210995,"env":"test","module":"audit-log-service","userId":"a8b88cfa-fca8-480e-b7b3-958db0c42761","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088211004,"env":"test","module":"email-queue","jobId":"eaf20099-0c49-4d29-b0a7-1f1e017e244a","to":"test-kInLx3EWCueBC7TDyVTzy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088211024,"env":"test","module":"email-queue","jobId":"aa059a6e-6c0c-462b-95c7-e51fcf783830","to":"middleware-test-3zru3dk6YYXl-RTEuiCo3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088211033,"env":"test","module":"auth-routes","userId":"c10e5d93-4e7e-4cf7-bd8d-9aa555eec25a","email":"jwt-test-VzSjwo_SDn6T16FVCaiMY@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAutonumber Columns[2m > [22mshould create an autonumber column with sequence[33m 514[2mms[22m[39m
{"level":40,"time":1768088210508,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768088210856,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768088210900,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768088210976,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
 [32mÎ“Â£Ã´[39m tests/unit/isolatedVmBridge.test.ts[2m > [22misolated-vm Bridge Verification[2m > [22mshould access context data[32m 76[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/isolatedVmBridge.test.ts[2m > [22misolated-vm Bridge Verification[2m > [22mshould fail on missing helper[32m 59[2mms[22m[39m
{"level":30,"time":1768088211065,"env":"test","module":"auth-routes","userId":"569730f7-5f01-4acb-bcbd-2e31a0373abf","email":"test-kInLx3EWCueBC7TDyVTzy@example.com","msg":"User registered"}
{"level":30,"time":1768088211077,"env":"test","module":"auth-routes","userId":"0ed1c50d-9165-4c35-be92-27e732ba7454","email":"middleware-test-3zru3dk6YYXl-RTEuiCo3@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mRuns API[2m > [22mPOST /api/workflows/:id/run[2m > [22mshould include logs in debug mode[32m 280[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mRuns API[2m > [22mPOST /api/workflows/:id/run[2m > [22mshould reject without required permission[32m 9[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 201 "Created", got 400 "Bad Request"[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mGET /api/projects/:ctx.projectId/workflows[2m > [22mshould search by name[33m 965[2mms[22m[39m
{"level":30,"time":1768088211223,"env":"test","module":"auth-routes","userId":"4bdd74a3-4557-4db1-8ead-c868d3db4334","msg":"User logged in successfully"}
{"level":30,"time":1768088211281,"env":"test","module":"audit-log-service","userId":"4bdd74a3-4557-4db1-8ead-c868d3db4334","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088211287,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould reject access with empty Bearer token[33m 1591[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mRuns API[2m > [22mGET /api/runs[2m > [22mshould list runs[33m 406[2mms[22m[39m
{"level":30,"time":1768088211566,"env":"test","module":"auth-routes","userId":"a8b88cfa-fca8-480e-b7b3-958db0c42761","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088211618,"env":"test","module":"audit-log-service","userId":"a8b88cfa-fca8-480e-b7b3-958db0c42761","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1768088211645,"env":"test","module":"auth-routes","userId":"c10e5d93-4e7e-4cf7-bd8d-9aa555eec25a","msg":"User logged in successfully"}
{"level":30,"time":1768088211698,"env":"test","module":"audit-log-service","userId":"c10e5d93-4e7e-4cf7-bd8d-9aa555eec25a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088211722,"env":"test","module":"auth-routes","userId":"0ed1c50d-9165-4c35-be92-27e732ba7454","msg":"User logged in successfully"}
{"level":30,"time":1768088211732,"env":"test","module":"auth-routes","userId":"569730f7-5f01-4acb-bcbd-2e31a0373abf","msg":"User logged in successfully"}
{"level":30,"time":1768088211772,"env":"test","module":"user-credentials-repository","userId":"9f62633c-16ab-468e-b75d-5f958644ff88","msg":"User credentials created"}
{"level":30,"time":1768088211778,"env":"test","module":"audit-log-service","userId":"0ed1c50d-9165-4c35-be92-27e732ba7454","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088211782,"env":"test","module":"audit-log-service","userId":"569730f7-5f01-4acb-bcbd-2e31a0373abf","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088211785,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Generation[2m > [22mshould set JWT expiry to 15 minutes[33m 1293[2mms[22m[39m
{"level":30,"time":1768088211882,"env":"test","module":"email-queue","jobId":"39c42474-479d-4d97-a27b-90da36703840","to":"protected-test-K_sJjiTV7ZhZEl3sjzRQn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould return 401 with invalid token[33m 1477[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22mshould create draft version on successful AI edit
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22mshould enforce draft mode (revert active workflow to draft)
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22mshould not create version when no changes detected (checksum match)
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22mshould reject unauthorized access
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22mshould reject unsafe DataVault operations
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22mshould handle multi-operation edits with tempId resolution
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22mshould create BEFORE and AFTER snapshots
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/ai/workflowEdit.test.ts[2m > [22mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22mshould rollback on validation failure
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088211933,"env":"test","module":"auth-routes","userId":"9f62633c-16ab-468e-b75d-5f958644ff88","email":"protected-test-K_sJjiTV7ZhZEl3sjzRQn@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mRuns API[2m > [22mGET /api/runs[2m > [22mshould filter by workflowId[33m 417[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPATCH /api/workflows/:id[2m > [22mshould update draft workflow[33m 731[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAutonumber Columns[2m > [22mshould format autonumber with prefix[33m 1071[2mms[22m[39m
{"level":30,"time":1768088212259,"env":"test","module":"auth-routes","userId":"a8b88cfa-fca8-480e-b7b3-958db0c42761","msg":"User logged in successfully"}
{"level":30,"time":1768088212288,"env":"test","module":"user-credentials-repository","userId":"c6b70aba-0288-4b61-b5d2-2c600eacb548","msg":"User credentials created"}
{"level":30,"time":1768088212313,"env":"test","module":"audit-log-service","userId":"a8b88cfa-fca8-480e-b7b3-958db0c42761","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mRuns API[2m > [22mGET /api/runs/:id[2m > [22mshould get run by ID[33m 451[2mms[22m[39m
{"level":30,"time":1768088212392,"env":"test","module":"email-queue","jobId":"21b79490-5729-4ffa-ba4b-3f5d02960c1a","to":"jwt-test-EY_9IUFng9vEhXYs2Y4Rs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088212392,"env":"test","module":"user-credentials-repository","userId":"24900388-b69d-43f7-9ac5-af7f916396ff","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: cc776424-f484-42aa-b9c1-b8965871a0c8 tenantId: f3fd7823-fcc5-4465-b2b1-55fc70b34c20 userId: google-user-id

{"level":30,"time":1768088212437,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088212450,"env":"test","module":"auth-routes","userId":"c6b70aba-0288-4b61-b5d2-2c600eacb548","email":"jwt-test-EY_9IUFng9vEhXYs2Y4Rs@example.com","msg":"User registered"}
{"level":30,"time":1768088212457,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts[2m > [22m[2mStage 13: Workflow Snapshots & Versioning
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088212446,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088212446,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088212451,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088212456,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088212456,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088212456,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088212457,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088212501,"env":"test","module":"email-queue","jobId":"442c542c-1f0e-4092-9ac0-b23ccd9f768e","to":"middleware-test-LIk-k7dK44tfB-6uFvJ7n@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088212525,"env":"test","module":"user-credentials-repository","userId":"225c166e-f033-40cf-aff1-7ebb94453c95","msg":"User credentials created"}
{"level":30,"time":1768088212560,"env":"test","module":"auth-routes","userId":"24900388-b69d-43f7-9ac5-af7f916396ff","email":"middleware-test-LIk-k7dK44tfB-6uFvJ7n@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mRow Notes[2m > [22mshould create a note for a row[33m 487[2mms[22m[39m
{"level":30,"time":1768088212626,"env":"test","module":"email-queue","jobId":"d0ac604c-10c4-4d7f-81fb-75fc9fe301a6","to":"test-4c93lu3WmomDnN4GEmdw4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.docx.test.ts[2m > [22mRuns API - DOCX Generation Integration Tests[2m > [22mPOST /api/workflows/:id/run - Template Node Execution[2m > [22mshould execute workflow with template node and generate DOCX[33m 2070[2mms[22m[39m
{"level":30,"time":1768088212683,"env":"test","module":"auth-routes","userId":"225c166e-f033-40cf-aff1-7ebb94453c95","email":"test-4c93lu3WmomDnN4GEmdw4@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > POST /api/workflows/:id/run - Template Node Execution > should handle missing template data gracefully
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

{"level":30,"time":1768088212831,"env":"test","module":"user-credentials-repository","userId":"899e7d67-4771-424f-89cc-1befeeba389f","msg":"User credentials created"}
{"level":50,"time":1768088212848,"env":"test","error":{},"msg":"Error creating row note"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPATCH /api/workflows/:id[2m > [22mshould not allow editing published workflow[33m 931[2mms[22m[39m
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/api.templates-runs.test.ts[2m > [22mTemplates and Runs API Integration Tests[2m > [22mRuns API[2m > [22mGET /api/runs/:id/logs[2m > [22mshould get run logs[33m 504[2mms[22m[39m
{"level":50,"time":1768088212919,"env":"test","error":{},"msg":"Error creating row note"}
{"level":30,"time":1768088212937,"env":"test","module":"auth-routes","userId":"9f62633c-16ab-468e-b75d-5f958644ff88","msg":"User logged in successfully"}
{"level":30,"time":1768088212936,"env":"test","module":"email-queue","jobId":"896b67a1-821e-434d-8f86-73a544d75562","to":"session-test-UUlJN46g1yzJa-i4ZUD_Y@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768088212987,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":30,"time":1768088212989,"env":"test","module":"auth-routes","userId":"899e7d67-4771-424f-89cc-1befeeba389f","email":"session-test-UUlJN46g1yzJa-i4ZUD_Y@example.com","msg":"User registered"}
{"level":30,"time":1768088212996,"env":"test","module":"audit-log-service","userId":"9f62633c-16ab-468e-b75d-5f958644ff88","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088212997,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":50,"time":1768088213003,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mSession Creation and Tracking[2m > [22mshould create separate sessions for multiple device logins[33m 2773[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould reject access with malformed Authorization header[33m 1716[2mms[22m[39m
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mâ”œÃ¹[39m tests/integration/api.snapshots.test.ts[2m > [22mStage 13: Workflow Snapshots & Versioning[2m > [22mshould maintain immutability of runs across versions[33m 318[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 200 // Object.is equality[39m
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088213160,"env":"test","module":"auth-routes","userId":"c6b70aba-0288-4b61-b5d2-2c600eacb548","msg":"User logged in successfully"}
{"level":30,"time":1768088213214,"env":"test","module":"audit-log-service","userId":"c6b70aba-0288-4b61-b5d2-2c600eacb548","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [31mâ”œÃ¹[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mRow Notes[2m > [22mshould get all notes for a row[33m 553[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 404 to be 200 // Object.is equality[39m
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088213301,"env":"test","module":"auth-routes","userId":"24900388-b69d-43f7-9ac5-af7f916396ff","msg":"User logged in successfully"}
{"level":50,"time":1768088213325,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768088213331,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088213352,"env":"test","module":"audit-log-service","userId":"24900388-b69d-43f7-9ac5-af7f916396ff","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088213403,"env":"test","module":"auth-routes","userId":"225c166e-f033-40cf-aff1-7ebb94453c95","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Validation[2m > [22mshould accept valid JWT token on protected routes[33m 1620[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Validation[2m > [22mshould reject request without authorization header[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Validation[2m > [22mshould reject request with malformed token[32m 7[2mms[22m[39m
{"level":30,"time":1768088213454,"env":"test","module":"audit-log-service","userId":"225c166e-f033-40cf-aff1-7ebb94453c95","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 8239cf35-9ed8-47a5-8b9f-a7e4004bb36b tenantId: f3fd7823-fcc5-4465-b2b1-55fc70b34c20 userId: google-user-id

{"level":30,"time":1768088213466,"env":"test","module":"user-credentials-repository","userId":"be84af82-f26d-445d-8fbe-7015a8c81854","msg":"User credentials created"}
{"level":30,"time":1768088213577,"env":"test","module":"email-queue","jobId":"979b7dbc-d896-4eb8-a078-f54eea94f6a2","to":"protected-test-YFbvSrb1z6CUP0eaL0_ZH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088213629,"env":"test","module":"auth-routes","userId":"899e7d67-4771-424f-89cc-1befeeba389f","msg":"User logged in successfully"}
{"level":50,"time":1768088213634,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":30,"time":1768088213635,"env":"test","module":"auth-routes","userId":"be84af82-f26d-445d-8fbe-7015a8c81854","email":"protected-test-YFbvSrb1z6CUP0eaL0_ZH@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPOST /api/workflows/:id/publish[2m > [22mshould publish workflow[33m 775[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768088213680,"env":"test","module":"audit-log-service","userId":"899e7d67-4771-424f-89cc-1befeeba389f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088213777,"env":"test","module":"user-credentials-repository","userId":"2cded50f-f101-4f5a-9c2e-9e21fd7e8f92","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould allow owner to read table[32m 118[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mRow Notes[2m > [22mshould delete a note[33m 644[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 404 to be 200 // Object.is equality[39m
{"level":30,"time":1768088213883,"env":"test","module":"email-queue","jobId":"00c857f0-2335-4dec-b5e9-c73f7c9a465b","to":"jwt-test-BRZby_he-Dr8aS-WlqtxB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088213941,"env":"test","module":"auth-routes","userId":"2cded50f-f101-4f5a-9c2e-9e21fd7e8f92","email":"jwt-test-BRZby_he-Dr8aS-WlqtxB@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould allow writer to read table[32m 165[2mms[22m[39m
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould allow reader to read table[32m 160[2mms[22m[39m
{"level":50,"time":1768088214123,"env":"test","error":{},"msg":"Error fetching DataVault table"}
 [31mâ”œÃ¹[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mRow Notes[2m > [22mshould not allow deleting notes by other users[33m 386[2mms[22m[39m
[31m   Î“Ã¥Ã† insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould deny non-member from reading table[32m 115[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768088214280,"env":"test","module":"auth-routes","userId":"899e7d67-4771-424f-89cc-1befeeba389f","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1768088214331,"env":"test","module":"audit-log-service","userId":"899e7d67-4771-424f-89cc-1befeeba389f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPATCH /api/datavault/tables/:tableId[2m > [22mshould allow owner to update table[32m 178[2mms[22m[39m
{"level":50,"time":1768088214409,"env":"test","error":{},"msg":"Error updating DataVault table"}
{"level":30,"time":1768088214471,"env":"test","module":"auth-routes","userId":"be84af82-f26d-445d-8fbe-7015a8c81854","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPATCH /api/datavault/tables/:tableId[2m > [22mshould deny writer from updating table[32m 106[2mms[22m[39m
{"level":30,"time":1768088214522,"env":"test","module":"audit-log-service","userId":"be84af82-f26d-445d-8fbe-7015a8c81854","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088214522,"env":"test","error":{},"msg":"Error updating DataVault table"}
{"level":40,"time":1768088214526,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088214527,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088214556,"env":"test","module":"auth-routes","userId":"2cded50f-f101-4f5a-9c2e-9e21fd7e8f92","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAPI Tokens[2m > [22mshould create an API token[33m 396[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mGET /api/workflows/:id/versions[2m > [22mshould list workflow versions[33m 938[2mms[22m[39m
{"level":30,"time":1768088214609,"env":"test","module":"audit-log-service","userId":"2cded50f-f101-4f5a-9c2e-9e21fd7e8f92","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPATCH /api/datavault/tables/:tableId[2m > [22mshould deny reader from updating table[32m 112[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mGET Protected Routes[2m > [22mshould reject access with wrong token type[33m 1523[2mms[22m[39m
{"level":50,"time":1768088214656,"env":"test","error":{},"msg":"Error deleting DataVault table"}
{"level":40,"time":1768088214676,"env":"test","module":"auth-middleware","error":{"name":"TokenExpiredError","code":"AUTH_002","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088214676,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768088214735,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088214735,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/tables/:tableId[2m > [22mshould deny writer from deleting table[32m 134[2mms[22m[39m
{"level":50,"time":1768088214774,"env":"test","error":{},"msg":"Error deleting DataVault table"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAPI Tokens[2m > [22mshould validate API token scopes[32m 228[2mms[22m[39m
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Validation[2m > [22mshould accept request with missing Bearer prefix (lenient)[33m 1394[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Validation[2m > [22mshould reject token with invalid signature[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mrequireAuth Middleware[2m > [22mshould return 401 with expired token[33m 2891[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalAuth Middleware[2m > [22mshould proceed without authentication if no token provided
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/tables/:tableId[2m > [22mshould deny reader from deleting table[32m 118[2mms[22m[39m
{"level":50,"time":1768088214899,"env":"test","error":{},"msg":"Error deleting DataVault table"}
{"level":30,"time":1768088214904,"env":"test","module":"auth-routes","userId":"899e7d67-4771-424f-89cc-1befeeba389f","msg":"User logged in successfully"}
{"level":30,"time":1768088214957,"env":"test","module":"audit-log-service","userId":"899e7d67-4771-424f-89cc-1befeeba389f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088214976,"env":"test","module":"user-credentials-repository","userId":"49089fe7-13ba-44d8-a358-9d8736b78088","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/tables/:tableId[2m > [22mshould deny non-member from deleting table[32m 125[2mms[22m[39m
{"level":30,"time":1768088215068,"env":"test","module":"auth-routes","userId":"899e7d67-4771-424f-89cc-1befeeba389f","sessionCount":3,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088215076,"env":"test","module":"email-queue","jobId":"e71ed6f9-a291-4727-ad51-157764e10c14","to":"protected-test-QYQijktWGJkLu5IAP3mCt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId/permissions[2m > [22mshould allow owner to view permissions[32m 116[2mms[22m[39m
{"level":50,"time":1768088215123,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":30,"time":1768088215126,"env":"test","module":"auth-routes","userId":"49089fe7-13ba-44d8-a358-9d8736b78088","email":"protected-test-QYQijktWGJkLu5IAP3mCt@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould list all active sessions for user[33m 2700[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAPI Tokens[2m > [22mshould revoke (delete) an API token[33m 376[2mms[22m[39m
[31m   Î“Ã¥Ã† insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId/permissions[2m > [22mshould deny writer from viewing permissions[32m 109[2mms[22m[39m
{"level":50,"time":1768088215232,"env":"test","error":{},"msg":"Error fetching table permissions"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088215325,"env":"test","module":"user-credentials-repository","userId":"97444af8-ff2a-404a-9d66-b2707dd20d6d","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mGET /api/datavault/tables/:tableId/permissions[2m > [22mshould deny reader from viewing permissions[32m 109[2mms[22m[39m
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768088215444,"env":"test","module":"email-queue","jobId":"16ea7fbd-e6a4-4f3a-b297-837166a28603","to":"middleware-test-_SPjdVBZjqd6pttxj8DVA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088215497,"env":"test","module":"user-credentials-repository","userId":"9d7814c2-5d0c-4245-9231-ca82685c7abf","msg":"User credentials created"}
{"level":30,"time":1768088215500,"env":"test","module":"auth-routes","userId":"97444af8-ff2a-404a-9d66-b2707dd20d6d","email":"middleware-test-_SPjdVBZjqd6pttxj8DVA@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPOST /api/datavault/tables/:tableId/permissions[2m > [22mshould allow owner to grant permissions[32m 221[2mms[22m[39m
{"level":30,"time":1768088215597,"env":"test","module":"email-queue","jobId":"87d5ab0c-49d8-4185-9972-40a4d19e4761","to":"session-test-2IMl-dhmUd6ZbPqWzpqui@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31mâ”œÃ¹[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mAPI Tokens[2m > [22mshould deny access with expired token[33m 429[2mms[22m[39m
[31m   Î“Ã¥Ã† insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"[39m
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.docx.test.ts[2m > [22mRuns API - DOCX Generation Integration Tests[2m > [22mPOST /api/workflows/:id/run - Template Node Execution[2m > [22mshould handle missing template data gracefully[33m 2937[2mms[22m[39m
{"level":30,"time":1768088215650,"env":"test","module":"auth-routes","userId":"9d7814c2-5d0c-4245-9231-ca82685c7abf","email":"session-test-2IMl-dhmUd6ZbPqWzpqui@example.com","msg":"User registered"}
{"level":50,"time":1768088215722,"env":"test","error":{},"msg":"Error granting table permission"}
 [31mâ”œÃ¹[39m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #1: Project transfer cascades runs ownership[2m > [22mshould cascade ownership to workflow runs when project is transferred[33m 933[2mms[22m[39m
[31m   Î“Ã¥Ã† workflows is not defined[39m
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > GET /api/runs/:id/download - Download Generated DOCX
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPOST /api/datavault/tables/:tableId/permissions[2m > [22mshould allow owner to update existing permission (upsert)[33m 326[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould grant table permission[32m 269[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 403 to be 201 // Object.is equality[39m
{"level":50,"time":1768088215901,"env":"test","error":{},"msg":"Error granting table permission"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPOST /api/datavault/tables/:tableId/permissions[2m > [22mshould deny writer from granting permissions[32m 123[2mms[22m[39m
{"level":30,"time":1768088216014,"env":"test","workflowId":"d2862e77-8340-4e06-85e4-a0fe7e00a0e4","userId":"25be478e-1d44-4ef3-b6f9-8c615cd0c98d","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1768088216027,"env":"test","module":"auth-middleware","error":{"name":"TokenExpiredError","code":"AUTH_002","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088216034,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":30,"time":1768088216126,"env":"test","module":"auth-routes","userId":"97444af8-ff2a-404a-9d66-b2707dd20d6d","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPOST /api/datavault/tables/:tableId/permissions[2m > [22mshould prevent modifying table owner permissions[32m 134[2mms[22m[39m
{"level":50,"time":1768088216027,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088216151,"env":"test","module":"email-queue","jobId":"425d7494-5d38-4a16-889d-511d5100c9e4","to":"audit-user2@test.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768088216176,"env":"test","module":"audit-log-service","userId":"97444af8-ff2a-404a-9d66-b2707dd20d6d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088216176,"env":"test","module":"auth-routes","userId":"49089fe7-13ba-44d8-a358-9d8736b78088","msg":"User logged in successfully"}
{"level":30,"time":1768088216234,"env":"test","module":"audit-log-service","userId":"49089fe7-13ba-44d8-a358-9d8736b78088","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [31mâ”œÃ¹[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould list table permissions[33m 381[2mms[22m[39m
[31m   Î“Ã¥Ã† insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Expiration[2m > [22mshould reject expired JWT token[33m 1424[2mms[22m[39m
{"level":30,"time":1768088216379,"env":"test","module":"auth-routes","userId":"9d7814c2-5d0c-4245-9231-ca82685c7abf","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould authenticate with JWT Bearer token[33m 1609[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPOST Protected Routes[2m > [22mshould allow POST with valid Bearer token[33m 1763[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mCollection Table[2m > [22mshould have correct table name[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mCollection Table[2m > [22mshould have required columns[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mCollectionField Table[2m > [22mshould have correct table name[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mCollectionField Table[2m > [22mshould have required columns[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mRecord Table[2m > [22mshould have correct table name[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mRecord Table[2m > [22mshould have required columns[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mCollection Field Type Enum[2m > [22mshould have all expected field types[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionSchema[2m > [22mshould validate valid collection data[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionSchema[2m > [22mshould require tenantId, name, and slug[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionSchema[2m > [22mshould omit id, createdAt, and updatedAt[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionSchema[2m > [22mshould allow description to be null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionFieldSchema[2m > [22mshould validate valid field data[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionFieldSchema[2m > [22mshould require collectionId, name, slug, and type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionFieldSchema[2m > [22mshould validate field type enum[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionFieldSchema[2m > [22mshould reject invalid field type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionFieldSchema[2m > [22mshould allow options for select types[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertCollectionFieldSchema[2m > [22mshould allow defaultValue[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertRecordSchema[2m > [22mshould validate valid record data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertRecordSchema[2m > [22mshould require tenantId, collectionId, and data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertRecordSchema[2m > [22mshould allow empty data object[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertRecordSchema[2m > [22mshould allow createdBy and updatedBy to be null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mInsert Schemas[2m > [22minsertRecordSchema[2m > [22mshould allow complex nested data structures[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mSchema Constraints[2m > [22mshould enforce unique slug per tenant for collections[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mSchema Constraints[2m > [22mshould enforce unique slug per collection for fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mSchema Constraints[2m > [22mshould cascade delete fields when collection is deleted[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mSchema Constraints[2m > [22mshould cascade delete records when collection is deleted[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mSchema Constraints[2m > [22mshould cascade delete records when tenant is deleted[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mSchema Constraints[2m > [22mshould set null on createdBy/updatedBy when user is deleted[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mJSONB Data Handling[2m > [22mshould support JSONB for field options[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mJSONB Data Handling[2m > [22mshould support JSONB for field default values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mJSONB Data Handling[2m > [22mshould support JSONB for record data with fieldSlug Î“Ã¥Ã† value mapping[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mType Inference[2m > [22mshould correctly infer Collection type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mType Inference[2m > [22mshould correctly infer CollectionField type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts[2m > [22mCollections Schema[2m > [22mType Inference[2m > [22mshould correctly infer CollectionRecord type[32m 0[2mms[22m[39m
{"level":30,"time":1768088216434,"env":"test","module":"audit-log-service","userId":"9d7814c2-5d0c-4245-9231-ca82685c7abf","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/permissions/:permissionId[2m > [22mshould allow owner to revoke permissions[33m 334[2mms[22m[39m
{"level":50,"time":1768088216538,"env":"test","error":{},"msg":"Error revoking table permission"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould move workflow to a project[33m 1588[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m1. Required + Show/Hide (Questions)[2m > [22mshould block Next when required visible question is empty[33m 332[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mDELETE /api/datavault/permissions/:permissionId[2m > [22mshould deny writer from revoking permissions[32m 169[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'b3db5c3e-c28b-4c86-841e-ee84779eba54'[39m,
  tableId: [32m'8ff46794-338e-44c2-a5f1-e22d3e87316d'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2026-01-10T23:36:58.158Z'[39m
}

{"level":30,"time":1768088216758,"env":"test","module":"user-credentials-repository","userId":"eff1447b-23a4-4a35-a735-41a61dbb3539","msg":"User credentials created"}
{"level":30,"time":1768088216757,"env":"test","module":"user-credentials-repository","userId":"85faa60e-3f2b-410e-bc8c-96d063644244","msg":"User credentials created"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould update table permission role[33m 563[2mms[22m[39m
{"level":40,"time":1768088216842,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1768088216861,"env":"test","module":"email-queue","jobId":"861a92a5-8446-40cb-a62e-83de5a0dee7e","to":"middleware-test-ETeOAXYKpNEc_r9AGn9D9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088216861,"env":"test","module":"email-queue","jobId":"0e65133c-ee25-4cc1-b98c-1e694423ba24","to":"protected-test-99jsWDI3Q53rN_b5RxROG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088216916,"env":"test","module":"auth-routes","userId":"85faa60e-3f2b-410e-bc8c-96d063644244","email":"protected-test-99jsWDI3Q53rN_b5RxROG@example.com","msg":"User registered"}
{"level":30,"time":1768088216916,"env":"test","module":"auth-routes","userId":"eff1447b-23a4-4a35-a735-41a61dbb3539","email":"middleware-test-ETeOAXYKpNEc_r9AGn9D9@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [31mâ”œÃ¹[39m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m1. Required + Show/Hide (Questions)[2m > [22mshould NOT block Next when required question is hidden[33m 354[2mms[22m[39m
[31m   Î“Ã¥Ã† expected true to be false // Object.is equality[39m
{"level":30,"time":1768088216968,"env":"test","module":"auth-routes","userId":"9d7814c2-5d0c-4245-9231-ca82685c7abf","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #2: Invite acceptance race condition[2m > [22mshould prevent double-acceptance via transaction[33m 1217[2mms[22m[39m
{"level":30,"time":1768088217018,"env":"test","module":"audit-log-service","userId":"9d7814c2-5d0c-4245-9231-ca82685c7abf","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPermission hierarchy[2m > [22mshould enforce owner includes write and read[32m 279[2mms[22m[39m
{"level":50,"time":1768088217090,"env":"test","error":{},"msg":"Error updating DataVault table"}
{"level":30,"time":1768088217127,"env":"test","module":"auth-routes","userId":"9d7814c2-5d0c-4245-9231-ca82685c7abf","sessionCount":2,"msg":"Listed active sessions"}
{"level":40,"time":1768088217182,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPermission hierarchy[2m > [22mshould enforce write includes read but not owner[32m 273[2mms[22m[39m
{"level":30,"time":1768088217230,"env":"test","workflowId":"4dbb3625-0525-45f2-8915-be7ab9d8fce3","userId":"25be478e-1d44-4ef3-b6f9-8c615cd0c98d","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould mark current session correctly[33m 2057[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m1. Required + Show/Hide (Questions)[2m > [22mshould block when required becomes visible and is empty[33m 331[2mms[22m[39m
{"level":40,"time":1768088217314,"env":"test","module":"auth-middleware","error":{"name":"TokenExpiredError","code":"AUTH_002","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088217314,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088217360,"env":"test","module":"email-queue","jobId":"639fdee7-fd44-4e6b-9c0f-3d99aba5d248","to":"email-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":50,"time":1768088217377,"env":"test","error":{},"msg":"Error updating DataVault table"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mJWT Token Expiration[2m > [22mshould return token_expired error code for expired tokens[33m 1155[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.permissions.test.ts[2m > [22mDataVault Table Permissions API (v4 Micro-Phase 6)[2m > [22mPermission hierarchy[2m > [22mshould enforce read is read-only[32m 286[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould revoke table permission[33m 662[2mms[22m[39m
{"level":30,"time":1768088217538,"env":"test","module":"auth-routes","userId":"eff1447b-23a4-4a35-a735-41a61dbb3539","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mBearer Token Authentication[2m > [22mshould authenticate with Bearer token in Authorization header[32m 125[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mBearer Token Authentication[2m > [22mshould work with Bearer token on POST requests[32m 0[2mms[22m[39m
{"level":40,"time":1768088217585,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1768088217593,"env":"test","module":"audit-log-service","userId":"eff1447b-23a4-4a35-a735-41a61dbb3539","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088217622,"env":"test","module":"user-credentials-repository","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","msg":"User credentials created"}
{"level":30,"time":1768088217664,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1768088217670,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #3: Invite email failure rollback[2m > [22mshould not create invite if email fails[33m 712[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m2. Required + Show/Hide (Pages)[2m > [22mshould skip hidden required page entirely[33m 404[2mms[22m[39m
[31m   Î“Ã¥Ã† expected true to be false // Object.is equality[39m
{"level":30,"time":1768088217699,"env":"test","module":"auth-routes","userId":"85faa60e-3f2b-410e-bc8c-96d063644244","msg":"User logged in successfully"}
{"level":30,"time":1768088217715,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","descriptionLength":26,"msg":"AI logic generation requested"}
{"level":30,"time":1768088217715,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","duration":2,"changeCount":0,"msg":"AI logic generation succeeded"}
{"level":30,"time":1768088217724,"env":"test","module":"email-queue","jobId":"36d4199d-4560-44e4-bcfd-327202eeaf02","to":"session-test-SMg6dZSHvx4OXJgluDMHU@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088217728,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088217749,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088217753,"env":"test","module":"audit-log-service","userId":"85faa60e-3f2b-410e-bc8c-96d063644244","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/api.ai.logic.test.ts[2m > [22mAI Logic Routes[2m > [22mPOST /api/ai/workflows/generate-logic[2m > [22mshould return generated logic[32m 68[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/api.ai.logic.test.ts[2m > [22mAI Logic Routes[2m > [22mPOST /api/ai/workflows/debug-logic[2m > [22mshould return debug issues[32m 22[2mms[22m[39m
{"level":50,"time":1768088217759,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/api.ai.logic.test.ts[2m > [22mAI Logic Routes[2m > [22mPOST /api/ai/workflows/visualize-logic[2m > [22mshould return graph data[32m 13[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mTable Permissions[2m > [22mshould enforce RBAC - only owners can manage permissions[33m 339[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mBearer Token Authentication[2m > [22mshould work with Bearer token on PUT requests[32m 235[2mms[22m[39m
{"level":30,"time":1768088217782,"env":"test","module":"auth-routes","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","email":"session-test-SMg6dZSHvx4OXJgluDMHU@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould move workflow to Main Folder (projectId = null)[33m 1216[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPOST Protected Routes[2m > [22mshould reject POST without Bearer token[33m 1468[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould authenticate with refresh token cookie (GET only)[33m 1480[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.docx.test.ts[2m > [22mRuns API - DOCX Generation Integration Tests[2m > [22mGET /api/runs/:id/download - Download Generated DOCX[2m > [22mshould download DOCX output from successful run[32m 193[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768088217968,"env":"test","error":{},"workflowId":"41f9d25e-fff7-4bed-b869-2cd88b838b1f","userId":"25be478e-1d44-4ef3-b6f9-8c615cd0c98d","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1768088217972,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
 [31mâ”œÃ¹[39m tests/integration/analytics_service.test.ts[2m > [22mAnalytics Service Integration[2m > [22mshould generate events and metrics on run completion[32m 64[2mms[22m[39m
[31m   Î“Ã¥Ã† Workflow is not active[39m
{"level":40,"time":1768088218033,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768088218033,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768088218033,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768088218033,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768088218036,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768088218036,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768088218036,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mBearer Token Authentication[2m > [22mshould work with Bearer token on DELETE requests[32m 277[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.docx.test.ts[2m > [22mRuns API - DOCX Generation Integration Tests[2m > [22mGET /api/runs/:id/download - Download Generated DOCX[2m > [22mshould return 404 for PDF when not generated[32m 171[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move to non-existent project[33m 686[2mms[22m[39m
{"level":30,"time":1768088218086,"env":"test","module":"email-queue","jobId":"a7f852dd-dae4-4856-a1f9-b0e821055f1e","to":"expired-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
stderr | tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/regression-REG-1.test.ts:79:13 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(6cab2f4c-e693-4dcb-bbc4-7bb4a72e7f42) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m2. Required + Show/Hide (Pages)[2m > [22mshould enforce required on visible page[33m 446[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m3. Preview/Snapshot/Live Parity[2m > [22mshould evaluate visibility consistently across modes[32m 2[2mms[22m[39m
[31m   Î“Ã¥Ã† expected true to be false // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m6. Failure Modes (No Silent Errors)[2m > [22mshould handle malformed visibility expression gracefully[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/regression-REG-1.test.ts[2m > [22mREG-1: Workflow Logic Regression[2m > [22m6. Failure Modes (No Silent Errors)[2m > [22mshould handle missing variable in visibility expression[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.docx.test.ts[2m > [22mRuns API - DOCX Generation Integration Tests[2m > [22mGET /api/runs/:id/download - Download Generated DOCX[2m > [22mshould return 404 for non-existent run[32m 122[2mms[22m[39m
{"level":30,"time":1768088218263,"env":"test","module":"user-credentials-repository","userId":"e7f7f2b8-b887-4513-89e7-a0ba48dc2726","msg":"User credentials created"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Cleanup error (non-fatal): error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.runs.docx.test.ts:195:9 {
  length: 311,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(9b4614eb-6baf-423a-bb13-e50fafb90e0c) is still referenced from table "runs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'runs',
  column: undefined,
  dataType: undefined,
  constraint: 'runs_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.docx.test.ts[2m > [22mRuns API - DOCX Generation Integration Tests[2m > [22mTemplate Placeholder Extraction[2m > [22mshould extract placeholders from uploaded template[32m 127[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088218321,"env":"test","module":"user-credentials-repository","userId":"44feca11-650a-4b99-ab64-78771da7659d","msg":"User credentials created"}
{"level":30,"time":1768088218376,"env":"test","module":"email-queue","jobId":"28c2fa13-25d5-4e8e-b996-4a65075bb88a","to":"middleware-test-xacSJzBHVkC0N50J34CC9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088218403,"env":"test","module":"user-credentials-repository","userId":"0dbccc84-c693-4970-bc0f-bb2ee749599d","msg":"User credentials created"}
{"level":30,"time":1768088218433,"env":"test","module":"auth-routes","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","msg":"User logged in successfully"}
{"level":30,"time":1768088218435,"env":"test","module":"auth-routes","userId":"e7f7f2b8-b887-4513-89e7-a0ba48dc2726","email":"middleware-test-xacSJzBHVkC0N50J34CC9@example.com","msg":"User registered"}
{"level":30,"time":1768088218441,"env":"test","module":"email-queue","jobId":"9ecac5bd-3b88-4a28-9404-cf6bc8a6be35","to":"protected-test-E5UV7CMoEpdGVOkMcEVuR@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768088218473,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088218500,"env":"test","module":"email-queue","jobId":"331a7e10-75b9-41f7-bb20-e2d39cc1d34a","to":"jwt-test-jitu4P_OFNmm5MlIcnPBG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088218551,"env":"test","module":"auth-routes","userId":"0dbccc84-c693-4970-bc0f-bb2ee749599d","email":"jwt-test-jitu4P_OFNmm5MlIcnPBG@example.com","msg":"User registered"}
{"level":30,"time":1768088218559,"env":"test","module":"audit-log-service","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move without authentication[33m 505[2mms[22m[39m
{"level":50,"time":1768088218721,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088218754,"env":"test","module":"auth-routes","userId":"44feca11-650a-4b99-ab64-78771da7659d","email":"protected-test-E5UV7CMoEpdGVOkMcEVuR@example.com","msg":"User registered"}
{"level":30,"time":1768088218805,"env":"test","module":"email-queue","jobId":"2a6876b1-3e90-463d-9854-b3703cf73cd7","to":"expired-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

 [32mÎ“Â£Ã´[39m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #5: Expired invites[2m > [22mshould allow re-invite after invite expires[33m 1495[2mms[22m[39m
{"level":30,"time":1768088219486,"env":"test","module":"user-credentials-repository","userId":"86201b39-98bd-4029-bb41-3aa4546f9063","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mGrid Performance[2m > [22mshould paginate rows efficiently[33m 1655[2mms[22m[39m
{"level":30,"time":1768088219580,"env":"test","module":"user-credentials-repository","userId":"71f0aaaf-2444-4eb0-a316-33bbbe12b07a","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768088219606,"env":"test","module":"email-queue","jobId":"40159b23-a843-4837-a64d-2f7558466bdc","to":"test-workflows-6zZP2g8q6Rn6qWM-LhoPf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768088219606,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
{"level":30,"time":1768088219662,"env":"test","module":"auth-routes","userId":"86201b39-98bd-4029-bb41-3aa4546f9063","email":"test-workflows-6zZP2g8q6Rn6qWM-LhoPf@example.com","msg":"User registered"}
{"level":30,"time":1768088219691,"env":"test","module":"email-queue","jobId":"1a762735-1979-4298-98f0-1539e0c54660","to":"user1-LyMTW2elKp2cZ9jHIdUZB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088219749,"env":"test","module":"auth-routes","userId":"71f0aaaf-2444-4eb0-a316-33bbbe12b07a","email":"user1-LyMTW2elKp2cZ9jHIdUZB@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mError Handling[2m > [22mshould return user-friendly error for invalid column type[32m 283[2mms[22m[39m
{"level":50,"time":1768088219880,"env":"test","error":{},"workflowId":"e3a12e33-2f8e-4315-b759-47e660d5a26a","userId":"86201b39-98bd-4029-bb41-3aa4546f9063","projectId":"776c4317-aff1-4fba-8ed7-53e7210d0139","msg":"Error moving workflow"}
{"level":30,"time":1768088219948,"env":"test","module":"auth-routes","userId":"e7f7f2b8-b887-4513-89e7-a0ba48dc2726","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #7: Delete organization[2m > [22mshould allow last admin to delete empty organization[33m 766[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move of workflow user does not own[33m 1407[2mms[22m[39m
{"level":30,"time":1768088220006,"env":"test","module":"audit-log-service","userId":"e7f7f2b8-b887-4513-89e7-a0ba48dc2726","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088220015,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould reject cookie auth for POST requests (mutation-strict)[33m 2249[2mms[22m[39m
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":50,"time":1768088220440,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1768088220448,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"130b37f2-4f6f-4b66-821a-8d0e910f8218","userId":"25be478e-1d44-4ef3-b6f9-8c615cd0c98d","projectId":"invalid-uuid","msg":"Error moving workflow"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move with invalid projectId format[33m 569[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mError Handling[2m > [22mshould return user-friendly error for missing required fields[33m 838[2mms[22m[39m
{"level":30,"time":1768088220601,"env":"test","module":"user-credentials-repository","userId":"428e824e-0176-473f-bffa-80dc41694a79","msg":"User credentials created"}
{"level":30,"time":1768088220606,"env":"test","module":"user-credentials-repository","userId":"18efeddf-5653-4560-826d-a1ddc9922821","msg":"User credentials created"}
{"level":30,"time":1768088220622,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088220707,"env":"test","module":"email-queue","jobId":"3ea66365-fd77-439b-994c-0890e5c21447","to":"user2-r85gTigEI8SJzhDo76CMi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088220718,"env":"test","module":"email-queue","jobId":"486eb0d3-aa76-4bcc-b223-90c725074820","to":"middleware-test-r02lqgqOv58osRj5esIv9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault-v4-regression.test.ts[2m > [22mDataVault v4 Regression Tests[2m > [22mError Handling[2m > [22mshould handle network errors gracefully[32m 223[2mms[22m[39m
{"level":30,"time":1768088220765,"env":"test","module":"auth-routes","userId":"428e824e-0176-473f-bffa-80dc41694a79","email":"user2-r85gTigEI8SJzhDo76CMi@example.com","msg":"User registered"}
{"level":30,"time":1768088220773,"env":"test","module":"auth-routes","userId":"18efeddf-5653-4560-826d-a1ddc9922821","email":"middleware-test-r02lqgqOv58osRj5esIv9@example.com","msg":"User registered"}
{"level":30,"time":1768088220774,"env":"test","module":"auth-routes","userId":"44feca11-650a-4b99-ab64-78771da7659d","msg":"User logged in successfully"}
{"level":30,"time":1768088220832,"env":"test","module":"audit-log-service","userId":"44feca11-650a-4b99-ab64-78771da7659d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088220839,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mâ”œÃ¹[39m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #7: Delete organization[2m > [22mshould prevent deletion if org owns assets[33m 925[2mms[22m[39m
[31m   Î“Ã¥Ã† workflows is not defined[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mCookie-to-Token Exchange[2m > [22mshould exchange valid session cookie for JWT token[33m 765[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mCookie-to-Token Exchange[2m > [22mshould reject token exchange without valid cookie[32m 4[2mms[22m[39m
{"level":30,"time":1768088220889,"env":"test","module":"auth-routes","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","msg":"User logged in successfully"}
{"level":30,"time":1768088220941,"env":"test","module":"audit-log-service","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPOST Protected Routes[2m > [22mshould reject POST with invalid token[33m 3081[2mms[22m[39m
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mHybrid Authentication Strategy[2m > [22mshould prefer Bearer token over cookie when both present[33m 2158[2mms[22m[39m
{"level":50,"time":1768088221029,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2e1cc4f0-2934-4b4e-964d-634ce77d26a1","userId":"25be478e-1d44-4ef3-b6f9-8c615cd0c98d","msg":"Error moving workflow"}
{"level":30,"time":1768088221059,"env":"test","module":"auth-routes","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","sessionCount":2,"msg":"Listed active sessions"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move without projectId in body[33m 587[2mms[22m[39m
{"level":30,"time":1768088221213,"env":"test","module":"auth-routes","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","sessionId":"ea01da57-68c2-4b73-a6ab-a42310eb7808","msg":"Session revoked"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768088221308,"env":"test","module":"email-queue","jobId":"631f3bb9-3ccc-45e0-8b23-16911bc74931","to":"placeholder-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768088221322,"env":"test","module":"auth-routes","userId":"dc3f61cf-6663-4655-ad40-5f4eb662500a","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768088221341,"env":"test","module":"user-credentials-repository","userId":"98f32e10-d571-44cc-98d1-f5891bace5a2","msg":"User credentials created"}
{"level":30,"time":1768088221404,"env":"test","module":"auth-routes","userId":"18efeddf-5653-4560-826d-a1ddc9922821","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould not include revoked sessions[33m 4195[2mms[22m[39m
{"level":30,"time":1768088221449,"env":"test","module":"email-queue","jobId":"9773acd8-6fec-457c-aa48-38017bd10c2b","to":"jwt-test-aVW6TbK353MVmvZt0FgMa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/portal.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1768088221465,"env":"test","module":"audit-log-service","userId":"18efeddf-5653-4560-826d-a1ddc9922821","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088221473,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088221502,"env":"test","module":"auth-routes","userId":"98f32e10-d571-44cc-98d1-f5891bace5a2","email":"jwt-test-aVW6TbK353MVmvZt0FgMa@example.com","msg":"User registered"}
{"level":50,"time":1768088221512,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088221530,"env":"test","module":"user-credentials-repository","userId":"78190d29-a0d3-4928-86a5-2160caa0c9f9","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould reject cookie auth for PUT requests[33m 1459[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mHybrid Authentication Strategy[2m > [22mshould fall back to cookie if Bearer token is invalid[33m 634[2mms[22m[39m
{"level":30,"time":1768088221643,"env":"test","module":"email-queue","jobId":"199a8246-c461-4ccb-b8a2-72f9c1ffe1fd","to":"protected-test-1HrpZYJikKqNWIrVNEpOM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088221697,"env":"test","module":"auth-routes","userId":"78190d29-a0d3-4928-86a5-2160caa0c9f9","email":"protected-test-1HrpZYJikKqNWIrVNEpOM@example.com","msg":"User registered"}
{"level":30,"time":1768088221822,"env":"test","module":"user-credentials-repository","userId":"37084105-f96a-409a-8071-8ebf6acfb784","msg":"User credentials created"}
{"level":30,"time":1768088221922,"env":"test","module":"email-queue","jobId":"98e3ef18-6f3a-4624-826e-d930eba42fd7","to":"session-test-t_IVzw7kJPCGpEY8Ea3Ix@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088221934,"env":"test","module":"user-credentials-repository","userId":"7904b6f9-1309-4fd4-9700-eb8db47fe0b9","msg":"User credentials created"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768088221972,"env":"test","module":"auth-routes","userId":"37084105-f96a-409a-8071-8ebf6acfb784","email":"session-test-t_IVzw7kJPCGpEY8Ea3Ix@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #8: Placeholder user cleanup[2m > [22m[2mshould cleanup placeholder user when invite is revoked
[22m[39mCleaned up placeholder user f7112072-8ebd-4cd4-98fc-9785758726ae (no pending invites or memberships)

{"level":30,"time":1768088222043,"env":"test","module":"email-queue","jobId":"a2eebeb0-4c82-470c-b01a-6c559817c6fc","to":"middleware-test-BNddBQy0nxhAGVId-AxN9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088222094,"env":"test","module":"user-credentials-repository","userId":"c1fcab1d-4987-4592-9aa3-bf57a59eb68d","msg":"User credentials created"}
{"level":30,"time":1768088222096,"env":"test","module":"auth-routes","userId":"7904b6f9-1309-4fd4-9700-eb8db47fe0b9","email":"middleware-test-BNddBQy0nxhAGVId-AxN9@example.com","msg":"User registered"}
{"level":30,"time":1768088222160,"env":"test","module":"user-credentials-repository","userId":"fef775f3-4e52-4e18-8b9c-723c9fbd4ecd","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768088222210,"env":"test","module":"email-queue","jobId":"5e951d23-514b-40a8-8d94-a1f1198c05eb","to":"test-workflows-NpDPEJA2C8HE1kb9cuGqG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088222264,"env":"test","module":"email-queue","jobId":"e697e226-c320-4f0d-8780-d7da63f7ba4e","to":"jwt-test-Pr4IkHoDnrFGjSOsEA7Oc@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088222264,"env":"test","module":"auth-routes","userId":"c1fcab1d-4987-4592-9aa3-bf57a59eb68d","email":"test-workflows-NpDPEJA2C8HE1kb9cuGqG@example.com","msg":"User registered"}
{"level":30,"time":1768088222317,"env":"test","module":"auth-routes","userId":"fef775f3-4e52-4e18-8b9c-723c9fbd4ecd","email":"jwt-test-Pr4IkHoDnrFGjSOsEA7Oc@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #8: Placeholder user cleanup[2m > [22mshould cleanup placeholder user when invite is revoked[33m 1511[2mms[22m[39m
{"level":30,"time":1768088222607,"env":"test","module":"auth-routes","userId":"78190d29-a0d3-4928-86a5-2160caa0c9f9","msg":"User logged in successfully"}
{"level":30,"time":1768088222611,"env":"test","module":"auth-routes","userId":"37084105-f96a-409a-8071-8ebf6acfb784","msg":"User logged in successfully"}
{"level":30,"time":1768088222658,"env":"test","module":"audit-log-service","userId":"78190d29-a0d3-4928-86a5-2160caa0c9f9","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088222664,"env":"test","module":"audit-log-service","userId":"37084105-f96a-409a-8071-8ebf6acfb784","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088222725,"env":"test","module":"auth-routes","userId":"7904b6f9-1309-4fd4-9700-eb8db47fe0b9","msg":"User logged in successfully"}
{"level":30,"time":1768088222759,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088222777,"env":"test","module":"audit-log-service","userId":"7904b6f9-1309-4fd4-9700-eb8db47fe0b9","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088222783,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088222791,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","msg":"AI workflow revision job enqueued"}
 [31mâ”œÃ¹[39m tests/integration/organizations-audit-fixes.test.ts[2m > [22mOrganization Audit Fixes[2m > [22mFIX #9: Transfer validation order[2m > [22mshould fail fast on non-existent org[33m 412[2mms[22m[39m
[31m   Î“Ã¥Ã† workflows is not defined[39m
{"level":30,"time":1768088222814,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768088222819,"env":"test","module":"ai-controller","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["workflowId"]},{"code":"invalid_type","expected":"object","received":"undefined","path":["currentWorkflow"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["userInstruction"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
 [32mÎ“Â£Ã´[39m tests/unit/api.ai.revise.test.ts[2m > [22mAI Routes Integration[2m > [22mPOST /api/ai/workflows/revise[2m > [22mshould enqueue revision job and return 202[32m 57[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/api.ai.revise.test.ts[2m > [22mAI Routes Integration[2m > [22mPOST /api/ai/workflows/revise[2m > [22mshould return 400 for invalid request usage[32m 9[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould reject cookie auth for DELETE requests[33m 1309[2mms[22m[39m
{"level":30,"time":1768088222890,"env":"test","module":"auth-routes","userId":"c1fcab1d-4987-4592-9aa3-bf57a59eb68d","msg":"User logged in successfully"}
{"level":30,"time":1768088222896,"env":"test","module":"auth-routes","userId":"fef775f3-4e52-4e18-8b9c-723c9fbd4ecd","msg":"User logged in successfully"}
stderr | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes
Cleanup error: ReferenceError: workflows is not defined
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:93:25
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPUT Protected Routes[2m > [22mshould allow PUT with valid Bearer token[33m 1986[2mms[22m[39m
{"level":30,"time":1768088222947,"env":"test","module":"audit-log-service","userId":"fef775f3-4e52-4e18-8b9c-723c9fbd4ecd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088222948,"env":"test","module":"audit-log-service","userId":"c1fcab1d-4987-4592-9aa3-bf57a59eb68d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mHybrid Authentication Strategy[2m > [22mshould allow GET requests with cookie auth only[33m 1600[2mms[22m[39m
{"level":50,"time":1768088223349,"env":"test","error":{},"workflowId":"13130e51-e60f-4968-af48-09f587064ec1","userId":"25be478e-1d44-4ef3-b6f9-8c615cd0c98d","projectId":"235a6805-e1a6-4d82-af17-a6d081a4e293","msg":"Error moving workflow"}
{"level":30,"time":1768088223382,"env":"test","module":"auth-routes","userId":"37084105-f96a-409a-8071-8ebf6acfb784","msg":"User logged in successfully"}
{"level":30,"time":1768088223408,"env":"test","module":"user-credentials-repository","userId":"8d9725db-e8e7-4ec5-af21-78e6261db587","msg":"User credentials created"}
{"level":30,"time":1768088223433,"env":"test","module":"audit-log-service","userId":"37084105-f96a-409a-8071-8ebf6acfb784","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts[2m > [22mWorkflows API Integration Tests[2m > [22mPUT /api/workflows/:id/move[2m > [22mshould reject move to project user does not have access to[33m 2314[2mms[22m[39m
{"level":30,"time":1768088223475,"env":"test","module":"user-credentials-repository","userId":"730a6f11-6a11-4912-9caa-749025612f8e","msg":"User credentials created"}
{"level":30,"time":1768088223517,"env":"test","module":"email-queue","jobId":"bb73bd57-fbd3-404e-bf51-9aeb35a982db","to":"middleware-test-Kk7fjBUnnLTL0k-o5sF7K@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768088223572,"env":"test","module":"auth-routes","userId":"8d9725db-e8e7-4ec5-af21-78e6261db587","email":"middleware-test-Kk7fjBUnnLTL0k-o5sF7K@example.com","msg":"User registered"}
{"level":30,"time":1768088223592,"env":"test","module":"email-queue","jobId":"2122d27b-a67e-4aba-9fd9-3f7551d9e036","to":"protected-test-hEMoHtkq_JNp_8vlc5iNi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088223596,"env":"test","module":"user-credentials-repository","userId":"c392d145-4549-4f4e-a3f2-35114e481957","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088223645,"env":"test","module":"auth-routes","userId":"730a6f11-6a11-4912-9caa-749025612f8e","email":"protected-test-hEMoHtkq_JNp_8vlc5iNi@example.com","msg":"User registered"}
{"level":30,"time":1768088223698,"env":"test","module":"email-queue","jobId":"8eab1eed-d5f0-4fbc-a93e-6112f465ce6f","to":"jwt-test-kg4LzDuLHHFvaI8YA0dFe@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088223758,"env":"test","module":"auth-routes","userId":"c392d145-4549-4f4e-a3f2-35114e481957","email":"jwt-test-kg4LzDuLHHFvaI8YA0dFe@example.com","msg":"User registered"}
{"level":50,"time":1768088223764,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mHybrid Authentication Strategy[2m > [22mshould reject POST requests with cookie auth only (mutation-strict)[33m 651[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088224161,"env":"test","module":"auth-routes","userId":"37084105-f96a-409a-8071-8ebf6acfb784","msg":"User logged in successfully"}
{"level":30,"time":1768088224211,"env":"test","module":"auth-routes","userId":"8d9725db-e8e7-4ec5-af21-78e6261db587","msg":"User logged in successfully"}
{"level":30,"time":1768088224215,"env":"test","module":"audit-log-service","userId":"37084105-f96a-409a-8071-8ebf6acfb784","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088224267,"env":"test","module":"audit-log-service","userId":"8d9725db-e8e7-4ec5-af21-78e6261db587","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088224321,"env":"test","module":"auth-routes","userId":"37084105-f96a-409a-8071-8ebf6acfb784","sessionCount":3,"msg":"Listed active sessions"}
 [31mâ”œÃ¹[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mOptional Authentication[2m > [22mshould allow anonymous access to public workflows[33m 477[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 200 "OK", got 404 "Not Found"[39m
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768088224405,"env":"test","module":"auth-routes","userId":"730a6f11-6a11-4912-9caa-749025612f8e","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould order sessions by last used (most recent first)[33m 2999[2mms[22m[39m
{"level":30,"time":1768088224459,"env":"test","module":"audit-log-service","userId":"730a6f11-6a11-4912-9caa-749025612f8e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088224469,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould allow cookie auth for HEAD requests[33m 1647[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPUT Protected Routes[2m > [22mshould reject PUT without Bearer token[33m 1643[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mshould throw error if template belongs to different project[33m 617[2mms[22m[39m
{"level":30,"time":1768088224770,"env":"test","module":"user-credentials-repository","userId":"0f6f0663-079b-4851-b56a-5aed7aeb84f4","msg":"User credentials created"}
 [31mâ”œÃ¹[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mOptional Authentication[2m > [22mshould attach user info if authenticated on optional auth routes[33m 468[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 200 "OK", got 404 "Not Found"[39m
{"level":30,"time":1768088224873,"env":"test","module":"email-queue","jobId":"6a4ccaf1-9552-426e-bbf9-8b3f66853125","to":"session-test-P7doBy6MmoVt4jbsgdkIt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088224876,"env":"test","module":"user-credentials-repository","userId":"1052e8db-205f-4015-a787-816616dfc418","msg":"User credentials created"}
{"level":30,"time":1768088224925,"env":"test","module":"user-credentials-repository","userId":"b436b875-0917-4127-a15d-496ea7d6a839","msg":"User credentials created"}
{"level":30,"time":1768088224928,"env":"test","module":"auth-routes","userId":"0f6f0663-079b-4851-b56a-5aed7aeb84f4","email":"session-test-P7doBy6MmoVt4jbsgdkIt@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768088224995,"env":"test","module":"email-queue","jobId":"94d49ab9-8cf0-4d2f-b72a-0b12f1ee0d75","to":"middleware-test-mRzDL9ZY3wtRMtPNGsmlJ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088225034,"env":"test","module":"email-queue","jobId":"e6f05cbe-112b-4fef-aeb1-d5adbb41cf37","to":"protected-test-Gth_aGH2G1hbDte8hSzX9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768088225042,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088225049,"env":"test","module":"auth-routes","userId":"1052e8db-205f-4015-a787-816616dfc418","email":"middleware-test-mRzDL9ZY3wtRMtPNGsmlJ@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768088225087,"env":"test","module":"auth-routes","userId":"b436b875-0917-4127-a15d-496ea7d6a839","email":"protected-test-Gth_aGH2G1hbDte8hSzX9@example.com","msg":"User registered"}
{"level":50,"time":1768088225151,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"datavault.createTable","databaseId":"db-123","name":"Submissions","columns":[{"name":"email","type":"text"},{"name":"submitted_at","type":"date"}]},"msg":"Failed to apply operation"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould require authentication[33m 722[2mms[22m[39m
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768088225151,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"datavault.addColumns","tableId":"table-123","columns":[{"name":"phone","type":"text"}]},"msg":"Failed to apply operation"}
{"level":50,"time":1768088225155,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"step.create","sectionRef":"temp-section-1","type":"short_text","title":"Field 1","alias":"field1"},"msg":"Failed to apply operation"}
{"level":50,"time":1768088225173,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"document.bindFields","id":"template-123","bindings":{"client_name":"nonExistentAlias"}},"msg":"Failed to apply operation"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mTempId Resolution[2m > [22mshould resolve section tempId to real UUID when creating step[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mTempId Resolution[2m > [22mshould handle multi-level tempId references[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mAlias Uniqueness Validation[2m > [22mshould reject duplicate step alias on create[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mAlias Uniqueness Validation[2m > [22mshould allow same alias on update of same step[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mAlias Uniqueness Validation[2m > [22mshould reject duplicate alias on update to different step[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mUnknown Operation Rejection[2m > [22mshould reject completely unknown operation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mUnknown Operation Rejection[2m > [22mshould reject malformed operation (missing required fields)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDataVault Additive Enforcement[2m > [22mshould reject unsafe DataVault operations (dropTable)[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDataVault Additive Enforcement[2m > [22mshould reject unsafe DataVault operations (dropColumn)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDataVault Additive Enforcement[2m > [22mshould reject unsafe DataVault operations (deleteRows)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDataVault Additive Enforcement[2m > [22mshould reject unsafe DataVault operations (updateRowData)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDataVault Additive Enforcement[2m > [22mshould allow safe DataVault operations (createTable, addColumns)[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mOperation Application[2m > [22mshould rollback all ops if any op fails[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mOperation Application[2m > [22mshould clear tempId mappings between batch calls[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mLogic Rule Operations[2m > [22mshould create visibility rule on step[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mLogic Rule Operations[2m > [22mshould parse complex condition expressions[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDocument Operations[2m > [22mshould attach document to workflow (document.add)[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDocument Operations[2m > [22mshould bind document fields to workflow variables (document.bindFields)[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDocument Operations[2m > [22mshould reject binding to non-existent step alias[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDataVault Operations[2m > [22mshould create DataVault table with columns (datavault.createTable)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts[2m > [22mWorkflowPatchService[2m > [22mDataVault Operations[2m > [22mshould create writeback mapping (datavault.createWritebackMapping)[32m 1[2mms[22m[39m
{"level":30,"time":1768088225331,"env":"test","module":"user-credentials-repository","userId":"25899efb-a7a1-40c4-a7c7-c0d44f95756e","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768088225434,"env":"test","module":"email-queue","jobId":"cfaaad00-9249-479f-add3-59a8d16ba09e","to":"jwt-test-YCwc6lJS-ZoJLlBC6uW9q@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088225487,"env":"test","module":"auth-routes","userId":"25899efb-a7a1-40c4-a7c7-c0d44f95756e","email":"jwt-test-YCwc6lJS-ZoJLlBC6uW9q@example.com","msg":"User registered"}
{"level":30,"time":1768088225509,"env":"test","module":"user-credentials-repository","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","msg":"User credentials created"}
{"level":30,"time":1768088225615,"env":"test","module":"email-queue","jobId":"6f1b5471-c3df-40b6-bc80-d76affe78f63","to":"session-test-f3s-HqfszXbPWhJWREbcW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mcreate[2m > [22mshould create a workflow template mapping[33m 665[2mms[22m[39m
{"level":30,"time":1768088225667,"env":"test","module":"auth-routes","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","email":"session-test-f3s-HqfszXbPWhJWREbcW@example.com","msg":"User registered"}
{"level":30,"time":1768088225674,"env":"test","module":"auth-routes","userId":"1052e8db-205f-4015-a787-816616dfc418","msg":"User logged in successfully"}
{"level":30,"time":1768088225725,"env":"test","module":"audit-log-service","userId":"1052e8db-205f-4015-a787-816616dfc418","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088225814,"env":"test","module":"auth-routes","userId":"b436b875-0917-4127-a15d-496ea7d6a839","msg":"User logged in successfully"}
{"level":30,"time":1768088225870,"env":"test","module":"audit-log-service","userId":"b436b875-0917-4127-a15d-496ea7d6a839","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mshould automatically unset other primaries when setting new primary[33m 1097[2mms[22m[39m
{"level":30,"time":1768088226090,"env":"test","module":"auth-routes","userId":"25899efb-a7a1-40c4-a7c7-c0d44f95756e","msg":"User logged in successfully"}
{"level":30,"time":1768088226143,"env":"test","module":"audit-log-service","userId":"25899efb-a7a1-40c4-a7c7-c0d44f95756e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mDELETE Protected Routes[2m > [22mshould allow DELETE with valid Bearer token[33m 1579[2mms[22m[39m
{"level":30,"time":1768088226325,"env":"test","module":"user-credentials-repository","userId":"5ffad42d-ee59-43e1-9f31-bf6810e22a31","msg":"User credentials created"}
{"level":30,"time":1768088226428,"env":"test","module":"email-queue","jobId":"52d9b086-dbd7-4171-b3bc-5a75615d3009","to":"user2-B2o_6wAGGxSmxIkppiIOT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088226455,"env":"test","module":"auth-routes","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","msg":"User logged in successfully"}
{"level":30,"time":1768088226473,"env":"test","module":"user-credentials-repository","userId":"43f535a6-7156-43bb-bbc5-beab90b8239d","msg":"User credentials created"}
{"level":30,"time":1768088226485,"env":"test","module":"auth-routes","userId":"5ffad42d-ee59-43e1-9f31-bf6810e22a31","email":"user2-B2o_6wAGGxSmxIkppiIOT@example.com","msg":"User registered"}
{"level":30,"time":1768088226506,"env":"test","module":"audit-log-service","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mcreate[2m > [22mshould create non-primary mapping by default[33m 643[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mlistTemplates[2m > [22mshould list all templates for workflow version[33m 825[2mms[22m[39m
{"level":30,"time":1768088226584,"env":"test","module":"email-queue","jobId":"8832cd78-cf64-4485-9458-e549b12d2856","to":"protected-test-4CEdXwoQBHc14fQmXi64u@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088226641,"env":"test","module":"auth-routes","userId":"43f535a6-7156-43bb-bbc5-beab90b8239d","email":"protected-test-4CEdXwoQBHc14fQmXi64u@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088227050,"env":"test","module":"auth-routes","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindByWorkflowVersionId[2m > [22mshould find all templates for a workflow version[33m 782[2mms[22m[39m
{"level":30,"time":1768088227085,"env":"test","module":"auth-routes","userId":"5ffad42d-ee59-43e1-9f31-bf6810e22a31","msg":"User logged in successfully"}
{"level":30,"time":1768088227102,"env":"test","module":"audit-log-service","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mlistTemplates[2m > [22mshould return empty array for version with no templates[33m 547[2mms[22m[39m
{"level":30,"time":1768088227137,"env":"test","module":"audit-log-service","userId":"5ffad42d-ee59-43e1-9f31-bf6810e22a31","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088227208,"env":"test","module":"auth-routes","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","sessionCount":2,"msg":"Listed active sessions"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould prioritize JWT over cookie when both present[33m 2819[2mms[22m[39m
{"level":30,"time":1768088227365,"env":"test","module":"auth-routes","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","sessionId":"e341fe9b-ce10-4133-860f-ac84078fed69","msg":"Session revoked"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088227376,"env":"test","module":"auth-routes","userId":"43f535a6-7156-43bb-bbc5-beab90b8239d","msg":"User logged in successfully"}
{"level":40,"time":1768088227417,"env":"test","module":"auth-service","userId":"d4a73a14-0e34-43f9-a0b7-af8b1a416023","tokenHash":"f87a4770694117258132cee50af6ed47c0a11bd63240e54a5caa97fc369e82e1","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768088227427,"env":"test","module":"audit-log-service","userId":"43f535a6-7156-43bb-bbc5-beab90b8239d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088227433,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mDELETE Protected Routes[2m > [22mshould reject DELETE without Bearer token[33m 1385[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mToken Refresh Flow[2m > [22mshould refresh access token using refresh token[33m 2733[2mms[22m[39m
{"level":30,"time":1768088227692,"env":"test","module":"user-credentials-repository","userId":"f4041dbd-00dd-479a-907f-607fe1b1dd83","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindByWorkflowVersionId[2m > [22mshould return empty array for version with no templates[33m 648[2mms[22m[39m
{"level":30,"time":1768088227801,"env":"test","module":"email-queue","jobId":"57e73e5c-cfd7-497d-bf66-f70fb360faa5","to":"middleware-test-QuBcLnwqr4iQBbq8UOujz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mgetTemplateMapping[2m > [22mshould get template mapping by id and version[33m 707[2mms[22m[39m
{"level":30,"time":1768088227856,"env":"test","module":"auth-routes","userId":"f4041dbd-00dd-479a-907f-607fe1b1dd83","email":"middleware-test-QuBcLnwqr4iQBbq8UOujz@example.com","msg":"User registered"}
{"level":30,"time":1768088227872,"env":"test","module":"user-credentials-repository","userId":"da0c648e-cfdf-4629-9190-640cfccdbffa","msg":"User credentials created"}
{"level":30,"time":1768088227887,"env":"test","module":"user-credentials-repository","userId":"452e4eec-1f82-4124-9487-5bf61b71a753","msg":"User credentials created"}
{"level":30,"time":1768088227893,"env":"test","module":"user-credentials-repository","userId":"8f5d07d1-3183-4486-bbc2-1ab3498c3e3a","msg":"User credentials created"}
{"level":30,"time":1768088227972,"env":"test","module":"email-queue","jobId":"7bd2b13d-c09a-4850-8af2-233b1de3a480","to":"jwt-test-FbPX9W_ajrxhsMf-pH_-m@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088227990,"env":"test","module":"email-queue","jobId":"b0e46131-6418-403e-9b8d-2a6e387d536a","to":"session-test-UHdBSfWCCFbU7Zj9lPeO7@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088228004,"env":"test","module":"email-queue","jobId":"297d70e6-9714-4a07-930f-85dba6881cbf","to":"protected-test-avdCGDy-ubkd28howmCyQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088228023,"env":"test","module":"auth-routes","userId":"da0c648e-cfdf-4629-9190-640cfccdbffa","email":"jwt-test-FbPX9W_ajrxhsMf-pH_-m@example.com","msg":"User registered"}
{"level":30,"time":1768088228041,"env":"test","module":"auth-routes","userId":"452e4eec-1f82-4124-9487-5bf61b71a753","email":"session-test-UHdBSfWCCFbU7Zj9lPeO7@example.com","msg":"User registered"}
{"level":30,"time":1768088228057,"env":"test","module":"auth-routes","userId":"8f5d07d1-3183-4486-bbc2-1ab3498c3e3a","email":"protected-test-avdCGDy-ubkd28howmCyQ@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould revoke specific session[33m 2427[2mms[22m[39m
stderr | tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should generate execution trace with lineage
[DEBUG Question] Node q1 executed. Key: userName, Value: Alice. Context keys: 3

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/debugging/Lineage.test.ts[2m > [22mDebug & Lineage[2m > [22mshould generate execution trace with lineage[32m 18[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/debugging/Lineage.test.ts[2m > [22mDebug & Lineage[2m > [22mshould track skipped blocks in trace[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mgetTemplateMapping[2m > [22mshould throw error if mapping not found[33m 540[2mms[22m[39m
{"level":30,"time":1768088228456,"env":"test","module":"auth-routes","userId":"f4041dbd-00dd-479a-907f-607fe1b1dd83","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindByWorkflowVersionId[2m > [22mshould order by createdAt desc (newest first)[33m 759[2mms[22m[39m
{"level":30,"time":1768088228416,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768088228511,"env":"test","module":"audit-log-service","userId":"f4041dbd-00dd-479a-907f-607fe1b1dd83","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088228519,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould return 401 when no auth provided[33m 1270[2mms[22m[39m
{"level":30,"time":1768088228641,"env":"test","module":"auth-routes","userId":"da0c648e-cfdf-4629-9190-640cfccdbffa","msg":"User logged in successfully"}
{"level":30,"time":1768088228690,"env":"test","module":"audit-log-service","userId":"da0c648e-cfdf-4629-9190-640cfccdbffa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088228700,"env":"test","module":"auth-routes","userId":"452e4eec-1f82-4124-9487-5bf61b71a753","msg":"User logged in successfully"}
{"level":30,"time":1768088228758,"env":"test","module":"audit-log-service","userId":"452e4eec-1f82-4124-9487-5bf61b71a753","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088228870,"env":"test","module":"auth-routes","userId":"452e4eec-1f82-4124-9487-5bf61b71a753","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768088228878,"env":"test","module":"auth-routes","userId":"8f5d07d1-3183-4486-bbc2-1ab3498c3e3a","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mTemplate Key Resolution (New Path)[2m > [22mshould resolve template by key from workflowTemplates mapping[33m 734[2mms[22m[39m
{"level":30,"time":1768088228936,"env":"test","module":"audit-log-service","userId":"8f5d07d1-3183-4486-bbc2-1ab3498c3e3a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768088228956,"env":"test","module":"auth-service","userId":"da0c648e-cfdf-4629-9190-640cfccdbffa","tokenHash":"9b8f37cff69060bd2d84273e57b90ea9408d3650b0838eea7a1d278b3e5e7604","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768088229039,"env":"test","module":"user-credentials-repository","userId":"0a69de28-321b-4f81-a581-99926d3ba26d","msg":"User credentials created"}
{"level":40,"time":1768088229075,"env":"test","module":"auth-service","userId":"da0c648e-cfdf-4629-9190-640cfccdbffa","tokenHash":"a0d262229226a731161baa3b9446d65b92dbb85544f1675be8a75885e70bf48e","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mgetTemplateByKey[2m > [22mshould get template by key[33m 718[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould prevent revoking current session[33m 1507[2mms[22m[39m
{"level":30,"time":1768088229149,"env":"test","module":"email-queue","jobId":"a3f1755b-473a-450d-82f7-ed4a6fbc1c0d","to":"middleware-test-m87wmF_GekDALZUxeFM2m@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindByWorkflowVersionAndKey[2m > [22mshould find mapping by workflow version and key[33m 717[2mms[22m[39m
{"level":30,"time":1768088229204,"env":"test","module":"auth-routes","userId":"0a69de28-321b-4f81-a581-99926d3ba26d","email":"middleware-test-m87wmF_GekDALZUxeFM2m@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mToken Refresh Flow[2m > [22mshould rotate refresh token on use[33m 1686[2mms[22m[39m
{"level":30,"time":1768088229400,"env":"test","module":"user-credentials-repository","userId":"e69b2162-5a21-4d0d-9bc8-5da3804d1b07","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mTemplate Key Resolution (New Path)[2m > [22mshould throw error if template key not found[33m 585[2mms[22m[39m
{"level":30,"time":1768088229505,"env":"test","module":"email-queue","jobId":"4aaf26a3-27e5-455a-9641-2f8813c60df7","to":"session-test-rD85V7eBvV1khXIG5OtHK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088229555,"env":"test","module":"auth-routes","userId":"e69b2162-5a21-4d0d-9bc8-5da3804d1b07","email":"session-test-rD85V7eBvV1khXIG5OtHK@example.com","msg":"User registered"}
{"level":30,"time":1768088229593,"env":"test","module":"user-credentials-repository","userId":"d76d8cc3-495f-4718-af9c-48baf9146264","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mgetTemplateByKey[2m > [22mshould throw error if key not found[33m 560[2mms[22m[39m
{"level":30,"time":1768088229693,"env":"test","module":"email-queue","jobId":"a3b3d75b-8612-42f4-bcb0-375ce2e3ec93","to":"jwt-test-14-0zE2L5jW_McUv53Yqx@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088229749,"env":"test","module":"auth-routes","userId":"d76d8cc3-495f-4718-af9c-48baf9146264","email":"jwt-test-14-0zE2L5jW_McUv53Yqx@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPATCH Protected Routes[2m > [22mshould allow PATCH with valid Bearer token[33m 2220[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindByWorkflowVersionAndKey[2m > [22mshould return undefined for non-existent key[33m 637[2mms[22m[39m
{"level":30,"time":1768088229830,"env":"test","module":"auth-routes","userId":"0a69de28-321b-4f81-a581-99926d3ba26d","msg":"User logged in successfully"}
{"level":30,"time":1768088229895,"env":"test","module":"audit-log-service","userId":"0a69de28-321b-4f81-a581-99926d3ba26d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088229901,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mhybridAuth Middleware[2m > [22mshould return 401 when both JWT and cookie are invalid[33m 1382[2mms[22m[39m
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mTemplate Key Resolution (New Path)[2m > [22mshould store output in runOutputs table[33m 761[2mms[22m[39m
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088230266,"env":"test","module":"user-credentials-repository","userId":"b6bca0a1-2e6f-4096-b68d-31a22175f714","msg":"User credentials created"}
{"level":30,"time":1768088230302,"env":"test","module":"user-credentials-repository","userId":"ffe87dc6-2684-4090-a2bf-20353e90be49","msg":"User credentials created"}
{"level":30,"time":1768088230364,"env":"test","module":"user-credentials-repository","userId":"79351e26-992a-4bb5-a0e4-b196762d8c76","msg":"User credentials created"}
{"level":30,"time":1768088230366,"env":"test","module":"email-queue","jobId":"879e36f0-babf-4bd6-8007-8586ac6565b9","to":"user2-TF1BMXSqOimJZ9YHfsSsy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768088230406,"env":"test","module":"email-queue","jobId":"ffeffddd-0a44-4024-9592-252e10c394ef","to":"protected-test--v4LcngLL5GO59geQMbQg@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088230417,"env":"test","module":"auth-routes","userId":"b6bca0a1-2e6f-4096-b68d-31a22175f714","email":"user2-TF1BMXSqOimJZ9YHfsSsy@example.com","msg":"User registered"}
{"level":30,"time":1768088230451,"env":"test","module":"auth-routes","userId":"d76d8cc3-495f-4718-af9c-48baf9146264","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768088230458,"env":"test","module":"auth-routes","userId":"ffe87dc6-2684-4090-a2bf-20353e90be49","email":"protected-test--v4LcngLL5GO59geQMbQg@example.com","msg":"User registered"}
{"level":30,"time":1768088230465,"env":"test","module":"email-queue","jobId":"bb373886-bfea-482b-8b8d-c98e167dca50","to":"middleware-test-cffaf4LGB87_S_SYDlO9c@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088230505,"env":"test","module":"audit-log-service","userId":"d76d8cc3-495f-4718-af9c-48baf9146264","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088230518,"env":"test","module":"auth-routes","userId":"79351e26-992a-4bb5-a0e4-b196762d8c76","email":"middleware-test-cffaf4LGB87_S_SYDlO9c@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mgetPrimaryTemplate[2m > [22mshould get primary template for workflow version[33m 1101[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mLegacy Template ID Path (Backward Compatibility)[2m > [22mshould resolve template by templateId directly[33m 575[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindPrimaryByWorkflowVersionId[2m > [22mshould find primary template for workflow version[33m 758[2mms[22m[39m
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1768088230987,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088231009,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/js_helpers.test.ts[2m > [22m[2mDetailed Verification: JS Helper Availability
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088230994,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088230995,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088231000,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088231008,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088231009,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088231009,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088231009,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768088231031,"env":"test","module":"auth-routes","userId":"b6bca0a1-2e6f-4096-b68d-31a22175f714","msg":"User logged in successfully"}
{"level":30,"time":1768088231055,"env":"test","module":"auth-routes","userId":"d76d8cc3-495f-4718-af9c-48baf9146264","msg":"User logged in successfully"}
{"level":30,"time":1768088231087,"env":"test","module":"audit-log-service","userId":"b6bca0a1-2e6f-4096-b68d-31a22175f714","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088231104,"env":"test","module":"audit-log-service","userId":"d76d8cc3-495f-4718-af9c-48baf9146264","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088231106,"env":"test","module":"auth-routes","userId":"79351e26-992a-4bb5-a0e4-b196762d8c76","msg":"User logged in successfully"}
{"level":30,"time":1768088231158,"env":"test","module":"audit-log-service","userId":"79351e26-992a-4bb5-a0e4-b196762d8c76","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088231178,"env":"test","module":"auth-routes","userId":"ffe87dc6-2684-4090-a2bf-20353e90be49","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088231197,"env":"test","module":"auth-routes","userId":"b6bca0a1-2e6f-4096-b68d-31a22175f714","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768088231231,"env":"test","module":"audit-log-service","userId":"ffe87dc6-2684-4090-a2bf-20353e90be49","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088231238,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindPrimaryByWorkflowVersionId[2m > [22mshould return undefined when no primary template exists[33m 702[2mms[22m[39m
{"level":50,"time":1768088231338,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mPATCH Protected Routes[2m > [22mshould reject PATCH without Bearer token[33m 1585[2mms[22m[39m
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mâ”œÃ¹[39m tests/integration/js_helpers.test.ts[2m > [22mDetailed Verification: JS Helper Availability[2m > [22mshould execute a JS block that uses helper functions[32m 128[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 401 to be 201 // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mLegacy Template ID Path (Backward Compatibility)[2m > [22mshould throw error if templateId not found[33m 604[2mms[22m[39m
{"level":40,"time":1768088231391,"env":"test","module":"auth-service","userId":"d76d8cc3-495f-4718-af9c-48baf9146264","tokenHash":"604f023a16429a33b0fea1485d4d9e360e32f2fb6cb5def2c06e7c57cf896528","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mgetPrimaryTemplate[2m > [22mshould return null when no primary template exists[33m 668[2mms[22m[39m
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":40,"time":1768088231502,"env":"test","module":"auth-service","userId":"d76d8cc3-495f-4718-af9c-48baf9146264","tokenHash":"56b3df32627f3de7decc89d21590875718c8048fbaa15c18321907fa717060df","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768088231652,"env":"test","module":"user-credentials-repository","userId":"cd7edfc5-e306-4940-ade1-6bed65366e3d","msg":"User credentials created"}
{"level":30,"time":1768088231737,"env":"test","module":"auth-routes","userId":"e69b2162-5a21-4d0d-9bc8-5da3804d1b07","msg":"User logged in successfully"}
{"level":30,"time":1768088231754,"env":"test","module":"email-queue","jobId":"135db5e7-715c-41c1-bc34-786469e735c3","to":"protected-test-gbGkPjV36AF2XyhRv9BQC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088231761,"env":"test","module":"intake-service","runId":"9899c263-2312-4487-acac-2ac82360f43a","slug":"hybrid-jwt-LzxMQ5NyIYcD9DRSg7e6D","userId":"79351e26-992a-4bb5-a0e4-b196762d8c76","msg":"Created intake run"}
{"level":30,"time":1768088231801,"env":"test","module":"audit-log-service","userId":"e69b2162-5a21-4d0d-9bc8-5da3804d1b07","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088231809,"env":"test","module":"auth-routes","userId":"cd7edfc5-e306-4940-ade1-6bed65366e3d","email":"protected-test-gbGkPjV36AF2XyhRv9BQC@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalHybridAuth Middleware[2m > [22mshould authenticate with JWT if provided[33m 1860[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould not allow revoking other users sessions[33m 2935[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mRendering Engine Selection[2m > [22mshould use docxRenderer2 by default (v2 engine)[33m 646[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mupdateTemplateMapping[2m > [22mshould update mapping key[33m 792[2mms[22m[39m
{"level":30,"time":1768088232230,"env":"test","module":"user-credentials-repository","userId":"7ce97d96-2d38-4968-86b9-0dc5ae55427e","msg":"User credentials created"}
{"level":30,"time":1768088232337,"env":"test","module":"email-queue","jobId":"d3a1006d-04a0-4d60-abef-995128fecd30","to":"jwt-test-rScCqDdI_QKxLJod1mLH_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088232385,"env":"test","module":"user-credentials-repository","userId":"e430438f-84de-4239-a1f3-4c1c69fd91f7","msg":"User credentials created"}
{"level":30,"time":1768088232389,"env":"test","module":"auth-routes","userId":"7ce97d96-2d38-4968-86b9-0dc5ae55427e","email":"jwt-test-rScCqDdI_QKxLJod1mLH_@example.com","msg":"User registered"}
{"level":30,"time":1768088232416,"env":"test","module":"user-credentials-repository","userId":"8959c75e-d79f-4405-a55a-f2e4f602fede","msg":"User credentials created"}
{"level":50,"time":1768088232425,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"Failed to render template"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22msetPrimary[2m > [22mshould set a template as primary and unset others[33m 928[2mms[22m[39m
{"level":30,"time":1768088232498,"env":"test","module":"email-queue","jobId":"cade1ce7-b1fe-4b5a-8758-d8571a472edf","to":"middleware-test-iT0Fr9kuY9fr9gwncBUm4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088232521,"env":"test","module":"auth-routes","userId":"cd7edfc5-e306-4940-ade1-6bed65366e3d","msg":"User logged in successfully"}
{"level":30,"time":1768088232519,"env":"test","module":"email-queue","jobId":"fdc5fe56-09b2-4dac-a5a3-e67023e676b2","to":"session-test-o2saIndWKaLffrzDFJ4bP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mCollection Lifecycle[2m > [22mshould create a collection[32m 110[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mCollection Lifecycle[2m > [22mshould list collections[32m 53[2mms[22m[39m
{"level":30,"time":1768088232553,"env":"test","module":"auth-routes","userId":"e430438f-84de-4239-a1f3-4c1c69fd91f7","email":"middleware-test-iT0Fr9kuY9fr9gwncBUm4@example.com","msg":"User registered"}
{"level":30,"time":1768088232571,"env":"test","module":"auth-routes","userId":"8959c75e-d79f-4405-a55a-f2e4f602fede","email":"session-test-o2saIndWKaLffrzDFJ4bP@example.com","msg":"User registered"}
{"level":30,"time":1768088232573,"env":"test","module":"audit-log-service","userId":"cd7edfc5-e306-4940-ade1-6bed65366e3d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768088232580,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088232581,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mCollection Lifecycle[2m > [22mshould get a collection by ID[32m 63[2mms[22m[39m
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle Bearer token with extra spaces[33m 1342[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle token with newlines
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mRendering Engine Selection[2m > [22mshould use legacy engine when engine="legacy"[33m 664[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mCollection Lifecycle[2m > [22mshould update a collection[32m 108[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mField Management[2m > [22mshould create text field[32m 159[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mupdateTemplateMapping[2m > [22mshould update isPrimary flag[33m 828[2mms[22m[39m
{"level":30,"time":1768088233037,"env":"test","module":"auth-routes","userId":"7ce97d96-2d38-4968-86b9-0dc5ae55427e","msg":"User logged in successfully"}
{"level":30,"time":1768088233046,"env":"test","module":"user-credentials-repository","userId":"21c81ecb-ea94-42fe-85fb-51aae6c9febc","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mField Management[2m > [22mshould create email field[32m 165[2mms[22m[39m
{"level":30,"time":1768088233087,"env":"test","module":"audit-log-service","userId":"7ce97d96-2d38-4968-86b9-0dc5ae55427e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088233156,"env":"test","module":"email-queue","jobId":"564631b2-fd5b-4508-89b0-6d597d0a5787","to":"protected-test-5Hkbw555HjWyss0PJ8xKW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088233178,"env":"test","module":"auth-routes","userId":"e430438f-84de-4239-a1f3-4c1c69fd91f7","msg":"User logged in successfully"}
{"level":40,"time":1768088233206,"env":"test","module":"auth-service","userId":"7ce97d96-2d38-4968-86b9-0dc5ae55427e","tokenHash":"1e3a3c2394e16c8773b6e144ba90740eae78dfe352edcdc2e342724ea86bbe46","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768088233208,"env":"test","module":"auth-routes","userId":"21c81ecb-ea94-42fe-85fb-51aae6c9febc","email":"protected-test-5Hkbw555HjWyss0PJ8xKW@example.com","msg":"User registered"}
{"level":30,"time":1768088233233,"env":"test","module":"audit-log-service","userId":"e430438f-84de-4239-a1f3-4c1c69fd91f7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mField Management[2m > [22mshould create number field[32m 174[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mToken Refresh Flow[2m > [22mshould detect token reuse and revoke all user tokens[33m 2426[2mms[22m[39m
{"level":30,"time":1768088233290,"env":"test","module":"auth-routes","userId":"8959c75e-d79f-4405-a55a-f2e4f602fede","msg":"User logged in successfully"}
{"level":30,"time":1768088233345,"env":"test","module":"audit-log-service","userId":"8959c75e-d79f-4405-a55a-f2e4f602fede","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22msetPrimary[2m > [22mshould handle setting primary when none existed before[33m 915[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mLogout Flow[2m > [22mshould revoke refresh token on logout[33m 1702[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mcreateOrganization[2m > [22mshould create organization and auto-create admin membership[33m 1027[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mField Management[2m > [22mshould create select field with options[32m 159[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mPDF Generation[2m > [22mshould generate PDF when toPdf=true[33m 763[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:sessionId[2m > [22mshould return 404 for non-existent session ID[33m 1494[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mField Management[2m > [22mshould create boolean field[32m 158[2mms[22m[39m
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mField Management[2m > [22mshould list all fields[32m 55[2mms[22m[39m
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1768088233715,"env":"test","module":"user-credentials-repository","userId":"6a8636dc-1739-43d7-b51e-20a7afa94fd2","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mField Management[2m > [22mshould update field[32m 113[2mms[22m[39m
{"level":30,"time":1768088233772,"env":"test","module":"intake-service","runId":"dde9ec8b-00e7-49b6-a482-39277e00328c","slug":"hybrid-cookie-GSeZ6am3YR9QpbWOHW5q4","msg":"Created intake run"}
{"level":30,"time":1768088233810,"env":"test","module":"email-queue","jobId":"e0b1de4d-dc69-4a2f-b5ce-83ff4f0c2a49","to":"jwt-test-OAMX5SR2i0owcsqiqaQ1z@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088233845,"env":"test","module":"user-credentials-repository","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mupdateTemplateMapping[2m > [22mshould throw error if new key already exists[33m 824[2mms[22m[39m
{"level":30,"time":1768088233865,"env":"test","module":"auth-routes","userId":"6a8636dc-1739-43d7-b51e-20a7afa94fd2","email":"jwt-test-OAMX5SR2i0owcsqiqaQ1z@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalHybridAuth Middleware[2m > [22mshould authenticate with cookie if JWT not provided[33m 2010[2mms[22m[39m
{"level":30,"time":1768088233945,"env":"test","module":"email-queue","jobId":"b538d3ae-e55f-4034-aabe-31e7ea72d9b1","to":"session-test-vKXBgHco25S688izhJUx3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mRecord CRUD Operations[2m > [22mshould create a record[32m 222[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22msetPrimary[2m > [22mshould not delete mapping if workflow version does not match[33m 857[2mms[22m[39m
{"level":30,"time":1768088233995,"env":"test","module":"auth-routes","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","email":"session-test-vKXBgHco25S688izhJUx3@example.com","msg":"User registered"}
{"level":30,"time":1768088234037,"env":"test","module":"auth-routes","userId":"21c81ecb-ea94-42fe-85fb-51aae6c9febc","msg":"User logged in successfully"}
{"level":30,"time":1768088234097,"env":"test","module":"audit-log-service","userId":"21c81ecb-ea94-42fe-85fb-51aae6c9febc","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088234104,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mgetUserOrganizations[2m > [22mshould return all organizations for user[33m 739[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mPDF Generation[2m > [22mshould default to DOCX when toPdf=false[33m 746[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle very long invalid token[33m 1523[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mRecord CRUD Operations[2m > [22mshould create multiple records[33m 412[2mms[22m[39m
{"level":30,"time":1768088234407,"env":"test","module":"user-credentials-repository","userId":"846d9bf3-5e01-40df-a1ea-121546de9d5b","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mupdateTemplateMapping[2m > [22mshould throw error if mapping not found[33m 559[2mms[22m[39m
{"level":30,"time":1768088234466,"env":"test","module":"auth-routes","userId":"6a8636dc-1739-43d7-b51e-20a7afa94fd2","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mRecord CRUD Operations[2m > [22mshould list records with pagination[32m 113[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mRecord CRUD Operations[2m > [22mshould get a single record[32m 51[2mms[22m[39m
{"level":30,"time":1768088234517,"env":"test","module":"audit-log-service","userId":"6a8636dc-1739-43d7-b51e-20a7afa94fd2","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088234519,"env":"test","module":"email-queue","jobId":"7ab0dfb7-4fbf-481f-9a47-3697935e636d","to":"middleware-test-Psldse3_b88iW2S4H_W8z@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mgetUserOrganizations[2m > [22mshould return empty array for user with no memberships[33m 388[2mms[22m[39m
{"level":30,"time":1768088234550,"env":"test","module":"user-credentials-repository","userId":"04e09479-e97b-4051-968e-ea1a213429b5","msg":"User credentials created"}
{"level":30,"time":1768088234571,"env":"test","module":"auth-routes","userId":"846d9bf3-5e01-40df-a1ea-121546de9d5b","email":"middleware-test-Psldse3_b88iW2S4H_W8z@example.com","msg":"User registered"}
{"level":30,"time":1768088234665,"env":"test","module":"email-queue","jobId":"cef83a43-eec8-4a76-acf0-cedf253bad83","to":"protected-test-Q2Xt-HUG9H2xUkE8VpQes@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/jwt.authentication.test.ts[2m > [22mJWT Authentication Integration Tests[2m > [22mLogout Flow[2m > [22mshould clear refresh token cookie on logout[33m 1320[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mexistsByKey[2m > [22mshould return true if key exists in workflow version[33m 705[2mms[22m[39m
{"level":30,"time":1768088234700,"env":"test","module":"auth-routes","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mRecord CRUD Operations[2m > [22mshould update a record[32m 173[2mms[22m[39m
{"level":30,"time":1768088234717,"env":"test","module":"auth-routes","userId":"04e09479-e97b-4051-968e-ea1a213429b5","email":"protected-test-Q2Xt-HUG9H2xUkE8VpQes@example.com","msg":"User registered"}
{"level":30,"time":1768088234751,"env":"test","module":"audit-log-service","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mConditional Execution[2m > [22mshould skip execution when condition evaluates to false[33m 550[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mRecord CRUD Operations[2m > [22mshould find records by filters[32m 104[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mRecord CRUD Operations[2m > [22mshould delete a record[32m 216[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mCollection Stats[2m > [22mshould list collections with stats[32m 156[2mms[22m[39m
{"level":30,"time":1768088235218,"env":"test","module":"auth-routes","userId":"846d9bf3-5e01-40df-a1ea-121546de9d5b","msg":"User logged in successfully"}
{"level":30,"time":1768088235274,"env":"test","module":"audit-log-service","userId":"846d9bf3-5e01-40df-a1ea-121546de9d5b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mupdateOrganization[2m > [22mshould allow admin to update organization[33m 764[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mConditional Execution[2m > [22mshould execute when condition evaluates to true[33m 597[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mData Validation[2m > [22mshould enforce required fields[32m 166[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mexistsByKey[2m > [22mshould return false if key does not exist[33m 638[2mms[22m[39m
{"level":30,"time":1768088235471,"env":"test","module":"auth-routes","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mupdateTemplateMapping[2m > [22mshould unset other primaries when setting isPrimary to true[33m 1082[2mms[22m[39m
{"level":30,"time":1768088235520,"env":"test","module":"audit-log-service","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mData Validation[2m > [22mshould validate field types[32m 228[2mms[22m[39m
{"level":30,"time":1768088235593,"env":"test","module":"auth-routes","userId":"04e09479-e97b-4051-968e-ea1a213429b5","msg":"User logged in successfully"}
{"level":30,"time":1768088235655,"env":"test","module":"audit-log-service","userId":"04e09479-e97b-4051-968e-ea1a213429b5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088235666,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle empty Authorization header[33m 1562[2mms[22m[39m
{"level":30,"time":1768088235827,"env":"test","module":"intake-service","runId":"3554d028-2917-4f84-acdc-4f26c73acd7b","slug":"hybrid-anon-M-siZrBsZOmDBX3rrbvB1","msg":"Created intake run"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts[2m > [22mCollections System E2E Tests[2m > [22mCleanup[2m > [22mshould delete collection (cascade fields and records)[32m 277[2mms[22m[39m
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalHybridAuth Middleware[2m > [22mshould proceed anonymously if no auth provided[33m 2056[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mBinding Resolution[2m > [22mshould resolve simple bindings[33m 608[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mupdateOrganization[2m > [22mshould deny non-admin from updating organization[33m 790[2mms[22m[39m
{"level":30,"time":1768088236109,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mexistsByKey[2m > [22mshould exclude specified id when checking existence[33m 811[2mms[22m[39m
{"level":30,"time":1768088236222,"env":"test","module":"auth-routes","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","msg":"User logged in successfully"}
{"level":30,"time":1768088236254,"env":"test","module":"user-credentials-repository","userId":"1930e966-3bfa-4120-8b21-1bee3e387160","msg":"User credentials created"}
{"level":30,"time":1768088236272,"env":"test","module":"audit-log-service","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768088236353,"env":"test","module":"email-queue","jobId":"aa64d0ca-fbeb-4c24-a108-9243f0e178ca","to":"protected-test-JrJ8hY4qattfcwe59hCfg@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088236354,"env":"test","module":"user-credentials-repository","userId":"453cc444-fae1-4417-9e03-cbcd0e2dd518","msg":"User credentials created"}
{"level":30,"time":1768088236408,"env":"test","module":"auth-routes","userId":"1930e966-3bfa-4120-8b21-1bee3e387160","email":"protected-test-JrJ8hY4qattfcwe59hCfg@example.com","msg":"User registered"}
{"level":30,"time":1768088236431,"env":"test","module":"auth-routes","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","msg":"All other sessions revoked"}
{"level":30,"time":1768088236459,"env":"test","module":"email-queue","jobId":"436ea378-3a29-4ef7-a2f1-1893957f613d","to":"middleware-test-mWEo-2t8QJG5C4j5ciAO0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088236481,"env":"test","module":"audit-log-service","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","eventType":"all_sessions_revoked","ipAddress":"::1","hasMetadata":false,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mBinding Resolution[2m > [22mshould handle binding resolution errors gracefully[33m 530[2mms[22m[39m
{"level":30,"time":1768088236517,"env":"test","module":"auth-routes","userId":"453cc444-fae1-4417-9e03-cbcd0e2dd518","email":"middleware-test-mWEo-2t8QJG5C4j5ciAO0@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mdetachTemplate[2m > [22mshould detach template from workflow version[33m 778[2mms[22m[39m
{"level":30,"time":1768088236559,"env":"test","msg":"Simulating External Send","destination":"Test Webhook","payload":{"message":"Hello Preview"}}
 [32mÎ“Â£Ã´[39m tests/integration/externalSends.test.ts[2m > [22mExternal Send Block Integration[2m > [22mPREVIEW MODE: Should simulate send and NOT call fetch[33m 1499[2mms[22m[39m
{"level":30,"time":1768088236734,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1768088236754,"env":"test","module":"auth-service","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","tokenHash":"7cea2f3b294ddd4897e5336b947a9fd64bd573b33c7411d137ddc9ecce6680d0","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088236755,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768088236741,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088236742,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088236749,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088236754,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088236754,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088236755,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088236755,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests[2m > [22m[2mPOST /api/ai/doc/analyze[2m > [22m[2mshould analyze a DOCX file and return variables
[22m[39mFAIL_STATUS: 500
FAIL_BODY: {}

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mdetachTemplate[2m > [22mshould throw error if mapping not found[33m 538[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/api.ai.doc.test.ts[2m > [22mAI Document Assistant API Integration Tests[2m > [22mPOST /api/ai/doc/analyze[2m > [22mshould analyze a DOCX file and return variables[32m 53[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 500 to be 200 // Object.is equality[39m
{"level":40,"time":1768088236862,"env":"test","module":"auth-service","userId":"efb3ebee-1e86-4cc6-8753-bfbd775a8334","tokenHash":"7535d5a60c255e4e629f0e87c64f6dfec3f9371292dd1e0ba77fd156133906c3","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mexistsByKey[2m > [22mshould return true if key exists on different mapping[33m 754[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all sessions except current[33m 3512[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mgetOrganizationMembers[2m > [22mshould return all members of organization[33m 915[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/api.ai.doc.test.ts[2m > [22mAI Document Assistant API Integration Tests[2m > [22mPOST /api/ai/doc/analyze[2m > [22mshould fail if no file is provided[32m 59[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 400 "Bad Request", got 500 "Internal Server Error"[39m
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088237187,"env":"test","module":"auth-routes","userId":"1930e966-3bfa-4120-8b21-1bee3e387160","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.doc.test.ts[2m > [22mAI Document Assistant API Integration Tests[2m > [22mPOST /api/ai/doc/suggest-mappings[2m > [22mshould suggest mappings between template and workflow variables[32m 283[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.doc.test.ts[2m > [22mAI Document Assistant API Integration Tests[2m > [22mPOST /api/ai/doc/suggest-improvements[2m > [22mshould return improvement suggestions[32m 27[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mError Handling[2m > [22mshould record failed output in runOutputs table[33m 710[2mms[22m[39m
{"level":30,"time":1768088237229,"env":"test","module":"auth-routes","userId":"453cc444-fae1-4417-9e03-cbcd0e2dd518","msg":"User logged in successfully"}
{"level":30,"time":1768088237246,"env":"test","module":"audit-log-service","userId":"1930e966-3bfa-4120-8b21-1bee3e387160","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088237252,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088237283,"env":"test","module":"audit-log-service","userId":"453cc444-fae1-4417-9e03-cbcd0e2dd518","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle Authorization header with only Bearer[33m 1586[2mms[22m[39m
{"level":30,"time":1768088237363,"env":"test","module":"user-credentials-repository","userId":"7bcf381c-8c85-4e86-a024-f13bde1fb665","msg":"User credentials created"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1768088237467,"env":"test","module":"email-queue","jobId":"cbb378c6-06cd-4306-b264-b00bfa708768","to":"session-test-kjSCf1EVfeI3-Lbr8Nn6W@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088237518,"env":"test","module":"auth-routes","userId":"7bcf381c-8c85-4e86-a024-f13bde1fb665","email":"session-test-kjSCf1EVfeI3-Lbr8Nn6W@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mupdate[2m > [22mshould update mapping fields[33m 696[2mms[22m[39m
{"level":30,"time":1768088237751,"env":"test","module":"user-credentials-repository","userId":"e123cecc-c12a-4aff-887a-3e1a65c32d47","msg":"User credentials created"}
{"level":30,"time":1768088237726,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mError Handling[2m > [22mshould not throw errors (should return error in result)[33m 620[2mms[22m[39m
{"level":30,"time":1768088237836,"env":"test","module":"intake-service","runId":"6b586e92-8a60-4148-87b2-f91f01cd850e","slug":"hybrid-invalid-hoNfYGudP_77WtmCwfnfG","msg":"Created intake run"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22msetPrimaryTemplate[2m > [22mshould set template as primary[33m 1041[2mms[22m[39m
{"level":30,"time":1768088237862,"env":"test","module":"email-queue","jobId":"eb19d87c-0817-4860-b1f1-3949457c250e","to":"protected-test-pq3Osj1UGqp8G5q8lKYOr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088237858,"env":"test","msg":"External Send Completed","destination":"Test Webhook","success":true,"status":200}
{"level":30,"time":1768088237916,"env":"test","module":"auth-routes","userId":"e123cecc-c12a-4aff-887a-3e1a65c32d47","email":"protected-test-pq3Osj1UGqp8G5q8lKYOr@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22moptionalHybridAuth Middleware[2m > [22mshould proceed anonymously if both JWT and cookie are invalid[33m 2008[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/externalSends.test.ts[2m > [22mExternal Send Block Integration[2m > [22mLIVE MODE: Should call fetch with mapped payload[33m 1297[2mms[22m[39m
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mpromoteMember[2m > [22mshould allow admin to promote member[33m 1189[2mms[22m[39m
{"level":30,"time":1768088238197,"env":"test","module":"auth-routes","userId":"7bcf381c-8c85-4e86-a024-f13bde1fb665","msg":"User logged in successfully"}
{"level":30,"time":1768088238256,"env":"test","module":"audit-log-service","userId":"7bcf381c-8c85-4e86-a024-f13bde1fb665","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindById[2m > [22mshould find mapping by id[33m 701[2mms[22m[39m
{"level":30,"time":1768088238377,"env":"test","module":"user-credentials-repository","userId":"7d74876d-1242-4e66-8751-e8456b804a6f","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22msetPrimaryTemplate[2m > [22mshould throw error if mapping not found[33m 548[2mms[22m[39m
{"level":30,"time":1768088238418,"env":"test","module":"auth-routes","userId":"7bcf381c-8c85-4e86-a024-f13bde1fb665","deviceFingerprint":"377ad01217b8c93ca52518d515505c47ab7553fab66d6fddaa60af67802c5a4c","msg":"Device marked as trusted"}
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mTenant Access Control[2m > [22mshould deny access to templates from different tenant[33m 602[2mms[22m[39m
{"level":30,"time":1768088238483,"env":"test","module":"email-queue","jobId":"0bd1bcfe-3d65-413a-8464-2e8fbf621c9a","to":"middleware-test-r-OmG8yfVe_dLpjGa5A09@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088238534,"env":"test","module":"auth-routes","userId":"7d74876d-1242-4e66-8751-e8456b804a6f","email":"middleware-test-r-OmG8yfVe_dLpjGa5A09@example.com","msg":"User registered"}
{"level":30,"time":1768088238572,"env":"test","module":"auth-routes","userId":"7bcf381c-8c85-4e86-a024-f13bde1fb665","msg":"All other sessions revoked"}
{"level":30,"time":1768088238623,"env":"test","module":"audit-log-service","userId":"7bcf381c-8c85-4e86-a024-f13bde1fb665","eventType":"all_sessions_revoked","ipAddress":"::1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768088238655,"env":"test","module":"auth-routes","userId":"e123cecc-c12a-4aff-887a-3e1a65c32d47","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests[2m > [22m[2mshould generate basic autonumber without prefix
[22m[39mRow 1 Basic Autonumber: 0001
Row 2 Basic Autonumber: 0002

{"level":30,"time":1768088238707,"env":"test","module":"audit-log-service","userId":"e123cecc-c12a-4aff-887a-3e1a65c32d47","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088238715,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088238730,"env":"test","module":"auth-routes","userId":"7bcf381c-8c85-4e86-a024-f13bde1fb665","deviceCount":0,"msg":"Listed trusted devices"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould handle multiple Authorization headers[33m 1465[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all trusted devices[33m 1812[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts[2m > [22mWorkflowTemplateRepository[2m > [22mfindById[2m > [22mshould return undefined for non-existent id[33m 654[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts[2m > [22mTemplate Node - Multi-Template Support[2m > [22mValidation[2m > [22mshould require either templateKey or templateId[33m 521[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.autonumber.test.ts[2m > [22mDataVault Autonumber Integration Tests[2m > [22mshould generate basic autonumber without prefix[33m 1227[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/datavault.autonumber.test.ts[2m > [22mDataVault Autonumber Integration Tests[2m > [22mshould generate autonumber with prefix[33m 323[2mms[22m[39m
[31m   Î“Ã¥Ã† function public.datavault_get_next_auto_number(uuid, uuid, integer) does not exist[39m
{"level":30,"time":1768088239120,"env":"test","module":"auth-routes","userId":"7d74876d-1242-4e66-8751-e8456b804a6f","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1768088239171,"env":"test","module":"audit-log-service","userId":"7d74876d-1242-4e66-8751-e8456b804a6f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088239264,"env":"test","module":"user-credentials-repository","userId":"323bbf79-0995-4926-8934-2b652347ad01","msg":"User credentials created"}
{"level":30,"time":1768088239272,"env":"test","module":"user-credentials-repository","userId":"74052900-71a2-40c0-b7eb-9791a5b788b1","msg":"User credentials created"}
{"level":50,"time":1768088239338,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mdemoteMember[2m > [22mshould allow admin to demote other admin[33m 1192[2mms[22m[39m
{"level":30,"time":1768088239378,"env":"test","module":"email-queue","jobId":"569d3ffa-a445-44d6-bb69-943938e577d7","to":"session-test-T_BGfDzoyEvswxMYFRWnp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088239387,"env":"test","module":"email-queue","jobId":"83ae2161-7d1c-4189-976d-926bea7874dc","to":"protected-test-IhAnFbRQmQMRG1gOW1LU2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088239431,"env":"test","module":"auth-routes","userId":"74052900-71a2-40c0-b7eb-9791a5b788b1","email":"session-test-T_BGfDzoyEvswxMYFRWnp@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mCookie Strategy Security[2m > [22mshould only allow safe methods for cookie auth[33m 1502[2mms[22m[39m
{"level":30,"time":1768088239449,"env":"test","module":"auth-routes","userId":"323bbf79-0995-4926-8934-2b652347ad01","email":"protected-test-IhAnFbRQmQMRG1gOW1LU2@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mtransaction support[2m > [22mshould support operations within a transaction[33m 816[2mms[22m[39m
{"level":50,"time":1768088239543,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould require active session[33m 812[2mms[22m[39m
{"level":30,"time":1768088239788,"env":"test","module":"user-credentials-repository","userId":"c58c3607-a4f2-4a3f-8371-ac4b175804fa","msg":"User credentials created"}
{"level":30,"time":1768088239893,"env":"test","module":"email-queue","jobId":"72bc5ef9-f1ea-4e30-967a-6db27497ed38","to":"middleware-test-bnPNR_GmMAk7o7bnB2JBK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts[2m > [22mWorkflowTemplateService[2m > [22mattachTemplate[2m > [22mtransaction support[2m > [22mshould rollback on transaction error[33m 815[2mms[22m[39m
{"level":30,"time":1768088239945,"env":"test","module":"auth-routes","userId":"c58c3607-a4f2-4a3f-8371-ac4b175804fa","email":"middleware-test-bnPNR_GmMAk7o7bnB2JBK@example.com","msg":"User registered"}
{"level":30,"time":1768088240105,"env":"test","module":"user-credentials-repository","userId":"b338d32d-5296-4910-a6ee-fcbc54885271","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mdemoteMember[2m > [22mshould prevent self-demotion[33m 767[2mms[22m[39m
{"level":30,"time":1768088240314,"env":"test","module":"auth-routes","userId":"323bbf79-0995-4926-8934-2b652347ad01","msg":"User logged in successfully"}
{"level":30,"time":1768088240315,"env":"test","module":"email-queue","jobId":"567c4570-9ff1-4670-8658-68d7d49f6dda","to":"session-test-8r8261bGkJ-2R5brQ-EA1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088240367,"env":"test","module":"auth-routes","userId":"b338d32d-5296-4910-a6ee-fcbc54885271","email":"session-test-8r8261bGkJ-2R5brQ-EA1@example.com","msg":"User registered"}
{"level":30,"time":1768088240370,"env":"test","module":"audit-log-service","userId":"323bbf79-0995-4926-8934-2b652347ad01","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088240375,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould reject token with SQL injection attempt[33m 1659[2mms[22m[39m
{"level":30,"time":1768088240576,"env":"test","module":"auth-routes","userId":"c58c3607-a4f2-4a3f-8371-ac4b175804fa","msg":"User logged in successfully"}
{"level":30,"time":1768088240630,"env":"test","module":"audit-log-service","userId":"c58c3607-a4f2-4a3f-8371-ac4b175804fa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [31mâ”œÃ¹[39m tests/integration/datavault.autonumber.test.ts[2m > [22mDataVault Autonumber Integration Tests[2m > [22mshould generate autonumber with yearly reset format[33m 624[2mms[22m[39m
[31m   Î“Ã¥Ã† expected 'INV-2026-003' to be 'INV-2026-005' // Object.is equality[39m
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.autonumber.test.ts[2m > [22mDataVault Autonumber Integration Tests[2m > [22mshould be atomic and prevent race conditions[33m 1022[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768088240785,"env":"test","module":"user-credentials-repository","userId":"8f53baf9-6003-4f24-b21e-2b36edb9f4b7","msg":"User credentials created"}
{"level":30,"time":1768088240888,"env":"test","module":"email-queue","jobId":"409140c6-3ff8-4710-a9ed-69c4729b4dd8","to":"protected-test-VA1LhWOFsDTozwAuo4dCM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088240942,"env":"test","module":"auth-routes","userId":"8f53baf9-6003-4f24-b21e-2b36edb9f4b7","email":"protected-test-VA1LhWOFsDTozwAuo4dCM@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1768088241026,"env":"test","module":"auth-routes","userId":"b338d32d-5296-4910-a6ee-fcbc54885271","msg":"User logged in successfully"}
{"level":30,"time":1768088241077,"env":"test","module":"user-credentials-repository","userId":"5f9675c8-efc5-4537-9cb6-b7e07bdd111e","msg":"User credentials created"}
{"level":30,"time":1768088241082,"env":"test","module":"audit-log-service","userId":"b338d32d-5296-4910-a6ee-fcbc54885271","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088241189,"env":"test","module":"email-queue","jobId":"55f20a0f-ae9c-4f92-b503-1dd2c9adc22b","to":"cookie-test-NzJ3uRz-GKRrjStr_zeer@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768088241242,"env":"test","module":"auth-service","userId":"b338d32d-5296-4910-a6ee-fcbc54885271","msg":"Security: Expired refresh token used"}
{"level":30,"time":1768088241243,"env":"test","module":"auth-routes","userId":"5f9675c8-efc5-4537-9cb6-b7e07bdd111e","email":"cookie-test-NzJ3uRz-GKRrjStr_zeer@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mSession Expiration[2m > [22mshould reject refresh token after 30 days[33m 1699[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mremoveMember[2m > [22mshould allow admin to remove member[33m 1325[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088241671,"env":"test","module":"auth-routes","userId":"8f53baf9-6003-4f24-b21e-2b36edb9f4b7","msg":"User logged in successfully"}
{"level":30,"time":1768088241689,"env":"test","module":"user-credentials-repository","userId":"07be0f30-8d94-4aaa-9bd5-e9ff2b838799","msg":"User credentials created"}
{"level":30,"time":1768088241724,"env":"test","module":"audit-log-service","userId":"8f53baf9-6003-4f24-b21e-2b36edb9f4b7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768088241729,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088241798,"env":"test","module":"email-queue","jobId":"0cadc77f-1d39-40ea-9dbc-05bb5214f06b","to":"session-test-qDkgoZV2aMLdNMF3CVMH6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Edge Cases[2m > [22mshould reject token with XSS attempt[33m 1354[2mms[22m[39m
{"level":30,"time":1768088241850,"env":"test","module":"auth-routes","userId":"07be0f30-8d94-4aaa-9bd5-e9ff2b838799","email":"session-test-qDkgoZV2aMLdNMF3CVMH6@example.com","msg":"User registered"}
{"level":30,"time":1768088241865,"env":"test","module":"auth-routes","userId":"5f9675c8-efc5-4537-9cb6-b7e07bdd111e","msg":"User logged in successfully"}
{"level":30,"time":1768088241916,"env":"test","module":"audit-log-service","userId":"5f9675c8-efc5-4537-9cb6-b7e07bdd111e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mCookie Strategy Security[2m > [22mshould ignore cookies when Bearer token present[33m 2685[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests
[22m[39mError cleaning up table: Error: Table not found
    at DatavaultTablesService.verifyTenantOwnership (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:150:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablesService.deleteTable (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:290:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/datavault.autonumber.test.ts:90:9

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.autonumber.test.ts[2m > [22mDataVault Autonumber Integration Tests[2m > [22mshould prevent manual updates to autonumber values[33m 1575[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mremoveMember[2m > [22mshould prevent self-removal[33m 804[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mdateHelpers[2m > [22mshould return current date[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mdateHelpers[2m > [22mshould add days to date[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mdateHelpers[2m > [22mshould subtract months from date[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mdateHelpers[2m > [22mshould format dates[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mdateHelpers[2m > [22mshould parse date strings[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mdateHelpers[2m > [22mshould calculate date difference[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mdateHelpers[2m > [22mshould handle invalid dates gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould convert to uppercase[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould convert to lowercase[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould trim whitespace[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould replace text[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould replace all occurrences[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould split strings[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould join arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould create slugs[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mstringHelpers[2m > [22mshould handle empty strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mnumberHelpers[2m > [22mshould round numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mnumberHelpers[2m > [22mshould ceil numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mnumberHelpers[2m > [22mshould floor numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mnumberHelpers[2m > [22mshould get absolute value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mnumberHelpers[2m > [22mshould clamp numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mnumberHelpers[2m > [22mshould format currency[32m 25[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mnumberHelpers[2m > [22mshould format percentages[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22marrayHelpers[2m > [22mshould get unique values[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22marrayHelpers[2m > [22mshould flatten arrays[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22marrayHelpers[2m > [22mshould chunk arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22marrayHelpers[2m > [22mshould sort by property[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22marrayHelpers[2m > [22mshould filter arrays[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22marrayHelpers[2m > [22mshould map arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22marrayHelpers[2m > [22mshould handle empty arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mobjectHelpers[2m > [22mshould get object keys[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mobjectHelpers[2m > [22mshould get object values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mobjectHelpers[2m > [22mshould pick properties[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mobjectHelpers[2m > [22mshould omit properties[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mobjectHelpers[2m > [22mshould merge objects[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mobjectHelpers[2m > [22mshould deep merge objects[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mobjectHelpers[2m > [22mshould handle empty objects[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mmathHelpers[2m > [22mshould generate random numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mmathHelpers[2m > [22mshould generate random integers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mmathHelpers[2m > [22mshould sum arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mmathHelpers[2m > [22mshould calculate average[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mmathHelpers[2m > [22mshould find min[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mmathHelpers[2m > [22mshould find max[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mconsoleHelpers[2m > [22mshould capture console.log calls[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mconsoleHelpers[2m > [22mshould capture console.warn calls[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mconsoleHelpers[2m > [22mshould capture console.error calls[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mconsoleHelpers[2m > [22mshould capture mixed console calls in order[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mconsoleHelpers[2m > [22mshould handle objects and arrays[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mconsoleHelpers[2m > [22mshould create independent console instances[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mhelperLibrary integration[2m > [22mshould export all helper categories[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mhelperLibrary integration[2m > [22mshould have all expected date methods[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mhelperLibrary integration[2m > [22mshould have all expected string methods[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mhelperLibrary integration[2m > [22mshould have all expected number methods[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mhelperLibrary integration[2m > [22mshould have all expected array methods[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mhelperLibrary integration[2m > [22mshould have all expected object methods[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22mhelperLibrary integration[2m > [22mshould have all expected math methods[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22medge cases and error handling[2m > [22mshould handle null/undefined inputs gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22medge cases and error handling[2m > [22mshould handle non-numeric inputs to number helpers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22medge cases and error handling[2m > [22mshould handle invalid date formats[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts[2m > [22mHelperLibrary[2m > [22medge cases and error handling[2m > [22mshould handle array operations on non-arrays[32m 0[2mms[22m[39m
{"level":30,"time":1768088242488,"env":"test","module":"user-credentials-repository","userId":"dffb992c-c059-4b16-bd6f-b1b90a989127","msg":"User credentials created"}
{"level":30,"time":1768088242517,"env":"test","module":"user-credentials-repository","userId":"48b1de3f-655d-404a-a45c-386b31b91977","msg":"User credentials created"}
{"level":30,"time":1768088242541,"env":"test","module":"auth-routes","userId":"07be0f30-8d94-4aaa-9bd5-e9ff2b838799","msg":"User logged in successfully"}
{"level":30,"time":1768088242598,"env":"test","module":"audit-log-service","userId":"07be0f30-8d94-4aaa-9bd5-e9ff2b838799","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088242599,"env":"test","module":"email-queue","jobId":"1b3ad9d8-9d90-47e0-a51e-7cac9edc990a","to":"protected-test-UaWcq9jMasO_UtWGycoOO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088242623,"env":"test","module":"email-queue","jobId":"49ce8656-aea5-475d-bc3c-eb66b190c3a7","to":"middleware-test-uqE1zPPMnUe-5G4rHwFJv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088242655,"env":"test","module":"auth-routes","userId":"dffb992c-c059-4b16-bd6f-b1b90a989127","email":"protected-test-UaWcq9jMasO_UtWGycoOO@example.com","msg":"User registered"}
{"level":30,"time":1768088242672,"env":"test","module":"auth-routes","userId":"07be0f30-8d94-4aaa-9bd5-e9ff2b838799","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768088242675,"env":"test","module":"auth-routes","userId":"48b1de3f-655d-404a-a45c-386b31b91977","email":"middleware-test-uqE1zPPMnUe-5G4rHwFJv@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088242685,"env":"test","module":"auth-routes","userId":"07be0f30-8d94-4aaa-9bd5-e9ff2b838799","msg":"User logged in successfully"}
{"level":30,"time":1768088242727,"env":"test","module":"audit-log-service","userId":"07be0f30-8d94-4aaa-9bd5-e9ff2b838799","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088242734,"env":"test","module":"audit-log-service","userId":"07be0f30-8d94-4aaa-9bd5-e9ff2b838799","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mConcurrent Session Handling[2m > [22mshould handle multiple concurrent logins[33m 1543[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mleaveOrganization[2m > [22mshould allow member to leave organization[33m 1089[2mms[22m[39m
{"level":30,"time":1768088243384,"env":"test","module":"auth-routes","userId":"48b1de3f-655d-404a-a45c-386b31b91977","msg":"User logged in successfully"}
{"level":30,"time":1768088243436,"env":"test","module":"audit-log-service","userId":"48b1de3f-655d-404a-a45c-386b31b91977","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088243450,"env":"test","module":"user-credentials-repository","userId":"2b6835e3-0ff7-40d5-be17-dbddfae60f95","msg":"User credentials created"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1768088243551,"env":"test","module":"email-queue","jobId":"21347c7a-b35a-4c4f-8172-b63d91f23add","to":"session-test-KJC3HfNIIXfLxvYB7ydlB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088243602,"env":"test","module":"auth-routes","userId":"2b6835e3-0ff7-40d5-be17-dbddfae60f95","email":"session-test-KJC3HfNIIXfLxvYB7ydlB@example.com","msg":"User registered"}
{"level":30,"time":1768088243615,"env":"test","module":"auth-routes","userId":"dffb992c-c059-4b16-bd6f-b1b90a989127","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mUser Context Attachment[2m > [22mshould attach userId to request[33m 1524[2mms[22m[39m
{"level":30,"time":1768088243670,"env":"test","module":"audit-log-service","userId":"dffb992c-c059-4b16-bd6f-b1b90a989127","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Payload Validation[2m > [22mshould reject token with missing userId[33m 1949[2mms[22m[39m
{"level":30,"time":1768088243997,"env":"test","module":"user-credentials-repository","userId":"15483a3b-bddd-49ad-a188-32bcf2b2e949","msg":"User credentials created"}
{"level":30,"time":1768088244010,"env":"test","connectionId":"8889b24d-e36d-4ee1-addb-8fc527c781bb","projectId":"8e1e89eb-56bc-4d53-b4f1-cabb879bf732","name":"Test OAuth2 Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088244105,"env":"test","module":"email-queue","jobId":"0dbb0942-2259-4f9a-86b8-d0edd674e99a","to":"middleware-test-DbpX_qOfSLEzFeZ8LkEb7@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Authorization Flow Initiation[2m > [22mshould initiate OAuth2 3-legged flow and generate authorization URL[33m 529[2mms[22m[39m
{"level":30,"time":1768088244158,"env":"test","module":"auth-routes","userId":"15483a3b-bddd-49ad-a188-32bcf2b2e949","email":"middleware-test-DbpX_qOfSLEzFeZ8LkEb7@example.com","msg":"User registered"}
{"level":30,"time":1768088244206,"env":"test","module":"user-credentials-repository","userId":"bcb777f6-2ad3-49b0-b296-cdb8ec7bd0a1","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Authorization Flow Initiation[2m > [22mshould include optional scope in authorization URL[32m 113[2mms[22m[39m
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768088244314,"env":"test","module":"email-queue","jobId":"a0ee97b5-aeae-40cc-b94e-488dce1a9d38","to":"protected-test-QcJaSDL8JM5iISfZ1d839@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould require authentication[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould require builder or owner role[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould validate request body with Zod schema[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould generate workflow and return success response[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould enforce rate limiting (10 requests per minute)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould handle AI API rate limit errors with 429 status[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould handle AI API timeout errors with 504 status[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould handle validation errors with 422 status[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould include metadata in response[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/generate[2m > [22mshould log request and response with appropriate detail[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/:id/suggest[2m > [22mshould require authentication[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/:id/suggest[2m > [22mshould require builder or owner role[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/:id/suggest[2m > [22mshould validate workflow exists[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/:id/suggest[2m > [22mshould fetch existing workflow details[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/:id/suggest[2m > [22mshould generate suggestions based on user request[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/:id/suggest[2m > [22mshould return suggestions in correct format[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/workflows/:id/suggest[2m > [22mshould enforce rate limiting[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/templates/:templateId/bindings[2m > [22mshould require authentication[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/templates/:templateId/bindings[2m > [22mshould require builder or owner role[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/templates/:templateId/bindings[2m > [22mshould require placeholders to be provided[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/templates/:templateId/bindings[2m > [22mshould fetch workflow variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/templates/:templateId/bindings[2m > [22mshould generate binding suggestions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/templates/:templateId/bindings[2m > [22mshould include confidence scores in suggestions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/templates/:templateId/bindings[2m > [22mshould identify unmatched placeholders and variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mPOST /api/ai/templates/:templateId/bindings[2m > [22mshould enforce rate limiting[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mRate Limiting[2m > [22mshould use user ID for rate limit key when authenticated[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mRate Limiting[2m > [22mshould fall back to IP address for anonymous users[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mRate Limiting[2m > [22mshould apply 10 requests per minute limit[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mRate Limiting[2m > [22mshould reset limit after window expires[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mError Handling[2m > [22mshould return user-friendly error messages[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mError Handling[2m > [22mshould include error details only in development mode[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts[2m > [22mAI API Endpoints[2m > [22mError Handling[2m > [22mshould log errors with appropriate context[32m 0[2mms[22m[39m
{"level":30,"time":1768088244323,"env":"test","module":"auth-routes","userId":"2b6835e3-0ff7-40d5-be17-dbddfae60f95","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 State Validation[2m > [22mshould validate valid OAuth2 state token[32m 104[2mms[22m[39m
{"level":30,"time":1768088244366,"env":"test","module":"auth-routes","userId":"bcb777f6-2ad3-49b0-b296-cdb8ec7bd0a1","email":"protected-test-QcJaSDL8JM5iISfZ1d839@example.com","msg":"User registered"}
{"level":30,"time":1768088244376,"env":"test","module":"audit-log-service","userId":"2b6835e3-0ff7-40d5-be17-dbddfae60f95","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts[2m > [22mOrganizationService Integration[2m > [22mleaveOrganization[2m > [22mshould allow admin to leave organization[33m 1125[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 State Validation[2m > [22mshould reject invalid OAuth2 state token[32m 96[2mms[22m[39m
{"level":50,"time":1768088244448,"env":"test","status":401,"statusText":"Unauthorized","error":"Invalid client credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768088244449,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244451,"env":"test","data":{"token_type":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1768088244452,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244452,"env":"test","data":{"access_token":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1768088244452,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244454,"env":"test","error":"Network error: ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 State Validation[2m > [22mshould reject expired OAuth2 state token[32m 102[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Fetching[2m > [22mshould fetch OAuth2 access token with client credentials[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Fetching[2m > [22mshould handle token request without scope[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Fetching[2m > [22mshould throw error when token request fails[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Fetching[2m > [22mshould throw error when access_token is missing from response[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Fetching[2m > [22mshould throw error when token_type is missing from response[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Fetching[2m > [22mshould default expires_in to 3600 when not provided[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Fetching[2m > [22mshould handle network errors gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Caching[2m > [22mshould cache OAuth2 tokens to avoid redundant requests[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Caching[2m > [22mshould use different cache keys for different configs[32m 0[2mms[22m[39m
{"level":50,"time":1768088244625,"env":"test","error":"Invalid credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768088244625,"env":"test","error":"ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244628,"env":"test","status":400,"statusText":"Bad Request","error":"Invalid grant_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768088244628,"env":"test","error":"OAuth2 token request failed: 400 Bad Request","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244629,"env":"test","status":401,"statusText":"Unauthorized","error":"Client authentication failed","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768088244629,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244629,"env":"test","status":403,"statusText":"Forbidden","error":"Access denied","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768088244629,"env":"test","error":"OAuth2 token request failed: 403 Forbidden","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244631,"env":"test","status":500,"statusText":"Internal Server Error","error":"Server error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768088244631,"env":"test","error":"OAuth2 token request failed: 500 Internal Server Error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244632,"env":"test","error":"Unexpected token in JSON","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768088244632,"env":"test","error":"Request timeout","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Caching[2m > [22mshould refresh token when cache expires[32m 158[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Caching[2m > [22mshould return cached token with remaining lifetime[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Caching[2m > [22mshould invalidate specific cached token[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Caching[2m > [22mshould clear all cached tokens[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mToken Caching[2m > [22mshould respect 30-second expiry buffer[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mCredential Testing[2m > [22mshould return true for valid credentials[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mCredential Testing[2m > [22mshould return false for invalid credentials[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mCredential Testing[2m > [22mshould return false when token URL is unreachable[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mCache Key Generation[2m > [22mshould generate unique cache keys for different tenants[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mCache Key Generation[2m > [22mshould generate unique cache keys for different projects[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mCache Key Generation[2m > [22mshould generate unique cache keys for different scopes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mCache Key Generation[2m > [22mshould use same cache key for identical configs[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mError Handling[2m > [22mshould handle 400 Bad Request[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mError Handling[2m > [22mshould handle 401 Unauthorized[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mError Handling[2m > [22mshould handle 403 Forbidden[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mError Handling[2m > [22mshould handle 500 Internal Server Error[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mError Handling[2m > [22mshould handle malformed JSON response[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mError Handling[2m > [22mshould handle timeout errors[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mScope Handling[2m > [22mshould include scope in token request when provided[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts[2m > [22mOAuth2 Client Credentials Flow[2m > [22mScope Handling[2m > [22mshould handle space-separated scopes[32m 0[2mms[22m[39m
{"level":40,"time":1768088244641,"env":"test","module":"auth-service","userId":"2b6835e3-0ff7-40d5-be17-dbddfae60f95","tokenHash":"39f4150732e0259d5b9eb8e74e44caf203c6d99e871b592c17fbe5c055b91467","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 State Validation[2m > [22mshould clean up OAuth2 state after use[32m 108[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould allow known variables and helpers[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould allow helper functions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould allow complex expressions with multiple helpers[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould reject unknown identifiers[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould reject forbidden identifiers[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould handle syntax errors gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould validate boolean expressions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mvalidateExpression[2m > [22mshould validate string operations[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould evaluate simple arithmetic[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould be deterministic with fixed clock[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould evaluate with helper functions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould support math helpers[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould support string helpers[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould support array helpers[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould support logic helpers[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould support date helpers with deterministic clock[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould reject invalid property access[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould handle evaluation errors gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould enforce timeout on long-running expressions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould support complex nested expressions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould handle boolean comparisons[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mevaluateExpression[2m > [22mshould handle string concatenation[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mHelpers[2m > [22mshould have all helpers listed in AllowedHelperNames[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mHelpers[2m > [22mroundTo should handle edge cases[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mHelpers[2m > [22mdateDiff should calculate differences correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts[2m > [22mExpression Evaluator[2m > [22mHelpers[2m > [22misEmpty should handle various types[32m 0[2mms[22m[39m
{"level":40,"time":1768088244750,"env":"test","module":"auth-service","userId":"2b6835e3-0ff7-40d5-be17-dbddfae60f95","tokenHash":"c84ccf88e5e8953fa42d1696f8ffc0ce7a0e69d2c89d00496059b8112faeec99","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Callback Error Handling[2m > [22mshould handle callback with missing state parameter[32m 114[2mms[22m[39m
{"level":30,"time":1768088244762,"env":"test","module":"auth-routes","userId":"15483a3b-bddd-49ad-a188-32bcf2b2e949","msg":"User logged in successfully"}
{"level":30,"time":1768088244818,"env":"test","module":"audit-log-service","userId":"15483a3b-bddd-49ad-a188-32bcf2b2e949","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Callback Error Handling[2m > [22mshould handle callback with missing code parameter[32m 103[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts[2m > [22mSession Management Integration Tests[2m > [22mConcurrent Session Handling[2m > [22mshould handle concurrent token refreshes[33m 2015[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Callback Error Handling[2m > [22mshould handle OAuth2 provider error responses[32m 103[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088245093,"env":"test","module":"auth-routes","userId":"bcb777f6-2ad3-49b0-b296-cdb8ec7bd0a1","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088245153,"env":"test","module":"audit-log-service","userId":"bcb777f6-2ad3-49b0-b296-cdb8ec7bd0a1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088245175,"env":"test","connectionId":"a3a05ffe-ce84-4cc0-af74-ae4f3ab8eaf8","projectId":"8e1e89eb-56bc-4d53-b4f1-cabb879bf732","name":"Status Test Connection","type":"oauth2_3leg","msg":"Connection created:"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Connection Status[2m > [22mshould track OAuth2 connection status[33m 370[2mms[22m[39m
{"level":30,"time":1768088245350,"env":"test","module":"user-credentials-repository","userId":"8e9c51cd-2594-4c9b-98f5-433ccb931034","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088245365,"env":"test","blockId":"7cdd7b24-569c-4171-8f23-c13bcb454dfd","virtualStepId":"238097b4-d896-4ee5-b4b6-281aee72fd0e","outputVar":"userList","msg":"Created read table block with virtual step"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mToken Payload Validation[2m > [22mshould reject token with non-existent userId[33m 1585[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Connection Status[2m > [22mshould store OAuth2 state in connection metadata[32m 110[2mms[22m[39m
{"level":30,"time":1768088245451,"env":"test","module":"email-queue","jobId":"57175a5b-7ef5-4b88-90ad-1a008106bd5d","to":"middleware-test-8ZZvjZtUmbYjZCdUwZZ8z@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088245508,"env":"test","module":"auth-routes","userId":"8e9c51cd-2594-4c9b-98f5-433ccb931034","email":"middleware-test-8ZZvjZtUmbYjZCdUwZZ8z@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Security[2m > [22mshould use cryptographically secure random state[32m 105[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Security[2m > [22mshould prevent state reuse after validation[32m 101[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Security[2m > [22mshould include PKCE support metadata in state record[32m 99[2mms[22m[39m
{"level":30,"time":1768088245779,"env":"test","module":"user-credentials-repository","userId":"5f85b19a-c7fc-4e3f-ae4a-e4a940ecbe33","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/dynamic_options_workflow.test.ts[2m > [22mDynamic Options Integration Flow[2m > [22mshould successfully configure a workflow with Read Table -> Dynamic Choice[33m 429[2mms[22m[39m
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088245819,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768088245838,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088245828,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088245828,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088245834,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088245838,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088245838,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088245838,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088245838,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Redirect URI Validation[2m > [22mshould validate redirect URI matches allowed URIs[32m 103[2mms[22m[39m
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768088245896,"env":"test","module":"email-queue","jobId":"fe4aa98c-c5cb-47f2-b97d-2700d15d8c7c","to":"protected-test-2yYC2Bnkgiblp9SGXtW9k@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts[2m > [22mOAuth2 3-Legged Flow - Callback Handling[2m > [22mOAuth2 Redirect URI Validation[2m > [22mshould encode redirect URI in authorization URL[32m 108[2mms[22m[39m
{"level":30,"time":1768088245948,"env":"test","module":"auth-routes","userId":"5f85b19a-c7fc-4e3f-ae4a-e4a940ecbe33","email":"protected-test-2yYC2Bnkgiblp9SGXtW9k@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768088246117,"env":"test","module":"auth-routes","userId":"8e9c51cd-2594-4c9b-98f5-433ccb931034","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088246169,"env":"test","module":"audit-log-service","userId":"8e9c51cd-2594-4c9b-98f5-433ccb931034","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mUser Context Attachment[2m > [22mshould attach userEmail to request[33m 1377[2mms[22m[39m
{"level":50,"time":1768088246175,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mURL-based Prefill[2m > [22mshould prefill allowed fields from URL parameters[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mURL-based Prefill[2m > [22mshould ignore disallowed prefill keys[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mURL-based Prefill[2m > [22mshould not prefill when allowPrefill is false[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mURL-based Prefill[2m > [22mshould not prefill file upload or sensitive fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mCAPTCHA Challenge Generation[2m > [22mshould generate CAPTCHA challenge[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mCAPTCHA Validation on Submit[2m > [22mshould require CAPTCHA when workflow config requires it[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mCAPTCHA Validation on Submit[2m > [22mshould validate correct CAPTCHA and allow submission[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mCAPTCHA Validation on Submit[2m > [22mshould reject incorrect CAPTCHA answer[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mCAPTCHA Validation on Submit[2m > [22mshould not require CAPTCHA when workflow config disables it[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mEmail Receipt[2m > [22mshould send email receipt when configured[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mEmail Receipt[2m > [22mshould not send email when sendEmailReceipt is false[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mEmail Receipt[2m > [22mshould skip email when receiptEmailVar is not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mEmail Receipt[2m > [22mshould exclude sensitive fields from email summary[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mIntakeConfig Management API[2m > [22mshould allow owner to update intakeConfig[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mIntakeConfig Management API[2m > [22mshould allow builder to update intakeConfig[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mIntakeConfig Management API[2m > [22mshould reject viewer from updating intakeConfig[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mIntakeConfig Management API[2m > [22mshould validate intakeConfig schema[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts[2m > [22mStage 12.5 - Intake Portal Extras[2m > [22mGET /intake/workflows/:slug/published[2m > [22mshould include intakeConfig in response[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39m[Shim] Request to /api/auth/google, Session User ID: undefined

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould return consistent error format for missing token[33m 1251[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1768088246608,"env":"test","module":"user-credentials-repository","userId":"7ef4cc7e-d305-40d9-80a4-c97f9a58e7da","msg":"User credentials created"}
{"level":30,"time":1768088246647,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould list all runs with pagination
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088246681,"env":"test","module":"auth-routes","userId":"5f85b19a-c7fc-4e3f-ae4a-e4a940ecbe33","msg":"User logged in successfully"}
{"level":30,"time":1768088246719,"env":"test","module":"email-queue","jobId":"e0202ec5-8c3f-43bf-8811-0d14515c64d5","to":"middleware-test-keeMBXxb2v9BAbEXrsgvj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by status
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088246740,"env":"test","module":"audit-log-service","userId":"5f85b19a-c7fc-4e3f-ae4a-e4a940ecbe33","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs[2m > [22mshould list all runs with pagination[32m 73[2mms[22m[39m
{"level":30,"time":1768088246775,"env":"test","module":"auth-routes","userId":"7ef4cc7e-d305-40d9-80a4-c97f9a58e7da","email":"middleware-test-keeMBXxb2v9BAbEXrsgvj@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by workflow
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould successfully authenticate with valid Google ID token[33m 595[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould return 400 when ID token is missing[32m 57[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs[2m > [22mshould filter runs by status[32m 83[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by project
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":50,"time":1768088246888,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":50,"time":1768088246889,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google authentication failed"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould return 403 when Origin header is invalid[32m 60[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould return 401 when Google token verification fails[32m 61[2mms[22m[39m
{"level":30,"time":1768088246923,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by date range
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.projects.test.ts[2m > [22m[2mProjects API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088246943,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":40,"time":1768088246946,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1768088246946,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google token verification failed"}
{"level":50,"time":1768088246946,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google authentication failed"}
{"level":30,"time":1768088246932,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088246932,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088246936,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768088246943,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768088246943,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768088246943,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768088246943,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs[2m > [22mshould filter runs by workflow[32m 67[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs[2m > [22mshould filter runs by project[32m 65[2mms[22m[39m
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould search runs by query string
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould return 401 when email is not verified by Google[32m 58[2mms[22m[39m
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs[2m > [22mshould filter runs by date range[32m 64[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id[2m > [22m[2mshould get run by ID with all details
[22m[39m[Shim] Request to /api/runs/75cdabac-4481-4456-9f78-02c7c2953f3b, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mMFA Setup Flow[2m > [22mshould complete full MFA setup flow[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mMFA Setup Flow[2m > [22mshould reject invalid TOTP code during setup[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mMFA Setup Flow[2m > [22mshould not enable MFA until TOTP is verified[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mMFA Login Flow[2m > [22mshould complete full MFA login flow[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mMFA Login Flow[2m > [22mshould accept backup code for MFA login[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mMFA Login Flow[2m > [22mshould not allow reuse of backup code[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mMFA Login Flow[2m > [22mshould reject invalid MFA code[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mMFA Login Flow[2m > [22mshould accept TOTP code within 60-second window[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mBackup Code Management[2m > [22mshould regenerate backup codes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mBackup Code Management[2m > [22mshould show remaining backup codes count[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mDisable MFA[2m > [22mshould disable MFA with password confirmation[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mDisable MFA[2m > [22mshould require password to disable MFA[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mDisable MFA[2m > [22mshould delete backup codes when disabling MFA[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mAdmin MFA Reset[2m > [22mshould allow admin to reset user MFA[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mAdmin MFA Reset[2m > [22mshould require admin role for MFA reset[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts[2m > [22mMFA Flow Integration Tests[2m > [22mTenant-Level MFA Enforcement[2m > [22mshould enforce MFA for all tenant users when required[32m 0[2mms[22m[39m
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs[2m > [22mshould search runs by query string[32m 104[2mms[22m[39m
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould execute simple JavaScript code[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould whitelist input keys correctly[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould inject helpers into execution context[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould inject context into execution[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould capture console logs when enabled[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould handle errors gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould enforce timeout[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould handle missing emit() call[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould use custom helpers if provided[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mJavaScript execution[2m > [22mshould measure execution duration[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mPython execution[2m > [22mshould execute simple Python code[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mPython execution[2m > [22mshould whitelist input keys in Python[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mPython execution[2m > [22mshould handle Python errors gracefully[32m 0[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mPython execution[2m > [22mshould enforce timeout for Python
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mexecute()[2m > [22mPython execution[2m > [22mshould handle missing emit() in Python[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mvalidate()[2m > [22mshould validate JavaScript syntax[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mvalidate()[2m > [22mshould reject invalid JavaScript syntax[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mvalidate()[2m > [22mshould reject code exceeding size limit[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mvalidate()[2m > [22mshould reject empty code[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mvalidate()[2m > [22mshould validate Python requires emit()[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mvalidate()[2m > [22mshould accept Python code with emit()[32m 0[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mtest() - integration tests[2m > [22mshould test execute with sample data
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mtest() - integration tests[2m > [22mshould capture console logs in test mode
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22mtest() - integration tests[2m > [22mshould use test context
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22merror handling[2m > [22mshould handle unexpected errors gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts[2m > [22mScriptEngine[2m > [22merror handling[2m > [22mshould handle malformed output gracefully[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id[2m > [22m[2mshould return 404 for non-existent run
[22m[39m[Shim] Request to /api/runs/00000000-0000-0000-0000-000000000000, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088247261,"env":"test","module":"user-credentials-repository","userId":"e78386e2-c08b-4b24-a9e5-b8af6e6965d8","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id/logs[2m > [22m[2mshould get logs for a run
[22m[39m[Shim] Request to /api/runs/75cdabac-4481-4456-9f78-02c7c2953f3b/logs, Session User ID: test-user-runs-stage8

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/:id[2m > [22mshould get run by ID with all details[32m 124[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/:id[2m > [22mshould return 404 for non-existent run[32m 66[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088247370,"env":"test","module":"auth-routes","userId":"7ef4cc7e-d305-40d9-80a4-c97f9a58e7da","msg":"User logged in successfully"}
{"level":30,"time":1768088247372,"env":"test","module":"email-queue","jobId":"91f9c031-41dc-49e5-9ad9-fdbd94f464f2","to":"user2-PyTGLGGd8cSFkhiu_pwwt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088247399,"env":"test","module":"auth","email":"existing@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768088247424,"env":"test","module":"audit-log-service","userId":"7ef4cc7e-d305-40d9-80a4-c97f9a58e7da","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088247430,"env":"test","module":"auth-routes","userId":"e78386e2-c08b-4b24-a9e5-b8af6e6965d8","email":"user2-PyTGLGGd8cSFkhiu_pwwt@example.com","msg":"User registered"}
{"level":50,"time":1768088247431,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with same inputs
[22m[39m[Shim] Request to /api/runs/75cdabac-4481-4456-9f78-02c7c2953f3b/rerun, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088247494,"env":"test","module":"user-credentials-repository","userId":"d73310ab-6053-47ed-89d6-4c421c832e4a","msg":"User credentials created"}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould return consistent error format for invalid token[33m 1256[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould update existing user on subsequent logins[33m 504[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/:id/logs[2m > [22mshould get logs for a run[32m 178[2mms[22m[39m
{"level":30,"time":1768088247604,"env":"test","module":"email-queue","jobId":"56c66753-4396-4f8e-9adf-31218c8bd655","to":"test-projects-e8imPlvhpoHqWDrnoqbRY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests > POST /api/runs/:id/rerun > should re-run workflow with same inputs
[DEBUG Question] Node start executed. Key: start, Value: undefined. Context keys: 4

{"level":30,"time":1768088247662,"env":"test","module":"auth-routes","userId":"d73310ab-6053-47ed-89d6-4c421c832e4a","email":"test-projects-e8imPlvhpoHqWDrnoqbRY@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with override inputs
[22m[39m[Shim] Request to /api/runs/75cdabac-4481-4456-9f78-02c7c2953f3b/rerun, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088247836,"env":"test","module":"auth","email":"refresh@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1768088247846,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768088247872,"env":"test","module":"user-credentials-repository","userId":"1006ae79-f518-49cc-abb1-07e7b5102aa3","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mPOST /api/runs/:id/rerun[2m > [22mshould re-run workflow with same inputs[33m 336[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mPOST /api/projects[2m > [22mshould create a new project[32m 115[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mPOST /api/projects[2m > [22mshould reject without authentication[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mPOST /api/projects[2m > [22mshould reject with invalid data[32m 57[2mms[22m[39m
stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests > POST /api/runs/:id/rerun > should re-run workflow with override inputs
[DEBUG Question] Node start executed. Key: start, Value: undefined. Context keys: 4

{"level":30,"time":1768088247977,"env":"test","module":"email-queue","jobId":"84a585ae-9acb-4fa9-93e1-9cd980ee3c1b","to":"middleware-test-n4IXc3Rf8XFg7j8WCOITW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould create refresh token record in database[33m 437[2mms[22m[39m
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088248034,"env":"test","module":"auth-routes","userId":"1006ae79-f518-49cc-abb1-07e7b5102aa3","email":"middleware-test-n4IXc3Rf8XFg7j8WCOITW@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould return 404 for non-existent run
[22m[39m[Shim] Request to /api/runs/00000000-0000-0000-0000-000000000000/rerun, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088248157,"env":"test","module":"auth-routes","userId":"e78386e2-c08b-4b24-a9e5-b8af6e6965d8","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/export.csv[2m > [22m[2mshould export runs to CSV
[22m[39m[Shim] Request to /api/runs/export.csv, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088248207,"env":"test","module":"audit-log-service","userId":"e78386e2-c08b-4b24-a9e5-b8af6e6965d8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/builder.test.ts[2m > [22mVisual Workflow Builder Store[2m > [22mshould add a question node[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/builder.test.ts[2m > [22mVisual Workflow Builder Store[2m > [22mshould add a compute node[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/builder.test.ts[2m > [22mVisual Workflow Builder Store[2m > [22mshould export graph in correct format[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/builder.test.ts[2m > [22mVisual Workflow Builder Store[2m > [22mshould load graph from API format[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mGET /api/projects[2m > [22mshould list projects for tenant[32m 223[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mPOST /api/runs/:id/rerun[2m > [22mshould re-run workflow with override inputs[33m 331[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mPOST /api/runs/:id/rerun[2m > [22mshould return 404 for non-existent run[32m 62[2mms[22m[39m
{"level":30,"time":1768088248259,"env":"test","module":"auth","email":"idtoken@example.com","msg":"OAuth2 login successful"}
{"level":40,"time":1768088248271,"env":"test","module":"rbac-middleware","userId":"e78386e2-c08b-4b24-a9e5-b8af6e6965d8","userRole":"viewer","permission":"project:delete","path":"/49cfbbf6-2ccf-4dbc-891e-4396cb3f8049","msg":"Permission denied"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould list all active sessions for user[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould mark current session as current[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould only show sessions for authenticated user[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould not include revoked sessions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mGET /api/auth/sessions[2m > [22mshould order sessions by last used (most recent first)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:id[2m > [22mshould revoke specific session[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:id[2m > [22mshould not allow revoking other users sessions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:id[2m > [22mshould allow revoking current session (logout)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/:id[2m > [22mshould return 404 for non-existent session ID[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould revoke all sessions except current[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDELETE /api/auth/sessions/all[2m > [22mshould return count of revoked sessions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mPOST /api/auth/trust-device[2m > [22mshould trust current device for 30 days[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mPOST /api/auth/trust-device[2m > [22mshould skip MFA on trusted device[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mPOST /api/auth/trust-device[2m > [22mshould require MFA on untrusted device[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mPOST /api/auth/trust-device[2m > [22mshould fingerprint device by User-Agent + IP[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould list all trusted devices[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould not include revoked trusted devices[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mGET /api/auth/trusted-devices[2m > [22mshould not include expired trusted devices[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mDELETE /api/auth/trusted-devices/:id[2m > [22mshould revoke trusted device[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mDELETE /api/auth/trusted-devices/:id[2m > [22mshould not allow revoking other users trusted devices[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mDevice Trust + MFA Integration[2m > [22mshould complete full flow: MFA setup -> device trust -> login from trusted device[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts[2m > [22mSession Management Integration Tests[2m > [22mDevice Trust[2m > [22mDevice Trust + MFA Integration[2m > [22mshould update lastUsedAt when using trusted device[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould support both "token" and "idToken" fields[33m 371[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould respect rate limiting[32m 57[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mCross-User Authorization[2m > [22mshould not allow user to access another user's resources[33m 3008[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould register a new user successfully[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould return 400 for invalid email format[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould return 400 for weak password[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould return 409 for duplicate email[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould hash password before storing[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould send email verification token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/login[2m > [22mshould login with valid credentials[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/login[2m > [22mshould return 401 for invalid password[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/login[2m > [22mshould return 404 for non-existent user[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/login[2m > [22mshould return 403 for unverified email[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/login[2m > [22mshould record successful login attempt[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/login[2m > [22mshould record failed login attempt[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/login[2m > [22mshould return requiresMfa=true for MFA-enabled users[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/logout[2m > [22mshould logout and revoke refresh token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/logout[2m > [22mshould return 401 for unauthenticated request[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/verify-email[2m > [22mshould verify email with valid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/verify-email[2m > [22mshould return 400 for invalid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/verify-email[2m > [22mshould return 400 for expired token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/verify-email[2m > [22mshould delete verification token after successful verification[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/resend-verification[2m > [22mshould resend verification email[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/resend-verification[2m > [22mshould rate limit resend requests[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/resend-verification[2m > [22mshould return 404 for non-existent email[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/forgot-password[2m > [22mshould send password reset email[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/forgot-password[2m > [22mshould not reveal if email exists (security)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/forgot-password[2m > [22mshould invalidate old password reset tokens[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/reset-password[2m > [22mshould reset password with valid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/reset-password[2m > [22mshould return 400 for invalid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/reset-password[2m > [22mshould return 400 for weak new password[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/reset-password[2m > [22mshould consume reset token after use[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould refresh access token with valid refresh token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould rotate refresh token after use[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould detect token reuse and revoke all user tokens[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mPOST /api/auth/refresh-token[2m > [22mshould return 401 for expired refresh token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mAccount Lockout[2m > [22mshould lock account after 5 failed login attempts[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mAccount Lockout[2m > [22mshould unlock account after 15 minutes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mAccount Lockout[2m > [22mshould allow admin to unlock account[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mAccount Lockout[2m > [22mshould reset attempt count after successful login[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mGET /api/auth/me[2m > [22mshould return current user for valid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mGET /api/auth/me[2m > [22mshould return 401 for missing token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mGET /api/auth/me[2m > [22mshould return 401 for invalid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts[2m > [22mAuth Routes Integration Tests[2m > [22mGET /api/auth/me[2m > [22mshould return 401 for expired token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mGET /api/projects[2m > [22mshould support pagination[32m 229[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/export.csv[2m > [22m[2mshould export runs with filters applied
[22m[39m[Shim] Request to /api/runs/export.csv, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088248687,"env":"test","module":"auth","email":"minimal@example.com","msg":"OAuth2 login successful"}
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mGET /api/projects/:id[2m > [22mshould get project by ID[32m 235[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/export.csv[2m > [22mshould export runs to CSV[32m 257[2mms[22m[39m
{"level":30,"time":1768088248704,"env":"test","module":"auth-routes","userId":"1006ae79-f518-49cc-abb1-07e7b5102aa3","msg":"User logged in successfully"}
{"level":30,"time":1768088248767,"env":"test","module":"audit-log-service","userId":"1006ae79-f518-49cc-abb1-07e7b5102aa3","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088248773,"env":"test","module":"user-credentials-repository","userId":"c363f61d-13ee-4ea2-a73b-101b0dd49015","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mPOST /api/auth/google - Google OAuth2 Login[2m > [22mshould handle missing profile information gracefully[33m 371[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mGoogle Token Verification[2m > [22mshould verify valid Google ID token[32m 50[2mms[22m[39m
{"level":50,"time":1768088248799,"env":"test","module":"auth","err":{"type":"Error","message":"Token verification failed","stack":"Error: Token verification failed\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:425:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould compare two runs
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

{"level":40,"time":1768088248851,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1768088248851,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
{"level":30,"time":1768088248889,"env":"test","module":"email-queue","jobId":"02df6cd2-d876-48bf-bf3d-577e2055ce63","to":"protected-test-k5lrJ3D_gACvoVvBpfu1B@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mGoogle Token Verification[2m > [22mshould throw error when token verification fails[32m 60[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mGoogle Token Verification[2m > [22mshould throw error when email is not verified[32m 51[2mms[22m[39m
{"level":50,"time":1768088248901,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token payload","stack":"Error: Invalid token payload\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:85:25)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mGET /api/projects/:id[2m > [22mshould return 404 for non-existent project[32m 233[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts[2m > [22mOAuth2 Google Authentication Flow[2m > [22mGoogle Token Verification[2m > [22mshould throw error when payload is null[32m 49[2mms[22m[39m
{"level":30,"time":1768088248951,"env":"test","module":"auth-routes","userId":"c363f61d-13ee-4ea2-a73b-101b0dd49015","email":"protected-test-k5lrJ3D_gACvoVvBpfu1B@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/export.csv[2m > [22mshould export runs with filters applied[33m 375[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould identify changed input keys
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/compare[2m > [22mshould compare two runs[33m 308[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould return 404 if run A not found
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould return 404 if run B not found
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/compare[2m > [22mshould identify changed input keys[32m 113[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/compare[2m > [22mshould return 404 if run A not found[32m 64[2mms[22m[39m
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mGET /api/runs/compare[2m > [22mshould return 404 if run B not found[32m 61[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mPATCH /api/projects/:id[2m > [22mshould update project[33m 558[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22menqueue[2m > [22mshould enqueue a PDF conversion job[33m 735[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mRBAC and Tenant Isolation[2m > [22m[2mshould enforce tenant isolation on runs list
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768088249736,"env":"test","module":"auth-routes","userId":"c363f61d-13ee-4ea2-a73b-101b0dd49015","msg":"User logged in successfully"}
{"level":30,"time":1768088249787,"env":"test","module":"audit-log-service","userId":"c363f61d-13ee-4ea2-a73b-101b0dd49015","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mDELETE /api/projects/:id[2m > [22mshould soft-delete project[33m 328[2mms[22m[39m
stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests
Cleanup error (non-fatal): error: syntax error at or near "="
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.runs.graph.test.ts:252:9 {
  length: 90,
  severity: 'ERROR',
  code: '42601',
  detail: undefined,
  hint: undefined,
  position: '32',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'scan.l',
  line: '1244',
  routine: 'scanner_yyerror'
}

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts[2m > [22mStage 8: Runs API Integration Tests[2m > [22mRBAC and Tenant Isolation[2m > [22mshould enforce tenant isolation on runs list[33m 488[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mUser Context Injection[2m > [22mshould inject userId into request context[33m 1577[2mms[22m[39m
{"level":40,"time":1768088250007,"env":"test","module":"auth-middleware","error":{"name":"TokenExpiredError","code":"AUTH_002","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088250007,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould return consistent error format for expired token[33m 2617[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22menqueue[2m > [22mshould create output with empty storagePath initially[33m 699[2mms[22m[39m
{"level":30,"time":1768088250410,"env":"test","module":"user-credentials-repository","userId":"bfb06435-b78b-49e3-925b-f6662d90be93","msg":"User credentials created"}
{"level":30,"time":1768088250417,"env":"test","module":"user-credentials-repository","userId":"f7333eea-4429-44e7-bb94-a2675430b5b5","msg":"User credentials created"}
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1768088250517,"env":"test","module":"email-queue","jobId":"b7ba028d-cb75-4c1a-b278-502d8d232b8c","to":"protected-test-xZc082tBK1lTEFEj2q8MT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088250535,"env":"test","module":"email-queue","jobId":"74236a61-4020-48bd-9fed-5776dd460f72","to":"other-brX80c71V5eTtzYDy1S4l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088250569,"env":"test","module":"auth-routes","userId":"bfb06435-b78b-49e3-925b-f6662d90be93","email":"protected-test-xZc082tBK1lTEFEj2q8MT@example.com","msg":"User registered"}
{"level":30,"time":1768088250594,"env":"test","module":"auth-routes","userId":"f7333eea-4429-44e7-bb94-a2675430b5b5","email":"other-brX80c71V5eTtzYDy1S4l@example.com","msg":"User registered"}
{"level":30,"time":1768088250978,"env":"test","module":"user-credentials-repository","userId":"a591c2cf-26cb-45fb-bc8d-34070004a61d","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mgetJobStatus[2m > [22mshould return job status for pending job[33m 679[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts[2m > [22mProjects API Integration Tests[2m > [22mTenant Isolation[2m > [22mshould not allow cross-tenant access[33m 1204[2mms[22m[39m
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088251088,"env":"test","module":"email-queue","jobId":"23722b43-582c-4da7-a020-aeda692088b7","to":"middleware-test-fnqns7BOyNMq-CLXQN9BY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088251141,"env":"test","module":"auth-routes","userId":"a591c2cf-26cb-45fb-bc8d-34070004a61d","email":"middleware-test-fnqns7BOyNMq-CLXQN9BY@example.com","msg":"User registered"}
{"level":40,"time":1768088251150,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mProject Transfer[2m > [22mshould transfer user-owned project to org[33m 1904[2mms[22m[39m
{"level":30,"time":1768088251500,"env":"test","module":"auth-routes","userId":"bfb06435-b78b-49e3-925b-f6662d90be93","msg":"User logged in successfully"}
{"level":30,"time":1768088251554,"env":"test","module":"audit-log-service","userId":"bfb06435-b78b-49e3-925b-f6662d90be93","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mgetJobStatus[2m > [22mshould return null for non-existent job[33m 654[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mUser Context Injection[2m > [22mshould inject tenantId into request context[33m 1767[2mms[22m[39m
{"level":30,"time":1768088251752,"env":"test","module":"auth-routes","userId":"a591c2cf-26cb-45fb-bc8d-34070004a61d","msg":"User logged in successfully"}
{"level":30,"time":1768088251807,"env":"test","module":"audit-log-service","userId":"a591c2cf-26cb-45fb-bc8d-34070004a61d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768088251813,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088251813,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/variableSafety.test.ts[2m > [22mVariable Schema Safety & Resolution[2m > [22mREPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided[33m 845[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould handle malformed JWT gracefully[33m 1766[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1768088252034,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768088252170,"env":"test","module":"user-credentials-repository","userId":"3614be59-7089-4f4c-8923-7ec63cf23a85","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/variableSafety.test.ts[2m > [22mVariable Schema Safety & Resolution[2m > [22mScriptEngine resolves alias 'input_variable' when aliasMap is provided[33m 817[2mms[22m[39m
{"level":30,"time":1768088252280,"env":"test","module":"email-queue","jobId":"0fc59e64-9451-4a5e-bc77-69f2efcbfcee","to":"protected-test-q43Crpr-lJ2v2gP9XLsKn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088252315,"env":"test","module":"user-credentials-repository","userId":"be291400-449d-4358-8c8b-0dbd89f11485","msg":"User credentials created"}
{"level":30,"time":1768088252333,"env":"test","module":"auth-routes","userId":"3614be59-7089-4f4c-8923-7ec63cf23a85","email":"protected-test-q43Crpr-lJ2v2gP9XLsKn@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mgetJobStatus[2m > [22mshould parse attempt count from error field[33m 703[2mms[22m[39m
{"level":30,"time":1768088252423,"env":"test","module":"email-queue","jobId":"8cfcc7ac-2f96-4235-9472-a21bbd8ad612","to":"middleware-test-t2JpUgdzj3QKMnUwDvrEH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088252476,"env":"test","module":"auth-routes","userId":"be291400-449d-4358-8c8b-0dbd89f11485","email":"middleware-test-t2JpUgdzj3QKMnUwDvrEH@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mProject Transfer[2m > [22mshould prevent transfer to org if user is not a member[33m 1491[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [32mÎ“Â£Ã´[39m tests/integration/variableSafety.test.ts[2m > [22mVariable Schema Safety & Resolution[2m > [22mREPRO: BlockRunner fails to resolve alias in CreateRecordConfig[33m 665[2mms[22m[39m
{"level":30,"time":1768088253060,"env":"test","module":"auth-routes","userId":"3614be59-7089-4f4c-8923-7ec63cf23a85","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088253106,"env":"test","module":"auth-routes","userId":"be291400-449d-4358-8c8b-0dbd89f11485","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mconvertImmediate[2m > [22mshould convert DOCX to PDF immediately[33m 748[2mms[22m[39m
{"level":30,"time":1768088253131,"env":"test","module":"audit-log-service","userId":"3614be59-7089-4f4c-8923-7ec63cf23a85","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768088253161,"env":"test","module":"audit-log-service","userId":"be291400-449d-4358-8c8b-0dbd89f11485","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768088253169,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768088253170,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/auth.middleware.integration.test.ts[2m > [22mAuth Middleware Integration Tests[2m > [22mError Handling[2m > [22mshould handle JWT with wrong algorithm[33m 1356[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mUser Context Injection[2m > [22mshould inject role into request context[33m 1571[2mms[22m[39m
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/variableSafety.test.ts[2m > [22mVariable Schema Safety & Resolution[2m > [22mBlockRunner logic resolves alias with aliasMap[33m 646[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1768088253645,"env":"test","module":"user-credentials-repository","userId":"9af7d678-5cc6-4e18-9244-56e1ce8ba68e","msg":"User credentials created"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088253753,"env":"test","module":"email-queue","jobId":"72e48b13-0516-4666-8fb8-1c1e28f45228","to":"protected-test-ylxTgl-QWR0HhsUaYp4Me@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088253803,"env":"test","module":"auth-routes","userId":"9af7d678-5cc6-4e18-9244-56e1ce8ba68e","email":"protected-test-ylxTgl-QWR0HhsUaYp4Me@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mconvertImmediate[2m > [22mshould handle conversion errors gracefully[33m 695[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/PageValidator.test.ts[2m > [22mPageValidator[2m > [22mshould return valid if all blocks are valid[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/PageValidator.test.ts[2m > [22mPageValidator[2m > [22mshould aggregate errors from invalid blocks[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/PageValidator.test.ts[2m > [22mPageValidator[2m > [22mshould pass allValues context to validator[32m 3[2mms[22m[39m
{"level":30,"time":1768088254524,"env":"test","module":"auth-routes","userId":"9af7d678-5cc6-4e18-9244-56e1ce8ba68e","msg":"User logged in successfully"}
{"level":30,"time":1768088254584,"env":"test","module":"audit-log-service","userId":"9af7d678-5cc6-4e18-9244-56e1ce8ba68e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mProject Transfer[2m > [22mshould allow org member to transfer org-owned project to another org they belong to[33m 1907[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mService Lifecycle[2m > [22mshould start and stop service[33m 808[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mvalidateTemplateData2[2m > [22mshould validate complete data[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mvalidateTemplateData2[2m > [22mshould detect missing placeholders[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mvalidateTemplateData2[2m > [22mshould detect extra data keys[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mvalidateTemplateData2[2m > [22mshould ignore helper functions in validation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mvalidateTemplateData2[2m > [22mshould handle empty placeholders[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mextractPlaceholders2[2m > [22mshould parse simple placeholders[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mextractPlaceholders2[2m > [22mshould parse loop variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mextractPlaceholders2[2m > [22mshould parse conditional variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mextractPlaceholders2[2m > [22mshould parse helper calls[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mrenderDocx2[2m > [22mshould render template with data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mrenderDocx2[2m > [22mshould handle rendering errors gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mrenderDocx2[2m > [22mshould support PDF conversion when requested[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mrenderDocx2[2m > [22mshould merge data with helpers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mExpression Parser[2m > [22mshould parse simple variable access[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mExpression Parser[2m > [22mshould parse nested variable access[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mExpression Parser[2m > [22mshould parse helper calls with arguments[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mExpression Parser[2m > [22mshould handle missing values gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mTemplate Syntax Support[2m > [22mshould support simple loops[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mTemplate Syntax Support[2m > [22mshould support nested loops[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mTemplate Syntax Support[2m > [22mshould support conditionals[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mTemplate Syntax Support[2m > [22mshould support unless conditionals[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mTemplate Syntax Support[2m > [22mshould support inline helpers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mError Handling[2m > [22mshould throw NotFound error for missing template[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mError Handling[2m > [22mshould provide detailed error messages for render failures[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mError Handling[2m > [22mshould handle malformed templates[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mIntegration with Helpers[2m > [22mshould make all helpers available in template[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts[2m > [22mDOCX Renderer 2.0[2m > [22mIntegration with Helpers[2m > [22mshould support helper chaining[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mService Lifecycle[2m > [22mshould not start if already running[33m 576[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768088255749,"env":"test","module":"user-credentials-repository","userId":"a41375f1-db40-4df8-8033-b9217406c9aa","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mWorkflow Transfer[2m > [22mshould detach workflow from project when transferring to different owner[33m 1525[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mService Lifecycle[2m > [22mshould handle stop when not running[33m 605[2mms[22m[39m
{"level":30,"time":1768088255859,"env":"test","module":"email-queue","jobId":"2826eaf1-f83f-42ce-ad3b-41ce3ed87d83","to":"protected-test-G4Wdgk5EaPZLzF70jON1f@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088255910,"env":"test","module":"auth-routes","userId":"a41375f1-db40-4df8-8033-b9217406c9aa","email":"protected-test-G4Wdgk5EaPZLzF70jON1f@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mpaginationQuerySchema[2m > [22mshould parse valid pagination query with defaults[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mpaginationQuerySchema[2m > [22mshould parse custom limit[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mpaginationQuerySchema[2m > [22mshould coerce limit to number[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mpaginationQuerySchema[2m > [22mshould parse cursor[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mpaginationQuerySchema[2m > [22mshould enforce minimum limit of 1[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mpaginationQuerySchema[2m > [22mshould enforce maximum limit of 100[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mpaginationQuerySchema[2m > [22mshould enforce integer limit[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mencodeCursor and decodeCursor[2m > [22mshould encode and decode cursor correctly[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mencodeCursor and decodeCursor[2m > [22mshould handle null createdAt by using current time[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mencodeCursor and decodeCursor[2m > [22mshould encode cursor as base64[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mencodeCursor and decodeCursor[2m > [22mshould return null for invalid base64 cursor[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mencodeCursor and decodeCursor[2m > [22mshould return null for malformed cursor payload[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mencodeCursor and decodeCursor[2m > [22mshould return null for cursor with non-numeric timestamp[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mencodeCursor and decodeCursor[2m > [22mshould handle cursor with special characters in ID[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mcreatePaginatedResponse[2m > [22mshould create paginated response with hasMore=false when items <= limit[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mcreatePaginatedResponse[2m > [22mshould create paginated response with hasMore=true when items > limit[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mcreatePaginatedResponse[2m > [22mshould encode nextCursor based on last returned item[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mcreatePaginatedResponse[2m > [22mshould handle exact match (items === limit + 1)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mcreatePaginatedResponse[2m > [22mshould handle empty items array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mcreatePaginatedResponse[2m > [22mshould handle single item[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mbuildCursorWhere[2m > [22mshould return null for undefined cursor[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mbuildCursorWhere[2m > [22mshould build where clause from valid cursor[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mbuildCursorWhere[2m > [22mshould return null for invalid cursor[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts[2m > [22mPagination Utilities[2m > [22mbuildCursorWhere[2m > [22mshould handle empty string cursor[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768088256719,"env":"test","module":"auth-routes","userId":"a41375f1-db40-4df8-8033-b9217406c9aa","msg":"User logged in successfully"}
{"level":30,"time":1768088256778,"env":"test","module":"audit-log-service","userId":"a41375f1-db40-4df8-8033-b9217406c9aa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mRate Limiting on Protected Routes[2m > [22mshould not apply general rate limiting to authenticated requests[33m 2098[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mQueue Processing[2m > [22mshould process pending jobs when queue is processed[33m 1051[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mWorkflow Transfer[2m > [22mshould keep workflow in project when transferring to same owner[33m 1592[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1768088257524,"env":"test","module":"auth-routes","userId":"a41375f1-db40-4df8-8033-b9217406c9aa","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088257575,"env":"test","module":"audit-log-service","userId":"a41375f1-db40-4df8-8033-b9217406c9aa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mMixed Auth Scenarios[2m > [22mshould handle request with both Bearer token and cookies[33m 2351[2mms[22m[39m
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088258182,"env":"test","module":"user-credentials-repository","userId":"18a68758-c487-4d18-b994-2d27782d9fb9","msg":"User credentials created"}
{"level":30,"time":1768088258285,"env":"test","module":"email-queue","jobId":"a660b9bc-329a-478d-9b24-584b3e5ccb17","to":"protected-test-DKbXUHrfQ-0d-YenxEFqq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088258339,"env":"test","module":"auth-routes","userId":"18a68758-c487-4d18-b994-2d27782d9fb9","email":"protected-test-DKbXUHrfQ-0d-YenxEFqq@example.com","msg":"User registered"}
stderr | tests/unit/shared/workflowLogic.test.ts > workflowLogic > evaluateRules > Operators > Unknown operator > should return false and log warning for unknown operator
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mSection-level rules[2m > [22mshould show section when condition is met[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mSection-level rules[2m > [22mshould hide section when hide action is triggered[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mSection-level rules[2m > [22mshould set skip target when skip_to action is triggered[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mSection-level rules[2m > [22mshould ignore rule with missing targetSectionId[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mStep-level rules[2m > [22mshould show step when condition is met[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mStep-level rules[2m > [22mshould hide step and remove from required when hide action is triggered[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mStep-level rules[2m > [22mshould require step when require action is triggered[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mStep-level rules[2m > [22mshould make step optional when make_optional action is triggered[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mStep-level rules[2m > [22mshould ignore rule with missing targetStepId[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mequals[2m > [22mshould handle string equality (case-insensitive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mequals[2m > [22mshould handle boolean equality[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mequals[2m > [22mshould handle array equality (order-independent)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mequals[2m > [22mshould handle numeric equality[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mnot_equals[2m > [22mshould return true when values are different[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mcontains[2m > [22mshould match substring in string (case-insensitive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mcontains[2m > [22mshould match item in array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mcontains[2m > [22mshould return false for non-string, non-array values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mnot_contains[2m > [22mshould return true when substring is not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mgreater_than[2m > [22mshould compare numeric values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mgreater_than[2m > [22mshould parse string numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mgreater_than[2m > [22mshould return false for invalid numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mless_than[2m > [22mshould compare numeric values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mbetween[2m > [22mshould check if value is between min and max (inclusive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mbetween[2m > [22mshould include boundary values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mbetween[2m > [22mshould return false if value is outside range[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mbetween[2m > [22mshould return false for invalid range format[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mbetween[2m > [22mshould return false for non-numeric value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mis_empty[2m > [22mshould return true for null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mis_empty[2m > [22mshould return true for undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mis_empty[2m > [22mshould return true for empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mis_empty[2m > [22mshould return true for empty array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mis_empty[2m > [22mshould return true for empty object[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mis_empty[2m > [22mshould return false for non-empty values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mis_not_empty[2m > [22mshould return true for non-empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mis_not_empty[2m > [22mshould return false for null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mOperators[2m > [22mUnknown operator[2m > [22mshould return false and log warning for unknown operator[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mEdge cases[2m > [22mshould handle empty rules array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mEdge cases[2m > [22mshould handle empty data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mEdge cases[2m > [22mshould handle missing condition value (undefined)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mevaluateRules[2m > [22mEdge cases[2m > [22mshould process multiple rules in order[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mcalculateNextSection[2m > [22mshould return first visible section when currentSectionId is null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mcalculateNextSection[2m > [22mshould return next visible section[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mcalculateNextSection[2m > [22mshould skip hidden sections[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mcalculateNextSection[2m > [22mshould return null when no more visible sections[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mcalculateNextSection[2m > [22mshould return null for non-existent current section[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mcalculateNextSection[2m > [22mshould handle empty visible sections[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mcalculateNextSection[2m > [22mshould handle sections in random order[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mresolveNextSection[2m > [22mshould use skipToSectionId when provided and visible[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mresolveNextSection[2m > [22mshould find next visible section when skip target is not visible[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mresolveNextSection[2m > [22mshould use normal next section when no skip target[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mresolveNextSection[2m > [22mshould return null when skip target has no visible sections after[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mvalidateRequiredSteps[2m > [22mshould return valid when all required steps have values[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mvalidateRequiredSteps[2m > [22mshould return invalid when required steps are missing[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mvalidateRequiredSteps[2m > [22mshould consider empty strings as missing[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mvalidateRequiredSteps[2m > [22mshould consider empty arrays as missing[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mvalidateRequiredSteps[2m > [22mshould consider null as missing[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mvalidateRequiredSteps[2m > [22mshould handle empty required steps set[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mvalidateRequiredSteps[2m > [22mshould not consider 0 or false as empty[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mgetEffectiveRequiredSteps[2m > [22mshould return initial required steps when no rules apply[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mgetEffectiveRequiredSteps[2m > [22mshould add steps when require rule is triggered[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mgetEffectiveRequiredSteps[2m > [22mshould remove steps when make_optional rule is triggered[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mgetEffectiveRequiredSteps[2m > [22mshould ignore rules that don't target requirements[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mgetEffectiveRequiredSteps[2m > [22mshould ignore section-level rules[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mgetEffectiveRequiredSteps[2m > [22mshould not modify original set[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts[2m > [22mworkflowLogic[2m > [22mgetEffectiveRequiredSteps[2m > [22mshould handle multiple rules modifying same step[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mQueue Processing[2m > [22mshould process multiple jobs in batch[33m 1325[2mms[22m[39m
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mBasic option generation[2m > [22mshould generate options from a list with label and value paths[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mBasic option generation[2m > [22mshould use labelTemplate to combine fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mBasic option generation[2m > [22mshould add blank option when configured[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mFiltering[2m > [22mshould filter options before mapping[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mFiltering[2m > [22mshould support multi-condition filters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mSorting[2m > [22mshould sort options by a field[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mSorting[2m > [22mshould support multi-key sorting[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mLimiting[2m > [22mshould limit the number of options[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mLimiting[2m > [22mshould apply offset and limit together[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mDeduplication[2m > [22mshould deduplicate options by a field[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mComprehensive pipeline[2m > [22mshould apply multiple transformations in sequence[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mEdge cases[2m > [22mshould handle empty lists gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mEdge cases[2m > [22mshould handle missing fields in rows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts[2m > [22mList-Backed Choice Options[2m > [22mEdge cases[2m > [22mshould work with ListVariable format[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mgenerateSimpleChallenge[2m > [22mshould generate a valid simple math challenge[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mgenerateSimpleChallenge[2m > [22mshould generate unique tokens for each challenge[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mgenerateSimpleChallenge[2m > [22mshould generate challenges with numbers between 1-20[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mvalidateCaptcha - simple type[2m > [22mshould validate correct answer[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mvalidateCaptcha - simple type[2m > [22mshould reject incorrect answer[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mvalidateCaptcha - simple type[2m > [22mshould reject missing token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mvalidateCaptcha - simple type[2m > [22mshould reject missing answer[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mvalidateCaptcha - simple type[2m > [22mshould reject invalid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mvalidateCaptcha - simple type[2m > [22mshould enforce max attempts (3)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mvalidateCaptcha - simple type[2m > [22mshould clean up used token after successful validation[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts[2m > [22mCaptchaService[2m > [22mgetStats[2m > [22mshould return challenge statistics[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mrenders text value in display mode[32m 70[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mrenders number value correctly[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museCollabClient[2m > [22mshould initialize with default state[32m 36[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mrenders boolean value as Yes/No[33m 753[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mrenders date value formatted[32m 45[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mError Handling[2m > [22mshould handle missing DOCX output gracefully[33m 791[2mms[22m[39m
stderr | tests/unit/shared/conditionEvaluator.test.ts > conditionEvaluator > Comparison operators > Unknown operator > should default to true and log warning
Unknown operator: unknown_operator

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museCollabClient[2m > [22mshould connect to WebSocket server[32m 219[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mevaluateConditionExpression[2m > [22mshould return true for null expression (always visible)[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mevaluateConditionExpression[2m > [22mshould return true for undefined expression[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mevaluateConditionExpression[2m > [22mshould evaluate simple condition[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mevaluateConditionExpression[2m > [22mshould return true for empty conditions array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mevaluateConditionExpressionWithDetails[2m > [22mshould return detailed result with reason[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mevaluateConditionExpressionWithDetails[2m > [22mshould count multiple evaluated conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mevaluateConditionExpressionWithDetails[2m > [22mshould return reason when conditions not satisfied[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mGroup operators[2m > [22mAND operator[2m > [22mshould return true when all conditions are true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mGroup operators[2m > [22mAND operator[2m > [22mshould return false when any condition is false[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mGroup operators[2m > [22mOR operator[2m > [22mshould return true when any condition is true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mGroup operators[2m > [22mOR operator[2m > [22mshould return false when all conditions are false[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mGroup operators[2m > [22mNested groups[2m > [22mshould evaluate nested AND/OR groups[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mGroup operators[2m > [22mNested groups[2m > [22mshould handle deeply nested groups[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mequals[2m > [22mshould match equal strings (case-insensitive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mequals[2m > [22mshould match equal numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mequals[2m > [22mshould match booleans[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mequals[2m > [22mshould match boolean string representations[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mequals[2m > [22mshould match arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mequals[2m > [22mshould match objects[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mequals[2m > [22mshould handle null/undefined equality[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mequals[2m > [22mshould coerce number strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mnot_equals[2m > [22mshould return true for different values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mnot_equals[2m > [22mshould return false for equal values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mcontains[2m > [22mshould find substring in string (case-insensitive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mcontains[2m > [22mshould return false when substring not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mnot_contains[2m > [22mshould return true when substring not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mstarts_with[2m > [22mshould match string prefix (case-insensitive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mends_with[2m > [22mshould match string suffix (case-insensitive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mgreater_than[2m > [22mshould compare numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mgreater_than[2m > [22mshould parse string numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mgreater_than[2m > [22mshould handle dates[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mgreater_than[2m > [22mshould convert booleans to numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mless_than[2m > [22mshould compare numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mgreater_or_equal[2m > [22mshould return true for greater value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mgreater_or_equal[2m > [22mshould return true for equal value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mgreater_or_equal[2m > [22mshould return false for lesser value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mless_or_equal[2m > [22mshould compare numbers correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mbetween[2m > [22mshould check if value is between min and max (inclusive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_true[2m > [22mshould return true for boolean true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_true[2m > [22mshould return true for truthy strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_true[2m > [22mshould return false for falsy values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_false[2m > [22mshould return true for boolean false[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_empty[2m > [22mshould return true for null/undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_empty[2m > [22mshould return true for empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_empty[2m > [22mshould return true for empty array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_empty[2m > [22mshould return true for empty object[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_empty[2m > [22mshould return false for non-empty values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_not_empty[2m > [22mshould return true for non-empty values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mis_not_empty[2m > [22mshould return false for empty values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mincludes[2m > [22mshould check if array includes value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mincludes[2m > [22mshould handle non-array values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mnot_includes[2m > [22mshould return true when array does not include value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mincludes_all[2m > [22mshould return true when array includes all required values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mincludes_any[2m > [22mshould return true when array includes any of the values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mComparison operators[2m > [22mUnknown operator[2m > [22mshould default to true and log warning[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mVariable resolution[2m > [22mshould resolve alias to step ID when resolver is provided[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mVariable resolution[2m > [22mshould fall back to original key if not resolved[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mVariable resolution[2m > [22mshould resolve variable references in value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mVariable resolution[2m > [22mshould skip conditions with no variable selected[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mevaluateWorkflowVisibility[2m > [22mshould evaluate visibility for all sections and steps[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould return 'Always visible' for null expression[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould describe simple condition[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould describe AND conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould describe OR conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould use variable labels when provided[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould describe between operator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould describe operators without values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould describe variable references[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould handle nested groups with parentheses[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts[2m > [22mconditionEvaluator[2m > [22mdescribeConditionExpression[2m > [22mshould format array values[32m 0[2mms[22m[39m
{"level":30,"time":1768088259050,"env":"test","module":"auth-routes","userId":"18a68758-c487-4d18-b994-2d27782d9fb9","msg":"User logged in successfully"}
{"level":30,"time":1768088259104,"env":"test","module":"audit-log-service","userId":"18a68758-c487-4d18-b994-2d27782d9fb9","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mshows text input in edit mode for text columns[32m 159[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mshows number input in edit mode for number columns[32m 52[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museCollabClient[2m > [22mshould update nodes in Yjs document[32m 172[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mrenders column name[32m 91[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mshows checkbox in edit mode for boolean columns[32m 148[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mWorkflow Transfer[2m > [22mshould prevent non-member from transferring org workflow[33m 1449[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mshows drag handle[32m 22[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mshows type icon for text columns[32m 38[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mshows type icon for number columns[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museCollabClient[2m > [22mshould update edges in Yjs document[32m 124[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mshows type icon for boolean columns[32m 62[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mshows type icon for date columns[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mshows primary key badge when column is PK[32m 12[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mshows required indicator when column is required[32m 73[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mshows both PK badge and required indicator[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx[2m > [22mSortableColumnHeader[2m > [22mapplies correct CSS classes[32m 68[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museCollabClient[2m > [22mshould disconnect cleanly[32m 170[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museComments[2m > [22mshould initialize with empty comments[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museComments[2m > [22mshould add a comment[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museComments[2m > [22mshould delete a comment[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22museComments[2m > [22mshould get comment count for a node[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22mPresenceAvatars[2m > [22mshould render nothing when no users[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mcalls onCommit when Enter is pressed[33m 317[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mcalls onCancel when Escape is pressed[32m 52[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mhandles empty values[32m 37[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mhandles null values[32m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx[2m > [22mCellRenderer[2m > [22mshows "Unsupported type" for unknown column types[32m 4[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22mPresenceAvatars[2m > [22mshould render user avatars[32m 138[2mms[22m[39m
{"level":30,"time":1768088259711,"env":"test","module":"auth-routes","userId":"18a68758-c487-4d18-b994-2d27782d9fb9","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mTransaction Support[2m > [22mshould support enqueue within transaction[33m 786[2mms[22m[39m
{"level":30,"time":1768088259770,"env":"test","module":"audit-log-service","userId":"18a68758-c487-4d18-b994-2d27782d9fb9","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22mPresenceAvatars[2m > [22mshould show hidden count when exceeds max[32m 257[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mDatabase Transfer[2m > [22mshould transfer database ownership[33m 1113[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mequals operator[2m > [22mshould match equal strings (case-insensitive)[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mequals operator[2m > [22mshould match equal numbers[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mequals operator[2m > [22mshould match equal booleans[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mequals operator[2m > [22mshould handle null values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mnotEquals operator[2m > [22mshould match non-equal values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mnumeric comparison operators[2m > [22mshould evaluate gt (greater than)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mnumeric comparison operators[2m > [22mshould evaluate gte (greater than or equal)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mnumeric comparison operators[2m > [22mshould evaluate lt (less than)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mnumeric comparison operators[2m > [22mshould evaluate lte (less than or equal)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22marray and string operators[2m > [22mshould evaluate in (value in array)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22marray and string operators[2m > [22mshould evaluate notIn[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22marray and string operators[2m > [22mshould evaluate contains for arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22marray and string operators[2m > [22mshould evaluate contains for strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22marray and string operators[2m > [22mshould evaluate notContains[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22marray and string operators[2m > [22mshould evaluate startsWith[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22marray and string operators[2m > [22mshould evaluate endsWith[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22marray and string operators[2m > [22mshould evaluate matches (regex)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mempty/notEmpty operators[2m > [22mshould evaluate isEmpty for null/undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mempty/notEmpty operators[2m > [22mshould evaluate isEmpty for empty strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mempty/notEmpty operators[2m > [22mshould evaluate isEmpty for empty arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Basic Comparisons[2m > [22mempty/notEmpty operators[2m > [22mshould evaluate notEmpty[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mAND conditions[2m > [22mshould return true when all sub-conditions are true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mAND conditions[2m > [22mshould handle empty AND array as true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mAND conditions[2m > [22mshould support nested AND conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mOR conditions[2m > [22mshould return true when any sub-condition is true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mOR conditions[2m > [22mshould handle empty OR array as false[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mOR conditions[2m > [22mshould support nested OR conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mNOT conditions[2m > [22mshould negate the sub-condition[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mNOT conditions[2m > [22mshould support double negation[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mNOT conditions[2m > [22mshould negate composite conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Composite Conditions[2m > [22mComplex nested conditions[2m > [22mshould handle deeply nested AND/OR/NOT combinations[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Variable Resolution[2m > [22mshould resolve simple variable paths[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Variable Resolution[2m > [22mshould resolve dot notation paths[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Variable Resolution[2m > [22mshould resolve array indexing[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Variable Resolution[2m > [22mshould resolve nested array indexing with dot notation[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Variable Resolution[2m > [22mshould fall back to record data if variable not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Variable Resolution[2m > [22mshould prefer variable over record if both exist[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Variable Resolution[2m > [22mshould handle missing variables gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Validation[2m > [22mshould validate correct comparison condition[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Validation[2m > [22mshould reject missing operator[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Validation[2m > [22mshould reject invalid operand type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Validation[2m > [22mshould validate AND conditions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Validation[2m > [22mshould reject invalid AND structure[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Validation[2m > [22mshould validate nested conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Validation[2m > [22mshould propagate nested validation errors[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Edge Cases[2m > [22mshould handle type coercion in comparisons[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Edge Cases[2m > [22mshould handle case-insensitive string comparisons[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Edge Cases[2m > [22mshould handle whitespace trimming[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Edge Cases[2m > [22mshould handle invalid regex gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Edge Cases[2m > [22mshould handle comparison between two variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts[2m > [22mCondition System - Edge Cases[2m > [22mshould handle numeric string comparisons[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768088260276,"env":"test","module":"user-credentials-repository","userId":"817b5df3-5a38-4cfc-8936-c181a563ff8e","msg":"User credentials created"}
{"level":30,"time":1768088260387,"env":"test","module":"email-queue","jobId":"af23ecce-51d9-445b-9483-0b61b7381910","to":"user2-KOeuJ19Rag6sh6muQgQ0C@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts[2m > [22mPdfQueueService[2m > [22mTransaction Support[2m > [22mshould support convertImmediate within transaction[33m 743[2mms[22m[39m
{"level":30,"time":1768088260455,"env":"test","module":"auth-routes","userId":"817b5df3-5a38-4cfc-8936-c181a563ff8e","email":"user2-KOeuJ19Rag6sh6muQgQ0C@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22mCommentsPanel[2m > [22mshould render comments[32m 131[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22mCommentsPanel[2m > [22mshould show empty state when no comments[32m 76[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768088261048,"env":"test","module":"auth-routes","userId":"817b5df3-5a38-4cfc-8936-c181a563ff8e","msg":"User logged in successfully"}
stderr | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx > TableGridView - Drag & Drop > renders DndContext wrapper
Warning: validateDOMNesting(...): <th> cannot appear as a child of <div>.
    at th
    at SortableColumnHeader (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/SortableColumnHeader.tsx:12:33)
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
Warning: validateDOMNesting(...): <div> cannot appear as a child of <tr>.
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

{"level":30,"time":1768088261110,"env":"test","module":"audit-log-service","userId":"817b5df3-5a38-4cfc-8936-c181a563ff8e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mDatabase Transfer[2m > [22mshould allow org member to transfer org database[33m 1246[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould render database settings page with breadcrumbs[33m 483[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould show loading state[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould show not found state when database does not exist[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22mTableGridView - Drag & Drop[2m > [22mrenders DndContext wrapper[33m 476[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22mTableGridView - Drag & Drop[2m > [22mrenders SortableContext for columns[32m 186[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22mCommentsPanel[2m > [22mshould add a comment[33m 1025[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22mloads table schema and rows[33m 794[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22mrenders correct column headers[32m 62[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould render DatabaseSettings component with database data[32m 266[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22mdisplays empty state when no rows[32m 74[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould navigate back when back button is clicked[32m 163[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould display database name in header[32m 178[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22mCommentsPanel[2m > [22mshould allow comment owner to delete their comment[33m 308[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx[2m > [22mDatabaseSettingsPage[2m > [22mshould render sidebar[32m 120[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22mTableGridView - Drag & Drop[2m > [22mdisplays columns with type icons[32m 82[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx[2m > [22mCommentsPanel[2m > [22mshould not show delete button for other users comments[33m 401[2mms[22m[39m
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/Performance.test.ts[2m > [22mPerformance & Caching[2m > [22mQueryNode Caching[2m > [22mshould cache query results based on inputs[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/Performance.test.ts[2m > [22mPerformance & Caching[2m > [22mQueryNode Caching[2m > [22mshould invalidate cache when filters change[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/Performance.test.ts[2m > [22mPerformance & Caching[2m > [22mWriteNode Idempotency[2m > [22mshould prevent double execution in same run[32m 2[2mms[22m[39m
{"level":30,"time":1768088261821,"env":"test","module":"user-credentials-repository","userId":"7cb7c3dd-b1c6-428f-b981-4699448f0551","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mString Helpers[2m > [22mcapitalize[2m > [22mshould capitalize first letter[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mString Helpers[2m > [22mcapitalize[2m > [22mshould handle null/undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mString Helpers[2m > [22mtruncate[2m > [22mshould truncate long strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mString Helpers[2m > [22mtruncate[2m > [22mshould allow custom suffix[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mString Helpers[2m > [22mreplace[2m > [22mshould replace all occurrences[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mString Helpers[2m > [22mreplace[2m > [22mshould handle null/undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mjoin[2m > [22mshould join array elements[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mjoin[2m > [22mshould filter null values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mjoin[2m > [22mshould handle empty/null arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mlength[2m > [22mshould return array length[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mlength[2m > [22mshould return 0 for null/undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mfirst[2m > [22mshould return first element[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mfirst[2m > [22mshould return null for empty/null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mlast[2m > [22mshould return last element[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mArray Helpers[2m > [22mlast[2m > [22mshould return null for empty/null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mConditional Helpers[2m > [22misEmpty[2m > [22mshould detect empty values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mConditional Helpers[2m > [22misEmpty[2m > [22mshould detect non-empty values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mConditional Helpers[2m > [22misNotEmpty[2m > [22mshould be inverse of isEmpty[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mConditional Helpers[2m > [22mdefaultValue[2m > [22mshould return value if not empty[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mConditional Helpers[2m > [22mdefaultValue[2m > [22mshould return default if empty[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatDate[2m > [22mshould format dates with custom format[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatDate[2m > [22mshould handle ISO strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatDate[2m > [22mshould return empty for invalid dates[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatCurrency[2m > [22mshould format USD by default[32m 26[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatCurrency[2m > [22mshould format other currencies[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatCurrency[2m > [22mshould handle no symbol option[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatCurrency[2m > [22mshould handle null/undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatNumber[2m > [22mshould format with decimals[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatNumber[2m > [22mshould handle no thousands separator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mFormatting Helpers[2m > [22mformatNumber[2m > [22mshould handle null/undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mMath Helpers[2m > [22madd[2m > [22mshould add numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mMath Helpers[2m > [22msubtract[2m > [22mshould subtract numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mMath Helpers[2m > [22mmultiply[2m > [22mshould multiply numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mMath Helpers[2m > [22mdivide[2m > [22mshould divide numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mMath Helpers[2m > [22mdivide[2m > [22mshould handle division by zero[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mUtility Helpers[2m > [22mpluralize[2m > [22mshould pluralize based on count[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mUtility Helpers[2m > [22mpluralize[2m > [22mshould use custom plural form[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mdocxHelpers Object[2m > [22mshould export all helpers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts[2m > [22mDOCX Helpers[2m > [22mdocxHelpers Object[2m > [22mshould include helpers from formatters[32m 0[2mms[22m[39m
{"level":30,"time":1768088261928,"env":"test","module":"email-queue","jobId":"e173569f-7fac-4425-b346-16a68f6a270b","to":"protected-test-VFCBN9WM8IbiP3Lnl04W4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22mTableGridView - Drag & Drop[2m > [22mdisplays PK badge for primary key columns[33m 430[2mms[22m[39m
{"level":30,"time":1768088261984,"env":"test","module":"auth-routes","userId":"7cb7c3dd-b1c6-428f-b981-4699448f0551","email":"protected-test-VFCBN9WM8IbiP3Lnl04W4@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22menters edit mode on double click[33m 716[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mgenerateMasterKey[2m > [22mshould generate a valid base64-encoded 32-byte key[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mgenerateMasterKey[2m > [22mshould generate different keys each time[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mvalidateMasterKey[2m > [22mshould not throw error when master key is valid[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mvalidateMasterKey[2m > [22mshould throw error when master key is missing[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mvalidateMasterKey[2m > [22mshould throw error when master key is invalid base64[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mvalidateMasterKey[2m > [22mshould throw error when master key is wrong length[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould encrypt and decrypt a string successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould produce different ciphertext for same plaintext[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould handle empty strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould handle unicode characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould handle long strings[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould throw error when decrypting with wrong key[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould throw error when decrypting corrupted data[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould throw error when decrypting invalid base64[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mencrypt and decrypt[2m > [22mshould return base64-encoded ciphertext[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredact[2m > [22mshould redact non-empty strings[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredact[2m > [22mshould return (empty) for null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredact[2m > [22mshould return (empty) for undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredact[2m > [22mshould return (empty) for empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mmaskSecret[2m > [22mshould mask long secrets showing first and last 4 characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mmaskSecret[2m > [22mshould fully redact short secrets[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mmaskSecret[2m > [22mshould fully redact secrets with 8 or fewer characters[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mmaskSecret[2m > [22mshould handle empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredactObject[2m > [22mshould redact sensitive fields by default[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredactObject[2m > [22mshould redact custom sensitive keys[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredactObject[2m > [22mshould handle nested objects[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredactObject[2m > [22mshould not modify non-object values[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredactObject[2m > [22mshould handle case-insensitive matching[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts[2m > [22mEncryption Utilities[2m > [22mredactObject[2m > [22mshould handle partial matches in key names[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088262674,"env":"test","module":"auth-routes","userId":"7cb7c3dd-b1c6-428f-b981-4699448f0551","msg":"User logged in successfully"}
 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mDatabase Transfer[2m > [22mshould prevent transfer to org if user is not a member[33m 1544[2mms[22m[39m
{"level":30,"time":1768088262727,"env":"test","module":"audit-log-service","userId":"7cb7c3dd-b1c6-428f-b981-4699448f0551","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mMixed Auth Scenarios[2m > [22mshould prioritize Bearer token over cookie when both present[33m 3583[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088263301,"env":"test","module":"intake-service","runId":"df2d4889-c7b6-4ae7-a0ed-25ff68b3a958","slug":"public-gNOdw9qbsKWIvwXvHj3ha","msg":"Created intake run"}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mOptional Auth Routes[2m > [22mshould allow unauthenticated access to optional auth routes[33m 2148[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1768088263770,"env":"test","module":"rbac-middleware","path":"/api/workflows","permission":"workflow:create","msg":"Unauthenticated user attempted to access protected resource"}
{"level":30,"time":1768088263796,"env":"test","module":"user-credentials-repository","userId":"e98bf5a2-6998-463c-8935-b7cb260d25c9","msg":"User credentials created"}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768088263773,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permission":"workflow:create","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1768088263775,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"permission":"workflow:view","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1768088263777,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permissions":["workflow:create","workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (none of required permissions)"}
{"level":40,"time":1768088263778,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","permissions":["workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (missing some required permissions)"}
{"level":40,"time":1768088263787,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1768088263788,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"requiredRoles":["owner"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1768088263789,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","requiredRoles":["owner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768088263790,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"runner","requiredRoles":["owner","builder"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768088263792,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder","runner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768088263796,"env":"test","module":"rbac-middleware","path":"/api/test","permission":"workflow:view","msg":"Unauthenticated user attempted to access protected resource"}
{"level":40,"time":1768088263797,"env":"test","module":"rbac-middleware","userId":"user-123","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":40,"time":1768088263797,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"invalid-role","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mTransfer Validation[2m > [22mshould only allow transfer to self when targetOwnerType is user[33m 1071[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould return false for null role[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould return false for undefined role[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould allow owner to access all permissions (wildcard)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould allow builder to create workflows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould deny builder from deleting workflows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould allow runner to view and run workflows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould deny runner from editing workflows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould allow viewer only view permissions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould deny viewer from any edit/create/delete operations[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould allow builder to manage secrets[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mhasPermission()[2m > [22mshould deny builder from deleting secrets[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequirePermission()[2m > [22mshould return 401 if user is not authenticated[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequirePermission()[2m > [22mshould return 403 if user lacks required permission[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequirePermission()[2m > [22mshould call next() if user has required permission[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequirePermission()[2m > [22mshould allow owner to access any permission[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequirePermission()[2m > [22mshould return 403 for null userRole[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireAnyPermission()[2m > [22mshould allow if user has at least one permission[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireAnyPermission()[2m > [22mshould deny if user has none of the permissions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireAnyPermission()[2m > [22mshould allow owner with wildcard permission[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireAllPermissions()[2m > [22mshould allow if user has all required permissions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireAllPermissions()[2m > [22mshould deny if user is missing any permission[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireAllPermissions()[2m > [22mshould allow owner with wildcard permission[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireRole()[2m > [22mshould allow if user has required role[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireRole()[2m > [22mshould allow if user has one of multiple allowed roles[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireRole()[2m > [22mshould deny if user lacks required role[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mrequireRole()[2m > [22mshould deny if userRole is null[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireOwner[2m > [22mshould allow only owner role[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireOwner[2m > [22mshould deny builder role[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireBuilder[2m > [22mshould allow owner[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireBuilder[2m > [22mshould allow builder[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireBuilder[2m > [22mshould deny runner[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireRunner[2m > [22mshould allow owner[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireRunner[2m > [22mshould allow builder[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireRunner[2m > [22mshould allow runner[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mRole Shortcuts[2m > [22mrequireRunner[2m > [22mshould deny viewer[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mgetUserPermissions()[2m > [22mshould return empty array for unauthenticated request[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mgetUserPermissions()[2m > [22mshould return empty array for null userRole[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mgetUserPermissions()[2m > [22mshould return all permissions for owner[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mgetUserPermissions()[2m > [22mshould return builder permissions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mgetUserPermissions()[2m > [22mshould return runner permissions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mgetUserPermissions()[2m > [22mshould return viewer permissions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mEdge Cases[2m > [22mshould handle missing userId gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mEdge Cases[2m > [22mshould handle undefined userRole gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts[2m > [22mRBAC Middleware[2m > [22mEdge Cases[2m > [22mshould handle invalid role type gracefully[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22mTableGridView - Drag & Drop[2m > [22mcalls reorderColumns API when columns are reordered[32m 175[2mms[22m[39m
{"level":30,"time":1768088263905,"env":"test","module":"email-queue","jobId":"c3abc54f-a269-402b-97e4-733b1e2a37f3","to":"protected-test-XDdY3WquWlFuqT5CIA_wl@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768088263964,"env":"test","module":"auth-routes","userId":"e98bf5a2-6998-463c-8935-b7cb260d25c9","email":"protected-test-XDdY3WquWlFuqT5CIA_wl@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mshould validate required values[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mshould respect custom required message[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mshould skip other validation if value is empty and not required[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mNumeric Rules[2m > [22mshould validate minValue[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mNumeric Rules[2m > [22mshould validate maxValue[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mNumeric Rules[2m > [22mshould validate maxDecimalPlaces[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mString Rules[2m > [22mshould validate minLength[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mString Rules[2m > [22mshould validate maxLength[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mString Rules[2m > [22mshould validate email[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mString Rules[2m > [22mshould validate url[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mString Rules[2m > [22mshould validate pattern (regex)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mConditional Rules[2m > [22mshould pass if condition evaluates to true[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts[2m > [22mValidator[2m > [22mvalidateValue[2m > [22mConditional Rules[2m > [22mshould fail if condition evaluates to false[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould return error for empty required field[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould return error for null required field[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould return error for undefined required field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould return error for whitespace-only required field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould return error for empty array required field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould return error for empty object required field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould not return error for 0 value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould not return error for false value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mRequired validation[2m > [22mshould stop validation after required check fails[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mString length validation[2m > [22mshould validate minimum length[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mString length validation[2m > [22mshould validate maximum length[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mString length validation[2m > [22mshould pass when length is within bounds[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mString length validation[2m > [22mshould accept exact minimum length[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mString length validation[2m > [22mshould accept exact maximum length[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mString length validation[2m > [22mshould skip length validation for non-string values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mString length validation[2m > [22mshould skip validation for empty non-required fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mNumeric range validation[2m > [22mshould validate minimum value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mNumeric range validation[2m > [22mshould validate maximum value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mNumeric range validation[2m > [22mshould pass when value is within range[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mNumeric range validation[2m > [22mshould accept exact minimum value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mNumeric range validation[2m > [22mshould accept exact maximum value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mNumeric range validation[2m > [22mshould parse string numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mNumeric range validation[2m > [22mshould handle NaN gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEmail validation[2m > [22mshould validate correct email format[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEmail validation[2m > [22mshould reject email without @[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEmail validation[2m > [22mshould reject email without domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEmail validation[2m > [22mshould reject email without TLD[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEmail validation[2m > [22mshould accept email with subdomains[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEmail validation[2m > [22mshould accept email with plus addressing[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEmail validation[2m > [22mshould accept email with numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEmail validation[2m > [22mshould skip email validation for non-string values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mPattern (regex) validation[2m > [22mshould validate with valid pattern[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mPattern (regex) validation[2m > [22mshould reject invalid pattern[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mPattern (regex) validation[2m > [22mshould handle complex patterns[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mPattern (regex) validation[2m > [22mshould skip validation for invalid regex pattern[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mPattern (regex) validation[2m > [22mshould skip pattern validation for non-string values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mCustom validation[2m > [22mshould run custom validator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mCustom validation[2m > [22mshould handle custom validator returning null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mCustom validation[2m > [22mshould add custom error to other errors[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mMultiple validations[2m > [22mshould return multiple errors when multiple validations fail[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mMultiple validations[2m > [22mshould pass all validations when value is valid[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEdge cases[2m > [22mshould handle empty config[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEdge cases[2m > [22mshould handle null value with non-required field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidateField[2m > [22mEdge cases[2m > [22mshould handle undefined value with non-required field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidatePage[2m > [22mshould validate all visible steps[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidatePage[2m > [22mshould skip hidden steps[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidatePage[2m > [22mshould skip virtual steps[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidatePage[2m > [22mshould return valid result when all steps pass[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidatePage[2m > [22mshould count total errors correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidatePage[2m > [22mshould handle empty steps array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mvalidatePage[2m > [22mshould handle missing values for non-required steps[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mformatValidationErrors[2m > [22mshould format errors into string array[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mformatValidationErrors[2m > [22mshould return empty array for no errors[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mformatValidationErrors[2m > [22mshould handle errors with multiple messages[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mgetFieldError[2m > [22mshould return first error for field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mgetFieldError[2m > [22mshould return null when field has no errors[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mgetFieldError[2m > [22mshould return null for non-existent field[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mgetFieldError[2m > [22mshould return null when field has empty errors array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mEdge cases and robustness[2m > [22mshould handle very long strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mEdge cases and robustness[2m > [22mshould handle special characters in strings[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mEdge cases and robustness[2m > [22mshould handle unicode characters[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mEdge cases and robustness[2m > [22mshould handle negative numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mEdge cases and robustness[2m > [22mshould handle decimal numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mEdge cases and robustness[2m > [22mshould handle very large numbers[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mEdge cases and robustness[2m > [22mshould handle objects as values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts[2m > [22mvalidation[2m > [22mEdge cases and robustness[2m > [22mshould handle arrays as values[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22mTableGridView - Drag & Drop[2m > [22mdisplays columns in order based on orderIndex[33m 1921[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22mTableGridView - Drag & Drop[2m > [22mmaintains column order after successful reorder[33m 803[2mms[22m[39m
{"level":30,"time":1768088264706,"env":"test","module":"auth-routes","userId":"e98bf5a2-6998-463c-8935-b7cb260d25c9","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mValidation[2m > [22mshould validate min instances constraint[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mValidation[2m > [22mshould validate max instances constraint[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mValidation[2m > [22mshould validate required fields in instances[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mValidation[2m > [22mshould pass validation for valid repeater[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mValidation[2m > [22mshould handle null value as empty instances[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance management[2m > [22mshould create empty repeater with min instances[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance management[2m > [22mshould add instance to repeater[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance management[2m > [22mshould not add instance if max reached[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance management[2m > [22mshould remove instance from repeater[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance management[2m > [22mshould not remove instance if min would be violated[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance management[2m > [22mshould reorder instances[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mData flattening[2m > [22mshould flatten repeater data for variable resolution[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mData flattening[2m > [22mshould handle empty instances[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance title[2m > [22mshould generate instance title from template[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance title[2m > [22mshould use default template if not provided[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mInstance title[2m > [22mshould return empty string if showInstanceTitle is false[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mField visibility within instances[2m > [22mshould skip validation for hidden fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts[2m > [22mRepeaterService[2m > [22mField visibility within instances[2m > [22mshould require visible fields based on condition[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders text icon for text type[32m 60[2mms[22m[39m
{"level":30,"time":1768088264772,"env":"test","module":"audit-log-service","userId":"e98bf5a2-6998-463c-8935-b7cb260d25c9","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22mupdates cell value on blur[33m 2845[2mms[22m[39m
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts[2m > [22mTransfer Ownership[2m > [22mTransfer Validation[2m > [22mshould allow transfer from user to self (org member transferring org asset to themselves)[33m 1356[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders hash icon for number type[33m 509[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders hash icon for auto_number type[32m 30[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders toggle icon for boolean type[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders calendar icon for date type[32m 5[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders clock icon for datetime type[32m 187[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768088265316,"env":"test","module":"intake-service","runId":"8ac8f226-3e89-4e03-891d-97d169538761","slug":"optional-rer-nGI-66VaVrjv6tOHC","userId":"e98bf5a2-6998-463c-8935-b7cb260d25c9","msg":"Created intake run"}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders mail icon for email type[32m 197[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders phone icon for phone type[32m 93[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders link icon for url type[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders JSON icon for json type[32m 145[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders file icon for file_upload type[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/protected.routes.test.ts[2m > [22mProtected Routes Integration Tests[2m > [22mOptional Auth Routes[2m > [22mshould enhance optional auth routes with user context when authenticated[33m 2067[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mrenders default text icon for unknown type[32m 101[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mIcon Rendering[2m > [22mapplies custom className[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns blue color for text types[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns green color for number types[32m 5[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns purple color for boolean types[32m 161[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns orange color for date types[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns pink color for email type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns cyan color for phone type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns indigo color for url type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns yellow color for json type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns gray color for file_upload type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeColor Utility[2m > [22mreturns muted color for unknown type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeLabel Utility[2m > [22mreturns proper labels for all column types[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mgetColumnTypeLabel Utility[2m > [22mreturns the type itself for unknown types[32m 0[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mAccessibility[2m > [22mincludes aria-label with column type[32m 106[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx[2m > [22mColumnTypeIcon Component[2m > [22mAccessibility[2m > [22mhas proper icon size class[32m 84[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22mrenders Add Row button[32m 139[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22mrenders delete button for each row[33m 990[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22mhandles API errors gracefully[33m 307[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mBasic Operators[2m > [22mshould evaluate "email equals test@example.com" correctly[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mBasic Operators[2m > [22mshould evaluate "age greater_than 18" correctly[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mBasic Operators[2m > [22mshould evaluate "optional_notes is_empty" correctly[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mBasic Operators[2m > [22mshould evaluate "status not_equals pending" correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mBasic Operators[2m > [22mshould evaluate "description contains urgent" correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mVariable References[2m > [22mshould evaluate "confirm_email equals email" correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mDatabase Round-Trip[2m > [22mshould survive JSON serialization/deserialization (JSONB storage)[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mUI Compatibility[2m > [22mshould pass Zod schema validation (same validation used by UI)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mUI Compatibility[2m > [22mshould handle all common operators used by UI[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mComplete Round-Trip Test[2m > [22mshould handle full lifecycle: Create Î“Ã¥Ã† Validate Î“Ã¥Ã† Store Î“Ã¥Ã† Retrieve Î“Ã¥Ã† Evaluate Î“Ã¥Ã† Edit[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mEdge Cases[2m > [22mshould handle null vs empty string correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mEdge Cases[2m > [22mshould handle case-insensitive string comparison[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mEdge Cases[2m > [22mshould handle number coercion[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mEdge Cases[2m > [22mshould handle array includes operations[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mEdge Cases[2m > [22mshould handle boolean operators[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mReal-World Scenarios[2m > [22mshould handle emergency contact visibility (has_emergency_contact equals true)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mReal-World Scenarios[2m > [22mshould handle age-gated content (age greater_or_equal 18)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts[2m > [22mAI-Generated Condition Evaluation (Round-Trip Compatibility)[2m > [22mReal-World Scenarios[2m > [22mshould handle conditional required field (email is_not_empty)[32m 0[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetDuplicateColumns[2m > [22mshould detect duplicate column IDs[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetDuplicateColumns[2m > [22mshould return empty array when no duplicates[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetDuplicateColumns[2m > [22mshould detect multiple duplicate columns[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetMissingRequiredColumns[2m > [22mshould detect missing required columns[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetMissingRequiredColumns[2m > [22mshould return empty array when all required columns mapped[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetIncompleteRows[2m > [22mshould detect rows with missing column[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetIncompleteRows[2m > [22mshould detect rows with missing value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetIncompleteRows[2m > [22mshould detect rows with both missing[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mgetIncompleteRows[2m > [22mshould return empty array for complete rows[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mWriteBlockConfig validation scenarios[2m > [22mshould validate update mode requires match strategy[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mWriteBlockConfig validation scenarios[2m > [22mshould validate upsert mode requires match strategy[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx[2m > [22mSendDataToTableBlockEditor Validation[2m > [22mWriteBlockConfig validation scenarios[2m > [22mshould validate create mode does not require match strategy[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSend Data Block Editor Routing[2m > [22mshould identify write block correctly[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSend Data Block Editor Routing[2m > [22mshould identify read block correctly[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSend Data Block Editor Routing[2m > [22mshould fail if write block has read_table type[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSend Data Block Editor Routing[2m > [22mshould have correct config structure for write block[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSend Data Block Editor Routing[2m > [22mshould have correct config structure for read block[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSendDataToTableBlockEditor Config Validation[2m > [22mshould require columnMappings array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSendDataToTableBlockEditor Config Validation[2m > [22mshould validate required columns are mapped[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSendDataToTableBlockEditor Config Validation[2m > [22mshould detect duplicate column mappings[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSendDataToTableBlockEditor Config Validation[2m > [22mshould require match strategy for update mode[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts[2m > [22mSendDataToTableBlockEditor Config Validation[2m > [22mshould allow create mode without match strategy[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx[2m > [22mTableGridView[2m > [22msorts columns by orderIndex[33m 752[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mequals operator[2m > [22mshould return true for exact string match[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mequals operator[2m > [22mshould return false for non-matching string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mequals operator[2m > [22mshould handle numeric equality[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mnot_equals operator[2m > [22mshould return true for different values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mnot_equals operator[2m > [22mshould return false for same values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mcontains operator[2m > [22mshould find substring in string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mcontains operator[2m > [22mshould find item in array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mcontains operator[2m > [22mshould return false when not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mgreater_than operator[2m > [22mshould return true for greater number[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mgreater_than operator[2m > [22mshould return false for equal or smaller number[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mless_than operator[2m > [22mshould return true for smaller number[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mless_than operator[2m > [22mshould return false for equal or larger number[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mbetween operator[2m > [22mshould return true for value in range[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mbetween operator[2m > [22mshould return true for value at boundaries (inclusive)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mbetween operator[2m > [22mshould return false for value outside range[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mis_empty operator[2m > [22mshould return true for null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mis_empty operator[2m > [22mshould return true for undefined[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mis_empty operator[2m > [22mshould return true for empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mis_empty operator[2m > [22mshould return false for non-empty values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mis_not_empty operator[2m > [22mshould return true for non-empty string[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateCondition[2m > [22mis_not_empty operator[2m > [22mshould return false for null/undefined/empty[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateConditionalLogic[2m > [22mshould show question by default with no conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateConditionalLogic[2m > [22mshould apply show action when condition is met[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateConditionalLogic[2m > [22mshould hide question when show condition is not met[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateConditionalLogic[2m > [22mshould apply hide action when condition is met[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateConditionalLogic[2m > [22mshould make question required when require action is met[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateConditionalLogic[2m > [22mshould make question optional when make_optional action is met[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateConditionalLogic[2m > [22mshould handle multiple conditions with AND logic[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts[2m > [22mconditionalLogic[2m > [22mevaluateConditionalLogic[2m > [22mshould handle multiple conditions with OR logic[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic-simple.test.ts[2m > [22mTest Infrastructure[2m > [22mshould run basic tests[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic-simple.test.ts[2m > [22mTest Infrastructure[2m > [22mshould handle arrays[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic-simple.test.ts[2m > [22mTest Infrastructure[2m > [22mshould handle objects[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/RunExecutionCoordinator.test.ts[2m > [22mRunExecutionCoordinator - JS Execution[2m > [22mshould execute JS questions using ScriptEngine[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RunExecutionCoordinator.test.ts[2m > [22mRunExecutionCoordinator - JS Execution[2m > [22mshould handle ScriptEngine errors gracefully[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflow/QueryBlock.test.ts[2m > [22mRepeaterService List Integration[2m > [22mshould create instances from ListVariable[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflow/QueryBlock.test.ts[2m > [22mRepeaterService List Integration[2m > [22mshould respect maxInstances with list[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflow/QueryBlock.test.ts[2m > [22mRepeaterService List Integration[2m > [22mshould handle empty list[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowOptimizationService.test.ts[2m > [22mWorkflowOptimizationService[2m > [22mshould calculate metrics[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/WorkflowOptimizationService.test.ts[2m > [22mWorkflowOptimizationService[2m > [22mshould detect long pages[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/WorkflowOptimizationService.test.ts[2m > [22mWorkflowOptimizationService[2m > [22mshould auto-fix long pages (simulate split)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/WorkflowOptimizationService.test.ts[2m > [22mWorkflowOptimizationService[2m > [22mshould detect duplicate questions[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m > [22mStep Config Schemas[2m > [22mgetConfigSchema[2m > [22mshould return schema for known types[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m > [22mStep Config Schemas[2m > [22mgetConfigSchema[2m > [22mshould return undefined for unknown types[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m > [22mStep Config Schemas[2m > [22mvalidateStepConfig[2m > [22mshould validate valid config[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m > [22mStep Config Schemas[2m > [22mvalidateStepConfig[2m > [22mshould fail invalid config (missing required fields)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m > [22mStep Config Schemas[2m > [22mvalidateStepConfig[2m > [22mshould pass through if no schema exists[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m > [22mStep Config Schemas[2m > [22mSpecific Schema Validations[2m > [22mFinalBlockConfigSchema[2m > [22mshould enforce unique aliases[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m > [22mStep Config Schemas[2m > [22mSpecific Schema Validations[2m > [22mChoiceAdvancedConfigSchema[2m > [22mshould require at least one option[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts[2m > [22mStep Config Schemas[2m > [22mSpecific Schema Validations[2m > [22mChoiceAdvancedConfigSchema[2m > [22mshould validate valid options[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts[2m > [22mWorkflowChangeAnalyzer[2m > [22mshould classify unused variable deletion as soft breaking (or safe context dependent)[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts[2m > [22mWorkflowChangeAnalyzer[2m > [22mshould classify used variable deletion as HARD breaking (JS Block)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts[2m > [22mWorkflowChangeAnalyzer[2m > [22mshould classify used variable deletion as HARD breaking (Alias reference)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts[2m > [22mWorkflowChangeAnalyzer[2m > [22mshould classify new required variable as SOFT breaking[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts[2m > [22mWorkflowChangeAnalyzer[2m > [22mshould classify type change as HARD breaking[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperand[2m > [22mshould resolve alias to key[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperand[2m > [22mshould return key if operand is already a key[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperand[2m > [22mshould return operand as-is if not found (for validation to catch)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperand[2m > [22mshould handle empty operand[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperand[2m > [22mshould handle null-like operands[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperand[2m > [22mshould be case-sensitive for aliases[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperands[2m > [22mshould resolve multiple aliases to keys[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperands[2m > [22mshould handle mix of aliases and keys[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperands[2m > [22mshould handle empty array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mresolveOperands[2m > [22mshould preserve unknown operands[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mgetVariable[2m > [22mshould find variable by key[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mgetVariable[2m > [22mshould find variable by alias[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mgetVariable[2m > [22mshould return undefined if not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mgetVariable[2m > [22mshould prioritize key match over alias match[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22mgetVariable[2m > [22mshould handle variable with null alias[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22misValidOperand[2m > [22mshould return true for valid alias[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22misValidOperand[2m > [22mshould return true for valid key[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22misValidOperand[2m > [22mshould return false for invalid operand[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22misValidOperand[2m > [22mshould return false for empty operand[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts[2m > [22mVariableResolver[2m > [22misValidOperand[2m > [22mshould validate against empty variables array[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Setup[2m > [22mgenerateTotpSecret()[2m > [22mshould generate TOTP secret, QR code, and backup codes[33m 444[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Setup[2m > [22mgenerateTotpSecret()[2m > [22mshould throw error if secret generation fails[32m 3[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [31mâ”œÃ¹[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mextractPlaceholdersFromDocx[2m > [22mshould extract placeholders from a template[32m 43[2mms[22m[39m
[31m   Î“Ã¥Ã† Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found[39m
 [31mâ”œÃ¹[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mextractPlaceholdersFromDocx[2m > [22mshould extract placeholders including formatters[32m 1[2mms[22m[39m
[31m   Î“Ã¥Ã† Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\formatters-template.docx' not found[39m
 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mextractPlaceholdersFromDocx[2m > [22mshould throw error if template does not exist[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mvalidateTemplateData[2m > [22mshould validate complete data[32m 2[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mvalidateTemplateData[2m > [22mshould detect missing data[32m 56[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mvalidateTemplateData[2m > [22mshould allow formatters as valid placeholders[32m 1[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould render a template with simple data[32m 21[2mms[22m[39m
[31m   Î“Ã¥Ã† Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found[39m
 [31mâ”œÃ¹[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould use formatters in templates[32m 3[2mms[22m[39m
[31m   Î“Ã¥Ã† Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\formatters-template.docx' not found[39m
 [31mâ”œÃ¹[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould handle missing data gracefully[32m 22[2mms[22m[39m
[31m   Î“Ã¥Ã† Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found[39m
 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould throw error if template does not exist[32m 2[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mrenderDocx[2m > [22mshould use custom output name[32m 36[2mms[22m[39m
[31m   Î“Ã¥Ã† Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found[39m
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mâ”œÃ¹[39m tests/unit/docxRenderer.test.ts[2m > [22mDOCX Renderer Service[2m > [22mPDF conversion[2m > [22mshould attempt PDF conversion when requested[32m 22[2mms[22m[39m
[31m   Î“Ã¥Ã† Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Setup[2m > [22mgenerateTotpSecret()[2m > [22mshould generate unique backup codes[33m 487[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Setup[2m > [22mverifyAndEnableMfa()[2m > [22mshould verify TOTP code and enable MFA[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Setup[2m > [22mverifyAndEnableMfa()[2m > [22mshould return false if no MFA secret found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Setup[2m > [22mverifyAndEnableMfa()[2m > [22mshould return false if TOTP code is invalid[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Verification[2m > [22mverifyTotp()[2m > [22mshould verify valid TOTP code[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Verification[2m > [22mverifyTotp()[2m > [22mshould return false for invalid TOTP code[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Verification[2m > [22mverifyTotp()[2m > [22mshould return false if MFA is not enabled[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Verification[2m > [22mverifyTotp()[2m > [22mshould use 2-step window for time tolerance[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Verification[2m > [22misMfaEnabled()[2m > [22mshould return true if MFA is enabled[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Verification[2m > [22misMfaEnabled()[2m > [22mshould return false if MFA is disabled[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mTOTP Verification[2m > [22misMfaEnabled()[2m > [22mshould return false if user not found[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mBackup Codes[2m > [22mverifyBackupCode()[2m > [22mshould verify and consume valid backup code[32m 192[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/analytics_preservation.test.ts[2m > [22mAnalytics Preservation[2m > [22mshould preserve lifetime user count when a user is deleted[33m 495[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mBackup Codes[2m > [22mverifyBackupCode()[2m > [22mshould return false for invalid backup code[32m 164[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mBackup Codes[2m > [22mverifyBackupCode()[2m > [22mshould return false if no unused backup codes[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts[2m > [22m[2mDatavaultColumnsService[2m > [22m[2mgetColumns[2m > [22m[2mshould throw 404 if table not found
[22m[39m[DEBUG] Table not found: 660e8400-e29b-41d4-a716-446655440001

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mgetColumns[2m > [22mshould get all columns for a table[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mgetColumns[2m > [22mshould throw 404 if table not found[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mcreateColumn[2m > [22mshould create column with generated slug[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mcreateColumn[2m > [22mshould ensure unique slug by appending counter[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mcreateColumn[2m > [22mshould use provided slug if given[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mupdateColumn[2m > [22mshould update column[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mupdateColumn[2m > [22mshould throw error if trying to change column type[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mdeleteColumn[2m > [22mshould delete column[32m 104[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mreorderColumns[2m > [22mshould reorder columns[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mselect/multiselect columns[2m > [22mshould create select column with valid options[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mselect/multiselect columns[2m > [22mshould create multiselect column with valid options[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mselect/multiselect columns[2m > [22mshould reject select column without options[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mselect/multiselect columns[2m > [22mshould reject options with duplicate values[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts[2m > [22mDatavaultColumnsService[2m > [22mselect/multiselect columns[2m > [22mshould reject options without label or value[32m 1[2mms[22m[39m
{"level":50,"time":1768088273125,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768088273126,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating skipIf condition"}
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mBasic navigation (no conditions)[2m > [22mshould return all pages in order when no conditions[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mBasic navigation (no conditions)[2m > [22mshould handle empty workflow[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mBasic navigation (no conditions)[2m > [22mshould calculate correct current page index[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mvisibleIf conditions[2m > [22mshould hide pages when visibleIf is false[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mvisibleIf conditions[2m > [22mshould show pages when visibleIf is true[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mvisibleIf conditions[2m > [22mshould handle complex visibleIf conditions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mskipIf conditions[2m > [22mshould skip pages when skipIf is true[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mskipIf conditions[2m > [22mshould not skip pages when skipIf is false[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mCombined visibleIf and skipIf[2m > [22mshould apply visibleIf before skipIf[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mHelper methods[2m > [22mshould get first page[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mHelper methods[2m > [22mshould return null for first page if all pages hidden[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mHelper methods[2m > [22mshould validate page navigability[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mHelper methods[2m > [22mshould get page sequence[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mError handling[2m > [22mshould default to visible on visibleIf evaluation error[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mError handling[2m > [22mshould default to not skipping on skipIf evaluation error[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mProgress calculation[2m > [22mshould calculate correct progress for multi-page workflow[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts[2m > [22mIntakeNavigationService[2m > [22mProgress calculation[2m > [22mshould adjust progress when pages are skipped[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mvalidateTemplateWithData[2m > [22mshould validate complete data[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mvalidateTemplateWithData[2m > [22mshould detect missing variables[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mvalidateTemplateWithData[2m > [22mshould detect type mismatches[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mvalidateTemplateWithData[2m > [22mshould calculate coverage percentage[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mvalidateTemplateWithData[2m > [22mshould handle empty template variables[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mgenerateSampleData[2m > [22mshould generate date values for date fields[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mgenerateSampleData[2m > [22mshould generate numeric values for amount fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mgenerateSampleData[2m > [22mshould generate boolean values for boolean fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mgenerateSampleData[2m > [22mshould generate email for email fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mgenerateSampleData[2m > [22mshould generate arrays for loop variables[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mcompareTemplates[2m > [22mshould identify added variables[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mcompareTemplates[2m > [22mshould identify removed variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mcompareTemplates[2m > [22mshould identify unchanged variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mPlaceholder Extraction[2m > [22mshould extract simple variables[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mPlaceholder Extraction[2m > [22mshould extract loop variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mPlaceholder Extraction[2m > [22mshould extract conditional variables[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mPlaceholder Extraction[2m > [22mshould extract helper calls[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mPlaceholder Extraction[2m > [22mshould handle nested paths[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mLoop Depth Calculation[2m > [22mshould calculate simple loop depth[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mLoop Depth Calculation[2m > [22mshould calculate nested loop depth[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mLoop Depth Calculation[2m > [22mshould handle deeply nested loops[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mLoop Depth Calculation[2m > [22mshould return 0 for no loops[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mValidation Warnings[2m > [22mshould warn about type mismatches[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mValidation Warnings[2m > [22mshould warn about empty arrays[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mValidation Warnings[2m > [22mshould categorize warning severities[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mHelper Function Detection[2m > [22mshould detect helper usage[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts[2m > [22mTemplateAnalysisService[2m > [22mStatistics Calculation[2m > [22mshould calculate template statistics[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mMOCK SETUP DONE. Mock questions: [
  {
    id: [32m'q1'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q1'[39m,
    order: [33m0[39m,
    isVirtual: [33mfalse[39m,
    alias: [32m'show'[39m,
    visibleIf: [1mnull[22m
  },
  {
    id: [32m'q2'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q2'[39m,
    order: [33m1[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: { op: [32m'equals'[39m, left: [36m[Object][39m, right: [36m[Object][39m }
  },
  {
    id: [32m'q3'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q3'[39m,
    order: [33m2[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: [1mnull[22m
  }
]
Calling getVisibleQuestionCount...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mCOUNT RESULT: [33m0[39m
Mock called times: [33m1[39m
Mock last call args: [ [ [32m'section1'[39m ] ]

{"level":50,"time":1768088273276,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mBasic visibility (no conditions)[2m > [22mshould return all questions as visible when no conditions[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mBasic visibility (no conditions)[2m > [22mshould exclude virtual steps from visibility evaluation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mBasic visibility (no conditions)[2m > [22mshould maintain question order[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mvisibleIf conditions[2m > [22mshould hide questions when visibleIf is false[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mvisibleIf conditions[2m > [22mshould show questions when visibleIf is true[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mvisibleIf conditions[2m > [22mshould handle complex visibleIf conditions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mvisibleIf conditions[2m > [22mshould handle OR conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mvisibleIf conditions[2m > [22mshould handle NOT conditions[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mValidation filtering[2m > [22mshould include visible required questions in validation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mValidation filtering[2m > [22mshould skip hidden questions in validation[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mHelper methods[2m > [22mshould check if question is visible[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mHelper methods[2m > [22mshould get visible question count[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mHidden question value clearing[2m > [22mshould clear values for hidden questions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mHidden question value clearing[2m > [22mshould not clear values for visible questions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mValidation warnings[2m > [22mshould warn if required question has visibility condition[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mValidation warnings[2m > [22mshould warn if virtual step has visibility condition[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mValidation warnings[2m > [22mshould return no warnings for valid configuration[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mError handling[2m > [22mshould default to visible on condition evaluation error[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22mIntakeQuestionVisibilityService[2m > [22mCascading visibility[2m > [22mshould handle questions that depend on each other[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mBackup Codes[2m > [22mverifyBackupCode()[2m > [22mshould try multiple codes if first doesn't match[33m 577[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mBackup Codes[2m > [22mregenerateBackupCodes()[2m > [22mshould generate new backup codes[32m 199[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1768088273665,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088273667,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768088273668,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":66,"totalTokens":878,"durationMs":1,"estimatedCostUSD":0.00010760000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768088273671,"env":"test","module":"ai-service","duration":5,"workflowId":"123","changeCount":1,"msg":"AI workflow revision succeeded"}
{"level":30,"time":1768088273674,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768088273674,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768088273674,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":45,"totalTokens":857,"durationMs":0,"estimatedCostUSD":0.00009920000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768088273674,"env":"test","module":"ai-service","duration":0,"workflowId":"123","changeCount":0,"msg":"AI workflow revision succeeded"}
{"level":30,"time":1768088273675,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768088273675,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768088273676,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":1,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1768088273676,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1768088273676,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1768088273676,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":1,"msg":"AI workflow revision failed"}
{"level":40,"time":1768088273676,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"actualOutputTokens":4,"responseLength":13,"msg":"Single-shot revision truncated - automatically retrying with chunking"}
{"level":30,"time":1768088273677,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768088273677,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1768088273677,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1768088273677,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1768088273677,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":0,"msg":"AI workflow revision failed"}
{"level":50,"time":1768088273677,"env":"test","module":"ai-service","duration":2,"error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"msg":"AI workflow revision failed"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AIService.test.ts[2m > [22mAIService Unit Tests[2m > [22mreviseWorkflow should parse valid JSON response correctly[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AIService.test.ts[2m > [22mAIService Unit Tests[2m > [22mreviseWorkflow should handle JSON markdown code blocks[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AIService.test.ts[2m > [22mAIService Unit Tests[2m > [22mreviseWorkflow should throw on invalid JSON[32m 3[2mms[22m[39m
[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mBackup Codes[2m > [22mregenerateBackupCodes()[2m > [22mshould generate unique codes[32m 261[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mBackup Codes[2m > [22mgetRemainingBackupCodesCount()[2m > [22mshould return count of unused backup codes[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mBackup Codes[2m > [22mgetRemainingBackupCodesCount()[2m > [22mshould return 0 if all codes are used[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mDisable MFA[2m > [22mdisableMfa()[2m > [22mshould disable MFA and delete backup codes[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts[2m > [22mMfaService[2m > [22mDisable MFA[2m > [22madminResetMfa()[2m > [22mshould reset MFA and delete secret[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1768088273859,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mverifyOwnership[2m > [22mshould return workflow if user is the creator[33m 1904[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mverifyOwnership[2m > [22mshould throw error if workflow not found[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mverifyOwnership[2m > [22mshould throw error if user is not the creator[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mcreateWorkflow[2m > [22mshould create workflow with default first section[32m 4[2mms[22m[39m
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mgetWorkflowWithDetails[2m > [22mshould return workflow with sections, steps, and logic rules[32m 190[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mgetWorkflowWithDetails[2m > [22mshould throw error if user does not own workflow[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mlistWorkflows[2m > [22mshould return all workflows for a user[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mlistWorkflows[2m > [22mshould return empty array if user has no workflows[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mupdateWorkflow[2m > [22mshould update workflow if user is the owner[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mupdateWorkflow[2m > [22mshould throw error if user does not own workflow[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mdeleteWorkflow[2m > [22mshould delete workflow if user is the owner[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mdeleteWorkflow[2m > [22mshould throw error if user does not own workflow[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mchangeStatus[2m > [22mshould change workflow status to active[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mchangeStatus[2m > [22mshould change workflow status to archived[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts[2m > [22mWorkflowService[2m > [22mchangeStatus[2m > [22mshould throw error if user does not own workflow[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mfindByTenantId[2m > [22mshould find tables by tenant ID[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mfindByTenantId[2m > [22mshould return empty array if no tables found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mfindById[2m > [22mshould find table by ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mfindById[2m > [22mshould return undefined if table not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mslugExists[2m > [22mshould return true if slug exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mslugExists[2m > [22mshould return false if slug does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mslugExists[2m > [22mshould exclude specific table ID when checking slug[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mcreate[2m > [22mshould create a new table[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mupdate[2m > [22mshould update an existing table[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mdelete[2m > [22mshould delete a table[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mcountByTenantId[2m > [22mshould count tables by tenant ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts[2m > [22mDatavaultTablesRepository[2m > [22mcountByTenantId[2m > [22mshould return 0 if no tables found[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mTemplates Table[2m > [22mshould have correct table name[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mTemplates Table[2m > [22mshould have required columns[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mWorkflowTemplates Table[2m > [22mshould have correct table name[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mWorkflowTemplates Table[2m > [22mshould have required columns[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mRunOutputs Table[2m > [22mshould have correct table name[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mRunOutputs Table[2m > [22mshould have required columns[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mOutput Status Enum[2m > [22mshould have all expected status values[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mOutput File Type Enum[2m > [22mshould have all expected file type values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertTemplateSchema[2m > [22mshould validate valid template data[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertTemplateSchema[2m > [22mshould require projectId, name, fileRef, and type[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertTemplateSchema[2m > [22mshould allow description to be null[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertWorkflowTemplateSchema[2m > [22mshould validate valid workflow template mapping[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertWorkflowTemplateSchema[2m > [22mshould require workflowVersionId, templateId, and key[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertWorkflowTemplateSchema[2m > [22mshould default isPrimary to false[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertWorkflowTemplateSchema[2m > [22mshould validate template key formats[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertRunOutputSchema[2m > [22mshould validate valid run output data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertRunOutputSchema[2m > [22mshould require runId, workflowVersionId, templateKey, fileType, storagePath, and status[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertRunOutputSchema[2m > [22mshould validate file type enum[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertRunOutputSchema[2m > [22mshould reject invalid file type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertRunOutputSchema[2m > [22mshould validate status enum[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertRunOutputSchema[2m > [22mshould reject invalid status[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertRunOutputSchema[2m > [22mshould allow error to be null[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mInsert Schemas[2m > [22minsertRunOutputSchema[2m > [22mshould allow error message for failed outputs[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mSchema Constraints[2m > [22mshould enforce unique key per workflow version[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mSchema Constraints[2m > [22mshould cascade delete workflow templates when workflow version is deleted[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mSchema Constraints[2m > [22mshould cascade delete workflow templates when template is deleted[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mSchema Constraints[2m > [22mshould cascade delete run outputs when run is deleted[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mSchema Constraints[2m > [22mshould cascade delete run outputs when workflow version is deleted[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mType Inference[2m > [22mshould correctly infer Template type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mType Inference[2m > [22mshould correctly infer WorkflowTemplate type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mType Inference[2m > [22mshould correctly infer RunOutput type[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mMulti-Template Scenarios[2m > [22mshould support multiple templates per workflow version[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts[2m > [22mDocument Engine 2.0 Schema[2m > [22mMulti-Template Scenarios[2m > [22mshould support multiple outputs per run[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mfindByTableId[2m > [22mshould find columns by table ID in order[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mfindByTableId[2m > [22mshould return empty array if no columns found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mfindById[2m > [22mshould find column by ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mfindById[2m > [22mshould return undefined if column not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mslugExists[2m > [22mshould return true if slug exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mslugExists[2m > [22mshould return false if slug does not exist[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mslugExists[2m > [22mshould exclude specific column ID when checking slug[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mcreate[2m > [22mshould create a new column[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mupdate[2m > [22mshould update an existing column[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mdelete[2m > [22mshould delete a column[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mreorderColumns[2m > [22mshould update order indices for multiple columns[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mgetMaxOrderIndex[2m > [22mshould return max order index[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts[2m > [22mDatavaultColumnsRepository[2m > [22mgetMaxOrderIndex[2m > [22mshould return 0 if no columns exist[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mfindByProjectId[2m > [22mshould find templates by project ID[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mfindByProjectId[2m > [22mshould return empty array when no templates found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mfindByType[2m > [22mshould find templates by type[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mfindByIdAndProjectId[2m > [22mshould find template by ID and project ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mfindByIdAndProjectId[2m > [22mshould return undefined when template not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mupdateMetadata[2m > [22mshould update template name and description[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mupdateMetadata[2m > [22mshould return undefined when template not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mupdateFileRef[2m > [22mshould update template file reference[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mdeleteByIdAndProjectId[2m > [22mshould delete template and return true[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mdeleteByIdAndProjectId[2m > [22mshould return false when template not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mexistsByNameInProject[2m > [22mshould return true when template name exists[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mexistsByNameInProject[2m > [22mshould return false when template name does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mexistsByNameInProject[2m > [22mshould exclude specific template ID when checking existence[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mcreate[2m > [22mshould create a new template[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts[2m > [22mDocumentTemplateRepository[2m > [22mfindById[2m > [22mshould find template by ID[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768088277789,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts[2m > [22mQueryRunner[2m > [22mshould throw if tableId is missing[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts[2m > [22mQueryRunner[2m > [22mshould execute basic query and return ListVariable[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts[2m > [22mQueryRunner[2m > [22mshould resolve variable filters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts[2m > [22mQueryRunner[2m > [22mshould throw for missing variables[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts[2m > [22mQueryRunner[2m > [22mshould apply limit[32m 2[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould create record with valid data[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould throw error if required field is missing[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould apply default values to missing fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould throw error for unknown field[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould validate field type (text)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould validate field type (number)[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould validate select field options[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould validate multi-select field options[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mcreateRecord[2m > [22mshould allow null for non-required fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mverifyRecordOwnership[2m > [22mshould return record if tenant owns it[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mverifyRecordOwnership[2m > [22mshould throw error if record not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mverifyRecordOwnership[2m > [22mshould throw error if tenant does not own record[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mupdateRecord[2m > [22mshould update record with valid data[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mupdateRecord[2m > [22mshould merge updates with existing data[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mlistRecords[2m > [22mshould list records in collection with pagination[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mlistRecords[2m > [22mshould throw error if collection does not belong to tenant[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts[2m > [22mRecordService[2m > [22mbulkCreateRecords[2m > [22mshould create multiple records[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1768088280216,"env":"test","sourceListVar":"nonexistent_list","inputKey":"nonexistent_list","msg":"Input list not found, treating as empty array"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mFilter Operations[2m > [22mshould filter rows by equals condition[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mFilter Operations[2m > [22mshould filter with greater_than operator[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mFilter Operations[2m > [22mshould filter with AND combinator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mFilter Operations[2m > [22mshould filter with OR combinator[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mSort Operations[2m > [22mshould sort by single key ascending[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mSort Operations[2m > [22mshould sort by single key descending[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mSort Operations[2m > [22mshould sort by multiple keys[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mRange Operations[2m > [22mshould apply limit[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mRange Operations[2m > [22mshould apply offset[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mRange Operations[2m > [22mshould apply offset and limit together[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mSelect Operations[2m > [22mshould select specific columns[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mDedupe Operations[2m > [22mshould deduplicate by field[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mDerived Outputs[2m > [22mshould output count variable[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mDerived Outputs[2m > [22mshould output first row variable[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mComprehensive Pipeline[2m > [22mshould apply all operations in sequence[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mEdge Cases[2m > [22mshould handle empty input list[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mEdge Cases[2m > [22mshould handle missing source list[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts[2m > [22mList Tools Block[2m > [22mEdge Cases[2m > [22mshould handle plain arrays[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingByTenantId[2m > [22mshould return branding for a tenant[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingByTenantId[2m > [22mshould return null for non-existent tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mupdateBranding[2m > [22mshould update tenant branding[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mupdateBranding[2m > [22mshould merge partial branding with existing branding[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingForDomain[2m > [22mshould return tenant and branding for a valid domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingForDomain[2m > [22mshould return null for non-existent domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetDomainsByTenantId[2m > [22mshould return all domains for a tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetDomainsByTenantId[2m > [22mshould return empty array for tenant with no domains[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22maddDomain[2m > [22mshould add a new domain to a tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22maddDomain[2m > [22mshould normalize domain to lowercase[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22maddDomain[2m > [22mshould throw error for duplicate domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mremoveDomain[2m > [22mshould remove a domain from a tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mremoveDomain[2m > [22mshould return false for non-existent domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mremoveDomain[2m > [22mshould throw error when domain does not belong to tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22misDomainAvailable[2m > [22mshould return true for available domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22misDomainAvailable[2m > [22mshould return false for taken domain[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mlistTables[2m > [22mshould get all tables for a tenant[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mlistTablesWithStats[2m > [22mshould get tables with stats[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mgetTable[2m > [22mshould get a table by ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mgetTable[2m > [22mshould throw 404 if table not found[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mgetTable[2m > [22mshould throw 403 if table belongs to different tenant[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mcreateTable[2m > [22mshould create table with generated slug[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mcreateTable[2m > [22mshould ensure unique slug by appending counter[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mcreateTable[2m > [22mshould use provided slug if given[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mupdateTable[2m > [22mshould update table[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mupdateTable[2m > [22mshould throw 404 if table not found[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mdeleteTable[2m > [22mshould delete table[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts[2m > [22mDatavaultTablesService[2m > [22mdeleteTable[2m > [22mshould throw 404 if table not found[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mGET /api/tenants/:tenantId/branding[2m > [22mshould return null branding for new tenant[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mGET /api/tenants/:tenantId/branding[2m > [22mshould return existing branding configuration[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mGET /api/tenants/:tenantId/branding[2m > [22mshould return 404 for non-existent tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mGET /api/tenants/:tenantId/branding[2m > [22mshould require authentication[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPATCH /api/tenants/:tenantId/branding[2m > [22mshould update tenant branding with valid data[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPATCH /api/tenants/:tenantId/branding[2m > [22mshould merge partial updates with existing branding[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPATCH /api/tenants/:tenantId/branding[2m > [22mshould reject invalid color format[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPATCH /api/tenants/:tenantId/branding[2m > [22mshould reject invalid email address[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPATCH /api/tenants/:tenantId/branding[2m > [22mshould require tenant:update permission[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mGET /api/tenants/:tenantId/domains[2m > [22mshould return empty array for tenant with no domains[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mGET /api/tenants/:tenantId/domains[2m > [22mshould return all domains for tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mGET /api/tenants/:tenantId/domains[2m > [22mshould require authentication[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPOST /api/tenants/:tenantId/domains[2m > [22mshould add a new domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPOST /api/tenants/:tenantId/domains[2m > [22mshould normalize domain to lowercase[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPOST /api/tenants/:tenantId/domains[2m > [22mshould reject duplicate domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPOST /api/tenants/:tenantId/domains[2m > [22mshould reject invalid domain format[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mPOST /api/tenants/:tenantId/domains[2m > [22mshould require tenant:update permission[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mDELETE /api/tenants/:tenantId/domains/:domainId[2m > [22mshould delete a domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mDELETE /api/tenants/:tenantId/domains/:domainId[2m > [22mshould return 404 for non-existent domain[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mDELETE /api/tenants/:tenantId/domains/:domainId[2m > [22mshould return 403 when trying to delete domain from different tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts[2m > [22mBranding API Routes[2m > [22mDELETE /api/tenants/:tenantId/domains/:domainId[2m > [22mshould require tenant:update permission[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mPOST /api/datavault/databases/:databaseId/tokens[2m > [22mshould create a new token and return plain token once[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mPOST /api/datavault/databases/:databaseId/tokens[2m > [22mshould create a token with expiration date[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mPOST /api/datavault/databases/:databaseId/tokens[2m > [22mshould reject token creation with invalid scopes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mPOST /api/datavault/databases/:databaseId/tokens[2m > [22mshould reject token creation with empty label[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mPOST /api/datavault/databases/:databaseId/tokens[2m > [22mshould reject token creation with past expiration date[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mGET /api/datavault/databases/:databaseId/tokens[2m > [22mshould list all tokens for a database without exposing hashes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mGET /api/datavault/databases/:databaseId/tokens[2m > [22mshould return empty array for database with no tokens[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mDELETE /api/datavault/tokens/:tokenId[2m > [22mshould revoke a token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mDELETE /api/datavault/tokens/:tokenId[2m > [22mshould reject revoking token without database ID[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mDELETE /api/datavault/tokens/:tokenId[2m > [22mshould prevent cross-tenant token access[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mToken Authentication[2m > [22mshould authenticate valid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mToken Authentication[2m > [22mshould reject expired token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mToken Authentication[2m > [22mshould reject invalid token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mScope Authorization[2m > [22mshould allow read access with read scope[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mScope Authorization[2m > [22mshould deny write access with read-only scope[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts[2m > [22mDataVault API Tokens[2m > [22mScope Authorization[2m > [22mshould allow write access with write scope[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mcreateCollection[2m > [22mshould create collection with generated slug[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mcreateCollection[2m > [22mshould ensure unique slug by appending counter[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mcreateCollection[2m > [22mshould use provided slug if unique[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mverifyTenantOwnership[2m > [22mshould return collection if tenant owns it[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mverifyTenantOwnership[2m > [22mshould throw error if collection not found[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mverifyTenantOwnership[2m > [22mshould throw error if tenant does not own collection[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mgetCollectionWithFields[2m > [22mshould return collection with fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mlistCollectionsWithStats[2m > [22mshould return collections with field and record counts[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mupdateCollection[2m > [22mshould update collection and regenerate slug if name changed[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mupdateCollection[2m > [22mshould verify tenant ownership before updating[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mdeleteCollection[2m > [22mshould delete collection after verifying ownership[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mdeleteCollection[2m > [22mshould throw error if tenant does not own collection[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mslug generation[2m > [22mshould generate valid slug from name with special characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts[2m > [22mCollectionService[2m > [22mslug generation[2m > [22mshould trim whitespace and convert to lowercase[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould create text field with generated slug[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould create select field with options[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould throw error if select field missing options[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould throw error if options is not an array[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould throw error if options array is empty[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould create field with default value[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould throw error if default value type mismatch[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould ensure unique slug by appending counter[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mcreateField[2m > [22mshould throw error if collection does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mverifyFieldOwnership[2m > [22mshould return field if it belongs to collection[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mverifyFieldOwnership[2m > [22mshould throw error if field not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mverifyFieldOwnership[2m > [22mshould throw error if field belongs to different collection[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mupdateField[2m > [22mshould update field and regenerate slug if name changed[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mupdateField[2m > [22mshould verify field ownership before updating[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mdeleteField[2m > [22mshould delete field after verifying ownership[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mbulkCreateFields[2m > [22mshould create multiple fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mslug generation[2m > [22mshould use underscores instead of dashes for field slugs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mdefault value validation[2m > [22mshould validate text default value[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mdefault value validation[2m > [22mshould validate number default value[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mdefault value validation[2m > [22mshould validate boolean default value[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mdefault value validation[2m > [22mshould validate date default value[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mdefault value validation[2m > [22mshould validate select default value[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts[2m > [22mCollectionFieldService[2m > [22mdefault value validation[2m > [22mshould validate multi_select default value[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1768088283738,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768088283743,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1768088283745,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768088283753,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1768088283755,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mexecuteHooksForPhase()[2m > [22mshould execute hooks in order[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mexecuteHooksForPhase()[2m > [22mshould handle hooks with no mutations[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mexecuteHooksForPhase()[2m > [22mshould collect errors without breaking execution[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mexecuteHooksForPhase()[2m > [22mshould collect console logs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mexecuteHooksForPhase()[2m > [22mshould return original data when no hooks exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mexecuteHooksForPhase()[2m > [22mshould handle system errors gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mexecuteHooksForPhase()[2m > [22mshould pass input keys to script engine[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mcreateHook()[2m > [22mshould create hook with ownership check[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mcreateHook()[2m > [22mshould reject creation for non-existent workflow[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mcreateHook()[2m > [22mshould reject creation for non-owner[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mupdateHook()[2m > [22mshould update hook with ownership check[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mupdateHook()[2m > [22mshould reject update for non-owner[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mdeleteHook()[2m > [22mshould delete hook with ownership check[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mdeleteHook()[2m > [22mshould reject deletion for non-owner[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mtestHook()[2m > [22mshould execute hook with test data[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mlistHooks()[2m > [22mshould list all hooks for workflow with ownership check[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts[2m > [22mLifecycleHookService[2m > [22mlistHooks()[2m > [22mshould reject listing for non-owner[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mlistDataSources[2m > [22mshould return data sources for tenant[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mgetDataSource[2m > [22mshould return null if not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mgetDataSource[2m > [22mshould return null if tenant mismatch[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mgetDataSource[2m > [22mshould return source if valid[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mcreateDataSource[2m > [22mshould create data source[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mupdateDataSource[2m > [22mshould throw if not exists[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mupdateDataSource[2m > [22mshould update if exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mlinkDataSourceToWorkflow[2m > [22mshould throw if source not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts[2m > [22mDataSourceService[2m > [22mlinkDataSourceToWorkflow[2m > [22mshould link if source exists[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip question when condition is false
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q1 executed. Key: has_code, Value: true. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q2 executed. Key: code, Value: ABC123. Context keys: 5

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip compute node when condition is false
[DEBUG Question] Node q1 executed. Key: amount, Value: 0. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute compute node when condition is true
[DEBUG Question] Node q1 executed. Key: amount, Value: 100. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q3 executed. Key: amount, Value: 1000. Context keys: 5

 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mGraph Validation[2m > [22mshould validate a simple graph[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mGraph Validation[2m > [22mshould detect duplicate node IDs[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mGraph Validation[2m > [22mshould detect invalid edge references[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mExpression Validation[2m > [22mshould validate node conditions[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mExpression Validation[2m > [22mshould detect typos in variable names[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mExpression Validation[2m > [22mshould validate compute node expressions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mExpression Validation[2m > [22mshould validate branch conditions[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mExpression Validation[2m > [22mshould validate template bindings[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould skip question when condition is false[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould execute question when condition is true[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould skip compute node when condition is false[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould execute compute node when condition is true[32m 2[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should return trace when debug is enabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should not return trace when debug is disabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mConditional Execution[2m > [22mshould handle complex workflow with multiple conditions[32m 216[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mDebug Mode[2m > [22mshould return trace when debug is enabled[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts[2m > [22mEngine - Conditional Execution[2m > [22mDebug Mode[2m > [22mshould not return trace when debug is disabled[32m 1[2mms[22m[39m
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mlistEmailTemplates[2m > [22mshould return all email template metadata[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateById[2m > [22mshould return template for valid ID[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateById[2m > [22mshould return null for non-existent template[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateByKey[2m > [22mshould return template for valid key[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateByKey[2m > [22mshould return null for non-existent key[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mupdateTemplateMetadata[2m > [22mshould update template metadata[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mupdateTemplateMetadata[2m > [22mshould throw error for non-existent template[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mcreateTemplate[2m > [22mshould create new template metadata[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mcreateTemplate[2m > [22mshould throw error for duplicate template key[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mdeleteTemplate[2m > [22mshould delete template metadata[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mdeleteTemplate[2m > [22mshould return false for non-existent template[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplatesWithBrandingToken[2m > [22mshould return templates with specific branding token[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplatesWithBrandingToken[2m > [22mshould return empty array when no templates have the token[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/writes/WriteRunner.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768088285700,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768088285874,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088285874,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1768088285876,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768088285877,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1768088285878,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
 [32mÎ“Â£Ã´[39m tests/unit/writes/WriteRunner.test.ts[2m > [22mWriteRunner[2m > [22mMode: Create[2m > [22mshould resolve values and call datavaultRowsService.createRow[32m 175[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/writes/WriteRunner.test.ts[2m > [22mWriteRunner[2m > [22mMode: Create[2m > [22mshould simulate write in preview mode[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/writes/WriteRunner.test.ts[2m > [22mWriteRunner[2m > [22mMode: Update[2m > [22mshould find row by PK and update[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/writes/WriteRunner.test.ts[2m > [22mWriteRunner[2m > [22mMode: Update[2m > [22mshould return failure result if row not found[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflow/PreviewExecution.test.ts[2m > [22mPreview Execution & Snapshots[2m > [22mPreview mode should not call database write methods[32m 14[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflow/PreviewExecution.test.ts[2m > [22mPreview Execution & Snapshots[2m > [22mLive mode SHOULD call database write methods[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflow/PreviewExecution.test.ts[2m > [22mPreview Execution & Snapshots[2m > [22mQuery node in preview should see shadow writes[32m 3[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mcreateTemplate[2m > [22mshould create a new DOCX template successfully[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mcreateTemplate[2m > [22mshould throw error if template name already exists[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mcreateTemplate[2m > [22mshould throw error for invalid DOCX file type[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mcreateTemplate[2m > [22mshould delete uploaded file if database insert fails[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mgetTemplate[2m > [22mshould retrieve template by ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mgetTemplate[2m > [22mshould throw error if template not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mgetTemplate[2m > [22mshould throw error if template file missing from storage[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mlistTemplates[2m > [22mshould list all templates for a project[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mupdateTemplateMeta[2m > [22mshould update template name and description[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mupdateTemplateMeta[2m > [22mshould throw error if new name already exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mdeleteTemplate[2m > [22mshould delete template and associated file[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mdeleteTemplate[2m > [22mshould throw error if template not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mstoreTemplateFile[2m > [22mshould replace template file[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts[2m > [22mDocumentTemplateService[2m > [22mstoreTemplateFile[2m > [22mshould rollback new file if update fails[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22msendMagicLink()[2m > [22mshould generate magic link with 64-character token[32m 7[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22msendMagicLink()[2m > [22mshould store hashed token in database[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22msendMagicLink()[2m > [22mshould set token expiry to 30 minutes[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22msendMagicLink()[2m > [22mshould log magic link generation[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22msendMagicLink()[2m > [22mshould generate unique tokens for same email[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22msendMagicLink()[2m > [22mshould handle different email addresses[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22msendMagicLink()[2m > [22mshould use configured base URL[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22msendMagicLink()[2m > [22mshould default to localhost if base URL not set[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22mError Handling - sendMagicLink()[2m > [22mshould throw error if database insert fails[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22mError Handling - sendMagicLink()[2m > [22mshould handle empty email[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Generation[2m > [22mError Handling - sendMagicLink()[2m > [22mshould handle special characters in email[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mverifyMagicLink()[2m > [22mshould verify valid magic link token[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mverifyMagicLink()[2m > [22mshould delete token after successful verification[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mverifyMagicLink()[2m > [22mshould return null for invalid token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mverifyMagicLink()[2m > [22mshould return null for expired token[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mverifyMagicLink()[2m > [22mshould prevent token reuse[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mverifyMagicLink()[2m > [22mshould use constant-time comparison via hash[32m 45[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mverifyMagicLink()[2m > [22mshould handle verification with different token lengths[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mError Handling - verifyMagicLink()[2m > [22mshould handle database query errors gracefully[32m 2[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mError Handling - verifyMagicLink()[2m > [22mshould handle database delete errors gracefully[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mError Handling - verifyMagicLink()[2m > [22mshould handle null token gracefully[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mError Handling - verifyMagicLink()[2m > [22mshould handle undefined token gracefully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mMagic Link Verification[2m > [22mError Handling - verifyMagicLink()[2m > [22mshould handle empty string token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mSecurity[2m > [22mToken Security[2m > [22mshould generate cryptographically secure random tokens[32m 10[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mSecurity[2m > [22mToken Security[2m > [22mshould not log plain token in production[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mSecurity[2m > [22mToken Security[2m > [22mshould prevent timing attacks via hashed comparison[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mSecurity[2m > [22mToken Security[2m > [22mshould use SHA-256 hashing for tokens[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mSecurity[2m > [22mExpiry & Cleanup[2m > [22mshould reject tokens exactly at expiry time[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mSecurity[2m > [22mExpiry & Cleanup[2m > [22mshould accept tokens 1 second before expiry[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mSecurity[2m > [22mExpiry & Cleanup[2m > [22mshould automatically delete token after verification[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mIntegration Scenarios[2m > [22mComplete Portal Login Flow[2m > [22mshould support full portal authentication workflow[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mIntegration Scenarios[2m > [22mMultiple Users[2m > [22mshould handle concurrent magic links for different users[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mIntegration Scenarios[2m > [22mMultiple Users[2m > [22mshould isolate tokens between different users[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mIntegration Scenarios[2m > [22mRate Limiting Scenarios[2m > [22mshould allow multiple magic link requests for same email[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mEdge Cases[2m > [22mEmail Formats[2m > [22mshould handle various valid email formats[32m 39[2mms[22m[39m
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mEdge Cases[2m > [22mEmail Formats[2m > [22mshould handle unicode in email local part[32m 58[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mEdge Cases[2m > [22mToken Formats[2m > [22mshould handle token with special characters[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mEdge Cases[2m > [22mToken Formats[2m > [22mshould handle very long token[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mEdge Cases[2m > [22mToken Formats[2m > [22mshould handle token with whitespace[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mPerformance[2m > [22mToken Generation Performance[2m > [22mshould generate magic link in < 100ms[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mPerformance[2m > [22mToken Generation Performance[2m > [22mshould verify token in < 100ms[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts[2m > [22mPortalAuthService[2m > [22mPerformance[2m > [22mScalability[2m > [22mshould handle bulk magic link generation[32m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mcreateStep[2m > [22mshould create a step with auto-incrementing order[32m 6[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mcreateStep[2m > [22mshould create step with order 1 if section is empty[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mcreateStep[2m > [22mshould validate alias uniqueness before creating[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mcreateStep[2m > [22mshould allow creating step with null alias[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mcreateStep[2m > [22mshould throw error if section not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mcreateStep[2m > [22mshould verify workflow ownership[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mupdateStep[2m > [22mshould update step successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mupdateStep[2m > [22mshould validate alias uniqueness when updating alias[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mupdateStep[2m > [22mshould allow updating step without changing alias[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mupdateStep[2m > [22mshould throw error if step not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mupdateStep[2m > [22mshould throw error if step does not belong to workflow[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mdeleteStep[2m > [22mshould delete step successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mdeleteStep[2m > [22mshould throw error if step not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts[2m > [22mStepService[2m > [22mdeleteStep[2m > [22mshould throw error if step does not belong to workflow[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingByTenantId[2m > [22mshould return tenant branding when tenant exists[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingByTenantId[2m > [22mshould return null when tenant does not exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingByTenantId[2m > [22mshould return null when branding is not set[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingByTenantId[2m > [22mshould throw error on database failure[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mupdateBranding[2m > [22mshould merge partial branding with existing branding[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mupdateBranding[2m > [22mshould throw error when tenant not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mupdateBranding[2m > [22mshould handle null existing branding[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingForDomain[2m > [22mshould return tenant ID and branding for valid domain[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingForDomain[2m > [22mshould return null when domain not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetBrandingForDomain[2m > [22mshould handle tenant with null branding[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetDomainsByTenantId[2m > [22mshould return all domains for a tenant[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mgetDomainsByTenantId[2m > [22mshould return empty array when no domains exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22maddDomain[2m > [22mshould add a new domain and normalize to lowercase[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22maddDomain[2m > [22mshould throw error when domain already exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22maddDomain[2m > [22mshould propagate other database errors[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mremoveDomain[2m > [22mshould remove domain when it belongs to tenant[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mremoveDomain[2m > [22mshould return false when domain not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22mremoveDomain[2m > [22mshould throw error when domain belongs to different tenant[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22misDomainAvailable[2m > [22mshould return true when domain is available[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22misDomainAvailable[2m > [22mshould return false when domain already exists[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts[2m > [22mBrandingService[2m > [22misDomainAvailable[2m > [22mshould normalize domain to lowercase before checking[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mrecordAttempt()[2m > [22mshould record successful login attempt[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mrecordAttempt()[2m > [22mshould record failed login attempt[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mrecordAttempt()[2m > [22mshould handle undefined IP address[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mrecordAttempt()[2m > [22mshould check for lockout after failed attempt[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mrecordAttempt()[2m > [22mshould not check for lockout after successful attempt[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mcheckAndLockAccount()[2m > [22mshould lock account after 5 failed attempts[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mcheckAndLockAccount()[2m > [22mshould not lock account with fewer than 5 failed attempts[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mcheckAndLockAccount()[2m > [22mshould only count failed attempts within 15-minute window[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mcheckAndLockAccount()[2m > [22mshould set lockout duration to 15 minutes[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mcheckAndLockAccount()[2m > [22mshould not create lock if user not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22misAccountLocked()[2m > [22mshould return locked=true for locked account[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22misAccountLocked()[2m > [22mshould return locked=false for unlocked account[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22misAccountLocked()[2m > [22mshould return locked=false if lock has expired[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22misAccountLocked()[2m > [22mshould return locked=false if lock was manually unlocked[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22misAccountLocked()[2m > [22mshould only check for active locks (unlocked=false)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22munlockAccount()[2m > [22mshould unlock account by setting unlocked=true[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22munlockAccount()[2m > [22mshould unlock all locks for the user[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mcleanupOldAttempts()[2m > [22mshould delete login attempts older than 30 days[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mcleanupOldAttempts()[2m > [22mshould only delete old attempts, not recent ones[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mLockout Workflow[2m > [22mshould follow complete lockout workflow[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mEdge Cases[2m > [22mshould handle concurrent failed attempts[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mEdge Cases[2m > [22mshould handle exactly 5 attempts (boundary case)[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts[2m > [22mAccountLockoutService[2m > [22mEdge Cases[2m > [22mshould handle 6+ attempts (above threshold)[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/debug_import.test.ts[2m > [22mDebug Test[2m > [22mshould find module[32m 2[2mms[22m[39m
{"level":30,"time":1768088288108,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts[2m > [22m[2mPersonalization API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768088288116,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768088288117,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768088288121,"env":"test","module":"documents-routes","msg":"Document routes registered"}
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":30,"time":1768088287956,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768088288220,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
 [32mÎ“Â£Ã´[39m tests/unit/external/ExternalSendRunner.test.ts[2m > [22mExternalSendRunner[2m > [22mshould resolve destination and execute send[32m 266[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/external/ExternalSendRunner.test.ts[2m > [22mExternalSendRunner[2m > [22mshould block execution in preview mode[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/external/ExternalSendRunner.test.ts[2m > [22mExternalSendRunner[2m > [22mshould fail if destination not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mlistEmailTemplates[2m > [22mshould return all email templates[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mlistEmailTemplates[2m > [22mshould return empty array when no templates exist[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mlistEmailTemplates[2m > [22mshould throw error on database failure[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateById[2m > [22mshould return template when found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateById[2m > [22mshould return null when template not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateById[2m > [22mshould throw error on database failure[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateByKey[2m > [22mshould return template when found by key[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplateByKey[2m > [22mshould return null when template key not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mupdateTemplateMetadata[2m > [22mshould update template metadata successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mupdateTemplateMetadata[2m > [22mshould allow partial updates[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mupdateTemplateMetadata[2m > [22mshould throw error when template not found[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mupdateTemplateMetadata[2m > [22mshould handle null values in metadata[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mcreateTemplate[2m > [22mshould create a new template[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mcreateTemplate[2m > [22mshould throw error when template key already exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mcreateTemplate[2m > [22mshould handle optional fields[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mdeleteTemplate[2m > [22mshould delete a template successfully[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mdeleteTemplate[2m > [22mshould return false when template not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mdeleteTemplate[2m > [22mshould throw error on database failure[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplatesWithBrandingToken[2m > [22mshould filter templates by branding token[32m 144[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplatesWithBrandingToken[2m > [22mshould return empty array when no templates match[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts[2m > [22mEmailTemplateMetadataService[2m > [22mgetTemplatesWithBrandingToken[2m > [22mshould handle templates with null branding tokens[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultColumnsService - Reference Column Validation[2m > [22mshould throw error if referenceTableId is missing for reference column[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultColumnsService - Reference Column Validation[2m > [22mshould validate that referenced table exists and belongs to same tenant[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultColumnsService - Reference Column Validation[2m > [22mshould validate that referenced table belongs to same tenant[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultColumnsService - Reference Column Validation[2m > [22mshould validate that displayColumnSlug exists in referenced table[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultColumnsService - Reference Column Validation[2m > [22mshould clear reference fields when type is not reference[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultRowsService - Reference Value Validation[2m > [22mshould validate that reference value is a valid UUID[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultRowsService - Reference Value Validation[2m > [22mshould validate that referenced row exists[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultRowsService - Reference Value Validation[2m > [22mshould validate that referenced row belongs to correct table[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultRowsService - Reference Value Validation[2m > [22mshould allow null reference value when not required[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts[2m > [22mDataVault Reference Columns[2m > [22mDatavaultRowsService - Reference Value Validation[2m > [22mshould reject null reference value when required[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.personalization.test.ts[2m > [22mPersonalization API Integration Tests[2m > [22mPOST /api/ai/personalize/block[2m > [22mshould rewrite text based on user settings[32m 90[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.personalization.test.ts[2m > [22mPersonalization API Integration Tests[2m > [22mPOST /api/ai/personalize/help[2m > [22mshould generate help text[32m 57[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.ai.personalization.test.ts[2m > [22mPersonalization API Integration Tests[2m > [22mPOST /api/ai/personalize/settings[2m > [22mshould update user settings[32m 105[2mms[22m[39m
[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/BlockRunner.validate.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts[2m > [22mBlockRunner Validation Logic[2m > [22mshould pass if no rules are present[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts[2m > [22mBlockRunner Validation Logic[2m > [22mCompare Rules[2m > [22mshould pass on valid comparison[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts[2m > [22mBlockRunner Validation Logic[2m > [22mCompare Rules[2m > [22mshould fail on invalid comparison and map alias to ID[32m 8[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts[2m > [22mBlockRunner Validation Logic[2m > [22mCompare Rules[2m > [22mshould compare with variable[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts[2m > [22mBlockRunner Validation Logic[2m > [22mConditional Required Rules[2m > [22mshould enforce requirement if condition met[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts[2m > [22mBlockRunner Validation Logic[2m > [22mConditional Required Rules[2m > [22mshould ignore requirement if condition not met[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts[2m > [22mBlockRunner Validation Logic[2m > [22mForEach Rules[2m > [22mshould validate items in list[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRows[2m > [22mshould get rows with values and pagination[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRow[2m > [22mshould get a single row by ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRow[2m > [22mcreateRow[2m > [22mshould create row with validated values[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRow[2m > [22mcreateRow[2m > [22mshould throw error if required field is missing[32m 3[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRow[2m > [22mupdateRow[2m > [22mshould update row values[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRow[2m > [22mdeleteRow[2m > [22mshould delete row[32m 11[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRow[2m > [22mvalue type coercion[2m > [22mshould coerce number values[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts[2m > [22mDatavaultRowsService[2m > [22mgetRow[2m > [22mvalue type coercion[2m > [22mshould coerce boolean values[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogLoginAttempt[2m > [22mshould log a successful login attempt[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogLoginAttempt[2m > [22mshould log a failed login attempt with reason[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogMfaChange[2m > [22mshould log MFA enabled event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogMfaChange[2m > [22mshould log MFA disabled event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogPasswordReset[2m > [22mshould log a password reset event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogSessionEvent[2m > [22mshould log a session created event[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogSessionEvent[2m > [22mshould log all sessions revoked event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogTrustedDeviceEvent[2m > [22mshould log a trusted device added event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogTrustedDeviceEvent[2m > [22mshould log a trusted device revoked event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogAccountLockout[2m > [22mshould log an account locked event[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts[2m > [22mAuditLogService[2m > [22mlogAccountLockout[2m > [22mshould log an account unlocked event[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mfindByTableId[2m > [22mshould find rows by table ID[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mfindByTableId[2m > [22mshould support limit and offset[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mfindById[2m > [22mshould find row by ID[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mfindById[2m > [22mshould return undefined if row not found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mcreate[2m > [22mshould create a new row[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mdelete[2m > [22mshould delete a row[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mcountByTableId[2m > [22mshould count rows by table ID[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mcountByTableId[2m > [22mshould return 0 if no rows found[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mcreateRowWithValues[2m > [22mshould create row and values in transaction[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mcreateRowWithValues[2m > [22mshould handle empty values array[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mgetRowsWithValues[2m > [22mshould get rows with their values[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mupdateRowValues[2m > [22mshould upsert row values[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts[2m > [22mDatavaultRowsRepository[2m > [22mupdateRowValues[2m > [22mshould handle empty values array[32m 0[2mms[22m[39m
[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/Guardrail.test.ts[2m > [22mDatavaultGuardrails[2m > [22mdeleteColumn[2m > [22mshould throw if column is referenced in a block[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/Guardrail.test.ts[2m > [22mDatavaultGuardrails[2m > [22mdeleteColumn[2m > [22mshould throw if column is referenced in a transform[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/Guardrail.test.ts[2m > [22mDatavaultGuardrails[2m > [22mdeleteColumn[2m > [22mshould succeed if no references found[32m 2[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/FinalBlockSnapshot.test.ts[2m > [22mFinalBlock Executor[2m > [22mshould interpolate markdown content[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/FinalBlockSnapshot.test.ts[2m > [22mFinalBlock Executor[2m > [22mshould call renderer with correct request[32m 5[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/FinalBlockSnapshot.test.ts[2m > [22mFinalBlock Executor[2m > [22mshould handle preview execution (snapshot mode)[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mAuthentication[2m > [22mshould accept connection with valid JWT token
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mAuthentication[2m > [22mshould reject connection without JWT token
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mAuthentication[2m > [22mshould reject connection with invalid JWT token
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mAuthentication[2m > [22mshould reject cross-tenant access
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mMulti-user Collaboration[2m > [22mshould sync document updates between two clients
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mMulti-user Collaboration[2m > [22mshould track presence of multiple users
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mRBAC Permissions[2m > [22mshould allow owner to make changes
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mRBAC Permissions[2m > [22mshould allow builder to make changes
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mRBAC Permissions[2m > [22mshould allow viewer to connect but not mutate
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mPersistence[2m > [22mshould persist document updates to database
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mPersistence[2m > [22mshould create snapshots after N updates
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mPersistence[2m > [22mshould load document from snapshot on reconnect
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mRoom Management[2m > [22mshould create room on first connection
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts[2m > [22mCollaboration Server [requires collab server][2m > [22mRoom Management[2m > [22mshould cleanup room when all users disconnect
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mTables API[2m > [22mGET /api/datavault/tables[2m > [22mshould list all tables for tenant[32m 4[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mTables API[2m > [22mGET /api/datavault/tables[2m > [22mshould list tables with stats when requested[32m 1[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mTables API[2m > [22mPOST /api/datavault/tables[2m > [22mshould create a new table[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mTables API[2m > [22mPOST /api/datavault/tables[2m > [22mshould validate required fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mTables API[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould get a table by ID[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mTables API[2m > [22mGET /api/datavault/tables/:tableId[2m > [22mshould return 404 for non-existent table[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mTables API[2m > [22mPATCH /api/datavault/tables/:tableId[2m > [22mshould update a table[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mTables API[2m > [22mDELETE /api/datavault/tables/:tableId[2m > [22mshould delete a table[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mColumns API[2m > [22mGET /api/datavault/tables/:tableId/columns[2m > [22mshould list all columns for a table[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mColumns API[2m > [22mPOST /api/datavault/tables/:tableId/columns[2m > [22mshould create a new column[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mColumns API[2m > [22mPOST /api/datavault/tables/:tableId/columns[2m > [22mshould validate column type enum[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mColumns API[2m > [22mPATCH /api/datavault/columns/:columnId[2m > [22mshould update a column[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mColumns API[2m > [22mPATCH /api/datavault/columns/:columnId[2m > [22mshould reject type changes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mColumns API[2m > [22mDELETE /api/datavault/columns/:columnId[2m > [22mshould delete a column[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mColumns API[2m > [22mPOST /api/datavault/tables/:tableId/columns/reorder[2m > [22mshould reorder columns[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mRows API[2m > [22mGET /api/datavault/tables/:tableId/rows[2m > [22mshould list all rows for a table[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mRows API[2m > [22mGET /api/datavault/tables/:tableId/rows[2m > [22mshould support pagination[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mRows API[2m > [22mPOST /api/datavault/tables/:tableId/rows[2m > [22mshould create a new row[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mRows API[2m > [22mPOST /api/datavault/tables/:tableId/rows[2m > [22mshould validate required fields[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mRows API[2m > [22mGET /api/datavault/rows/:rowId[2m > [22mshould get a row by ID[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mRows API[2m > [22mPATCH /api/datavault/rows/:rowId[2m > [22mshould update a row[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mRows API[2m > [22mDELETE /api/datavault/rows/:rowId[2m > [22mshould delete a row[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mError Handling[2m > [22mshould handle tenant isolation[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mError Handling[2m > [22mshould handle malformed UUIDs[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mError Handling[2m > [22mshould handle database errors gracefully[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mType Validation[2m > [22mshould validate email type values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mType Validation[2m > [22mshould validate phone type values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mType Validation[2m > [22mshould coerce number type values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts[2m > [22mDataVault API Routes[2m > [22mType Validation[2m > [22mshould coerce boolean type values[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanAccessAsset[2m > [22mshould allow access to user-owned asset by owner[32m 165[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mPOST /api/datavault/rows/:rowId/notes[2m > [22mshould create a new note[32m 2[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mPOST /api/datavault/rows/:rowId/notes[2m > [22mshould sanitize HTML from note text[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mPOST /api/datavault/rows/:rowId/notes[2m > [22mshould reject empty note text[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mPOST /api/datavault/rows/:rowId/notes[2m > [22mshould reject note for row from different tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mGET /api/datavault/rows/:rowId/notes[2m > [22mshould fetch notes for a row ordered by newest first[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mGET /api/datavault/rows/:rowId/notes[2m > [22mshould return empty array for row with no notes[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mGET /api/datavault/rows/:rowId/notes[2m > [22mshould reject access to notes for row from different tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mDELETE /api/datavault/notes/:noteId[2m > [22mshould allow note owner to delete their note[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mDELETE /api/datavault/notes/:noteId[2m > [22mshould allow table owner to delete any note[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mDELETE /api/datavault/notes/:noteId[2m > [22mshould prevent non-owner from deleting note[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mDELETE /api/datavault/notes/:noteId[2m > [22mshould return 404 for non-existent note[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts[2m > [22mDataVault Row Notes API[2m > [22mCross-tenant isolation[2m > [22mshould prevent accessing notes from different tenant[32m 0[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanAccessAsset[2m > [22mshould deny access to user-owned asset by non-owner[32m 166[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanAccessAsset[2m > [22mshould allow access to org-owned asset by org member[32m 266[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanAccessAsset[2m > [22mshould deny access to org-owned asset by non-member[32m 208[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanAccessAsset[2m > [22mshould allow access to null ownership (legacy data)[32m 155[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22misOrgMember[2m > [22mshould return true for org member[32m 267[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22misOrgMember[2m > [22mshould return false for non-member[32m 211[2mms[22m[39m
 [31mâ”œÃ¹[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22misOrgMember[2m > [22mshould return true for org admin[32m 285[2mms[22m[39m
[31m   Î“Ã¥Ã† expected false to be true // Object.is equality[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanManageOrg[2m > [22mshould return true for org admin[32m 263[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanManageOrg[2m > [22mshould return false for org member (non-admin)[32m 263[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanManageOrg[2m > [22mshould return false for non-member[32m 199[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mgetUserOrgIds[2m > [22mshould return all org IDs for a user[32m 255[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mgetUserOrgIds[2m > [22mshould return empty array for user with no memberships[32m 202[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanCreateWithOwnership[2m > [22mshould allow creating user-owned asset if ownerUuid matches userId[32m 152[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanCreateWithOwnership[2m > [22mshould deny creating user-owned asset if ownerUuid does not match userId[32m 155[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanCreateWithOwnership[2m > [22mshould allow creating org-owned asset if user is member[32m 265[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mcanCreateWithOwnership[2m > [22mshould deny creating org-owned asset if user is not member[32m 203[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mCross-org Access Control[2m > [22mshould not allow member of org1 to access org2-owned assets[32m 273[2mms[22m[39m
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mâ”œÃ¹[39m tests/integration/ownershipAccess.test.ts[2m > [22mOwnership Access Control[2m > [22mCross-org Access Control[2m > [22mshould allow member of multiple orgs to access all their org assets[33m 317[2mms[22m[39m
[31m   Î“Ã¥Ã† expected false to be true // Object.is equality[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/ai/workflowEdit.test.ts > POST /api/workflows/:workflowId/ai/edit - Integration Test
error: duplicate key value violates unique constraint "tenants_pkey"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/ai/workflowEdit.test.ts:72:22
     70| 
     71|     // Create test tenant (with valid UUID to avoid syntax error)
     72|     const [tenant] = await db.insert(tenants).values({
       |                      ^
     73|       id: '987fcdeb-51a2-43d7-9012-345678901234',
     74|       name: 'Test Tenant',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { length: 221, severity: 'ERROR', code: '23505', detail: 'Key (id)=(987fcdeb-51a2-43d7-9012-345678901234) already exists.', hint: undefined, position: undefined, internalPosition: undefined, internalQuery: undefined, where: undefined, schema: 'public', table: 'tenants', dataType: undefined, constraint: 'tenants_pkey', file: 'nbtinsert.c', routine: '_bt_check_unique' }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/123]Î“Ã„Â»

 FAIL  tests/integration/auth/portal.authentication.test.ts [ tests/integration/auth/portal.authentication.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/auth/portal.authentication.test.ts
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/123]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 121 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/analytics_service.test.ts > Analytics Service Integration > should generate events and metrics on run completion
Error: Workflow is not active
 Î“Â¥Â» RunAuthResolver.verifyCreateAccess server/services/runs/RunAuthResolver.ts:110:53
    108| 
    109|             if (!workflow) throw new Error('Workflow not found');
    110|             if (workflow.status !== 'active') throw new Error('WorkfloÎ“Ã‡Âª
       |                                                     ^
    111|             if (!workflow.isPublic) throw new Error('Workflow is not pÎ“Ã‡Âª
    112| 
 Î“Â¥Â» RunService.createRun server/services/RunService.ts:202:22
 Î“Â¥Â» tests/integration/analytics_service.test.ts:42:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/123]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should analyze a DOCX file and return variables
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:143:37
    141|                 } catch (e) { console.log("FAIL_BODY: " + response.texÎ“Ã‡Âª
    142|             }
    143|             expect(response.status).toBe(200);
       |                                     ^
    144| 
    145|             expect(response.body.data).toHaveProperty("variables");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/123]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should fail if no file is provided
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:168:18
    166|             await request(baseURL)
    167|                 .post("/api/ai/doc/analyze")
    168|                 .expect(400);
       |                  ^
    169|         });
    170|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/123]Î“Ã„Â»

 FAIL  tests/integration/api.snapshots.test.ts > Stage 13: Workflow Snapshots & Versioning > should maintain immutability of runs across versions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/api.snapshots.test.ts:199:37
    197|         // 7. Verify Run 1 still sees Version 1 Question
    198|         const run1Response = await agent.get(`/api/runs/${run1.id}`);
    199|         expect(run1Response.status).toBe(200);
       |                                     ^
    200|         const run1Graph = run1Response.body.workflowVersion.graphJson;
    201|         expect(run1Graph.nodes[0].config.question).toBe('Version 1 QueÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/123]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Templates API > POST /api/projects/:ctx.projectId/templates > should reject non-docx files
Error: expected 500 "Internal Server Error", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:119:12
    117|           .field("name", "Test Template")
    118|           .attach("file", mockPdf, "test.pdf")
    119|           .expect(500); // Multer rejects before handler
       |            ^
    120|       });
    121| 
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/123]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Runs API > POST /api/workflows/:id/run > should reject without required permission
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:289:12
    287|           .post("/api/auth/register")
    288|           .send({ email: viewerEmail, password: "TestPassword123" })
    289|           .expect(201);
       |            ^
    290| 
    291|         await db.update(schema.users)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Complete Registration Î“Ã¥Ã† Login Flow > should complete registration, verify email, then login
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:55:36
     53|         .send({ email, password });
     54| 
     55|       expect(loginAttempt1.status).toBe(403);
       |                                    ^
     56|       expect(loginAttempt1.body.message || loginAttempt1.body.error).tÎ“Ã‡Âª
     57| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should lock account after 5 failed attempts, then unlock after waiting
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:110:36
    108|         });
    109| 
    110|       expect(lockedAttempt.status).toBe(423);
       |                                    ^
    111|       expect(lockedAttempt.body.message || lockedAttempt.body.error).tÎ“Ã‡Âª
    112| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should record all login attempts
AssertionError: expected +0 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 0

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:145:31
    143|       });
    144| 
    145|       expect(attempts.length).toBe(3);
       |                               ^
    146|       expect(attempts.filter(a => !a.successful).length).toBe(2);
    147|       expect(attempts.filter(a => a.successful).length).toBe(1);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should complete MFA setup and login with TOTP
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:182:25
    180|       });
    181| 
    182|       expect(mfaSecret).toBeDefined();
       |                         ^
    183|       expect(mfaSecret!.enabled).toBe(false); // Not enabled until verÎ“Ã‡Âª
    184| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should login with backup code when TOTP unavailable
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:248:52
    246|       });
    247| 
    248|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    249| 
    250|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Password Reset Flow > should complete full password reset flow
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:332:36
    330|         });
    331| 
    332|       expect(resetResponse.status).toBe(200);
       |                                    ^
    333| 
    334|       // Step 4: Verify old password no longer works

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should rotate refresh token on each use
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:415:40
    413|           .set('Cookie', refreshTokenCookie!);
    414| 
    415|         expect(refreshResponse.status).toBe(200);
       |                                        ^
    416|         expect(refreshResponse.body.token).toBeDefined();
    417| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should list all active sessions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:492:39
    490|         .set("Authorization", `Bearer ${token}`);
    491| 
    492|       expect(sessionsResponse.status).toBe(200);
       |                                       ^
    493|       expect(sessionsResponse.body.sessions).toBeDefined();
    494|       expect(sessionsResponse.body.sessions.length).toBeGreaterThanOrEÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/123]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:517:40
    515| 
    516|       const sessions = sessionsResponse.body.sessions;
    517|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    518| 
    519|       // Revoke first session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/123]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should login with valid credentials
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:138:31
    136|         .send({ email, password });
    137| 
    138|       expect(response.status).toBe(200);
       |                               ^
    139|       expect((response.body as any).message).toBe("Login successful");
    140|       expect((response.body as any).token).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/123]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return 403 for unverified email
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:192:31
    190|         .send({ email, password });
    191| 
    192|       expect(response.status).toBe(403);
       |                               ^
    193|       expect(response.body.message || response.body.error).toBeDefinedÎ“Ã‡Âª
    194|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/123]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return requiresMfa=true for MFA-enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:223:31
    221|         .send({ email, password });
    222| 
    223|       expect(response.status).toBe(200);
       |                               ^
    224|       expect(response.body.requiresMfa).toBe(true);
    225|       expect(response.body.userId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[20/123]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should lock account after 5 failed attempts
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:250:31
    248|         });
    249| 
    250|       expect(response.status).toBe(423);
       |                               ^
    251|       expect(response.body).toBeDefined();
    252|       expect(response.body.error || response.body.message).toBeDefinedÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[21/123]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/logout > should logout and clear refresh token cookie
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:266:23
    264| 
    265|       const cookies = (loginResponse.headers as any)['set-cookie'] as Î“Ã‡Âª
    266|       expect(cookies).toBeDefined();
       |                       ^
    267|       const refreshTokenCookie = cookies!.find(c => c.startsWith('refrÎ“Ã‡Âª
    268|       expect(refreshTokenCookie).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[22/123]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/refresh-token > should refresh access token with valid refresh token
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:295:23
    293| 
    294|       const cookies = (loginResponse.headers as any)['set-cookie'] as Î“Ã‡Âª
    295|       expect(cookies).toBeDefined();
       |                       ^
    296|       const refreshTokenCookie = cookies!.find(c => c.startsWith('refrÎ“Ã‡Âª
    297|       expect(refreshTokenCookie).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[23/123]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/reset-password > should reset password with valid token
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:397:31
    395|         });
    396| 
    397|       expect(response.status).toBe(200);
       |                               ^
    398|       expect(response.body.message).toContain("Password updated");
    399| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[24/123]Î“Ã„Â»

 FAIL  tests/integration/dataBlocks.test.ts > Data Block Integration Tests > should query data from DataVault via QueryBlock and use in Logic
AssertionError: expected 0 to be greater than 0
 Î“Â¥Â» tests/integration/dataBlocks.test.ts:302:37
    300|         if (val.rows) {
    301|             expect(Array.isArray(val.rows)).toBe(true);
    302|             expect(val.rows.length).toBeGreaterThan(0);
       |                                     ^
    303|             expect(val.rows[0][columnId]).toBe('Hello DataVault');
    304|         } else if (val.items) {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[25/123]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:431:31
    429|         .set('Authorization', `Bearer ${authToken}`);
    430| 
    431|       expect(response.status).toBe(200);
       |                               ^
    432|       expect(response.body).toHaveLength(2);
    433|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[26/123]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should delete a note
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:451:37
    449|         .set('Authorization', `Bearer ${authToken}`);
    450| 
    451|       expect(deleteResponse.status).toBe(200);
       |                                     ^
    452| 
    453|       // Verify note is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[27/123]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should not allow deleting notes by other users
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should revoke (delete) an API token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > API Tokens > should deny access with expired token
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should list table permissions
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:186:21
    184|     testDatabaseId = database.id;
    185| 
    186|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    187|       name: 'Test Table',
    188|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { length: 331, severity: 'ERROR', code: '23503', detail: 'Key (owner_user_id)=(google-user-id) is not present in table "users".', hint: undefined, position: undefined, internalPosition: undefined, internalQuery: undefined, where: undefined, schema: 'public', table: 'datavault_tables', dataType: undefined, constraint: 'datavault_tables_owner_user_id_users_id_fk', file: 'ri_triggers.c', routine: 'ri_ReportViolation' }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[28/123]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should grant table permission
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:592:31
    590|         });
    591| 
    592|       expect(response.status).toBe(201);
       |                               ^
    593|       expect(response.body).toBeDefined();
    594|       expect(response.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[29/123]Î“Ã„Â»

 FAIL  tests/integration/datavault.autonumber.test.ts > DataVault Autonumber Integration Tests > should generate autonumber with prefix
error: function public.datavault_get_next_auto_number(uuid, uuid, integer) does not exist
 Î“Â¥Â» cn.parseErrorMessage node_modules/@neondatabase/serverless/index.mjs:1182:6
 Î“Â¥Â» cn.handlePacket node_modules/@neondatabase/serverless/index.mjs:1143:13
 Î“Â¥Â» cn.parse node_modules/@neondatabase/serverless/index.mjs:1127:36
 Î“Â¥Â» v.<anonymous> node_modules/@neondatabase/serverless/index.mjs:1190:16
 Î“Â¥Â» v.emit node_modules/@neondatabase/serverless/index.mjs:397:12
 Î“Â¥Â» WebSocket.<anonymous> node_modules/@neondatabase/serverless/index.mjs:987:80
 Î“Â¥Â» callListener node_modules/ws/lib/event-target.js:290:14
 Î“Â¥Â» WebSocket.onMessage node_modules/ws/lib/event-target.js:209:9
 Î“Â¥Â» Receiver.receiverOnMessage node_modules/ws/lib/websocket.js:1220:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { length: 250, severity: 'ERROR', code: '42883', detail: undefined, hint: 'No function matches the given name and argument types. You might need to add explicit type casts.', position: '8', internalPosition: undefined, internalQuery: undefined, where: undefined, schema: undefined, table: undefined, dataType: undefined, constraint: undefined, file: 'parse_func.c', routine: 'ParseFuncOrColumn' }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[30/123]Î“Ã„Â»

 FAIL  tests/integration/datavault.autonumber.test.ts > DataVault Autonumber Integration Tests > should generate autonumber with yearly reset format
AssertionError: expected 'INV-2026-003' to be 'INV-2026-005' // Object.is equality

Expected: "INV-2026-005"
Received: "INV-2026-003"

 Î“Â¥Â» tests/integration/datavault.autonumber.test.ts:157:46
    155| 
    156|     // Format should be: PREFIX-YEAR-PADDED_NUMBER
    157|     expect(row1.values[yearlyResetColumnId]).toBe(`INV-${currentYear}-Î“Ã‡Âª
       |                                              ^
    158| 
    159|     // Create second row

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[31/123]Î“Ã„Â»

 FAIL  tests/integration/js_helpers.test.ts > Detailed Verification: JS Helper Availability > should execute a JS block that uses helper functions
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/js_helpers.test.ts:136:31
    134|         // 3. Create a Run
    135|         const runRes = await agent.post(`/api/workflows/${workflowId}/Î“Ã‡Âª
    136|         expect(runRes.status).toBe(201); // 201 Created
       |                               ^
    137|         const runId = runRes.body.id;
    138| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[32/123]Î“Ã„Â»

 FAIL  tests/integration/metrics.test.ts > Metrics Integration > should expose /metrics endpoint
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/metrics.test.ts:33:33
     31|         const response = await request(app).get('/metrics');
     32| 
     33|         expect(response.status).toBe(200);
       |                                 ^
     34|         expect(response.headers['content-type']).toContain('text/plainÎ“Ã‡Âª
     35|         // Prometheus metrics usually contain comments like # HELP or Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[33/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should complete full MFA setup flow
TypeError: Cannot read properties of undefined (reading 'mfaEnabled')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:41:47
     39| 
     40|       const token = (loginResponse.body as any).token;
     41|       expect((loginResponse.body as any).user.mfaEnabled).toBe(false);
       |                                               ^
     42| 
     43|       // Step 2: Setup MFA

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[34/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should reject invalid TOTP code during setup
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:117:37
    115|         .send({ token: "000000" }); // Invalid code
    116| 
    117|       expect(verifyResponse.status).toBe(400);
       |                                     ^
    118|       expect(verifyResponse.body.message).toContain("Invalid");
    119| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[35/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should not allow MFA setup if already enabled
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:135:46
    133|         .send({ email, password });
    134| 
    135|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    136| 
    137|       // Can't test setup with MFA user since we can't login without MÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[36/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should generate unique backup codes
AssertionError: expected +0 to be 10 // Object.is equality

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:156:32
    154|       // All codes should be unique
    155|       const uniqueCodes = new Set(backupCodes);
    156|       expect(uniqueCodes.size).toBe(10);
       |                                ^
    157|     });
    158| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[37/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should store hashed backup codes
AssertionError: expected [] to have a length of 10 but got +0

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:177:27
    175|       });
    176| 
    177|       expect(storedCodes).toHaveLength(10);
       |                           ^
    178| 
    179|       // Hashes should not match plain codes

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[38/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should require MFA for enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:195:36
    193|         .send({ email, password });
    194| 
    195|       expect(loginResponse.status).toBe(200);
       |                                    ^
    196|       expect(loginResponse.body.requiresMfa).toBe(true);
    197|       expect(loginResponse.body.userId).toBe(userId);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[39/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should complete MFA login with valid TOTP
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:209:46
    207|         .send({ email, password });
    208| 
    209|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    210| 
    211|       // Step 2: Verify MFA

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[40/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should accept TOTP codes within 60-second window
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:264:32
    262|         .send({ userId, token: totpCode });
    263| 
    264|       expect(response1.status).toBe(200);
       |                                ^
    265| 
    266|       // Login again for second test

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[41/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should login with valid backup code
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:305:52
    303|       });
    304| 
    305|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    306| 
    307|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[42/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should mark backup code as used
TypeError: Cannot read properties of undefined (reading 'used')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:346:29
    344| 
    345|       // For this test, let's verify the used flag logic
    346|       expect(storedCodes[0].used).toBe(false);
       |                             ^
    347| 
    348|       // After using a code, it should be marked as used

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[43/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should prevent backup code reuse
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:375:52
    373|       });
    374| 
    375|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    376| 
    377|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[44/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should try TOTP before backup code
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:430:31
    428| 
    429|       // Should succeed with TOTP (backup code ignored)
    430|       expect(response.status).toBe(200);
       |                               ^
    431|     });
    432|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[45/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Status > should return backup codes count for MFA users
Error: [TEST UTILS] MFA Secret verification failed for 035ebc79c24dda5293793f74db01ae0f
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:452:43

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[46/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should disable MFA with password verification
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:510:38
    508|         .send({ password });
    509| 
    510|       expect(disableResponse.status).toBe(200);
       |                                      ^
    511| 
    512|       // Verify MFA is disabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[47/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should require correct password to disable MFA
AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:557:44
    555| 
    556|       expect(disableResponse.status).toBe(401);
    557|       expect(disableResponse.body.message).toContain("Invalid passwordÎ“Ã‡Âª
       |                                            ^
    558| 
    559|       // MFA should still be enabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[48/123]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should regenerate backup codes
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:588:41
    586|         .set("Authorization", `Bearer ${token}`);
    587| 
    588|       expect(regenerateResponse.status).toBe(200);
       |                                         ^
    589|       expect(regenerateResponse.body.backupCodes).toHaveLength(10);
    590| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[49/123]Î“Ã„Â»

 FAIL  tests/integration/organizationInvites.test.ts > Organization Invites > createInvite > should create placeholder user for non-existent email
 FAIL  tests/integration/organizationInvites.test.ts > Organization Invites > createInvite > should require admin access to create invite
error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/organizationInvites.test.ts:43:9
     41|             )
     42|         );
     43|         await db.delete(users).where(inArray(users.id, [adminUserId, eÎ“Ã‡Âª
       |         ^
     44| 
     45|         await db.insert(users).values([

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { length: 335, severity: 'ERROR', code: '23503', detail: 'Key (id)=(00000000-0000-0000-0000-000000000021) is still referenced from table "audit_logs".', hint: undefined, position: undefined, internalPosition: undefined, internalQuery: undefined, where: undefined, schema: 'public', table: 'audit_logs', dataType: undefined, constraint: 'audit_logs_user_id_users_id_fk', file: 'ri_triggers.c', routine: 'ri_ReportViolation' }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[50/123]Î“Ã„Â»

 FAIL  tests/integration/organizationInvites.test.ts > Organization Invites > createInvite > should create invite for existing user without creating placeholder
AssertionError: expected undefined to be false // Object.is equality

- Expected: 
false

+ Received: 
undefined

 Î“Â¥Â» tests/integration/organizationInvites.test.ts:112:41
    110|             });
    111| 
    112|             expect(user?.isPlaceholder).toBe(false);
       |                                         ^
    113| 
    114|             createdInviteId = result.inviteId;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[51/123]Î“Ã„Â»

 FAIL  tests/integration/organizationInvites.test.ts > Organization Invites > createInvite > should prevent duplicate pending invites
AssertionError: expected [Function] to throw error including 'Pending invite already exists' but got 'Access denied: Organization admin rolÎ“Ã‡Âª'

Expected: "Pending invite already exists"
Received: "Access denied: Organization admin role required"

 Î“Â¥Â» tests/integration/organizationInvites.test.ts:120:13
    118|             await organizationService.createInvite(testOrgId, newUserEÎ“Ã‡Âª
    119| 
    120|             await expect(
       |             ^
    121|                 organizationService.createInvite(testOrgId, newUserEmaÎ“Ã‡Âª
    122|             ).rejects.toThrow('Pending invite already exists');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[52/123]Î“Ã„Â»

 FAIL  tests/integration/organizationInvites.test.ts > Organization Invites > createInvite > should prevent inviting existing members
Error: Access denied: Organization admin role required
 Î“Â¥Â» requireOrgAdmin server/utils/ownershipAccess.ts:194:11
    192|   const isAdmin = await canManageOrg(userId, orgId);
    193|   if (!isAdmin) {
    194|     throw new Error('Access denied: Organization admin role required');
       |           ^
    195|   }
    196| }
 Î“Â¥Â» OrganizationService.addMember server/services/OrganizationService.ts:404:5
 Î“Â¥Â» tests/integration/organizationInvites.test.ts:127:13

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[53/123]Î“Ã„Â»

 FAIL  tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #1: Project transfer cascades runs ownership > should cascade ownership to workflow runs when project is transferred
ReferenceError: workflows is not defined
 Î“Â¥Â» tests/integration/organizations-audit-fixes.test.ts:151:23
    149|       // Cleanup
    150|       await db.delete(workflowRuns).where(eq(workflowRuns.id, run.id));
    151|       await db.delete(workflows).where(eq(workflows.id, workflow.id));
       |                       ^
    152|       await db.delete(projects).where(eq(projects.id, project.id));
    153|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[54/123]Î“Ã„Â»

 FAIL  tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #7: Delete organization > should prevent deletion if org owns assets
ReferenceError: workflows is not defined
 Î“Â¥Â» tests/integration/organizations-audit-fixes.test.ts:279:23
    277| 
    278|       // Cleanup
    279|       await db.delete(workflows).where(eq(workflows.id, workflow.id));
       |                       ^
    280|       await db.delete(organizationMemberships).where(eq(organizationMeÎ“Ã‡Âª
    281|       await db.delete(organizations).where(eq(organizations.id, org.idÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[55/123]Î“Ã„Â»

 FAIL  tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #9: Transfer validation order > should fail fast on non-existent org
ReferenceError: workflows is not defined
 Î“Â¥Â» tests/integration/organizations-audit-fixes.test.ts:341:23
    339| 
    340|       // Cleanup
    341|       await db.delete(workflows).where(eq(workflows.id, workflow.id));
       |                       ^
    342|     });
    343|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[56/123]Î“Ã„Â»

 FAIL  tests/integration/ownershipAccess.test.ts > Ownership Access Control > isOrgMember > should return true for org admin
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/ownershipAccess.test.ts:117:24
    115| 
    116|       const isMember = await isOrgMember(userId1, orgId1);
    117|       expect(isMember).toBe(true);
       |                        ^
    118|     });
    119|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[57/123]Î“Ã„Â»

 FAIL  tests/integration/ownershipAccess.test.ts > Ownership Access Control > Cross-org Access Control > should allow member of multiple orgs to access all their org assets
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/ownershipAccess.test.ts:218:26
    216|       const hasAccess2 = await canAccessAsset(userId1, 'org', orgId2);
    217| 
    218|       expect(hasAccess1).toBe(true);
       |                          ^
    219|       expect(hasAccess2).toBe(true);
    220|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[58/123]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 1. Required + Show/Hide (Questions) > should NOT block Next when required question is hidden
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:197:31
    195|             // Check visibility
    196|             const isVisible = evaluateVisibilityExpression("show_triggÎ“Ã‡Âª
    197|             expect(isVisible).toBe(false);
       |                               ^
    198| 
    199|             // Required question is hidden, should not block

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[59/123]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 2. Required + Show/Hide (Pages) > should skip hidden required page entirely
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:330:31
    328|             const isVisible = evaluateVisibilityExpression((section2.vÎ“Ã‡Âª
    329| 
    330|             expect(isVisible).toBe(false); // Section 2 should be hiddÎ“Ã‡Âª
       |                               ^
    331| 
    332|             // Get all sections

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[60/123]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 3. Preview/Snapshot/Live Parity > should evaluate visibility consistently across modes
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:445:64
    443|             // Change data
    444|             const data2 = { trigger: false, value: 10 };
    445|             expect(evaluateVisibilityExpression(expr1, data2)).toBe(faÎ“Ã‡Âª
       |                                                                ^
    446|             expect(evaluateVisibilityExpression(expr2, data2)).toBe(trÎ“Ã‡Âª
    447|             expect(evaluateVisibilityExpression(expr3, data2)).toBe(faÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[61/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should list all active sessions for current user
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:53:31
     51|         .set("Authorization", `Bearer ${token}`);
     52| 
     53|       expect(response.status).toBe(200);
       |                               ^
     54|       expect(response.body.sessions).toBeDefined();
     55|       expect(response.body.sessions.length).toBe(3);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[62/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should mark current session correctly
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:85:30
     83|       const token = login2.body.token;
     84|       const cookies = (login2.headers as any)["set-cookie"] as string[Î“Ã‡Âª
     85|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
     86| 
     87|       // List sessions with cookie (should identify current session)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[63/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should exclude revoked sessions
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:120:50
    118|         .update(refreshTokens)
    119|         .set({ revoked: true })
    120|         .where(eq(refreshTokens.id, allTokens[0].id));
       |                                                  ^
    121| 
    122|       // List sessions

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[64/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should order sessions by last used (most recent first)
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:154:36
    152| 
    153|       // Should be ordered by lastUsedAt descending
    154|       for (let i = 1; i < sessions.length; i++) {
       |                                    ^
    155|         const prev = new Date(sessions[i - 1].lastUsedAt);
    156|         const curr = new Date(sessions[i].lastUsedAt);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[65/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should filter sessions by current user only
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:184:37
    182|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    183| 
    184|       expect(response.body.sessions.length).toBe(2);
       |                                     ^
    185|     });
    186| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[66/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should revoke specific session
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Î“Â¥Â» tests/integration/session.management.real.test.ts:222:37
    220|         .set("Authorization", `Bearer ${token}`);
    221| 
    222|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    223|       expect(revokeResponse.body.message).toContain("revoked");
    224| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[67/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
AssertionError: expected 200 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 200

 Î“Â¥Â» tests/integration/session.management.real.test.ts:266:37
    264|         .set("Authorization", `Bearer ${token}`);
    265| 
    266|       expect(revokeResponse.status).toBe(400);
       |                                     ^
    267|       expect(revokeResponse.body.message).toContain("current session");
    268|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[68/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking other user's session
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:303:49
    301|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    302| 
    303|       const user1SessionId = user1Sessions.body.sessions[0].id;
       |                                                 ^
    304| 
    305|       // Try to revoke user 1's session as user 2

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[69/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all other sessions
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:329:30
    327|       const token = currentLogin.body.token;
    328|       const cookies = (currentLogin.headers as any)["set-cookie"] as sÎ“Ã‡Âª
    329|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    330| 
    331|       // Revoke all except current

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[70/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should keep current session active
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:360:30
    358|       const token = currentLogin.body.token;
    359|       const cookies = (currentLogin.headers as any)["set-cookie"] as sÎ“Ã‡Âª
    360|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    361| 
    362|       // Revoke all others

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[71/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should return 400 if no active session found
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:397:31
    395|         .set("Authorization", `Bearer ${token}`);
    396| 
    397|       expect(response.status).toBe(400);
       |                               ^
    398|       expect(response.body.message).toContain("No active session");
    399|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[72/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should handle user with single session gracefully
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:441:30
    439|       const token = login.body.token;
    440|       const cookies = (login.headers as any)["set-cookie"] as string[];
    441|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    442| 
    443|       // Revoke all (but only one exists)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[73/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > Session Security > should include device metadata in sessions
TypeError: Cannot read properties of undefined (reading 'deviceName')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:478:22
    476|       const session = response.body.sessions[0];
    477| 
    478|       expect(session.deviceName).toBeDefined();
       |                      ^
    479|       expect(session.ipAddress).toBeDefined();
    480|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[74/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > Session Security > should not expose sensitive token data
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:493:37
    491|         .set("Authorization", `Bearer ${login.body.token}`);
    492| 
    493|       const session = response.body.sessions[0];
       |                                     ^
    494| 
    495|       // Should NOT include token hash or metadata

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[75/123]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > Session Security > should track session activity timestamps
TypeError: Cannot read properties of undefined (reading 'createdAt')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:513:22
    511|       const session = response.body.sessions[0];
    512| 
    513|       expect(session.createdAt).toBeDefined();
       |                      ^
    514|       expect(session.lastUsedAt).toBeDefined();
    515|       expect(new Date(session.createdAt)).toBeInstanceOf(Date);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[76/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should trust current device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:52:36
     50|         .set("X-Forwarded-For", "192.168.1.100");
     51| 
     52|       expect(trustResponse.status).toBe(200);
       |                                    ^
     53|       expect(trustResponse.body.message).toContain("trusted");
     54|       expect(trustResponse.body.trustedUntil).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[77/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should set trust expiry to 30 days
AssertionError: expected NaN to be 30 // Object.is equality

- Expected
+ Received

- 30
+ NaN

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:92:24
     90|       );
     91| 
     92|       expect(diffDays).toBe(30);
       |                        ^
     93|     });
     94| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[78/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should update expiry if device already trusted
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:132:42
    130| 
    131|       // Should have extended expiry
    132|       expect(secondExpiry > firstExpiry).toBe(true);
       |                                          ^
    133| 
    134|       // Should still only have 1 device record

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[79/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should list all trusted devices
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:193:31
    191|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    192| 
    193|       expect(response.status).toBe(200);
       |                               ^
    194|       expect(response.body.devices).toBeDefined();
    195|       expect(response.body.devices.length).toBe(2);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[80/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should mark current device
Error: [TEST UTILS] MFA Secret verification failed for 411762c67fbdd3586e9573b936311eda
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:210:55

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[81/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude revoked devices
Error: [TEST UTILS] MFA Secret verification failed for 86c1055a81d190b409fbcb08e302081d
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:241:55

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[82/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude expired devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:302:36
    300|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    301| 
    302|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    303|     });
    304|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[83/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should revoke specific device
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:332:45
    330|         .set("Authorization", `Bearer ${token}`);
    331| 
    332|       const deviceId = devicesResponse.body.devices[0].id;
       |                                             ^
    333| 
    334|       // Revoke device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[84/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should prevent revoking other user's device
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:399:43
    397|         .set("Authorization", `Bearer ${mfaLogin1.body.token}`);
    398| 
    399|       const user1DeviceId = devices1.body.devices[0].id;
       |                                           ^
    400| 
    401|       // User 2 tries to revoke user 1's device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[85/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should skip MFA for trusted device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:453:42
    451| 
    452|       // Should not require MFA
    453|       expect(secondLoginResponse.status).toBe(200);
       |                                          ^
    454|       expect(secondLoginResponse.body.requiresMfa).toBeUndefined();
    455|       expect(secondLoginResponse.body.token).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[86/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should require MFA for untrusted device
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:485:51
    483| 
    484|       // Should require MFA
    485|       expect(loginFromNewDevice.body.requiresMfa).toBe(true);
       |                                                   ^
    486|     });
    487| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[87/123]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should update lastUsedAt on trusted device login
TypeError: Cannot read properties of undefined (reading 'lastUsedAt')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:512:38
    510|       });
    511| 
    512|       const firstLastUsed = device1!.lastUsedAt;
       |                                      ^
    513| 
    514|       // Wait a bit

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[88/123]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should create a version and populate changelog
Error: Validation failed: Schema Error: id - Required, Schema Error: title - Required, Schema Error: pages.0.title - Required, Schema Error: pages.0.order - Required
 Î“Â¥Â» VersionService.publishVersion server/services/VersionService.ts:287:13
    285| 
    286|     if (!validation.valid && !force) {
    287|       throw new Error(`Validation failed: ${validation.errors.join(', Î“Ã‡Âª
       |             ^
    288|     }
    289| 
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:97:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[89/123]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should track execution lineage via snapshot
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:117:143
    115| 
    116|         // Create Snapshot
    117|         const snapshot = await snapshotService.createSnapshot(workflowÎ“Ã‡Âª
       |                                                                                                                                               ^
    118| 
    119|         expect(snapshot.workflowVersionId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[90/123]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:68:43
     66| 
     67|       // Should be validating immediately
     68|       expect(result.current.isValidating).toBe(true);
       |                                           ^
     69| 
     70|       // Wait for debounce and validation

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[91/123]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:114:38
    112|       );
    113| 
    114|       expect(result.current.isValid).toBe(false);
       |                                      ^
    115|       expect(result.current.errors.length).toBeGreaterThan(0);
    116|       expect(result.current.errors[0].message).toContain('unknown_var'Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[92/123]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate helper functions in expressions
AssertionError: expected null not to be null

Ignored nodes: comments, script, style
<html>
  <head />
  <body>
    <div />
  </body>
</html>
 Î“Â¥Â» timeout tests/ui/expression-editor.test.tsx:180:55
    178|       await waitFor(
    179|         () => {
    180|           expect(result.current.validationResult).not.toBeNull();
       |                                                       ^
    181|         },
    182|         { timeout: 200 }
 Î“Â¥Â» runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:47:12
 Î“Â¥Â» checkCallback node_modules/@testing-library/dom/dist/wait-for.js:124:77
 Î“Â¥Â» Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:118:16

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[93/123]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
AssertionError: expected null not to be null

Ignored nodes: comments, script, style
<html>
  <head />
  <body>
    <div />
  </body>
</html>
 Î“Â¥Â» timeout tests/ui/expression-editor.test.tsx:283:55
    281|       await waitFor(
    282|         () => {
    283|           expect(result.current.validationResult).not.toBeNull();
       |                                                       ^
    284|         },
    285|         { timeout: 200 }
 Î“Â¥Â» runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:47:12
 Î“Â¥Â» checkCallback node_modules/@testing-library/dom/dist/wait-for.js:124:77
 Î“Â¥Â» Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:118:16

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[94/123]Î“Ã„Â»

 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
ReferenceError: React is not defined
 Î“Â¥Â» RunsTable client/src/components/runs/RunsTable.tsx:41:3
     39|   };
     40| 
     41|   return (
       |   ^
     42|     <div className="rounded-md border">
     43|       <Table>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[95/123]Î“Ã„Â»

 FAIL  tests/unit/docxRenderer.test.ts > DOCX Renderer Service > extractPlaceholdersFromDocx > should extract placeholders from a template
ApiError: Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found
 Î“Â¥Â» Object.notFound server/utils/errors.ts:88:12
     86|   notFound(resource: string, id?: string, details?: any): ApiError {
     87|     const message = id ? `${resource} with id '${id}' not found` : `${Î“Ã‡Âª
     88|     return new ApiError(ErrorCode.NOT_FOUND, message, details, 404);
       |            ^
     89|   },
     90| 
 Î“Â¥Â» extractPlaceholdersFromDocx server/services/docxRenderer.ts:245:25
 Î“Â¥Â» tests/unit/docxRenderer.test.ts:97:28

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { error: { code: 'NOT_FOUND', message: 'Template file with id \'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx\' not found', details: undefined } }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[96/123]Î“Ã„Â»

 FAIL  tests/unit/docxRenderer.test.ts > DOCX Renderer Service > extractPlaceholdersFromDocx > should extract placeholders including formatters
ApiError: Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\formatters-template.docx' not found
 Î“Â¥Â» Object.notFound server/utils/errors.ts:88:12
     86|   notFound(resource: string, id?: string, details?: any): ApiError {
     87|     const message = id ? `${resource} with id '${id}' not found` : `${Î“Ã‡Âª
     88|     return new ApiError(ErrorCode.NOT_FOUND, message, details, 404);
       |            ^
     89|   },
     90| 
 Î“Â¥Â» extractPlaceholdersFromDocx server/services/docxRenderer.ts:245:25
 Î“Â¥Â» tests/unit/docxRenderer.test.ts:106:28

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { error: { code: 'NOT_FOUND', message: 'Template file with id \'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\formatters-template.docx\' not found', details: undefined } }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[97/123]Î“Ã„Â»

 FAIL  tests/unit/docxRenderer.test.ts > DOCX Renderer Service > renderDocx > should render a template with simple data
ApiError: Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found
 Î“Â¥Â» Object.notFound server/utils/errors.ts:88:12
     86|   notFound(resource: string, id?: string, details?: any): ApiError {
     87|     const message = id ? `${resource} with id '${id}' not found` : `${Î“Ã‡Âª
     88|     return new ApiError(ErrorCode.NOT_FOUND, message, details, 404);
       |            ^
     89|   },
     90| 
 Î“Â¥Â» renderDocx server/services/docxRenderer.ts:51:23
 Î“Â¥Â» tests/unit/docxRenderer.test.ts:156:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { error: { code: 'NOT_FOUND', message: 'Template file with id \'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx\' not found', details: undefined } }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[98/123]Î“Ã„Â»

 FAIL  tests/unit/docxRenderer.test.ts > DOCX Renderer Service > renderDocx > should use formatters in templates
ApiError: Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\formatters-template.docx' not found
 Î“Â¥Â» Object.notFound server/utils/errors.ts:88:12
     86|   notFound(resource: string, id?: string, details?: any): ApiError {
     87|     const message = id ? `${resource} with id '${id}' not found` : `${Î“Ã‡Âª
     88|     return new ApiError(ErrorCode.NOT_FOUND, message, details, 404);
       |            ^
     89|   },
     90| 
 Î“Â¥Â» renderDocx server/services/docxRenderer.ts:51:23
 Î“Â¥Â» tests/unit/docxRenderer.test.ts:193:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { error: { code: 'NOT_FOUND', message: 'Template file with id \'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\formatters-template.docx\' not found', details: undefined } }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[99/123]Î“Ã„Â»

 FAIL  tests/unit/docxRenderer.test.ts > DOCX Renderer Service > renderDocx > should handle missing data gracefully
ApiError: Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found
 Î“Â¥Â» Object.notFound server/utils/errors.ts:88:12
     86|   notFound(resource: string, id?: string, details?: any): ApiError {
     87|     const message = id ? `${resource} with id '${id}' not found` : `${Î“Ã‡Âª
     88|     return new ApiError(ErrorCode.NOT_FOUND, message, details, 404);
       |            ^
     89|   },
     90| 
 Î“Â¥Â» renderDocx server/services/docxRenderer.ts:51:23
 Î“Â¥Â» tests/unit/docxRenderer.test.ts:221:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { error: { code: 'NOT_FOUND', message: 'Template file with id \'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx\' not found', details: undefined } }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[100/123]Î“Ã„Â»

 FAIL  tests/unit/docxRenderer.test.ts > DOCX Renderer Service > renderDocx > should use custom output name
ApiError: Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found
 Î“Â¥Â» Object.notFound server/utils/errors.ts:88:12
     86|   notFound(resource: string, id?: string, details?: any): ApiError {
     87|     const message = id ? `${resource} with id '${id}' not found` : `${Î“Ã‡Âª
     88|     return new ApiError(ErrorCode.NOT_FOUND, message, details, 404);
       |            ^
     89|   },
     90| 
 Î“Â¥Â» renderDocx server/services/docxRenderer.ts:51:23
 Î“Â¥Â» tests/unit/docxRenderer.test.ts:246:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { error: { code: 'NOT_FOUND', message: 'Template file with id \'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx\' not found', details: undefined } }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[101/123]Î“Ã„Â»

 FAIL  tests/unit/docxRenderer.test.ts > DOCX Renderer Service > PDF conversion > should attempt PDF conversion when requested
ApiError: Template file with id 'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx' not found
 Î“Â¥Â» Object.notFound server/utils/errors.ts:88:12
     86|   notFound(resource: string, id?: string, details?: any): ApiError {
     87|     const message = id ? `${resource} with id '${id}' not found` : `${Î“Ã‡Âª
     88|     return new ApiError(ErrorCode.NOT_FOUND, message, details, 404);
       |            ^
     89|   },
     90| 
 Î“Â¥Â» renderDocx server/services/docxRenderer.ts:51:23
 Î“Â¥Â» tests/unit/docxRenderer.test.ts:265:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
Serialized Error: { error: { code: 'NOT_FOUND', message: 'Template file with id \'C:\Users\scoot\poll\VaultLogic\tests\fixtures\templates\simple-template.docx\' not found', details: undefined } }
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[102/123]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should allow anonymous access to public workflows
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:466:18
    464|             const publicRes = await request(ctx.baseURL)
    465|                 .get(`/public/w/${publicSlug}`)
    466|                 .expect(200);
       |                  ^
    467| 
    468|             // Public route returns { id, title, publicSettings... }
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[103/123]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should attach user info if authenticated on optional auth routes
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:497:18
    495|                 .get(`/public/w/${optionalSlug}`)
    496|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    497|                 .expect(200);
       |                  ^
    498| 
    499|             // Response should include user context if available (checÎ“Ã‡Âª
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[104/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > GET /api/auth/sessions - List Active Sessions > should list all active sessions for current user
AssertionError: expected 0 to be greater than or equal to 2
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:110:45
    108|       expect(response.status).toBe(200);
    109|       expect(response.body.sessions).toBeInstanceOf(Array);
    110|       expect(response.body.sessions.length).toBeGreaterThanOrEqual(2);
       |                                             ^
    111| 
    112|       // Verify session structure

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[105/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > GET /api/auth/sessions - List Active Sessions > should mark current session as current
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:135:30
    133| 
    134|       const currentSession = response.body.sessions.find((s: any) => sÎ“Ã‡Âª
    135|       expect(currentSession).toBeDefined();
       |                              ^
    136|     });
    137| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[106/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should revoke a specific session
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:226:29
    224|       });
    225| 
    226|       expect(sessionRecord).toBeDefined();
       |                             ^
    227| 
    228|       const response = await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[107/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/all - Logout All Other Devices > should revoke all sessions except current
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:332:37
    330|         ));
    331| 
    332|       expect(activeSessions.length).toBe(1);
       |                                     ^
    333|       expect(activeSessions[0].token).toBe(hashToken(currentToken));
    334|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[108/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > DELETE /api/auth/trusted-devices/:deviceId > should revoke a trusted device
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:528:40
    526|           where: eq(trustedDevices.id, device.id),
    527|         });
    528|         expect(updatedDevice?.revoked).toBe(true);
       |                                        ^
    529|       });
    530| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[109/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should rotate refresh token after use
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:119:31
    117|         .set('Cookie', `refresh_token=${testRefreshToken}`);
    118| 
    119|       expect(response.status).toBe(200);
       |                               ^
    120| 
    121|       // Extract new refresh token from cookie

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[110/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should update refresh token metadata on rotation
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:235:24
    233|       });
    234| 
    235|       expect(newToken).toBeDefined();
       |                        ^
    236|       expect(newToken?.lastUsedAt).toBeDefined();
    237|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[111/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should create refresh token on login
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:316:31
    314|         });
    315| 
    316|       expect(response.status).toBe(200);
       |                               ^
    317| 
    318|       // Verify refresh token cookie is set

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[112/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should revoke refresh token on logout
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:343:30
    341|         where: eq(refreshTokens.token, hashToken(testRefreshToken)),
    342|       });
    343|       expect(token?.revoked).toBe(true);
       |                              ^
    344| 
    345|       // Verify cookie is cleared

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[113/123]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should support multiple active refresh tokens per user
AssertionError: expected 0 to be greater than or equal to 3
 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:378:35
    376|         ));
    377| 
    378|       expect(activeTokens.length).toBeGreaterThanOrEqual(3);
       |                                   ^
    379|     });
    380| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[114/123]Î“Ã„Â»


[2m Test Files [22m [1m[31m27 failed[39m[22m[2m | [22m[1m[32m128 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (156)[39m
[2m      Tests [22m [1m[31m121 failed[39m[22m[2m | [22m[1m[32m2455 passed[39m[22m[2m | [22m[33m28 skipped[39m[90m (2604)[39m
[2m   Start at [22m 17:35:30
[2m   Duration [22m 166.13s[2m (transform 360.17s, setup 95.47s, import 1032.84s, tests 941.52s, environment 52.92s)[22m

