# Lifecycle Hooks

Lifecycle Hooks allow you to inject logic that runs automatically when certain workflow events occur. Unlike JS Blocks, they are not visible in the workflow graph but run "behind the scenes."

## Available Hooks

### 1. `beforePage`
- **Trigger**: Before a new page (section) of questions is rendered to the user.
- **Use Case**: Pre-calculating default values, skipping pages dynamically based on complex logic (though Branch blocks are preferred for skips).
- **Mutability**: Can modify variables passed to the page (e.g., defaults).

### 2. `afterPage`
- **Trigger**: After the user submits a page, before moving to the next block.
- **Use Case**: Validating complex multi-field constraints (e.g., "End Date must be after Start Date"), sanitizing inputs.
- **Mutability**: Can modify answer data before it is saved to the run state.

### 3. `beforeFinalBlock`
- **Trigger**: Just before the Final Block (document generation/terminal screen) begins execution.
- **Use Case**: Final data cleanup, aggregating totals from all previous sections.

### 4. `afterDocumentsGenerated`
- **Trigger**: Immediately after documents are successfully generated by a Final Block.
- **Use Case**: Sending custom notifications (via helper), logging completion metadata, triggering external systems.

## Configuration

Hooks are configured in the **Advanced Settings** panel of the Workflow Editor.

| Setting | Description |
|Observed|---|
| **Phase** | When the hook runs (see above). |
| **Language** | JavaScript or Python. |
| **Mutation Mode** | If enabled, the script's output is merged back into the workflow variables. |
| **Input Keys** | Specific variables available to the script (whitelist). |
| **Output Keys** | Specific variables the script is allowed to update (whitelist). |

## Example: Validation Hook (`afterPage`)

**Goal**: ensure total percentage equals 100%.

```javascript
// Input Keys: ["equity_founder", "equity_investor", "equity_pool"]
const total = input.equity_founder + input.equity_investor + input.equity_pool;

if (total !== 100) {
  throw new Error(`Total equity must be 100%. Current: ${total}%`);
}
```

If a hook throws an error:
- The workflow **pauses** (stops).
- The error is displayed to the user (if `afterPage`) or logged (if internal).
