npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.
 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1768065379855,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/auth/session.management.integration.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768065384816,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768065384830,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768065384822,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768065384822,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768065384826,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768065384830,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768065384830,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768065384830,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768065384830,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768065385296,"env":"test","module":"user-credentials-repository","userId":"a225c0fc-f5e1-459b-b138-3c00b05f9ebe","msg":"User credentials created"}
{"level":30,"time":1768065385401,"env":"test","module":"email-queue","jobId":"a6a43f2f-31b1-4e3d-ad5e-495f610ffac3","to":"test--OFjJVRF4TF3j-lcSOYfb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065385458,"env":"test","module":"auth-routes","userId":"a225c0fc-f5e1-459b-b138-3c00b05f9ebe","email":"test--OFjJVRF4TF3j-lcSOYfb@example.com","msg":"User registered"}
{"level":30,"time":1768065385985,"env":"test","module":"user-credentials-repository","userId":"1183f21d-a08a-4d22-934f-3228a6a55eb7","msg":"User credentials created"}
{"level":30,"time":1768065386090,"env":"test","module":"email-queue","jobId":"86799ec8-7c22-4c92-b8d6-2b8330119087","to":"session-test-oH2VsAbKXK3y_Cu-Zm21p@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065386143,"env":"test","module":"auth-routes","userId":"1183f21d-a08a-4d22-934f-3228a6a55eb7","email":"session-test-oH2VsAbKXK3y_Cu-Zm21p@example.com","msg":"User registered"}
{"level":30,"time":1768065386717,"env":"test","module":"auth-routes","userId":"1183f21d-a08a-4d22-934f-3228a6a55eb7","msg":"User logged in successfully"}
{"level":30,"time":1768065386768,"env":"test","module":"audit-log-service","userId":"1183f21d-a08a-4d22-934f-3228a6a55eb7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065387185,"env":"test","module":"user-credentials-repository","userId":"66cd050d-1b01-4149-8093-357c2af522c4","msg":"User credentials created"}
{"level":30,"time":1768065387302,"env":"test","module":"email-queue","jobId":"03c0da82-2dd4-4aed-8508-efd6c8f583e1","to":"session-test-ZIIwlpGauKdjpx9VAL7mO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065387354,"env":"test","module":"auth-routes","userId":"66cd050d-1b01-4149-8093-357c2af522c4","email":"session-test-ZIIwlpGauKdjpx9VAL7mO@example.com","msg":"User registered"}
{"level":30,"time":1768065387954,"env":"test","module":"auth-routes","userId":"66cd050d-1b01-4149-8093-357c2af522c4","msg":"User logged in successfully"}
{"level":30,"time":1768065388006,"env":"test","module":"audit-log-service","userId":"66cd050d-1b01-4149-8093-357c2af522c4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065388421,"env":"test","module":"user-credentials-repository","userId":"7628eab2-8c83-4cb4-ab1b-2918e335dbcc","msg":"User credentials created"}
{"level":30,"time":1768065388523,"env":"test","module":"email-queue","jobId":"729bcfed-b98f-403a-ac31-fce862491248","to":"session-test-s3g_YTB091UCAlApHx3-T@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065388576,"env":"test","module":"auth-routes","userId":"7628eab2-8c83-4cb4-ab1b-2918e335dbcc","email":"session-test-s3g_YTB091UCAlApHx3-T@example.com","msg":"User registered"}
{"level":30,"time":1768065389147,"env":"test","module":"auth-routes","userId":"7628eab2-8c83-4cb4-ab1b-2918e335dbcc","msg":"User logged in successfully"}
{"level":30,"time":1768065389201,"env":"test","module":"audit-log-service","userId":"7628eab2-8c83-4cb4-ab1b-2918e335dbcc","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065389669,"env":"test","module":"auth-routes","userId":"7628eab2-8c83-4cb4-ab1b-2918e335dbcc","msg":"User logged in successfully"}
{"level":30,"time":1768065389720,"env":"test","module":"audit-log-service","userId":"7628eab2-8c83-4cb4-ab1b-2918e335dbcc","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065390187,"env":"test","module":"auth-routes","userId":"7628eab2-8c83-4cb4-ab1b-2918e335dbcc","msg":"User logged in successfully"}
{"level":30,"time":1768065390238,"env":"test","module":"audit-log-service","userId":"7628eab2-8c83-4cb4-ab1b-2918e335dbcc","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065390663,"env":"test","module":"user-credentials-repository","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","msg":"User credentials created"}
{"level":30,"time":1768065390763,"env":"test","module":"email-queue","jobId":"09d3963f-3dd3-4057-ba45-7d4a24e9412a","to":"session-test-zR4tUYVt4jQonGGRhCHo_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065390828,"env":"test","module":"auth-routes","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","email":"session-test-zR4tUYVt4jQonGGRhCHo_@example.com","msg":"User registered"}
{"level":30,"time":1768065391393,"env":"test","module":"auth-routes","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","msg":"User logged in successfully"}
{"level":30,"time":1768065391446,"env":"test","module":"audit-log-service","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065391905,"env":"test","module":"auth-routes","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","msg":"User logged in successfully"}
{"level":30,"time":1768065391962,"env":"test","module":"audit-log-service","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065392425,"env":"test","module":"auth-routes","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","msg":"User logged in successfully"}
{"level":30,"time":1768065392480,"env":"test","module":"audit-log-service","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065392591,"env":"test","module":"auth-routes","userId":"31fcf3c5-efc6-4b2b-ae3f-18d8323863fa","sessionCount":3,"msg":"Listed active sessions"}
{"level":30,"time":1768065392956,"env":"test","module":"user-credentials-repository","userId":"1168ce7e-7898-4528-9f11-7bdab3a942a7","msg":"User credentials created"}
{"level":30,"time":1768065393058,"env":"test","module":"email-queue","jobId":"8f1c548f-36b2-4ad0-947f-f0941010441d","to":"session-test-L7Am3Mk-nlttOwT3DTY4E@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065393108,"env":"test","module":"auth-routes","userId":"1168ce7e-7898-4528-9f11-7bdab3a942a7","email":"session-test-L7Am3Mk-nlttOwT3DTY4E@example.com","msg":"User registered"}
{"level":30,"time":1768065393675,"env":"test","module":"auth-routes","userId":"1168ce7e-7898-4528-9f11-7bdab3a942a7","msg":"User logged in successfully"}
{"level":30,"time":1768065393728,"env":"test","module":"audit-log-service","userId":"1168ce7e-7898-4528-9f11-7bdab3a942a7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065394200,"env":"test","module":"auth-routes","userId":"1168ce7e-7898-4528-9f11-7bdab3a942a7","msg":"User logged in successfully"}
{"level":30,"time":1768065394249,"env":"test","module":"audit-log-service","userId":"1168ce7e-7898-4528-9f11-7bdab3a942a7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065394354,"env":"test","module":"auth-routes","userId":"1168ce7e-7898-4528-9f11-7bdab3a942a7","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768065394725,"env":"test","module":"user-credentials-repository","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","msg":"User credentials created"}
{"level":30,"time":1768065394829,"env":"test","module":"email-queue","jobId":"f6fccb41-2177-47eb-a6c0-e0ef3568a0ab","to":"session-test-6oyWcOcJETUQQW63s3jS0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065394880,"env":"test","module":"auth-routes","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","email":"session-test-6oyWcOcJETUQQW63s3jS0@example.com","msg":"User registered"}
{"level":30,"time":1768065395454,"env":"test","module":"auth-routes","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","msg":"User logged in successfully"}
{"level":30,"time":1768065395506,"env":"test","module":"audit-log-service","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065395974,"env":"test","module":"auth-routes","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","msg":"User logged in successfully"}
{"level":30,"time":1768065396026,"env":"test","module":"audit-log-service","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065396126,"env":"test","module":"auth-routes","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768065396276,"env":"test","module":"auth-routes","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","sessionId":"9952fb41-de13-4e0f-97a0-bd84812310a1","msg":"Session revoked"}
{"level":30,"time":1768065396387,"env":"test","module":"auth-routes","userId":"13c96eb5-e598-4a47-b871-03f0f0a39ee7","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768065396755,"env":"test","module":"user-credentials-repository","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","msg":"User credentials created"}
{"level":30,"time":1768065396858,"env":"test","module":"email-queue","jobId":"2d610540-3f41-43c9-982a-ddc14fc17e92","to":"session-test-fqmybLEnt2o4TvO_srb5_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065396911,"env":"test","module":"auth-routes","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","email":"session-test-fqmybLEnt2o4TvO_srb5_@example.com","msg":"User registered"}
{"level":30,"time":1768065397475,"env":"test","module":"auth-routes","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","msg":"User logged in successfully"}
{"level":30,"time":1768065397531,"env":"test","module":"audit-log-service","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065398089,"env":"test","module":"auth-routes","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","msg":"User logged in successfully"}
{"level":30,"time":1768065398140,"env":"test","module":"audit-log-service","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065398704,"env":"test","module":"auth-routes","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","msg":"User logged in successfully"}
{"level":30,"time":1768065398762,"env":"test","module":"audit-log-service","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065398873,"env":"test","module":"auth-routes","userId":"87d35c26-3b76-4c4c-aaa9-3930df067fe1","sessionCount":3,"msg":"Listed active sessions"}
{"level":30,"time":1768065399242,"env":"test","module":"user-credentials-repository","userId":"d613a57e-9e3c-429e-bbcb-e54ae19e8650","msg":"User credentials created"}
{"level":30,"time":1768065399347,"env":"test","module":"email-queue","jobId":"eef79bc0-83fa-488a-a6f2-dac73f50c506","to":"session-test-NVH4avfv88TksU3yukbLD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065399398,"env":"test","module":"auth-routes","userId":"d613a57e-9e3c-429e-bbcb-e54ae19e8650","email":"session-test-NVH4avfv88TksU3yukbLD@example.com","msg":"User registered"}
{"level":50,"time":1768065399506,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768065399874,"env":"test","module":"user-credentials-repository","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","msg":"User credentials created"}
{"level":30,"time":1768065399974,"env":"test","module":"email-queue","jobId":"67aecf45-8f5c-4f20-a40f-f7b31de5557c","to":"session-test-sXfPFn1yH7cVUoG7fFTxf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065400022,"env":"test","module":"auth-routes","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","email":"session-test-sXfPFn1yH7cVUoG7fFTxf@example.com","msg":"User registered"}
{"level":30,"time":1768065400587,"env":"test","module":"auth-routes","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","msg":"User logged in successfully"}
{"level":30,"time":1768065400640,"env":"test","module":"audit-log-service","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065401115,"env":"test","module":"auth-routes","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","msg":"User logged in successfully"}
{"level":30,"time":1768065401168,"env":"test","module":"audit-log-service","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065401270,"env":"test","module":"auth-routes","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768065401419,"env":"test","module":"auth-routes","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","sessionId":"4ba675fc-cba1-4f46-8998-7c44a2455fe0","msg":"Session revoked"}
{"level":40,"time":1768065401469,"env":"test","module":"auth-service","userId":"bfeca9a1-0567-4fcc-bb6b-ec7b6f7eacc8","tokenHash":"107fec0409a22595cb4399e908f86980f71a2944a28a9b5253449d7853a92641","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768065401886,"env":"test","module":"user-credentials-repository","userId":"33540366-fed0-4b8a-8462-11d813d39520","msg":"User credentials created"}
{"level":30,"time":1768065401996,"env":"test","module":"email-queue","jobId":"7e32f0f5-767d-4827-b5ef-b6d8add98a09","to":"session-test-xoKwImUk2FIIjSHSfkYg8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065402058,"env":"test","module":"auth-routes","userId":"33540366-fed0-4b8a-8462-11d813d39520","email":"session-test-xoKwImUk2FIIjSHSfkYg8@example.com","msg":"User registered"}
{"level":30,"time":1768065402620,"env":"test","module":"auth-routes","userId":"33540366-fed0-4b8a-8462-11d813d39520","msg":"User logged in successfully"}
{"level":30,"time":1768065402671,"env":"test","module":"audit-log-service","userId":"33540366-fed0-4b8a-8462-11d813d39520","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065402781,"env":"test","module":"auth-routes","userId":"33540366-fed0-4b8a-8462-11d813d39520","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768065403239,"env":"test","module":"user-credentials-repository","userId":"9fedde6b-1cd4-4fe2-8f17-c76a9a309dd2","msg":"User credentials created"}
{"level":30,"time":1768065403343,"env":"test","module":"email-queue","jobId":"6b118400-05c5-4152-9bda-25c148c65e60","to":"session-test-Gld_BwG8EyVn-heXQGtbj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065403397,"env":"test","module":"auth-routes","userId":"9fedde6b-1cd4-4fe2-8f17-c76a9a309dd2","email":"session-test-Gld_BwG8EyVn-heXQGtbj@example.com","msg":"User registered"}
{"level":30,"time":1768065403877,"env":"test","module":"user-credentials-repository","userId":"7be16127-13ad-49da-9b7f-2b3bdb8855ae","msg":"User credentials created"}
{"level":30,"time":1768065403982,"env":"test","module":"email-queue","jobId":"9e6575ab-094a-4bc6-8bd8-e31480a39db9","to":"user2-4WWQ2nrJmJZIpFt8zWTBt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065404030,"env":"test","module":"auth-routes","userId":"7be16127-13ad-49da-9b7f-2b3bdb8855ae","email":"user2-4WWQ2nrJmJZIpFt8zWTBt@example.com","msg":"User registered"}
{"level":30,"time":1768065404574,"env":"test","module":"auth-routes","userId":"7be16127-13ad-49da-9b7f-2b3bdb8855ae","msg":"User logged in successfully"}
{"level":30,"time":1768065404626,"env":"test","module":"audit-log-service","userId":"7be16127-13ad-49da-9b7f-2b3bdb8855ae","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065404738,"env":"test","module":"auth-routes","userId":"7be16127-13ad-49da-9b7f-2b3bdb8855ae","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768065405201,"env":"test","module":"auth-routes","userId":"9fedde6b-1cd4-4fe2-8f17-c76a9a309dd2","msg":"User logged in successfully"}
{"level":30,"time":1768065405252,"env":"test","module":"audit-log-service","userId":"9fedde6b-1cd4-4fe2-8f17-c76a9a309dd2","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065405719,"env":"test","module":"user-credentials-repository","userId":"77cf7b8e-15fd-4b91-862d-be48ed8a0e03","msg":"User credentials created"}
{"level":30,"time":1768065405830,"env":"test","module":"email-queue","jobId":"2069e0f5-0837-439c-8bc8-31cdccd07ee9","to":"session-test-O6TdH9J4fgRPs3CvaduGd@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065405884,"env":"test","module":"auth-routes","userId":"77cf7b8e-15fd-4b91-862d-be48ed8a0e03","email":"session-test-O6TdH9J4fgRPs3CvaduGd@example.com","msg":"User registered"}
{"level":30,"time":1768065406452,"env":"test","module":"auth-routes","userId":"77cf7b8e-15fd-4b91-862d-be48ed8a0e03","msg":"User logged in successfully"}
{"level":30,"time":1768065406504,"env":"test","module":"audit-log-service","userId":"77cf7b8e-15fd-4b91-862d-be48ed8a0e03","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065406915,"env":"test","module":"user-credentials-repository","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","msg":"User credentials created"}
{"level":30,"time":1768065407023,"env":"test","module":"email-queue","jobId":"0093d55d-131d-4590-bcbf-34a2090e87ff","to":"session-test-glVPaRwln2D-DKrytwDzi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065407073,"env":"test","module":"auth-routes","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","email":"session-test-glVPaRwln2D-DKrytwDzi@example.com","msg":"User registered"}
{"level":30,"time":1768065407633,"env":"test","module":"auth-routes","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","msg":"User logged in successfully"}
{"level":30,"time":1768065407684,"env":"test","module":"audit-log-service","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065408152,"env":"test","module":"auth-routes","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","msg":"User logged in successfully"}
{"level":30,"time":1768065408209,"env":"test","module":"audit-log-service","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065408690,"env":"test","module":"auth-routes","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","msg":"User logged in successfully"}
{"level":30,"time":1768065408743,"env":"test","module":"audit-log-service","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065408905,"env":"test","module":"auth-routes","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","msg":"All other sessions revoked"}
{"level":30,"time":1768065408951,"env":"test","module":"audit-log-service","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","eventType":"all_sessions_revoked","ipAddress":"::1","hasMetadata":false,"msg":"Security event logged"}
{"level":40,"time":1768065409209,"env":"test","module":"auth-service","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","tokenHash":"072c6eb04b368d2f4ca9d396393d6dcdd749ca0cf3ca2528ce6d8665246bacd6","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1768065409308,"env":"test","module":"auth-service","userId":"fe862b2e-fde3-4150-a752-05b454501ce7","tokenHash":"efb13fc73a9929dbd61405f59f91ccca8eb6454b5a6e237716d23e8b27a6ac0f","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768065409735,"env":"test","module":"user-credentials-repository","userId":"44a3ab98-6c0b-4748-8666-ea0d5d07fd61","msg":"User credentials created"}
{"level":30,"time":1768065409837,"env":"test","module":"email-queue","jobId":"279a6382-af12-44b5-83c6-765fa7a217e4","to":"session-test-3NdMo-2C7Eyj7kVA6wAKj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065409891,"env":"test","module":"auth-routes","userId":"44a3ab98-6c0b-4748-8666-ea0d5d07fd61","email":"session-test-3NdMo-2C7Eyj7kVA6wAKj@example.com","msg":"User registered"}
{"level":30,"time":1768065410455,"env":"test","module":"auth-routes","userId":"44a3ab98-6c0b-4748-8666-ea0d5d07fd61","msg":"User logged in successfully"}
{"level":30,"time":1768065410510,"env":"test","module":"audit-log-service","userId":"44a3ab98-6c0b-4748-8666-ea0d5d07fd61","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065410679,"env":"test","module":"auth-routes","userId":"44a3ab98-6c0b-4748-8666-ea0d5d07fd61","deviceFingerprint":"377ad01217b8c93ca52518d515505c47ab7553fab66d6fddaa60af67802c5a4c","msg":"Device marked as trusted"}
{"level":30,"time":1768065410838,"env":"test","module":"auth-routes","userId":"44a3ab98-6c0b-4748-8666-ea0d5d07fd61","msg":"All other sessions revoked"}
{"level":30,"time":1768065410894,"env":"test","module":"audit-log-service","userId":"44a3ab98-6c0b-4748-8666-ea0d5d07fd61","eventType":"all_sessions_revoked","ipAddress":"::1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768065410999,"env":"test","module":"auth-routes","userId":"44a3ab98-6c0b-4748-8666-ea0d5d07fd61","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1768065411365,"env":"test","module":"user-credentials-repository","userId":"c2509888-581e-42ca-8f3e-518103e8b95a","msg":"User credentials created"}
{"level":30,"time":1768065411469,"env":"test","module":"email-queue","jobId":"f425c018-d3b9-418b-9146-e69d3db01f76","to":"session-test-564_nHJFVzerprIY3uq6f@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065411521,"env":"test","module":"auth-routes","userId":"c2509888-581e-42ca-8f3e-518103e8b95a","email":"session-test-564_nHJFVzerprIY3uq6f@example.com","msg":"User registered"}
{"level":50,"time":1768065411624,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768065411991,"env":"test","module":"user-credentials-repository","userId":"b00b66c1-a4dd-407b-966b-cf5a2f082cba","msg":"User credentials created"}
{"level":30,"time":1768065412092,"env":"test","module":"email-queue","jobId":"306f1d4d-b2b2-42a4-a742-6f79d7a0b45d","to":"session-test-xmP6l768umcD7hnQY8_-J@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065412142,"env":"test","module":"auth-routes","userId":"b00b66c1-a4dd-407b-966b-cf5a2f082cba","email":"session-test-xmP6l768umcD7hnQY8_-J@example.com","msg":"User registered"}
{"level":30,"time":1768065412719,"env":"test","module":"auth-routes","userId":"b00b66c1-a4dd-407b-966b-cf5a2f082cba","msg":"User logged in successfully"}
{"level":30,"time":1768065412769,"env":"test","module":"audit-log-service","userId":"b00b66c1-a4dd-407b-966b-cf5a2f082cba","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768065412924,"env":"test","module":"auth-service","userId":"b00b66c1-a4dd-407b-966b-cf5a2f082cba","msg":"Security: Expired refresh token used"}
{"level":30,"time":1768065413289,"env":"test","module":"user-credentials-repository","userId":"0050097a-a969-4b5d-869c-92f7f148ebf5","msg":"User credentials created"}
{"level":30,"time":1768065413394,"env":"test","module":"email-queue","jobId":"331ce713-ad22-4c2b-ae6a-4226e7d033e6","to":"session-test-0rw08cHqJ0XNpcuEK8ZwV@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065413444,"env":"test","module":"auth-routes","userId":"0050097a-a969-4b5d-869c-92f7f148ebf5","email":"session-test-0rw08cHqJ0XNpcuEK8ZwV@example.com","msg":"User registered"}
{"level":30,"time":1768065414016,"env":"test","module":"auth-routes","userId":"0050097a-a969-4b5d-869c-92f7f148ebf5","msg":"User logged in successfully"}
{"level":30,"time":1768065414067,"env":"test","module":"audit-log-service","userId":"0050097a-a969-4b5d-869c-92f7f148ebf5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065414175,"env":"test","module":"auth-routes","userId":"0050097a-a969-4b5d-869c-92f7f148ebf5","msg":"User logged in successfully"}
{"level":30,"time":1768065414175,"env":"test","module":"auth-routes","userId":"0050097a-a969-4b5d-869c-92f7f148ebf5","msg":"User logged in successfully"}
{"level":30,"time":1768065414222,"env":"test","module":"audit-log-service","userId":"0050097a-a969-4b5d-869c-92f7f148ebf5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065414230,"env":"test","module":"audit-log-service","userId":"0050097a-a969-4b5d-869c-92f7f148ebf5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768065414651,"env":"test","module":"user-credentials-repository","userId":"13a82676-5d7e-4c58-8609-7e4e91710cee","msg":"User credentials created"}
{"level":30,"time":1768065414751,"env":"test","module":"email-queue","jobId":"302e9a21-213a-462e-9a6e-4f079f2bdde8","to":"session-test-7agYvJuJGqA5XbpJWVzO9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768065414801,"env":"test","module":"auth-routes","userId":"13a82676-5d7e-4c58-8609-7e4e91710cee","email":"session-test-7agYvJuJGqA5XbpJWVzO9@example.com","msg":"User registered"}
{"level":30,"time":1768065415367,"env":"test","module":"auth-routes","userId":"13a82676-5d7e-4c58-8609-7e4e91710cee","msg":"User logged in successfully"}
{"level":30,"time":1768065415418,"env":"test","module":"audit-log-service","userId":"13a82676-5d7e-4c58-8609-7e4e91710cee","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768065415682,"env":"test","module":"auth-service","userId":"13a82676-5d7e-4c58-8609-7e4e91710cee","tokenHash":"bfdfa30c524c67926266c043e004fd914bf8ed4f8eac08fbcb6b68bb20a99f2f","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1768065415786,"env":"test","module":"auth-service","userId":"13a82676-5d7e-4c58-8609-7e4e91710cee","tokenHash":"6e753cf8f5c5d698107a942e2b4674e60255b5b25eb71a1ea399b862df23381d","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/session.management.integration.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 31582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create refresh token on login [33m 1208[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track device metadata in session [33m 1232[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create separate sessions for multiple device logins [33m 2232[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list all active sessions for user [33m 2303[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark current session correctly [33m 1761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include revoked sessions [33m 2033[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should order sessions by last used (most recent first) [33m 2486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke specific session [33m 2012[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent revoking current session [33m 1362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow revoking other users sessions [33m 2471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent session ID [33m 1204[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all sessions except current [33m 2806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all trusted devices [33m 1638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require active session [33m 625[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject refresh token after 30 days [33m 1300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle multiple concurrent logins [33m 1362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle concurrent token refreshes [33m 1552[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m18 passed[39m[22m[90m (18)[39m
[2m   Start at [22m 11:16:16
[2m   Duration [22m 39.19s[2m (transform 3.04s, setup 224ms, import 6.83s, tests 31.58s, environment 0ms)[22m

