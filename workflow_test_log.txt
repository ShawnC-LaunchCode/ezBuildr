npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764798710234,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764798713716,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764798716418,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764798716419,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764798716424,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764798716424,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764798716425,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764798716425,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764798716867,"env":"test","module":"user-credentials-repository","userId":"22znCPg89-7kxtc-LQkDq","msg":"User credentials created"}
{"level":30,"time":1764798716869,"env":"test","module":"auth-routes","userId":"22znCPg89-7kxtc-LQkDq","email":"test-workflows-XnawrxPz6PXWH1ef7i1P5@example.com","msg":"User registered successfully"}
{"level":40,"time":1764798716973,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":30,"time":1764798717245,"env":"test","module":"user-credentials-repository","userId":"sriqqiu-g51s2zK_D0Vvt","msg":"User credentials created"}
{"level":30,"time":1764798717246,"env":"test","module":"auth-routes","userId":"sriqqiu-g51s2zK_D0Vvt","email":"viewer-gAbeZbwnHLU6zochNswAK@example.com","msg":"User registered successfully"}
{"level":40,"time":1764798717345,"env":"test","module":"rbac-middleware","userId":"sriqqiu-g51s2zK_D0Vvt","userRole":"viewer","permission":"workflow:create","path":"/projects/undefined/workflows","msg":"Permission denied"}
{"level":40,"time":1764798718555,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764798718608,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1ea4dbca-eaf6-4612-9a8e-d85aceb46201","userId":"22znCPg89-7kxtc-LQkDq","msg":"Error moving workflow"}
{"level":40,"time":1764798718902,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764798718955,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e0ba45ee-7fac-420b-bb51-adc3872fd105","userId":"22znCPg89-7kxtc-LQkDq","msg":"Error moving workflow"}
{"level":40,"time":1764798719529,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764798719678,"env":"test","error":{},"workflowId":"2558abdf-06f1-4ea5-8ed4-395472f3b647","userId":"22znCPg89-7kxtc-LQkDq","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764798719987,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":40,"time":1764798719990,"env":"test","module":"auth-middleware","path":"/api/workflows/c1543241-61f0-40ba-af47-aaecca141ec2/move","msg":"No valid authentication found"}
{"level":40,"time":1764798720279,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":40,"time":1764798720284,"env":"test","module":"auth-middleware","path":"/api/workflows/77695bd9-5996-4390-b21d-b4935f300e66/move","msg":"No valid authentication found"}
{"level":40,"time":1764798720596,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764798720647,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"5e0255a4-4e22-4bb1-990d-d035f9f30e63","userId":"22znCPg89-7kxtc-LQkDq","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":40,"time":1764798720946,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764798721003,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2aa459fd-5ad7-4690-89c5-f5c5eaad31c2","userId":"22znCPg89-7kxtc-LQkDq","msg":"Error moving workflow"}
{"level":40,"time":1764798721315,"env":"test","module":"rbac-middleware","userId":"22znCPg89-7kxtc-LQkDq","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":40,"time":1764798721319,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764798721371,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"db77f04f-6d3e-473d-9760-5bc9834c8dd4","userId":"22znCPg89-7kxtc-LQkDq","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[33m 5252[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a new draft workflow[39m[32m 58[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 313[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflows[39m[32m 119[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter by status[39m[32m 116[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should search by name[39m[32m 169[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update draft workflow[39m[32m 118[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[32m 100[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[32m 106[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 163[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 311[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 294[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 363[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 368[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 14 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:projectId/workflows > should create a new draft workflow
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:97:10
     95|           graphJson: { nodes: [], edges: [] },
     96|         })
     97|         .expect(201);
       |          ^
     98| 
     99|       expect(response.body).toHaveProperty("id");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should list workflows
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:138:10
    136|         .get(`/api/projects/${projectId}/workflows`)
    137|         .set("Authorization", `Bearer ${authToken}`)
    138|         .expect(200);
       |          ^
    139| 
    140|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should filter by status
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:149:10
    147|         .get(`/api/projects/${projectId}/workflows?status=draft`)
    148|         .set("Authorization", `Bearer ${authToken}`)
    149|         .expect(200);
       |          ^
    150| 
    151|       expect(response.body.items.every((w: any) => w.status === "draftÎ“Ã‡Âª
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should search by name
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:164:10
    162|         .get(`/api/projects/${projectId}/workflows?q=${uniqueName}`)
    163|         .set("Authorization", `Bearer ${authToken}`)
    164|         .expect(200);
       |          ^
    165| 
    166|       expect(response.body.items.length).toBeGreaterThan(0);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should update draft workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:186:10
    184|         .set("Authorization", `Bearer ${authToken}`)
    185|         .send({ name: "Updated Name" })
    186|         .expect(200);
       |          ^
    187| 
    188|       expect(response.body).toHaveProperty("name", "Updated Name");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:196:10
    194|         .post(`/api/workflows/${workflowId}/publish`)
    195|         .set("Authorization", `Bearer ${authToken}`)
    196|         .expect(200);
       |          ^
    197| 
    198|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:222:10
    220|         .post(`/api/workflows/${workflowId}/publish`)
    221|         .set("Authorization", `Bearer ${authToken}`)
    222|         .expect(200);
       |          ^
    223| 
    224|       expect(response.body).toHaveProperty("status", "published");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:250:10
    248|         .get(`/api/workflows/${workflowId}/versions`)
    249|         .set("Authorization", `Bearer ${authToken}`)
    250|         .expect(200);
       |          ^
    251| 
    252|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:289:10
    287|         .set("Authorization", `Bearer ${authToken}`)
    288|         .send({ projectId: targetProjectId })
    289|         .expect(200);
       |          ^
    290| 
    291|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:324:10
    322|         .get(`/api/workflows/${workflowId}`)
    323|         .set("Authorization", `Bearer ${authToken}`)
    324|         .expect(200);
       |          ^
    325| 
    326|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:368:10
    366|         .set("Authorization", `Bearer ${authToken2}`)
    367|         .send({ projectId: targetProjectId })
    368|         .expect(403);
       |          ^
    369| 
    370|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:379:10
    377|         .set("Authorization", `Bearer ${authToken}`)
    378|         .send({ projectId: "invalid-uuid" })
    379|         .expect(400);
       |          ^
    380| 
    381|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:10
    387|         .set("Authorization", `Bearer ${authToken}`)
    388|         .send({})
    389|         .expect(400);
       |          ^
    390| 
    391|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/14]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:424:10
    422|         .set("Authorization", `Bearer ${authToken}`)
    423|         .send({ projectId: user2ProjectId })
    424|         .expect(403);
       |          ^
    425| 
    426|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/14]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m14 failed[39m[22m[2m | [22m[1m[32m3 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 15:51:46
[2m   Duration [22m 15.55s[2m (transform 5.70s, setup 816ms, collect 8.69s, tests 5.25s, environment 0ms, prepare 16ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764798870736,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764798876653,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764798883017,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764798883019,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764798883044,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764798883044,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764798883044,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764798883044,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764798883661,"env":"test","module":"user-credentials-repository","userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"User credentials created"}
{"level":30,"time":1764798883666,"env":"test","module":"auth-routes","userId":"_TKAyCgBjf5HmYf6F3Pdl","email":"test-workflows-GNgH_FQMJR_wW9nLeU5yv@example.com","msg":"User registered successfully"}
{"level":40,"time":1764798883788,"env":"test","module":"rbac-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":30,"time":1764798884098,"env":"test","module":"user-credentials-repository","userId":"pdzisv3K6VHJcpUAS97Go","msg":"User credentials created"}
{"level":30,"time":1764798884099,"env":"test","module":"auth-routes","userId":"pdzisv3K6VHJcpUAS97Go","email":"viewer-z4NoGV06bHdJSOYFuqiO9@example.com","msg":"User registered successfully"}
{"level":40,"time":1764798884209,"env":"test","module":"tenant-middleware","userId":"pdzisv3K6VHJcpUAS97Go","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884268,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884324,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884401,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884458,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884526,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884590,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884648,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884712,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884770,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/workflows/undefined","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884835,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884895,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798884976,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798885037,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798885097,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/projects/undefined/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798885161,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798885223,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/workflows/undefined/versions","msg":"User does not have an associated tenant"}
{"level":50,"time":1764798885449,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_TKAyCgBjf5HmYf6F3Pdl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error creating workflow"}
{"level":40,"time":1764798885505,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764798885570,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error moving workflow"}
{"level":50,"time":1764798885786,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_TKAyCgBjf5HmYf6F3Pdl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error creating workflow"}
{"level":40,"time":1764798885841,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764798885897,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error moving workflow"}
{"level":50,"time":1764798886010,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"_TKAyCgBjf5HmYf6F3Pdl","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764798886368,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_TKAyCgBjf5HmYf6F3Pdl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error creating workflow"}
{"level":40,"time":1764798886423,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764798886535,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"_TKAyCgBjf5HmYf6F3Pdl","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":50,"time":1764798886916,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_TKAyCgBjf5HmYf6F3Pdl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error creating workflow"}
{"level":40,"time":1764798886968,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798886973,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764798887180,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_TKAyCgBjf5HmYf6F3Pdl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error creating workflow"}
{"level":40,"time":1764798887237,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798887246,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764798887478,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_TKAyCgBjf5HmYf6F3Pdl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error creating workflow"}
{"level":40,"time":1764798887533,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764798887590,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"undefined","userId":"_TKAyCgBjf5HmYf6F3Pdl","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764798887805,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_TKAyCgBjf5HmYf6F3Pdl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error creating workflow"}
{"level":40,"time":1764798887865,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764798887923,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error moving workflow"}
{"level":50,"time":1764798888133,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(_TKAyCgBjf5HmYf6F3Pdl) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error creating workflow"}
{"level":40,"time":1764798888188,"env":"test","module":"tenant-middleware","userId":"_TKAyCgBjf5HmYf6F3Pdl","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764798888200,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764798888316,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"_TKAyCgBjf5HmYf6F3Pdl","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 5674[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a new draft workflow[39m[32m 69[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 352[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflows[39m[32m 114[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter by status[39m[32m 135[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should search by name[39m[32m 191[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update draft workflow[39m[32m 120[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[32m 127[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[32m 140[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 185[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 347[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 440[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[33m 523[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 438[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 274[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 344[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 333[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 393[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 13 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:projectId/workflows > should create a new draft workflow
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:97:10
     95|           graphJson: { nodes: [], edges: [] },
     96|         })
     97|         .expect(201);
       |          ^
     98| 
     99|       expect(response.body).toHaveProperty("id");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should list workflows
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:138:10
    136|         .get(`/api/projects/${projectId}/workflows`)
    137|         .set("Authorization", `Bearer ${authToken}`)
    138|         .expect(200);
       |          ^
    139| 
    140|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should filter by status
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:149:10
    147|         .get(`/api/projects/${projectId}/workflows?status=draft`)
    148|         .set("Authorization", `Bearer ${authToken}`)
    149|         .expect(200);
       |          ^
    150| 
    151|       expect(response.body.items.every((w: any) => w.status === "draftÎ“Ã‡Âª
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should search by name
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:164:10
    162|         .get(`/api/projects/${projectId}/workflows?q=${uniqueName}`)
    163|         .set("Authorization", `Bearer ${authToken}`)
    164|         .expect(200);
       |          ^
    165| 
    166|       expect(response.body.items.length).toBeGreaterThan(0);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should update draft workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:186:10
    184|         .set("Authorization", `Bearer ${authToken}`)
    185|         .send({ name: "Updated Name" })
    186|         .expect(200);
       |          ^
    187| 
    188|       expect(response.body).toHaveProperty("name", "Updated Name");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:196:10
    194|         .post(`/api/workflows/${workflowId}/publish`)
    195|         .set("Authorization", `Bearer ${authToken}`)
    196|         .expect(200);
       |          ^
    197| 
    198|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:222:10
    220|         .post(`/api/workflows/${workflowId}/publish`)
    221|         .set("Authorization", `Bearer ${authToken}`)
    222|         .expect(200);
       |          ^
    223| 
    224|       expect(response.body).toHaveProperty("status", "published");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:250:10
    248|         .get(`/api/workflows/${workflowId}/versions`)
    249|         .set("Authorization", `Bearer ${authToken}`)
    250|         .expect(200);
       |          ^
    251| 
    252|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:289:10
    287|         .set("Authorization", `Bearer ${authToken}`)
    288|         .send({ projectId: targetProjectId })
    289|         .expect(200);
       |          ^
    290| 
    291|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:315:10
    313|         .set("Authorization", `Bearer ${authToken}`)
    314|         .send({ projectId: null })
    315|         .expect(200);
       |          ^
    316| 
    317|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Error: expected 404 "Not Found", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:336:10
    334|         .set("Authorization", `Bearer ${authToken}`)
    335|         .send({ projectId: fakeProjectId })
    336|         .expect(404);
       |          ^
    337| 
    338|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:368:10
    366|         .set("Authorization", `Bearer ${authToken2}`)
    367|         .send({ projectId: targetProjectId })
    368|         .expect(403);
       |          ^
    369| 
    370|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:424:10
    422|         .set("Authorization", `Bearer ${authToken}`)
    423|         .send({ projectId: user2ProjectId })
    424|         .expect(403);
       |          ^
    425| 
    426|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m13 failed[39m[22m[2m | [22m[1m[32m4 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 15:54:26
[2m   Duration [22m 20.99s


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/13]Î“Ã„Â»

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764799346457,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764799347857,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764799349925,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764799349925,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764799349937,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764799349937,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764799349938,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764799349938,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764799350471,"env":"test","module":"user-credentials-repository","userId":"YlXjB34pAVAQWbjNnoEqD","msg":"User credentials created"}
{"level":30,"time":1764799350474,"env":"test","module":"auth-routes","userId":"YlXjB34pAVAQWbjNnoEqD","email":"test-workflows-F7fCb3KqeDJ69uHlIrdiZ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764799350596,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m403[39m {"message":"Permission denied","error":"forbidden","details":"Required permission: project:create"}

{"level":30,"time":1764799350893,"env":"test","module":"user-credentials-repository","userId":"lI0stJEyS_Zt7OZVpt37L","msg":"User credentials created"}
{"level":30,"time":1764799350893,"env":"test","module":"auth-routes","userId":"lI0stJEyS_Zt7OZVpt37L","email":"viewer-mGQxKTsfJtQSFZDIm9vbb@example.com","msg":"User registered successfully"}
{"level":40,"time":1764799351006,"env":"test","module":"rbac-middleware","userId":"lI0stJEyS_Zt7OZVpt37L","userRole":"viewer","permission":"workflow:create","path":"/projects/undefined/workflows","msg":"Permission denied"}
{"level":40,"time":1764799352304,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764799352365,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f4313717-c9d6-4a42-9e65-1460c0f2f63f","userId":"YlXjB34pAVAQWbjNnoEqD","msg":"Error moving workflow"}
{"level":40,"time":1764799352688,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764799352747,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4f61ef46-46bb-4b67-bf61-362470e14cad","userId":"YlXjB34pAVAQWbjNnoEqD","msg":"Error moving workflow"}
{"level":40,"time":1764799353349,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764799353513,"env":"test","error":{},"workflowId":"66090569-d0f0-4ff7-973a-43a1403c20d2","userId":"YlXjB34pAVAQWbjNnoEqD","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764799353839,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":40,"time":1764799353843,"env":"test","module":"auth-middleware","path":"/api/workflows/4285b501-e133-46d4-800d-03421b7956e2/move","msg":"No valid authentication found"}
{"level":40,"time":1764799354155,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":40,"time":1764799354161,"env":"test","module":"auth-middleware","path":"/api/workflows/e2327633-eff9-4ed1-9831-2331b1bbc112/move","msg":"No valid authentication found"}
{"level":40,"time":1764799354491,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764799354555,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9a99d1ca-521e-4c73-a307-d3a1317898fa","userId":"YlXjB34pAVAQWbjNnoEqD","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":40,"time":1764799354871,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":50,"time":1764799354929,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1d1784fb-b3df-4fdc-a3c1-9bf284935ae8","userId":"YlXjB34pAVAQWbjNnoEqD","msg":"Error moving workflow"}
{"level":40,"time":1764799355259,"env":"test","module":"rbac-middleware","userId":"YlXjB34pAVAQWbjNnoEqD","userRole":"builder","permission":"project:create","path":"/","msg":"Permission denied"}
{"level":40,"time":1764799355268,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764799355325,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"9c8535c2-f246-4714-a6de-534d2f4e95f8","userId":"YlXjB34pAVAQWbjNnoEqD","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[33m 5732[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a new draft workflow[39m[32m 68[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 341[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflows[39m[32m 117[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter by status[39m[32m 120[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should search by name[39m[32m 175[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update draft workflow[39m[32m 123[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[32m 116[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[32m 118[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 203[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 385[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 490[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 329[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 393[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 396[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 12 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:projectId/workflows > should create a new draft workflow
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:98:10
     96|           graphJson: { nodes: [], edges: [] },
     97|         })
     98|         .expect(201);
       |          ^
     99| 
    100|       expect(response.body).toHaveProperty("id");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should list workflows
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:139:10
    137|         .get(`/api/projects/${projectId}/workflows`)
    138|         .set("Authorization", `Bearer ${authToken}`)
    139|         .expect(200);
       |          ^
    140| 
    141|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should filter by status
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:150:10
    148|         .get(`/api/projects/${projectId}/workflows?status=draft`)
    149|         .set("Authorization", `Bearer ${authToken}`)
    150|         .expect(200);
       |          ^
    151| 
    152|       expect(response.body.items.every((w: any) => w.status === "draftÎ“Ã‡Âª
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should search by name
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:165:10
    163|         .get(`/api/projects/${projectId}/workflows?q=${uniqueName}`)
    164|         .set("Authorization", `Bearer ${authToken}`)
    165|         .expect(200);
       |          ^
    166| 
    167|       expect(response.body.items.length).toBeGreaterThan(0);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should update draft workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:187:10
    185|         .set("Authorization", `Bearer ${authToken}`)
    186|         .send({ name: "Updated Name" })
    187|         .expect(200);
       |          ^
    188| 
    189|       expect(response.body).toHaveProperty("name", "Updated Name");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:197:10
    195|         .post(`/api/workflows/${workflowId}/publish`)
    196|         .set("Authorization", `Bearer ${authToken}`)
    197|         .expect(200);
       |          ^
    198| 
    199|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:223:10
    221|         .post(`/api/workflows/${workflowId}/publish`)
    222|         .set("Authorization", `Bearer ${authToken}`)
    223|         .expect(200);
       |          ^
    224| 
    225|       expect(response.body).toHaveProperty("status", "published");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:251:10
    249|         .get(`/api/workflows/${workflowId}/versions`)
    250|         .set("Authorization", `Bearer ${authToken}`)
    251|         .expect(200);
       |          ^
    252| 
    253|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:290:10
    288|         .set("Authorization", `Bearer ${authToken}`)
    289|         .send({ projectId: targetProjectId })
    290|         .expect(200);
       |          ^
    291| 
    292|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:325:10
    323|         .get(`/api/workflows/${workflowId}`)
    324|         .set("Authorization", `Bearer ${authToken}`)
    325|         .expect(200);
       |          ^
    326| 
    327|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:369:10
    367|         .set("Authorization", `Bearer ${authToken2}`)
    368|         .send({ projectId: targetProjectId })
    369|         .expect(403);
       |          ^
    370| 
    371|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:425:10
    423|         .set("Authorization", `Bearer ${authToken}`)
    424|         .send({ projectId: user2ProjectId })
    425|         .expect(403);
       |          ^
    426| 
    427|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/12]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m12 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 16:02:24
[2m   Duration [22m 11.02s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764799474701,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764799475936,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764799478006,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764799478007,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764799478018,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764799478019,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764799478019,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764799478019,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764799478522,"env":"test","module":"user-credentials-repository","userId":"eRI7OGR2xrKN5Vpc3az2m","msg":"User credentials created"}
{"level":30,"time":1764799478526,"env":"test","module":"auth-routes","userId":"eRI7OGR2xrKN5Vpc3az2m","email":"test-workflows-lTlUmy3i-LiQ874tZdUcU@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"d246ef52-455a-4b6b-b71a-bb6bce3c2369","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"eRI7OGR2xrKN5Vpc3az2m","tenantId":"00d4dc76-3116-4d82-bbb7-0dec93e7da86","createdBy":"eRI7OGR2xrKN5Vpc3az2m","ownerId":"eRI7OGR2xrKN5Vpc3az2m","status":"active","archived":false,"createdAt":"2025-12-03T22:04:40.352Z","updatedAt":"2025-12-03T22:04:40.352Z"}

{"level":30,"time":1764799479030,"env":"test","module":"user-credentials-repository","userId":"8si456lgPr8digFCj-jMl","msg":"User credentials created"}
{"level":30,"time":1764799479031,"env":"test","module":"auth-routes","userId":"8si456lgPr8digFCj-jMl","email":"viewer-gSC75zPY3cq9YW7hzLl_G@example.com","msg":"User registered successfully"}
{"level":40,"time":1764799479141,"env":"test","module":"rbac-middleware","userId":"8si456lgPr8digFCj-jMl","userRole":"viewer","permission":"workflow:create","path":"/projects/d246ef52-455a-4b6b-b71a-bb6bce3c2369/workflows","msg":"Permission denied"}
{"level":50,"time":1764799485455,"env":"test","error":{},"workflowId":"3c8df1bc-3af7-4e1e-9d80-5e698abf30d4","userId":"eRI7OGR2xrKN5Vpc3az2m","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764799485818,"env":"test","module":"auth-middleware","path":"/api/workflows/ece6f33d-165a-499b-a0fa-4c79ec8bb79d/move","msg":"No valid authentication found"}
{"level":40,"time":1764799486183,"env":"test","module":"auth-middleware","path":"/api/workflows/11d5e13c-dc6a-4cec-b9b6-e2c9ad8f411a/move","msg":"No valid authentication found"}
{"level":50,"time":1764799486607,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7947378e-e7bd-4db1-b7f8-8653724d59b4","userId":"eRI7OGR2xrKN5Vpc3az2m","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764799487021,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ab4516d9-7003-497f-8bf0-2c901c5264c2","userId":"eRI7OGR2xrKN5Vpc3az2m","msg":"Error moving workflow"}
{"level":40,"time":1764799487368,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764799487420,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1a06faa3-5b67-4c6b-9906-1c42bd4b1aa0","userId":"eRI7OGR2xrKN5Vpc3az2m","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 9710[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a new draft workflow[39m[32m 117[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 541[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 510[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 865[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 691[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[33m 493[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[33m 488[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[33m 701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 674[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 843[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 363[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 400[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/8]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 7 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:projectId/workflows > should create a new draft workflow
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:98:10
     96|           graphJson: { nodes: [], edges: [] },
     97|         })
     98|         .expect(201);
       |          ^
     99| 
    100|       expect(response.body).toHaveProperty("id");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:197:10
    195|         .post(`/api/workflows/${workflowId}/publish`)
    196|         .set("Authorization", `Bearer ${authToken}`)
    197|         .expect(200);
       |          ^
    198| 
    199|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:223:10
    221|         .post(`/api/workflows/${workflowId}/publish`)
    222|         .set("Authorization", `Bearer ${authToken}`)
    223|         .expect(200);
       |          ^
    224| 
    225|       expect(response.body).toHaveProperty("status", "published");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
AssertionError: expected { Î“Ã‡Âª(12) } to have property "published" with value true

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/api.workflows.test.ts:255:38
    253|       expect(response.body).toHaveProperty("items");
    254|       expect(response.body.items.length).toBeGreaterThan(0);
    255|       expect(response.body.items[0]).toHaveProperty("published", true);
       |                                      ^
    256|     });
    257|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:325:10
    323|         .get(`/api/workflows/${workflowId}`)
    324|         .set("Authorization", `Bearer ${authToken}`)
    325|         .expect(200);
       |          ^
    326| 
    327|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:369:10
    367|         .set("Authorization", `Bearer ${authToken2}`)
    368|         .send({ projectId: targetProjectId })
    369|         .expect(403);
       |          ^
    370| 
    371|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:425:10
    423|         .set("Authorization", `Bearer ${authToken}`)
    424|         .send({ projectId: user2ProjectId })
    425|         .expect(403);
       |          ^
    426| 
    427|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/8]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m10 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 16:04:32
[2m   Duration [22m 14.73s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/engine/validate.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764811043974,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764811047634,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764811052590,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764811052591,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764811052602,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764811052602,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764811052603,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764811052603,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764811053236,"env":"test","module":"user-credentials-repository","userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"User credentials created"}
{"level":30,"time":1764811053239,"env":"test","module":"auth-routes","userId":"A1ZhDrDBsna3QQ5YQcpuC","email":"test-workflows-ANN2Az3pc3DrDbcSiFvTP@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"34d9ba29-4157-4186-b4f4-3f4f7e505d6b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"A1ZhDrDBsna3QQ5YQcpuC","tenantId":"427c322a-847c-467a-8995-b4b77096801f","createdBy":"A1ZhDrDBsna3QQ5YQcpuC","ownerId":"A1ZhDrDBsna3QQ5YQcpuC","status":"active","archived":false,"createdAt":"2025-12-04T01:17:33.472Z","updatedAt":"2025-12-04T01:17:33.472Z"}

{"level":30,"time":1764811054167,"env":"test","module":"user-credentials-repository","userId":"wnn2NA-kLkX8_cayyojYx","msg":"User credentials created"}
{"level":30,"time":1764811054168,"env":"test","module":"auth-routes","userId":"wnn2NA-kLkX8_cayyojYx","email":"viewer-qLIoQ6H9b2zr0sWapO0ow@example.com","msg":"User registered successfully"}
{"level":40,"time":1764811054278,"env":"test","module":"rbac-middleware","userId":"wnn2NA-kLkX8_cayyojYx","userRole":"viewer","permission":"workflow:create","path":"/projects/34d9ba29-4157-4186-b4f4-3f4f7e505d6b/workflows","msg":"Permission denied"}
{"level":40,"time":1764811056489,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/workflows/undefined","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811056554,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/projects/34d9ba29-4157-4186-b4f4-3f4f7e505d6b/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811056616,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811056673,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/projects/34d9ba29-4157-4186-b4f4-3f4f7e505d6b/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811056732,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811056791,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/projects/34d9ba29-4157-4186-b4f4-3f4f7e505d6b/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811056848,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811056911,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/workflows/undefined/versions","msg":"User does not have an associated tenant"}
{"level":50,"time":1764811057132,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(A1ZhDrDBsna3QQ5YQcpuC) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error creating workflow"}
{"level":40,"time":1764811057192,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764811057256,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error moving workflow"}
{"level":50,"time":1764811057480,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(A1ZhDrDBsna3QQ5YQcpuC) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error creating workflow"}
{"level":40,"time":1764811057552,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764811057609,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error moving workflow"}
{"level":50,"time":1764811057729,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"A1ZhDrDBsna3QQ5YQcpuC","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764811058103,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(A1ZhDrDBsna3QQ5YQcpuC) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error creating workflow"}
{"level":40,"time":1764811058170,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764811058282,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"A1ZhDrDBsna3QQ5YQcpuC","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":50,"time":1764811058647,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(A1ZhDrDBsna3QQ5YQcpuC) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error creating workflow"}
{"level":40,"time":1764811058708,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811058715,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764811058953,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(A1ZhDrDBsna3QQ5YQcpuC) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error creating workflow"}
{"level":40,"time":1764811059021,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811059034,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764811059312,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(A1ZhDrDBsna3QQ5YQcpuC) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error creating workflow"}
{"level":40,"time":1764811059369,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764811059427,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"undefined","userId":"A1ZhDrDBsna3QQ5YQcpuC","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764811059634,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(A1ZhDrDBsna3QQ5YQcpuC) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error creating workflow"}
{"level":40,"time":1764811059692,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764811059751,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error moving workflow"}
{"level":50,"time":1764811059960,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(A1ZhDrDBsna3QQ5YQcpuC) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error creating workflow"}
{"level":40,"time":1764811060016,"env":"test","module":"tenant-middleware","userId":"A1ZhDrDBsna3QQ5YQcpuC","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764811060030,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764811060115,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"A1ZhDrDBsna3QQ5YQcpuC","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 7868[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 446[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 541[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should search by name[39m[33m 940[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update draft workflow[39m[32m 172[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[32m 127[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[32m 116[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 178[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 345[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 474[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[33m 555[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 430[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 393[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 324[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 366[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 10 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should search by name
AssertionError: expected 0 to be greater than 0
 Î“Â¥Â» tests/integration/api.workflows.test.ts:167:42
    165|         .expect(200);
    166| 
    167|       expect(response.body.items.length).toBeGreaterThan(0);
       |                                          ^
    168|     });
    169|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should update draft workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:187:10
    185|         .set("Authorization", `Bearer ${authToken}`)
    186|         .send({ name: "Updated Name" })
    187|         .expect(200);
       |          ^
    188| 
    189|       expect(response.body).toHaveProperty("name", "Updated Name");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:197:10
    195|         .post(`/api/workflows/${workflowId}/publish`)
    196|         .set("Authorization", `Bearer ${authToken}`)
    197|         .expect(200);
       |          ^
    198| 
    199|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:223:10
    221|         .post(`/api/workflows/${workflowId}/publish`)
    222|         .set("Authorization", `Bearer ${authToken}`)
    223|         .expect(200);
       |          ^
    224| 
    225|       expect(response.body).toHaveProperty("status", "published");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:251:10
    249|         .get(`/api/workflows/${workflowId}/versions`)
    250|         .set("Authorization", `Bearer ${authToken}`)
    251|         .expect(200);
       |          ^
    252| 
    253|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:290:10
    288|         .set("Authorization", `Bearer ${authToken}`)
    289|         .send({ projectId: targetProjectId })
    290|         .expect(200);
       |          ^
    291| 
    292|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:316:10
    314|         .set("Authorization", `Bearer ${authToken}`)
    315|         .send({ projectId: null })
    316|         .expect(200);
       |          ^
    317| 
    318|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Error: expected 404 "Not Found", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .set("Authorization", `Bearer ${authToken}`)
    336|         .send({ projectId: fakeProjectId })
    337|         .expect(404);
       |          ^
    338| 
    339|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:369:10
    367|         .set("Authorization", `Bearer ${authToken2}`)
    368|         .send({ projectId: targetProjectId })
    369|         .expect(403);
       |          ^
    370| 
    371|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/10]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:425:10
    423|         .set("Authorization", `Bearer ${authToken}`)
    424|         .send({ projectId: user2ProjectId })
    425|         .expect(403);
       |          ^
    426| 
    427|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/10]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m10 failed[39m[22m[2m | [22m[1m[32m7 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 19:17:19
[2m   Duration [22m 19.97s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764811958678,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764811960643,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764811962983,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764811962983,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764811962993,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764811962994,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764811962994,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764811962994,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764811963528,"env":"test","module":"user-credentials-repository","userId":"BS2gOKj737QxvsJX2gA6S","msg":"User credentials created"}
{"level":30,"time":1764811963531,"env":"test","module":"auth-routes","userId":"BS2gOKj737QxvsJX2gA6S","email":"test-workflows-pnl_bh2mgYqiArZ_saq4h@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6bddd1b0-bdaf-4075-a1d2-d743db259fcf","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"BS2gOKj737QxvsJX2gA6S","tenantId":"43defff9-b621-4961-a9da-d83213a42d91","createdBy":"BS2gOKj737QxvsJX2gA6S","ownerId":"BS2gOKj737QxvsJX2gA6S","status":"active","archived":false,"createdAt":"2025-12-04T01:32:43.742Z","updatedAt":"2025-12-04T01:32:43.742Z"}

{"level":30,"time":1764811964685,"env":"test","module":"user-credentials-repository","userId":"jxGLlf8VCgk83RTInguS4","msg":"User credentials created"}
{"level":30,"time":1764811964686,"env":"test","module":"auth-routes","userId":"jxGLlf8VCgk83RTInguS4","email":"viewer-tf3vHrzZnE5ZNw-2tRac7@example.com","msg":"User registered successfully"}
{"level":40,"time":1764811964867,"env":"test","module":"rbac-middleware","userId":"jxGLlf8VCgk83RTInguS4","userRole":"viewer","permission":"workflow:create","path":"/projects/6bddd1b0-bdaf-4075-a1d2-d743db259fcf/workflows","msg":"Permission denied"}
{"level":50,"time":1764811971731,"env":"test","error":{},"workflowId":"3a410763-02b7-4677-b35b-ff8cf2483b80","userId":"BS2gOKj737QxvsJX2gA6S","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764811972107,"env":"test","module":"auth-middleware","path":"/api/workflows/34b4f608-bfc7-4112-986e-eb815ef011b9/move","msg":"No valid authentication found"}
{"level":40,"time":1764811972555,"env":"test","module":"auth-middleware","path":"/api/workflows/a04f55be-2b32-4829-ae9a-2f054e175426/move","msg":"No valid authentication found"}
{"level":50,"time":1764811973190,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"83b11ad9-7aa8-46e5-bc9a-1e989d102569","userId":"BS2gOKj737QxvsJX2gA6S","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764811973639,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"60447d69-0ddc-442e-a46e-c8574fb3439b","userId":"BS2gOKj737QxvsJX2gA6S","msg":"Error moving workflow"}
{"level":40,"time":1764811974043,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764811974113,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"5324075e-1d33-40c8-823b-5fceb2f96cd1","userId":"BS2gOKj737QxvsJX2gA6S","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 11464[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 491[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 654[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 555[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 912[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 690[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[33m 487[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[33m 478[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[33m 659[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 698[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 871[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 857[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 448[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 474[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 6 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:198:10
    196|         .set("Authorization", `Bearer ${authToken}`)
    197|         .send({})
    198|         .expect(200);
       |          ^
    199| 
    200|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:225:10
    223|         .set("Authorization", `Bearer ${authToken}`)
    224|         .send({})
    225|         .expect(200);
       |          ^
    226| 
    227|       expect(response.body).toHaveProperty("status", "published");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
AssertionError: expected { Î“Ã‡Âª(12) } to have property "published" with value true

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/api.workflows.test.ts:257:38
    255|       expect(response.body).toHaveProperty("items");
    256|       expect(response.body.items.length).toBeGreaterThan(0);
    257|       expect(response.body.items[0]).toHaveProperty("published", true);
       |                                      ^
    258|     });
    259|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:327:10
    325|         .get(`/api/workflows/${workflowId}`)
    326|         .set("Authorization", `Bearer ${authToken}`)
    327|         .expect(200);
       |          ^
    328| 
    329|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:371:10
    369|         .set("Authorization", `Bearer ${authToken2}`)
    370|         .send({ projectId: targetProjectId })
    371|         .expect(403);
       |          ^
    372| 
    373|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:427:10
    425|         .set("Authorization", `Bearer ${authToken}`)
    426|         .send({ projectId: user2ProjectId })
    427|         .expect(403);
       |          ^
    428| 
    429|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m6 failed[39m[22m[2m | [22m[1m[32m11 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 19:32:35
[2m   Duration [22m 18.13s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764812176335,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764812178830,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764812181729,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764812181730,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764812181740,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764812181740,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764812181740,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764812181740,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764812182359,"env":"test","module":"user-credentials-repository","userId":"R9J_yzDPP9yR46-s5dmGg","msg":"User credentials created"}
{"level":30,"time":1764812182363,"env":"test","module":"auth-routes","userId":"R9J_yzDPP9yR46-s5dmGg","email":"test-workflows-inWO1IiZCfq-EvaU9EOal@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"cf5698df-e724-4ad3-8398-0cc21df6fa75","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"R9J_yzDPP9yR46-s5dmGg","tenantId":"40b6cd67-84da-4dd2-8b09-60fab28a0ba4","createdBy":"R9J_yzDPP9yR46-s5dmGg","ownerId":"R9J_yzDPP9yR46-s5dmGg","status":"active","archived":false,"createdAt":"2025-12-04T01:36:22.607Z","updatedAt":"2025-12-04T01:36:22.607Z"}

{"level":30,"time":1764812183327,"env":"test","module":"user-credentials-repository","userId":"wZGuEf64eWnXr1ZPRpOzm","msg":"User credentials created"}
{"level":30,"time":1764812183328,"env":"test","module":"auth-routes","userId":"wZGuEf64eWnXr1ZPRpOzm","email":"viewer-T-hOgkjL_Ujau4MTVzdHd@example.com","msg":"User registered successfully"}
{"level":40,"time":1764812183469,"env":"test","module":"rbac-middleware","userId":"wZGuEf64eWnXr1ZPRpOzm","userRole":"viewer","permission":"workflow:create","path":"/projects/cf5698df-e724-4ad3-8398-0cc21df6fa75/workflows","msg":"Permission denied"}
{"level":50,"time":1764812190579,"env":"test","error":{},"workflowId":"3690c972-c8ff-47b8-af12-1b77bae6a683","userId":"R9J_yzDPP9yR46-s5dmGg","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764812190977,"env":"test","module":"auth-middleware","path":"/api/workflows/38fe009b-3068-4e67-8356-9688c29c1ab5/move","msg":"No valid authentication found"}
{"level":40,"time":1764812191381,"env":"test","module":"auth-middleware","path":"/api/workflows/d45946fd-c267-45a8-b8ee-a9ec94d3e542/move","msg":"No valid authentication found"}
{"level":50,"time":1764812191826,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"ee4c27ba-b254-4c31-bc1c-d892e5e50a60","userId":"R9J_yzDPP9yR46-s5dmGg","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764812192285,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"39e5e198-48bf-4786-a2bd-aa3779b07d90","userId":"R9J_yzDPP9yR46-s5dmGg","msg":"Error moving workflow"}
{"level":40,"time":1764812192623,"env":"test","module":"tenant-middleware","userId":"R9J_yzDPP9yR46-s5dmGg","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764812192639,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764812192706,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"accaec50-fb36-4774-9659-aa2fb7761407","userId":"R9J_yzDPP9yR46-s5dmGg","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 11314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 586[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 959[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 723[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[33m 501[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[33m 773[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[33m 719[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 775[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 947[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 396[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 445[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 460[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 420[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 6 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:198:10
    196|         .set("Authorization", `Bearer ${authToken}`)
    197|         .send({})
    198|         .expect(200);
       |          ^
    199| 
    200|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
AssertionError: expected { Î“Ã‡Âª(19) } to have property "status" with value 'published'

Expected: "published"
Received: "active"

 Î“Â¥Â» tests/integration/api.workflows.test.ts:230:29
    228|         .expect(200);
    229| 
    230|       expect(response.body).toHaveProperty("status", "published");
       |                             ^
    231|       expect(response.body.currentVersion).toHaveProperty("published",Î“Ã‡Âª
    232|       expect(response.body.currentVersion).toHaveProperty("publishedAtÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
AssertionError: expected { Î“Ã‡Âª(12) } to have property "published" with value true

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/api.workflows.test.ts:260:38
    258|       expect(response.body).toHaveProperty("items");
    259|       expect(response.body.items.length).toBeGreaterThan(0);
    260|       expect(response.body.items[0]).toHaveProperty("published", true);
       |                                      ^
    261|     });
    262|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:330:10
    328|         .get(`/api/workflows/${workflowId}`)
    329|         .set("Authorization", `Bearer ${authToken}`)
    330|         .expect(200);
       |          ^
    331| 
    332|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:374:10
    372|         .set("Authorization", `Bearer ${authToken2}`)
    373|         .send({ projectId: targetProjectId })
    374|         .expect(403);
       |          ^
    375| 
    376|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:430:10
    428|         .set("Authorization", `Bearer ${authToken}`)
    429|         .send({ projectId: user2ProjectId })
    430|         .expect(403);
       |          ^
    431| 
    432|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m6 failed[39m[22m[2m | [22m[1m[32m11 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 19:36:12
[2m   Duration [22m 19.30s

 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764813239951,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764813242470,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764813244966,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764813244966,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764813244983,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764813244983,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764813244983,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764813244983,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764813245528,"env":"test","module":"user-credentials-repository","userId":"0wqh9I-f7ICa7w6w47WFi","msg":"User credentials created"}
{"level":30,"time":1764813245531,"env":"test","module":"auth-routes","userId":"0wqh9I-f7ICa7w6w47WFi","email":"test-workflows-Uj6FSWNt1Z8mgo2UJNbN7@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"759c64be-9c1b-4e6d-91f5-7738d75690e0","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"0wqh9I-f7ICa7w6w47WFi","tenantId":"978ef1a9-b749-4e0b-bc9c-4234830a0314","createdBy":"0wqh9I-f7ICa7w6w47WFi","ownerId":"0wqh9I-f7ICa7w6w47WFi","status":"active","archived":false,"createdAt":"2025-12-04T01:54:05.857Z","updatedAt":"2025-12-04T01:54:05.857Z"}

{"level":30,"time":1764813246478,"env":"test","module":"user-credentials-repository","userId":"pl9BX6OVeDjhYv0wThBVy","msg":"User credentials created"}
{"level":30,"time":1764813246479,"env":"test","module":"auth-routes","userId":"pl9BX6OVeDjhYv0wThBVy","email":"viewer-stqSc_D1LKYNSywi7d2ay@example.com","msg":"User registered successfully"}
{"level":40,"time":1764813246589,"env":"test","module":"rbac-middleware","userId":"pl9BX6OVeDjhYv0wThBVy","userRole":"viewer","permission":"workflow:create","path":"/projects/759c64be-9c1b-4e6d-91f5-7738d75690e0/workflows","msg":"Permission denied"}
{"level":50,"time":1764813254280,"env":"test","error":{},"workflowId":"86855a76-fcde-4bd7-8508-700060433f31","userId":"0wqh9I-f7ICa7w6w47WFi","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764813254785,"env":"test","module":"auth-middleware","path":"/api/workflows/e4983e0f-d898-4444-a468-f975cfbea2d7/move","msg":"No valid authentication found"}
{"level":40,"time":1764813255174,"env":"test","module":"auth-middleware","path":"/api/workflows/34723091-d453-4e39-9981-cd97f9b0bfa1/move","msg":"No valid authentication found"}
{"level":50,"time":1764813255617,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f36e8376-3cc9-41c2-bb4b-033bc6983e61","userId":"0wqh9I-f7ICa7w6w47WFi","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764813256057,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6124d5f8-444d-4ce2-85af-5cc1e761d87e","userId":"0wqh9I-f7ICa7w6w47WFi","msg":"Error moving workflow"}
{"level":40,"time":1764813256447,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764813256508,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"832e0ec3-4270-486c-9737-c1733fa62d96","userId":"0wqh9I-f7ICa7w6w47WFi","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 11876[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 948[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 892[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 949[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 729[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 898[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 662[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 503[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 390[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 439[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 451[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:381:10
    379|         .set("Authorization", `Bearer ${authToken2}`)
    380|         .send({ projectId: targetProjectId })
    381|         .expect(403);
       |          ^
    382| 
    383|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:437:10
    435|         .set("Authorization", `Bearer ${authToken}`)
    436|         .send({ projectId: user2ProjectId })
    437|         .expect(403);
       |          ^
    438| 
    439|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 19:53:57
[2m   Duration [22m 19.17s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764813636248,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764813646312,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764813652804,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764813652805,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764813652818,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764813652818,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764813652818,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764813652818,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764813653429,"env":"test","module":"user-credentials-repository","userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"User credentials created"}
{"level":30,"time":1764813653434,"env":"test","module":"auth-routes","userId":"ahuAHCsUoGSCPV0WMWAz1","email":"test-workflows-sA_vNFXuPdztRWygd-7lD@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9486492a-6e86-4f50-b9b6-889d9aec608e","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ahuAHCsUoGSCPV0WMWAz1","tenantId":"10b7b56f-7fd5-48d1-8c87-4f444bab2384","createdBy":"ahuAHCsUoGSCPV0WMWAz1","ownerId":"ahuAHCsUoGSCPV0WMWAz1","status":"active","archived":false,"createdAt":"2025-12-04T02:00:53.675Z","updatedAt":"2025-12-04T02:00:53.675Z"}

{"level":30,"time":1764813654262,"env":"test","module":"user-credentials-repository","userId":"WdM-GTiG0F1zZtHY10QLq","msg":"User credentials created"}
{"level":30,"time":1764813654263,"env":"test","module":"auth-routes","userId":"WdM-GTiG0F1zZtHY10QLq","email":"viewer-LI69YfhXQTcelMbZtzXef@example.com","msg":"User registered successfully"}
{"level":40,"time":1764813654386,"env":"test","module":"rbac-middleware","userId":"WdM-GTiG0F1zZtHY10QLq","userRole":"viewer","permission":"workflow:create","path":"/projects/9486492a-6e86-4f50-b9b6-889d9aec608e/workflows","msg":"Permission denied"}
{"level":40,"time":1764813657733,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/projects/9486492a-6e86-4f50-b9b6-889d9aec608e/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813657796,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813657867,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/projects/9486492a-6e86-4f50-b9b6-889d9aec608e/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813657932,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813657993,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/projects/9486492a-6e86-4f50-b9b6-889d9aec608e/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813658047,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813658110,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/workflows/undefined/versions","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813658334,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ahuAHCsUoGSCPV0WMWAz1) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"Error creating workflow"}
{"level":40,"time":1764813658390,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813688745,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ahuAHCsUoGSCPV0WMWAz1) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"Error creating workflow"}
{"level":40,"time":1764813688803,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813719188,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ahuAHCsUoGSCPV0WMWAz1) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"Error creating workflow"}
{"level":40,"time":1764813719250,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/","msg":"User does not have an associated tenant"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'undefined'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764813719393,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"ahuAHCsUoGSCPV0WMWAz1","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: error: invalid input syntax for type uuid: "undefined"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at NeonPreparedQuery.execute (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
    at WorkflowRepository.findById (C:/Users/scoot/poll/VaultLogic/server/repositories/BaseRepository.ts:52:22)
    at WorkflowRepository.findByIdOrSlug (C:/Users/scoot/poll/VaultLogic/server/repositories/WorkflowRepository.ts:87:18)
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:44:22)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24 {
  length: 141,
  severity: 'ERROR',
  code: '22P02',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: "unnamed portal parameter $1 = '...'",
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'uuid.c',
  line: '138',
  routine: 'string_to_uuid'
}

{"level":50,"time":1764813719856,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ahuAHCsUoGSCPV0WMWAz1) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"Error creating workflow"}
{"level":40,"time":1764813719915,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813719918,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764813720142,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ahuAHCsUoGSCPV0WMWAz1) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"Error creating workflow"}
{"level":40,"time":1764813720200,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813720207,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764813720419,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ahuAHCsUoGSCPV0WMWAz1) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"Error creating workflow"}
{"level":40,"time":1764813720472,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813750828,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ahuAHCsUoGSCPV0WMWAz1) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"Error creating workflow"}
{"level":40,"time":1764813750881,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813781241,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(ahuAHCsUoGSCPV0WMWAz1) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ahuAHCsUoGSCPV0WMWAz1","msg":"Error creating workflow"}
{"level":40,"time":1764813781298,"env":"test","module":"tenant-middleware","userId":"ahuAHCsUoGSCPV0WMWAz1","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813781305,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 188536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 402[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 363[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 910[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 700[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 948[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update draft workflow[39m[33m 723[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[32m 129[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[32m 133[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 181[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 30279[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 30411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 523[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 289[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30265[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30409[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30446[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/12]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 11 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should update draft workflow
AssertionError: expected '' to have property "name" with value 'Updated Name'

- Expected: 
"Updated Name"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/api.workflows.test.ts:192:29

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:201:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:231:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:263:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:297:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:316:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Error: expected 404 "Not Found", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:349:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:381:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:397:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/12]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:407:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/12]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 5 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should move workflow to a project". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should move workflow to Main Folder (projectId = null)". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m11 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m5 errors[39m[22m
[2m   Start at [22m 20:00:30
[2m   Duration [22m 209.28s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764813844055,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764813845381,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764813847240,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764813847240,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764813847249,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764813847250,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764813847250,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764813847250,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764813847739,"env":"test","module":"user-credentials-repository","userId":"Nv20K5E6YbYOF6O59yZpw","msg":"User credentials created"}
{"level":30,"time":1764813847743,"env":"test","module":"auth-routes","userId":"Nv20K5E6YbYOF6O59yZpw","email":"test-workflows-SiSZUBdz3fNPj5mjm42ym@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"81e5a06b-e55c-45a5-9201-92a42c755251","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Nv20K5E6YbYOF6O59yZpw","tenantId":"1e800bfb-e1e6-4fce-978c-9f4b07de4d01","createdBy":"Nv20K5E6YbYOF6O59yZpw","ownerId":"Nv20K5E6YbYOF6O59yZpw","status":"active","archived":false,"createdAt":"2025-12-04T02:04:07.974Z","updatedAt":"2025-12-04T02:04:07.974Z"}

{"level":30,"time":1764813848492,"env":"test","module":"user-credentials-repository","userId":"mtVVRDGoqhZdf3e38kVWN","msg":"User credentials created"}
{"level":30,"time":1764813848492,"env":"test","module":"auth-routes","userId":"mtVVRDGoqhZdf3e38kVWN","email":"viewer-L0xrCRtEhkmiEvMDlGL1h@example.com","msg":"User registered successfully"}
{"level":40,"time":1764813848602,"env":"test","module":"rbac-middleware","userId":"mtVVRDGoqhZdf3e38kVWN","userRole":"viewer","permission":"workflow:create","path":"/projects/81e5a06b-e55c-45a5-9201-92a42c755251/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'308e6c2e-13f2-4c1e-8224-d7fe4e732c37'[39m,
  projectId: [32m'f53f0a8c-a57c-4b1a-9caa-798530670ef0'[39m,
  body: { projectId: [32m'f53f0a8c-a57c-4b1a-9caa-798530670ef0'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'308e6c2e-13f2-4c1e-8224-d7fe4e732c37'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'Nv20K5E6YbYOF6O59yZpw'[39m,
  ownerId: [32m'Nv20K5E6YbYOF6O59yZpw'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'f53f0a8c-a57c-4b1a-9caa-798530670ef0'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:04:14.038Z[39m,
  updatedAt: [35m2025-12-04T02:04:14.399Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'33fc9305-bda3-4e74-ab94-aa97947e8688'[39m,
  projectId: [32m'011c4570-80c1-471d-8547-e37851474296'[39m,
  body: { projectId: [32m'011c4570-80c1-471d-8547-e37851474296'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'33fc9305-bda3-4e74-ab94-aa97947e8688'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'Nv20K5E6YbYOF6O59yZpw'[39m,
  ownerId: [32m'Nv20K5E6YbYOF6O59yZpw'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'011c4570-80c1-471d-8547-e37851474296'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:04:14.740Z[39m,
  updatedAt: [35m2025-12-04T02:04:15.096Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'33fc9305-bda3-4e74-ab94-aa97947e8688'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'33fc9305-bda3-4e74-ab94-aa97947e8688'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'Nv20K5E6YbYOF6O59yZpw'[39m,
  ownerId: [32m'Nv20K5E6YbYOF6O59yZpw'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:04:14.740Z[39m,
  updatedAt: [35m2025-12-04T02:04:15.254Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'a2deae19-6b44-4fda-881b-db3a0662085c'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764813855964,"env":"test","error":{},"workflowId":"a2deae19-6b44-4fda-881b-db3a0662085c","userId":"Nv20K5E6YbYOF6O59yZpw","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764813856364,"env":"test","module":"auth-middleware","path":"/api/workflows/411f758e-cbbd-4c09-8149-55505e45a0e1/move","msg":"No valid authentication found"}
{"level":40,"time":1764813856751,"env":"test","module":"auth-middleware","path":"/api/workflows/f75b49ea-9d00-4147-8a8f-d833bed1ad41/move","msg":"No valid authentication found"}
{"level":40,"time":1764813918157,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 130923[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 524[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 888[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 699[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 856[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 999[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 702[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 855[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 399[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30374[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30522[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30504[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:381:10
    379|         .set("Authorization", `Bearer ${authToken2}`)
    380|         .send({ projectId: targetProjectId })
    381|         .expect(403);
       |          ^
    382| 
    383|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:5
    385|     });
    386| 
    387|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    388|       const response = await request(baseURL)
    389|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:397:5
    395|     });
    396| 
    397|     it("should reject move without projectId in body", async () => {
       |     ^
    398|       const response = await request(baseURL)
    399|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:407:5
    405|     });
    406| 
    407|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    408|       // Create a second user with their own project
    409|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:04:01
[2m   Duration [22m 136.44s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764814022985,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764814025315,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764814028636,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764814028637,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764814028648,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764814028648,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764814028649,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764814028649,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764814029240,"env":"test","module":"user-credentials-repository","userId":"TQNpMnIW3TB0nC2FGiotA","msg":"User credentials created"}
{"level":30,"time":1764814029244,"env":"test","module":"auth-routes","userId":"TQNpMnIW3TB0nC2FGiotA","email":"test-workflows-mkr8CKFPuS_N4j-_Ab5Gd@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2f44c628-0edd-47db-b835-b5a1b7733211","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"TQNpMnIW3TB0nC2FGiotA","tenantId":"e99edf53-b782-4af1-a386-a21cef348523","createdBy":"TQNpMnIW3TB0nC2FGiotA","ownerId":"TQNpMnIW3TB0nC2FGiotA","status":"active","archived":false,"createdAt":"2025-12-04T02:07:09.491Z","updatedAt":"2025-12-04T02:07:09.491Z"}

{"level":30,"time":1764814030311,"env":"test","module":"user-credentials-repository","userId":"QAf-rbMdK-5S9JcnEVxxm","msg":"User credentials created"}
{"level":30,"time":1764814030312,"env":"test","module":"auth-routes","userId":"QAf-rbMdK-5S9JcnEVxxm","email":"viewer-3-zvkbR__c1oBTwmNCBPg@example.com","msg":"User registered successfully"}
{"level":40,"time":1764814030429,"env":"test","module":"rbac-middleware","userId":"QAf-rbMdK-5S9JcnEVxxm","userRole":"viewer","permission":"workflow:create","path":"/projects/2f44c628-0edd-47db-b835-b5a1b7733211/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'8477ad88-5bd8-4de9-9639-0735d6ca92b4'[39m,
  projectId: [32m'11d0209a-4918-4021-8361-6880dcce77cf'[39m,
  body: { projectId: [32m'11d0209a-4918-4021-8361-6880dcce77cf'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'8477ad88-5bd8-4de9-9639-0735d6ca92b4'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'TQNpMnIW3TB0nC2FGiotA'[39m,
  ownerId: [32m'TQNpMnIW3TB0nC2FGiotA'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'11d0209a-4918-4021-8361-6880dcce77cf'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:07:16.107Z[39m,
  updatedAt: [35m2025-12-04T02:07:16.503Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'ffba0f9f-4a5c-4001-a9de-a53d19043791'[39m,
  projectId: [32m'65200f5b-594b-45e3-a778-7acead4d8253'[39m,
  body: { projectId: [32m'65200f5b-594b-45e3-a778-7acead4d8253'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'ffba0f9f-4a5c-4001-a9de-a53d19043791'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'TQNpMnIW3TB0nC2FGiotA'[39m,
  ownerId: [32m'TQNpMnIW3TB0nC2FGiotA'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'65200f5b-594b-45e3-a778-7acead4d8253'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:07:16.876Z[39m,
  updatedAt: [35m2025-12-04T02:07:17.253Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'ffba0f9f-4a5c-4001-a9de-a53d19043791'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'ffba0f9f-4a5c-4001-a9de-a53d19043791'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'TQNpMnIW3TB0nC2FGiotA'[39m,
  ownerId: [32m'TQNpMnIW3TB0nC2FGiotA'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:07:16.876Z[39m,
  updatedAt: [35m2025-12-04T02:07:17.458Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'9245e72c-80d4-44ed-8341-115b47d144fa'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764814038211,"env":"test","error":{},"workflowId":"9245e72c-80d4-44ed-8341-115b47d144fa","userId":"TQNpMnIW3TB0nC2FGiotA","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764814038592,"env":"test","module":"auth-middleware","path":"/api/workflows/d0b54355-0fdc-4194-b21a-1a2382057848/move","msg":"No valid authentication found"}
{"level":40,"time":1764814038974,"env":"test","module":"auth-middleware","path":"/api/workflows/63fff619-a92a-431b-b13a-65f347950fd2/move","msg":"No valid authentication found"}
{"level":40,"time":1764814101956,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mUser 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 133330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 911[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 884[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 1098[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 750[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 971[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 382[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30554[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 32045[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:381:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:397:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:407:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:06:59
[2m   Duration [22m 141.53s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764814165118,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764814167808,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764814171864,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764814171865,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764814171875,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764814171875,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764814171876,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764814171876,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764814172453,"env":"test","module":"user-credentials-repository","userId":"xccPz-DOfsxoriFVw7Kf2","msg":"User credentials created"}
{"level":30,"time":1764814172457,"env":"test","module":"auth-routes","userId":"xccPz-DOfsxoriFVw7Kf2","email":"test-workflows-eXQRA4qjRRIMUQulg79VS@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"de7fe7f9-fe16-4b49-8485-b011ced0ee3d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"xccPz-DOfsxoriFVw7Kf2","tenantId":"034a652a-acd5-4db9-bab3-36d544b35b34","createdBy":"xccPz-DOfsxoriFVw7Kf2","ownerId":"xccPz-DOfsxoriFVw7Kf2","status":"active","archived":false,"createdAt":"2025-12-04T02:09:32.718Z","updatedAt":"2025-12-04T02:09:32.718Z"}

{"level":30,"time":1764814173320,"env":"test","module":"user-credentials-repository","userId":"jIt-3bUh23O3kee6e3__L","msg":"User credentials created"}
{"level":30,"time":1764814173321,"env":"test","module":"auth-routes","userId":"jIt-3bUh23O3kee6e3__L","email":"viewer-J79bwGtK3kgcF5gpw7QUk@example.com","msg":"User registered successfully"}
{"level":40,"time":1764814173443,"env":"test","module":"rbac-middleware","userId":"jIt-3bUh23O3kee6e3__L","userRole":"viewer","permission":"workflow:create","path":"/projects/de7fe7f9-fe16-4b49-8485-b011ced0ee3d/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'504d8595-cc49-41d8-8c35-d172f2cb2024'[39m,
  projectId: [32m'bb314bca-826a-4930-835d-e92e2c3b8742'[39m,
  body: { projectId: [32m'bb314bca-826a-4930-835d-e92e2c3b8742'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'504d8595-cc49-41d8-8c35-d172f2cb2024'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'xccPz-DOfsxoriFVw7Kf2'[39m,
  ownerId: [32m'xccPz-DOfsxoriFVw7Kf2'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'bb314bca-826a-4930-835d-e92e2c3b8742'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:09:39.163Z[39m,
  updatedAt: [35m2025-12-04T02:09:39.646Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'efe8b26d-12bd-4d1c-b80d-665cf4e66814'[39m,
  projectId: [32m'cc4c87da-61f5-493b-993f-ec365b7d40cb'[39m,
  body: { projectId: [32m'cc4c87da-61f5-493b-993f-ec365b7d40cb'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'efe8b26d-12bd-4d1c-b80d-665cf4e66814'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'xccPz-DOfsxoriFVw7Kf2'[39m,
  ownerId: [32m'xccPz-DOfsxoriFVw7Kf2'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'cc4c87da-61f5-493b-993f-ec365b7d40cb'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:09:40.108Z[39m,
  updatedAt: [35m2025-12-04T02:09:40.499Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'efe8b26d-12bd-4d1c-b80d-665cf4e66814'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'efe8b26d-12bd-4d1c-b80d-665cf4e66814'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'xccPz-DOfsxoriFVw7Kf2'[39m,
  ownerId: [32m'xccPz-DOfsxoriFVw7Kf2'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:09:40.108Z[39m,
  updatedAt: [35m2025-12-04T02:09:40.665Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'f7d7280f-defb-4d04-8961-aa29633de20c'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764814181406,"env":"test","error":{},"workflowId":"f7d7280f-defb-4d04-8961-aa29633de20c","userId":"xccPz-DOfsxoriFVw7Kf2","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764814181788,"env":"test","module":"auth-middleware","path":"/api/workflows/87e4f4ad-cf48-4166-bf7d-8f7fd364a36a/move","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mAuth Token 2: Unset

{"level":40,"time":1764814182192,"env":"test","module":"auth-middleware","path":"/api/workflows/f262eb22-b1eb-4492-8740-7191610af9b6/move","msg":"No valid authentication found"}
{"level":40,"time":1764814243812,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mUser 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 131952[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 424[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 991[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 875[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 930[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 927[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 932[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 382[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 404[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30398[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30523[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30693[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:382:10
    380|         .set("Authorization", `Bearer ${authToken2}`)
    381|         .send({ projectId: targetProjectId })
    382|         .expect(403);
       |          ^
    383| 
    384|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:388:5
    386|     });
    387| 
    388|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    389|       const response = await request(baseURL)
    390|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:398:5
    396|     });
    397| 
    398|     it("should reject move without projectId in body", async () => {
       |     ^
    399|       const response = await request(baseURL)
    400|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:408:5
    406|     });
    407| 
    408|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    409|       // Create a second user with their own project
    410|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:09:22
[2m   Duration [22m 141.44s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764814782075,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764814784480,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764814787816,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764814787817,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764814787830,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764814787830,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764814787830,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764814787831,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764814788353,"env":"test","module":"user-credentials-repository","userId":"htBj28FXXZLveZ9oJiUgN","msg":"User credentials created"}
{"level":30,"time":1764814788356,"env":"test","module":"auth-routes","userId":"htBj28FXXZLveZ9oJiUgN","email":"test-workflows-6qj1dL27fL3IoJ9AmqLIG@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"fb2d79c1-b1f4-4876-8209-ba342fbca536","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"htBj28FXXZLveZ9oJiUgN","tenantId":"a417b023-4ab9-4755-9b21-9e34011325ad","createdBy":"htBj28FXXZLveZ9oJiUgN","ownerId":"htBj28FXXZLveZ9oJiUgN","status":"active","archived":false,"createdAt":"2025-12-04T02:19:48.621Z","updatedAt":"2025-12-04T02:19:48.621Z"}

{"level":30,"time":1764814789142,"env":"test","module":"user-credentials-repository","userId":"eIEiM83CWDX7pq_uIqeiv","msg":"User credentials created"}
{"level":30,"time":1764814789143,"env":"test","module":"auth-routes","userId":"eIEiM83CWDX7pq_uIqeiv","email":"viewer-VqXywnWCYD_eXUO5jlnqB@example.com","msg":"User registered successfully"}
{"level":40,"time":1764814789254,"env":"test","module":"rbac-middleware","userId":"eIEiM83CWDX7pq_uIqeiv","userRole":"viewer","permission":"workflow:create","path":"/projects/fb2d79c1-b1f4-4876-8209-ba342fbca536/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'2a3a21f4-98e0-4177-b928-ebdccd1df1f0'[39m,
  projectId: [32m'b864d682-301f-4477-aab8-9c95093d4fca'[39m,
  body: { projectId: [32m'b864d682-301f-4477-aab8-9c95093d4fca'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'2a3a21f4-98e0-4177-b928-ebdccd1df1f0'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'htBj28FXXZLveZ9oJiUgN'[39m,
  ownerId: [32m'htBj28FXXZLveZ9oJiUgN'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'b864d682-301f-4477-aab8-9c95093d4fca'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:19:54.943Z[39m,
  updatedAt: [35m2025-12-04T02:19:55.313Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'9e24cf18-646a-4b02-b266-8ceb58a28207'[39m,
  projectId: [32m'd0555aaa-9f8f-4888-93fb-5c89c465dfef'[39m,
  body: { projectId: [32m'd0555aaa-9f8f-4888-93fb-5c89c465dfef'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'9e24cf18-646a-4b02-b266-8ceb58a28207'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'htBj28FXXZLveZ9oJiUgN'[39m,
  ownerId: [32m'htBj28FXXZLveZ9oJiUgN'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'd0555aaa-9f8f-4888-93fb-5c89c465dfef'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:19:55.692Z[39m,
  updatedAt: [35m2025-12-04T02:19:56.187Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'9e24cf18-646a-4b02-b266-8ceb58a28207'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'9e24cf18-646a-4b02-b266-8ceb58a28207'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'htBj28FXXZLveZ9oJiUgN'[39m,
  ownerId: [32m'htBj28FXXZLveZ9oJiUgN'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:19:55.692Z[39m,
  updatedAt: [35m2025-12-04T02:19:56.392Z[39m
}

{"level":50,"time":1764814797312,"env":"test","error":{},"workflowId":"4eda8b2f-7017-4e82-bca8-18f6228f9de9","userId":"htBj28FXXZLveZ9oJiUgN","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'4eda8b2f-7017-4e82-bca8-18f6228f9de9'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764814797707,"env":"test","module":"auth-middleware","path":"/api/workflows/7fca68a3-b4d4-4160-8e1a-7d39c75f5869/move","msg":"No valid authentication found"}
{"level":40,"time":1764814798099,"env":"test","module":"auth-middleware","path":"/api/workflows/718152ec-1fe6-496a-ac9c-430960898284/move","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mAuth Token 2: Unset

{"level":40,"time":1764814859762,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m401[39m {"message":"Authentication required","error":"unauthorized"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 131956[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 387[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 970[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 719[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 956[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 807[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 927[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 742[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 1148[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 681[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 394[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 392[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30586[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30679[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:382:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:388:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:398:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:408:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:19:39
[2m   Duration [22m 140.14s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764814922366,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764814924050,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764814925966,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764814925966,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764814925976,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764814925976,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764814925976,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764814925976,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764814926468,"env":"test","module":"user-credentials-repository","userId":"pdpb8N-9bD7ov9I6r6UJp","msg":"User credentials created"}
{"level":30,"time":1764814926471,"env":"test","module":"auth-routes","userId":"pdpb8N-9bD7ov9I6r6UJp","email":"test-workflows-qUwfU8KMV_7w-0UZotH3F@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"be5e7ff7-d93f-4bfb-93c7-3f320339db4a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"pdpb8N-9bD7ov9I6r6UJp","tenantId":"7d3c28ea-80ac-46c6-af0c-e34632d0bc85","createdBy":"pdpb8N-9bD7ov9I6r6UJp","ownerId":"pdpb8N-9bD7ov9I6r6UJp","status":"active","archived":false,"createdAt":"2025-12-04T02:22:06.723Z","updatedAt":"2025-12-04T02:22:06.723Z"}

{"level":30,"time":1764814927214,"env":"test","module":"user-credentials-repository","userId":"L2u53694czIAegUYxxAaN","msg":"User credentials created"}
{"level":30,"time":1764814927215,"env":"test","module":"auth-routes","userId":"L2u53694czIAegUYxxAaN","email":"viewer-DtdPzARHPYS_YGZmJrS7w@example.com","msg":"User registered successfully"}
{"level":40,"time":1764814927324,"env":"test","module":"rbac-middleware","userId":"L2u53694czIAegUYxxAaN","userRole":"viewer","permission":"workflow:create","path":"/projects/be5e7ff7-d93f-4bfb-93c7-3f320339db4a/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'6a76ec6d-f976-499d-9b36-b5372a8a5e98'[39m,
  projectId: [32m'33f8d065-dab9-49c4-95e7-66fb1fcbc4be'[39m,
  body: { projectId: [32m'33f8d065-dab9-49c4-95e7-66fb1fcbc4be'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'6a76ec6d-f976-499d-9b36-b5372a8a5e98'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'pdpb8N-9bD7ov9I6r6UJp'[39m,
  ownerId: [32m'pdpb8N-9bD7ov9I6r6UJp'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'33f8d065-dab9-49c4-95e7-66fb1fcbc4be'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:22:12.921Z[39m,
  updatedAt: [35m2025-12-04T02:22:13.266Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'fe23967e-bb6e-42a4-97ba-8be926d91ff0'[39m,
  projectId: [32m'd837d241-8be4-4bc0-a65f-ed39d23cea57'[39m,
  body: { projectId: [32m'd837d241-8be4-4bc0-a65f-ed39d23cea57'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'fe23967e-bb6e-42a4-97ba-8be926d91ff0'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'pdpb8N-9bD7ov9I6r6UJp'[39m,
  ownerId: [32m'pdpb8N-9bD7ov9I6r6UJp'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'd837d241-8be4-4bc0-a65f-ed39d23cea57'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:22:13.625Z[39m,
  updatedAt: [35m2025-12-04T02:22:13.971Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'fe23967e-bb6e-42a4-97ba-8be926d91ff0'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'fe23967e-bb6e-42a4-97ba-8be926d91ff0'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'pdpb8N-9bD7ov9I6r6UJp'[39m,
  ownerId: [32m'pdpb8N-9bD7ov9I6r6UJp'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:22:13.625Z[39m,
  updatedAt: [35m2025-12-04T02:22:14.131Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'd862ad7d-2229-4fde-9fbe-a800977c63f8'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764814934818,"env":"test","error":{},"workflowId":"d862ad7d-2229-4fde-9fbe-a800977c63f8","userId":"pdpb8N-9bD7ov9I6r6UJp","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764814935196,"env":"test","module":"auth-middleware","path":"/api/workflows/06ffd21c-d9aa-4d3d-be74-c57c67b55bf6/move","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m400[39m {"message":"Password must contain at least one uppercase letter","error":"weak_password"}
Auth Token 2: Unset

{"level":40,"time":1764814935566,"env":"test","module":"auth-middleware","path":"/api/workflows/21c9bee7-dec2-42cf-9c94-af73f3dd2965/move","msg":"No valid authentication found"}
{"level":40,"time":1764815004589,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m401[39m {"message":"Authentication required","error":"unauthorized"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 138629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 365[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 899[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 844[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 1154[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 703[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 871[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 521[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 370[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30374[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30533[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 38112[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:383:10
    381|         .set("Authorization", `Bearer ${authToken2}`)
    382|         .send({ projectId: targetProjectId })
    383|         .expect(403);
       |          ^
    384| 
    385|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5
    407|     });
    408| 
    409|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    410|       // Create a second user with their own project
    411|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:21:59
[2m   Duration [22m 144.37s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764851239948,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764851242500,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764851246210,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764851246210,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764851246223,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764851246223,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764851246224,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764851246224,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764851246824,"env":"test","module":"user-credentials-repository","userId":"gLZhWK-VXURi9wnyDcer7","msg":"User credentials created"}
{"level":30,"time":1764851246827,"env":"test","module":"auth-routes","userId":"gLZhWK-VXURi9wnyDcer7","email":"test-workflows-tuWh-32SPmxy3WiqATNlZ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"0f651977-38cc-4825-a256-cd339e361b5c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"gLZhWK-VXURi9wnyDcer7","tenantId":"3e08c512-a4ba-4f18-a856-a052907ecf6f","createdBy":"gLZhWK-VXURi9wnyDcer7","ownerId":"gLZhWK-VXURi9wnyDcer7","status":"active","archived":false,"createdAt":"2025-12-04T12:27:27.890Z","updatedAt":"2025-12-04T12:27:27.890Z"}

{"level":30,"time":1764851247703,"env":"test","module":"user-credentials-repository","userId":"NqSjjaCslkunBwYL67gIX","msg":"User credentials created"}
{"level":30,"time":1764851247703,"env":"test","module":"auth-routes","userId":"NqSjjaCslkunBwYL67gIX","email":"viewer-kkygdHsEdWQIbx4aS5HA1@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851247814,"env":"test","module":"rbac-middleware","userId":"NqSjjaCslkunBwYL67gIX","userRole":"viewer","permission":"workflow:create","path":"/projects/0f651977-38cc-4825-a256-cd339e361b5c/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'c89f1115-7895-4f08-9b29-f02dab56b395'[39m,
  projectId: [32m'33995c1e-525f-45fd-8b5b-1628d0b8ddcf'[39m,
  body: { projectId: [32m'33995c1e-525f-45fd-8b5b-1628d0b8ddcf'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'c89f1115-7895-4f08-9b29-f02dab56b395'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'gLZhWK-VXURi9wnyDcer7'[39m,
  ownerId: [32m'gLZhWK-VXURi9wnyDcer7'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'33995c1e-525f-45fd-8b5b-1628d0b8ddcf'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:27:34.022Z[39m,
  updatedAt: [35m2025-12-04T12:27:33.598Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'fe367d94-8c04-41ad-a3ac-bcdef9746bbd'[39m,
  projectId: [32m'2b3c3241-42c4-41e6-a575-bf27e9378b60'[39m,
  body: { projectId: [32m'2b3c3241-42c4-41e6-a575-bf27e9378b60'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'fe367d94-8c04-41ad-a3ac-bcdef9746bbd'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'gLZhWK-VXURi9wnyDcer7'[39m,
  ownerId: [32m'gLZhWK-VXURi9wnyDcer7'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'2b3c3241-42c4-41e6-a575-bf27e9378b60'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:27:34.728Z[39m,
  updatedAt: [35m2025-12-04T12:27:34.327Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'fe367d94-8c04-41ad-a3ac-bcdef9746bbd'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'fe367d94-8c04-41ad-a3ac-bcdef9746bbd'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'gLZhWK-VXURi9wnyDcer7'[39m,
  ownerId: [32m'gLZhWK-VXURi9wnyDcer7'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:27:34.728Z[39m,
  updatedAt: [35m2025-12-04T12:27:34.491Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'5f7b1c8a-842a-4cf7-920a-accf66aba80d'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764851255236,"env":"test","error":{},"workflowId":"5f7b1c8a-842a-4cf7-920a-accf66aba80d","userId":"gLZhWK-VXURi9wnyDcer7","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764851255624,"env":"test","module":"auth-middleware","path":"/api/workflows/47a1b1b3-81e3-495b-92be-3e3adcb85051/move","msg":"No valid authentication found"}
{"level":30,"time":1764851256230,"env":"test","module":"user-credentials-repository","userId":"bi6Y9NuKBLudT2TZ2-0WI","msg":"User credentials created"}
{"level":30,"time":1764851256230,"env":"test","module":"auth-routes","userId":"bi6Y9NuKBLudT2TZ2-0WI","email":"test-workflows-NK9S6nqIQtMhdN1U-iyeK@example.com","msg":"User registered successfully"}
{"level":50,"time":1764851256291,"env":"test","error":{},"workflowId":"35f0d76d-82e5-4d26-a9e9-83d5a86dc938","userId":"bi6Y9NuKBLudT2TZ2-0WI","projectId":"4fb8d48a-ac96-4e54-a220-921b19b2ab02","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiaTZZOU51S0JMdWRUMlRaMi0wV0kiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLU5LOVM2bnFJUXRNaGROMVUtaXllS0BleGFtcGxlLmNvbSIsInRlbmFudElkIjoiM2UwOGM1MTItYTRiYS00ZjE4LWE4NTYtYTA1MjkwN2VjZjZmIiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUxMjU2LCJleHAiOjE3NjU0NTYwNTZ9.WrhJEnOEUj9FrYP570NAT2e4ekGblKvrWBF5K4NKZwI","user":{"id":"bi6Y9NuKBLudT2TZ2-0WI","email":"test-workflows-NK9S6nqIQtMhdN1U-iyeK@example.com","firstName":null,"lastName":null,"tenantId":"3e08c512-a4ba-4f18-a856-a052907ecf6f","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'35f0d76d-82e5-4d26-a9e9-83d5a86dc938'[39m,
  projectId: [32m'4fb8d48a-ac96-4e54-a220-921b19b2ab02'[39m,
  body: { projectId: [32m'4fb8d48a-ac96-4e54-a220-921b19b2ab02'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":50,"time":1764851287056,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(gLZhWK-VXURi9wnyDcer7) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"gLZhWK-VXURi9wnyDcer7","msg":"Error creating workflow"}
{"level":40,"time":1764851287110,"env":"test","module":"tenant-middleware","userId":"gLZhWK-VXURi9wnyDcer7","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764851317472,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(gLZhWK-VXURi9wnyDcer7) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"gLZhWK-VXURi9wnyDcer7","msg":"Error creating workflow"}
{"level":40,"time":1764851317529,"env":"test","module":"tenant-middleware","userId":"gLZhWK-VXURi9wnyDcer7","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764851317535,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m401[39m {"message":"Authentication required","error":"unauthorized"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 131333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 418[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 932[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 840[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 904[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 701[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 898[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 386[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 671[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30396[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30421[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30418[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:27:16
[2m   Duration [22m 140.17s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764851379449,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764851382015,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764851385301,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764851385301,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764851385322,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764851385322,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764851385323,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764851385323,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764851385883,"env":"test","module":"user-credentials-repository","userId":"nkk_juGcnELX9rH2U_fPQ","msg":"User credentials created"}
{"level":30,"time":1764851385887,"env":"test","module":"auth-routes","userId":"nkk_juGcnELX9rH2U_fPQ","email":"test-workflows-pjdqUoqbBVBo9v8w4zewR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"ada9249e-12cb-4634-94c7-59a9ebe97759","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"nkk_juGcnELX9rH2U_fPQ","tenantId":"3394f7b4-f1af-4bf7-98a2-41f57f8b607f","createdBy":"nkk_juGcnELX9rH2U_fPQ","ownerId":"nkk_juGcnELX9rH2U_fPQ","status":"active","archived":false,"createdAt":"2025-12-04T12:29:47.179Z","updatedAt":"2025-12-04T12:29:47.179Z"}

{"level":30,"time":1764851387066,"env":"test","module":"user-credentials-repository","userId":"_RLU2Xmy3t6-n9UuKICW6","msg":"User credentials created"}
{"level":30,"time":1764851387067,"env":"test","module":"auth-routes","userId":"_RLU2Xmy3t6-n9UuKICW6","email":"viewer-Q0Qjeo30d8fwSj_sF95zh@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851387190,"env":"test","module":"rbac-middleware","userId":"_RLU2Xmy3t6-n9UuKICW6","userRole":"viewer","permission":"workflow:create","path":"/projects/ada9249e-12cb-4634-94c7-59a9ebe97759/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'eba7e289-ba63-48b0-907f-a6d32d2f56bf'[39m,
  projectId: [32m'be766330-5d4a-4bff-bb28-6be826961599'[39m,
  body: { projectId: [32m'be766330-5d4a-4bff-bb28-6be826961599'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'eba7e289-ba63-48b0-907f-a6d32d2f56bf'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'nkk_juGcnELX9rH2U_fPQ'[39m,
  ownerId: [32m'nkk_juGcnELX9rH2U_fPQ'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'be766330-5d4a-4bff-bb28-6be826961599'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:29:53.419Z[39m,
  updatedAt: [35m2025-12-04T12:29:52.991Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'c8f8cc76-2cbc-48c8-a6b6-b181e6a4588d'[39m,
  projectId: [32m'b26d4e67-5e7d-485a-b999-7e1358f7e853'[39m,
  body: { projectId: [32m'b26d4e67-5e7d-485a-b999-7e1358f7e853'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'c8f8cc76-2cbc-48c8-a6b6-b181e6a4588d'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'nkk_juGcnELX9rH2U_fPQ'[39m,
  ownerId: [32m'nkk_juGcnELX9rH2U_fPQ'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'b26d4e67-5e7d-485a-b999-7e1358f7e853'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:29:54.141Z[39m,
  updatedAt: [35m2025-12-04T12:29:53.722Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'c8f8cc76-2cbc-48c8-a6b6-b181e6a4588d'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'c8f8cc76-2cbc-48c8-a6b6-b181e6a4588d'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'nkk_juGcnELX9rH2U_fPQ'[39m,
  ownerId: [32m'nkk_juGcnELX9rH2U_fPQ'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:29:54.141Z[39m,
  updatedAt: [35m2025-12-04T12:29:53.886Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'efa77828-5b16-48a1-a42d-814e0f17f67c'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764851394606,"env":"test","error":{},"workflowId":"efa77828-5b16-48a1-a42d-814e0f17f67c","userId":"nkk_juGcnELX9rH2U_fPQ","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764851394995,"env":"test","module":"auth-middleware","path":"/api/workflows/df62e6f6-b748-45ec-bb4c-5b644bc33007/move","msg":"No valid authentication found"}
{"level":30,"time":1764851395578,"env":"test","module":"user-credentials-repository","userId":"WQuCaEIGtYKzScfDe8eaf","msg":"User credentials created"}
{"level":30,"time":1764851395580,"env":"test","module":"auth-routes","userId":"WQuCaEIGtYKzScfDe8eaf","email":"test-workflows-1NY8SRgMQCcYycvNNXLMD@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJXUXVDYUVJR3RZS3pTY2ZEZThlYWYiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLTFOWThTUmdNUUNjWXljdk5OWExNREBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiMzM5NGY3YjQtZjFhZi00YmY3LTk4YTItNDFmNTdmOGI2MDdmIiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUxMzk1LCJleHAiOjE3NjU0NTYxOTV9.OUoq74IP8MGLqXIn1pCPADs14VOxH3WuMtyPM4N_siM","user":{"id":"WQuCaEIGtYKzScfDe8eaf","email":"test-workflows-1NY8SRgMQCcYycvNNXLMD@example.com","firstName":null,"lastName":null,"tenantId":"3394f7b4-f1af-4bf7-98a2-41f57f8b607f","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'e3cf4baf-cec3-4dd3-bece-938730900867'[39m,
  projectId: [32m'c3eb4d30-b127-440c-8ff7-6c25a8a0258d'[39m,
  body: { projectId: [32m'c3eb4d30-b127-440c-8ff7-6c25a8a0258d'[39m }
}

{"level":50,"time":1764851395642,"env":"test","error":{},"workflowId":"e3cf4baf-cec3-4dd3-bece-938730900867","userId":"WQuCaEIGtYKzScfDe8eaf","projectId":"c3eb4d30-b127-440c-8ff7-6c25a8a0258d","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":50,"time":1764851426398,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(nkk_juGcnELX9rH2U_fPQ) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"nkk_juGcnELX9rH2U_fPQ","msg":"Error creating workflow"}
{"level":40,"time":1764851426448,"env":"test","module":"tenant-middleware","userId":"nkk_juGcnELX9rH2U_fPQ","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764851456957,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(nkk_juGcnELX9rH2U_fPQ) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"nkk_juGcnELX9rH2U_fPQ","msg":"Error creating workflow"}
{"level":40,"time":1764851457015,"env":"test","module":"tenant-middleware","userId":"nkk_juGcnELX9rH2U_fPQ","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764851457225,"env":"test","module":"user-credentials-repository","userId":"ML947RD3Hpz34WCCd1hOV","msg":"User credentials created"}
{"level":30,"time":1764851457226,"env":"test","module":"auth-routes","userId":"ML947RD3Hpz34WCCd1hOV","email":"test-workflows-sYZ743zP1RBY_KGTA2-uf@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851457229,"env":"test","module":"rbac-middleware","userId":"ML947RD3Hpz34WCCd1hOV","userRole":null,"permission":"project:create","path":"/","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m403[39m {"message":"Permission denied","error":"forbidden","details":"Required permission: project:create"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 131728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 401[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 917[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 692[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 851[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 910[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 728[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 879[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 387[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 649[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30390[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30417[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30564[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5
    407|     });
    408| 
    409|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    410|       // Create a second user with their own project
    411|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:29:37
[2m   Duration [22m 139.12s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764852091754,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852095592,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852099690,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852099690,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852099717,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852099717,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852099717,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852099717,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852100369,"env":"test","module":"user-credentials-repository","userId":"zxrl_NOhGeOwc1bwLBus4","msg":"User credentials created"}
{"level":30,"time":1764852100372,"env":"test","module":"auth-routes","userId":"zxrl_NOhGeOwc1bwLBus4","email":"test-workflows-s31wUPEsg-_XRfs9Ac9XT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e789c4e4-6237-4d91-b83f-502cdca8dcfa","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"zxrl_NOhGeOwc1bwLBus4","tenantId":"72ff602a-ac26-414c-9d52-12cb8e1c279b","createdBy":"zxrl_NOhGeOwc1bwLBus4","ownerId":"zxrl_NOhGeOwc1bwLBus4","status":"active","archived":false,"createdAt":"2025-12-04T12:41:41.411Z","updatedAt":"2025-12-04T12:41:41.411Z"}

{"level":30,"time":1764852101145,"env":"test","module":"user-credentials-repository","userId":"YNP8Ldf4eigy6ctOHRkBG","msg":"User credentials created"}
{"level":30,"time":1764852101146,"env":"test","module":"auth-routes","userId":"YNP8Ldf4eigy6ctOHRkBG","email":"viewer-5NPynjEsmweEtj8iucABt@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852101257,"env":"test","module":"rbac-middleware","userId":"YNP8Ldf4eigy6ctOHRkBG","userRole":"viewer","permission":"workflow:create","path":"/projects/e789c4e4-6237-4d91-b83f-502cdca8dcfa/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'e0a3eb23-d4a1-4eb4-93f2-133ac057c0cd'[39m,
  projectId: [32m'e2d25bdc-e250-4105-a375-bf8842e29245'[39m,
  body: { projectId: [32m'e2d25bdc-e250-4105-a375-bf8842e29245'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'e0a3eb23-d4a1-4eb4-93f2-133ac057c0cd'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'zxrl_NOhGeOwc1bwLBus4'[39m,
  ownerId: [32m'zxrl_NOhGeOwc1bwLBus4'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'e2d25bdc-e250-4105-a375-bf8842e29245'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:47.302Z[39m,
  updatedAt: [35m2025-12-04T12:41:46.858Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'09a1da8c-da13-4367-baa2-d25b721af173'[39m,
  projectId: [32m'acbc9a33-6f7b-4fc0-b827-7de10e34fdd8'[39m,
  body: { projectId: [32m'acbc9a33-6f7b-4fc0-b827-7de10e34fdd8'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'09a1da8c-da13-4367-baa2-d25b721af173'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'zxrl_NOhGeOwc1bwLBus4'[39m,
  ownerId: [32m'zxrl_NOhGeOwc1bwLBus4'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'acbc9a33-6f7b-4fc0-b827-7de10e34fdd8'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:48.004Z[39m,
  updatedAt: [35m2025-12-04T12:41:47.557Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'09a1da8c-da13-4367-baa2-d25b721af173'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'09a1da8c-da13-4367-baa2-d25b721af173'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'zxrl_NOhGeOwc1bwLBus4'[39m,
  ownerId: [32m'zxrl_NOhGeOwc1bwLBus4'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:48.004Z[39m,
  updatedAt: [35m2025-12-04T12:41:47.719Z[39m
}

{"level":50,"time":1764852108437,"env":"test","error":{},"workflowId":"f8b23253-3f72-48db-82dd-0cba9fc58edd","userId":"zxrl_NOhGeOwc1bwLBus4","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'f8b23253-3f72-48db-82dd-0cba9fc58edd'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764852108812,"env":"test","module":"auth-middleware","path":"/api/workflows/1d20b866-f31a-402f-b765-3a1bf9f33034/move","msg":"No valid authentication found"}
{"level":30,"time":1764852109458,"env":"test","module":"user-credentials-repository","userId":"e1pIpOXLTnt5GAh2mKAWA","msg":"User credentials created"}
{"level":30,"time":1764852109459,"env":"test","module":"auth-routes","userId":"e1pIpOXLTnt5GAh2mKAWA","email":"test-workflows-Uls04Np9ADFHrvfFwrEdC@example.com","msg":"User registered successfully"}
{"level":50,"time":1764852109515,"env":"test","error":{},"workflowId":"856b953f-3d6a-4d37-a22f-f8737ade21cc","userId":"e1pIpOXLTnt5GAh2mKAWA","projectId":"06ca604b-be99-4f19-824c-33120811c2a1","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJlMXBJcE9YTFRudDVHQWgybUtBV0EiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLVVsczA0TnA5QURGSHJ2ZkZ3ckVkQ0BleGFtcGxlLmNvbSIsInRlbmFudElkIjoiNzJmZjYwMmEtYWMyNi00MTRjLTlkNTItMTJjYjhlMWMyNzliIiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyMTA5LCJleHAiOjE3NjU0NTY5MDl9.fhTmR0kqfBZ8t6DqnWquWWoDYqZ6VrJv4HU5dBQzEzg","user":{"id":"e1pIpOXLTnt5GAh2mKAWA","email":"test-workflows-Uls04Np9ADFHrvfFwrEdC@example.com","firstName":null,"lastName":null,"tenantId":"72ff602a-ac26-414c-9d52-12cb8e1c279b","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'856b953f-3d6a-4d37-a22f-f8737ade21cc'[39m,
  projectId: [32m'06ca604b-be99-4f19-824c-33120811c2a1'[39m,
  body: { projectId: [32m'06ca604b-be99-4f19-824c-33120811c2a1'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764852171131,"env":"test","module":"user-credentials-repository","userId":"s25qk6Dktvo_uL6FMx1x7","msg":"User credentials created"}
{"level":30,"time":1764852171131,"env":"test","module":"auth-routes","userId":"s25qk6Dktvo_uL6FMx1x7","email":"test-workflows-zpNQii1kOMXuD8rQhkEgI@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852171190,"env":"test","module":"rbac-middleware","userId":"s25qk6Dktvo_uL6FMx1x7","userRole":null,"permission":"project:create","path":"/","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m403[39m {"message":"Permission denied","error":"forbidden","details":"Required permission: project:create"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 131235[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 524[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 514[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 896[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 676[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 810[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 911[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 700[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 871[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 703[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30505[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30517[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5
    407|     });
    408| 
    409|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    410|       // Create a second user with their own project
    411|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:41:27
[2m   Duration [22m 142.63s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764852395530,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852400590,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852405558,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852405558,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852405575,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852405575,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852405576,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852405576,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852406294,"env":"test","module":"user-credentials-repository","userId":"vzOM0RJxP9gadjMgFYMEd","msg":"User credentials created"}
{"level":30,"time":1764852406300,"env":"test","module":"auth-routes","userId":"vzOM0RJxP9gadjMgFYMEd","email":"test-workflows-9qbedXflx6Bu_o4h9NlF6@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"03ec8f24-c422-463b-9d91-049686cb5cb7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"vzOM0RJxP9gadjMgFYMEd","tenantId":"6d6889ed-9a7f-4582-be0d-625ce10c7ec7","createdBy":"vzOM0RJxP9gadjMgFYMEd","ownerId":"vzOM0RJxP9gadjMgFYMEd","status":"active","archived":false,"createdAt":"2025-12-04T12:46:47.354Z","updatedAt":"2025-12-04T12:46:47.354Z"}

{"level":30,"time":1764852407155,"env":"test","module":"user-credentials-repository","userId":"w9-20gGQhjthCIM1P3lNx","msg":"User credentials created"}
{"level":30,"time":1764852407156,"env":"test","module":"auth-routes","userId":"w9-20gGQhjthCIM1P3lNx","email":"viewer-fS2-rWxJI4pnhzJ_cF4i7@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852407268,"env":"test","module":"rbac-middleware","userId":"w9-20gGQhjthCIM1P3lNx","userRole":"viewer","permission":"workflow:create","path":"/projects/03ec8f24-c422-463b-9d91-049686cb5cb7/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'0e16b025-36ae-40ea-a4e8-909ca26d2607'[39m,
  projectId: [32m'51e229fc-2bb7-4073-aa92-12795a097fff'[39m,
  body: { projectId: [32m'51e229fc-2bb7-4073-aa92-12795a097fff'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'0e16b025-36ae-40ea-a4e8-909ca26d2607'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'vzOM0RJxP9gadjMgFYMEd'[39m,
  ownerId: [32m'vzOM0RJxP9gadjMgFYMEd'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'51e229fc-2bb7-4073-aa92-12795a097fff'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:53.603Z[39m,
  updatedAt: [35m2025-12-04T12:46:53.155Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'2b116dfb-bcd5-4efa-af3d-68d3cc510dbe'[39m,
  projectId: [32m'd0018b71-a3a3-4a81-ad37-a3638abb6299'[39m,
  body: { projectId: [32m'd0018b71-a3a3-4a81-ad37-a3638abb6299'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'2b116dfb-bcd5-4efa-af3d-68d3cc510dbe'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'vzOM0RJxP9gadjMgFYMEd'[39m,
  ownerId: [32m'vzOM0RJxP9gadjMgFYMEd'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'd0018b71-a3a3-4a81-ad37-a3638abb6299'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:54.308Z[39m,
  updatedAt: [35m2025-12-04T12:46:53.863Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'2b116dfb-bcd5-4efa-af3d-68d3cc510dbe'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'2b116dfb-bcd5-4efa-af3d-68d3cc510dbe'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'vzOM0RJxP9gadjMgFYMEd'[39m,
  ownerId: [32m'vzOM0RJxP9gadjMgFYMEd'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:54.308Z[39m,
  updatedAt: [35m2025-12-04T12:46:54.029Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'378a64fc-f7e4-46f5-940e-f95e131b5ef9'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764852414786,"env":"test","error":{},"workflowId":"378a64fc-f7e4-46f5-940e-f95e131b5ef9","userId":"vzOM0RJxP9gadjMgFYMEd","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764852415179,"env":"test","module":"auth-middleware","path":"/api/workflows/48babf42-25c6-465f-b9d6-33bae301b215/move","msg":"No valid authentication found"}
{"level":30,"time":1764852415779,"env":"test","module":"user-credentials-repository","userId":"NwZJF2e0FMbbg4Xcw6dwm","msg":"User credentials created"}
{"level":30,"time":1764852415780,"env":"test","module":"auth-routes","userId":"NwZJF2e0FMbbg4Xcw6dwm","email":"test-workflows-l1qh29O5XCE3nqVWjc9Lb@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJOd1pKRjJlMEZNYmJnNFhjdzZkd20iLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLWwxcWgyOU81WENFM25xVldqYzlMYkBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiNmQ2ODg5ZWQtOWE3Zi00NTgyLWJlMGQtNjI1Y2UxMGM3ZWM3Iiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyNDE1LCJleHAiOjE3NjU0NTcyMTV9.PtkHjbHTwyHplLy65ATtNFaOnoqLGPpS30ThMlfWbgk","user":{"id":"NwZJF2e0FMbbg4Xcw6dwm","email":"test-workflows-l1qh29O5XCE3nqVWjc9Lb@example.com","firstName":null,"lastName":null,"tenantId":"6d6889ed-9a7f-4582-be0d-625ce10c7ec7","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'8cda7b87-234e-4814-8935-8d887310d579'[39m,
  projectId: [32m'c1d8d040-1591-4d15-84d6-d6493eed8ffd'[39m,
  body: { projectId: [32m'c1d8d040-1591-4d15-84d6-d6493eed8ffd'[39m }
}

{"level":50,"time":1764852415840,"env":"test","error":{},"workflowId":"8cda7b87-234e-4814-8935-8d887310d579","userId":"NwZJF2e0FMbbg4Xcw6dwm","projectId":"c1d8d040-1591-4d15-84d6-d6493eed8ffd","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764852477534,"env":"test","module":"user-credentials-repository","userId":"Tu1ZkE8fvhbB7nrzzpz2U","msg":"User credentials created"}
{"level":30,"time":1764852477534,"env":"test","module":"auth-routes","userId":"Tu1ZkE8fvhbB7nrzzpz2U","email":"test-workflows-2cdPzS8Oh2Jlu4FaIBOBI@example.com","msg":"User registered successfully"}
{"level":30,"time":1764852477765,"env":"test","module":"auth-routes","userId":"Tu1ZkE8fvhbB7nrzzpz2U","email":"test-workflows-2cdPzS8Oh2Jlu4FaIBOBI@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m201[39m {"id":"50373413-6491-4586-b813-cdd01a80341d","title":"User 2 Project","name":"User 2 Project","description":"Project owned by user 2","creatorId":"Tu1ZkE8fvhbB7nrzzpz2U","tenantId":"6d6889ed-9a7f-4582-be0d-625ce10c7ec7","createdBy":"Tu1ZkE8fvhbB7nrzzpz2U","ownerId":"Tu1ZkE8fvhbB7nrzzpz2U","status":"active","archived":false,"createdAt":"2025-12-04T12:47:58.703Z","updatedAt":"2025-12-04T12:47:58.703Z"}
User 2 Project ID: 50373413-6491-4586-b813-cdd01a80341d

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'ef3c7564-90d5-4542-84a0-18cf332d0f0a'[39m,
  projectId: [32m'50373413-6491-4586-b813-cdd01a80341d'[39m,
  body: { projectId: [32m'50373413-6491-4586-b813-cdd01a80341d'[39m }
}

{"level":50,"time":1764852477993,"env":"test","error":{},"workflowId":"ef3c7564-90d5-4542-84a0-18cf332d0f0a","userId":"vzOM0RJxP9gadjMgFYMEd","projectId":"50373413-6491-4586-b813-cdd01a80341d","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: Error: Workflow not found
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:47:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 102447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 396[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 395[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 554[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 929[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 871[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 831[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 893[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 709[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 878[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 592[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 392[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 660[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30390[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30531[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1233[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:455:10
    453|         .set("Authorization", `Bearer ${authToken}`)
    454|         .send({ projectId: user2ProjectId })
    455|         .expect(403);
       |          ^
    456| 
    457|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 06:46:31
[2m   Duration [22m 115.72s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764852781060,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852789505,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852798626,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852798626,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852798638,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852798638,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852798638,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852798638,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852799464,"env":"test","module":"user-credentials-repository","userId":"so8U3EJcw8WnnyhWRKoRz","msg":"User credentials created"}
{"level":30,"time":1764852799468,"env":"test","module":"auth-routes","userId":"so8U3EJcw8WnnyhWRKoRz","email":"test-workflows-4DvA3qPcN6wwoHkplfrIJ@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"230d9947-0d68-4108-91fc-a6762b162032","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"so8U3EJcw8WnnyhWRKoRz","tenantId":"430bd886-ff52-4d20-aa21-2b6b212ef64b","createdBy":"so8U3EJcw8WnnyhWRKoRz","ownerId":"so8U3EJcw8WnnyhWRKoRz","status":"active","archived":false,"createdAt":"2025-12-04T12:53:20.540Z","updatedAt":"2025-12-04T12:53:20.540Z"}

{"level":30,"time":1764852800314,"env":"test","module":"user-credentials-repository","userId":"Ah7xkhzhqh_XZ2DQirKdi","msg":"User credentials created"}
{"level":30,"time":1764852800314,"env":"test","module":"auth-routes","userId":"Ah7xkhzhqh_XZ2DQirKdi","email":"viewer-dSpKOU52vAjTVOK9GVjb8@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852800430,"env":"test","module":"rbac-middleware","userId":"Ah7xkhzhqh_XZ2DQirKdi","userRole":"viewer","permission":"workflow:create","path":"/projects/230d9947-0d68-4108-91fc-a6762b162032/workflows","msg":"Permission denied"}
{"level":40,"time":1764852803815,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/projects/230d9947-0d68-4108-91fc-a6762b162032/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764852803879,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764852803936,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/projects/230d9947-0d68-4108-91fc-a6762b162032/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764852803995,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764852804057,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/workflows/undefined/versions","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852804273,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(so8U3EJcw8WnnyhWRKoRz) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error creating workflow"}
{"level":40,"time":1764852804342,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852804406,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error moving workflow"}
{"level":50,"time":1764852804627,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(so8U3EJcw8WnnyhWRKoRz) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error creating workflow"}
{"level":40,"time":1764852804685,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852804747,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error moving workflow"}
{"level":50,"time":1764852804858,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"so8U3EJcw8WnnyhWRKoRz","projectId":null,"msg":"Error moving workflow"}
{"level":50,"time":1764852805243,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(so8U3EJcw8WnnyhWRKoRz) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error creating workflow"}
{"level":40,"time":1764852805300,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852805410,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"so8U3EJcw8WnnyhWRKoRz","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":50,"time":1764852805777,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(so8U3EJcw8WnnyhWRKoRz) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error creating workflow"}
{"level":40,"time":1764852805836,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764852805842,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764852806045,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(so8U3EJcw8WnnyhWRKoRz) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error creating workflow"}
{"level":40,"time":1764852806098,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764852806353,"env":"test","module":"user-credentials-repository","userId":"6335iHhp1VZBvKsg6MZaW","msg":"User credentials created"}
{"level":30,"time":1764852806354,"env":"test","module":"auth-routes","userId":"6335iHhp1VZBvKsg6MZaW","email":"test-workflows-Ye10GYtovYfelZpLyQ0vp@example.com","msg":"User registered successfully"}
{"level":50,"time":1764852806360,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"6335iHhp1VZBvKsg6MZaW","msg":"Error moving workflow"}
{"level":50,"time":1764852806577,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(so8U3EJcw8WnnyhWRKoRz) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error creating workflow"}
{"level":40,"time":1764852806630,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852806687,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"undefined","userId":"so8U3EJcw8WnnyhWRKoRz","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764852806901,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(so8U3EJcw8WnnyhWRKoRz) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error creating workflow"}
{"level":40,"time":1764852806959,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852807017,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"undefined","userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error moving workflow"}
{"level":50,"time":1764852807236,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(so8U3EJcw8WnnyhWRKoRz) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"so8U3EJcw8WnnyhWRKoRz","msg":"Error creating workflow"}
{"level":40,"time":1764852807292,"env":"test","module":"tenant-middleware","userId":"so8U3EJcw8WnnyhWRKoRz","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764852807523,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(EGK9VEkmXp9WwSH33NY5n) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"EGK9VEkmXp9WwSH33NY5n","msg":"Failed to create user credentials"}
{"level":50,"time":1764852807524,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(EGK9VEkmXp9WwSH33NY5n) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2MzM1aUhocDFWWkJ2S3NnNk1aYVciLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLVllMTBHWXRvdllmZWxacEx5UTB2cEBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiNDMwYmQ4ODYtZmY1Mi00ZDIwLWFhMjEtMmI2YjIxMmVmNjRiIiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyODA2LCJleHAiOjE3NjU0NTc2MDZ9.kml8yXiDtLKxjDAgN_Sa-AwVB2JRfp8SC1rcnX656WI","user":{"id":"6335iHhp1VZBvKsg6MZaW","email":"test-workflows-Ye10GYtovYfelZpLyQ0vp@example.com","firstName":null,"lastName":null,"tenantId":"430bd886-ff52-4d20-aa21-2b6b212ef64b","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 9390[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 407[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 944[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 741[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[33m 496[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[32m 125[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 178[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 349[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 452[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[33m 552[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 432[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 332[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 506[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 8 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:201:10
    199|         .set("Authorization", `Bearer ${authToken}`)
    200|         .send({})
    201|         .expect(200);
       |          ^
    202| 
    203|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:231:10
    229|         .set("Authorization", `Bearer ${authToken}`)
    230|         .send({})
    231|         .expect(200);
       |          ^
    232| 
    233|       expect(response.body).toHaveProperty("status", "active");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:263:10
    261|         .get(`/api/workflows/${workflowId}/versions`)
    262|         .set("Authorization", `Bearer ${authToken}`)
    263|         .expect(200);
       |          ^
    264| 
    265|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:302:10
    300|         .set("Authorization", `Bearer ${authToken}`)
    301|         .send({ projectId: targetProjectId })
    302|         .expect(200);
       |          ^
    303| 
    304|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:328:10
    326|         .set("Authorization", `Bearer ${authToken}`)
    327|         .send({ projectId: null })
    328|         .expect(200);
       |          ^
    329| 
    330|       expect(response.body).toHaveProperty("id", workflowId);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Error: expected 404 "Not Found", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:349:10
    347|         .set("Authorization", `Bearer ${authToken}`)
    348|         .send({ projectId: fakeProjectId })
    349|         .expect(404);
       |          ^
    350| 
    351|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:383:10
    381|         .set("Authorization", `Bearer ${authToken2}`)
    382|         .send({ projectId: targetProjectId })
    383|         .expect(403);
       |          ^
    384| 
    385|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/8]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:422:51
    420| 
    421|       const authToken2 = registerResponse2.body.token;
    422|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    423| 
    424|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/8]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m9 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 06:52:54
[2m   Duration [22m 32.62s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21
  
  "await" can only be used inside an "async" function
  376 |  
  377 |      // Try to move the first user's workflow as the second user
  378 |      const response = await request(baseURL)
      |                       ^
  379 |        .put(`/api/workflows/${workflowId}/move`)
  380 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 06:56:28
[2m   Duration [22m 36ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx20 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21
  
  "await" can only be used inside an "async" function
  376 |  
  377 |      // Try to move the first user's workflow as the second user
  378 |      const response = await request(baseURL)
      |                       ^
  379 |        .put(`/api/workflows/${workflowId}/move`)
  380 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:04:25
[2m   Duration [22m 33ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx21 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:365:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:365:21
  
  "await" can only be used inside an "async" function
  363 |  
  364 |      // Try to move the first user's workflow as the second user
  365 |      const response = await request(baseURL)
      |                       ^
  366 |        .put(`/api/workflows/${workflowId}/move`)
  367 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:05:17
[2m   Duration [22m 29ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx22 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:06:04
[2m   Duration [22m 77ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx23 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":40,"time":1764853575235,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764853581269,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764853587671,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764853587672,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764853587682,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764853587683,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764853587683,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764853587683,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764853588339,"env":"test","module":"user-credentials-repository","userId":"XUUdkjgXddwL7Y-uEU7ys","msg":"User credentials created"}
{"level":30,"time":1764853588343,"env":"test","module":"auth-routes","userId":"XUUdkjgXddwL7Y-uEU7ys","email":"test-workflows-wPEW5Y5EPplxZ6zPjo05r@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853588835,"env":"test","module":"user-credentials-repository","userId":"GlkkClYzo0z_056u8LE_0","msg":"User credentials created"}
{"level":30,"time":1764853588836,"env":"test","module":"auth-routes","userId":"GlkkClYzo0z_056u8LE_0","email":"viewer-EckybyduRlO81PotgTR_H@example.com","msg":"User registered successfully"}
{"level":40,"time":1764853588953,"env":"test","module":"rbac-middleware","userId":"GlkkClYzo0z_056u8LE_0","userRole":"viewer","permission":"workflow:create","path":"/projects/87aac1d7-f78d-4871-bdc8-4d5e12832bc3/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"87aac1d7-f78d-4871-bdc8-4d5e12832bc3","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"XUUdkjgXddwL7Y-uEU7ys","tenantId":"3240d552-3a76-4e00-a528-685f9bf10c68","createdBy":"XUUdkjgXddwL7Y-uEU7ys","ownerId":"XUUdkjgXddwL7Y-uEU7ys","status":"active","archived":false,"createdAt":"2025-12-04T13:06:29.440Z","updatedAt":"2025-12-04T13:06:29.440Z"}

{"level":50,"time":1764853596944,"env":"test","error":{},"workflowId":"1a84ed98-4622-457a-b2ac-72439409f075","userId":"XUUdkjgXddwL7Y-uEU7ys","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764853597337,"env":"test","module":"auth-middleware","path":"/api/workflows/1e5435dd-a84b-4424-957e-ee70059173db/move","msg":"No valid authentication found"}
{"level":30,"time":1764853597968,"env":"test","module":"user-credentials-repository","userId":"0K4nQQNsY2n2gvH2NfdyY","msg":"User credentials created"}
{"level":30,"time":1764853597969,"env":"test","module":"auth-routes","userId":"0K4nQQNsY2n2gvH2NfdyY","email":"test-workflows-7i_5jJVP8QjUADZyCQYn8@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853598588,"env":"test","module":"user-credentials-repository","userId":"hmtCQdEsVPJsg5oWn4w_Z","msg":"User credentials created"}
{"level":30,"time":1764853598589,"env":"test","module":"auth-routes","userId":"hmtCQdEsVPJsg5oWn4w_Z","email":"test-workflows-g4i7ZeOqV9YTXtuQhNwaf@example.com","msg":"User registered successfully"}
{"level":50,"time":1764853598647,"env":"test","error":{},"workflowId":"cb9b684e-7618-4c92-907a-4595ac3085f9","userId":"hmtCQdEsVPJsg5oWn4w_Z","projectId":"e493ba84-fb85-4765-9b0e-3d2bba9ecb39","msg":"Error moving workflow"}
{"level":50,"time":1764853599098,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"19f9ca10-f5d9-4f5f-9f1b-6cc1af98e44f","userId":"XUUdkjgXddwL7Y-uEU7ys","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764853599663,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"46079b7b-12cf-436b-80c1-eb5c2415db8c","userId":"XUUdkjgXddwL7Y-uEU7ys","msg":"Error moving workflow"}
{"level":30,"time":1764853600270,"env":"test","module":"user-credentials-repository","userId":"nBgu0DV3W4soy5_wAQIri","msg":"User credentials created"}
{"level":30,"time":1764853600270,"env":"test","module":"auth-routes","userId":"nBgu0DV3W4soy5_wAQIri","email":"test-workflows-uu4ok5_wT9k3i60-zGYDx@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853600495,"env":"test","module":"auth-routes","userId":"nBgu0DV3W4soy5_wAQIri","email":"test-workflows-uu4ok5_wT9k3i60-zGYDx@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764853600738,"env":"test","error":{},"workflowId":"ee4887b9-fcce-4592-8bed-673900cbefe7","userId":"XUUdkjgXddwL7Y-uEU7ys","projectId":"804fd805-2fe9-4d5f-adb5-05709c5686e1","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 13396[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a new draft workflow[39m[32m 3[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 954[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 788[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 934[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 754[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 932[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 392[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 676[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 564[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1077[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:projectId/workflows > should create a new draft workflow
ReferenceError: response is not defined
 Î“Â¥Â» tests/integration/api.workflows.test.ts:91:14
     89|   describe("POST /api/projects/:projectId/workflows", () => {
     90|     it("should create a new draft workflow", async () => {
     91|       expect(response.body.currentVersion).toHaveProperty("published",Î“Ã‡Âª
       |              ^
     92|     });
     93| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:324:10
    322|         .get(`/api/workflows/${workflowId}`)
    323|         .set("Authorization", `Bearer ${authToken}`)
    324|         .expect(200);
       |          ^
    325| 
    326|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:451:10
    449|         .set("Authorization", `Bearer ${authToken}`)
    450|         .send({ projectId: user2ProjectId })
    451|         .expect(403);
       |          ^
    452| 
    453|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (18)[39m
[2m   Start at [22m 07:06:10
[2m   Duration [22m 29.83s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx24 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764853868682,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764853871849,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764853875248,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764853875249,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764853875259,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764853875259,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764853875259,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764853875259,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764853875804,"env":"test","module":"user-credentials-repository","userId":"NcrEtIYCVqsc9mmu95f-7","msg":"User credentials created"}
{"level":30,"time":1764853875806,"env":"test","module":"auth-routes","userId":"NcrEtIYCVqsc9mmu95f-7","email":"test-workflows-qctpGFnhAa9ilDT1GbUFb@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"00f4d1a7-bba4-4a58-babf-8717193709de","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"NcrEtIYCVqsc9mmu95f-7","tenantId":"5591ddaf-a3b8-4f4d-b234-1b1469fa8b01","createdBy":"NcrEtIYCVqsc9mmu95f-7","ownerId":"NcrEtIYCVqsc9mmu95f-7","status":"active","archived":false,"createdAt":"2025-12-04T13:11:16.886Z","updatedAt":"2025-12-04T13:11:16.886Z"}

{"level":30,"time":1764853876560,"env":"test","module":"user-credentials-repository","userId":"O45TMfjoIzzksc5NM4oJc","msg":"User credentials created"}
{"level":30,"time":1764853876561,"env":"test","module":"auth-routes","userId":"O45TMfjoIzzksc5NM4oJc","email":"viewer-3V96tq_iIS8MDhdzeCfCk@example.com","msg":"User registered successfully"}
{"level":40,"time":1764853876670,"env":"test","module":"rbac-middleware","userId":"O45TMfjoIzzksc5NM4oJc","userRole":"viewer","permission":"workflow:create","path":"/projects/00f4d1a7-bba4-4a58-babf-8717193709de/workflows","msg":"Permission denied"}
{"level":50,"time":1764853883936,"env":"test","error":{},"workflowId":"bb9ed88c-c963-4378-9259-f0bb2155a626","userId":"NcrEtIYCVqsc9mmu95f-7","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764853884340,"env":"test","module":"auth-middleware","path":"/api/workflows/208b1c8f-daba-4c62-9dda-b1b79edd5b39/move","msg":"No valid authentication found"}
{"level":30,"time":1764853884945,"env":"test","module":"user-credentials-repository","userId":"oy08NR0SSnfSds7U_I_ub","msg":"User credentials created"}
{"level":30,"time":1764853884946,"env":"test","module":"auth-routes","userId":"oy08NR0SSnfSds7U_I_ub","email":"test-workflows-NnVCZScfYAsxg_V6wFnSE@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853885560,"env":"test","module":"user-credentials-repository","userId":"moaykN_2Y6WetfHkD_6dk","msg":"User credentials created"}
{"level":30,"time":1764853885560,"env":"test","module":"auth-routes","userId":"moaykN_2Y6WetfHkD_6dk","email":"test-workflows-kXhLRdnHP-bmftNxIo7MT@example.com","msg":"User registered successfully"}
{"level":50,"time":1764853885623,"env":"test","error":{},"workflowId":"7a1ada7a-dc98-4872-a5aa-8dd9f865e757","userId":"moaykN_2Y6WetfHkD_6dk","projectId":"8b2499f9-6e17-4d07-9ce4-b77e43ef3189","msg":"Error moving workflow"}
{"level":50,"time":1764853886057,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7dc4f3bb-b01d-4333-bf34-38b98a519a65","userId":"NcrEtIYCVqsc9mmu95f-7","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764853886487,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f7bcf0a6-aee5-4df3-a73d-6b7e4830124c","userId":"NcrEtIYCVqsc9mmu95f-7","msg":"Error moving workflow"}
{"level":30,"time":1764853887197,"env":"test","module":"user-credentials-repository","userId":"2OK5mFEDP91jB9EVZ_g1R","msg":"User credentials created"}
{"level":30,"time":1764853887198,"env":"test","module":"auth-routes","userId":"2OK5mFEDP91jB9EVZ_g1R","email":"test-workflows-e8nFVwm0_EmnsSU7MwWwB@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853887425,"env":"test","module":"auth-routes","userId":"2OK5mFEDP91jB9EVZ_g1R","email":"test-workflows-e8nFVwm0_EmnsSU7MwWwB@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764853887740,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f860a8e9-12d4-41ca-8f3a-1ab8f4ca1b84","userId":"NcrEtIYCVqsc9mmu95f-7","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 12825[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 366[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 533[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 888[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 675[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 868[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 902[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 693[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 884[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 532[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 677[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 430[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1253[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:464:10
    462|         .set("Authorization", `Bearer ${authToken}`)
    463|         .send({ projectId: user2ProjectId })
    464|         .expect(403);
       |          ^
    465| 
    466|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (18)[39m
[2m   Start at [22m 07:11:03
[2m   Duration [22m 23.80s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx25 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764854523577,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764854533980,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764854556098,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764854556099,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764854556107,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764854556107,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764854556108,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764854556108,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764854560205,"env":"test","module":"user-credentials-repository","userId":"i_C7ImVmjf06eLqZJq8E3","msg":"User credentials created"}
{"level":30,"time":1764854560209,"env":"test","module":"auth-routes","userId":"i_C7ImVmjf06eLqZJq8E3","email":"test-workflows-xFAS_QvEc6XWp0rI4eYwh@example.com","msg":"User registered successfully"}
{"level":30,"time":1764854561008,"env":"test","module":"user-credentials-repository","userId":"nIWEmR6qatvwLzkcBd_Ur","msg":"User credentials created"}
{"level":30,"time":1764854561008,"env":"test","module":"auth-routes","userId":"nIWEmR6qatvwLzkcBd_Ur","email":"viewer-p6am6RMWKc1NSpm8OHzqj@example.com","msg":"User registered successfully"}
{"level":40,"time":1764854561121,"env":"test","module":"rbac-middleware","userId":"nIWEmR6qatvwLzkcBd_Ur","userRole":"viewer","permission":"workflow:create","path":"/projects/6bf2d1b5-626e-4d97-8a7b-32f22e002b67/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"6bf2d1b5-626e-4d97-8a7b-32f22e002b67","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"i_C7ImVmjf06eLqZJq8E3","tenantId":"fbe8f69b-af91-4de8-9f16-dfb2a591eeb4","createdBy":"i_C7ImVmjf06eLqZJq8E3","ownerId":"i_C7ImVmjf06eLqZJq8E3","status":"active","archived":false,"createdAt":"2025-12-04T13:22:41.314Z","updatedAt":"2025-12-04T13:22:41.314Z"}

{"level":40,"time":1764854563194,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/projects/6bf2d1b5-626e-4d97-8a7b-32f22e002b67/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854563253,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/workflows/undefined","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854563311,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/projects/6bf2d1b5-626e-4d97-8a7b-32f22e002b67/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854563373,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854563432,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/projects/6bf2d1b5-626e-4d97-8a7b-32f22e002b67/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854563492,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854563552,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/projects/6bf2d1b5-626e-4d97-8a7b-32f22e002b67/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854563611,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854563664,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/workflows/undefined/versions","msg":"User does not have an associated tenant"}
{"level":50,"time":1764854563879,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854563933,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764854594317,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854594378,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764854624750,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854624806,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'undefined'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764854624921,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"i_C7ImVmjf06eLqZJq8E3","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: error: invalid input syntax for type uuid: "undefined"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at NeonPreparedQuery.execute (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
    at WorkflowRepository.findById (C:/Users/scoot/poll/VaultLogic/server/repositories/BaseRepository.ts:52:22)
    at WorkflowRepository.findByIdOrSlug (C:/Users/scoot/poll/VaultLogic/server/repositories/WorkflowRepository.ts:87:18)
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:44:22)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24 {
  length: 141,
  severity: 'ERROR',
  code: '22P02',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: "unnamed portal parameter $1 = '...'",
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'uuid.c',
  line: '138',
  routine: 'string_to_uuid'
}

{"level":50,"time":1764854625297,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854625354,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764854625359,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764854625569,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854625626,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764854625841,"env":"test","module":"user-credentials-repository","userId":"KnVyC5FiMCatxULqqNl0c","msg":"User credentials created"}
{"level":30,"time":1764854625843,"env":"test","module":"auth-routes","userId":"KnVyC5FiMCatxULqqNl0c","email":"test-workflows-zgjFM7Q1DqksR9YVPcp16@example.com","msg":"User registered successfully"}
{"level":50,"time":1764854626095,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854626148,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764854626383,"env":"test","module":"user-credentials-repository","userId":"slUyuDCnShHELM3laeov5","msg":"User credentials created"}
{"level":30,"time":1764854626384,"env":"test","module":"auth-routes","userId":"slUyuDCnShHELM3laeov5","email":"test-workflows-ouQeBVGJG3_4PSmEgwwDm@example.com","msg":"User registered successfully"}
{"level":50,"time":1764854656532,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854656598,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764854686969,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854687026,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764854717405,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(i_C7ImVmjf06eLqZJq8E3) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"i_C7ImVmjf06eLqZJq8E3","msg":"Error creating workflow"}
{"level":40,"time":1764854717461,"env":"test","module":"tenant-middleware","userId":"i_C7ImVmjf06eLqZJq8E3","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764854717681,"env":"test","module":"user-credentials-repository","userId":"1J2mqeL45cPN7VHxyCvF7","msg":"User credentials created"}
{"level":30,"time":1764854717682,"env":"test","module":"auth-routes","userId":"1J2mqeL45cPN7VHxyCvF7","email":"test-workflows-imoh8X255u6vMmW-RJfxN@example.com","msg":"User registered successfully"}
{"level":30,"time":1764854717899,"env":"test","module":"auth-routes","userId":"1J2mqeL45cPN7VHxyCvF7","email":"test-workflows-imoh8X255u6vMmW-RJfxN@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'undefined'[39m,
  projectId: [32m'560e7c29-9b92-457f-ac19-27d46f9a521c'[39m,
  body: { projectId: [32m'560e7c29-9b92-457f-ac19-27d46f9a521c'[39m }
}

{"level":50,"time":1764854718060,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"i_C7ImVmjf06eLqZJq8E3","projectId":"560e7c29-9b92-457f-ac19-27d46f9a521c","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: error: invalid input syntax for type uuid: "undefined"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at NeonPreparedQuery.execute (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
    at WorkflowRepository.findById (C:/Users/scoot/poll/VaultLogic/server/repositories/BaseRepository.ts:52:22)
    at WorkflowRepository.findByIdOrSlug (C:/Users/scoot/poll/VaultLogic/server/repositories/WorkflowRepository.ts:87:18)
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:44:22)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24 {
  length: 141,
  severity: 'ERROR',
  code: '22P02',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: "unnamed portal parameter $1 = '...'",
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'uuid.c',
  line: '138',
  routine: 'string_to_uuid'
}

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[33m 191972[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 398[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 564[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should search by name[39m[33m 884[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update draft workflow[39m[32m 122[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[32m 120[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[32m 120[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 172[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 30270[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 30443[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 487[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 30306[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30447[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30428[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1033[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/13]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 12 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/projects/:projectId/workflows > should search by name
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:165:10
    163|         .get(`/api/projects/${projectId}/workflows?q=${uniqueName}`)
    164|         .set("Authorization", `Bearer ${authToken}`)
    165|         .expect(200);
       |          ^
    166| 
    167|       expect(response.body.items.length).toBeGreaterThan(0);
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should update draft workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:190:10
    188|         .set("Authorization", `Bearer ${authToken}`)
    189|         .send({ name: "Updated Name" })
    190|         .expect(200);
       |          ^
    191| 
    192|       expect(response.body).toHaveProperty("name", "Updated Name");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:201:10
    199|         .set("Authorization", `Bearer ${authToken}`)
    200|         .send({})
    201|         .expect(200);
       |          ^
    202| 
    203|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:231:10
    229|         .set("Authorization", `Bearer ${authToken}`)
    230|         .send({})
    231|         .expect(200);
       |          ^
    232| 
    233|       expect(response.body).toHaveProperty("status", "active");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:263:10
    261|         .get(`/api/workflows/${workflowId}/versions`)
    262|         .set("Authorization", `Bearer ${authToken}`)
    263|         .expect(200);
       |          ^
    264| 
    265|       expect(response.body).toHaveProperty("items");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:297:5
    295|     });
    296| 
    297|     it("should move workflow to a project", async () => {
       |     ^
    298|       const response = await request(baseURL)
    299|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:316:5
    314|     });
    315| 
    316|     it("should move workflow to Main Folder (projectId = null)", asyncÎ“Ã‡Âª
       |     ^
    317|       // First move to a project
    318|       await request(baseURL)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Error: expected 404 "Not Found", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:349:10
    347|         .set("Authorization", `Bearer ${authToken}`)
    348|         .send({ projectId: fakeProjectId })
    349|         .expect(404);
       |          ^
    350| 
    351|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:375:5
    373|     });
    374| 
    375|     it("should reject move of workflow user does not own", async () =>Î“Ã‡Âª
       |     ^
    376|       // Create a second user
    377|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:400:5
    398|     });
    399| 
    400|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    401|       const response = await request(baseURL)
    402|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:410:5
    408|     });
    409| 
    410|     it("should reject move without projectId in body", async () => {
       |     ^
    411|       const response = await request(baseURL)
    412|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/13]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:464:10
    462|         .set("Authorization", `Bearer ${authToken}`)
    463|         .send({ projectId: user2ProjectId })
    464|         .expect(403);
       |          ^
    465| 
    466|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/13]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 5 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should move workflow to a project". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should move workflow to Main Folder (projectId = null)". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» Route.dispatch node_modules/express/lib/router/route.js:119:3
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move of workflow user does not own". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 

 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m12 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (18)[39m
[2m     Errors [22m [1m[31m5 errors[39m[22m
[2m   Start at [22m 07:21:54
[2m   Duration [22m 232.29s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
