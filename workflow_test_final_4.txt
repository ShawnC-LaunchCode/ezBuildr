npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764859011621,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764859013135,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764859014442,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764859014443,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764859014449,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764859014449,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764859014450,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764859014450,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764859015524,"env":"test","module":"user-credentials-repository","userId":"EBdWC1l-WHARpxYsY-jjA","msg":"User credentials created"}
{"level":30,"time":1764859015526,"env":"test","module":"auth-routes","userId":"EBdWC1l-WHARpxYsY-jjA","email":"test-workflows-e045O5M_0l6xiq0Opw-LO@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"29f63315-6182-4c92-be8c-880d484c4877","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"EBdWC1l-WHARpxYsY-jjA","tenantId":"40573a53-efcb-4042-b3e7-61e672c0c2df","createdBy":"EBdWC1l-WHARpxYsY-jjA","ownerId":"EBdWC1l-WHARpxYsY-jjA","status":"active","archived":false,"createdAt":"2025-12-04T14:36:56.922Z","updatedAt":"2025-12-04T14:36:56.922Z"}

{"level":30,"time":1764859016651,"env":"test","module":"user-credentials-repository","userId":"nWvHpeW9SVQo2nIFCpmCd","msg":"User credentials created"}
{"level":30,"time":1764859016652,"env":"test","module":"auth-routes","userId":"nWvHpeW9SVQo2nIFCpmCd","email":"viewer-EpYpbsTxcrsaBSndoqdIN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764859016748,"env":"test","module":"rbac-middleware","userId":"nWvHpeW9SVQo2nIFCpmCd","userRole":"viewer","permission":"workflow:create","path":"/projects/29f63315-6182-4c92-be8c-880d484c4877/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'a6264af3-a162-4254-aaa5-ec2f61c49dc9'[39m,
  projectId: [32m'341b7aa1-bd5f-4fa2-9ac4-bde3e02011ad'[39m,
  body: { projectId: [32m'341b7aa1-bd5f-4fa2-9ac4-bde3e02011ad'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'a6264af3-a162-4254-aaa5-ec2f61c49dc9'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'EBdWC1l-WHARpxYsY-jjA'[39m,
  ownerId: [32m'EBdWC1l-WHARpxYsY-jjA'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'341b7aa1-bd5f-4fa2-9ac4-bde3e02011ad'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:37:03.150Z[39m,
  updatedAt: [35m2025-12-04T14:37:02.354Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'61f24c93-beab-4418-aa0b-a0fcab46c605'[39m,
  projectId: [32m'87f379f6-671a-4f1a-a441-33ab32de4cec'[39m,
  body: { projectId: [32m'87f379f6-671a-4f1a-a441-33ab32de4cec'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'61f24c93-beab-4418-aa0b-a0fcab46c605'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'EBdWC1l-WHARpxYsY-jjA'[39m,
  ownerId: [32m'EBdWC1l-WHARpxYsY-jjA'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'87f379f6-671a-4f1a-a441-33ab32de4cec'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:37:03.817Z[39m,
  updatedAt: [35m2025-12-04T14:37:03.014Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'61f24c93-beab-4418-aa0b-a0fcab46c605'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'61f24c93-beab-4418-aa0b-a0fcab46c605'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'EBdWC1l-WHARpxYsY-jjA'[39m,
  ownerId: [32m'EBdWC1l-WHARpxYsY-jjA'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:37:03.817Z[39m,
  updatedAt: [35m2025-12-04T14:37:03.170Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'2435e7b8-7c28-4a2e-8c66-0557114d8118'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764859023804,"env":"test","error":{},"workflowId":"2435e7b8-7c28-4a2e-8c66-0557114d8118","userId":"EBdWC1l-WHARpxYsY-jjA","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764859024137,"env":"test","module":"auth-middleware","path":"/api/workflows/3ed60161-0fa1-42fb-9c3d-c4f774786e59/move","msg":"No valid authentication found"}
{"level":30,"time":1764859024680,"env":"test","module":"user-credentials-repository","userId":"QEUaEIp5uzwYHZXEQGxIP","msg":"User credentials created"}
{"level":30,"time":1764859024681,"env":"test","module":"auth-routes","userId":"QEUaEIp5uzwYHZXEQGxIP","email":"test-workflows-1tuIgFrZxg-GuSLsqZXtf@example.com","msg":"User registered successfully"}
{"level":30,"time":1764859025209,"env":"test","module":"user-credentials-repository","userId":"P8cAOejRzXESE4uN-zPwB","msg":"User credentials created"}
{"level":30,"time":1764859025210,"env":"test","module":"auth-routes","userId":"P8cAOejRzXESE4uN-zPwB","email":"test-workflows-lRkrfLURZS38-VCnYT4r0@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'96eea8cd-3c46-4225-832c-bc35d4d25609'[39m,
  projectId: [32m'7b765871-3496-455d-9e03-e1c31e77ec79'[39m,
  body: { projectId: [32m'7b765871-3496-455d-9e03-e1c31e77ec79'[39m }
}

{"level":50,"time":1764859025269,"env":"test","error":{},"workflowId":"96eea8cd-3c46-4225-832c-bc35d4d25609","userId":"P8cAOejRzXESE4uN-zPwB","projectId":"7b765871-3496-455d-9e03-e1c31e77ec79","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764859087052,"env":"test","module":"user-credentials-repository","userId":"nWkXDXB3A7snH1jAKjuEy","msg":"User credentials created"}
{"level":30,"time":1764859087052,"env":"test","module":"auth-routes","userId":"nWkXDXB3A7snH1jAKjuEy","email":"test-workflows-Gof7ab-6DhCPBvgoKLRlV@example.com","msg":"User registered successfully"}
{"level":30,"time":1764859087260,"env":"test","module":"auth-routes","userId":"nWkXDXB3A7snH1jAKjuEy","email":"test-workflows-Gof7ab-6DhCPBvgoKLRlV@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'73df9f25-7638-4dd4-b9be-369893053f92'[39m,
  projectId: [32m'79d2fa39-9301-41ef-9980-62c054f4d3ad'[39m,
  body: { projectId: [32m'79d2fa39-9301-41ef-9980-62c054f4d3ad'[39m }
}

{"level":50,"time":1764859087451,"env":"test","error":{},"workflowId":"73df9f25-7638-4dd4-b9be-369893053f92","userId":"EBdWC1l-WHARpxYsY-jjA","projectId":"79d2fa39-9301-41ef-9980-62c054f4d3ad","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: Error: Access denied - you do not have access to the target project
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:199:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 103030[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 423[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 842[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 710[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 846[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 673[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 803[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 588[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1337[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:400:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:410:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/4]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (18)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 08:36:48
[2m   Duration [22m 108.51s[2m (transform 1.81s, setup 628ms, collect 4.18s, tests 103.03s, environment 0ms, prepare 12ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764859118580,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764859119322,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764859120190,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764859120191,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764859120197,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764859120197,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764859120197,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764859120197,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764859120622,"env":"test","module":"user-credentials-repository","userId":"l6ozQbTRrf2lbDpaxO5Vy","msg":"User credentials created"}
{"level":30,"time":1764859120625,"env":"test","module":"auth-routes","userId":"l6ozQbTRrf2lbDpaxO5Vy","email":"test-workflows-X6UFw7kJrOIHJk75yd22O@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a0ed80b3-973c-4cef-8d73-97e0b33b2a86","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"l6ozQbTRrf2lbDpaxO5Vy","tenantId":"ecffa078-135b-4e0b-a3a4-5205d708a3dd","createdBy":"l6ozQbTRrf2lbDpaxO5Vy","ownerId":"l6ozQbTRrf2lbDpaxO5Vy","status":"active","archived":false,"createdAt":"2025-12-04T14:38:41.993Z","updatedAt":"2025-12-04T14:38:41.993Z"}

{"level":30,"time":1764859121308,"env":"test","module":"user-credentials-repository","userId":"QMYGdTiI7TXSm-dUsNpD3","msg":"User credentials created"}
{"level":30,"time":1764859121308,"env":"test","module":"auth-routes","userId":"QMYGdTiI7TXSm-dUsNpD3","email":"viewer-Qm9rpypUZsZDpuAQbPwgF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764859121406,"env":"test","module":"rbac-middleware","userId":"QMYGdTiI7TXSm-dUsNpD3","userRole":"viewer","permission":"workflow:create","path":"/projects/a0ed80b3-973c-4cef-8d73-97e0b33b2a86/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'cd14b626-b526-48b8-93fe-4f3e730fcf1d'[39m,
  projectId: [32m'14987977-7576-4a1c-b945-52ef97d46791'[39m,
  body: { projectId: [32m'14987977-7576-4a1c-b945-52ef97d46791'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'cd14b626-b526-48b8-93fe-4f3e730fcf1d'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'l6ozQbTRrf2lbDpaxO5Vy'[39m,
  ownerId: [32m'l6ozQbTRrf2lbDpaxO5Vy'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'14987977-7576-4a1c-b945-52ef97d46791'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:38:47.606Z[39m,
  updatedAt: [35m2025-12-04T14:38:46.771Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'88b0d0d7-347c-48e5-9a3d-685127d5be41'[39m,
  projectId: [32m'a4518186-0c19-4630-beb7-f5f72107ee56'[39m,
  body: { projectId: [32m'a4518186-0c19-4630-beb7-f5f72107ee56'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'88b0d0d7-347c-48e5-9a3d-685127d5be41'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'l6ozQbTRrf2lbDpaxO5Vy'[39m,
  ownerId: [32m'l6ozQbTRrf2lbDpaxO5Vy'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'a4518186-0c19-4630-beb7-f5f72107ee56'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:38:48.240Z[39m,
  updatedAt: [35m2025-12-04T14:38:47.424Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'88b0d0d7-347c-48e5-9a3d-685127d5be41'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'88b0d0d7-347c-48e5-9a3d-685127d5be41'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'l6ozQbTRrf2lbDpaxO5Vy'[39m,
  ownerId: [32m'l6ozQbTRrf2lbDpaxO5Vy'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:38:48.240Z[39m,
  updatedAt: [35m2025-12-04T14:38:47.573Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'7f9f0392-32b4-42a3-8985-b0545320dfa7'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764859128206,"env":"test","error":{},"workflowId":"7f9f0392-32b4-42a3-8985-b0545320dfa7","userId":"l6ozQbTRrf2lbDpaxO5Vy","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764859128564,"env":"test","module":"auth-middleware","path":"/api/workflows/cdf35368-887f-445c-9bec-d585f844fb04/move","msg":"No valid authentication found"}
{"level":30,"time":1764859129105,"env":"test","module":"user-credentials-repository","userId":"5XXtjrHDPNank8PNzE3mH","msg":"User credentials created"}
{"level":30,"time":1764859129105,"env":"test","module":"auth-routes","userId":"5XXtjrHDPNank8PNzE3mH","email":"test-workflows-sCMmxEkTiN8hX-yc2Bruz@example.com","msg":"User registered successfully"}
{"level":30,"time":1764859129638,"env":"test","module":"user-credentials-repository","userId":"C9PBrKyIjMvAvVkxjOyKC","msg":"User credentials created"}
{"level":30,"time":1764859129638,"env":"test","module":"auth-routes","userId":"C9PBrKyIjMvAvVkxjOyKC","email":"test-workflows-z7bU2AZzbnm11F9Hhqa2Q@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'bedad781-d6c8-4c8d-a2fd-b541aa394ac0'[39m,
  projectId: [32m'a8538de3-ccff-4714-9f9d-1ded237fcf81'[39m,
  body: { projectId: [32m'a8538de3-ccff-4714-9f9d-1ded237fcf81'[39m }
}

{"level":50,"time":1764859129686,"env":"test","error":{},"workflowId":"bedad781-d6c8-4c8d-a2fd-b541aa394ac0","userId":"C9PBrKyIjMvAvVkxjOyKC","projectId":"a8538de3-ccff-4714-9f9d-1ded237fcf81","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764859191392,"env":"test","module":"user-credentials-repository","userId":"hgSFVuMhs1ykMPE3MxG5F","msg":"User credentials created"}
{"level":30,"time":1764859191393,"env":"test","module":"auth-routes","userId":"hgSFVuMhs1ykMPE3MxG5F","email":"test-workflows-jSwpaz3cSehByoCLYhDbA@example.com","msg":"User registered successfully"}
{"level":30,"time":1764859191583,"env":"test","module":"auth-routes","userId":"hgSFVuMhs1ykMPE3MxG5F","email":"test-workflows-jSwpaz3cSehByoCLYhDbA@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'4dd29c99-68ec-4e2c-a1c5-f46f7c5da07c'[39m,
  projectId: [32m'ed48ecb8-1c9a-4e09-89c7-12f4b94ab04e'[39m,
  body: { projectId: [32m'ed48ecb8-1c9a-4e09-89c7-12f4b94ab04e'[39m }
}

{"level":50,"time":1764859191774,"env":"test","error":{},"workflowId":"4dd29c99-68ec-4e2c-a1c5-f46f7c5da07c","userId":"l6ozQbTRrf2lbDpaxO5Vy","projectId":"ed48ecb8-1c9a-4e09-89c7-12f4b94ab04e","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: Error: Access denied - you do not have access to the target project
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:199:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 101604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 329[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 956[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 678[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 641[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 796[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 582[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30358[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1021[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:400:5
    398|     });
    399| 
    400|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    401|       const response = await request(baseURL)
    402|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:410:5
    408|     });
    409| 
    410|     it("should reject move without projectId in body", async () => {
       |     ^
    411|       const response = await request(baseURL)
    412|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/4]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       return res.status(200).json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       return res.status(200).json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (18)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 08:38:37
[2m   Duration [22m 104.03s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764859272959,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764859273991,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764859275307,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764859275308,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764859275315,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764859275315,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764859275315,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764859275315,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764859275726,"env":"test","module":"user-credentials-repository","userId":"aLYWzuhVpdTVg9CR9xwyi","msg":"User credentials created"}
{"level":30,"time":1764859275729,"env":"test","module":"auth-routes","userId":"aLYWzuhVpdTVg9CR9xwyi","email":"test-workflows-f-MucDe70ARQrDPwfzmhe@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"ad1e94c3-72a4-49da-9ba8-ca46a8779ea4","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"aLYWzuhVpdTVg9CR9xwyi","tenantId":"4ed63477-c0a7-4f5c-82d0-356acb9473a9","createdBy":"aLYWzuhVpdTVg9CR9xwyi","ownerId":"aLYWzuhVpdTVg9CR9xwyi","status":"active","archived":false,"createdAt":"2025-12-04T14:41:17.106Z","updatedAt":"2025-12-04T14:41:17.106Z"}

{"level":30,"time":1764859276441,"env":"test","module":"user-credentials-repository","userId":"_UNDdeKVJ-j7z8DUcguSs","msg":"User credentials created"}
{"level":30,"time":1764859276442,"env":"test","module":"auth-routes","userId":"_UNDdeKVJ-j7z8DUcguSs","email":"viewer-eFQRAf_-4c5F0DjMlRzV2@example.com","msg":"User registered successfully"}
{"level":40,"time":1764859276545,"env":"test","module":"rbac-middleware","userId":"_UNDdeKVJ-j7z8DUcguSs","userRole":"viewer","permission":"workflow:create","path":"/projects/ad1e94c3-72a4-49da-9ba8-ca46a8779ea4/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'd54e199a-f858-4722-b8db-978aa4fec720'[39m,
  projectId: [32m'79d00cf6-903d-4deb-a0d4-f187072c4fc0'[39m,
  body: { projectId: [32m'79d00cf6-903d-4deb-a0d4-f187072c4fc0'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'd54e199a-f858-4722-b8db-978aa4fec720'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'aLYWzuhVpdTVg9CR9xwyi'[39m,
  ownerId: [32m'aLYWzuhVpdTVg9CR9xwyi'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'79d00cf6-903d-4deb-a0d4-f187072c4fc0'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:41:22.597Z[39m,
  updatedAt: [35m2025-12-04T14:41:21.779Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'c8d4bdc7-ed5e-41aa-ab9e-a93d83aacdfe'[39m,
  projectId: [32m'1acc75de-f350-47a3-97ff-9e2a3686eea4'[39m,
  body: { projectId: [32m'1acc75de-f350-47a3-97ff-9e2a3686eea4'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'c8d4bdc7-ed5e-41aa-ab9e-a93d83aacdfe'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'aLYWzuhVpdTVg9CR9xwyi'[39m,
  ownerId: [32m'aLYWzuhVpdTVg9CR9xwyi'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'1acc75de-f350-47a3-97ff-9e2a3686eea4'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:41:23.264Z[39m,
  updatedAt: [35m2025-12-04T14:41:22.433Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'c8d4bdc7-ed5e-41aa-ab9e-a93d83aacdfe'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'c8d4bdc7-ed5e-41aa-ab9e-a93d83aacdfe'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'aLYWzuhVpdTVg9CR9xwyi'[39m,
  ownerId: [32m'aLYWzuhVpdTVg9CR9xwyi'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:41:23.264Z[39m,
  updatedAt: [35m2025-12-04T14:41:22.582Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'2d99fe11-cc26-4f82-8d75-65a4676a9cbf'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764859283221,"env":"test","error":{},"workflowId":"2d99fe11-cc26-4f82-8d75-65a4676a9cbf","userId":"aLYWzuhVpdTVg9CR9xwyi","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764859283548,"env":"test","module":"auth-middleware","path":"/api/workflows/0a21140f-498e-446b-a32b-069a84fccdb0/move","msg":"No valid authentication found"}
{"level":30,"time":1764859284095,"env":"test","module":"user-credentials-repository","userId":"7WuTTbpDkX5mxPpMkn3wP","msg":"User credentials created"}
{"level":30,"time":1764859284096,"env":"test","module":"auth-routes","userId":"7WuTTbpDkX5mxPpMkn3wP","email":"test-workflows-lAi81gcJGbBtrrpv2uwsN@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'4f2203bc-cf4b-44eb-a69a-d8506ceebf72'[39m,
  projectId: [32m'0771626a-71a3-4092-9dfc-62bd22a70b25'[39m,
  body: { projectId: [32m'0771626a-71a3-4092-9dfc-62bd22a70b25'[39m }
}

{"level":50,"time":1764859284141,"env":"test","error":{},"workflowId":"4f2203bc-cf4b-44eb-a69a-d8506ceebf72","userId":"7WuTTbpDkX5mxPpMkn3wP","projectId":"0771626a-71a3-4092-9dfc-62bd22a70b25","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764859346193,"env":"test","module":"user-credentials-repository","userId":"icLHw2-d3y5iI7CJBTeSO","msg":"User credentials created"}
{"level":30,"time":1764859346194,"env":"test","module":"auth-routes","userId":"icLHw2-d3y5iI7CJBTeSO","email":"test-workflows-_b6qDBGLkd_ApJTTDegxJ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764859346379,"env":"test","module":"auth-routes","userId":"icLHw2-d3y5iI7CJBTeSO","email":"test-workflows-_b6qDBGLkd_ApJTTDegxJ@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'f6535754-00b6-4486-94e9-9b732814293a'[39m,
  projectId: [32m'2bf8736a-c58e-42ff-8587-200d568e7a07'[39m,
  body: { projectId: [32m'2bf8736a-c58e-42ff-8587-200d568e7a07'[39m }
}

{"level":50,"time":1764859346576,"env":"test","error":{},"workflowId":"f6535754-00b6-4486-94e9-9b732814293a","userId":"aLYWzuhVpdTVg9CR9xwyi","projectId":"2bf8736a-c58e-42ff-8587-200d568e7a07","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: Error: Access denied - you do not have access to the target project
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:199:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 101293[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 805[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 624[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 841[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 658[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 592[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30362[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1321[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/4]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       return res.status(200).json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       return res.status(200).json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 08:41:11
[2m   Duration [22m 104.88s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764859486969,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764859488100,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764859489211,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764859489211,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764859489220,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764859489220,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764859489221,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764859489221,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764859489657,"env":"test","module":"user-credentials-repository","userId":"EBz2MKO2-IvEJivY_3VUU","msg":"User credentials created"}
{"level":30,"time":1764859489659,"env":"test","module":"auth-routes","userId":"EBz2MKO2-IvEJivY_3VUU","email":"test-workflows-MgDmJ4JGhv4FHdr9_m6Wi@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"17090c2d-88e4-47f9-b76f-3b1d4fb8c41e","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"EBz2MKO2-IvEJivY_3VUU","tenantId":"a9176ed0-bd96-4cd0-86d7-445752ba8d09","createdBy":"EBz2MKO2-IvEJivY_3VUU","ownerId":"EBz2MKO2-IvEJivY_3VUU","status":"active","archived":false,"createdAt":"2025-12-04T14:44:51.048Z","updatedAt":"2025-12-04T14:44:51.048Z"}

{"level":30,"time":1764859490400,"env":"test","module":"user-credentials-repository","userId":"xI2s9b3Rl4ic-1K0Ddt13","msg":"User credentials created"}
{"level":30,"time":1764859490401,"env":"test","module":"auth-routes","userId":"xI2s9b3Rl4ic-1K0Ddt13","email":"viewer-q6cjM91j7XVer8j5PT3K3@example.com","msg":"User registered successfully"}
{"level":40,"time":1764859490503,"env":"test","module":"rbac-middleware","userId":"xI2s9b3Rl4ic-1K0Ddt13","userRole":"viewer","permission":"workflow:create","path":"/projects/17090c2d-88e4-47f9-b76f-3b1d4fb8c41e/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'2a7ef9dc-0c76-42f2-bdc9-5b84e9fea563'[39m,
  projectId: [32m'd1f31396-1fc5-4673-bc12-79017f09302a'[39m,
  body: { projectId: [32m'd1f31396-1fc5-4673-bc12-79017f09302a'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'2a7ef9dc-0c76-42f2-bdc9-5b84e9fea563'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'EBz2MKO2-IvEJivY_3VUU'[39m,
  ownerId: [32m'EBz2MKO2-IvEJivY_3VUU'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'd1f31396-1fc5-4673-bc12-79017f09302a'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:44:56.790Z[39m,
  updatedAt: [35m2025-12-04T14:44:55.947Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'7b547eaf-c798-4899-84ba-ec3ccf5c2de0'[39m,
  projectId: [32m'a98c1967-a18e-4ebc-a72e-dde84cc06195'[39m,
  body: { projectId: [32m'a98c1967-a18e-4ebc-a72e-dde84cc06195'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'7b547eaf-c798-4899-84ba-ec3ccf5c2de0'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'EBz2MKO2-IvEJivY_3VUU'[39m,
  ownerId: [32m'EBz2MKO2-IvEJivY_3VUU'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'a98c1967-a18e-4ebc-a72e-dde84cc06195'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:44:57.447Z[39m,
  updatedAt: [35m2025-12-04T14:44:56.620Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'7b547eaf-c798-4899-84ba-ec3ccf5c2de0'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'7b547eaf-c798-4899-84ba-ec3ccf5c2de0'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'EBz2MKO2-IvEJivY_3VUU'[39m,
  ownerId: [32m'EBz2MKO2-IvEJivY_3VUU'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T14:44:57.447Z[39m,
  updatedAt: [35m2025-12-04T14:44:56.769Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'3db411a6-e3e9-4e6c-9615-6024aafd2e0d'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764859497440,"env":"test","error":{},"workflowId":"3db411a6-e3e9-4e6c-9615-6024aafd2e0d","userId":"EBz2MKO2-IvEJivY_3VUU","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764859497826,"env":"test","module":"auth-middleware","path":"/api/workflows/49025325-ef64-4acc-82fc-468186a37346/move","msg":"No valid authentication found"}
{"level":30,"time":1764859498408,"env":"test","module":"user-credentials-repository","userId":"E-jsqXuqZeyUq6baiAp_v","msg":"User credentials created"}
{"level":30,"time":1764859498408,"env":"test","module":"auth-routes","userId":"E-jsqXuqZeyUq6baiAp_v","email":"test-workflows-edMqy4XUJMm5QvI-2LNwy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'd2ec3313-532c-416b-86d9-c934085f66c3'[39m,
  projectId: [32m'91d71453-a240-4a41-a853-261b8f843741'[39m,
  body: { projectId: [32m'91d71453-a240-4a41-a853-261b8f843741'[39m }
}

{"level":50,"time":1764859498466,"env":"test","error":{},"workflowId":"d2ec3313-532c-416b-86d9-c934085f66c3","userId":"E-jsqXuqZeyUq6baiAp_v","projectId":"91d71453-a240-4a41-a853-261b8f843741","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764859559998,"env":"test","module":"user-credentials-repository","userId":"pqtbYcH-5-hTeV3duhJol","msg":"User credentials created"}
{"level":30,"time":1764859559998,"env":"test","module":"auth-routes","userId":"pqtbYcH-5-hTeV3duhJol","email":"test-workflows-0uRxA0BtUNNjAJNy1OGeV@example.com","msg":"User registered successfully"}
{"level":30,"time":1764859560190,"env":"test","module":"auth-routes","userId":"pqtbYcH-5-hTeV3duhJol","email":"test-workflows-0uRxA0BtUNNjAJNy1OGeV@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'2f4c8134-92c6-4b75-8ee1-fafcf4b0ff02'[39m,
  projectId: [32m'f8afd9ea-e222-4ee8-91e5-fd3a018ec85e'[39m,
  body: { projectId: [32m'f8afd9ea-e222-4ee8-91e5-fd3a018ec85e'[39m }
}

{"level":50,"time":1764859560375,"env":"test","error":{},"workflowId":"2f4c8134-92c6-4b75-8ee1-fafcf4b0ff02","userId":"EBz2MKO2-IvEJivY_3VUU","projectId":"f8afd9ea-e222-4ee8-91e5-fd3a018ec85e","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: Error: Workflow not found
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:47:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mRunning afterAll cleanup...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 101182[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 500[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 881[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 812[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 692[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 874[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 654[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 515[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 385[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 641[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30347[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30517[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1044[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     console.log('Running afterAll cleanup...');
     74|     if (tenantId) {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:343:10
    341|         .get(`/api/workflows/${workflowId}`)
    342|         .set("Authorization", `Bearer ${authToken}`)
    343|         .expect(200);
       |          ^
    344| 
    345|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:395:5
    393|     });
    394| 
    395|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    396|       const response = await request(baseURL)
    397|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:405:5
    403|     });
    404| 
    405|     it("should reject move without projectId in body", async () => {
       |     ^
    406|       const response = await request(baseURL)
    407|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:459:10
    457|         .set("Authorization", `Bearer ${authToken}`)
    458|         .send({ projectId: user2ProjectId })
    459|         .expect(403);
       |          ^
    460| 
    461|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       return res.status(200).json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       return res.status(200).json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 08:44:45
[2m   Duration [22m 104.55s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1764861621036,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764861622491,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764861624139,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764861624139,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764861624147,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764861624148,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764861624148,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764861624148,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764861624606,"env":"test","module":"user-credentials-repository","userId":"lBPBzyFzv8kwUrttflp7c","msg":"User credentials created"}
{"level":30,"time":1764861624610,"env":"test","module":"auth-routes","userId":"lBPBzyFzv8kwUrttflp7c","email":"test-workflows-SsTwp883zJ2n0MKXO2F8p@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a61e986f-bbc7-4b4b-9264-74155585faa9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"lBPBzyFzv8kwUrttflp7c","tenantId":"13d7093d-e7ba-40f8-a9db-45009aac0789","createdBy":"lBPBzyFzv8kwUrttflp7c","ownerId":"lBPBzyFzv8kwUrttflp7c","status":"active","archived":false,"createdAt":"2025-12-04T15:20:26.029Z","updatedAt":"2025-12-04T15:20:26.029Z"}

{"level":30,"time":1764861625318,"env":"test","module":"user-credentials-repository","userId":"Dlg3azrUgfNlCB8dMvk9D","msg":"User credentials created"}
{"level":30,"time":1764861625319,"env":"test","module":"auth-routes","userId":"Dlg3azrUgfNlCB8dMvk9D","email":"viewer-mwYvpAmqPKsFPFsHFzbJX@example.com","msg":"User registered successfully"}
{"level":40,"time":1764861625425,"env":"test","module":"rbac-middleware","userId":"Dlg3azrUgfNlCB8dMvk9D","userRole":"viewer","permission":"workflow:create","path":"/projects/a61e986f-bbc7-4b4b-9264-74155585faa9/workflows","msg":"Permission denied"}
{"level":50,"time":1764861632130,"env":"test","error":{},"workflowId":"82a01c6d-36ca-4666-9d58-d5aa52ff5ac3","userId":"lBPBzyFzv8kwUrttflp7c","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764861632462,"env":"test","module":"auth-middleware","path":"/api/workflows/a015fb46-9be9-4093-8f0a-df651a8b3be3/move","msg":"No valid authentication found"}
{"level":30,"time":1764861633019,"env":"test","module":"user-credentials-repository","userId":"dJKGKWLGDMaum8NDrnYPv","msg":"User credentials created"}
{"level":30,"time":1764861633019,"env":"test","module":"auth-routes","userId":"dJKGKWLGDMaum8NDrnYPv","email":"test-workflows-1oqzcVdc_bAfGnQWr5bJs@example.com","msg":"User registered successfully"}
{"level":50,"time":1764861633068,"env":"test","error":{},"workflowId":"91202ca3-676e-46d1-b3a6-17235b5aff16","userId":"dJKGKWLGDMaum8NDrnYPv","projectId":"43f8997c-dbfa-45aa-87cb-43fefd0a9082","msg":"Error moving workflow"}
{"level":50,"time":1764861633448,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"4bb66a09-b1b4-4334-a39b-feed9460dfdb","userId":"lBPBzyFzv8kwUrttflp7c","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764861633831,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f7083d33-b1d3-43c2-8bf5-1e7de53c17e0","userId":"lBPBzyFzv8kwUrttflp7c","msg":"Error moving workflow"}
{"level":30,"time":1764861634370,"env":"test","module":"user-credentials-repository","userId":"k6qS6f0Q8Bjt5jM9bpYGG","msg":"User credentials created"}
{"level":30,"time":1764861634371,"env":"test","module":"auth-routes","userId":"k6qS6f0Q8Bjt5jM9bpYGG","email":"test-workflows-B3X74ZwLytGxT1_OQJgAg@example.com","msg":"User registered successfully"}
{"level":30,"time":1764861634558,"env":"test","module":"auth-routes","userId":"k6qS6f0Q8Bjt5jM9bpYGG","email":"test-workflows-B3X74ZwLytGxT1_OQJgAg@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764861634756,"env":"test","error":{},"workflowId":"ff07aba9-6171-42be-a927-4c2d176c0cc6","userId":"lBPBzyFzv8kwUrttflp7c","projectId":"2c00076d-6dd9-4f4a-bc2d-db034470d232","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mRunning afterAll cleanup...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10924[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 356[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 488[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 513[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 834[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 810[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 683[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 383[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 925[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:343:10
    341|         .get(`/api/workflows/${workflowId}`)
    342|         .set("Authorization", `Bearer ${authToken}`)
    343|         .expect(200);
       |          ^
    344| 
    345|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 09:20:19
[2m   Duration [22m 15.50s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1764861704983,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764861706142,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764861707488,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764861707488,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764861707495,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764861707495,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764861707496,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764861707496,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764861707926,"env":"test","module":"user-credentials-repository","userId":"6iNX8z3bTIjsVz3BgP3Mn","msg":"User credentials created"}
{"level":30,"time":1764861707928,"env":"test","module":"auth-routes","userId":"6iNX8z3bTIjsVz3BgP3Mn","email":"test-workflows-jeIdbaJQM8-Le8Kvl80uO@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"62551471-31d5-4853-a2c8-891526493f90","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"6iNX8z3bTIjsVz3BgP3Mn","tenantId":"1ea4848c-da13-428c-bf71-cb53eb64864c","createdBy":"6iNX8z3bTIjsVz3BgP3Mn","ownerId":"6iNX8z3bTIjsVz3BgP3Mn","status":"active","archived":false,"createdAt":"2025-12-04T15:21:49.330Z","updatedAt":"2025-12-04T15:21:49.330Z"}

{"level":30,"time":1764861708587,"env":"test","module":"user-credentials-repository","userId":"eX7hi3MN6ez3CdWFwHBjO","msg":"User credentials created"}
{"level":30,"time":1764861708588,"env":"test","module":"auth-routes","userId":"eX7hi3MN6ez3CdWFwHBjO","email":"viewer-GSoIDZxyfQs5pGRVEFCwo@example.com","msg":"User registered successfully"}
{"level":40,"time":1764861708670,"env":"test","module":"rbac-middleware","userId":"eX7hi3MN6ez3CdWFwHBjO","userRole":"viewer","permission":"workflow:create","path":"/projects/62551471-31d5-4853-a2c8-891526493f90/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 6806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 280[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 612[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 739[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 838[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[32m 97[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[32m 106[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[32m 93[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without authentication[39m[32m 95[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 89[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 101[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 124[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 106[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 8 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without authentication
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
ReferenceError: projectResponse is not defined
 Î“Â¥Â» tests/integration/api.workflows.test.ts:284:7
    282|           description: "Target project for move tests",
    283|         });
    284|       targetProjectId = projectResponse.body.id;
       |       ^
    285|     });
    286| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/8]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m9 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 09:21:43
[2m   Duration [22m 10.75s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764862028050,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764862029294,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764862030688,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764862030688,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764862030694,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764862030694,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764862030694,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764862030694,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764862031142,"env":"test","module":"user-credentials-repository","userId":"UWuAiyPGr_HWax6QieLup","msg":"User credentials created"}
{"level":30,"time":1764862031145,"env":"test","module":"auth-routes","userId":"UWuAiyPGr_HWax6QieLup","email":"test-workflows-Cwzp_R47CwXFcdbMpeMtl@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"548ca321-9225-4f73-a7e8-8b9bd24b825e","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"UWuAiyPGr_HWax6QieLup","tenantId":"c1733ad2-e137-4f16-8e76-71f27160e499","createdBy":"UWuAiyPGr_HWax6QieLup","ownerId":"UWuAiyPGr_HWax6QieLup","status":"active","archived":false,"createdAt":"2025-12-04T15:27:12.591Z","updatedAt":"2025-12-04T15:27:12.591Z"}

{"level":30,"time":1764862031931,"env":"test","module":"user-credentials-repository","userId":"8wBQJaISi9l80lXbaYHkV","msg":"User credentials created"}
{"level":30,"time":1764862031931,"env":"test","module":"auth-routes","userId":"8wBQJaISi9l80lXbaYHkV","email":"viewer-5Nuug4X3s52KO_oZvqo94@example.com","msg":"User registered successfully"}
{"level":40,"time":1764862032051,"env":"test","module":"rbac-middleware","userId":"8wBQJaISi9l80lXbaYHkV","userRole":"viewer","permission":"workflow:create","path":"/projects/548ca321-9225-4f73-a7e8-8b9bd24b825e/workflows","msg":"Permission denied"}
{"level":50,"time":1764862038863,"env":"test","error":{},"workflowId":"e66bc320-cd75-46ab-bf14-6cb829c8199b","userId":"UWuAiyPGr_HWax6QieLup","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764862039234,"env":"test","module":"auth-middleware","path":"/api/workflows/3eb97a3c-bc1a-47d0-8eb6-7ad4d1942ad0/move","msg":"No valid authentication found"}
{"level":30,"time":1764862039805,"env":"test","module":"user-credentials-repository","userId":"u1Awe5PMZRWn_Qd_WgX1Q","msg":"User credentials created"}
{"level":30,"time":1764862039805,"env":"test","module":"auth-routes","userId":"u1Awe5PMZRWn_Qd_WgX1Q","email":"test-workflows-1TNcmcDSxauq9YLsEcylD@example.com","msg":"User registered successfully"}
{"level":50,"time":1764862039850,"env":"test","error":{},"workflowId":"8c791f07-8b21-4e40-b8ef-6de7adacb07a","userId":"u1Awe5PMZRWn_Qd_WgX1Q","projectId":"f8f378ae-45b2-4f88-82c4-51afcbf083fa","msg":"Error moving workflow"}
{"level":50,"time":1764862040247,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"29192bc0-887f-42a4-8eb8-21114fb27577","userId":"UWuAiyPGr_HWax6QieLup","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764862040672,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"8feb3bed-5a4c-4d57-b710-56269f0d9c08","userId":"UWuAiyPGr_HWax6QieLup","msg":"Error moving workflow"}
{"level":30,"time":1764862041228,"env":"test","module":"user-credentials-repository","userId":"_p8IE3c01jtqg68JEkjIp","msg":"User credentials created"}
{"level":30,"time":1764862041228,"env":"test","module":"auth-routes","userId":"_p8IE3c01jtqg68JEkjIp","email":"test-workflows-LKW7WEV5VbnGNZzJBLete@example.com","msg":"User registered successfully"}
{"level":40,"time":1764862041322,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764862041381,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"181ea295-dcf9-43a9-ba61-c09397b99bf4","userId":"UWuAiyPGr_HWax6QieLup","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10987[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 385[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 541[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 850[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 665[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 677[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 845[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 676[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 811[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 424[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 710[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 09:27:06
[2m   Duration [22m 15.20s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764866788463,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764866789793,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764866791242,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764866791242,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764866791247,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764866791247,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764866791247,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764866791247,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764866791708,"env":"test","module":"user-credentials-repository","userId":"qmXFZUpNpUOqlm92YotcF","msg":"User credentials created"}
{"level":30,"time":1764866791712,"env":"test","module":"auth-routes","userId":"qmXFZUpNpUOqlm92YotcF","email":"test-workflows-h0_UrqrArJftRAvGDDv0G@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a3618da5-47cf-4a41-8b36-7746b99c15b3","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"qmXFZUpNpUOqlm92YotcF","tenantId":"d3779cf2-f1f2-4ea3-9cf6-1b75c508facc","createdBy":"qmXFZUpNpUOqlm92YotcF","ownerId":"qmXFZUpNpUOqlm92YotcF","status":"active","archived":false,"createdAt":"2025-12-04T16:46:33.234Z","updatedAt":"2025-12-04T16:46:33.234Z"}

{"level":30,"time":1764866792511,"env":"test","module":"user-credentials-repository","userId":"BGeP695fbMGfgazkOWYU6","msg":"User credentials created"}
{"level":30,"time":1764866792512,"env":"test","module":"auth-routes","userId":"BGeP695fbMGfgazkOWYU6","email":"viewer-620fmAY1SBWBCyQ_w28fG@example.com","msg":"User registered successfully"}
{"level":40,"time":1764866792628,"env":"test","module":"rbac-middleware","userId":"BGeP695fbMGfgazkOWYU6","userRole":"viewer","permission":"workflow:create","path":"/projects/a3618da5-47cf-4a41-8b36-7746b99c15b3/workflows","msg":"Permission denied"}
{"level":50,"time":1764866799654,"env":"test","error":{},"workflowId":"50b7878b-d9ca-4be1-b57a-88e4823e7e59","userId":"qmXFZUpNpUOqlm92YotcF","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764866800031,"env":"test","module":"auth-middleware","path":"/api/workflows/b1d7a518-46d2-4e72-a9e5-6b8ed2aa4a80/move","msg":"No valid authentication found"}
{"level":30,"time":1764866800585,"env":"test","module":"user-credentials-repository","userId":"BU--wD4e_9qSTQeXYvhCR","msg":"User credentials created"}
{"level":30,"time":1764866800585,"env":"test","module":"auth-routes","userId":"BU--wD4e_9qSTQeXYvhCR","email":"test-workflows-hSIWLE1oNh5xov-1ib6es@example.com","msg":"User registered successfully"}
{"level":50,"time":1764866800634,"env":"test","error":{},"workflowId":"40d3e2e3-d51f-4db2-bc30-1e2295135a39","userId":"BU--wD4e_9qSTQeXYvhCR","projectId":"b0542da8-bb67-496f-8f0e-298255586c11","msg":"Error moving workflow"}
{"level":50,"time":1764866801043,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"78f678af-5593-47a3-80b5-4f66f097ab8d","userId":"qmXFZUpNpUOqlm92YotcF","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764866801474,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6e08b3bb-524a-4450-affe-98432dbdac87","userId":"qmXFZUpNpUOqlm92YotcF","msg":"Error moving workflow"}
{"level":50,"time":1764866802014,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(7lUc7MFJSM0ZwVkOggmni) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"7lUc7MFJSM0ZwVkOggmni","msg":"Failed to create user credentials"}
{"level":50,"time":1764866802014,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(7lUc7MFJSM0ZwVkOggmni) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11178[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 396[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 328[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 504[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 520[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 873[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 821[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 662[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 876[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 672[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 836[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 510[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 409[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 430[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 541[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:46:26
[2m   Duration [22m 15.83s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764867267308,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867268759,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867270420,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867270421,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867270430,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867270430,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867270431,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867270431,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867270921,"env":"test","module":"user-credentials-repository","userId":"LI-AwfEMVGAnAfgruvpl4","msg":"User credentials created"}
{"level":30,"time":1764867270924,"env":"test","module":"auth-routes","userId":"LI-AwfEMVGAnAfgruvpl4","email":"test-workflows-xYs4AHaOMJzI99dEnGvyC@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"950b4370-bfa0-4b20-9f4e-7830ef9e396d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"LI-AwfEMVGAnAfgruvpl4","tenantId":"e2d6545a-580c-4192-b4e2-e8bb5ce2fa95","createdBy":"LI-AwfEMVGAnAfgruvpl4","ownerId":"LI-AwfEMVGAnAfgruvpl4","status":"active","archived":false,"createdAt":"2025-12-04T16:54:32.445Z","updatedAt":"2025-12-04T16:54:32.445Z"}

{"level":30,"time":1764867271691,"env":"test","module":"user-credentials-repository","userId":"FrIm5fvv8aArCbzWgqQoB","msg":"User credentials created"}
{"level":30,"time":1764867271691,"env":"test","module":"auth-routes","userId":"FrIm5fvv8aArCbzWgqQoB","email":"viewer-oIWQT-8OtHzosFpe6BYuU@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867271804,"env":"test","module":"rbac-middleware","userId":"FrIm5fvv8aArCbzWgqQoB","userRole":"viewer","permission":"workflow:create","path":"/projects/950b4370-bfa0-4b20-9f4e-7830ef9e396d/workflows","msg":"Permission denied"}
{"level":50,"time":1764867279006,"env":"test","error":{},"workflowId":"254fa4e9-b2b1-4cad-a87a-15a6397fd92d","userId":"LI-AwfEMVGAnAfgruvpl4","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867279341,"env":"test","module":"auth-middleware","path":"/api/workflows/20d63248-dcbf-47d6-af98-e4d56b305aa5/move","msg":"No valid authentication found"}
{"level":30,"time":1764867279903,"env":"test","module":"user-credentials-repository","userId":"93t2YQ9dbbXqx92fQ8Zg7","msg":"User credentials created"}
{"level":30,"time":1764867279904,"env":"test","module":"auth-routes","userId":"93t2YQ9dbbXqx92fQ8Zg7","email":"test-workflows-TzdF1DOQv7p2NwWTwPRoO@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867279957,"env":"test","error":{},"workflowId":"432e3f73-dbba-4288-805b-2326b17fdac0","userId":"93t2YQ9dbbXqx92fQ8Zg7","projectId":"bb12c393-fe70-461a-82eb-e2ed4c7c0995","msg":"Error moving workflow"}
{"level":50,"time":1764867280373,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"f38c7eed-f83c-4eae-92e9-a4b156dec4ca","userId":"LI-AwfEMVGAnAfgruvpl4","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867280781,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"fe7b85e8-9981-4b1e-889d-b93bf53bf1cd","userId":"LI-AwfEMVGAnAfgruvpl4","msg":"Error moving workflow"}
{"level":50,"time":1764867281326,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(ytKyr-TL8CwbpnYovejxR) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"ytKyr-TL8CwbpnYovejxR","msg":"Failed to create user credentials"}
{"level":50,"time":1764867281326,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(ytKyr-TL8CwbpnYovejxR) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 521[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 886[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 844[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 871[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 713[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 934[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 416[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 409[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 545[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:54:25
[2m   Duration [22m 16.35s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764867556120,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558242,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560568,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560568,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560580,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560580,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560581,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560581,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867561028,"env":"test","module":"user-credentials-repository","userId":"lC6B7ttnf7cYA_P_j40F7","msg":"User credentials created"}
{"level":30,"time":1764867561031,"env":"test","module":"auth-routes","userId":"lC6B7ttnf7cYA_P_j40F7","email":"test-workflows-sfHCWeZakQ8XScnZJdtYY@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"fd5f438b-00d1-4c9c-996c-1fe792faba0d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"lC6B7ttnf7cYA_P_j40F7","tenantId":"f6de96db-2db0-417b-8446-2ed683b9eeec","createdBy":"lC6B7ttnf7cYA_P_j40F7","ownerId":"lC6B7ttnf7cYA_P_j40F7","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.539Z","updatedAt":"2025-12-04T16:59:22.539Z"}

{"level":30,"time":1764867561714,"env":"test","module":"user-credentials-repository","userId":"nfkkn4PJEvJbPBoBTkaUa","msg":"User credentials created"}
{"level":30,"time":1764867561715,"env":"test","module":"auth-routes","userId":"nfkkn4PJEvJbPBoBTkaUa","email":"viewer-jVpUTVPJBHWVl6O4ceIaF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561814,"env":"test","module":"rbac-middleware","userId":"nfkkn4PJEvJbPBoBTkaUa","userRole":"viewer","permission":"workflow:create","path":"/projects/fd5f438b-00d1-4c9c-996c-1fe792faba0d/workflows","msg":"Permission denied"}
{"level":50,"time":1764867568155,"env":"test","error":{},"workflowId":"3157ce2b-18b9-4255-84ca-f49068fd1a05","userId":"lC6B7ttnf7cYA_P_j40F7","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867568476,"env":"test","module":"auth-middleware","path":"/api/workflows/97c65717-b047-4a8b-8688-4ba6d785bca1/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568981,"env":"test","module":"user-credentials-repository","userId":"02M4IY1ItIxMEeOfKqgla","msg":"User credentials created"}
{"level":30,"time":1764867568982,"env":"test","module":"auth-routes","userId":"02M4IY1ItIxMEeOfKqgla","email":"test-workflows-PUIRGJtxA_hedctXBCv2e@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867569025,"env":"test","error":{},"workflowId":"71c72d0b-38ac-467d-9911-47ab9bc17e44","userId":"02M4IY1ItIxMEeOfKqgla","projectId":"ec4a00ee-9f51-447b-9889-a4c2e1b3e2a8","msg":"Error moving workflow"}
{"level":50,"time":1764867569392,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"296a3529-2e6c-4a4d-8564-ca7c2f22c53f","userId":"lC6B7ttnf7cYA_P_j40F7","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569773,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ab94a2cc-f721-4fff-8b41-bc73b57bb71e","userId":"lC6B7ttnf7cYA_P_j40F7","msg":"Error moving workflow"}
{"level":30,"time":1764867570369,"env":"test","module":"user-credentials-repository","userId":"rZmOUlSs3zbQxwjqMxesV","msg":"User credentials created"}
{"level":30,"time":1764867570370,"env":"test","module":"auth-routes","userId":"rZmOUlSs3zbQxwjqMxesV","email":"test-workflows-D9jduzXWbiAWNH5AEocFG@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867570466,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764867570507,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"0308f9d9-8084-44c7-b32f-10cccdf1adb0","userId":"lC6B7ttnf7cYA_P_j40F7","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10210[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 310[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 737[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 639[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 780[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 655[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 367[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 381[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 735[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 17.02s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764867689058,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867690811,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692666,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692667,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692674,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692674,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692675,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692675,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867693096,"env":"test","module":"user-credentials-repository","userId":"43dbHuceuvLSRUx2gLN7K","msg":"User credentials created"}
{"level":30,"time":1764867693099,"env":"test","module":"auth-routes","userId":"43dbHuceuvLSRUx2gLN7K","email":"test-workflows-w-Y33j5rLwPtUfmrovHPr@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"41f82ea8-fbdd-4169-a8ae-5b7dedbb19bc","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"43dbHuceuvLSRUx2gLN7K","tenantId":"f38d914c-31c3-435c-93e1-d360f1495def","createdBy":"43dbHuceuvLSRUx2gLN7K","ownerId":"43dbHuceuvLSRUx2gLN7K","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.613Z","updatedAt":"2025-12-04T17:01:34.613Z"}

{"level":30,"time":1764867693762,"env":"test","module":"user-credentials-repository","userId":"C3ITFMgGlFK8SSUYEczlD","msg":"User credentials created"}
{"level":30,"time":1764867693763,"env":"test","module":"auth-routes","userId":"C3ITFMgGlFK8SSUYEczlD","email":"viewer-TCcjmSdKyxoW7wM1CVqpU@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693856,"env":"test","module":"rbac-middleware","userId":"C3ITFMgGlFK8SSUYEczlD","userRole":"viewer","permission":"workflow:create","path":"/projects/41f82ea8-fbdd-4169-a8ae-5b7dedbb19bc/workflows","msg":"Permission denied"}
{"level":50,"time":1764867699833,"env":"test","error":{},"workflowId":"2956ed1f-0874-4a6a-a81f-339ec99d65b0","userId":"43dbHuceuvLSRUx2gLN7K","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867700134,"env":"test","module":"auth-middleware","path":"/api/workflows/e4c6bfdd-08e3-4ad1-a5f8-f41005cba8f6/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700637,"env":"test","module":"user-credentials-repository","userId":"DH-adaSg3I_Ci8ki5XBgF","msg":"User credentials created"}
{"level":30,"time":1764867700637,"env":"test","module":"auth-routes","userId":"DH-adaSg3I_Ci8ki5XBgF","email":"test-workflows-U2g-861h3K3jp8zuuuxbp@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700685,"env":"test","error":{},"workflowId":"987efb37-40ba-48a1-89a0-a8865990f575","userId":"DH-adaSg3I_Ci8ki5XBgF","projectId":"6dec1374-a040-4ccd-a024-cfad4b98defc","msg":"Error moving workflow"}
{"level":50,"time":1764867701048,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1e464087-5159-48eb-94af-c3a3a45c2515","userId":"43dbHuceuvLSRUx2gLN7K","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701396,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"13be95cb-3413-4a51-857e-1e8dbbcc5fe9","userId":"43dbHuceuvLSRUx2gLN7K","msg":"Error moving workflow"}
{"level":30,"time":1764867701877,"env":"test","module":"user-credentials-repository","userId":"y5taWj6qNaD6d-tSJ_gd4","msg":"User credentials created"}
{"level":30,"time":1764867701878,"env":"test","module":"auth-routes","userId":"y5taWj6qNaD6d-tSJ_gd4","email":"test-workflows-FYET4FZmmOzKZnLWonmaJ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867702064,"env":"test","module":"auth-routes","userId":"y5taWj6qNaD6d-tSJ_gd4","email":"test-workflows-FYET4FZmmOzKZnLWonmaJ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867702293,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"db86b006-2111-4495-88ea-6e6b64276e7a","userId":"43dbHuceuvLSRUx2gLN7K","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9900[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 318[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 286[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 587[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 717[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 443[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 300[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 363[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 897[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 16.04s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764868031828,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033828,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035725,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035725,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035735,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035735,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035735,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035735,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868036516,"env":"test","module":"user-credentials-repository","userId":"KUXaNuqliJhN-K-EpUxal","msg":"User credentials created"}
{"level":30,"time":1764868036518,"env":"test","module":"auth-routes","userId":"KUXaNuqliJhN-K-EpUxal","email":"test-workflows-81etkX5jQ9eM_1jAStRyq@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"cb90582e-22a2-44c6-9060-0542536f3738","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"KUXaNuqliJhN-K-EpUxal","tenantId":"a4064d49-695b-4df0-ae29-bfe129325f49","createdBy":"KUXaNuqliJhN-K-EpUxal","ownerId":"KUXaNuqliJhN-K-EpUxal","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.039Z","updatedAt":"2025-12-04T17:07:18.039Z"}

{"level":30,"time":1764868037289,"env":"test","module":"user-credentials-repository","userId":"LblzSl5gfnxVE-HjTFkbR","msg":"User credentials created"}
{"level":30,"time":1764868037290,"env":"test","module":"auth-routes","userId":"LblzSl5gfnxVE-HjTFkbR","email":"viewer-3KdFXihGH6Xm5uZMYNKDN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037384,"env":"test","module":"rbac-middleware","userId":"LblzSl5gfnxVE-HjTFkbR","userRole":"viewer","permission":"workflow:create","path":"/projects/cb90582e-22a2-44c6-9060-0542536f3738/workflows","msg":"Permission denied"}
{"level":50,"time":1764868043322,"env":"test","error":{},"workflowId":"6b167432-c3fc-47ec-acba-1258181c1ab9","userId":"KUXaNuqliJhN-K-EpUxal","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868043620,"env":"test","module":"auth-middleware","path":"/api/workflows/92a4ec00-94ad-4a95-bf07-8a7c00db2999/move","msg":"No valid authentication found"}
{"level":30,"time":1764868044157,"env":"test","module":"user-credentials-repository","userId":"tCywjN6Te5B5xEPAvELmo","msg":"User credentials created"}
{"level":30,"time":1764868044158,"env":"test","module":"auth-routes","userId":"tCywjN6Te5B5xEPAvELmo","email":"test-workflows-LDBHSz4rFOIpEGu8ks9nx@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868044207,"env":"test","error":{},"workflowId":"3ad65c7e-bc31-4c83-b2a6-869b88c7c551","userId":"tCywjN6Te5B5xEPAvELmo","projectId":"39446525-ad7e-4ef2-b01c-c5af5e181c41","msg":"Error moving workflow"}
{"level":50,"time":1764868044549,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3b3d5fbe-b778-48a6-8a6b-c582871f852e","userId":"KUXaNuqliJhN-K-EpUxal","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868044900,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ed24075b-316c-41a8-b8e0-0dd646b5484a","userId":"KUXaNuqliJhN-K-EpUxal","msg":"Error moving workflow"}
{"level":30,"time":1764868045445,"env":"test","module":"user-credentials-repository","userId":"PHw6HBYIR1aLu0bUOh_1m","msg":"User credentials created"}
{"level":30,"time":1764868045446,"env":"test","module":"auth-routes","userId":"PHw6HBYIR1aLu0bUOh_1m","email":"test-workflows-9cjjTWXDdNH2FElbgyRcH@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868045635,"env":"test","module":"auth-routes","userId":"PHw6HBYIR1aLu0bUOh_1m","email":"test-workflows-9cjjTWXDdNH2FElbgyRcH@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868045804,"env":"test","error":{},"workflowId":"a53f00e7-2c12-412c-9cde-fe67dabf51d8","userId":"KUXaNuqliJhN-K-EpUxal","projectId":"6d9979a7-2089-43c0-bba7-9cecdae02919","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10850[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 379[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 291[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 612[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 578[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 682[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 437[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 588[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 342[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 905[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 17.44s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764868270583,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272413,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274245,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274246,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274255,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274255,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274256,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274256,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274691,"env":"test","module":"user-credentials-repository","userId":"Wg2MTe1dyvI9WqYBzXVRx","msg":"User credentials created"}
{"level":30,"time":1764868274694,"env":"test","module":"auth-routes","userId":"Wg2MTe1dyvI9WqYBzXVRx","email":"test-workflows-O5rDr2Uq7Iw_qNaKjs9jF@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2c7adbb4-58eb-4f44-b450-9eec35e9dc4b","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"Wg2MTe1dyvI9WqYBzXVRx","tenantId":"2f629694-8e04-40b2-947d-f3bd6af0e7a7","createdBy":"Wg2MTe1dyvI9WqYBzXVRx","ownerId":"Wg2MTe1dyvI9WqYBzXVRx","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.208Z","updatedAt":"2025-12-04T17:11:16.208Z"}

{"level":30,"time":1764868275378,"env":"test","module":"user-credentials-repository","userId":"nysS1RUlu3GfJhwtBspR1","msg":"User credentials created"}
{"level":30,"time":1764868275379,"env":"test","module":"auth-routes","userId":"nysS1RUlu3GfJhwtBspR1","email":"viewer-uWbhjmzAOke63aZnIxRcJ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275471,"env":"test","module":"rbac-middleware","userId":"nysS1RUlu3GfJhwtBspR1","userRole":"viewer","permission":"workflow:create","path":"/projects/2c7adbb4-58eb-4f44-b450-9eec35e9dc4b/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281778,"env":"test","error":{},"workflowId":"3e50d554-ae36-44ae-8ece-f979a04f4a15","userId":"Wg2MTe1dyvI9WqYBzXVRx","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868282119,"env":"test","module":"auth-middleware","path":"/api/workflows/4a7946dd-cb7e-4827-bd0d-5c7cf7770acd/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282650,"env":"test","module":"user-credentials-repository","userId":"b74E1rlatMLEp0gh1fxzn","msg":"User credentials created"}
{"level":30,"time":1764868282651,"env":"test","module":"auth-routes","userId":"b74E1rlatMLEp0gh1fxzn","email":"test-workflows-g0uLDd17x49W16Zzt8jXB@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282702,"env":"test","error":{},"workflowId":"bbad180c-4b44-45dc-8b61-f19d0f4332aa","userId":"b74E1rlatMLEp0gh1fxzn","projectId":"7c862294-7903-468e-82ea-d12c0b2a96a0","msg":"Error moving workflow"}
{"level":50,"time":1764868283072,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"89f010cb-c2d9-43a8-a674-eeee4e24566d","userId":"Wg2MTe1dyvI9WqYBzXVRx","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868283449,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"d3a15d21-c52a-40c5-ba11-8b6a6b873b74","userId":"Wg2MTe1dyvI9WqYBzXVRx","msg":"Error moving workflow"}
{"level":50,"time":1764868283974,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rqRmjN0AMxXljiYYQ0LBD) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"rqRmjN0AMxXljiYYQ0LBD","msg":"Failed to create user credentials"}
{"level":50,"time":1764868283974,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rqRmjN0AMxXljiYYQ0LBD) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10133[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 296[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 830[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 612[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 750[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 526[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 16.00s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764868528908,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531161,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533344,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533344,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533357,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533357,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533357,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533357,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533783,"env":"test","module":"user-credentials-repository","userId":"AYJOf-YfZ5GkVt0zTc4Mp","msg":"User credentials created"}
{"level":30,"time":1764868533785,"env":"test","module":"auth-routes","userId":"AYJOf-YfZ5GkVt0zTc4Mp","email":"test-workflows-jCxUT05zJQbBxz0vvJnH9@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"682fcf1b-93ff-4875-8b07-b9593d33a1e9","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"AYJOf-YfZ5GkVt0zTc4Mp","tenantId":"01c47a97-3983-4319-9958-2c6cbb28a5e4","createdBy":"AYJOf-YfZ5GkVt0zTc4Mp","ownerId":"AYJOf-YfZ5GkVt0zTc4Mp","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.301Z","updatedAt":"2025-12-04T17:15:35.301Z"}

{"level":30,"time":1764868534431,"env":"test","module":"user-credentials-repository","userId":"oXKs7ZlBiNpwWtsFJmnhd","msg":"User credentials created"}
{"level":30,"time":1764868534432,"env":"test","module":"auth-routes","userId":"oXKs7ZlBiNpwWtsFJmnhd","email":"viewer-d8vOdbRreZsxZIRLhtT9r@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534527,"env":"test","module":"rbac-middleware","userId":"oXKs7ZlBiNpwWtsFJmnhd","userRole":"viewer","permission":"workflow:create","path":"/projects/682fcf1b-93ff-4875-8b07-b9593d33a1e9/workflows","msg":"Permission denied"}
{"level":50,"time":1764868540590,"env":"test","error":{},"workflowId":"1ed648e4-7903-4b23-a05a-e3b70eefc8ab","userId":"AYJOf-YfZ5GkVt0zTc4Mp","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868540908,"env":"test","module":"auth-middleware","path":"/api/workflows/bb2ad708-a3ba-4303-8ee5-4b6b064c8763/move","msg":"No valid authentication found"}
{"level":30,"time":1764868541407,"env":"test","module":"user-credentials-repository","userId":"SKUVNI8__Ip-8HTsz6r0q","msg":"User credentials created"}
{"level":30,"time":1764868541407,"env":"test","module":"auth-routes","userId":"SKUVNI8__Ip-8HTsz6r0q","email":"test-workflows-gUTysA3ArYMayBdJp873z@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868541458,"env":"test","error":{},"workflowId":"8e4f198e-c8bc-4f97-b786-cf277db52574","userId":"SKUVNI8__Ip-8HTsz6r0q","projectId":"d4ebe087-408d-4363-b30a-5e607206b6d0","msg":"Error moving workflow"}
{"level":50,"time":1764868541814,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"378a5a84-65aa-4982-ad1b-23c5780b9722","userId":"AYJOf-YfZ5GkVt0zTc4Mp","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868542180,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ed2ec9d8-0759-46e0-ad1e-e3b883826870","userId":"AYJOf-YfZ5GkVt0zTc4Mp","msg":"Error moving workflow"}
{"level":30,"time":1764868542837,"env":"test","module":"user-credentials-repository","userId":"HY9azlRyRLwI8stCLIqfi","msg":"User credentials created"}
{"level":30,"time":1764868542838,"env":"test","module":"auth-routes","userId":"HY9azlRyRLwI8stCLIqfi","email":"test-workflows-iVUcAREAraHM9paV1QbdJ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868543113,"env":"test","module":"auth-routes","userId":"HY9azlRyRLwI8stCLIqfi","email":"test-workflows-iVUcAREAraHM9paV1QbdJ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868543335,"env":"test","error":{},"workflowId":"184e021a-7f40-499a-b7bc-0cbc93544e7f","userId":"AYJOf-YfZ5GkVt0zTc4Mp","projectId":"1dd33575-53e7-4e6a-b66a-b9ad527d8dfe","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 10312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 437[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 743[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 733[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 316[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 355[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 367[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1155[2mms[22m[39m

[2m Test Files [22m [1m[32m1 passed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 17.59s

[1m[42m PASS [49m[22m [32mWaiting for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764868816595,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818714,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820736,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820736,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820743,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820743,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820743,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820743,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821130,"env":"test","module":"user-credentials-repository","userId":"ylDJSW6euOqRMeLB2GOdM","msg":"User credentials created"}
{"level":30,"time":1764868821133,"env":"test","module":"auth-routes","userId":"ylDJSW6euOqRMeLB2GOdM","email":"test-workflows-qXDuhLPOg8BUbaVoDqtVR@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2e680a66-3b62-45f8-b36a-0e2976053f58","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ylDJSW6euOqRMeLB2GOdM","tenantId":"27f206ae-eb9f-4370-97e4-caa3752fd752","createdBy":"ylDJSW6euOqRMeLB2GOdM","ownerId":"ylDJSW6euOqRMeLB2GOdM","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.665Z","updatedAt":"2025-12-04T17:20:22.665Z"}

{"level":30,"time":1764868821775,"env":"test","module":"user-credentials-repository","userId":"D6mVemXu68jW_Eg0Eavsm","msg":"User credentials created"}
{"level":30,"time":1764868821776,"env":"test","module":"auth-routes","userId":"D6mVemXu68jW_Eg0Eavsm","email":"viewer-rnge-8FVKPR6TTE_7FJPd@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821867,"env":"test","module":"rbac-middleware","userId":"D6mVemXu68jW_Eg0Eavsm","userRole":"viewer","permission":"workflow:create","path":"/projects/2e680a66-3b62-45f8-b36a-0e2976053f58/workflows","msg":"Permission denied"}
{"level":50,"time":1764868827618,"env":"test","error":{},"workflowId":"eae59d39-bd62-4ae5-82b4-03e03d19737c","userId":"ylDJSW6euOqRMeLB2GOdM","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868827916,"env":"test","module":"auth-middleware","path":"/api/workflows/632dbe7f-eb1a-4c42-a91b-61964907c0d0/move","msg":"No valid authentication found"}
{"level":30,"time":1764868828388,"env":"test","module":"user-credentials-repository","userId":"Ft0lPZF2hgnDbYleG6mRX","msg":"User credentials created"}
{"level":30,"time":1764868828389,"env":"test","module":"auth-routes","userId":"Ft0lPZF2hgnDbYleG6mRX","email":"test-workflows-RhppNnKET8fO8sxljxPvw@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868828434,"env":"test","error":{},"workflowId":"5fe586a8-9061-4f9f-bbb8-c3beea7047d3","userId":"Ft0lPZF2hgnDbYleG6mRX","projectId":"3be4b774-b719-4de9-a53f-571e30effa55","msg":"Error moving workflow"}
{"level":50,"time":1764868828767,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8c035314-689b-4952-a246-fb5b249ffa93","userId":"ylDJSW6euOqRMeLB2GOdM","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868829099,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"6a769825-57f1-4b53-8ae3-75fc93ee64f3","userId":"ylDJSW6euOqRMeLB2GOdM","msg":"Error moving workflow"}
{"level":30,"time":1764868829549,"env":"test","module":"user-credentials-repository","userId":"1JODO7qOsY21RnfEVL74d","msg":"User credentials created"}
{"level":30,"time":1764868829550,"env":"test","module":"auth-routes","userId":"1JODO7qOsY21RnfEVL74d","email":"test-workflows-fKweETJYOxzXaKfyqyI4G@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868829730,"env":"test","module":"auth-routes","userId":"1JODO7qOsY21RnfEVL74d","email":"test-workflows-fKweETJYOxzXaKfyqyI4G@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868829923,"env":"test","error":{},"workflowId":"1e150556-47f7-4dc8-9bb5-599a8c06ecb2","userId":"ylDJSW6euOqRMeLB2GOdM","projectId":"5e102f42-0604-412b-bf30-2bb2b85ca484","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 9538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 304[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 281[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 413[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 661[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 579[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 429[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 826[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[32m17 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 16.61s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
