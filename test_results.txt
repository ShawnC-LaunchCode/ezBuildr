npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

> ezbuildr@1.0.0 test
> cross-env VITEST_INTEGRATION=true vitest run --coverage

 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079894566,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079894833,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079894823,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079894845,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079894847,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079894872,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079894893,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079894896,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079894906,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079894941,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079894946,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079894970,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079894976,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079895631,"env":"test","module":"email-queue","jobId":"694d44b7-aab6-44ed-bb9f-03fa82585d64","to":"audit-user2@test.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
stderr | tests/integration/auth.flows.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:280:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

{"level":30,"time":1768079896114,"env":"test","module":"user-credentials-repository","userId":"_NnB6HoeWAcjCjXep4eiR","msg":"User credentials created"}
{"level":30,"time":1768079896221,"env":"test","module":"user-credentials-repository","userId":"UGkIIbr8xQEfwvp8okm9B","msg":"User credentials created"}
{"level":40,"time":1768079896268,"env":"test","module":"auth-service","tokenHash":"c867a2afacbea6975055d92872c8ff814d08e1e5fa57d26a346488a6c177d724","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768079896427,"env":"test","module":"auth-routes","userId":"UGkIIbr8xQEfwvp8okm9B","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768079896660,"env":"test","module":"user-credentials-repository","userId":"cUT3KwsDqBLKMF_qhdmlD","msg":"User credentials created"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould trust current device
[22m[39m[TEST UTILS] MFA Secret verified for 168f57c32b4c413bb967241043c9943b

{"level":30,"time":1768079896734,"env":"test","module":"user-credentials-repository","userId":"d1214ec2-8b11-4296-bd35-399c6ca2b169","msg":"User credentials created"}
{"level":30,"time":1768079896807,"env":"test","module":"user-credentials-repository","userId":"5cjBQN_xQdklVV63SY8K8","msg":"User credentials created"}
{"level":30,"time":1768079896837,"env":"test","module":"user-credentials-repository","userId":"e8b7cf09-ed92-4a07-9102-eda7798336d6","msg":"User credentials created"}
{"level":30,"time":1768079896837,"env":"test","module":"email-queue","jobId":"a3da37fb-953b-48b4-aeda-fc08f8fc4979","to":"email-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768079896840,"env":"test","module":"email-queue","jobId":"0ff49903-f734-4a74-b151-f57f8e6e68d4","to":"test-1768079896268-yf95myl@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079896902,"env":"test","module":"auth-routes","userId":"d1214ec2-8b11-4296-bd35-399c6ca2b169","email":"test-1768079896268-yf95myl@example.com","msg":"User registered"}
{"level":30,"time":1768079896913,"env":"test","module":"auth-routes","userId":"5cjBQN_xQdklVV63SY8K8","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768079896955,"env":"test","module":"email-queue","jobId":"5d8d5680-98cc-4cb2-919b-be9b5387c169","to":"test-1768079896368-9luqza@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079897011,"env":"test","module":"auth-routes","userId":"e8b7cf09-ed92-4a07-9102-eda7798336d6","email":"test-1768079896368-9luqza@example.com","msg":"User registered"}
{"level":30,"time":1768079897188,"env":"test","module":"auth-routes","userId":"21e5e45b8b275929f3dc873dd9465dd0","msg":"User logged in successfully"}
{"level":30,"time":1768079897209,"env":"test","module":"auth-routes","userId":"2cf7d2268939cca798d6c663c672e2b9","msg":"User logged in successfully"}
{"level":30,"time":1768079897243,"env":"test","module":"audit-log-service","userId":"21e5e45b8b275929f3dc873dd9465dd0","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079897261,"env":"test","module":"audit-log-service","userId":"2cf7d2268939cca798d6c663c672e2b9","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079897289,"env":"test","module":"user-credentials-repository","userId":"cYxczOiB7UtXSnnrNB64n","msg":"User credentials created"}
{"level":30,"time":1768079897403,"env":"test","module":"auth-routes","userId":"cYxczOiB7UtXSnnrNB64n","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1768079897424,"env":"test","module":"user-credentials-repository","userId":"H4aMXksk-5pRgMVmN-a91","msg":"User credentials created"}
{"level":40,"time":1768079897457,"env":"test","module":"auth-routes","userId":"e8b7cf09-ed92-4a07-9102-eda7798336d6","email":"test-1768079896368-9luqza@example.com","msg":"Login blocked: email not verified"}
{"level":50,"time":1768079897459,"env":"test","module":"auth-routes","error":{"name":"EmailNotVerifiedError","code":"AUTH_006","statusCode":403,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079897539,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079897556,"env":"test","module":"email-queue","jobId":"a53866c2-c844-413c-8fda-826ddb841be5","to":"expired-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768079897600,"env":"test","module":"auth-routes","userId":"168f57c32b4c413bb967241043c9943b","msg":"Login requires MFA verification"}
{"level":40,"time":1768079897726,"env":"test","module":"mfa-service","userId":"168f57c32b4c413bb967241043c9943b","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079897726,"env":"test","module":"auth-routes","userId":"168f57c32b4c413bb967241043c9943b","msg":"MFA verification failed during login"}
{"level":50,"time":1768079897735,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079897790,"env":"test","module":"user-credentials-repository","userId":"-YUSXIQ3wFaS8coDGIi53","msg":"User credentials created"}
{"level":50,"time":1768079897802,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079897809,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079897809,"env":"test","module":"mfa-service","userId":"21e5e45b8b275929f3dc873dd9465dd0","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768079897809,"env":"test","module":"mfa-service","userId":"21e5e45b8b275929f3dc873dd9465dd0","msg":"Generated TOTP secret"}
{"level":30,"time":1768079897809,"env":"test","module":"auth-routes","userId":"21e5e45b8b275929f3dc873dd9465dd0","msg":"MFA setup initiated"}
{"level":50,"time":1768079897816,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079897865,"env":"test","module":"user-credentials-repository","userId":"LFPn-DXKeSLDDhxrcVyWB","msg":"User credentials created"}
{"level":30,"time":1768079897903,"env":"test","module":"auth-routes","userId":"-YUSXIQ3wFaS8coDGIi53","sessionCount":0,"msg":"Listed active sessions"}
{"level":40,"time":1768079897985,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768079898264,"env":"test","module":"email-queue","jobId":"88e23565-a457-48de-900d-d0d480163ec5","to":"expired-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768079898314,"env":"test","module":"user-credentials-repository","userId":"ZwdMAyUqIVPBeSnej1lNX","msg":"User credentials created"}
{"level":30,"time":1768079898360,"env":"test","module":"user-credentials-repository","userId":"UHaP1TocO137IlVUKgQB9","msg":"User credentials created"}
{"level":30,"time":1768079898489,"env":"test","module":"auth-routes","userId":"ZwdMAyUqIVPBeSnej1lNX","sessionCount":1,"msg":"Listed active sessions"}
{"level":40,"time":1768079898527,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould set trust expiry to 30 days
[22m[39m[TEST UTILS] MFA Secret verified for ee33dd7b7a91405fc4e76c388dab606d

{"level":30,"time":1768079898894,"env":"test","module":"user-credentials-repository","userId":"u3hCJOZfA2KdHJb2lT4--","msg":"User credentials created"}
{"level":30,"time":1768079898920,"env":"test","module":"user-credentials-repository","userId":"BZd7BomvVyD4XgXWVfFbu","msg":"User credentials created"}
{"level":50,"time":1768079898936,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079898940,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079899031,"env":"test","module":"auth-routes","userId":"BZd7BomvVyD4XgXWVfFbu","sessionCount":1,"msg":"Listed active sessions"}
{"level":40,"time":1768079899060,"env":"test","module":"auth-service","tokenHash":"b76f5249ca60fd1c06bf5f36677325c2b25105c010dbf10991bc0816fadecda5","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1768079899199,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests[2m > [22m[2mshould generate basic autonumber without prefix
[22m[39mRow 1 Basic Autonumber: 0001
Row 2 Basic Autonumber: 0002

{"level":50,"time":1768079899203,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079899282,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079899299,"env":"test","module":"auth-routes","userId":"026d687f0a91452829a29fc17724859a","msg":"User logged in successfully"}
{"level":30,"time":1768079899355,"env":"test","module":"audit-log-service","userId":"026d687f0a91452829a29fc17724859a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768079899396,"env":"test","module":"mfa-service","userId":"ee33dd7b7a91405fc4e76c388dab606d","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079899396,"env":"test","module":"auth-routes","userId":"ee33dd7b7a91405fc4e76c388dab606d","msg":"MFA verification failed during login"}
{"level":50,"time":1768079899402,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079899414,"env":"test","module":"user-credentials-repository","userId":"c5B-YjLIjaBcRMr97_6uS","msg":"User credentials created"}
{"level":50,"time":1768079899419,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079899429,"env":"test","module":"user-credentials-repository","userId":"0DBmTQpZKjVS1-Jeed12r","msg":"User credentials created"}
{"level":50,"time":1768079899480,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079899612,"env":"test","module":"auth-service","tokenHash":"f51bfd997034b478e0c9acca07e28588bd02938d25946dcee0b742639bb1eec3","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1768079899769,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079899796,"env":"test","module":"user-credentials-repository","userId":"a3ADsaI2On8pZhOu33esf","msg":"User credentials created"}
{"level":30,"time":1768079899929,"env":"test","module":"mfa-service","userId":"026d687f0a91452829a29fc17724859a","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768079899930,"env":"test","module":"mfa-service","userId":"026d687f0a91452829a29fc17724859a","msg":"Generated TOTP secret"}
{"level":30,"time":1768079899930,"env":"test","module":"auth-routes","userId":"026d687f0a91452829a29fc17724859a","msg":"MFA setup initiated"}
{"level":30,"time":1768079899969,"env":"test","module":"user-credentials-repository","userId":"CnXq7noO40Tk0iY-B6nHz","msg":"User credentials created"}
{"level":30,"time":1768079900009,"env":"test","module":"auth-routes","userId":"a3ADsaI2On8pZhOu33esf","sessionId":"48777370-a1cd-4d1b-94da-cf215d8415e8","msg":"Session revoked"}
{"level":30,"time":1768079900024,"env":"test","module":"user-credentials-repository","userId":"a6bf1ea0-fe9f-414a-8526-eaac1e46fcb8","msg":"User credentials created"}
{"level":50,"time":1768079900044,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079900053,"env":"test","module":"mfa-service","userId":"026d687f0a91452829a29fc17724859a","msg":"No MFA secret found for user"}
{"level":30,"time":1768079900134,"env":"test","module":"email-queue","jobId":"cb3294dc-b666-475e-b1fc-60bd003607b2","to":"test-1768079899602-glfsk@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079900187,"env":"test","module":"auth-routes","userId":"a6bf1ea0-fe9f-414a-8526-eaac1e46fcb8","email":"test-1768079899602-glfsk@example.com","msg":"User registered"}
{"level":50,"time":1768079900314,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079900428,"env":"test","module":"user-credentials-repository","userId":"VMSRWwm_ISEvbvFNu3MFV","msg":"User credentials created"}
{"level":30,"time":1768079900571,"env":"test","module":"auth-routes","userId":"2483fdf60cb1db920b5f0bf8c72a63e2","msg":"User logged in successfully"}
{"level":30,"time":1768079900622,"env":"test","module":"audit-log-service","userId":"2483fdf60cb1db920b5f0bf8c72a63e2","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079900697,"env":"test","module":"user-credentials-repository","userId":"jBXpLA-NRV7nBL74jLZ1X","msg":"User credentials created"}
{"level":50,"time":1768079900827,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079900837,"env":"test","module":"user-credentials-repository","userId":"HLv2GOrxbsvQSV4TH-s6z","msg":"User credentials created"}
{"level":30,"time":1768079900893,"env":"test","module":"email-queue","jobId":"83dd61e4-dafe-425b-af55-41ee18928080","to":"placeholder-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":50,"time":1768079900894,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079900990,"env":"test","module":"auth-service","tokenHash":"2d025d48ad3804a50e251f15643498c64ad6ccc4aea30976f3e8b9473681ffb8","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould not allow MFA setup if already enabled
[22m[39m[TEST UTILS] MFA Secret verified for 7e68720d1427c2214528288428d6162f

stderr | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #8: Placeholder user cleanup > should cleanup placeholder user when invite is revoked
Failed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:20:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:833:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:270:7
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:20 {
  length: 341,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (workspace_id)=(2f774d69-7024-41b0-bc70-145ff0e47774) is not present in table "workspaces".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_workspace_id_workspaces_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}

{"level":30,"time":1768079901375,"env":"test","module":"user-credentials-repository","userId":"l0LK7XDcsdtzM2IRjsdOT","msg":"User credentials created"}
{"level":30,"time":1768079901428,"env":"test","module":"user-credentials-repository","userId":"o665YqxG3K76UivSo3mgA","msg":"User credentials created"}
{"level":50,"time":1768079901520,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079901557,"env":"test","module":"user-credentials-repository","userId":"87d42d74-4e4f-42d8-80cc-933fb47be125","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #8: Placeholder user cleanup[2m > [22m[2mshould cleanup placeholder user when invite is revoked
[22m[39mCleaned up placeholder user 9f791f99-5445-4246-887b-888b5a171c19 (no pending invites or memberships)

{"level":30,"time":1768079901674,"env":"test","module":"email-queue","jobId":"684b6d59-305a-4880-b109-5ac97d671e5c","to":"test-1768079901090-5o3no@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768079901689,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079901735,"env":"test","module":"auth-routes","userId":"87d42d74-4e4f-42d8-80cc-933fb47be125","email":"test-1768079901090-5o3no@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould list all trusted devices
[22m[39m[TEST UTILS] MFA Secret verified for 804c0dd0b9f49db579f0589edb768e47

{"level":50,"time":1768079901802,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079902025,"env":"test","module":"user-credentials-repository","userId":"uhIKgV6q93wonDlZm-F_C","msg":"User credentials created"}
{"level":50,"time":1768079902030,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079902052,"env":"test","module":"user-credentials-repository","userId":"7dfLTZ5f74JiEkKoV5DMr","msg":"User credentials created"}
{"level":50,"time":1768079902080,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079902325,"env":"test","module":"auth-routes","userId":"ee9f5a1d2047d46c3e30945e87fd28de","msg":"User logged in successfully"}
{"level":30,"time":1768079902379,"env":"test","module":"audit-log-service","userId":"ee9f5a1d2047d46c3e30945e87fd28de","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079902379,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079902380,"env":"test","module":"user-credentials-repository","userId":"vOjeL3SeZjT4sr1jvIrdw","msg":"User credentials created"}
{"level":40,"time":1768079902493,"env":"test","module":"mfa-service","userId":"804c0dd0b9f49db579f0589edb768e47","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079902493,"env":"test","module":"auth-routes","userId":"804c0dd0b9f49db579f0589edb768e47","msg":"MFA verification failed during login"}
{"level":50,"time":1768079902497,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079902702,"env":"test","module":"user-credentials-repository","userId":"Rf0K4LbK1rW2w4evXWJ18","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079902714,"env":"test","module":"auth-routes","userId":"vOjeL3SeZjT4sr1jvIrdw","msg":"All other sessions revoked"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768079902748,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079902770,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079902769,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:70:7 {
  length: 336,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(919ad679-279f-41f1-b98e-ae26532d11b8) is still referenced from table "workflows".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflows',
  column: undefined,
  dataType: undefined,
  constraint: 'workflows_creator_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

{"level":30,"time":1768079902773,"env":"test","module":"audit-log-service","userId":"vOjeL3SeZjT4sr1jvIrdw","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079902775,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mÎ“Â¥Â»[39m tests/integration/organizations-audit-fixes.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10281[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should cascade ownership to workflow runs when project is transferred [33m 1156[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent double-acceptance via transaction [33m 1197[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not create invite if email fails [33m 729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow re-invite after invite expires [33m 1469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow last admin to delete empty organization [33m 752[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent deletion if org owns assets[39m[33m 1048[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should cleanup placeholder user when invite is revoked [33m 1575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should fail fast on non-existent org [33m 646[2mms[22m[39m
{"level":40,"time":1768079902880,"env":"test","module":"mfa-service","userId":"804c0dd0b9f49db579f0589edb768e47","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079902880,"env":"test","module":"auth-routes","userId":"804c0dd0b9f49db579f0589edb768e47","msg":"MFA verification failed during login"}
{"level":50,"time":1768079902885,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079903106,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079903111,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079903148,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079903166,"env":"test","module":"user-credentials-repository","userId":"jEkmumtwSO-1GvX2jn8W_","msg":"User credentials created"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1768079903268,"env":"test","module":"mfa-service","userId":"804c0dd0b9f49db579f0589edb768e47","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079903268,"env":"test","module":"auth-routes","userId":"804c0dd0b9f49db579f0589edb768e47","msg":"MFA verification failed during login"}
{"level":50,"time":1768079903273,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079903299,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/auth/protected.routes.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:190:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1768079903319,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1768079903337,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079903338,"env":"test","module":"user-credentials-repository","userId":"1pf483pAcVBRS8H0CbnDZ","msg":"User credentials created"}
{"level":30,"time":1768079903327,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079903327,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079903331,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079903337,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079903337,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079903337,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079903337,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079903385,"env":"test","module":"auth-routes","userId":"jEkmumtwSO-1GvX2jn8W_","msg":"All other sessions revoked"}
{"level":30,"time":1768079903435,"env":"test","module":"audit-log-service","userId":"jEkmumtwSO-1GvX2jn8W_","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
stderr | tests/integration/api.templates-runs.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:280:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 307,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_auto_number, 2950 2950 23, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1768079903472,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079903474,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079903488,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079903491,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079903494,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts[2m > [22m[2mTemplates and Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079903479,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079903480,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079903485,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079903490,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079903490,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079903491,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079903491,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079903497,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079903504,"env":"test","module":"auth-routes","userId":"020ab89eadf28dd998332a61db5fbf07","msg":"User logged in successfully"}
{"level":30,"time":1768079903482,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079903483,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079903489,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079903494,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079903494,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079903494,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079903494,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079903510,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079903497,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079903498,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079903505,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079903510,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079903510,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079903510,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079903510,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079903519,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079903507,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079903508,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079903512,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079903519,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079903519,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079903519,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079903519,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079903562,"env":"test","module":"audit-log-service","userId":"020ab89eadf28dd998332a61db5fbf07","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079903697,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":50,"time":1768079903864,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079903870,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079903872,"env":"test","module":"user-credentials-repository","userId":"Ma7A8U7YoUi_M32dscI9x","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests
[22m[39mError cleaning up table: Error: Table not found
    at DatavaultTablesService.verifyTenantOwnership (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:150:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablesService.deleteTable (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:290:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/datavault.autonumber.test.ts:90:9

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079904026,"env":"test","module":"user-credentials-repository","userId":"e0878ed4-038c-4930-8ca9-c9affd0bc4b0","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.autonumber.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 11448[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate basic autonumber without prefix [33m 1206[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate autonumber with prefix [33m 1157[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate autonumber with yearly reset format [33m 1180[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should be atomic and prevent race conditions [33m 807[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should prevent manual updates to autonumber values [33m 1582[2mms[22m[39m
{"level":30,"time":1768079904055,"env":"test","module":"user-credentials-repository","userId":"1f2cd533-0d60-47ee-91c0-4bcd1592ade5","msg":"User credentials created"}
{"level":30,"time":1768079904061,"env":"test","module":"user-credentials-repository","userId":"6ee029c6-06ab-4b25-8ddb-357df147fa01","msg":"User credentials created"}
{"level":30,"time":1768079904067,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079904089,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079904075,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079904076,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079904082,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079904088,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079904088,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079904088,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079904088,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079904119,"env":"test","module":"user-credentials-repository","userId":"f06ee2ef-5746-4d0f-b5aa-09568c7f3c3d","msg":"User credentials created"}
{"level":30,"time":1768079904120,"env":"test","module":"user-credentials-repository","userId":"9FxhAUeoaSfOzpopoS__N","msg":"User credentials created"}
{"level":30,"time":1768079904139,"env":"test","module":"email-queue","jobId":"3ba9ed6c-f4e5-4113-9a6e-333c689ff770","to":"test-Hd1GSrzJliuBM6XvqM1Qr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079904169,"env":"test","module":"email-queue","jobId":"9e67d11f-f491-4614-91c2-699b034007af","to":"test-5cUbhQm9-h2wjMUCH_NjY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079904170,"env":"test","module":"mfa-service","userId":"020ab89eadf28dd998332a61db5fbf07","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768079904170,"env":"test","module":"mfa-service","userId":"020ab89eadf28dd998332a61db5fbf07","msg":"Generated TOTP secret"}
{"level":30,"time":1768079904170,"env":"test","module":"auth-routes","userId":"020ab89eadf28dd998332a61db5fbf07","msg":"MFA setup initiated"}
{"level":30,"time":1768079904178,"env":"test","module":"email-queue","jobId":"f8264206-fc32-4b5a-b569-718ffe7dcae4","to":"test-9I4A72KuH7R2tRNQeWz5X@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079904198,"env":"test","module":"user-credentials-repository","userId":"d53cf1bd-49bc-4066-8080-99246550df2b","msg":"User credentials created"}
{"level":30,"time":1768079904203,"env":"test","module":"auth-routes","userId":"e0878ed4-038c-4930-8ca9-c9affd0bc4b0","email":"test-Hd1GSrzJliuBM6XvqM1Qr@example.com","msg":"User registered"}
{"level":30,"time":1768079904229,"env":"test","module":"auth-routes","userId":"1f2cd533-0d60-47ee-91c0-4bcd1592ade5","email":"test-5cUbhQm9-h2wjMUCH_NjY@example.com","msg":"User registered"}
{"level":30,"time":1768079904229,"env":"test","module":"email-queue","jobId":"db2995e2-31ef-47d2-91eb-11bc2e93339a","to":"test-v20oIJsMHF2NNsnii1E50@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079904234,"env":"test","module":"auth-routes","userId":"6ee029c6-06ab-4b25-8ddb-357df147fa01","email":"test-9I4A72KuH7R2tRNQeWz5X@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould mark current device
[22m[39m[TEST UTILS] MFA Secret verified for 01606ef6f0829d712cb628d9648968fb

{"level":30,"time":1768079904288,"env":"test","module":"auth-routes","userId":"f06ee2ef-5746-4d0f-b5aa-09568c7f3c3d","email":"test-v20oIJsMHF2NNsnii1E50@example.com","msg":"User registered"}
{"level":30,"time":1768079904307,"env":"test","module":"email-queue","jobId":"8115ceb8-7db4-4f1f-88ce-2458b253b693","to":"test-V_8JxSBV-FPT_pMWcupdH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079904338,"env":"test","module":"user-credentials-repository","userId":"RZsVEXfl2u1iNojxhebGy","msg":"User credentials created"}
{"level":50,"time":1768079904342,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079904367,"env":"test","module":"auth-routes","userId":"d53cf1bd-49bc-4066-8080-99246550df2b","email":"test-V_8JxSBV-FPT_pMWcupdH@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1768079904658,"env":"test","module":"user-credentials-repository","userId":"_ZFRKByLa3EeE6CfXjGE3","msg":"User credentials created"}
{"level":50,"time":1768079904688,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079904691,"env":"test","module":"user-credentials-repository","userId":"854115b8-d30b-48c3-8db5-f1b0f44462e0","msg":"User credentials created"}
{"level":30,"time":1768079904729,"env":"test","module":"user-credentials-repository","userId":"r8O3RnW-R1l5u1bu68mAT","msg":"User credentials created"}
{"level":30,"time":1768079904805,"env":"test","module":"email-queue","jobId":"49a0ae43-cb08-465c-8701-574d9f7a9371","to":"test-docx-JDGDl-sE8TebNPRgZKMG3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768079904826,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079904826,"env":"test","module":"user-credentials-repository","userId":"34385dbb-d0b9-4bae-80ed-11085fde392d","msg":"User credentials created"}
{"level":30,"time":1768079904839,"env":"test","module":"auth-routes","userId":"r8O3RnW-R1l5u1bu68mAT","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":50,"time":1768079904853,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079904867,"env":"test","module":"auth-routes","userId":"854115b8-d30b-48c3-8db5-f1b0f44462e0","email":"test-docx-JDGDl-sE8TebNPRgZKMG3@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould require MFA for enabled users
[22m[39m[TEST UTILS] MFA Secret verified for da2e05ae0e29a555661c9082e4818962

{"level":30,"time":1768079904929,"env":"test","module":"email-queue","jobId":"b9508194-7401-408f-a8be-056e53814556","to":"session-test-Twxy2Nf0JiO76ZdtC3bP1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079904954,"env":"test","module":"user-credentials-repository","userId":"ce3c4c2f-8fa3-48e0-a0c5-ec3e9a92f922","msg":"User credentials created"}
{"level":30,"time":1768079904980,"env":"test","module":"auth-routes","userId":"34385dbb-d0b9-4bae-80ed-11085fde392d","email":"session-test-Twxy2Nf0JiO76ZdtC3bP1@example.com","msg":"User registered"}
{"level":50,"time":1768079904999,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079905001,"env":"test","module":"mfa-service","userId":"01606ef6f0829d712cb628d9648968fb","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079905001,"env":"test","module":"auth-routes","userId":"01606ef6f0829d712cb628d9648968fb","msg":"MFA verification failed during login"}
{"level":50,"time":1768079905007,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079905011,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079905029,"env":"test","module":"user-credentials-repository","userId":"0ed0ba5b-ce02-4f98-a37d-79c108448bb5","msg":"User credentials created"}
{"level":30,"time":1768079905059,"env":"test","module":"email-queue","jobId":"398a1a2f-eb94-42c6-b91e-2f4c3717d0ff","to":"protected-test-sOEdnxQhmkU6o-03OW-z4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079905112,"env":"test","module":"auth-routes","userId":"ce3c4c2f-8fa3-48e0-a0c5-ec3e9a92f922","email":"protected-test-sOEdnxQhmkU6o-03OW-z4@example.com","msg":"User registered"}
{"level":30,"time":1768079905131,"env":"test","module":"user-credentials-repository","userId":"ulslxxLUjHCF-F9Rh01Yr","msg":"User credentials created"}
{"level":30,"time":1768079905150,"env":"test","module":"email-queue","jobId":"da684b43-7e8d-4892-b8d7-8fa4546bfeaa","to":"middleware-test-YKTbDXe9ar0GW8AmFsSqj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079905208,"env":"test","module":"auth-routes","userId":"0ed0ba5b-ce02-4f98-a37d-79c108448bb5","email":"middleware-test-YKTbDXe9ar0GW8AmFsSqj@example.com","msg":"User registered"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Deprecated method ".compile", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.compile (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:475:7)
    at TemplateScanner.validateBuffer (C:/Users/scoot/poll/VaultLogic/server/services/document/TemplateScanner.ts:190:13)
    at TemplateScanner.scanAndFix (C:/Users/scoot/poll/VaultLogic/server/services/document/TemplateScanner.ts:69:22)
    at C:/Users/scoot/poll/VaultLogic/server/api/templates.ts:328:52
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768079905253,"env":"test","module":"user-credentials-repository","userId":"W6nasSPOfbT5oOw9vm8lC","msg":"User credentials created"}
{"level":50,"time":1768079905263,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079905269,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079905291,"env":"test","module":"user-credentials-repository","userId":"3a42c927-27fe-4688-aa1c-95faeb1f5436","msg":"User credentials created"}
{"level":30,"time":1768079905369,"env":"test","module":"auth-routes","userId":"W6nasSPOfbT5oOw9vm8lC","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":50,"time":1768079905369,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079905394,"env":"test","module":"email-queue","jobId":"09aa6e5a-a73f-43ad-95f8-7428baced36f","to":"viewer-NpfTkx5tEbruuqNRLQcId@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768079905444,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079905446,"env":"test","module":"auth-routes","userId":"3a42c927-27fe-4688-aa1c-95faeb1f5436","email":"viewer-NpfTkx5tEbruuqNRLQcId@example.com","msg":"User registered"}
{"level":50,"time":1768079905446,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079905452,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079905505,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079905528,"env":"test","module":"auth-routes","userId":"W6nasSPOfbT5oOw9vm8lC","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":50,"time":1768079905544,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079905564,"env":"test","module":"rbac-middleware","userId":"3a42c927-27fe-4688-aa1c-95faeb1f5436","userRole":"viewer","permission":"workflow:create","path":"/projects/d075f244-c18a-497a-9ffd-eba80c46df0e/workflows","msg":"Permission denied"}
{"level":50,"time":1768079905672,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079905729,"env":"test","module":"user-credentials-repository","userId":"9dh-w7OmcDIbG0e37maj2","msg":"User credentials created"}
{"level":30,"time":1768079905803,"env":"test","module":"user-credentials-repository","userId":"815a3a4b-ada5-40ab-9eab-def4454da3a8","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":50,"time":1768079905839,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"qpdf --decrypt \"C:\\Users\\scoot\\AppData\\Local\\Temp\\locked-1768079905749.pdf\" \"C:\\Users\\scoot\\AppData\\Local\\Temp\\unlocked-1768079905749.pdf\"","stdout":"","stderr":"'qpdf' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"Failed to unlock PDF with qpdf"}
{"level":40,"time":1768079905839,"env":"test","msg":"Returning original PDF buffer due to unlock failure"}
{"level":50,"time":1768079905841,"env":"test","error":{},"msg":"Failed to extract PDF fields"}
{"level":50,"time":1768079905842,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF processing failed"}
{"level":50,"time":1768079905842,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"fb2e8134-235a-4252-9ac9-64b887b6bcf2"},"file":{"fieldname":"file","originalname":"test.pdf","encoding":"7bit","mimetype":"application/pdf","buffer":{"type":"Buffer","data":[37,80,68,70]},"size":4},"msg":"Error creating template"}
{"level":50,"time":1768079905848,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079905915,"env":"test","module":"email-queue","jobId":"52c78794-5c0f-4652-ab3f-277c69f7462e","to":"session-test-MRJLcyfFYLUDZ8vxXlT_q@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079905939,"env":"test","module":"user-credentials-repository","userId":"57621100-f3ec-498a-b6a4-48df20911504","msg":"User credentials created"}
{"level":30,"time":1768079905941,"env":"test","module":"user-credentials-repository","userId":"PG_tN17l5BaBe3C2V75tz","msg":"User credentials created"}
{"level":50,"time":1768079905960,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"fb2e8134-235a-4252-9ac9-64b887b6bcf2"},"msg":"Error creating template"}
{"level":30,"time":1768079905973,"env":"test","module":"auth-routes","userId":"815a3a4b-ada5-40ab-9eab-def4454da3a8","email":"session-test-MRJLcyfFYLUDZ8vxXlT_q@example.com","msg":"User registered"}
{"level":30,"time":1768079905980,"env":"test","module":"user-credentials-repository","userId":"1dad00f5-77a5-4b0a-bc9f-54b052697a1a","msg":"User credentials created"}
{"level":30,"time":1768079906043,"env":"test","module":"email-queue","jobId":"85595c5f-d34d-425a-a83c-376ab7d2e23a","to":"protected-test-c-rA805ZyLNz9EttG6kV5@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude revoked devices
[22m[39m[TEST UTILS] MFA Secret verified for e7e9a4164da856ea4516ab75f920d37c

{"level":30,"time":1768079906056,"env":"test","module":"auth-routes","userId":"PG_tN17l5BaBe3C2V75tz","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1768079906089,"env":"test","module":"email-queue","jobId":"39e3e73b-3cf6-4dc6-954f-2b8971a8d47d","to":"middleware-test-PcvfbRDBNBZx1Qs3jfcNh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079906100,"env":"test","module":"auth-routes","userId":"57621100-f3ec-498a-b6a4-48df20911504","email":"protected-test-c-rA805ZyLNz9EttG6kV5@example.com","msg":"User registered"}
{"level":30,"time":1768079906145,"env":"test","module":"auth-routes","userId":"1dad00f5-77a5-4b0a-bc9f-54b052697a1a","email":"middleware-test-PcvfbRDBNBZx1Qs3jfcNh@example.com","msg":"User registered"}
{"level":50,"time":1768079906342,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079906394,"env":"test","module":"user-credentials-repository","userId":"VXYGhw787ZyXOi5D1Yvdb","msg":"User credentials created"}
{"level":30,"time":1768079906450,"env":"test","module":"user-credentials-repository","userId":"yBTCpGNKQVDSn42-knD7k","msg":"User credentials created"}
{"level":50,"time":1768079906470,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079906473,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould complete MFA login with valid TOTP
[22m[39m[TEST UTILS] MFA Secret verified for d7de6ad06a29b74ff3eb5c39d48fa35d

{"level":30,"time":1768079906561,"env":"test","module":"auth-routes","userId":"yBTCpGNKQVDSn42-knD7k","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1768079906629,"env":"test","module":"email-queue","jobId":"4c720348-5bb8-4f52-abc0-374b796e0990","to":"test-1768079905980-exibe8@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079906629,"env":"test","module":"auth-service","email":"test-1768079905980-exibe8@example.com","msg":"Password reset email sent"}
{"level":50,"time":1768079906681,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079906778,"env":"test","module":"user-credentials-repository","userId":"e0aac198-13c5-4e92-9d09-7a05d6f1b332","msg":"User credentials created"}
{"level":40,"time":1768079906792,"env":"test","module":"mfa-service","userId":"e7e9a4164da856ea4516ab75f920d37c","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079906792,"env":"test","module":"auth-routes","userId":"e7e9a4164da856ea4516ab75f920d37c","msg":"MFA verification failed during login"}
{"level":50,"time":1768079906796,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079906854,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079906890,"env":"test","module":"user-credentials-repository","userId":"660d0a0d-6095-4350-a90c-15d9ef4bfb58","msg":"User credentials created"}
{"level":30,"time":1768079906889,"env":"test","module":"email-queue","jobId":"7e2e4e63-b955-49b1-b91c-8d73c621c843","to":"session-test-4Eusu846N3zP2AxNJowGq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079906893,"env":"test","module":"user-credentials-repository","userId":"7b054541-3b15-453c-ac13-6a7dc1c7738c","msg":"User credentials created"}
{"level":30,"time":1768079906921,"env":"test","module":"user-credentials-repository","userId":"WORe5APhYuRQwLhStXd6c","msg":"User credentials created"}
{"level":50,"time":1768079906936,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079906945,"env":"test","module":"auth-routes","userId":"e0aac198-13c5-4e92-9d09-7a05d6f1b332","email":"session-test-4Eusu846N3zP2AxNJowGq@example.com","msg":"User registered"}
{"level":30,"time":1768079906960,"env":"test","module":"email-queue","jobId":"8f325960-3a8b-4d70-a620-1d42befd2d26","to":"test-1768079905980-exibe8@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079906960,"env":"test","module":"auth-service","email":"test-1768079905980-exibe8@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768079906994,"env":"test","module":"email-queue","jobId":"65fc7921-8844-4ce5-a55c-36a941f6dc78","to":"protected-test-WEuCXS88wjD6B6TsIYa0l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079907002,"env":"test","module":"email-queue","jobId":"b8c6b224-2d3a-4ad0-ad33-adec5953c540","to":"middleware-test-DyOmyvfssRilp5dWoZrHA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079907048,"env":"test","module":"auth-routes","userId":"7b054541-3b15-453c-ac13-6a7dc1c7738c","email":"protected-test-WEuCXS88wjD6B6TsIYa0l@example.com","msg":"User registered"}
{"level":30,"time":1768079907056,"env":"test","module":"auth-routes","userId":"660d0a0d-6095-4350-a90c-15d9ef4bfb58","email":"middleware-test-DyOmyvfssRilp5dWoZrHA@example.com","msg":"User registered"}
{"level":50,"time":1768079907068,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079907099,"env":"test","module":"user-credentials-repository","userId":"3a54b814-d2f0-4ee3-a4d7-0c70111dfc8f","msg":"User credentials created"}
{"level":50,"time":1768079907203,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079907207,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079907211,"env":"test","module":"email-queue","jobId":"0b73ab24-71ce-4758-b74a-1f9d491d41e7","to":"test-1768079906682-5pvvxp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079907264,"env":"test","module":"auth-routes","userId":"3a54b814-d2f0-4ee3-a4d7-0c70111dfc8f","email":"test-1768079906682-5pvvxp@example.com","msg":"User registered"}
{"level":30,"time":1768079907344,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1768079907359,"env":"test","module":"user-credentials-repository","error":{},"userId":"d600a3fcf2619a8f1acd038fbc4329a9","msg":"Failed to update user password"}
{"level":50,"time":1768079907359,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":30,"time":1768079907381,"env":"test","module":"user-credentials-repository","userId":"DR_Fy7xOlceii7xUE0TYk","msg":"User credentials created"}
{"level":50,"time":1768079907381,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079907414,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079907539,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079907585,"env":"test","module":"auth-routes","userId":"e0aac198-13c5-4e92-9d09-7a05d6f1b332","msg":"User logged in successfully"}
{"level":30,"time":1768079907637,"env":"test","module":"audit-log-service","userId":"e0aac198-13c5-4e92-9d09-7a05d6f1b332","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079907733,"env":"test","module":"user-credentials-repository","userId":"7_BaNB1YLV9OxHcd9Q7qI","msg":"User credentials created"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude expired devices
[22m[39m[TEST UTILS] MFA Secret verified for 384f74f0166940599335ccec1a8b9461

{"level":30,"time":1768079907788,"env":"test","module":"user-credentials-repository","userId":"e2817353-d733-4429-a9cf-a0ab2c1dcfa7","msg":"User credentials created"}
{"level":30,"time":1768079907804,"env":"test","module":"user-credentials-repository","userId":"97c04178-26a8-42b0-b446-763bef7f50ed","msg":"User credentials created"}
{"level":50,"time":1768079907897,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079907902,"env":"test","module":"email-queue","jobId":"bf7c5abe-fc77-440e-a2e8-d5e4cfddfbde","to":"middleware-test-R_G9ZsTBQzCzrzM4QZG51@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079907908,"env":"test","module":"email-queue","jobId":"6ce93afc-06f1-48c7-ad9e-ce633452c902","to":"protected-test-UADQ4fFP2lhlvQjRCGlY7@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079907960,"env":"test","module":"auth-routes","userId":"97c04178-26a8-42b0-b446-763bef7f50ed","email":"protected-test-UADQ4fFP2lhlvQjRCGlY7@example.com","msg":"User registered"}
{"level":30,"time":1768079907961,"env":"test","module":"auth-routes","userId":"e2817353-d733-4429-a9cf-a0ab2c1dcfa7","email":"middleware-test-R_G9ZsTBQzCzrzM4QZG51@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould reject invalid TOTP during login
[22m[39m[TEST UTILS] MFA Secret verified for db276c81e4586674cf8b2b547e7bcbcc

stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > POST /api/workflows/:id/run - Template Node Execution > should execute workflow with template node and generate DOCX
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

{"level":30,"time":1768079908191,"env":"test","module":"user-credentials-repository","userId":"VjgnLF6e9VhXovOkXYhm8","msg":"User credentials created"}
{"level":50,"time":1768079908272,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079908287,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079908302,"env":"test","module":"user-credentials-repository","userId":"59a532a6-a421-4b95-adaa-6b7f998270f4","msg":"User credentials created"}
{"level":50,"time":1768079908329,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079908337,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079908371,"env":"test","workflowId":"6329cb58-6997-4bf2-99c1-c7f8f8191b5b","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":30,"time":1768079908408,"env":"test","module":"email-queue","jobId":"aaf8e871-92d7-4cef-8187-e4d6b50487b9","to":"session-test-RwqLYWB0pTQbWARoD4Uuf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768079908449,"env":"test","module":"mfa-service","userId":"384f74f0166940599335ccec1a8b9461","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079908449,"env":"test","module":"auth-routes","userId":"384f74f0166940599335ccec1a8b9461","msg":"MFA verification failed during login"}
{"level":50,"time":1768079908454,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079908461,"env":"test","module":"auth-routes","userId":"59a532a6-a421-4b95-adaa-6b7f998270f4","email":"session-test-RwqLYWB0pTQbWARoD4Uuf@example.com","msg":"User registered"}
{"level":50,"time":1768079908512,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079908539,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079908641,"env":"test","module":"user-credentials-repository","userId":"KiZyxgo71MU_L3sd6vPUo","msg":"User credentials created"}
{"level":40,"time":1768079908658,"env":"test","module":"mfa-service","userId":"db276c81e4586674cf8b2b547e7bcbcc","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079908658,"env":"test","module":"auth-routes","userId":"db276c81e4586674cf8b2b547e7bcbcc","msg":"MFA verification failed during login"}
{"level":30,"time":1768079908688,"env":"test","module":"auth-routes","userId":"6d7edb5fba1b406eb3a458f3d83e5309","msg":"User logged in successfully"}
{"level":30,"time":1768079908701,"env":"test","module":"user-credentials-repository","userId":"a551ec35-bf00-4146-9cf2-93a9c4aac6c8","msg":"User credentials created"}
{"level":30,"time":1768079908746,"env":"test","module":"user-credentials-repository","userId":"009c1072-8f01-47a9-ad67-fe8ddd0aacfd","msg":"User credentials created"}
{"level":30,"time":1768079908747,"env":"test","module":"audit-log-service","userId":"6d7edb5fba1b406eb3a458f3d83e5309","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079908813,"env":"test","module":"email-queue","jobId":"86a1d355-c8e0-4311-87a7-b33abdf84249","to":"middleware-test-WPBGbKep_sv05Y1sdpCeA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768079908852,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079908857,"env":"test","module":"email-queue","jobId":"6233ed8b-2108-4e3d-afe4-374e818c7d89","to":"protected-test-q7Qq5dEbXWXMg-c7VG0Mc@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079908872,"env":"test","module":"auth-routes","userId":"a551ec35-bf00-4146-9cf2-93a9c4aac6c8","email":"middleware-test-WPBGbKep_sv05Y1sdpCeA@example.com","msg":"User registered"}
{"level":30,"time":1768079908911,"env":"test","module":"auth-routes","userId":"009c1072-8f01-47a9-ad67-fe8ddd0aacfd","email":"protected-test-q7Qq5dEbXWXMg-c7VG0Mc@example.com","msg":"User registered"}
{"level":40,"time":1768079908913,"env":"test","module":"auth-service","tokenHash":"73e64a3f9bd5a3af15e16f5cfc9d884994ee323136579f04c90f8063939a00e9","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768079908958,"env":"test","module":"email-queue","jobId":"023daf25-1a75-435b-96fc-3c189bdcacd4","to":"test-1768079907788-f0jzw@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079908958,"env":"test","module":"auth-service","email":"test-1768079907788-f0jzw@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.sessions.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 14023[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list all active sessions for current user [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark current session as current [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array when user has no active sessions [33m 492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include expired sessions [33m 497[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include revoked sessions [33m 586[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should parse device name from user agent [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke a specific session [33m 647[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent session [33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent revoking another user's session [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all sessions except current[39m[33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all trusted devices [33m 664[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 when no active session found [33m 385[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 466[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should mark current device as trusted [33m 548[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should update existing trusted device expiry[39m[33m 696[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should list all trusted devices[39m[33m 472[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should not include revoked devices [33m 504[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should revoke a trusted device[39m[33m 472[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent device [33m 353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track IP address for sessions [33m 454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track user agent for sessions [33m 451[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update lastUsedAt on token refresh[39m[33m 676[2mms[22m[39m
{"level":50,"time":1768079909087,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079909223,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079909258,"env":"test","module":"user-credentials-repository","userId":"07fbe0ef-9e33-49b9-8b97-f466ca8e2f36","msg":"User credentials created"}
{"level":50,"time":1768079909292,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079909336,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079909341,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079909356,"env":"test","module":"user-credentials-repository","error":{},"userId":"6d7edb5fba1b406eb3a458f3d83e5309","msg":"Failed to update user password"}
{"level":50,"time":1768079909356,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":30,"time":1768079909375,"env":"test","module":"email-queue","jobId":"a19db393-1357-414e-abcf-124145c03d40","to":"session-test-hWa89OsoBIgUjCxV_AuuF@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079909425,"env":"test","module":"auth-routes","userId":"07fbe0ef-9e33-49b9-8b97-f466ca8e2f36","email":"session-test-hWa89OsoBIgUjCxV_AuuF@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould accept TOTP codes within 60-second window
[22m[39m[TEST UTILS] MFA Secret verified for 7124aaa60dcc04c8790f067b70fad153

{"level":30,"time":1768079909631,"env":"test","module":"user-credentials-repository","userId":"7629c0f1-13c7-404a-9de7-d8c3b37e0fbf","msg":"User credentials created"}
{"level":30,"time":1768079909687,"env":"test","module":"user-credentials-repository","userId":"159ccb2d-5be9-4bb1-9458-c5548f37df60","msg":"User credentials created"}
{"level":30,"time":1768079909745,"env":"test","module":"email-queue","jobId":"c804877b-fb77-4784-ba9c-f7db1163fc48","to":"middleware-test-8X-vyCP2SxIOy3xDwWvG7@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079909793,"env":"test","module":"email-queue","jobId":"cf45c324-08b1-4f9a-bfb5-35f072b812c6","to":"protected-test-tUmxc5Yq5rHA507EjQm0A@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768079909793,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079909807,"env":"test","module":"auth-routes","userId":"7629c0f1-13c7-404a-9de7-d8c3b37e0fbf","email":"middleware-test-8X-vyCP2SxIOy3xDwWvG7@example.com","msg":"User registered"}
{"level":30,"time":1768079909846,"env":"test","module":"auth-routes","userId":"159ccb2d-5be9-4bb1-9458-c5548f37df60","email":"protected-test-tUmxc5Yq5rHA507EjQm0A@example.com","msg":"User registered"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > POST /api/workflows/:id/run - Template Node Execution > should handle missing template data gracefully
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

{"level":30,"time":1768079909980,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"mode":"create","tableId":"923679ec-f273-447d-b95c-6f9ecef92d46","dataSourceId":"a50dc284-619b-4eb1-bbd4-9920bacc6ddd","columnMappings":[{"value":"{{42132fcc-fbdb-4b65-8bf0-392b4c17f272}}","columnId":"80896b1a-d26c-48ca-bde4-489ea9899619"}]},"tableId":"923679ec-f273-447d-b95c-6f9ecef92d46","preview":false,"msg":"Starting write execution"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768079910146,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079910147,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079910193,"env":"test","module":"user-credentials-repository","userId":"3ee23991-2f87-42d1-99b8-8d5b16cbbc45","msg":"User credentials created"}
{"level":50,"time":1768079910240,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079910260,"env":"test","module":"mfa-service","userId":"7124aaa60dcc04c8790f067b70fad153","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079910260,"env":"test","module":"auth-routes","userId":"7124aaa60dcc04c8790f067b70fad153","msg":"MFA verification failed during login"}
{"level":30,"time":1768079910303,"env":"test","module":"email-queue","jobId":"77ec7cad-c622-456e-8cf0-083a218b717a","to":"session-test-XMXJpnJrOf-10G0Lq-E-K@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079910362,"env":"test","module":"auth-routes","userId":"3ee23991-2f87-42d1-99b8-8d5b16cbbc45","email":"session-test-XMXJpnJrOf-10G0Lq-E-K@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768079910563,"env":"test","module":"user-credentials-repository","userId":"72f85a5d-d427-4996-b743-cdd08eb1f42f","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/integration/api.templates-runs.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 7666[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create template with file upload[32m 185[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject non-docx files[39m[32m 207[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject without file[32m 116[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list templates [33m 339[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should get template by ID[32m 286[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should extract placeholders[32m 284[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update template name [33m 342[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should delete template [33m 444[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should execute workflow[32m 293[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include logs in debug mode[32m 275[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject without required permission[39m[32m 7[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list runs [33m 420[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should filter by workflowId [33m 396[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get run by ID [33m 476[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get run logs [33m 522[2mms[22m[39m
{"level":30,"time":1768079910641,"env":"test","module":"user-credentials-repository","userId":"a3780852-a115-4798-9319-bc86db0870df","msg":"User credentials created"}
{"level":30,"time":1768079910677,"env":"test","module":"email-queue","jobId":"3f52ddba-f411-414c-a4bc-4851ca679989","to":"middleware-test-TQSLvRsxpXGcDzdV9U5k6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould return 404 for non-existent device
[22m[39m[TEST UTILS] MFA Secret verified for ccb332ee55d391cc23bdf6990a61db07

{"level":30,"time":1768079910731,"env":"test","module":"auth-routes","userId":"72f85a5d-d427-4996-b743-cdd08eb1f42f","email":"middleware-test-TQSLvRsxpXGcDzdV9U5k6@example.com","msg":"User registered"}
{"level":30,"time":1768079910755,"env":"test","module":"email-queue","jobId":"17619e21-2f72-4c6a-9d55-697993391fd1","to":"protected-test-BZh3TbTIJKDTOiSN5qBB0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768079910773,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079910809,"env":"test","module":"auth-routes","userId":"a3780852-a115-4798-9319-bc86db0870df","email":"protected-test-BZh3TbTIJKDTOiSN5qBB0@example.com","msg":"User registered"}
{"level":30,"time":1768079910935,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079910947,"env":"test","module":"auth-routes","userId":"b6f456d8deddb75ef1540e10d76d9b6a","msg":"User logged in successfully"}
{"level":30,"time":1768079910955,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079910943,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079910944,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079910949,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079910955,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079910955,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079910955,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079910955,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079911002,"env":"test","module":"audit-log-service","userId":"b6f456d8deddb75ef1540e10d76d9b6a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079911036,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079911042,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079911047,"env":"test","module":"auth-routes","userId":"3ee23991-2f87-42d1-99b8-8d5b16cbbc45","msg":"User logged in successfully"}
{"level":50,"time":1768079911053,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079911071,"env":"test","workflowId":"6cfcfd7a-051d-4010-b261-6fca6912b496","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":30,"time":1768079911109,"env":"test","module":"audit-log-service","userId":"3ee23991-2f87-42d1-99b8-8d5b16cbbc45","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079911184,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > GET /api/runs/:id/download - Download Generated DOCX
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

{"level":50,"time":1768079911281,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079911352,"env":"test","module":"auth-service","userId":"b6f456d8deddb75ef1540e10d76d9b6a","tokenHash":"6795dc812809d0670cff94c76ad9141a04b032c7bbab47e426be94b820e3157f","msg":"Security: REUSED REFRESH TOKEN DETECTED (Concurrent). Revoking all sessions."}
{"level":50,"time":1768079911377,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079911396,"env":"test","module":"mfa-service","userId":"ccb332ee55d391cc23bdf6990a61db07","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079911396,"env":"test","module":"auth-routes","userId":"ccb332ee55d391cc23bdf6990a61db07","msg":"MFA verification failed during login"}
{"level":50,"time":1768079911401,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079911577,"env":"test","module":"user-credentials-repository","userId":"8539c5f0-0185-4012-91c6-f8bc5947631b","msg":"User credentials created"}
{"level":30,"time":1768079911604,"env":"test","module":"user-credentials-repository","userId":"55d14d36-9f24-47aa-a96b-aaa0b0e4f059","msg":"User credentials created"}
{"level":30,"time":1768079911614,"env":"test","module":"auth-routes","userId":"87a66cfc31f8889541753fc8e0f9cca1","msg":"User logged in successfully"}
{"level":30,"time":1768079911674,"env":"test","module":"audit-log-service","userId":"87a66cfc31f8889541753fc8e0f9cca1","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079911688,"env":"test","module":"email-queue","jobId":"63002fcd-9cf4-4a94-bdac-14b4b60c9db4","to":"middleware-test-4xqmPr7Vvsne4uzljqX-V@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079911713,"env":"test","module":"user-credentials-repository","userId":"618af7b8-ecbf-4b47-977d-c13acc2b4f8f","msg":"User credentials created"}
{"level":30,"time":1768079911714,"env":"test","module":"email-queue","jobId":"c94dca28-c8f0-4466-9f74-c092b6f981b7","to":"test-SIh0BIBvxUgXglXIp0X8u@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079911741,"env":"test","module":"auth-routes","userId":"8539c5f0-0185-4012-91c6-f8bc5947631b","email":"middleware-test-4xqmPr7Vvsne4uzljqX-V@example.com","msg":"User registered"}
{"level":30,"time":1768079911778,"env":"test","module":"auth-routes","userId":"55d14d36-9f24-47aa-a96b-aaa0b0e4f059","email":"test-SIh0BIBvxUgXglXIp0X8u@example.com","msg":"User registered"}
{"level":30,"time":1768079911827,"env":"test","module":"email-queue","jobId":"f0fb9a81-35e3-4908-82a5-4f41a6e547fd","to":"protected-test-YloaUq9JCCOBqZIHaWW6l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079911834,"env":"test","module":"user-credentials-repository","userId":"3eb0f898-2a92-4280-bd22-a2083c0b0fac","msg":"User credentials created"}
{"level":30,"time":1768079911880,"env":"test","module":"auth-routes","userId":"618af7b8-ecbf-4b47-977d-c13acc2b4f8f","email":"protected-test-YloaUq9JCCOBqZIHaWW6l@example.com","msg":"User registered"}
{"level":30,"time":1768079911941,"env":"test","module":"email-queue","jobId":"be118860-7c3c-42b0-9ce2-5084811be707","to":"session-test-OvCL9WxF8JCV-8NGJiH5I@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079911998,"env":"test","module":"auth-routes","userId":"3eb0f898-2a92-4280-bd22-a2083c0b0fac","email":"session-test-OvCL9WxF8JCV-8NGJiH5I@example.com","msg":"User registered"}
{"level":50,"time":1768079912066,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079912098,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1768079912159,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079912162,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079912167,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079912173,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079912222,"env":"test","module":"mfa-service","userId":"87a66cfc31f8889541753fc8e0f9cca1","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768079912222,"env":"test","module":"mfa-service","userId":"87a66cfc31f8889541753fc8e0f9cca1","msg":"Generated TOTP secret"}
{"level":30,"time":1768079912222,"env":"test","module":"auth-routes","userId":"87a66cfc31f8889541753fc8e0f9cca1","msg":"MFA setup initiated"}
{"level":50,"time":1768079912260,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079912270,"env":"test","workflowId":"cdc56f3e-c387-45d4-ac21-6bba08c43524","userId":"e0878ed4-038c-4930-8ca9-c9affd0bc4b0","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768079912294,"env":"test","workflowId":"6cfcfd7a-051d-4010-b261-6fca6912b496","queryId":"3d85774a-eb1e-4328-81b0-084c2d6bee9e","outputVar":"my_results","msg":"Executing query block"}
{"level":50,"time":1768079912344,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould prevent revoking other user's device
[22m[39m[TEST UTILS] MFA Secret verified for 835ddbc3c42bba3e96c5446d4d7bbd2f

{"level":50,"time":1768079912353,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079912363,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079912391,"env":"test","module":"user-credentials-repository","userId":"2PH2njC0hrGTO9X1pccEM","msg":"User credentials created"}
{"level":30,"time":1768079912427,"env":"test","module":"auth-routes","userId":"8195bddaa97cd93c44afd65595b7b2a6","msg":"User logged in successfully"}
{"level":50,"time":1768079912443,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079912479,"env":"test","module":"audit-log-service","userId":"8195bddaa97cd93c44afd65595b7b2a6","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079912489,"env":"test","module":"user-credentials-repository","userId":"8320b2f9-0db6-48c3-845b-07bcaae03e29","msg":"User credentials created"}
{"level":30,"time":1768079912544,"env":"test","module":"mfa-service","userId":"87a66cfc31f8889541753fc8e0f9cca1","msg":"MFA enabled successfully"}
{"level":30,"time":1768079912544,"env":"test","module":"auth-routes","userId":"87a66cfc31f8889541753fc8e0f9cca1","msg":"MFA enabled successfully"}
{"level":30,"time":1768079912600,"env":"test","module":"audit-log-service","userId":"87a66cfc31f8889541753fc8e0f9cca1","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079912601,"env":"test","module":"email-queue","jobId":"e48958c6-9a4f-4ce1-90a6-86caef7f4cf7","to":"middleware-test-C8s20VOgkRV2UmI6GuU2-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079912660,"env":"test","module":"auth-routes","userId":"8320b2f9-0db6-48c3-845b-07bcaae03e29","email":"middleware-test-C8s20VOgkRV2UmI6GuU2-@example.com","msg":"User registered"}
{"level":30,"time":1768079912690,"env":"test","module":"user-credentials-repository","userId":"92949fa5-31b3-4b5e-9c82-e727ce910688","msg":"User credentials created"}
{"level":50,"time":1768079912723,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768079912791,"env":"test","module":"user-credentials-repository","userId":"14df4d4d-810c-438f-844b-5b74181134d5","msg":"User credentials created"}
{"level":30,"time":1768079912793,"env":"test","module":"email-queue","jobId":"d0100d88-d140-46e9-a7ed-4528e4be3d85","to":"protected-test-aLBB-Vyk78UmhZhrPM4Py@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079912810,"env":"test","module":"auth-routes","userId":"24f89040978efa02c9778d3d31ff7b2b","msg":"User logged in successfully"}
{"level":30,"time":1768079912848,"env":"test","module":"auth-routes","userId":"92949fa5-31b3-4b5e-9c82-e727ce910688","email":"protected-test-aLBB-Vyk78UmhZhrPM4Py@example.com","msg":"User registered"}
{"level":50,"time":1768079912862,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079912864,"env":"test","module":"audit-log-service","userId":"24f89040978efa02c9778d3d31ff7b2b","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079912902,"env":"test","module":"email-queue","jobId":"cd9a6b2a-59f0-44c3-b6c8-f3e864ba0ebb","to":"session-test-z4_F6LmxtjLPW0vltNQzL@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079912909,"env":"test","module":"user-credentials-repository","userId":"vnUnphVPcrz_VzzuCsIiO","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/integration/dataBlocks.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 6083[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should write data to DataVault via WriteBlock [33m 2645[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should query data from DataVault via QueryBlock and use in Logic [33m 1993[2mms[22m[39m
{"level":30,"time":1768079912958,"env":"test","module":"auth-routes","userId":"14df4d4d-810c-438f-844b-5b74181134d5","email":"session-test-z4_F6LmxtjLPW0vltNQzL@example.com","msg":"User registered"}
{"level":50,"time":1768079912996,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079913005,"env":"test","module":"auth-routes","userId":"8195bddaa97cd93c44afd65595b7b2a6","msg":"User logged in successfully"}
{"level":30,"time":1768079913054,"env":"test","module":"audit-log-service","userId":"8195bddaa97cd93c44afd65595b7b2a6","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079913072,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768079913144,"env":"test","module":"auth-service","userId":"24f89040978efa02c9778d3d31ff7b2b","tokenHash":"2196a1ff43f98aa7b877bada4adaff2eef56250dae38a5dc9b77e3d14ed52990","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould prevent revoking other user's device
[22m[39m[TEST UTILS] MFA Secret verified for ed057c041a4c63ac7f888d155d71d369

{"level":40,"time":1768079913246,"env":"test","module":"auth-service","tokenHash":"77ba9a1c65689ac9d100eaf2e8329009c31da613ca66e2c47cdca394f7069320","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768079913270,"env":"test","module":"auth-routes","userId":"8320b2f9-0db6-48c3-845b-07bcaae03e29","msg":"User logged in successfully"}
{"level":50,"time":1768079913281,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079913330,"env":"test","module":"audit-log-service","userId":"8320b2f9-0db6-48c3-845b-07bcaae03e29","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079913336,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079913555,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079913566,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079913598,"env":"test","module":"user-credentials-repository","userId":"9a482cef-3342-4a82-85b0-9608490fd5c3","msg":"User credentials created"}
{"level":30,"time":1768079913623,"env":"test","module":"user-credentials-repository","userId":"Mmg-k_Hx9UZ5z--m-Mc_j","msg":"User credentials created"}
{"level":30,"time":1768079913661,"env":"test","workflowId":"b553a2c6-4b9c-4e7a-b6b3-e7443b2e9b23","userId":"e0878ed4-038c-4930-8ca9-c9affd0bc4b0","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768079913653,"env":"test","module":"auth-routes","userId":"8195bddaa97cd93c44afd65595b7b2a6","msg":"User logged in successfully"}
{"level":30,"time":1768079913706,"env":"test","module":"audit-log-service","userId":"8195bddaa97cd93c44afd65595b7b2a6","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079913712,"env":"test","module":"email-queue","jobId":"81291e34-8b19-4a5e-814e-054b0e9ec508","to":"session-test-Jv2x-IGt7s8OjZvNaizLp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079913725,"env":"test","module":"auth-routes","userId":"92949fa5-31b3-4b5e-9c82-e727ce910688","msg":"User logged in successfully"}
{"level":30,"time":1768079913764,"env":"test","module":"auth-routes","userId":"9a482cef-3342-4a82-85b0-9608490fd5c3","email":"session-test-Jv2x-IGt7s8OjZvNaizLp@example.com","msg":"User registered"}
{"level":30,"time":1768079913772,"env":"test","module":"user-credentials-repository","userId":"ef0a1d12-2b45-4802-ad7a-5491432d50e8","msg":"User credentials created"}
{"level":30,"time":1768079913777,"env":"test","module":"audit-log-service","userId":"92949fa5-31b3-4b5e-9c82-e727ce910688","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079913877,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079913888,"env":"test","module":"email-queue","jobId":"b75ad246-f416-4866-8517-560775cada84","to":"middleware-test-fJia37HlqCqyAJrHHHPjM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079913944,"env":"test","module":"auth-routes","userId":"ef0a1d12-2b45-4802-ad7a-5491432d50e8","email":"middleware-test-fJia37HlqCqyAJrHHHPjM@example.com","msg":"User registered"}
{"level":50,"time":1768079913976,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Cleanup error (non-fatal): error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.runs.docx.test.ts:189:9 {
  length: 311,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(854115b8-d30b-48c3-8db5-f1b0f44462e0) is still referenced from table "runs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'runs',
  column: undefined,
  dataType: undefined,
  constraint: 'runs_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

{"level":40,"time":1768079913990,"env":"test","module":"mfa-service","userId":"835ddbc3c42bba3e96c5446d4d7bbd2f","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079913990,"env":"test","module":"auth-routes","userId":"835ddbc3c42bba3e96c5446d4d7bbd2f","msg":"MFA verification failed during login"}
{"level":50,"time":1768079913995,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079914000,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079914156,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079914177,"env":"test","module":"user-credentials-repository","userId":"hBsvxgAtWjf8tgZCxKajJ","msg":"User credentials created"}
{"level":50,"time":1768079914294,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079914294,"env":"test","module":"auth-service","tokenHash":"116751b69baa9f320316fe0d69f17c0dc0ed4e66cc9d19ca170ff4c3c4fee631","msg":"Security: Unknown refresh token used"}
 [31mÎ“Â¥Â»[39m tests/integration/api.runs.docx.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should execute workflow with template node and generate DOCX [33m 1834[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing template data gracefully [33m 1368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should download DOCX output from successful run[39m[32m 201[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for PDF when not generated[39m[33m 371[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 404 for non-existent run[32m 126[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should extract placeholders from uploaded template[32m 134[2mms[22m[39m
{"level":30,"time":1768079914413,"env":"test","module":"user-credentials-repository","userId":"36d0b509-48fa-4a5f-a37a-b214cb3b36c8","msg":"User credentials created"}
{"level":50,"time":1768079914422,"env":"test","error":{},"workflowId":"584963e2-287c-43a3-813c-ece0654caf33","userId":"e0878ed4-038c-4930-8ca9-c9affd0bc4b0","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":50,"time":1768079914459,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079914522,"env":"test","module":"email-queue","jobId":"219d088c-da1d-4dbd-b5c5-01df99526056","to":"protected-test-sVNdpNw9NXM1tZwWx4cSO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079914570,"env":"test","module":"auth-routes","userId":"36d0b509-48fa-4a5f-a37a-b214cb3b36c8","email":"protected-test-sVNdpNw9NXM1tZwWx4cSO@example.com","msg":"User registered"}
{"level":30,"time":1768079914591,"env":"test","module":"user-credentials-repository","userId":"3e55076e-4b2e-4432-8d5c-f196adcf6d6b","msg":"User credentials created"}
{"level":30,"time":1768079914654,"env":"test","module":"user-credentials-repository","userId":"3tPfmmb7d4vSa9k0w_JbZ","msg":"User credentials created"}
{"level":50,"time":1768079914675,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079914704,"env":"test","module":"email-queue","jobId":"db8a20c5-9547-418f-b7a3-7be31ee8b4e6","to":"session-test-F5SYWnrwmu0MDCN6H2OkD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079914728,"env":"test","module":"user-credentials-repository","userId":"7da81bf5-b98a-4db2-af12-87f1267bb692","msg":"User credentials created"}
{"level":50,"time":1768079914742,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079914747,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079914760,"env":"test","module":"auth-routes","userId":"3e55076e-4b2e-4432-8d5c-f196adcf6d6b","email":"session-test-F5SYWnrwmu0MDCN6H2OkD@example.com","msg":"User registered"}
{"level":30,"time":1768079914834,"env":"test","module":"email-queue","jobId":"2f7a8c14-7c53-41df-932e-74d1a59eddfd","to":"middleware-test-Xj6KHfpxYUmuJyzSpwO-d@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079914889,"env":"test","module":"auth-routes","userId":"7da81bf5-b98a-4db2-af12-87f1267bb692","email":"middleware-test-Xj6KHfpxYUmuJyzSpwO-d@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768079914951,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079914964,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould skip MFA for trusted device
[22m[39m[TEST UTILS] MFA Secret verified for 851498abc1d4bfbd0799c8d47c1f6080

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768079915243,"env":"test","module":"auth-routes","userId":"c4eb7f8d38ac4e200b5b44a4aec5906d","msg":"User logged in successfully"}
{"level":50,"time":1768079915281,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1768079915298,"env":"test","module":"audit-log-service","userId":"c4eb7f8d38ac4e200b5b44a4aec5906d","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079915342,"env":"test","module":"auth-routes","userId":"fdd279dfe2a2ef8f90e5e0615695001e","msg":"User logged in successfully"}
{"level":30,"time":1768079915357,"env":"test","module":"user-credentials-repository","userId":"S6yKLO3Ta4DtY6GKw8sKR","msg":"User credentials created"}
{"level":30,"time":1768079915357,"env":"test","module":"auth-routes","userId":"e8e405a87a78451a505ee52d16d6f78a","msg":"User logged in successfully"}
{"level":30,"time":1768079915394,"env":"test","module":"audit-log-service","userId":"fdd279dfe2a2ef8f90e5e0615695001e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079915400,"env":"test","module":"user-credentials-repository","userId":"7a510cfd-3e81-419e-8f6d-8522442c84eb","msg":"User credentials created"}
{"level":30,"time":1768079915411,"env":"test","module":"audit-log-service","userId":"e8e405a87a78451a505ee52d16d6f78a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079915443,"env":"test","module":"auth-routes","userId":"3e55076e-4b2e-4432-8d5c-f196adcf6d6b","msg":"User logged in successfully"}
{"level":30,"time":1768079915493,"env":"test","module":"auth-routes","userId":"7da81bf5-b98a-4db2-af12-87f1267bb692","msg":"User logged in successfully"}
{"level":30,"time":1768079915495,"env":"test","module":"audit-log-service","userId":"3e55076e-4b2e-4432-8d5c-f196adcf6d6b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079915547,"env":"test","module":"audit-log-service","userId":"7da81bf5-b98a-4db2-af12-87f1267bb692","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079915576,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079915618,"env":"test","module":"auth-routes","userId":"3e55076e-4b2e-4432-8d5c-f196adcf6d6b","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1768079915648,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079915690,"env":"test","module":"mfa-service","userId":"851498abc1d4bfbd0799c8d47c1f6080","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079915690,"env":"test","module":"auth-routes","userId":"851498abc1d4bfbd0799c8d47c1f6080","msg":"MFA verification failed during login"}
{"level":50,"time":1768079915696,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079915785,"env":"test","module":"email-queue","jobId":"0791d9d2-6e93-467c-81ab-fe6f893b9fa7","to":"protected-test-r5MeEbia2GeM8z6QT6ZTM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079915841,"env":"test","module":"auth-routes","userId":"7a510cfd-3e81-419e-8f6d-8522442c84eb","email":"protected-test-r5MeEbia2GeM8z6QT6ZTM@example.com","msg":"User registered"}
{"level":30,"time":1768079915842,"env":"test","module":"user-credentials-repository","userId":"b85acd6a-106d-4b1d-9577-ad9ed2f4d850","msg":"User credentials created"}
{"level":30,"time":1768079915846,"env":"test","module":"mfa-service","userId":"c4eb7f8d38ac4e200b5b44a4aec5906d","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768079915846,"env":"test","module":"mfa-service","userId":"c4eb7f8d38ac4e200b5b44a4aec5906d","msg":"Generated TOTP secret"}
{"level":30,"time":1768079915846,"env":"test","module":"auth-routes","userId":"c4eb7f8d38ac4e200b5b44a4aec5906d","msg":"MFA setup initiated"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768079915955,"env":"test","module":"email-queue","jobId":"c76475c5-bd34-4a08-a40c-78b24f0532cf","to":"test-workflows-tuyG970CVNuEvzdZOKvFe@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768079915964,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
{"level":30,"time":1768079915988,"env":"test","module":"user-credentials-repository","userId":"889efb92-4b8a-42f1-afdf-8a8e02a22198","msg":"User credentials created"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
{"level":30,"time":1768079916006,"env":"test","module":"auth-routes","userId":"b85acd6a-106d-4b1d-9577-ad9ed2f4d850","email":"test-workflows-tuyG970CVNuEvzdZOKvFe@example.com","msg":"User registered"}
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
{"level":30,"time":1768079916028,"env":"test","module":"user-credentials-repository","userId":"e29_PvsKl0t1mAutEqE_v","msg":"User credentials created"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1768079916098,"env":"test","module":"email-queue","jobId":"9ea1c7ce-9e5b-4252-99d8-ce08c5af5725","to":"user2-zlez7MYba_jU4tDDBujeO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079916142,"env":"test","module":"auth-routes","userId":"2764d59101e3933ced4e63103d367933","msg":"User logged in successfully"}
 [31mÎ“Â¥Â»[39m tests/integration/auth/jwt.authentication.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 5697[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate valid JWT token on successful login[39m[32m 15[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include correct payload in JWT token[39m[32m 13[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set JWT expiry to 15 minutes[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept valid JWT token on protected routes[39m[32m 177[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject request without authorization header[32m 8[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject request with malformed token[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject request with missing Bearer prefix[39m[32m 171[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject token with invalid signature[32m 8[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired JWT token [33m 1213[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return token_expired error code for expired tokens[39m[33m 1117[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should authenticate with Bearer token in Authorization header[32m 116[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should work with Bearer token on POST requests[32m 120[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should work with Bearer token on PUT requests[39m[32m 64[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should work with Bearer token on DELETE requests[39m[32m 289[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exchange valid session cookie for JWT token[39m[32m 6[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject token exchange without valid cookie[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prefer Bearer token over cookie when both present[39m[32m 10[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fall back to cookie if Bearer token is invalid[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow GET requests with cookie auth only[39m[32m 11[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST requests with cookie auth only (mutation-strict)[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow anonymous access to public workflows[39m[32m 63[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach user info if authenticated on optional auth routes[39m[32m 62[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token using refresh token[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token on use[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should detect token reuse and revoke all user tokens[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke refresh token on logout[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should clear refresh token cookie on logout[39m[32m 6[2mms[22m[39m
{"level":30,"time":1768079916156,"env":"test","module":"auth-routes","userId":"889efb92-4b8a-42f1-afdf-8a8e02a22198","email":"user2-zlez7MYba_jU4tDDBujeO@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079916192,"env":"test","module":"user-credentials-repository","userId":"7c385a89-8909-4b79-b0da-025bb155ae43","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079916202,"env":"test","module":"audit-log-service","userId":"2764d59101e3933ced4e63103d367933","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079916221,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768079916235,"env":"test","error":{},"workflowId":"c04aa9a0-6bd0-446e-924d-06cd7cb01659","userId":"b85acd6a-106d-4b1d-9577-ad9ed2f4d850","projectId":"94741aaf-e5af-482a-8dbc-881554301f60","msg":"Error moving workflow"}
{"level":30,"time":1768079916308,"env":"test","module":"email-queue","jobId":"51d4f458-6b70-46e2-8079-271fa33ba912","to":"session-test-QBt2dmVZaTxW_37uxdL0h@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079916368,"env":"test","module":"auth-routes","userId":"7c385a89-8909-4b79-b0da-025bb155ae43","email":"session-test-QBt2dmVZaTxW_37uxdL0h@example.com","msg":"User registered"}
{"level":50,"time":1768079916485,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079916489,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079916496,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth.flows.real.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 21520[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete registration, verify email, then login[39m[33m 2020[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should lock account after 5 failed attempts, then unlock after waiting[39m[33m 2506[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should record all login attempts[39m[33m 1813[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete MFA setup and login with TOTP[39m[33m 2147[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with backup code when TOTP unavailable[39m[33m 1280[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete full password reset flow[39m[33m 1803[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should invalidate all sessions after password reset [33m 2221[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token on each use[39m[33m 1833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should detect and prevent refresh token reuse (token theft) [33m 1892[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions[39m[33m 1443[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1741[2mms[22m[39m
{"level":30,"time":1768079916641,"env":"test","module":"user-credentials-repository","userId":"b85d6b3e-e4ce-4f0b-a460-7154873d9168","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.token-refresh.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 21689[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token with valid refresh token[39m[33m 512[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should rotate refresh token after use [33m 781[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when refresh token is missing [33m 414[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid refresh token [33m 500[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for expired refresh token [33m 542[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for revoked refresh token [33m 533[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when user is not found [33m 551[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update refresh token metadata on rotation [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle concurrent refresh token requests (token reuse detection) [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set secure cookie in production [33m 664[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set proper cookie attributes [33m 668[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should include user role information in response [33m 655[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create refresh token on login[39m[33m 718[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke refresh token on logout[39m[33m 588[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle logout without refresh token gracefully [33m 425[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should support multiple active refresh tokens per user[39m[33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all user tokens on password reset [33m 656[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use cryptographically strong random tokens [33m 6033[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should hash refresh tokens before storing in database [33m 521[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent refresh token reuse after rotation [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate token ownership [33m 544[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set HttpOnly flag to prevent XSS[39m[33m 509[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set SameSite=Strict to prevent CSRF [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set proper cookie path [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set appropriate expiry (30 days) [33m 654[2mms[22m[39m
{"level":30,"time":1768079916747,"env":"test","module":"email-queue","jobId":"3c62085b-a177-4519-9f3c-47cddfe79fc6","to":"protected-test-IVcVKCFRuBCVOeDSNriNS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1768079916795,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"44610a27-17cd-489f-8808-295c97fbdc97","userId":"e0878ed4-038c-4930-8ca9-c9affd0bc4b0","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":30,"time":1768079916798,"env":"test","module":"auth-routes","userId":"b85d6b3e-e4ce-4f0b-a460-7154873d9168","email":"protected-test-IVcVKCFRuBCVOeDSNriNS@example.com","msg":"User registered"}
{"level":30,"time":1768079916908,"env":"test","module":"user-credentials-repository","userId":"059c2211-7cd7-4d5a-ab32-26571346adfd","msg":"User credentials created"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould try TOTP before backup code
[22m[39m[TEST UTILS] MFA Secret verified for 2c8e64d42eecb82b44b62fec9f547e3c

{"level":30,"time":1768079916926,"env":"test","module":"user-credentials-repository","userId":"49ae0e95-4ffd-4517-bbcd-de93c424e5b4","msg":"User credentials created"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould require MFA for untrusted device
[22m[39m[TEST UTILS] MFA Secret verified for dd694ff9c1a1479c7e1f901a9e9b34db

{"level":30,"time":1768079916971,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079916994,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts[2m > [22m[2mDataVault Table Permissions API (v4 Micro-Phase 6)
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079916979,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079916980,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079916987,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079916993,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079916993,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079916994,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079916994,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079917014,"env":"test","module":"email-queue","jobId":"f72b31b2-b66a-416b-b7d8-87e35e829d9e","to":"user2-v7UmwZ86juatx2wRcjDWW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079917028,"env":"test","module":"auth-routes","userId":"da947c5b10b2c603085f539922f1a039","msg":"User logged in successfully"}
{"level":30,"time":1768079917041,"env":"test","module":"email-queue","jobId":"5ed80dec-49bd-44c6-a74a-1288e3b6cef4","to":"middleware-test-9XM77ROp111T6af2nXRYF@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079917077,"env":"test","module":"audit-log-service","userId":"da947c5b10b2c603085f539922f1a039","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079917073,"env":"test","module":"auth-routes","userId":"059c2211-7cd7-4d5a-ab32-26571346adfd","email":"user2-v7UmwZ86juatx2wRcjDWW@example.com","msg":"User registered"}
{"level":30,"time":1768079917096,"env":"test","module":"auth-routes","userId":"49ae0e95-4ffd-4517-bbcd-de93c424e5b4","email":"middleware-test-9XM77ROp111T6af2nXRYF@example.com","msg":"User registered"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768079917340,"env":"test","module":"auth-routes","userId":"dfc974e09c0abcf249b4d677ebd97daf","msg":"User logged in successfully"}
{"level":50,"time":1768079917362,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ccc64daa-78e9-436f-914f-198406f5466e","userId":"e0878ed4-038c-4930-8ca9-c9affd0bc4b0","msg":"Error moving workflow"}
{"level":30,"time":1768079917398,"env":"test","module":"audit-log-service","userId":"dfc974e09c0abcf249b4d677ebd97daf","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should debounce validation calls
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768079917502,"env":"test","module":"auth-routes","userId":"b85d6b3e-e4ce-4f0b-a460-7154873d9168","msg":"User logged in successfully"}
{"level":40,"time":1768079917509,"env":"test","module":"auth-service","userId":"dfc974e09c0abcf249b4d677ebd97daf","tokenHash":"770f89ac45b4683df173df5b18f1d0e048b8ffcfed5d2086c02041f3e1d885cf","msg":"Security: REUSED REFRESH TOKEN DETECTED (Concurrent). Revoking all sessions."}
{"level":30,"time":1768079917542,"env":"test","module":"user-credentials-repository","userId":"365d8db8-b1d0-45e4-92bb-b5711ae9b0d5","msg":"User credentials created"}
{"level":30,"time":1768079917558,"env":"test","module":"audit-log-service","userId":"b85d6b3e-e4ce-4f0b-a460-7154873d9168","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079917565,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079917646,"env":"test","module":"auth-routes","userId":"059c2211-7cd7-4d5a-ab32-26571346adfd","msg":"User logged in successfully"}
{"level":30,"time":1768079917647,"env":"test","module":"email-queue","jobId":"eb903af2-fc49-4f94-a0ae-0e2f62309abf","to":"test-GC6P50Tiq4qSIHUKmLcaK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768079917678,"env":"test","module":"auth-routes","userId":"49ae0e95-4ffd-4517-bbcd-de93c424e5b4","msg":"User logged in successfully"}
{"level":30,"time":1768079917703,"env":"test","module":"audit-log-service","userId":"059c2211-7cd7-4d5a-ab32-26571346adfd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079917708,"env":"test","module":"auth-routes","userId":"365d8db8-b1d0-45e4-92bb-b5711ae9b0d5","email":"test-GC6P50Tiq4qSIHUKmLcaK@example.com","msg":"User registered"}
{"level":30,"time":1768079917731,"env":"test","module":"audit-log-service","userId":"49ae0e95-4ffd-4517-bbcd-de93c424e5b4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079917741,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079917805,"env":"test","module":"auth-routes","userId":"2c8e64d42eecb82b44b62fec9f547e3c","msg":"Login requires MFA verification"}
{"level":40,"time":1768079917810,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1768079917818,"env":"test","module":"auth-routes","userId":"dd694ff9c1a1479c7e1f901a9e9b34db","msg":"Login requires MFA verification"}
{"level":30,"time":1768079917818,"env":"test","module":"auth-routes","userId":"059c2211-7cd7-4d5a-ab32-26571346adfd","sessionCount":1,"msg":"Listed active sessions"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate helper functions in expressions
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":40,"time":1768079917919,"env":"test","module":"mfa-service","userId":"2c8e64d42eecb82b44b62fec9f547e3c","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079917925,"env":"test","module":"mfa-service","userId":"dd694ff9c1a1479c7e1f901a9e9b34db","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079917926,"env":"test","module":"auth-routes","userId":"dd694ff9c1a1479c7e1f901a9e9b34db","msg":"MFA verification failed during login"}
{"level":50,"time":1768079917932,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768079917969,"env":"test","module":"mfa-service","userId":"2c8e64d42eecb82b44b62fec9f547e3c","msg":"No unused backup codes available"}
{"level":40,"time":1768079917969,"env":"test","module":"auth-routes","userId":"2c8e64d42eecb82b44b62fec9f547e3c","msg":"MFA verification failed during login"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate complex expressions with multiple helpers
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768079917988,"env":"test","module":"user-credentials-repository","userId":"7a2ad69a-525d-4055-acc8-94fa5f42a5f5","msg":"User credentials created"}
{"level":50,"time":1768079918092,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079918093,"env":"test","module":"email-queue","jobId":"583d8b5f-1386-43c0-9976-ee1f0120e0cf","to":"protected-test-egD_xZKqnSCeqN98vuiYG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31mÎ“Â¥Â»[39m tests/ui/runs.components.test.tsx [2m([22m[2m19 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 3857[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should render runs table with correct columns[39m[32m 33[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should render run data correctly[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show success badge for successful runs[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show error badge for failed runs[39m[32m 10[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format duration correctly[39m[32m 10[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show download options for successful runs[39m[32m 5[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should render all filter controls[32m 193[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should call onChange when status filter changes [33m 684[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should call onChange when search is submitted [33m 318[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show clear filters button when filters are active[32m 83[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should clear all filters when clear button is clicked[32m 205[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should render all trace entries[32m 83[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show executed badge for executed nodes[32m 20[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show skipped badge for skipped nodes[32m 28[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should display conditions and their results[32m 59[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should display error messages[32m 22[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should toggle show skipped nodes[32m 38[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should expand outputs delta when clicked[32m 73[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should copy trace as JSON[32m 87[2mms[22m[39m
{"level":30,"time":1768079918147,"env":"test","module":"auth-routes","userId":"7a2ad69a-525d-4055-acc8-94fa5f42a5f5","email":"protected-test-egD_xZKqnSCeqN98vuiYG@example.com","msg":"User registered"}
{"level":40,"time":1768079918169,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should handle syntax errors
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1768079918224,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079918245,"env":"test","module":"user-credentials-repository","userId":"40d3ae0f-b9a6-4107-a2ab-0cc22ca1315b","msg":"User credentials created"}
{"level":50,"time":1768079918270,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079918322,"env":"test","module":"user-credentials-repository","userId":"acd69059-0ebd-413d-bdf4-40ae06607c45","msg":"User credentials created"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768079918336,"env":"test","module":"user-credentials-repository","userId":"9cae732c-cf1b-4c4f-b62f-d7977f854d43","msg":"User credentials created"}
{"level":30,"time":1768079918370,"env":"test","module":"email-queue","jobId":"d40378d6-2e53-4740-ac66-35e51fb81dc8","to":"middleware-test-J2OcfeDoPcZzkhk2uQr0X@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079918421,"env":"test","module":"auth-routes","userId":"40d3ae0f-b9a6-4107-a2ab-0cc22ca1315b","email":"middleware-test-J2OcfeDoPcZzkhk2uQr0X@example.com","msg":"User registered"}
{"level":30,"time":1768079918445,"env":"test","module":"email-queue","jobId":"51a476cb-04c6-430f-bec8-eb11df35096f","to":"test-e3Hp0NrfJMKWvdkTdbLCi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079918439,"env":"test","module":"email-queue","jobId":"43682811-88fc-45e3-8ca7-0dae6a3fcbca","to":"test-workflows-XOWHm42tBvTvH13QTVtpP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079918498,"env":"test","module":"auth-routes","userId":"acd69059-0ebd-413d-bdf4-40ae06607c45","email":"test-workflows-XOWHm42tBvTvH13QTVtpP@example.com","msg":"User registered"}
{"level":30,"time":1768079918513,"env":"test","module":"auth-routes","userId":"9cae732c-cf1b-4c4f-b62f-d7977f854d43","email":"test-e3Hp0NrfJMKWvdkTdbLCi@example.com","msg":"User registered"}
{"level":50,"time":1768079918531,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079918551,"env":"test","module":"user-credentials-repository","userId":"7df5c6cd-1f8c-43aa-a283-fe3d6b2ff122","msg":"User credentials created"}
{"level":40,"time":1768079918572,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768079918662,"env":"test","module":"email-queue","jobId":"a8ce9a04-5e43-4308-bc5e-e01980725327","to":"session-test-GhqXfGf7mRz6hiUiVcbxO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079918721,"env":"test","module":"auth-routes","userId":"7df5c6cd-1f8c-43aa-a283-fe3d6b2ff122","email":"session-test-GhqXfGf7mRz6hiUiVcbxO@example.com","msg":"User registered"}
{"level":50,"time":1768079918778,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1768079918853,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079918852,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079918974,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1768079918985,"env":"test","module":"user-credentials-repository","userId":"3cf386f0-cc66-4e44-a15e-80c5ad4fec6f","msg":"User credentials created"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768079919031,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768079919031,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768079919031,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768079919032,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768079919036,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768079919036,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768079919037,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
 [31mÎ“Â¥Â»[39m tests/ui/expression-editor.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 3442[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with null validation result[32m 28[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate expression after debounce[39m[32m 23[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return validation errors for invalid expression[39m[32m 299[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should debounce validation calls[32m 169[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should not validate when workflowId or nodeId is missing[32m 166[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate helper functions in expressions[32m 136[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate complex expressions with multiple helpers[39m[32m 231[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle syntax errors[39m[33m 359[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle empty expressions[32m 44[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update validation when expression changes [33m 391[2mms[22m[39m
{"level":30,"time":1768079919092,"env":"test","module":"email-queue","jobId":"7ce5289d-87c1-4fea-916b-2827e38b9b5e","to":"protected-test-RtF6U8GkUROQBcSq8qe-A@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stderr | tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/regression-REG-1.test.ts:79:13 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(ecd24a2e-b962-49ae-902c-70c267fcbcfa) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079919113,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079919146,"env":"test","module":"auth-routes","userId":"3cf386f0-cc66-4e44-a15e-80c5ad4fec6f","email":"protected-test-RtF6U8GkUROQBcSq8qe-A@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/regression-REG-1.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 2992[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should block Next when required visible question is empty [33m 336[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should NOT block Next when required question is hidden[39m[33m 346[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should block when required becomes visible and is empty [33m 350[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip hidden required page entirely[39m[33m 404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce required on visible page [33m 457[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should evaluate visibility consistently across modes[39m[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle malformed visibility expression gracefully[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle missing variable in visibility expression[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1768079919188,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079919194,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079919213,"env":"test","module":"user-credentials-repository","userId":"1e251c97-5d0b-43ff-ae5e-b9dcf187fe91","msg":"User credentials created"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould update lastUsedAt on trusted device login
[22m[39m[TEST UTILS] MFA Secret verified for 88603763ce8b7c12a748ab98e7e8fbab

{"level":30,"time":1768079919320,"env":"test","module":"email-queue","jobId":"20580373-ef7e-4ac2-9bdd-7eadae4c868f","to":"middleware-test-64lFLnYdUzrna5xkUQQDe@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079919375,"env":"test","module":"auth-routes","userId":"1e251c97-5d0b-43ff-ae5e-b9dcf187fe91","email":"middleware-test-64lFLnYdUzrna5xkUQQDe@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1768079919522,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mÎ“Â¥Â»[39m tests/integration/datavault.permissions.test.ts [2m([22m[2m22 tests[22m[2m | [22m[33m22 skipped[39m[2m)[22m[33m 2973[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should allow owner to read table
       [2m[90mÎ“Ã¥Ã´[39m[22m should allow writer to read table
       [2m[90mÎ“Ã¥Ã´[39m[22m should allow reader to read table
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny non-member from reading table
       [2m[90mÎ“Ã¥Ã´[39m[22m should allow owner to update table
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny writer from updating table
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny reader from updating table
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny writer from deleting table
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny reader from deleting table
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny non-member from deleting table
       [2m[90mÎ“Ã¥Ã´[39m[22m should allow owner to view permissions
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny writer from viewing permissions
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny reader from viewing permissions
       [2m[90mÎ“Ã¥Ã´[39m[22m should allow owner to grant permissions
       [2m[90mÎ“Ã¥Ã´[39m[22m should allow owner to update existing permission (upsert)
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny writer from granting permissions
       [2m[90mÎ“Ã¥Ã´[39m[22m should prevent modifying table owner permissions
       [2m[90mÎ“Ã¥Ã´[39m[22m should allow owner to revoke permissions
       [2m[90mÎ“Ã¥Ã´[39m[22m should deny writer from revoking permissions
       [2m[90mÎ“Ã¥Ã´[39m[22m should enforce owner includes write and read
       [2m[90mÎ“Ã¥Ã´[39m[22m should enforce write includes read but not owner
       [2m[90mÎ“Ã¥Ã´[39m[22m should enforce read is read-only
{"level":30,"time":1768079919667,"env":"test","module":"user-credentials-repository","userId":"0c92e049-b03f-43ed-97c2-f8c6f847d6f7","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 16485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 554[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 934[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 705[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 891[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 962[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 1381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 1404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 696[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 528[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 1284[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 567[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1492[2mms[22m[39m
{"level":30,"time":1768079919681,"env":"test","module":"auth-routes","userId":"2306d428b6ab1255831a04265a44cf65","msg":"User logged in successfully"}
{"level":50,"time":1768079919728,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079919734,"env":"test","module":"audit-log-service","userId":"2306d428b6ab1255831a04265a44cf65","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079919781,"env":"test","module":"email-queue","jobId":"d278d7cb-e85a-4fe1-843a-733e7fc13b35","to":"session-test-V0QHG2SaepdWKmQo7WHuz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079919838,"env":"test","module":"auth-routes","userId":"0c92e049-b03f-43ed-97c2-f8c6f847d6f7","email":"session-test-V0QHG2SaepdWKmQo7WHuz@example.com","msg":"User registered"}
{"level":50,"time":1768079919896,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079919908,"env":"test","module":"auth-routes","userId":"2306d428b6ab1255831a04265a44cf65","msg":"All other sessions revoked"}
{"level":30,"time":1768079919958,"env":"test","module":"audit-log-service","userId":"2306d428b6ab1255831a04265a44cf65","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":40,"time":1768079920009,"env":"test","module":"mfa-service","userId":"88603763ce8b7c12a748ab98e7e8fbab","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079920009,"env":"test","module":"auth-routes","userId":"88603763ce8b7c12a748ab98e7e8fbab","msg":"MFA verification failed during login"}
{"level":50,"time":1768079920015,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079920020,"env":"test","module":"user-credentials-repository","userId":"663252cf-eb87-4ec6-a423-afe1512aa3d6","msg":"User credentials created"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079920080,"env":"test","module":"auth-routes","userId":"2306d428b6ab1255831a04265a44cf65","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768079920134,"env":"test","module":"email-queue","jobId":"f611977e-3178-4037-ac28-57ecc565dcd1","to":"protected-test-5BDWw-Ym8wzyDrIyv7qNp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31mÎ“Â¥Â»[39m tests/integration/workflow_versioning.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1393[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should diff two versions correctly[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should create a version and populate changelog[39m[32m 9[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should track execution lineage via snapshot[39m[32m 51[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Status[2m > [22m[2mshould return backup codes count for MFA users
[22m[39m[TEST UTILS] MFA Secret verified for c9bddd4cb4b2974c57862646d9fc2a13

{"level":30,"time":1768079920189,"env":"test","module":"auth-routes","userId":"663252cf-eb87-4ec6-a423-afe1512aa3d6","email":"protected-test-5BDWw-Ym8wzyDrIyv7qNp@example.com","msg":"User registered"}
{"level":30,"time":1768079920243,"env":"test","module":"user-credentials-repository","userId":"93f2f301-9a26-4dd7-85b2-03ebfa608099","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/integration/trusted.devices.real.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 25099[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should trust current device[39m[33m 1951[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set trust expiry to 30 days[39m[33m 1655[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update expiry if device already trusted[39m[33m 993[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 433[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all trusted devices[39m[33m 2444[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current device[39m[33m 1738[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude revoked devices[39m[33m 1843[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude expired devices[39m[33m 1658[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific device[39m[33m 946[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent device[39m[33m 1943[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking other user's device[39m[33m 2599[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip MFA for trusted device[39m[33m 1965[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require MFA for untrusted device[39m[33m 2259[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update lastUsedAt on trusted device login[39m[33m 1844[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1768079920347,"env":"test","module":"email-queue","jobId":"ec0f5c5a-657f-474b-b17f-dfdf3692b338","to":"middleware-test-utafyJG0ex_7uPys8zmS2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1768079920400,"env":"test","module":"auth-routes","userId":"035dc2f86ff8c2775e6682adb3e4d002","msg":"User logged in successfully"}
{"level":30,"time":1768079920407,"env":"test","module":"auth-routes","userId":"93f2f301-9a26-4dd7-85b2-03ebfa608099","email":"middleware-test-utafyJG0ex_7uPys8zmS2@example.com","msg":"User registered"}
{"level":30,"time":1768079920454,"env":"test","module":"audit-log-service","userId":"035dc2f86ff8c2775e6682adb3e4d002","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768079920561,"env":"test","module":"auth-routes","userId":"0c92e049-b03f-43ed-97c2-f8c6f847d6f7","msg":"User logged in successfully"}
{"level":30,"time":1768079920616,"env":"test","module":"audit-log-service","userId":"0c92e049-b03f-43ed-97c2-f8c6f847d6f7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079920733,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079920744,"env":"test","module":"auth-service","userId":"035dc2f86ff8c2775e6682adb3e4d002","tokenHash":"4445f7758e3563a41f67b53f51616ae3723c033add8d7a8d7c0ae64bf2d2b58c","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":50,"time":1768079920790,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/portal.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":50,"time":1768079920902,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079920932,"env":"test","module":"auth-routes","userId":"663252cf-eb87-4ec6-a423-afe1512aa3d6","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079920986,"env":"test","module":"audit-log-service","userId":"663252cf-eb87-4ec6-a423-afe1512aa3d6","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079920992,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079921246,"env":"test","module":"user-credentials-repository","userId":"8ddc465c-6d36-4407-9add-67b0c7af7381","msg":"User credentials created"}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768079921354,"env":"test","module":"email-queue","jobId":"7ce6717a-c3fb-4534-8f99-673816f693cd","to":"middleware-test-8zlhTWLWWn6IhS8OTemDB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079921359,"env":"test","module":"user-credentials-repository","userId":"a4f6fb1a-3646-4922-ba6f-f60b9c27b44d","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079921411,"env":"test","module":"auth-routes","userId":"8ddc465c-6d36-4407-9add-67b0c7af7381","email":"middleware-test-8zlhTWLWWn6IhS8OTemDB@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768079921452,"env":"test","module":"user-credentials-repository","userId":"3853f61d-6cf0-417b-9fe9-88d731f1737b","msg":"User credentials created"}
{"level":30,"time":1768079921478,"env":"test","module":"email-queue","jobId":"2fe87317-1d18-4956-b5cb-d2a0eb7035ff","to":"session-test-1XMMKqAjvP3wtI8YnUE9G@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079921533,"env":"test","module":"auth-routes","userId":"a4f6fb1a-3646-4922-ba6f-f60b9c27b44d","email":"session-test-1XMMKqAjvP3wtI8YnUE9G@example.com","msg":"User registered"}
{"level":30,"time":1768079921555,"env":"test","module":"email-queue","jobId":"ac293419-08e6-4c58-88f5-45210d96fa47","to":"protected-test-jWnfBMSKdliIyB17oOV9G@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079921588,"env":"test","module":"auth-routes","userId":"782bf8b349b31e4d0bf1385d7458a25b","msg":"User logged in successfully"}
{"level":30,"time":1768079921612,"env":"test","module":"auth-routes","userId":"3853f61d-6cf0-417b-9fe9-88d731f1737b","email":"protected-test-jWnfBMSKdliIyB17oOV9G@example.com","msg":"User registered"}
{"level":30,"time":1768079921638,"env":"test","module":"audit-log-service","userId":"782bf8b349b31e4d0bf1385d7458a25b","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079921751,"env":"test","module":"auth-routes","userId":"782bf8b349b31e4d0bf1385d7458a25b","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1768079921759,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079921778,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould disable MFA with password verification
[22m[39m[TEST UTILS] MFA Secret verified for 4841f87e080232478387d83110df8954

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":50,"time":1768079921929,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079922008,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1768079922333,"env":"test","module":"user-credentials-repository","userId":"0b583d04-8b88-4ee1-a92b-16d2c827c368","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768079922375,"env":"test","module":"email-queue","jobId":"9e9bf3d6-9bfb-4211-89ea-55286dd1a935","to":"test-1768079921704-pzhail@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079922375,"env":"test","module":"auth-service","email":"test-1768079921704-pzhail@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768079922394,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1768079922394,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768079922397,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":50,"time":1768079922409,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079922419,"env":"test","module":"user-credentials-repository","userId":"2f302675-e981-45c0-85d5-ac29815e1571","msg":"User credentials created"}
{"level":40,"time":1768079922412,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1768079922460,"env":"test","module":"email-queue","jobId":"8c1bc12f-ad27-4200-922d-6a38a9f4c5ee","to":"middleware-test-HZvEcB6dge93BIL8QUGlv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079922479,"env":"test","module":"user-credentials-repository","userId":"04899b2e-16f7-46c3-bef1-6145263d0967","msg":"User credentials created"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079922513,"env":"test","module":"auth-routes","userId":"0b583d04-8b88-4ee1-a92b-16d2c827c368","email":"middleware-test-HZvEcB6dge93BIL8QUGlv@example.com","msg":"User registered"}
{"level":40,"time":1768079922516,"env":"test","module":"mfa-service","userId":"4841f87e080232478387d83110df8954","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079922516,"env":"test","module":"auth-routes","userId":"4841f87e080232478387d83110df8954","msg":"MFA verification failed during login"}
{"level":50,"time":1768079922523,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079922532,"env":"test","module":"email-queue","jobId":"e14ba021-971a-4257-a080-599cdaaf55c6","to":"session-test-GBc9-HS07VjRAI3MXfH6-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31mÎ“Â¥Â»[39m tests/integration/ai/workflowEdit.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 1397[2mms[22m[39m
     [2m[90mÎ“Ã¥Ã´[39m[22m should create draft version on successful AI edit
     [2m[90mÎ“Ã¥Ã´[39m[22m should enforce draft mode (revert active workflow to draft)
     [2m[90mÎ“Ã¥Ã´[39m[22m should not create version when no changes detected (checksum match)
     [2m[90mÎ“Ã¥Ã´[39m[22m should reject unauthorized access
     [2m[90mÎ“Ã¥Ã´[39m[22m should reject unsafe DataVault operations
     [2m[90mÎ“Ã¥Ã´[39m[22m should handle multi-operation edits with tempId resolution
     [2m[90mÎ“Ã¥Ã´[39m[22m should create BEFORE and AFTER snapshots
     [2m[90mÎ“Ã¥Ã´[39m[22m should rollback on validation failure
{"level":30,"time":1768079922582,"env":"test","module":"email-queue","jobId":"f15356b9-cc8b-48e4-aafe-fae27b88479a","to":"protected-test-HUbsVur1c_MQOQACLOSt3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079922591,"env":"test","module":"auth-routes","userId":"2f302675-e981-45c0-85d5-ac29815e1571","email":"session-test-GBc9-HS07VjRAI3MXfH6-@example.com","msg":"User registered"}
{"level":30,"time":1768079922482,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
{"level":30,"time":1768079922599,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1768079922599,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768079922600,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1768079922606,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1768079922615,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079922639,"env":"test","module":"auth-routes","userId":"04899b2e-16f7-46c3-bef1-6145263d0967","email":"protected-test-HUbsVur1c_MQOQACLOSt3@example.com","msg":"User registered"}
{"level":50,"time":1768079922707,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/metrics.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 2870[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should expose /metrics endpoint[39m[33m 321[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should protect /metrics if API key is set[32m 132[2mms[22m[39m
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768079923013,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079923137,"env":"test","module":"auth-routes","userId":"0b583d04-8b88-4ee1-a92b-16d2c827c368","msg":"User logged in successfully"}
{"level":30,"time":1768079923161,"env":"test","module":"user-credentials-repository","userId":"2769fe2a-fc5a-4365-ad37-e5632f8e8ecc","msg":"User credentials created"}
{"level":30,"time":1768079923166,"env":"test","module":"auth-routes","userId":"0e9e4a94555e91976a4e109ec4f494ee","msg":"User logged in successfully"}
{"level":30,"time":1768079923190,"env":"test","module":"audit-log-service","userId":"0b583d04-8b88-4ee1-a92b-16d2c827c368","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079923221,"env":"test","module":"audit-log-service","userId":"0e9e4a94555e91976a4e109ec4f494ee","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768079923271,"env":"test","module":"email-queue","jobId":"42525ad6-4dea-463b-bbe4-613872f3c681","to":"session-test-rCfhQ9tVLHgdDALj8b0G_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079923327,"env":"test","module":"auth-routes","userId":"0e9e4a94555e91976a4e109ec4f494ee","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768079923329,"env":"test","module":"auth-routes","userId":"2769fe2a-fc5a-4365-ad37-e5632f8e8ecc","email":"session-test-rCfhQ9tVLHgdDALj8b0G_@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079923439,"env":"test","module":"user-credentials-repository","userId":"603f06c7-71d2-4e20-93ce-3cfa5cec97e4","msg":"User credentials created"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould require correct password to disable MFA
[22m[39m[TEST UTILS] MFA Secret verified for 8d3a4f5085e6e38cfbffc29d8a95be1e

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079923542,"env":"test","module":"email-queue","jobId":"e76f0d20-63b5-4c40-a56b-a5c65755054e","to":"protected-test-CHMJb-mER_H5kY9DEremQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079923593,"env":"test","module":"auth-routes","userId":"603f06c7-71d2-4e20-93ce-3cfa5cec97e4","email":"protected-test-CHMJb-mER_H5kY9DEremQ@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768079923711,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079923764,"env":"test","module":"intake-service","runId":"eaf11c4b-d099-4d09-a459-3ba091e59875","slug":"hybrid-invalid-PT9hMSBYPKpRfD2B_d_9T","msg":"Created intake run"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":50,"time":1768079923983,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079924070,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079924184,"env":"test","module":"mfa-service","userId":"8d3a4f5085e6e38cfbffc29d8a95be1e","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079924184,"env":"test","module":"auth-routes","userId":"8d3a4f5085e6e38cfbffc29d8a95be1e","msg":"MFA verification failed during login"}
{"level":50,"time":1768079924191,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079924200,"env":"test","module":"user-credentials-repository","userId":"21210df5-183c-4498-97af-d58b7fa0ddb2","msg":"User credentials created"}
{"level":30,"time":1768079924210,"env":"test","module":"user-credentials-repository","userId":"d0c3608d-2ee2-44d8-a858-73a32295974c","msg":"User credentials created"}
{"level":30,"time":1768079924306,"env":"test","module":"email-queue","jobId":"7beb59ac-6c5e-43d3-84d4-be116ce49a6c","to":"session-test-1l46qtJeWqi24VMVdzj8l@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079924321,"env":"test","module":"email-queue","jobId":"b425cbb5-f238-4b9c-8c0c-2b36a42033d8","to":"middleware-test-OhjfEr5FccfO_9TxEcDgQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079924331,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079924360,"env":"test","module":"auth-routes","userId":"21210df5-183c-4498-97af-d58b7fa0ddb2","email":"session-test-1l46qtJeWqi24VMVdzj8l@example.com","msg":"User registered"}
{"level":30,"time":1768079924381,"env":"test","module":"auth-routes","userId":"d0c3608d-2ee2-44d8-a858-73a32295974c","email":"middleware-test-OhjfEr5FccfO_9TxEcDgQ@example.com","msg":"User registered"}
{"level":30,"time":1768079924408,"env":"test","module":"user-credentials-repository","userId":"a7d0faf5-0aba-4779-9a04-cda2d2dbf1c6","msg":"User credentials created"}
{"level":30,"time":1768079924433,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1768079924454,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079924460,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079924520,"env":"test","module":"email-queue","jobId":"b6e69571-1120-4937-8c06-1cfd4859a18a","to":"protected-test-E_ZeQDgNyhy1LvBt0LPrq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079924578,"env":"test","module":"auth-routes","userId":"a7d0faf5-0aba-4779-9a04-cda2d2dbf1c6","email":"protected-test-E_ZeQDgNyhy1LvBt0LPrq@example.com","msg":"User registered"}
 [31mÎ“Â¥Â»[39m tests/integration/session.management.real.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 29449[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions for current user[39m[33m 2021[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current session correctly[39m[33m 1372[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude revoked sessions[39m[33m 1744[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should order sessions by last used (most recent first)[39m[33m 2167[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter sessions by current user only[39m[33m 2159[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 402[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1535[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 1064[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent session[39m[33m 1070[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking other user's session[39m[33m 1700[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all other sessions[39m[33m 2934[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should keep current session active[39m[33m 1672[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 if no active session found [33m 1487[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all trusted devices[39m[33m 1136[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle user with single session gracefully [33m 1809[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should include device metadata in sessions [33m 1671[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not expose sensitive token data [33m 1576[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track session activity timestamps[39m[33m 1133[2mms[22m[39m
{"level":50,"time":1768079924752,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1768079924868,"env":"test","module":"email-queue","jobId":"4352d882-ab05-48ed-a4b1-1dfc16dd80b1","to":"test-1768079924191-bxqjw@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079924868,"env":"test","module":"auth-service","email":"test-1768079924191-bxqjw@example.com","msg":"Password reset email sent"}
{"level":50,"time":1768079924931,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mÎ“Â¥Â»[39m tests/integration/analytics_service.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1313[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should generate events and metrics on run completion[39m[32m 64[2mms[22m[39m
{"level":50,"time":1768079924953,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079924958,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079924969,"env":"test","module":"auth-routes","userId":"d0c3608d-2ee2-44d8-a858-73a32295974c","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079925027,"env":"test","module":"audit-log-service","userId":"d0c3608d-2ee2-44d8-a858-73a32295974c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768079925041,"env":"test","module":"email-queue","jobId":"eb793189-479c-4f00-80a9-4069afde2aa0","to":"newuser_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Regeneration[2m > [22m[2mshould regenerate backup codes
[22m[39m[TEST UTILS] MFA Secret verified for 782a0523d2be30076372de16e6bfeddc

{"level":50,"time":1768079925211,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079925331,"env":"test","module":"user-credentials-repository","error":{},"userId":"4d302f7c832f1027c5e373c895e178ca","msg":"Failed to update user password"}
{"level":50,"time":1768079925331,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":30,"time":1768079925395,"env":"test","module":"user-credentials-repository","userId":"23c0cb60-6493-4a2b-a178-97a7786149e3","msg":"User credentials created"}
{"level":30,"time":1768079925449,"env":"test","module":"user-credentials-repository","userId":"d6dbab76-e4db-42b3-8726-93cef9c31d25","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768079925503,"env":"test","module":"email-queue","jobId":"62056074-cdde-4912-a249-21f947f50a2e","to":"protected-test-xoBgO-CFVCnLRWZtLHvgr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079925564,"env":"test","module":"auth-routes","userId":"23c0cb60-6493-4a2b-a178-97a7786149e3","email":"protected-test-xoBgO-CFVCnLRWZtLHvgr@example.com","msg":"User registered"}
{"level":30,"time":1768079925569,"env":"test","module":"email-queue","jobId":"41d2187a-d581-444f-8c0d-dba9767d4636","to":"session-test-Zoo3Jzqe3yG1OFzVEGFvb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079925631,"env":"test","module":"auth-routes","userId":"d6dbab76-e4db-42b3-8726-93cef9c31d25","email":"session-test-Zoo3Jzqe3yG1OFzVEGFvb@example.com","msg":"User registered"}
{"level":30,"time":1768079925644,"env":"test","module":"user-credentials-repository","userId":"7b7cdf0a-8297-4f06-bd57-dff209be625a","msg":"User credentials created"}
{"level":30,"time":1768079925755,"env":"test","module":"email-queue","jobId":"c1bdddc7-25e0-43c1-b0bb-21d0f3f3b560","to":"middleware-test-WpuDhv3rh_uU9eh1E9n__@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768079925813,"env":"test","module":"auth-routes","userId":"7b7cdf0a-8297-4f06-bd57-dff209be625a","email":"middleware-test-WpuDhv3rh_uU9eh1E9n__@example.com","msg":"User registered"}
{"level":50,"time":1768079925941,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079926007,"env":"test","module":"auth-routes","userId":"782a0523d2be30076372de16e6bfeddc","msg":"Login requires MFA verification"}
{"level":50,"time":1768079926046,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768079926113,"env":"test","module":"mfa-service","userId":"782a0523d2be30076372de16e6bfeddc","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768079926113,"env":"test","module":"auth-routes","userId":"782a0523d2be30076372de16e6bfeddc","msg":"MFA verification failed during login"}
{"level":50,"time":1768079926120,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079926160,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079926402,"env":"test","module":"user-credentials-repository","userId":"a257d4b7-6a03-4ea6-bc38-318749d29003","msg":"User credentials created"}
{"level":30,"time":1768079926504,"env":"test","module":"email-queue","jobId":"ac421e25-f754-4af0-8032-1f34bd881567","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768079926509,"env":"test","module":"email-queue","jobId":"0371e9e7-222a-4ebf-bbec-069dda6e3237","to":"protected-test-IU-7P2KXjY3YCo92n6kqF@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079926569,"env":"test","module":"auth-routes","userId":"a257d4b7-6a03-4ea6-bc38-318749d29003","email":"protected-test-IU-7P2KXjY3YCo92n6kqF@example.com","msg":"User registered"}
{"level":30,"time":1768079926628,"env":"test","module":"user-credentials-repository","userId":"90920107-7fe6-4a86-8e9b-3b376090ecb0","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079926738,"env":"test","module":"email-queue","jobId":"6c68ee49-7c51-4daf-954e-62b5af51b1bb","to":"middleware-test-BCcbM3R3z-Wqf7A1lSTAc@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/session.management.integration.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 23659[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create refresh token on login[39m[33m 963[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track device metadata in session[39m[33m 971[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create separate sessions for multiple device logins[39m[33m 1555[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions for user[39m[33m 953[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current session correctly[39m[33m 941[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not include revoked sessions[39m[33m 1584[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should order sessions by last used (most recent first)[39m[33m 987[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 710[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1084[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent revoking current session [33m 1572[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow revoking other users sessions[39m[33m 2365[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent session ID[39m[33m 1022[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all sessions except current[39m[33m 1788[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all trusted devices[39m[33m 1026[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require active session [33m 778[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject refresh token after 30 days[39m[33m 1004[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle multiple concurrent logins[39m[33m 1248[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle concurrent token refreshes[39m[33m 1086[2mms[22m[39m
{"level":30,"time":1768079926803,"env":"test","module":"auth-routes","userId":"90920107-7fe6-4a86-8e9b-3b376090ecb0","email":"middleware-test-BCcbM3R3z-Wqf7A1lSTAc@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768079926951,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768079927139,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079927176,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079927368,"env":"test","module":"user-credentials-repository","userId":"6799bb7f-8fde-4db8-861e-5873cc116e2e","msg":"User credentials created"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1768079927472,"env":"test","module":"email-queue","jobId":"92a40702-9108-4c48-ac6e-e916dafcb966","to":"protected-test-asgIe8ElZAIjw2w3Bv071@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079927476,"env":"test","module":"auth-routes","userId":"d41549866eb8888f88f456aaf1b3da57","msg":"User logged in successfully"}
{"level":30,"time":1768079927493,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079927513,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts[2m > [22m[2mStage 13: Workflow Snapshots & Versioning
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079927501,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079927502,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079927507,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079927513,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079927513,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079927513,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079927513,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079927529,"env":"test","module":"auth-routes","userId":"6799bb7f-8fde-4db8-861e-5873cc116e2e","email":"protected-test-asgIe8ElZAIjw2w3Bv071@example.com","msg":"User registered"}
{"level":30,"time":1768079927530,"env":"test","module":"audit-log-service","userId":"d41549866eb8888f88f456aaf1b3da57","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079927559,"env":"test","module":"user-credentials-repository","userId":"593e4cb1-0b38-4556-b390-a0c42d4ccbff","msg":"User credentials created"}
{"level":30,"time":1768079927672,"env":"test","module":"email-queue","jobId":"194748a6-ca49-464f-be74-a29593d72ca0","to":"middleware-test-kfj7yIuAr0hpwxdEQlK0n@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079927732,"env":"test","module":"auth-routes","userId":"593e4cb1-0b38-4556-b390-a0c42d4ccbff","email":"middleware-test-kfj7yIuAr0hpwxdEQlK0n@example.com","msg":"User registered"}
{"level":30,"time":1768079927788,"env":"test","module":"email-queue","jobId":"9dbc2c89-3029-4bb0-9391-2f5d6f2cce76","to":"test-1768079927143-uyfgl@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079927788,"env":"test","module":"auth-service","email":"test-1768079927143-uyfgl@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768079927989,"env":"test","module":"email-queue","jobId":"1ae404c0-93a0-4d1e-86f2-c8c5eeeaaccc","to":"newuser_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":50,"time":1768079928008,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079928228,"env":"test","module":"auth-routes","userId":"6799bb7f-8fde-4db8-861e-5873cc116e2e","msg":"User logged in successfully"}
{"level":30,"time":1768079928281,"env":"test","module":"audit-log-service","userId":"6799bb7f-8fde-4db8-861e-5873cc116e2e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079928357,"env":"test","module":"auth-routes","userId":"593e4cb1-0b38-4556-b390-a0c42d4ccbff","msg":"User logged in successfully"}
{"level":30,"time":1768079928417,"env":"test","module":"audit-log-service","userId":"593e4cb1-0b38-4556-b390-a0c42d4ccbff","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [31mÎ“Â¥Â»[39m tests/integration/api.snapshots.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1471[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should maintain immutability of runs across versions[39m[33m 304[2mms[22m[39m
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079928795,"env":"test","module":"user-credentials-repository","userId":"9f5ea00c-9567-4cc2-99cf-f2470ef3e967","msg":"User credentials created"}
{"level":30,"time":1768079928898,"env":"test","module":"email-queue","jobId":"219d091f-8507-44fb-a4f1-4b08a9f0d2f4","to":"protected-test-evraVZ5-U2TfU1mbemZoI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079928954,"env":"test","module":"auth-routes","userId":"9f5ea00c-9567-4cc2-99cf-f2470ef3e967","email":"protected-test-evraVZ5-U2TfU1mbemZoI@example.com","msg":"User registered"}
{"level":30,"time":1768079929017,"env":"test","module":"user-credentials-repository","userId":"b8612981-a3da-4b0a-8df3-e40dbc92d923","msg":"User credentials created"}
{"level":30,"time":1768079929129,"env":"test","module":"email-queue","jobId":"70006436-f64a-4134-8be8-1d9bc8b2e311","to":"middleware-test-IgBwDqVEOHVQvZcNpTfSD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079929185,"env":"test","module":"auth-routes","userId":"b8612981-a3da-4b0a-8df3-e40dbc92d923","email":"middleware-test-IgBwDqVEOHVQvZcNpTfSD@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079929240,"env":"test","module":"auth-routes","userId":"62d7a7dbd3e961ec57dcf87f71203ae1","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079929390,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
 [31mÎ“Â¥Â»[39m tests/integration/mfa.flow.real.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m16 failed[39m[2m)[22m[33m 34320[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete full MFA setup flow[39m[33m 2156[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid TOTP code during setup [33m 2179[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow MFA setup if already enabled[39m[33m 1588[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate unique backup codes[39m[33m 1086[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should store hashed backup codes[39m[33m 1146[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require MFA for enabled users[39m[33m 1520[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete MFA login with valid TOTP[39m[33m 1625[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid TOTP during login [33m 1588[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept TOTP codes within 60-second window[39m[33m 1603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with valid backup code[39m[33m 2602[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark backup code as used[39m[33m 1009[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent backup code reuse[39m[33m 2084[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should try TOTP before backup code[39m[33m 2014[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return MFA status for user[39m[33m 1226[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return backup codes count for MFA users[39m[33m 1647[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should disable MFA with password verification[39m[33m 1681[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require correct password to disable MFA[39m[33m 1668[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should regenerate backup codes[39m[33m 1929[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return error if MFA not enabled [33m 1523[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce MFA for tenant users when required by tenant [33m 1647[2mms[22m[39m
{"level":30,"time":1768079929417,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079929400,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079929401,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079929410,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079929416,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079929416,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079929416,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079929417,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests[2m > [22m[2mPOST /api/ai/doc/analyze[2m > [22m[2mshould analyze a DOCX file and return variables
[22m[39mFAIL_STATUS: 500
FAIL_BODY: {}

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768079929481,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079929507,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/js_helpers.test.ts[2m > [22m[2mDetailed Verification: JS Helper Availability
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079929491,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079929492,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079929500,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079929506,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079929507,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079929507,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079929507,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079929641,"env":"test","module":"auth-routes","userId":"9f5ea00c-9567-4cc2-99cf-f2470ef3e967","msg":"User logged in successfully"}
{"level":30,"time":1768079929694,"env":"test","module":"audit-log-service","userId":"9f5ea00c-9567-4cc2-99cf-f2470ef3e967","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079929772,"env":"test","module":"auth-routes","userId":"b8612981-a3da-4b0a-8df3-e40dbc92d923","msg":"User logged in successfully"}
{"level":30,"time":1768079929781,"env":"test","module":"auth-routes","userId":"3e6d150c46ceaa9cf37246d2f68e7ebd","msg":"User logged in successfully"}
{"level":30,"time":1768079929829,"env":"test","module":"audit-log-service","userId":"b8612981-a3da-4b0a-8df3-e40dbc92d923","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079929834,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079929837,"env":"test","module":"audit-log-service","userId":"3e6d150c46ceaa9cf37246d2f68e7ebd","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079929843,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [31mÎ“Â¥Â»[39m tests/integration/api.ai.doc.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1032[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should analyze a DOCX file and return variables[39m[32m 38[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fail if no file is provided[39m[32m 12[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should suggest mappings between template and workflow variables[32m 93[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return improvement suggestions[32m 8[2mms[22m[39m
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

 [31mÎ“Â¥Â»[39m tests/integration/js_helpers.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1215[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should execute a JS block that uses helper functions[39m[32m 133[2mms[22m[39m
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768079930237,"env":"test","module":"user-credentials-repository","userId":"0ef9a87f-9867-48e3-abcd-e50ee56f0613","msg":"User credentials created"}
{"level":30,"time":1768079930270,"env":"test","module":"user-credentials-repository","userId":"c5ae6e13-2401-4b7c-b6f4-9b2a06b11acd","msg":"User credentials created"}
{"level":30,"time":1768079930343,"env":"test","module":"email-queue","jobId":"6b913168-f5b6-4171-8b61-afdf674c4a93","to":"protected-test-6M3syE2Q3aPP24Jzmhrg8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079930381,"env":"test","module":"email-queue","jobId":"7296e757-c7ca-4f34-9d43-85d6b95e411c","to":"middleware-test-uImonQV90RkMvMhLLQF6N@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079930397,"env":"test","module":"auth-routes","userId":"0ef9a87f-9867-48e3-abcd-e50ee56f0613","email":"protected-test-6M3syE2Q3aPP24Jzmhrg8@example.com","msg":"User registered"}
{"level":30,"time":1768079930432,"env":"test","module":"auth-routes","userId":"c5ae6e13-2401-4b7c-b6f4-9b2a06b11acd","email":"middleware-test-uImonQV90RkMvMhLLQF6N@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":50,"time":1768079930760,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079930769,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079930815,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079931191,"env":"test","module":"user-credentials-repository","userId":"22e49464-00fe-4268-b834-a9977a55340c","msg":"User credentials created"}
{"level":30,"time":1768079931194,"env":"test","module":"user-credentials-repository","userId":"9b6421f5-8f14-4103-a5e8-3817afdd471b","msg":"User credentials created"}
{"level":30,"time":1768079931298,"env":"test","module":"email-queue","jobId":"d4a8879c-d65e-47ba-b4c4-1a44f9745646","to":"middleware-test-5K6fUtubgoO2-yxv1K0Ld@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079931309,"env":"test","module":"email-queue","jobId":"f820bcbb-1aed-4a33-8fe4-00d7883753f0","to":"protected-test-YNjqGxr_yjpz6TDliZqQa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079931356,"env":"test","module":"auth-routes","userId":"22e49464-00fe-4268-b834-a9977a55340c","email":"middleware-test-5K6fUtubgoO2-yxv1K0Ld@example.com","msg":"User registered"}
{"level":30,"time":1768079931365,"env":"test","module":"auth-routes","userId":"9b6421f5-8f14-4103-a5e8-3817afdd471b","email":"protected-test-YNjqGxr_yjpz6TDliZqQa@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/AuthService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768079931686,"env":"test","module":"email-queue","jobId":"a42fc2ab-c1fa-46ba-bc02-99feb8528269","to":"newuser_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":50,"time":1768079931693,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079931697,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079931737,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079932095,"env":"test","module":"user-credentials-repository","userId":"f266c48e-dee9-46ee-9814-0e2788cbafcf","msg":"User credentials created"}
{"level":30,"time":1768079932124,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079932131,"env":"test","module":"user-credentials-repository","userId":"29797342-a5d6-484f-96e7-600f78d729ba","msg":"User credentials created"}
{"level":30,"time":1768079932143,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079932131,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079932132,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079932137,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079932142,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079932142,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079932143,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079932143,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768079932197,"env":"test","module":"email-queue","jobId":"7251b175-d9c0-452e-9baf-049586b546b8","to":"middleware-test-3j91f961jHWaK717-8xmp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079932235,"env":"test","module":"email-queue","jobId":"ce943ff8-af50-413e-a70f-9b986f038718","to":"protected-test-8fYpV0k5l6QSOm9_NarMD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079932251,"env":"test","module":"auth-routes","userId":"f266c48e-dee9-46ee-9814-0e2788cbafcf","email":"middleware-test-3j91f961jHWaK717-8xmp@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079932287,"env":"test","module":"auth-routes","userId":"29797342-a5d6-484f-96e7-600f78d729ba","email":"protected-test-8fYpV0k5l6QSOm9_NarMD@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079932550,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjZkMDdiMTNjLThkODAtNDc5Ni05OWJmLTkwZjc3MzUyZjMyZCIsInJvbGUiOiJhZG1pbiIsInRlbmFudFJvbGUiOiJvd25lciIsImlhdCI6MTc2ODA3OTkzMiwiZXhwIjoxNzY4MDgwODMyfQ.lht1UbPgfkJijC48BnX7H5E9wXalBv_uML3OQk5IvR8",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": null,
    "lastName": null,
    "profileImageUrl": null,
    "tenantId": "6d07b13c-8d80-4796-99bf-90f77352f32d",
    "role": "admin",
    "tenantRole": "owner"
  }
}

{"level":50,"time":1768079932579,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079932579,"env":"test","module":"email-queue","jobId":"5ccbe3a5-f571-44e3-9961-aedc4ce3f87b","to":"org-member@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
{"level":50,"time":1768079932660,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079932774,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768079932970,"env":"test","module":"user-credentials-repository","userId":"7eb70087-a80f-447a-87ee-cbabe9be5d53","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould complete MFA login with valid TOTP code
[22m[39m[TEST UTILS] MFA Secret verified for daed3ba1446fb7fb02e3b2d5bc48979e

{"level":30,"time":1768079933053,"env":"test","module":"user-credentials-repository","userId":"28564e4b-d0df-47fc-9a54-3c37e366f148","msg":"User credentials created"}
{"level":30,"time":1768079933074,"env":"test","module":"email-queue","jobId":"c47e5e66-32a9-49d0-97fe-c3aa33cec1cd","to":"middleware-test-PZNKUxgTVLQXDQbZA_iXX@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079933087,"env":"test","module":"email-queue","jobId":"c36102ad-8f35-4876-84aa-6f23eed9a388","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768079933131,"env":"test","module":"auth-routes","userId":"7eb70087-a80f-447a-87ee-cbabe9be5d53","email":"middleware-test-PZNKUxgTVLQXDQbZA_iXX@example.com","msg":"User registered"}
{"level":30,"time":1768079933155,"env":"test","module":"email-queue","jobId":"a41f0ce2-3ec9-4a4f-bf0a-c4901cc1f023","to":"protected-test-PLJ8FE6m8wZmAV5y7cdJs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079933209,"env":"test","module":"auth-routes","userId":"28564e4b-d0df-47fc-9a54-3c37e366f148","email":"protected-test-PLJ8FE6m8wZmAV5y7cdJs@example.com","msg":"User registered"}
{"level":30,"time":1768079933703,"env":"test","module":"auth-routes","userId":"7eb70087-a80f-447a-87ee-cbabe9be5d53","msg":"User logged in successfully"}
{"level":30,"time":1768079933758,"env":"test","module":"audit-log-service","userId":"7eb70087-a80f-447a-87ee-cbabe9be5d53","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768079933762,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768079933835,"env":"test","module":"auth-routes","userId":"daed3ba1446fb7fb02e3b2d5bc48979e","msg":"Login requires MFA verification"}
{"level":30,"time":1768079933878,"env":"test","module":"auth-routes","userId":"28564e4b-d0df-47fc-9a54-3c37e366f148","msg":"User logged in successfully"}
{"level":30,"time":1768079933927,"env":"test","module":"audit-log-service","userId":"28564e4b-d0df-47fc-9a54-3c37e366f148","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079933942,"env":"test","module":"mfa-service","userId":"daed3ba1446fb7fb02e3b2d5bc48979e","msg":"TOTP verification successful"}
{"level":30,"time":1768079934003,"env":"test","module":"auth-routes","userId":"daed3ba1446fb7fb02e3b2d5bc48979e","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/auth.middleware.integration.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m19 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 31388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow access with valid JWT Bearer token[39m[33m 955[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when no token provided[39m[33m 924[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 with invalid token[39m[33m 912[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 with expired token[39m[33m 904[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should proceed without authentication if no token provided
[31m       [31mâ”œÃ¹[31m should authenticate with JWT Bearer token[39m[33m 937[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with refresh token cookie (GET only)[39m[33m 923[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for POST requests (mutation-strict)[39m[33m 908[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for PUT requests[39m[33m 1012[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject cookie auth for DELETE requests [33m 1270[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow cookie auth for HEAD requests[39m[33m 959[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prioritize JWT over cookie when both present[39m[33m 2201[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when no auth provided [33m 1245[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when both JWT and cookie are invalid[39m[33m 1037[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with JWT if provided[39m[33m 950[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with cookie if JWT not provided[39m[33m 1005[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should proceed anonymously if no auth provided[39m[33m 1026[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should proceed anonymously if both JWT and cookie are invalid [33m 2004[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should only allow safe methods for cookie auth [33m 1447[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should ignore cookies when Bearer token present[39m[33m 950[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach userId to request[39m[33m 979[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should attach userEmail to request [33m 1396[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return consistent error format for missing token [33m 1299[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent error format for invalid token[39m[33m 927[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent error format for expired token[39m[33m 936[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle malformed JWT gracefully[39m[33m 883[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle JWT with wrong algorithm [33m 1182[2mms[22m[39m
{"level":30,"time":1768079934351,"env":"test","workflowId":"af83fdec-e750-4b42-ad60-270ccf5a6198","userId":"26c2e121-bc22-4969-bf38-4aec7973e14f","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768079934369,"env":"test","module":"writeback-execution-service","runId":"37d420e5-692f-4e08-9718-fc0ece74f79d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","msg":"Executing writeback mappings for completed run"}
{"level":30,"time":1768079934375,"env":"test","module":"user-credentials-repository","userId":"112f0e21-10ed-4fc7-ab73-83fa7f4212e9","msg":"User credentials created"}
{"level":30,"time":1768079934425,"env":"test","module":"writeback-execution-service","runId":"37d420e5-692f-4e08-9718-fc0ece74f79d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","mappingCount":1,"msg":"Found writeback mappings"}
{"level":30,"time":1768079934483,"env":"test","module":"email-queue","jobId":"7544638c-7715-4fd7-8413-73c7f23c9dea","to":"protected-test-J04a0EIfAjGhaRkjwKeIo@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079934536,"env":"test","module":"auth-routes","userId":"112f0e21-10ed-4fc7-ab73-83fa7f4212e9","email":"protected-test-J04a0EIfAjGhaRkjwKeIo@example.com","msg":"User registered"}
{"level":50,"time":1768079934569,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"Failed to render template"}
{"level":30,"time":1768079934641,"env":"test","module":"writeback-execution-service","runId":"37d420e5-692f-4e08-9718-fc0ece74f79d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","mappingId":"a4b2772e-a04e-4cd0-9f7b-75137f1a3b80","tableId":"867a0e86-9fe1-4eb5-b3a5-b61357cf9771","msg":"Executing writeback mapping"}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768079934778,"env":"test","workflowId":"af83fdec-e750-4b42-ad60-270ccf5a6198","userId":"df5cbab1-fd98-4b10-a77c-e6252535fe56","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":50,"time":1768079934907,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768079935005,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":30,"time":1768079935062,"env":"test","module":"writeback-execution-service","runId":"37d420e5-692f-4e08-9718-fc0ece74f79d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","mappingId":"a4b2772e-a04e-4cd0-9f7b-75137f1a3b80","columnCount":3,"msg":"Successfully created DataVault row"}
{"level":30,"time":1768079935062,"env":"test","module":"writeback-execution-service","runId":"37d420e5-692f-4e08-9718-fc0ece74f79d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","rowsCreated":1,"errorCount":0,"msg":"Writeback execution completed"}
{"level":30,"time":1768079935153,"env":"test","module":"email-queue","jobId":"8f1ea304-daa5-45b0-9e35-f5708b6b4ba7","to":"newuser_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768079935290,"env":"test","module":"user-credentials-repository","userId":"ee917d2f-533a-4836-96b3-15f99ed547fd","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould reject invalid MFA code
[22m[39m[TEST UTILS] MFA Secret verified for b35e3cfdaa6bf9170b5b0cfb33ce14e3

{"level":30,"time":1768079935391,"env":"test","module":"email-queue","jobId":"94b48d39-b544-4a0e-8864-735d9cc4d227","to":"protected-test-ydgYGDFTEwBtDdf-2ldGy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079935447,"env":"test","module":"auth-routes","userId":"ee917d2f-533a-4836-96b3-15f99ed547fd","email":"protected-test-ydgYGDFTEwBtDdf-2ldGy@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":40,"time":1768079935740,"env":"test","module":"mfa-service","userId":"b35e3cfdaa6bf9170b5b0cfb33ce14e3","msg":"TOTP verification failed"}
{"level":40,"time":1768079935740,"env":"test","module":"auth-routes","userId":"b35e3cfdaa6bf9170b5b0cfb33ce14e3","msg":"MFA verification failed during login"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts[2m > [22m[2mAuthService[2m > [22m[2mJWT Token Management[2m > [22m[2mverifyToken()[2m > [22m[2mshould throw error for invalid token signature
[22m[39mDEBUG: verifyToken threw: Invalid or malformed token InvalidTokenError

{"level":30,"time":1768079936101,"env":"test","module":"auth-routes","userId":"ee917d2f-533a-4836-96b3-15f99ed547fd","msg":"User logged in successfully"}
{"level":30,"time":1768079936138,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768079936140,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768079936153,"env":"test","module":"audit-log-service","userId":"ee917d2f-533a-4836-96b3-15f99ed547fd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768079936158,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768079936159,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1768079936162,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1768079936165,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768079936167,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768079936169,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768079936170,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
 [31mÎ“Â¥Â»[39m tests/integration/auth.routes.real.test.ts [2m([22m[2m26 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 41175[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should register a new user successfully [33m 1611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for invalid email format [33m 844[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for weak password [33m 886[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 409 for duplicate email [33m 1508[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set httpOnly refresh token cookie [33m 1505[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with valid credentials[39m[33m 1564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid password [33m 1506[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for non-existent user [33m 1024[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 403 for unverified email[39m[33m 1704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should record failed login attempt [33m 1608[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return requiresMfa=true for MFA-enabled users[39m[33m 1406[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should lock account after 5 failed attempts[39m[33m 3018[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should logout and clear refresh token cookie [33m 1892[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token with valid refresh token[39m[33m 2092[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for missing refresh token [33m 887[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should rotate refresh token after use [33m 2361[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should send password reset email for existing user [33m 1573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not reveal if email exists (security) [33m 953[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reset password with valid token[39m[33m 2015[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for invalid token [33m 919[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for weak new password [33m 1641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return current user for valid token [33m 2048[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for missing token [33m 865[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid token [33m 865[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should complete MFA login with valid TOTP code [33m 2323[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject invalid MFA code [33m 1723[2mms[22m[39m
{"level":30,"time":1768079936320,"env":"test","module":"writeback-execution-service","runId":"715444cf-6147-4a00-a07d-a70f88191d4d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","msg":"Executing writeback mappings for completed run"}
{"level":30,"time":1768079936374,"env":"test","module":"writeback-execution-service","runId":"715444cf-6147-4a00-a07d-a70f88191d4d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","mappingCount":1,"msg":"Found writeback mappings"}
{"level":50,"time":1768079936424,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768079936586,"env":"test","module":"writeback-execution-service","runId":"715444cf-6147-4a00-a07d-a70f88191d4d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","mappingId":"a4b2772e-a04e-4cd0-9f7b-75137f1a3b80","tableId":"867a0e86-9fe1-4eb5-b3a5-b61357cf9771","msg":"Executing writeback mapping"}
{"level":30,"time":1768079936809,"env":"test","module":"user-credentials-repository","userId":"2951b12a-dc79-4530-b853-7ae9f43a2905","msg":"User credentials created"}
{"level":30,"time":1768079936809,"env":"test","workflowId":"af83fdec-e750-4b42-ad60-270ccf5a6198","userId":"26c2e121-bc22-4969-bf38-4aec7973e14f","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768079936913,"env":"test","module":"email-queue","jobId":"1a0edbbe-2186-4ec6-a72d-88bc9265656a","to":"protected-test-6v2uAqs2ZBDlPS79EqbFs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079936967,"env":"test","module":"auth-routes","userId":"2951b12a-dc79-4530-b853-7ae9f43a2905","email":"protected-test-6v2uAqs2ZBDlPS79EqbFs@example.com","msg":"User registered"}
{"level":30,"time":1768079937011,"env":"test","module":"writeback-execution-service","runId":"715444cf-6147-4a00-a07d-a70f88191d4d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","mappingId":"a4b2772e-a04e-4cd0-9f7b-75137f1a3b80","columnCount":3,"msg":"Successfully created DataVault row"}
{"level":30,"time":1768079937011,"env":"test","module":"writeback-execution-service","runId":"715444cf-6147-4a00-a07d-a70f88191d4d","workflowId":"230e3ffb-bb91-4fea-994a-4dadab41dc9d","rowsCreated":1,"errorCount":0,"msg":"Writeback execution completed"}
{"level":30,"time":1768079937011,"env":"test","runId":"715444cf-6147-4a00-a07d-a70f88191d4d","rowsCreated":1,"msg":"DataVault writeback completed"}
{"level":30,"time":1768079937012,"env":"test","runId":"715444cf-6147-4a00-a07d-a70f88191d4d","service":"DocumentGenerationService","msg":"Starting document generation for run"}
{"level":40,"time":1768079937119,"env":"test","runId":"715444cf-6147-4a00-a07d-a70f88191d4d","service":"DocumentGenerationService","allSections":[{"id":"d5c62c61-c8b0-46a0-9574-358b3ec6c6c8","config":{}}],"runId":"715444cf-6147-4a00-a07d-a70f88191d4d","msg":"No Final Documents sections found, skipping generation. This might cause the frontend to hang."}
{"level":30,"time":1768079937297,"env":"test","module":"email-queue","jobId":"4ae63dc4-a66d-4e12-9159-91fce0dd0094","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768079937346,"env":"test","module":"email-queue","jobId":"0ee95e31-76fb-4dcb-8598-d8f06f4f24c7","to":"duplicate@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768079937632,"env":"test","module":"auth-routes","userId":"2951b12a-dc79-4530-b853-7ae9f43a2905","msg":"User logged in successfully"}
{"level":30,"time":1768079937692,"env":"test","module":"audit-log-service","userId":"2951b12a-dc79-4530-b853-7ae9f43a2905","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: ad37df1f-e85e-43bf-a2e0-16b725301512 tenantId: 6d07b13c-8d80-4796-99bf-90f77352f32d userId: google-user-id

{"level":30,"time":1768079937973,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768079938241,"env":"test","module":"email-queue","jobId":"51565060-a253-4cb4-8426-8ac0cd3f1b22","to":"expired@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
{"level":30,"time":1768079938278,"env":"test","module":"auth-routes","userId":"2951b12a-dc79-4530-b853-7ae9f43a2905","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 9a675d75-4dad-488d-83cb-730a9d161eb8 tenantId: 6d07b13c-8d80-4796-99bf-90f77352f32d userId: google-user-id

{"level":30,"time":1768079938347,"env":"test","module":"audit-log-service","userId":"2951b12a-dc79-4530-b853-7ae9f43a2905","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768079938447,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":50,"time":1768079938503,"env":"test","error":{"length":371,"name":"error","severity":"ERROR","code":"23503","detail":"Key (row_id)=(5b429f6a-b42e-466a-ba3d-1dbf1dfd6379) is not present in table \"datavault_rows\".","schema":"public","table":"datavault_row_notes","constraint":"datavault_row_notes_row_id_datavault_rows_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Error creating row note"}
{"level":50,"time":1768079938718,"env":"test","error":{},"msg":"Error fetching row notes"}
{"level":30,"time":1768079938739,"env":"test","module":"user-credentials-repository","userId":"af579121-a1a5-40d7-a9dc-36782b2af951","msg":"User credentials created"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079938841,"env":"test","module":"email-queue","jobId":"b3c1e7b8-5f92-4e9b-ba16-8d89f3b9405f","to":"user2-MxkECn2GJwMFdrkVQnVad@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079938895,"env":"test","module":"auth-routes","userId":"af579121-a1a5-40d7-a9dc-36782b2af951","email":"user2-MxkECn2GJwMFdrkVQnVad@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/workflows/runtime-pipelines.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 6554[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create DataVault row on workflow completion [33m 965[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should execute writebacks via RunService.completeRun() [33m 2393[2mms[22m[39m
{"level":30,"time":1768079939060,"env":"test","module":"email-queue","jobId":"385bb4f5-f0d6-4b46-a813-f22bd3558a66","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: be367801-1d25-4048-a1dc-00e4c7b30e7a tenantId: 6d07b13c-8d80-4796-99bf-90f77352f32d userId: google-user-id

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m)[22m[33m 7743[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate different hashes for same password [33m 446[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return true for correct password [33m 455[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return false for incorrect password [33m 465[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should be case-sensitive [33m 443[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle empty password comparison [33m 449[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error for expired token [33m 1104[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with special characters [33m 443[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with newlines and tabs [33m 443[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject password with null bytes (if validation exists) [33m 451[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support complete password reset workflow [33m 474[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should compare password in reasonable time (< 500ms) [33m 475[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079939469,"env":"test","module":"auth-routes","userId":"af579121-a1a5-40d7-a9dc-36782b2af951","msg":"User logged in successfully"}
{"level":30,"time":1768079939524,"env":"test","module":"audit-log-service","userId":"af579121-a1a5-40d7-a9dc-36782b2af951","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 12887[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create organization and auto-create admin membership [33m 885[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return all organizations for user [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array for user with no memberships [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to update organization [33m 783[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should deny non-admin from updating organization [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return all members of organization [33m 927[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to promote member [33m 1167[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to demote other admin [33m 1202[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent self-demotion [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to remove member [33m 1217[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent self-removal [33m 910[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow member to leave organization [33m 1087[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to leave organization [33m 1145[2mms[22m[39m
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

stderr | tests/integration/organizations-workflow.test.ts > Organization Workflow Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-workflow.test.ts:81:7 {
  length: 335,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(df5cbab1-fd98-4b10-a77c-e6252535fe56) is still referenced from table "audit_logs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_user_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 16347[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if template belongs to different project [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should automatically unset other primaries when setting new primary [33m 1122[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list all templates for workflow version [33m 819[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return empty array for version with no templates [33m 556[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get template mapping by id and version [33m 699[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 561[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get template by key [33m 721[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if key not found [33m 556[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get primary template for workflow version [33m 793[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return null when no primary template exists [33m 654[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update mapping key [33m 774[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update isPrimary flag [33m 795[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if new key already exists [33m 798[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 548[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should unset other primaries when setting isPrimary to true [33m 1047[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should detach template from workflow version [33m 749[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 538[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should set template as primary [33m 994[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 533[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support operations within a transaction [33m 825[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should rollback on transaction error [33m 801[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 12736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enqueue a PDF conversion job [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create output with empty storagePath initially [33m 728[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return job status for pending job [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return null for non-existent job [33m 667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should parse attempt count from error field [33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should convert DOCX to PDF immediately [33m 784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle conversion errors gracefully [33m 713[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should start and stop service [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not start if already running [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle stop when not running [33m 610[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should process pending jobs when queue is processed [33m 1029[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should process multiple jobs in batch [33m 1321[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing DOCX output gracefully [33m 824[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support enqueue within transaction [33m 863[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support convertImmediate within transaction [33m 770[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 9140[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 1: Create organization [33m 547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 2: Invite member via email [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 3: Accept invite [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 4: Create workflow owned by user [33m 315[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 5: Transfer workflow to organization [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 6: Org member (user2) can access workflow [33m 426[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 14: Remove member from org [33m 330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 16: Re-add member and verify access restored [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot invite same email twice (pending invite exists) [33m 907[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot accept expired invite [33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot transfer workflow to org user is not a member of [33m 651[2mms[22m[39m
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: a4c2f617-5d8d-43ce-a787-fa21a0ebea33 tenantId: 6d07b13c-8d80-4796-99bf-90f77352f32d userId: google-user-id

 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 16987[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer user-owned project to org [33m 1847[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1509[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org-owned project to another org they belong to [33m 1932[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should detach workflow from project when transferring to different owner [33m 1535[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should keep workflow in project when transferring to same owner [33m 1569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent non-member from transferring org workflow [33m 1462[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer database ownership [33m 1140[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org database [33m 1244[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1547[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should only allow transfer to self when targetOwnerType is user [33m 1032[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow transfer from user to self (org member transferring org asset to themselves) [33m 1318[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079940111,"env":"test","module":"user-credentials-repository","userId":"b5007a5a-1e4e-40fc-b0ae-2d7437c5999e","msg":"User credentials created"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 15112[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a workflow template mapping [33m 667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create non-primary mapping by default [33m 673[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find all templates for a workflow version [33m 798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array for version with no templates [33m 684[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should order by createdAt desc (newest first) [33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find mapping by workflow version and key [33m 704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined for non-existent key [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find primary template for workflow version [33m 768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined when no primary template exists [33m 815[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set a template as primary and unset others [33m 930[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle setting primary when none existed before [33m 925[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not delete mapping if workflow version does not match [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return true if key exists in workflow version [33m 680[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return false if key does not exist [33m 647[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should exclude specified id when checking existence [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return true if key exists on different mapping [33m 741[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update mapping fields [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find mapping by id [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined for non-existent id [33m 660[2mms[22m[39m
{"level":50,"time":1768079940156,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":30,"time":1768079940217,"env":"test","module":"email-queue","jobId":"b0dd3d92-3b98-4dba-a103-f99b8bcd46d7","to":"protected-test-9h4MfZ1qXyUK925tXyp1B@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079940273,"env":"test","module":"auth-routes","userId":"b5007a5a-1e4e-40fc-b0ae-2d7437c5999e","email":"protected-test-9h4MfZ1qXyUK925tXyp1B@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768079940979,"env":"test","module":"auth-routes","userId":"b5007a5a-1e4e-40fc-b0ae-2d7437c5999e","msg":"User logged in successfully"}
{"level":30,"time":1768079941030,"env":"test","module":"audit-log-service","userId":"b5007a5a-1e4e-40fc-b0ae-2d7437c5999e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 5429[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow member of multiple orgs to access all their org assets [33m 327[2mms[22m[39m
{"level":30,"time":1768079941136,"env":"test","module":"email-queue","jobId":"eba291cc-0ad5-4132-b8da-2c4c6c99f0dd","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 12091[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve template by key from workflowTemplates mapping [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if template key not found [33m 630[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should store output in runOutputs table [33m 791[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve template by templateId directly [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if templateId not found [33m 606[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use docxRenderer2 by default (v2 engine) [33m 683[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use legacy engine when engine="legacy" [33m 616[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should generate PDF when toPdf=true [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should default to DOCX when toPdf=false [33m 816[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should skip execution when condition evaluates to false [33m 546[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should execute when condition evaluates to true [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve simple bindings [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle binding resolution errors gracefully [33m 605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should record failed output in runOutputs table [33m 724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not throw errors (should return error in result) [33m 637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should deny access to templates from different tenant [33m 626[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require either templateKey or templateId [33m 582[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768079941572,"env":"test","module":"intake-service","runId":"94069706-54d0-492f-a09d-e2e671cacd30","slug":"public-nKiStuAALwvFLuk6q7AiP","msg":"Created intake run"}
{"level":50,"time":1768079941621,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768079942163,"env":"test","module":"user-credentials-repository","userId":"e0bb272c-f0fa-4280-bec6-295560f1d244","msg":"User credentials created"}
{"level":30,"time":1768079942265,"env":"test","module":"email-queue","jobId":"d4232bae-342a-40a0-9e32-92383906a8bd","to":"protected-test-XOLIHBuS0PC2EdD-a9Qur@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1768079942322,"env":"test","module":"auth-routes","userId":"e0bb272c-f0fa-4280-bec6-295560f1d244","email":"protected-test-XOLIHBuS0PC2EdD-a9Qur@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768079942840,"env":"test","error":{},"msg":"libreoffice-convert not available, trying system LibreOffice"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'f7326fac-e6d5-4af6-90ef-5ab5bb2419eb'[39m,
  tableId: [32m'744bdbb0-8cb5-4c2b-bfea-565e50c2f27a'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2026-01-10T21:19:04.271Z'[39m
}

{"level":40,"time":1768079942993,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"libreoffice --headless --convert-to pdf --outdir \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\" \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\\simple-template-1768079940692.docx\"","stdout":"","stderr":"'libreoffice' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"System LibreOffice conversion failed"}
{"level":40,"time":1768079942993,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF conversion failed"}
{"level":30,"time":1768079943029,"env":"test","module":"auth-routes","userId":"e0bb272c-f0fa-4280-bec6-295560f1d244","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[33m 4172[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should add a comment [33m 879[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow comment owner to delete their comment [33m 627[2mms[22m[39m
{"level":30,"time":1768079943085,"env":"test","module":"audit-log-service","userId":"e0bb272c-f0fa-4280-bec6-295560f1d244","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 13403[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should render a template with simple data [33m 1596[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use formatters in templates [33m 2091[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing data gracefully [33m 2373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use custom output name [33m 2559[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should attempt PDF conversion when requested [33m 3059[2mms[22m[39m
{"level":30,"time":1768079943677,"env":"test","module":"intake-service","runId":"9930b820-1bde-4b6c-a273-4eef154d6586","slug":"optional-XjDZeiVr6hXOyCpNMsOVE","userId":"e0bb272c-f0fa-4280-bec6-295560f1d244","msg":"Created intake run"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079943821,"env":"test","module":"email-queue","jobId":"4b000902-52aa-4f7f-a3fc-e51e51cc777c","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":50,"time":1768079943943,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079944129,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [31mÎ“Â¥Â»[39m tests/integration/auth/protected.routes.test.ts [2m([22m[2m33 tests[22m[2m | [22m[31m23 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 41474[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow access with valid Bearer token[39m[33m 987[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access without Authorization header[39m[33m 965[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with empty Bearer token[39m[33m 940[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with malformed Authorization header[39m[33m 915[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with wrong token type[39m[33m 962[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow POST with valid Bearer token[39m[33m 948[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST without Bearer token[39m[33m 946[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST with invalid token[39m[33m 1075[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow PUT with valid Bearer token [33m 1688[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject PUT without Bearer token[39m[33m 1017[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow DELETE with valid Bearer token[39m[33m 1256[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject DELETE without Bearer token [33m 1344[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow PATCH with valid Bearer token[39m[33m 966[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject PATCH without Bearer token[39m[33m 991[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle Bearer token with extra spaces [33m 1470[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should handle token with newlines
[31m       [31mâ”œÃ¹[31m should handle very long invalid token[39m[33m 1016[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle empty Authorization header[39m[33m 1005[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle Authorization header with only Bearer[39m[33m 970[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle multiple Authorization headers[39m[33m 975[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with SQL injection attempt[39m[33m 984[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with XSS attempt[39m[33m 1010[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject token with missing userId [33m 1337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject token with non-existent userId [33m 1513[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow user to access another user's resources[39m[33m 966[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should inject userId into request context[39m[33m 967[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should inject tenantId into request context[39m[33m 923[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should inject role into request context [33m 1327[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not apply general rate limiting to authenticated requests[39m[33m 920[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle request with both Bearer token and cookies[39m[33m 1516[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prioritize Bearer token over cookie when both present [33m 3217[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow unauthenticated access to optional auth routes [33m 1985[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enhance optional auth routes with user context when authenticated [33m 2167[2mms[22m[39m
{"level":30,"time":1768079945014,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079945123,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
{"level":40,"time":1768079945212,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768079945297,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1768079945373,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":50,"time":1768079945374,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google authentication failed"}
{"level":40,"time":1768079945431,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1768079945431,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google token verification failed"}
{"level":50,"time":1768079945432,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google authentication failed"}
{"level":30,"time":1768079945505,"env":"test","module":"email-queue","jobId":"b1d9f92c-439d-4d15-bb9f-05715348e8cb","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":40,"time":1768079945859,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768079945876,"env":"test","module":"auth","email":"existing@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079946016,"env":"test","connectionId":"34dd4b91-8e71-4904-8ae7-a25b822b4b75","projectId":"cc52367c-8be5-494b-bc4d-3eae07beff08","name":"Test OAuth2 Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768079946320,"env":"test","module":"auth","email":"refresh@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768079946751,"env":"test","module":"auth","email":"idtoken@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 4689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create multiple records [33m 443[2mms[22m[39m
{"level":30,"time":1768079947194,"env":"test","module":"auth","email":"minimal@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768079947240,"env":"test","connectionId":"eddcb42b-de61-4817-bf43-f0a00bd1a8e9","projectId":"cc52367c-8be5-494b-bc4d-3eae07beff08","name":"Status Test Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768079947273,"env":"test","msg":"Simulating External Send","destination":"Test Webhook","payload":{"message":"Hello Preview"}}
{"level":50,"time":1768079947307,"env":"test","module":"auth","err":{"type":"Error","message":"Token verification failed","stack":"Error: Token verification failed\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:425:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":40,"time":1768079947372,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1768079947372,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
{"level":50,"time":1768079947425,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token payload","stack":"Error: Invalid token payload\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:85:25)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079947541,"env":"test","module":"email-queue","jobId":"7b0589fe-e699-4def-895f-c4e2599848f6","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/variableSafety.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 3768[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m REPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided [33m 690[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m ScriptEngine resolves alias 'input_variable' when aliasMap is provided [33m 674[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m REPRO: BlockRunner fails to resolve alias in CreateRecordConfig [33m 645[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m BlockRunner logic resolves alias with aliasMap [33m 659[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 3868[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should successfully authenticate with valid Google ID token [33m 652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update existing user on subsequent logins [33m 495[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create refresh token record in database [33m 447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support both "token" and "idToken" fields [33m 378[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing profile information gracefully [33m 386[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx > TableGridView - Drag & Drop > renders DndContext wrapper
Warning: validateDOMNesting(...): <th> cannot appear as a child of <div>.
    at th
    at SortableColumnHeader (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/SortableColumnHeader.tsx:12:33)
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
Warning: validateDOMNesting(...): <div> cannot appear as a child of <tr>.
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 3503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should initiate OAuth2 3-legged flow and generate authorization URL [33m 450[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track OAuth2 connection status [33m 400[2mms[22m[39m
 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 16456[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 508[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1261[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 929[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 997[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 453[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get all notes for a row[39m[33m 843[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 664[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 382[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 237[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 616[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 242[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 408[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list table permissions [33m 326[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 570[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 669[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce RBAC - only owners can manage permissions [33m 344[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 2711[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for invalid column type[39m[33m 401[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 393[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 258[2mms[22m[39m
{"level":30,"time":1768079948561,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768079948597,"env":"test","msg":"External Send Completed","destination":"Test Webhook","success":true,"status":200}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/externalSends.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 5839[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m PREVIEW MODE: Should simulate send and NOT call fetch [33m 3059[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m LIVE MODE: Should call fetch with mapped payload [33m 1324[2mms[22m[39m
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079949629,"env":"test","module":"email-queue","jobId":"355faca1-f531-4333-b568-926b8e881f77","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768079949660,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079949682,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079949669,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079949670,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079949675,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079949681,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079949681,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079949682,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079949682,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stderr | tests/integration/organizationInvites.test.ts > Organization Invites > revokeInvite > should allow admin to revoke invite
Failed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:20:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:833:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizationInvites.test.ts:333:13
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:20 {
  length: 341,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (workspace_id)=(00000000-0000-0000-0000-000000000098) is not present in table "workspaces".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_workspace_id_workspaces_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39m[Shim] Request to /api/auth/google, Session User ID: undefined

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 5128[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m displays columns with type icons [33m 371[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m displays columns in order based on orderIndex [33m 1247[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m maintains column order after successful reorder [33m 403[2mms[22m[39m
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould list all runs with pagination
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by status
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by workflow
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by project
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by date range
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould search runs by query string
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id[2m > [22m[2mshould get run by ID with all details
[22m[39m[Shim] Request to /api/runs/7d69e7db-60f7-45dc-a7a5-f6edc59d82ce, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id[2m > [22m[2mshould return 404 for non-existent run
[22m[39m[Shim] Request to /api/runs/00000000-0000-0000-0000-000000000000, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id/logs[2m > [22m[2mshould get logs for a run
[22m[39m[Shim] Request to /api/runs/7d69e7db-60f7-45dc-a7a5-f6edc59d82ce/logs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with same inputs
[22m[39m[Shim] Request to /api/runs/7d69e7db-60f7-45dc-a7a5-f6edc59d82ce/rerun, Session User ID: test-user-runs-stage8

stderr | tests/integration/intake.workflow.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:280:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 307,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_auto_number, 2950 2950 23, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1768079951355,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768079951356,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 6339[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m loads table schema and rows [33m 628[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m renders correct column headers [33m 323[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m enters edit mode on double click [33m 643[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m updates cell value on blur [33m 1115[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m renders delete button for each row [33m 822[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m sorts columns by orderIndex [33m 318[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.workflow.test.ts[2m > [22m[2mIntake Workflow Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079951379,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079951357,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"responseTokens":91,"totalTokens":1303,"durationMs":1,"estimatedCostUSD":0.014849999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768079951362,"env":"test","module":"workflow-quality-validator","overall":99,"breakdown":{"aliases":100,"types":100,"structure":100,"ux":95,"completeness":100,"validation":100},"issuesCount":1,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768079951362,"env":"test","module":"ai-service","duration":7,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":99,"qualityBreakdown":{"aliases":100,"types":100,"structure":100,"ux":95,"completeness":100,"validation":100},"qualityPassed":true,"issuesCount":1,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768079951373,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768079951373,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":49,"totalTokens":1250,"durationMs":0,"estimatedCostUSD":0.013479999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768079951374,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768079951377,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768079951377,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":68,"totalTokens":1269,"durationMs":0,"estimatedCostUSD":0.01405,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768079951378,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768079951379,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768079951379,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":89,"totalTokens":1290,"durationMs":0,"estimatedCostUSD":0.014679999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768079951380,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768079951381,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1768079951382,"env":"test","module":"ai-service","attempt":0,"waitMs":1000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768079951382,"env":"test","module":"ai-service","attempt":1,"waitMs":2000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768079951382,"env":"test","module":"ai-service","attempt":2,"waitMs":4000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768079951382,"env":"test","module":"ai-service","attempt":3,"waitMs":8000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768079951382,"env":"test","module":"ai-service","attempt":4,"waitMs":16000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768079951382,"env":"test","module":"ai-service","attempt":5,"waitMs":32000,"msg":"Rate limit hit, retrying..."}
{"level":50,"time":1768079951382,"env":"test","module":"ai-service","event":"ai_request_failed","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","errorType":"RATE_LIMIT","durationMs":1,"attempts":7,"msg":"AI request failed: rate limit"}
{"level":50,"time":1768079951382,"env":"test","module":"ai-service","error":{"code":"RATE_LIMIT","details":{"originalError":"Rate limit exceeded","retryAfterSeconds":60},"troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. You've hit the AI provider's rate limit\n2. Solutions:\n   - Wait 60 seconds and try again\n   - Check your API key quota at your provider's dashboard\n   - Consider upgrading your API plan for higher limits\n   - If using free tier, you may need to wait until limits reset"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768079951387,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768079951387,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":6,"totalTokens":1207,"durationMs":0,"estimatedCostUSD":0.01219,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768079951387,"env":"test","module":"ai-service","error":{},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1768079951393,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768079951393,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"responseTokens":68,"totalTokens":1280,"durationMs":0,"estimatedCostUSD":0.004656,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768079951394,"env":"test","module":"workflow-quality-validator","overall":100,"breakdown":{"aliases":100,"types":100,"structure":100,"ux":100,"completeness":100,"validation":100},"issuesCount":0,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768079951394,"env":"test","module":"ai-service","duration":1,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":100,"qualityBreakdown":{"aliases":100,"types":100,"structure":100,"ux":100,"completeness":100,"validation":100},"qualityPassed":true,"issuesCount":0,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768079951397,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768079951397,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"responseTokens":33,"totalTokens":1234,"durationMs":0,"estimatedCostUSD":0.004098,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768079951398,"env":"test","module":"workflow-quality-validator","overall":96,"breakdown":{"aliases":100,"types":100,"structure":80,"ux":100,"completeness":90,"validation":100},"issuesCount":2,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768079951398,"env":"test","module":"ai-service","duration":1,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":96,"qualityBreakdown":{"aliases":100,"types":100,"structure":80,"ux":100,"completeness":90,"validation":100},"qualityPassed":true,"issuesCount":2,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768079951402,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"maxTokens":4000,"msg":"AI request started"}
{"level":30,"time":1768079951402,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"responseTokens":44,"totalTokens":302,"durationMs":0,"estimatedCostUSD":0.0039,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768079951403,"env":"test","module":"ai-service","duration":1,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
{"level":30,"time":1768079951364,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079951365,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079951373,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079951378,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079951378,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079951379,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079951379,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests > POST /api/runs/:id/rerun > should re-run workflow with same inputs
[DEBUG Question] Node start executed. Key: start, Value: undefined. Context keys: 4

 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 2044[2mms[22m[39m
{"level":30,"time":1768079951519,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768079951550,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.projects.test.ts[2m > [22m[2mProjects API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079951529,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079951530,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079951543,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079951549,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079951549,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079951550,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079951550,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with override inputs
[22m[39m[Shim] Request to /api/runs/7d69e7db-60f7-45dc-a7a5-f6edc59d82ce/rerun, Session User ID: test-user-runs-stage8

 [32mÎ“Â£Ã´[39m tests/ui/datavault/TableCard.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 4897[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should call onDelete when delete button is clicked [33m 2269[2mms[22m[39m
stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests > POST /api/runs/:id/rerun > should re-run workflow with override inputs
[DEBUG Question] Node start executed. Key: start, Value: undefined. Context keys: 4

{"level":30,"time":1768079951826,"env":"test","module":"email-queue","jobId":"a5ace34b-2ea9-44de-9536-5c837e2c182d","to":"existing_1768079922716@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould return 404 for non-existent run
[22m[39m[Shim] Request to /api/runs/00000000-0000-0000-0000-000000000000/rerun, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/export.csv[2m > [22m[2mshould export runs to CSV
[22m[39m[Shim] Request to /api/runs/export.csv, Session User ID: test-user-runs-stage8

{"level":30,"time":1768079952210,"env":"test","module":"user-credentials-repository","userId":"57325e41-b9f7-47e4-b1ff-c66b2ac32b67","msg":"User credentials created"}
stderr | tests/integration/organizationInvites.test.ts > Organization Invites > revokeInvite > should prevent accepting revoked invite
Failed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:20:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:833:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizationInvites.test.ts:349:13
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:20 {
  length: 341,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (workspace_id)=(00000000-0000-0000-0000-000000000098) is not present in table "workspaces".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_workspace_id_workspaces_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}

{"level":30,"time":1768079952249,"env":"test","module":"user-credentials-repository","userId":"84180bd5-0b52-40ec-9b47-c9ac9494df15","msg":"User credentials created"}
{"level":30,"time":1768079952328,"env":"test","module":"email-queue","jobId":"dbf9c754-c4f5-4fe9-873d-94fc3e442b2e","to":"test-projects-pp2SppiD8s954BWmZxECj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/export.csv[2m > [22m[2mshould export runs with filters applied
[22m[39m[Shim] Request to /api/runs/export.csv, Session User ID: test-user-runs-stage8

{"level":30,"time":1768079952374,"env":"test","module":"email-queue","jobId":"d2d46026-4967-498c-9e1b-fd5017d02779","to":"test-twITq-t_GuXw3aVnst2Eh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079952387,"env":"test","module":"auth-routes","userId":"57325e41-b9f7-47e4-b1ff-c66b2ac32b67","email":"test-projects-pp2SppiD8s954BWmZxECj@example.com","msg":"User registered"}
{"level":30,"time":1768079952437,"env":"test","module":"auth-routes","userId":"84180bd5-0b52-40ec-9b47-c9ac9494df15","email":"test-twITq-t_GuXw3aVnst2Eh@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould compare two runs
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

{"level":50,"time":1768079952597,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 29951[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create placeholder user for non-existent email [33m 1712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create invite for existing user without creating placeholder [33m 1440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent duplicate pending invites [33m 1723[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent inviting existing members [33m 1164[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require admin access to create invite [33m 808[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set expiry to 7 days from now [33m 1474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should accept invite and create membership [33m 1998[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should convert placeholder user to real user on accept [33m 2050[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired invite [33m 1740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject already accepted invite [33m 2072[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should verify email matches invite [33m 1669[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid token [33m 986[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return pending invites for user email [33m 1696[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not return expired invites [33m 1719[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not return accepted invites [33m 2478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to revoke invite [33m 1985[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent accepting revoked invite [33m 2217[2mms[22m[39m
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould identify changed input keys
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould return 404 if run A not found
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould return 404 if run B not found
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mRBAC and Tenant Isolation[2m > [22m[2mshould enforce tenant isolation on runs list
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests
Cleanup error (non-fatal): error: syntax error at or near "="
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.runs.graph.test.ts:252:9 {
  length: 90,
  severity: 'ERROR',
  code: '42601',
  detail: undefined,
  hint: undefined,
  position: '32',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'scan.l',
  line: '1244',
  routine: 'scanner_yyerror'
}

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079953830,"env":"test","workflowId":"76f93d86-c25e-4e03-bc53-d8f128a6c3d6","userId":"84180bd5-0b52-40ec-9b47-c9ac9494df15","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 4884[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should re-run workflow with same inputs [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should re-run workflow with override inputs [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should compare two runs [33m 311[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce tenant isolation on runs list [33m 515[2mms[22m[39m
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079954715,"env":"test","module":"user-credentials-repository","userId":"ed4474e5-85e3-4cec-bd0e-e395117d00e8","msg":"User credentials created"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > reverts value on save error
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:204:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079954834,"env":"test","module":"email-queue","jobId":"0ecfbebb-fdfa-44d8-8b8d-c8201f893d99","to":"other-ngxtyaBs7HfKAXJgz1ElD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 2304[2mms[22m[39m
{"level":30,"time":1768079954889,"env":"test","module":"auth-routes","userId":"ed4474e5-85e3-4cec-bd0e-e395117d00e8","email":"other-ngxtyaBs7HfKAXJgz1ElD@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > displays error indicator on save failure
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:220:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 2029[2mms[22m[39m
{"level":30,"time":1768079955075,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 2574[2mms[22m[39m
{"level":30,"time":1768079955102,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts[2m > [22m[2mExpression Validation API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079955087,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079955088,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079955094,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079955101,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079955101,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079955102,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079955102,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":40,"time":1768079955178,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768079955198,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768079955205,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768079955213,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768079955221,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768079955233,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [32mÎ“Â£Ã´[39m tests/unit/isolatedVmBridge.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 1953[2mms[22m[39m
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 1852[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 3387[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m renders boolean value as Yes/No [33m 461[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1768079955710,"env":"test","module":"user-credentials-repository","userId":"2172f06b-2ef9-46ad-abca-c124a67f6673","msg":"User credentials created"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Boolean Type (Checkbox) > shows loading spinner when saving checkbox
Warning: An update to EditableCell inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at EditableCell (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/EditableCell.tsx:12:25)

{"level":30,"time":1768079955822,"env":"test","module":"email-queue","jobId":"c4a6149f-e74a-44ff-8141-f9a91fdb5327","to":"test-5st-8FRNnRLdMM7IgjZFG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 4644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should soft-delete project [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow cross-tenant access [33m 964[2mms[22m[39m
{"level":30,"time":1768079955887,"env":"test","module":"auth-routes","userId":"2172f06b-2ef9-46ad-abca-c124a67f6673","email":"test-5st-8FRNnRLdMM7IgjZFG@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/intake.workflow.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 5160[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow designating a workflow as Intake [33m 1152[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow linking a downstream workflow to an intake workflow [33m 1455[2mms[22m[39m
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [32mÎ“Â£Ã´[39m tests/ui/datavault/EditableCell.test.tsx [2m([22m[2m29 tests[22m[2m)[22m[33m 8302[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m shows double-click hint on hover [33m 863[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m enters edit mode on double-click [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m saves on blur [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m saves on Enter key press [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m reverts value on save error [33m 311[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 3260[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should render database settings page with breadcrumbs [33m 666[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768079956996,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 2059[2mms[22m[39m
{"level":50,"time":1768079957183,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079957366,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 3436[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx [2m([22m[2m27 tests[22m[2m)[22m[33m 3120[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768079958986,"env":"test","status":401,"statusText":"Unauthorized","error":"Invalid client credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768079958987,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079958990,"env":"test","data":{"token_type":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1768079958990,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079958991,"env":"test","data":{"access_token":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1768079958991,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079958992,"env":"test","error":"Network error: ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
stderr | tests/unit/shared/conditionEvaluator.test.ts > conditionEvaluator > Comparison operators > Unknown operator > should default to true and log warning
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts [2m([22m[2m41 tests[22m[2m)[22m[33m 2383[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts [2m([22m[2m70 tests[22m[2m)[22m[33m 2342[2mms[22m[39m
{"level":50,"time":1768079959181,"env":"test","error":"Invalid credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079959182,"env":"test","error":"ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079959185,"env":"test","status":400,"statusText":"Bad Request","error":"Invalid grant_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768079959185,"env":"test","error":"OAuth2 token request failed: 400 Bad Request","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079959186,"env":"test","status":401,"statusText":"Unauthorized","error":"Client authentication failed","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768079959227,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079959229,"env":"test","status":403,"statusText":"Forbidden","error":"Access denied","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768079959229,"env":"test","error":"OAuth2 token request failed: 403 Forbidden","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079959230,"env":"test","status":500,"statusText":"Internal Server Error","error":"Server error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768079959230,"env":"test","error":"OAuth2 token request failed: 500 Internal Server Error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079959231,"env":"test","error":"Unexpected token in JSON","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768079959232,"env":"test","error":"Request timeout","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 2419[2mms[22m[39m
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 2503[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 2286[2mms[22m[39m
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079959552,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"datavault.createTable","databaseId":"db-123","name":"Submissions","columns":[{"name":"email","type":"text"},{"name":"submitted_at","type":"date"}]},"msg":"Failed to apply operation"}
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079959553,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"datavault.addColumns","tableId":"table-123","columns":[{"name":"phone","type":"text"}]},"msg":"Failed to apply operation"}
{"level":50,"time":1768079959557,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"step.create","sectionRef":"temp-section-1","type":"short_text","title":"Field 1","alias":"field1"},"msg":"Failed to apply operation"}
{"level":50,"time":1768079959597,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"document.bindFields","id":"template-123","bindings":{"client_name":"nonExistentAlias"}},"msg":"Failed to apply operation"}
 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 2392[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 2502[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 2155[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/TemplateCard.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[33m 2725[2mms[22m[39m
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2083[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/engine/Performance.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2091[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 2230[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079963044,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts[2m > [22m[2mData Sources API - Native Catalog
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079963071,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768079963054,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079963055,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079963062,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768079963071,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768079963071,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768079963071,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768079963071,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079963649,"env":"test","module":"user-credentials-repository","userId":"dd24077e-1ce6-4da6-9902-7d38df634135","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079963753,"env":"test","module":"email-queue","jobId":"8fe38cce-650f-42c9-bd24-861a198b7ac5","to":"test-KRRl-64XDWEZLKWjY1XSq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768079963811,"env":"test","module":"auth-routes","userId":"dd24077e-1ce6-4da6-9902-7d38df634135","email":"test-KRRl-64XDWEZLKWjY1XSq@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2234[2mms[22m[39m
stderr | tests/unit/utils/variableResolver.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:190:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/PageValidator.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2369[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 1903[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/client/choice-utils.test.ts > choice-utils > handles missing content gracefully
[generateOptionsFromList] Invalid list data: null

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2643[2mms[22m[39m
stderr | tests/unit/shared/workflowLogic.test.ts > workflowLogic > evaluateRules > Operators > Unknown operator > should return false and log warning for unknown operator
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2700[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts [2m([22m[2m65 tests[22m[2m)[22m[33m 2708[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079964354,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
 [32mÎ“Â£Ã´[39m tests/ui/builder.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 2709[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079964356,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating skipIf condition"}
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mMOCK SETUP DONE. Mock questions: [
  {
    id: [32m'q1'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q1'[39m,
    order: [33m0[39m,
    isVirtual: [33mfalse[39m,
    alias: [32m'show'[39m,
    visibleIf: [1mnull[22m
  },
  {
    id: [32m'q2'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q2'[39m,
    order: [33m1[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: { op: [32m'equals'[39m, left: [36m[Object][39m, right: [36m[Object][39m }
  },
  {
    id: [32m'q3'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q3'[39m,
    order: [33m2[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: [1mnull[22m
  }
]
Calling getVisibleQuestionCount...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowOptimizationService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 2887[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mCOUNT RESULT: [33m0[39m
Mock called times: [33m1[39m
Mock last call args: [ [ [32m'section1'[39m ] ]

{"level":50,"time":1768079964433,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 2534[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 2793[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts [2m([22m[2m32 tests[22m[2m)[22m[33m 2253[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

 [32mÎ“Â£Ã´[39m tests/unit/services/RunExecutionCoordinator.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 2060[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts [2m([22m[2m60 tests[22m[2m)[22m[33m 2436[2mms[22m[39m
{"level":30,"time":1768079965372,"env":"test","blockId":"92df58d6-e035-4a7f-98b8-628f26648b19","virtualStepId":"f401de1b-3fa5-4a91-bf31-674e323cf023","outputVar":"userList","msg":"Created read table block with virtual step"}
 [32mÎ“Â£Ã´[39m tests/integration/api.dataSources.native.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 2843[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should list databases and databases' tables in the catalog [33m 382[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/dynamic_options_workflow.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 2277[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should successfully configure a workflow with Read Table -> Dynamic Choice [33m 511[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic-simple.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2368[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 2435[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflow/QueryBlock.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2109[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2874[2mms[22m[39m
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1768079968257,"env":"test","module":"rbac-middleware","path":"/api/workflows","permission":"workflow:create","msg":"Unauthenticated user attempted to access protected resource"}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768079968261,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permission":"workflow:create","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1768079968263,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"permission":"workflow:view","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1768079968266,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permissions":["workflow:create","workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (none of required permissions)"}
{"level":40,"time":1768079968269,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","permissions":["workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (missing some required permissions)"}
{"level":40,"time":1768079968271,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1768079968272,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"requiredRoles":["owner"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1768079968273,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","requiredRoles":["owner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768079968275,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"runner","requiredRoles":["owner","builder"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768079968276,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder","runner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768079968280,"env":"test","module":"rbac-middleware","path":"/api/test","permission":"workflow:view","msg":"Unauthenticated user attempted to access protected resource"}
{"level":40,"time":1768079968281,"env":"test","module":"rbac-middleware","userId":"user-123","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":40,"time":1768079968281,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"invalid-role","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts [2m([22m[2m44 tests[22m[2m)[22m[33m 2729[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 2181[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2513[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 2264[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768079968600,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079968603,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768079968605,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":66,"totalTokens":878,"durationMs":1,"estimatedCostUSD":0.00010760000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768079968609,"env":"test","module":"ai-service","duration":7,"workflowId":"123","changeCount":1,"msg":"AI workflow revision succeeded"}
{"level":30,"time":1768079968612,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768079968613,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768079968613,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":45,"totalTokens":857,"durationMs":1,"estimatedCostUSD":0.00009920000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768079968613,"env":"test","module":"ai-service","duration":1,"workflowId":"123","changeCount":0,"msg":"AI workflow revision succeeded"}
{"level":30,"time":1768079968614,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768079968614,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768079968614,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1768079968615,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1768079968615,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1768079968615,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":1,"msg":"AI workflow revision failed"}
{"level":40,"time":1768079968615,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"actualOutputTokens":4,"responseLength":13,"msg":"Single-shot revision truncated - automatically retrying with chunking"}
{"level":30,"time":1768079968616,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768079968616,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1768079968616,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1768079968616,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1768079968616,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":0,"msg":"AI workflow revision failed"}
{"level":50,"time":1768079968616,"env":"test","module":"ai-service","duration":2,"error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"msg":"AI workflow revision failed"}
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AIService.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2291[2mms[22m[39m
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts [2m([22m[2m39 tests[22m[2m)[22m[33m 2847[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts [2m([22m[2m66 tests[22m[2m)[22m[33m 2628[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 2236[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 2329[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 2488[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768079970494,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return workflow if user is the creator [33m 1413[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 2081[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768079971851,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 2427[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate TOTP secret, QR code, and backup codes [33m 369[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate unique backup codes [33m 375[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should try multiple codes if first doesn't match [33m 466[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate new backup codes [33m 506[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079971869,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971873,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971873,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971874,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971874,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971875,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971879,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971879,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971880,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768079971880,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768079971881,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 2774[2mms[22m[39m
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts [2m([22m[2m33 tests[22m[2m)[22m[33m 1094[2mms[22m[39m
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts [2m([22m[2m34 tests[22m[2m)[22m[33m 1019[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts[2m > [22m[2mDatavaultColumnsService[2m > [22m[2mgetColumns[2m > [22m[2mshould throw 404 if table not found
[22m[39m[DEBUG] Table not found: 660e8400-e29b-41d4-a716-446655440001

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1490[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 1048[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1001[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/analytics_preservation.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1556[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should preserve lifetime user count when a user is deleted [33m 525[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1073[2mms[22m[39m
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 1046[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 979[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip question when condition is false
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q1 executed. Key: has_code, Value: true. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q2 executed. Key: code, Value: ABC123. Context keys: 5

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip compute node when condition is false
[DEBUG Question] Node q1 executed. Key: amount, Value: 0. Context keys: 3

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute compute node when condition is true
[DEBUG Question] Node q1 executed. Key: amount, Value: 100. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q3 executed. Key: amount, Value: 1000. Context keys: 5

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should return trace when debug is enabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should not return trace when debug is disabled
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3


[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 989[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768079974983,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768079975262,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768079975298,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","msg":"AI workflow revision job enqueued"}
{"level":30,"time":1768079975312,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1768079975325,"env":"test","module":"ai-controller","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["workflowId"]},{"code":"invalid_type","expected":"object","received":"undefined","path":["currentWorkflow"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["userInstruction"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1102[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 918[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/api.ai.revise.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1147[2mms[22m[39m
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1290[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/unit/api.ai.logic.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:280:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 307,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_auto_number, 2950 2950 23, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1768079976880,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768079976927,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","descriptionLength":26,"msg":"AI logic generation requested"}
{"level":30,"time":1768079976930,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","duration":8,"changeCount":0,"msg":"AI logic generation succeeded"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 983[2mms[22m[39m
{"level":30,"time":1768079976990,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768079977048,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/api.ai.logic.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1068[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 927[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 931[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 948[2mms[22m[39m
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 890[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 893[2mms[22m[39m
[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/writes/WriteRunner.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 933[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflow/PreviewExecution.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1116[2mms[22m[39m
{"level":30,"time":1768079978758,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768079978835,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
{"level":30,"time":1768079978835,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1768079978836,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768079978838,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1768079978839,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/writes/WriteRunner.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 100[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 888[2mms[22m[39m
stderr | tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should generate execution trace with lineage
[DEBUG Question] Node q1 executed. Key: userName, Value: Alice. Context keys: 3

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

 [32mÎ“Â£Ã´[39m tests/unit/debugging/Lineage.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 928[2mms[22m[39m
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":30,"time":1768079980631,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768079980646,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/external/ExternalSendRunner.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 24[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 35[2mms[22m[39m
[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/BlockRunner.validate.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 21[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 111[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 26[2mms[22m[39m
[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts [2m([22m[2m42 tests[22m[2m)[22m[32m 291[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1768079981448,"env":"test","sourceListVar":"nonexistent_list","inputKey":"nonexistent_list","msg":"Input list not found, treating as empty array"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":40,"time":1768079981460,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768079981464,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1768079981467,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768079981478,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1768079981481,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 879[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 961[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 21[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768079982244,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts[2m > [22m[2mPersonalization API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768079982253,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768079982254,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768079982259,"env":"test","module":"documents-routes","msg":"Document routes registered"}
 [32mÎ“Â£Ã´[39m tests/unit/services/Guardrail.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/debug_import.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 814[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/FinalBlockSnapshot.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 10[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 866[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/api.ai.personalization.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1321[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6)
Error: User login failed: {"success":false,"error":{"code":"AUTH_004","message":"Invalid credentials","details":{"errorType":"InvalidCredentialsError"},"timestamp":"2026-01-10T21:18:38.853Z"}}
 Î“Â¥Â» createTestUser tests/helpers/integrationTestHelper.ts:252:11
    250| 
    251|   if (loginRes.status !== 200) {
    252|     throw new Error(`User login failed: ${JSON.stringify(loginRes.bodyÎ“Ã‡Âª
       |           ^
    253|   }
    254| 
 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:27:13

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/179]Î“Ã„Â»

 FAIL  tests/integration/ai/workflowEdit.test.ts > POST /api/workflows/:workflowId/ai/edit - Integration Test
error: duplicate key value violates unique constraint "tenants_pkey"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/ai/workflowEdit.test.ts:72:22
     70| 
     71|     // Create test tenant (with valid UUID to avoid syntax error)
     72|     const [tenant] = await db.insert(tenants).values({
       |                      ^
     73|       id: '987fcdeb-51a2-43d7-9012-345678901234',
     74|       name: 'Test Tenant',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/179]Î“Ã„Â»

 FAIL  tests/integration/auth/portal.authentication.test.ts [ tests/integration/auth/portal.authentication.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/auth/portal.authentication.test.ts
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/179]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 176 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/analytics_service.test.ts > Analytics Service Integration > should generate events and metrics on run completion
Error: Workflow is not active
 Î“Â¥Â» RunAuthResolver.verifyCreateAccess server/services/runs/RunAuthResolver.ts:110:53
    108| 
    109|             if (!workflow) throw new Error('Workflow not found');
    110|             if (workflow.status !== 'active') throw new Error('WorkfloÎ“Ã‡Âª
       |                                                     ^
    111|             if (!workflow.isPublic) throw new Error('Workflow is not pÎ“Ã‡Âª
    112| 
 Î“Â¥Â» RunService.createRun server/services/RunService.ts:202:22
 Î“Â¥Â» tests/integration/analytics_service.test.ts:42:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/179]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should analyze a DOCX file and return variables
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:143:37
    141|                 } catch (e) { console.log("FAIL_BODY: " + response.texÎ“Ã‡Âª
    142|             }
    143|             expect(response.status).toBe(200);
       |                                     ^
    144| 
    145|             expect(response.body.data).toHaveProperty("variables");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/179]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should fail if no file is provided
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:168:18
    166|             await request(baseURL)
    167|                 .post("/api/ai/doc/analyze")
    168|                 .expect(400);
       |                  ^
    169|         });
    170|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/179]Î“Ã„Â»

 FAIL  tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > GET /api/runs/:id/download - Download Generated DOCX > should download DOCX output from successful run
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.runs.docx.test.ts:277:10
    275|         .get(`/api/runs/${runId}/download?type=docx`)
    276|         .set('Authorization', `Bearer ${authToken}`)
    277|         .expect(200);
       |          ^
    278| 
    279|       expect(response.headers['content-type']).toBe(
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/179]Î“Ã„Â»

 FAIL  tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > GET /api/runs/:id/download - Download Generated DOCX > should return 404 for PDF when not generated
AssertionError: expected '{"error":{"code":"NOT_FOUND","messageÎ“Ã‡Âª' to contain 'PDF'

Expected: "PDF"
Received: "{"error":{"code":"NOT_FOUND","message":"Run output not available not found"}}"

 Î“Â¥Â» tests/integration/api.runs.docx.test.ts:293:45
    291|         .expect(404);
    292| 
    293|       expect(JSON.stringify(response.body)).toContain('PDF');
       |                                             ^
    294|     });
    295| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/179]Î“Ã„Â»

 FAIL  tests/integration/api.snapshots.test.ts > Stage 13: Workflow Snapshots & Versioning > should maintain immutability of runs across versions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/api.snapshots.test.ts:199:37
    197|         // 7. Verify Run 1 still sees Version 1 Question
    198|         const run1Response = await agent.get(`/api/runs/${run1.id}`);
    199|         expect(run1Response.status).toBe(200);
       |                                     ^
    200|         const run1Graph = run1Response.body.workflowVersion.graphJson;
    201|         expect(run1Graph.nodes[0].config.question).toBe('Version 1 QueÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/179]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Templates API > POST /api/projects/:ctx.projectId/templates > should reject non-docx files
Error: expected 500 "Internal Server Error", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:119:12
    117|           .field("name", "Test Template")
    118|           .attach("file", mockPdf, "test.pdf")
    119|           .expect(500); // Multer rejects before handler
       |            ^
    120|       });
    121| 
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/179]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Runs API > POST /api/workflows/:id/run > should reject without required permission
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:289:12
    287|           .post("/api/auth/register")
    288|           .send({ email: viewerEmail, password: "TestPassword123" })
    289|           .expect(201);
       |            ^
    290| 
    291|         await db.update(schema.users)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/179]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Login failed: 401 {"success":false,"error":{"code":"AUTH_004","message":"Invalid credentials","details":{"errorType":"InvalidCredentialsError"},"timestamp":"2026-01-10T21:18:38.854Z"}}
 Î“Â¥Â» tests/integration/api.workflows.test.ts:396:15
    394| 
    395|       if (loginResponse2.status !== 200) {
    396|         throw new Error(`Login failed: ${loginResponse2.status} ${JSONÎ“Ã‡Âª
       |               ^
    397|       }
    398|       if (!loginResponse2.body.token) {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Complete Registration Î“Ã¥Ã† Login Flow > should complete registration, verify email, then login
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:70:36
     68|         .send({ email, password });
     69| 
     70|       expect(loginAttempt2.status).toBe(200);
       |                                    ^
     71|       expect(loginAttempt2.body.token).toBeDefined();
     72|       expect(loginAttempt2.body.user.emailVerified).toBe(true);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should lock account after 5 failed attempts, then unlock after waiting
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:110:36
    108|         });
    109| 
    110|       expect(lockedAttempt.status).toBe(423);
       |                                    ^
    111|       expect(lockedAttempt.body.message || lockedAttempt.body.error).tÎ“Ã‡Âª
    112| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should record all login attempts
AssertionError: expected 1 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 1

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:145:31
    143|       });
    144| 
    145|       expect(attempts.length).toBe(3);
       |                               ^
    146|       expect(attempts.filter(a => !a.successful).length).toBe(2);
    147|       expect(attempts.filter(a => a.successful).length).toBe(1);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should complete MFA setup and login with TOTP
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:182:25
    180|       });
    181| 
    182|       expect(mfaSecret).toBeDefined();
       |                         ^
    183|       expect(mfaSecret!.enabled).toBe(false); // Not enabled until verÎ“Ã‡Âª
    184| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should login with backup code when TOTP unavailable
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:248:52
    246|       });
    247| 
    248|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    249| 
    250|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Password Reset Flow > should complete full password reset flow
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:332:36
    330|         });
    331| 
    332|       expect(resetResponse.status).toBe(200);
       |                                    ^
    333| 
    334|       // Step 4: Verify old password no longer works

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should rotate refresh token on each use
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:415:40
    413|           .set('Cookie', refreshTokenCookie!);
    414| 
    415|         expect(refreshResponse.status).toBe(200);
       |                                        ^
    416|         expect(refreshResponse.body.token).toBeDefined();
    417| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should list all active sessions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:492:39
    490|         .set("Authorization", `Bearer ${token}`);
    491| 
    492|       expect(sessionsResponse.status).toBe(200);
       |                                       ^
    493|       expect(sessionsResponse.body.sessions).toBeDefined();
    494|       expect(sessionsResponse.body.sessions.length).toBeGreaterThanOrEÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[20/179]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:517:40
    515| 
    516|       const sessions = sessionsResponse.body.sessions;
    517|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    518| 
    519|       // Revoke first session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[21/179]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should login with valid credentials
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:138:31
    136|         .send({ email, password });
    137| 
    138|       expect(response.status).toBe(200);
       |                               ^
    139|       expect((response.body as any).message).toBe("Login successful");
    140|       expect((response.body as any).token).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[22/179]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return 403 for unverified email
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:192:31
    190|         .send({ email, password });
    191| 
    192|       expect(response.status).toBe(403);
       |                               ^
    193|       expect(response.body.message || response.body.error).toBeDefinedÎ“Ã‡Âª
    194|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[23/179]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return requiresMfa=true for MFA-enabled users
Error: [TEST UTILS] MFA Secret verification failed for 89e4a7dfe3abd0faba961f597d821115
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:217:35

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[24/179]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should lock account after 5 failed attempts
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:250:31
    248|         });
    249| 
    250|       expect(response.status).toBe(423);
       |                               ^
    251|       expect(response.body).toBeDefined();
    252|       expect(response.body.error || response.body.message).toBeDefinedÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[25/179]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/refresh-token > should refresh access token with valid refresh token
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:304:31
    302|         .set('Cookie', refreshTokenCookie!);
    303| 
    304|       expect(response.status).toBe(200);
       |                               ^
    305|       expect(response.body.token).toBeDefined();
    306|       expect(response.body.user).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[26/179]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/reset-password > should reset password with valid token
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:397:31
    395|         });
    396| 
    397|       expect(response.status).toBe(200);
       |                               ^
    398|       expect(response.body.message).toContain("Password updated");
    399| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[27/179]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Row Notes > should get all notes for a row
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:431:31
    429|         .set('Authorization', `Bearer ${authToken}`);
    430| 
    431|       expect(response.status).toBe(200);
       |                               ^
    432|       expect(response.body).toHaveLength(2);
    433|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[28/179]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
error: insert or update on table "datavault_rows" violates foreign key constraint "datavault_rows_table_id_datavault_tables_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:702:7
    700|         );
    701|       }
    702|       await Promise.all(rowPromises);
       |       ^
    703| 
    704|       // Test pagination

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[29/179]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for invalid column type
 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
error: insert or update on table "datavault_tables" violates foreign key constraint "datavault_tables_owner_user_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:186:21
    184|     testDatabaseId = database.id;
    185| 
    186|     const [table] = await db.insert(datavaultTables).values({
       |                     ^
    187|       name: 'Test Table',
    188|       slug: 'test-table-' + uniqueSuffix,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[30/179]Î“Ã„Â»

 FAIL  tests/integration/js_helpers.test.ts > Detailed Verification: JS Helper Availability > should execute a JS block that uses helper functions
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/js_helpers.test.ts:136:31
    134|         // 3. Create a Run
    135|         const runRes = await agent.post(`/api/workflows/${workflowId}/Î“Ã‡Âª
    136|         expect(runRes.status).toBe(201); // 201 Created
       |                               ^
    137|         const runId = runRes.body.id;
    138| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[31/179]Î“Ã„Â»

 FAIL  tests/integration/metrics.test.ts > Metrics Integration > should expose /metrics endpoint
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/metrics.test.ts:33:33
     31|         const response = await request(app).get('/metrics');
     32| 
     33|         expect(response.status).toBe(200);
       |                                 ^
     34|         expect(response.headers['content-type']).toContain('text/plainÎ“Ã‡Âª
     35|         // Prometheus metrics usually contain comments like # HELP or Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[32/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should complete full MFA setup flow
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:68:25
     66|       });
     67| 
     68|       expect(mfaSecret).toBeDefined();
       |                         ^
     69|       expect(mfaSecret!.enabled).toBe(false); // Not enabled until verÎ“Ã‡Âª
     70| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[33/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should not allow MFA setup if already enabled
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:135:46
    133|         .send({ email, password });
    134| 
    135|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    136| 
    137|       // Can't test setup with MFA user since we can't login without MÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[34/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should generate unique backup codes
AssertionError: expected +0 to be 10 // Object.is equality

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:156:32
    154|       // All codes should be unique
    155|       const uniqueCodes = new Set(backupCodes);
    156|       expect(uniqueCodes.size).toBe(10);
       |                                ^
    157|     });
    158| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[35/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should store hashed backup codes
AssertionError: expected [] to have a length of 10 but got +0

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:177:27
    175|       });
    176| 
    177|       expect(storedCodes).toHaveLength(10);
       |                           ^
    178| 
    179|       // Hashes should not match plain codes

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[36/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should require MFA for enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:195:36
    193|         .send({ email, password });
    194| 
    195|       expect(loginResponse.status).toBe(200);
       |                                    ^
    196|       expect(loginResponse.body.requiresMfa).toBe(true);
    197|       expect(loginResponse.body.userId).toBe(userId);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[37/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should complete MFA login with valid TOTP
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:209:46
    207|         .send({ email, password });
    208| 
    209|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    210| 
    211|       // Step 2: Verify MFA

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[38/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should accept TOTP codes within 60-second window
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:264:32
    262|         .send({ userId, token: totpCode });
    263| 
    264|       expect(response1.status).toBe(200);
       |                                ^
    265| 
    266|       // Login again for second test

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[39/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should login with valid backup code
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:319:47
    317|         .send({ email, password });
    318| 
    319|       expect(login2Response.body.requiresMfa).toBe(true);
       |                                               ^
    320| 
    321|       // Use backup code

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[40/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should mark backup code as used
Error: [TEST UTILS] MFA Secret verification failed for 6ddc0d9af349e8358a2f389ff97bee39
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:334:43

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[41/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should prevent backup code reuse
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:375:52
    373|       });
    374| 
    375|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    376| 
    377|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[42/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should try TOTP before backup code
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:430:31
    428| 
    429|       // Should succeed with TOTP (backup code ignored)
    430|       expect(response.status).toBe(200);
       |                               ^
    431|     });
    432|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[43/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Status > should return MFA status for user
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:446:37
    444|         .set("Authorization", `Bearer ${loginResponse.body.token}`);
    445| 
    446|       expect(statusResponse.status).toBe(200);
       |                                     ^
    447|       expect(statusResponse.body.mfaEnabled).toBe(false);
    448|       expect(statusResponse.body.backupCodesRemaining).toBe(0);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[44/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Status > should return backup codes count for MFA users
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:464:52
    462|       });
    463| 
    464|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    465| 
    466|       const mfaLoginResponse = await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[45/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should disable MFA with password verification
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:510:38
    508|         .send({ password });
    509| 
    510|       expect(disableResponse.status).toBe(200);
       |                                      ^
    511| 
    512|       // Verify MFA is disabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[46/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should require correct password to disable MFA
AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:557:44
    555| 
    556|       expect(disableResponse.status).toBe(401);
    557|       expect(disableResponse.body.message).toContain("Invalid passwordÎ“Ã‡Âª
       |                                            ^
    558| 
    559|       // MFA should still be enabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[47/179]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should regenerate backup codes
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:588:41
    586|         .set("Authorization", `Bearer ${token}`);
    587| 
    588|       expect(regenerateResponse.status).toBe(200);
       |                                         ^
    589|       expect(regenerateResponse.body.backupCodes).toHaveLength(10);
    590| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[48/179]Î“Ã„Â»

 FAIL  tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #7: Delete organization > should prevent deletion if org owns assets
AssertionError: promise resolved "undefined" instead of rejecting

- Expected: 
Error {
  "message": "rejected promise",
}

+ Received: 
undefined

 Î“Â¥Â» tests/integration/organizations-audit-fixes.test.ts:246:7
    244|       await expect(
    245|         organizationService.deleteOrganization(org.id, user1Id)
    246|       ).rejects.toThrow(/owns workflows/i);
       |       ^
    247| 
    248|       // Cleanup

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[49/179]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 1. Required + Show/Hide (Questions) > should NOT block Next when required question is hidden
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:197:31
    195|             // Check visibility
    196|             const isVisible = evaluateVisibilityExpression("show_triggÎ“Ã‡Âª
    197|             expect(isVisible).toBe(false);
       |                               ^
    198| 
    199|             // Required question is hidden, should not block

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[50/179]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 2. Required + Show/Hide (Pages) > should skip hidden required page entirely
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:330:31
    328|             const isVisible = evaluateVisibilityExpression((section2.vÎ“Ã‡Âª
    329| 
    330|             expect(isVisible).toBe(false); // Section 2 should be hiddÎ“Ã‡Âª
       |                               ^
    331| 
    332|             // Get all sections

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[51/179]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 3. Preview/Snapshot/Live Parity > should evaluate visibility consistently across modes
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:445:64
    443|             // Change data
    444|             const data2 = { trigger: false, value: 10 };
    445|             expect(evaluateVisibilityExpression(expr1, data2)).toBe(faÎ“Ã‡Âª
       |                                                                ^
    446|             expect(evaluateVisibilityExpression(expr2, data2)).toBe(trÎ“Ã‡Âª
    447|             expect(evaluateVisibilityExpression(expr3, data2)).toBe(faÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[52/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should list all active sessions for current user
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:53:31
     51|         .set("Authorization", `Bearer ${token}`);
     52| 
     53|       expect(response.status).toBe(200);
       |                               ^
     54|       expect(response.body.sessions).toBeDefined();
     55|       expect(response.body.sessions.length).toBe(3);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[53/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should mark current session correctly
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:85:30
     83|       const token = login2.body.token;
     84|       const cookies = (login2.headers as any)["set-cookie"] as string[Î“Ã‡Âª
     85|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
     86| 
     87|       // List sessions with cookie (should identify current session)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[54/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should exclude revoked sessions
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:120:50
    118|         .update(refreshTokens)
    119|         .set({ revoked: true })
    120|         .where(eq(refreshTokens.id, allTokens[0].id));
       |                                                  ^
    121| 
    122|       // List sessions

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[55/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should order sessions by last used (most recent first)
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:154:36
    152| 
    153|       // Should be ordered by lastUsedAt descending
    154|       for (let i = 1; i < sessions.length; i++) {
       |                                    ^
    155|         const prev = new Date(sessions[i - 1].lastUsedAt);
    156|         const curr = new Date(sessions[i].lastUsedAt);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[56/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should filter sessions by current user only
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:184:37
    182|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    183| 
    184|       expect(response.body.sessions.length).toBe(2);
       |                                     ^
    185|     });
    186| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[57/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:215:40
    213| 
    214|       const sessions = sessionsResponse.body.sessions;
    215|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    216| 
    217|       // Revoke non-current session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[58/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:249:30
    247|       const token = login.body.token;
    248|       const cookies = (login.headers as any)["set-cookie"] as string[];
    249|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    250| 
    251|       // Get sessions

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[59/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should return 404 for non-existent session
AssertionError: expected 401 to be 404 // Object.is equality

- Expected
+ Received

- 404
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:281:31
    279|         .set("Authorization", `Bearer ${login.body.token}`);
    280| 
    281|       expect(response.status).toBe(404);
       |                               ^
    282|     });
    283| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[60/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking other user's session
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:303:49
    301|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    302| 
    303|       const user1SessionId = user1Sessions.body.sessions[0].id;
       |                                                 ^
    304| 
    305|       // Try to revoke user 1's session as user 2

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[61/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all other sessions
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:329:30
    327|       const token = currentLogin.body.token;
    328|       const cookies = (currentLogin.headers as any)["set-cookie"] as sÎ“Ã‡Âª
    329|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    330| 
    331|       // Revoke all except current

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[62/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should keep current session active
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:360:30
    358|       const token = currentLogin.body.token;
    359|       const cookies = (currentLogin.headers as any)["set-cookie"] as sÎ“Ã‡Âª
    360|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    361| 
    362|       // Revoke all others

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[63/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all trusted devices
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:410:30
    408|       const token = login.body.token;
    409|       const cookies = (login.headers as any)["set-cookie"] as string[];
    410|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    411| 
    412|       // Trust a device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[64/179]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > Session Security > should track session activity timestamps
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:511:37
    509|         .set("Authorization", `Bearer ${login.body.token}`);
    510| 
    511|       const session = response.body.sessions[0];
       |                                     ^
    512| 
    513|       expect(session.createdAt).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[65/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should trust current device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:52:36
     50|         .set("X-Forwarded-For", "192.168.1.100");
     51| 
     52|       expect(trustResponse.status).toBe(200);
       |                                    ^
     53|       expect(trustResponse.body.message).toContain("trusted");
     54|       expect(trustResponse.body.trustedUntil).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[66/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should set trust expiry to 30 days
AssertionError: expected NaN to be 30 // Object.is equality

- Expected
+ Received

- 30
+ NaN

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:92:24
     90|       );
     91| 
     92|       expect(diffDays).toBe(30);
       |                        ^
     93|     });
     94| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[67/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should update expiry if device already trusted
Error: [TEST UTILS] MFA Secret verification failed for 415e7653818c40126a6b86a252dda894
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:96:55

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[68/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should list all trusted devices
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:193:31
    191|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    192| 
    193|       expect(response.status).toBe(200);
       |                               ^
    194|       expect(response.body.devices).toBeDefined();
    195|       expect(response.body.devices.length).toBe(2);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[69/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should mark current device
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:236:51
    234|         .set("X-Forwarded-For", "192.168.1.100");
    235| 
    236|       const currentDevice = response.body.devices.find((d: any) => d.cÎ“Ã‡Âª
       |                                                   ^
    237|       expect(currentDevice).toBeDefined();
    238|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[70/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude revoked devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:269:36
    267|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    268| 
    269|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    270|     });
    271| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[71/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude expired devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:302:36
    300|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    301| 
    302|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    303|     });
    304|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[72/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should revoke specific device
Error: [TEST UTILS] MFA Secret verification failed for dd42bce19a7d052c9e0ad303c5765755
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:308:55

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[73/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should return 404 for non-existent device
AssertionError: expected 401 to be 404 // Object.is equality

- Expected
+ Received

- 404
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:371:31
    369|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    370| 
    371|       expect(response.status).toBe(404);
       |                               ^
    372|     });
    373| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[74/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should prevent revoking other user's device
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:399:43
    397|         .set("Authorization", `Bearer ${mfaLogin1.body.token}`);
    398| 
    399|       const user1DeviceId = devices1.body.devices[0].id;
       |                                           ^
    400| 
    401|       // User 2 tries to revoke user 1's device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[75/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should skip MFA for trusted device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:453:42
    451| 
    452|       // Should not require MFA
    453|       expect(secondLoginResponse.status).toBe(200);
       |                                          ^
    454|       expect(secondLoginResponse.body.requiresMfa).toBeUndefined();
    455|       expect(secondLoginResponse.body.token).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[76/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should require MFA for untrusted device
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:485:51
    483| 
    484|       // Should require MFA
    485|       expect(loginFromNewDevice.body.requiresMfa).toBe(true);
       |                                                   ^
    486|     });
    487| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[77/179]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should update lastUsedAt on trusted device login
TypeError: Cannot read properties of undefined (reading 'lastUsedAt')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:512:38
    510|       });
    511| 
    512|       const firstLastUsed = device1!.lastUsedAt;
       |                                      ^
    513| 
    514|       // Wait a bit

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[78/179]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should create a version and populate changelog
Error: Validation failed: Schema Error: id - Required, Schema Error: title - Required, Schema Error: pages.0.title - Required, Schema Error: pages.0.order - Required
 Î“Â¥Â» VersionService.publishVersion server/services/VersionService.ts:287:13
    285| 
    286|     if (!validation.valid && !force) {
    287|       throw new Error(`Validation failed: ${validation.errors.join(', Î“Ã‡Âª
       |             ^
    288|     }
    289| 
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:97:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[79/179]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should track execution lineage via snapshot
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:117:143
    115| 
    116|         // Create Snapshot
    117|         const snapshot = await snapshotService.createSnapshot(workflowÎ“Ã‡Âª
       |                                                                                                                                               ^
    118| 
    119|         expect(snapshot.workflowVersionId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[80/179]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:68:43
     66| 
     67|       // Should be validating immediately
     68|       expect(result.current.isValidating).toBe(true);
       |                                           ^
     69| 
     70|       // Wait for debounce and validation

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[81/179]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
AssertionError: expected null not to be null

Ignored nodes: comments, script, style
<html>
  <head />
  <body>
    <div />
  </body>
</html>
 Î“Â¥Â» timeout tests/ui/expression-editor.test.tsx:109:55
    107|       await waitFor(
    108|         () => {
    109|           expect(result.current.validationResult).not.toBeNull();
       |                                                       ^
    110|         },
    111|         { timeout: 200 }
 Î“Â¥Â» runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:47:12
 Î“Â¥Â» checkCallback node_modules/@testing-library/dom/dist/wait-for.js:124:77
 Î“Â¥Â» Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:118:16

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[82/179]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate complex expressions with multiple helpers
AssertionError: expected null not to be null

Ignored nodes: comments, script, style
<html>
  <head />
  <body>
    <div />
  </body>
</html>
 Î“Â¥Â» timeout tests/ui/expression-editor.test.tsx:203:55
    201|       await waitFor(
    202|         () => {
    203|           expect(result.current.validationResult).not.toBeNull();
       |                                                       ^
    204|         },
    205|         { timeout: 200 }
 Î“Â¥Â» runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:47:12
 Î“Â¥Â» checkCallback node_modules/@testing-library/dom/dist/wait-for.js:124:77
 Î“Â¥Â» Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:118:16

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[83/179]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should handle syntax errors
AssertionError: expected null not to be null

Ignored nodes: comments, script, style
<html>
  <head />
  <body>
    <div />
  </body>
</html>
 Î“Â¥Â» timeout tests/ui/expression-editor.test.tsx:235:55
    233|       await waitFor(
    234|         () => {
    235|           expect(result.current.validationResult).not.toBeNull();
       |                                                       ^
    236|         },
    237|         { timeout: 200 }
 Î“Â¥Â» runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:47:12
 Î“Â¥Â» checkCallback node_modules/@testing-library/dom/dist/wait-for.js:124:77
 Î“Â¥Â» Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:118:16

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[84/179]Î“Ã„Â»

 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
ReferenceError: React is not defined
 Î“Â¥Â» RunsTable client/src/components/runs/RunsTable.tsx:41:3
     39|   };
     40| 
     41|   return (
       |   ^
     42|     <div className="rounded-md border">
     43|       <Table>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[85/179]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should allow access with valid JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 when no token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 with invalid token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 with expired token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with refresh token cookie (GET only)
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for POST requests (mutation-strict)
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for PUT requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should allow cookie auth for HEAD requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should return 401 when both JWT and cookie are invalid
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should authenticate with JWT if provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should authenticate with cookie if JWT not provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should proceed anonymously if no auth provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Cookie Strategy Security > should ignore cookies when Bearer token present
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach userId to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for invalid token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for expired token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should handle malformed JWT gracefully
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:70:14
     68|                 password: testUser.password,
     69|             })
     70|             .expect(200);
       |              ^
     71| 
     72|         userToken = loginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[86/179]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should prioritize JWT over cookie when both present
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:209:18
    207|                     password: user2.password,
    208|                 })
    209|                 .expect(200);
       |                  ^
    210| 
    211|             // Use user1's cookie with user2's Bearer token
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[87/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should generate valid JWT token on successful login
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:54:18
     52|                 .post("/api/auth/register")
     53|                 .send(testUser)
     54|                 .expect(201);
       |                  ^
     55| 
     56|             // Verify email
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[88/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should include correct payload in JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:90:18
     88|                 .post("/api/auth/register")
     89|                 .send(testUser)
     90|                 .expect(201);
       |                  ^
     91| 
     92|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[89/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should set JWT expiry to 15 minutes
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:122:18
    120|                 .post("/api/auth/register")
    121|                 .send(testUser)
    122|                 .expect(201);
       |                  ^
    123| 
    124|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[90/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should accept valid JWT token on protected routes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:153:18
    151|                     password: testUser.password,
    152|                 })
    153|                 .expect(200);
       |                  ^
    154| 
    155|             const meRes = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[91/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should reject request with missing Bearer prefix
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:183:18
    181|                     password: testUser.password,
    182|                 })
    183|                 .expect(200);
       |                  ^
    184| 
    185|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[92/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Expiration > should return token_expired error code for expired tokens
AssertionError: expected { code: 'AUTH_008', Î“Ã‡Âª(3) } to be 'token_expired' // Object.is equality

- Expected: 
"token_expired"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-10T21:18:34.676Z",
}

 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:237:36
    235|                 .expect(401);
    236| 
    237|             expect(res.body.error).toBe("token_expired");
       |                                    ^
    238|         });
    239|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[93/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on PUT requests
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:268:18
    266|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    267|                 .send({ firstName: "Updated" })
    268|                 .expect(200);
       |                  ^
    269| 
    270|             expect(updateRes.body).toBeDefined();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[94/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on DELETE requests
Error: expected 200 "OK", got 204 "No Content"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:285:18
    283|                 .delete(`/api/projects/${projectRes.body.id}`)
    284|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    285|                 .expect(200);
       |                  ^
    286|         });
    287|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:847:12
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[95/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Cookie-to-Token Exchange > should exchange valid session cookie for JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:295:18
    293|                 .post("/api/auth/register")
    294|                 .send(testUser)
    295|                 .expect(201);
       |                  ^
    296| 
    297|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[96/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should prefer Bearer token over cookie when both present
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:330:18
    328|                     email: `user1-${nanoid()}@example.com`,
    329|                 })
    330|                 .expect(201);
       |                  ^
    331| 
    332|             const user2Res = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[97/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should fall back to cookie if Bearer token is invalid
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:358:18
    356|                 .post("/api/auth/register")
    357|                 .send(testUser)
    358|                 .expect(201);
       |                  ^
    359| 
    360|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[98/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should allow GET requests with cookie auth only
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:377:18
    375|                 .post("/api/auth/register")
    376|                 .send(testUser)
    377|                 .expect(201);
       |                  ^
    378| 
    379|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[99/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should reject POST requests with cookie auth only (mutation-strict)
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:406:18
    404|                 .post("/api/auth/register")
    405|                 .send(testUser)
    406|                 .expect(201);
       |                  ^
    407| 
    408|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[100/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should allow anonymous access to public workflows
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:432:18
    430|                     publicLink: `public-${nanoid()}`,
    431|                 })
    432|                 .expect(201);
       |                  ^
    433| 
    434|             // Access without authentication
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[101/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should attach user info if authenticated on optional auth routes
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:451:18
    449|                     publicLink: `optional-${nanoid()}`,
    450|                 })
    451|                 .expect(201);
       |                  ^
    452| 
    453|             // Access with authentication
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[102/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should refresh access token using refresh token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:469:18
    467|                 .post("/api/auth/register")
    468|                 .send(testUser)
    469|                 .expect(201);
       |                  ^
    470| 
    471|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[103/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should rotate refresh token on use
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:503:18
    501|                 .post("/api/auth/register")
    502|                 .send(testUser)
    503|                 .expect(201);
       |                  ^
    504| 
    505|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[104/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should detect token reuse and revoke all user tokens
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:544:18
    542|                 .post("/api/auth/register")
    543|                 .send(testUser)
    544|                 .expect(201);
       |                  ^
    545| 
    546|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[105/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should revoke refresh token on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:595:18
    593|                 .post("/api/auth/register")
    594|                 .send(testUser)
    595|                 .expect(201);
       |                  ^
    596| 
    597|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[106/179]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should clear refresh token cookie on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:628:18
    626|                 .post("/api/auth/register")
    627|                 .send(testUser)
    628|                 .expect(201);
       |                  ^
    629| 
    630|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[107/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should prevent revoking current session
AssertionError: expected 404 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 404

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:263:31
    261|         .set('Cookie', `refresh_token=${token}`);
    262| 
    263|       expect(response.status).toBe(400);
       |                               ^
    264|       expect(response.body.message).toContain('Cannot revoke current sÎ“Ã‡Âª
    265|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[108/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/all - Logout All Other Devices > should revoke all sessions except current
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:332:37
    330|         ));
    331| 
    332|       expect(activeSessions.length).toBe(1);
       |                                     ^
    333|       expect(activeSessions[0].token).toBe(hashToken(currentToken));
    334|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[109/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > POST /api/auth/trust-device > should update existing trusted device expiry
TypeError: Cannot read properties of undefined (reading 'lastUsedAt')
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:439:26
    437|         // Expiry should be updated
    438|         expect(devices[0].lastUsedAt?.getTime()).toBeGreaterThan(
    439|           initialDevice!.lastUsedAt?.getTime() || 0
       |                          ^
    440|         );
    441|       });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[110/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > GET /api/auth/trusted-devices > should list all trusted devices
AssertionError: expected +0 to be 2 // Object.is equality

- Expected
+ Received

- 2
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:472:46
    470|         expect(response.status).toBe(200);
    471|         expect(response.body.devices).toBeInstanceOf(Array);
    472|         expect(response.body.devices.length).toBe(2);
       |                                              ^
    473| 
    474|         response.body.devices.forEach((device: any) => {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[111/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > DELETE /api/auth/trusted-devices/:deviceId > should revoke a trusted device
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:521:33
    519|           .set('Authorization', `Bearer ${authToken}`);
    520| 
    521|         expect(response.status).toBe(200);
       |                                 ^
    522|         expect(response.body.message).toBe('Device revoked successfullÎ“Ã‡Âª
    523| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[112/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should update lastUsedAt on token refresh
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:590:31
    588|         ));
    589| 
    590|       expect(sessions.length).toBe(1);
       |                               ^
    591|       expect(sessions[0].lastUsedAt).toBeDefined();
    592|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[113/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should refresh access token with valid refresh token
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:95:31
     93|         .set('Cookie', `refresh_token=${testRefreshToken}`);
     94| 
     95|       expect(response.status).toBe(200);
       |                               ^
     96|       expect(response.body).toMatchObject({
     97|         token: expect.any(String),

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[114/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should create refresh token on login
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:316:31
    314|         });
    315| 
    316|       expect(response.status).toBe(200);
       |                               ^
    317| 
    318|       // Verify refresh token cookie is set

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[115/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should revoke refresh token on logout
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:343:30
    341|         where: eq(refreshTokens.token, hashToken(testRefreshToken)),
    342|       });
    343|       expect(token?.revoked).toBe(true);
       |                              ^
    344| 
    345|       // Verify cookie is cleared

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[116/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should support multiple active refresh tokens per user
AssertionError: expected 0 to be greater than or equal to 3
 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:378:35
    376|         ));
    377| 
    378|       expect(activeTokens.length).toBeGreaterThanOrEqual(3);
       |                                   ^
    379|     });
    380| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[117/179]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Cookie Security > should set HttpOnly flag to prevent XSS
AssertionError: expected 'refresh_token=; Max-Age=0; Path=/' to contain 'HttpOnly'

Expected: "HttpOnly"
Received: "refresh_token=; Max-Age=0; Path=/"

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:487:31
    485| 
    486|       const setCookieHeader = response.headers['set-cookie']?.[0];
    487|       expect(setCookieHeader).toContain('HttpOnly');
       |                               ^
    488|     });
    489| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[118/179]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should allow access with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access without Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with empty Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with malformed Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with wrong token type
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should allow POST with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST with invalid token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should reject PUT without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > DELETE Protected Routes > should allow DELETE with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PATCH Protected Routes > should allow PATCH with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PATCH Protected Routes > should reject PATCH without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle very long invalid token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle empty Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle Authorization header with only Bearer
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle multiple Authorization headers
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should reject token with SQL injection attempt
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should reject token with XSS attempt
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Cross-User Authorization > should not allow user to access another user's resources
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > User Context Injection > should inject userId into request context
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > User Context Injection > should inject tenantId into request context
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Rate Limiting on Protected Routes > should not apply general rate limiting to authenticated requests
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:80:14
     78|                 password: testUser.password,
     79|             })
     80|             .expect(200);
       |              ^
     81| 
     82|         userToken = loginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[119/179]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Mixed Auth Scenarios > should handle request with both Bearer token and cookies
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:422:18
    420|                     password: testUser.password,
    421|                 })
    422|                 .expect(200);
       |                  ^
    423| 
    424|             const cookies = loginRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[120/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create refresh token on login
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:74:18
     72|                     password: testUser.password,
     73|                 })
     74|                 .expect(200);
       |                  ^
     75| 
     76|             expect(loginRes.headers['set-cookie']).toBeDefined();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[121/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should track device metadata in session
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:100:18
     98|                     password: testUser.password,
     99|                 })
    100|                 .expect(200);
       |                  ^
    101| 
    102|             const tokens = await db.query.refreshTokens.findMany({
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[122/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create separate sessions for multiple device logins
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:130:18
    128|                     password: testUser.password,
    129|                 })
    130|                 .expect(200);
       |                  ^
    131| 
    132|             // Login from device 3
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[123/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should list all active sessions for user
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:163:18
    161|                     password: testUser.password,
    162|                 })
    163|                 .expect(200);
       |                  ^
    164| 
    165|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[124/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should mark current session correctly
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:208:18
    206|                     password: testUser.password,
    207|                 })
    208|                 .expect(200);
       |                  ^
    209| 
    210|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[125/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should not include revoked sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:246:18
    244|                     password: testUser.password,
    245|                 })
    246|                 .expect(200);
       |                  ^
    247| 
    248|             // Get all sessions to find session2's ID
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[126/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should order sessions by last used (most recent first)
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:282:18
    280|                     password: testUser.password,
    281|                 })
    282|                 .expect(200);
       |                  ^
    283| 
    284|             await new Promise(resolve => setTimeout(resolve, 100));
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[127/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should revoke specific session
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:332:18
    330|                     password: testUser.password,
    331|                 })
    332|                 .expect(200);
       |                  ^
    333| 
    334|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[128/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should not allow revoking other users sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:435:18
    433|                     password: testUser.password,
    434|                 })
    435|                 .expect(200);
       |                  ^
    436| 
    437|             // User1 tries to revoke user2's session
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[129/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should return 404 for non-existent session ID
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:452:18
    450|                     password: testUser.password,
    451|                 })
    452|                 .expect(200);
       |                  ^
    453| 
    454|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[130/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/all > should revoke all sessions except current
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:480:18
    478|                     password: testUser.password,
    479|                 })
    480|                 .expect(200);
       |                  ^
    481| 
    482|             const session3 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[131/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/all > should revoke all trusted devices
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:523:18
    521|                     password: testUser.password,
    522|                 })
    523|                 .expect(200);
       |                  ^
    524| 
    525|             // Trust device
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[132/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Expiration > should reject refresh token after 30 days
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:564:18
    562|                     password: testUser.password,
    563|                 })
    564|                 .expect(200);
       |                  ^
    565| 
    566|             // Get the refresh token from database (non-revoked only)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[133/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Concurrent Session Handling > should handle multiple concurrent logins
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:610:36
    608| 
    609|             logins.forEach(res => {
    610|                 expect(res.status).toBe(200);
       |                                    ^
    611|                 expect(res.body.token).toBeDefined();
    612|             });
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:609:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[134/179]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Concurrent Session Handling > should handle concurrent token refreshes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:631:18
    629|                     password: testUser.password,
    630|                 })
    631|                 .expect(200);
       |                  ^
    632| 
    633|             const cookies = session.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[135/179]Î“Ã„Â»


[2m Test Files [22m [1m[31m28 failed[39m[22m[2m | [22m[1m[32m126 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (155)[39m
[2m      Tests [22m [1m[31m176 failed[39m[22m[2m | [22m[1m[32m2323 passed[39m[22m[2m | [22m[33m50 skipped[39m[90m (2549)[39m
[2m   Start at [22m 15:18:08
[2m   Duration [22m 102.88s[2m (transform 71.31s, setup 58.95s, import 394.43s, tests 785.09s, environment 27.60s)[22m

