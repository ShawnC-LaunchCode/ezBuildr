npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

> ezbuildr@1.0.0 test:auth
> vitest run -c vitest.config.auth.ts


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mğŸ”§ Setting up auth test environment...
âœ… Auth test environment ready

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mğŸ”§ Setting up auth test environment...
âœ… Auth test environment ready

 [32mâœ“[39m [30m[45m auth-tests [49m[39m tests/unit/services/AccountLockoutService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 15[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: ğŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mğŸ”§ Setting up auth test environment...
âœ… Auth test environment ready

 [32mâœ“[39m [30m[45m auth-tests [49m[39m tests/unit/services/MfaService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 1069[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuthService.test.ts[2m > [22m[2mAuthService[2m > [22m[2mJWT Token Management[2m > [22m[2mverifyToken()[2m > [22m[2mshould throw error for invalid token signature
[22m[39mDEBUG: verifyToken threw: Invalid or malformed token InvalidTokenError

 [31mâ¯[39m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 6853[2mms[22m[39m
         [32mâœ“[39m should hash a password using bcrypt with 12 rounds[32m 216[2mms[22m[39m
         [33m[2mâœ“[22m[39m should generate different hashes for same password [33m 414[2mms[22m[39m
         [32mâœ“[39m should handle empty passwords[32m 216[2mms[22m[39m
         [32mâœ“[39m should handle long passwords[32m 209[2mms[22m[39m
         [32mâœ“[39m should handle unicode characters in password[32m 204[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return true for correct password [33m 412[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return false for incorrect password [33m 430[2mms[22m[39m
         [33m[2mâœ“[22m[39m should be case-sensitive [33m 430[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle empty password comparison [33m 434[2mms[22m[39m
         [32mâœ“[39m should accept valid email addresses[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails longer than 254 characters (RFC 5321)[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails shorter than 3 characters[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails with consecutive dots[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails without @ symbol[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails without domain[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails with spaces[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails without TLD[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject null or undefined[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject emails with local part longer than 64 characters[32m 0[2mms[22m[39m
         [32mâœ“[39m should accept valid strong passwords[32m 18[2mms[22m[39m
         [32mâœ“[39m should reject passwords shorter than 8 characters[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject passwords longer than 128 characters[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject weak passwords with zxcvbn score < 3[32m 4[2mms[22m[39m
         [32mâœ“[39m should provide helpful feedback for weak passwords[32m 2[2mms[22m[39m
         [32mâœ“[39m should reject password containing user's email[32m 3[2mms[22m[39m
         [32mâœ“[39m should reject password containing user's name[32m 2[2mms[22m[39m
         [32mâœ“[39m should accept strong password even with user inputs provided[32m 4[2mms[22m[39m
         [32mâœ“[39m should accept password with exactly 8 characters if strong enough[32m 2[2mms[22m[39m
         [32mâœ“[39m should accept password with exactly 128 characters if strong[32m 63[2mms[22m[39m
         [32mâœ“[39m should return score in result object[32m 3[2mms[22m[39m
         [32mâœ“[39m should create a valid JWT token for a user[32m 4[2mms[22m[39m
         [32mâœ“[39m should include userId, email, tenantId, and role in token payload[32m 2[2mms[22m[39m
         [32mâœ“[39m should set token expiry to 15 minutes by default[32m 1[2mms[22m[39m
         [32mâœ“[39m should throw error if JWT_SECRET is not configured[32m 1[2mms[22m[39m
         [32mâœ“[39m should handle null tenantId and role[32m 1[2mms[22m[39m
         [32mâœ“[39m should verify and decode a valid token[32m 2[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error for expired token [33m 1103[2mms[22m[39m
         [32mâœ“[39m should throw error for invalid token signature[32m 2[2mms[22m[39m
         [32mâœ“[39m should throw error for malformed token[32m 1[2mms[22m[39m
         [32mâœ“[39m should throw error for invalid token[32m 1[2mms[22m[39m
         [32mâœ“[39m should extract token from Bearer authorization header[32m 1[2mms[22m[39m
         [32mâœ“[39m should return token if no Bearer prefix[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for undefined header[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for empty header[32m 1[2mms[22m[39m
         [32mâœ“[39m should handle Bearer with multiple spaces[32m 1[2mms[22m[39m
         [32mâœ“[39m should return true for JWT-like tokens[32m 1[2mms[22m[39m
         [32mâœ“[39m should return false for non-JWT tokens[32m 1[2mms[22m[39m
         [32mâœ“[39m should return false for empty token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return false for null/undefined[32m 1[2mms[22m[39m
         [32mâœ“[39m should create a valid portal token for an email[32m 2[2mms[22m[39m
         [32mâœ“[39m should include email and portal flag in token payload[32m 1[2mms[22m[39m
         [32mâœ“[39m should set token expiry to 24 hours[32m 1[2mms[22m[39m
         [32mâœ“[39m should verify and decode a valid portal token[32m 1[2mms[22m[39m
         [32mâœ“[39m should throw error for non-portal token[32m 1[2mms[22m[39m
         [32mâœ“[39m should throw error for token without email[32m 1[2mms[22m[39m
         [32mâœ“[39m should throw error for expired portal token[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should generate password reset token for existing user[39m[32m 222[2mms[22m[39m
         [32mâœ“[39m should return null for non-existent user[32m 2[2mms[22m[39m
[31m         [31mÃ—[31m should invalidate previous reset tokens[39m[32m 2[2mms[22m[39m
         [32mâœ“[39m should return userId for valid token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for invalid token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for expired token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for used token[32m 1[2mms[22m[39m
         [32mâœ“[39m should mark token as used[32m 1[2mms[22m[39m
         [32mâœ“[39m should generate verification token[32m 1[2mms[22m[39m
         [32mâœ“[39m should have 24 hour expiry[32m 1[2mms[22m[39m
         [32mâœ“[39m should verify email with valid token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return false for invalid token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return false for expired token[32m 1[2mms[22m[39m
         [32mâœ“[39m should delete token after successful verification[32m 1[2mms[22m[39m
         [32mâœ“[39m should create refresh token with 30-day expiry[32m 8[2mms[22m[39m
         [32mâœ“[39m should store device metadata[32m 1[2mms[22m[39m
         [32mâœ“[39m should return userId for valid token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for revoked token[32m 1[2mms[22m[39m
         [32mâœ“[39m should return null for expired token[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should rotate valid token and return new one[39m[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should return null for unknown token[39m[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should revoke all tokens on reuse detection[39m[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should return null for expired token[39m[32m 1[2mms[22m[39m
         [32mâœ“[39m should revoke specific token[32m 1[2mms[22m[39m
         [32mâœ“[39m should revoke all tokens for user[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should cleanup expired refresh tokens[39m[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should cleanup expired password reset tokens[39m[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should cleanup expired email verification tokens[39m[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should cleanup old login attempts via accountLockoutService[39m[32m 1[2mms[22m[39m
         [32mâœ“[39m should use JWT_SECRET if provided[32m 1[2mms[22m[39m
         [32mâœ“[39m should warn if JWT_SECRET is less than 32 characters[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject token with modified payload[32m 2[2mms[22m[39m
         [32mâœ“[39m should reject token with valid structure but invalid signature[32m 1[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle password with special characters [33m 429[2mms[22m[39m
         [32mâœ“[39m should handle password with only spaces[32m 215[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle password with newlines and tabs [33m 429[2mms[22m[39m
         [33m[2mâœ“[22m[39m should reject password with null bytes (if validation exists) [33m 432[2mms[22m[39m
         [32mâœ“[39m should reject email with unicode domain (security fix)[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject email starting with dot (security fix)[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject email ending with dot before @ (security fix)[32m 1[2mms[22m[39m
         [32mâœ“[39m should handle email with plus addressing[32m 1[2mms[22m[39m
         [32mâœ“[39m should handle email with subdomain[32m 1[2mms[22m[39m
         [32mâœ“[39m should reject email with invalid TLD (single char)[32m 0[2mms[22m[39m
         [32mâœ“[39m should accept email with numeric TLD[32m 1[2mms[22m[39m
         [32mâœ“[39m should prevent timing attacks on token validation[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should support full user authentication lifecycle[39m[32m 217[2mms[22m[39m
[31m         [31mÃ—[31m should support complete password reset workflow[39m[32m 1[2mms[22m[39m
[31m         [31mÃ—[31m should prevent reuse of password reset tokens[39m[32m 1[2mms[22m[39m
         [32mâœ“[39m should support multiple valid refresh tokens per user[32m 1[2mms[22m[39m
         [32mâœ“[39m should revoke all user tokens on security event[32m 1[2mms[22m[39m
         [32mâœ“[39m should handle database connection failures gracefully[32m 2[2mms[22m[39m
         [32mâœ“[39m should handle transaction failures[32m 1[2mms[22m[39m
         [32mâœ“[39m should throw error if JWT signing fails[32m 1[2mms[22m[39m
         [32mâœ“[39m should hash password in reasonable time (< 500ms)[32m 215[2mms[22m[39m
         [33m[2mâœ“[22m[39m should compare password in reasonable time (< 500ms) [33m 427[2mms[22m[39m
         [32mâœ“[39m should create JWT token in < 10ms[32m 1[2mms[22m[39m
         [32mâœ“[39m should verify JWT token in < 50ms[32m 2[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 13 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mgeneratePasswordResetToken()[2m > [22mshould generate password reset token for existing user
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.generatePasswordResetToken server/services/AuthService.ts:[2m508:9[22m[39m
    [90m506| [39m
    [90m507| [39m        [35mawait[39m [34msendPasswordResetEmail[39m(email[33m,[39m plainToken)[33m;[39m
    [90m508| [39m        log[33m.[39m[34minfo[39m({ email }[33m,[39m [32m'Password reset email sent'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m509| [39m
    [90m510| [39m        [35mreturn[39m plainToken[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m671:23[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mPassword Reset[2m > [22mgeneratePasswordResetToken()[2m > [22mshould invalidate previous reset tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.generatePasswordResetToken server/services/AuthService.ts:[2m508:9[22m[39m
    [90m506| [39m
    [90m507| [39m        [35mawait[39m [34msendPasswordResetEmail[39m(email[33m,[39m plainToken)[33m;[39m
    [90m508| [39m        log[33m.[39m[34minfo[39m({ email }[33m,[39m [32m'Password reset email sent'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m509| [39m
    [90m510| [39m        [35mreturn[39m plainToken[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m695:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould rotate valid token and return new one
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m901:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould return null for unknown token
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m914:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould revoke all tokens on reuse detection
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m933:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mRefresh Token Management[2m > [22mrotateRefreshToken()[2m > [22mshould return null for expired token
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m950:42[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired refresh tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.cleanupExpiredTokens server/services/AuthService.ts:[2m593:9[22m[39m
    [90m591| [39m        [35mawait[39m accountLockoutService[33m.[39m[34mcleanupOldAttempts[39m()[33m;[39m
    [90m592| [39m
    [90m593| [39m        log[33m.[39m[34minfo[39m([32m'Cleaned up expired tokens and old login attempts'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m594| [39m    }
    [90m595| [39m}
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m977:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired password reset tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.cleanupExpiredTokens server/services/AuthService.ts:[2m593:9[22m[39m
    [90m591| [39m        [35mawait[39m accountLockoutService[33m.[39m[34mcleanupOldAttempts[39m()[33m;[39m
    [90m592| [39m
    [90m593| [39m        log[33m.[39m[34minfo[39m([32m'Cleaned up expired tokens and old login attempts'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m594| [39m    }
    [90m595| [39m}
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m982:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup expired email verification tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.cleanupExpiredTokens server/services/AuthService.ts:[2m593:9[22m[39m
    [90m591| [39m        [35mawait[39m accountLockoutService[33m.[39m[34mcleanupOldAttempts[39m()[33m;[39m
    [90m592| [39m
    [90m593| [39m        log[33m.[39m[34minfo[39m([32m'Cleaned up expired tokens and old login attempts'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m594| [39m    }
    [90m595| [39m}
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m987:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mToken Cleanup[2m > [22mcleanupExpiredTokens()[2m > [22mshould cleanup old login attempts via accountLockoutService
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.cleanupExpiredTokens server/services/AuthService.ts:[2m593:9[22m[39m
    [90m591| [39m        [35mawait[39m accountLockoutService[33m.[39m[34mcleanupOldAttempts[39m()[33m;[39m
    [90m592| [39m
    [90m593| [39m        log[33m.[39m[34minfo[39m([32m'Cleaned up expired tokens and old login attempts'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m594| [39m    }
    [90m595| [39m}
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m993:9[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mComplete Authentication Flow[2m > [22mshould support full user authentication lifecycle
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.rotateRefreshToken server/services/AuthService.ts:[2m396:9[22m[39m
    [90m394| [39m        [90m// DEBUG LOG[39m
    [90m395| [39m        [90m// logger is available as 'log' from imports[39m
    [90m396| [39m        log.info({ tokenHash, plainTokenLen: plainToken.length }, 'DEBâ€¦
    [90m   | [39m        [31m^[39m
    [90m397| [39m
    [90m398| [39m        [90m// Find token purely by hash to detect state[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m1239:43[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mPassword Reset Flow[2m > [22mshould support complete password reset workflow
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.generatePasswordResetToken server/services/AuthService.ts:[2m508:9[22m[39m
    [90m506| [39m
    [90m507| [39m        [35mawait[39m [34msendPasswordResetEmail[39m(email[33m,[39m plainToken)[33m;[39m
    [90m508| [39m        log[33m.[39m[34minfo[39m({ email }[33m,[39m [32m'Password reset email sent'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m509| [39m
    [90m510| [39m        [35mreturn[39m plainToken[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m1259:28[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/13]â¯[22m[39m

[41m[1m FAIL [22m[49m [30m[45m auth-tests [49m[39m tests/unit/services/AuthService.test.ts[2m > [22mAuthService[2m > [22mIntegration Scenarios[2m > [22mPassword Reset Flow[2m > [22mshould prevent reuse of password reset tokens
[31m[1mReferenceError[22m: log is not defined[39m
[36m [2mâ¯[22m AuthService.generatePasswordResetToken server/services/AuthService.ts:[2m508:9[22m[39m
    [90m506| [39m
    [90m507| [39m        [35mawait[39m [34msendPasswordResetEmail[39m(email[33m,[39m plainToken)[33m;[39m
    [90m508| [39m        log[33m.[39m[34minfo[39m({ email }[33m,[39m [32m'Password reset email sent'[39m)[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m509| [39m
    [90m510| [39m        [35mreturn[39m plainToken[33m;[39m
[90m [2mâ¯[22m tests/unit/services/AuthService.test.ts:[2m1296:28[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/13]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m2 passed[39m[22m[90m (3)[39m
[2m      Tests [22m [1m[31m13 failed[39m[22m[2m | [22m[1m[32m146 passed[39m[22m[90m (159)[39m
[2m   Start at [22m 09:06:01
[2m   Duration [22m 8.26s[2m (transform 740ms, setup 118ms, import 2.38s, tests 7.94s, environment 0ms)[22m

