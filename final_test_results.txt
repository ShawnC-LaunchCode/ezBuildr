npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

> ezbuildr@1.0.0 test
> cross-env VITEST_INTEGRATION=true vitest run --coverage


[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w14
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w14 (Reused: true)

{"level":30,"time":1768363696314,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w9
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363696358,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w9 (Reused: true)

{"level":30,"time":1768363696376,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363696467,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w13
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w13 (Reused: true)

{"level":30,"time":1768363696891,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w0
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363696949,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w0 (Reused: true)

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363698066,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363698074,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363698105,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363698118,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363698189,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363698249,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363698296,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363698384,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363698453,"env":"test","module":"email-queue","jobId":"4f60d498-5208-48e0-9b86-171bd5f01016","to":"newuser_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w11
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w11 (Reused: true)

{"level":30,"time":1768363698696,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w5
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w3
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w2
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363698763,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w5 (Reused: true)

{"level":30,"time":1768363698767,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w8
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w3 (Reused: true)

{"level":30,"time":1768363698777,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w2 (Reused: true)

{"level":30,"time":1768363698780,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363698820,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w8 (Reused: true)

{"level":30,"time":1768363698822,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363698824,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363698829,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w7
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363698871,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w7 (Reused: true)

{"level":30,"time":1768363698912,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363698955,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2museExpressionValidation[2m > [22m[2mshould validate expression after debounce
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2museExpressionValidation[2m > [22m[2mshould return validation errors for invalid expression
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstdout[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2museExpressionValidation[2m > [22m[2mshould return validation errors for invalid expression
[22m[39mValidation Result DEBUG: {"ok":false,"errors":[{"message":"Unknown identifier: unknown_var","start":{"line":0,"col":0},"end":{"line":0,"col":11}}]}
IsValid DEBUG: [33mfalse[39m

[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2museExpressionValidation[2m > [22m[2mshould debounce validation calls
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2museExpressionValidation[2m > [22m[2mshould not validate when workflowId or nodeId is missing
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2museExpressionValidation[2m > [22m[2mshould not validate when workflowId or nodeId is missing
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2mExpression validation integration[2m > [22m[2mshould validate helper functions in expressions
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2mExpression validation integration[2m > [22m[2mshould validate complex expressions with multiple helpers
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768363699737,"env":"test","module":"user-credentials-repository","userId":"qRvnf2R7sw-47GzRWXtSc","msg":"User credentials created"}
{"level":30,"time":1768363699827,"env":"test","module":"auth-service","tokenHash":"a63d72b08b1eafa6491b045937995686a7907bb585161376ebc9e98b15164e21","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363699833,"env":"test","module":"email-queue","jobId":"e3c0805c-6650-4e66-a7a2-ae1737f08108","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould list all active sessions for current user
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363699869,"env":"test","module":"user-credentials-repository","userId":"6be5643e-6a2d-4454-bceb-9e278285f839","msg":"User credentials created"}
[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2mExpression validation integration[2m > [22m[2mshould handle syntax errors
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould complete full MFA setup flow
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould trust current device
[22m[39m[TEST UTILS] MFA Secret verified for df5bf239c3510372975583b2380dcf82

{"level":30,"time":1768363699962,"env":"test","module":"user-credentials-repository","userId":"629db5f6-7378-472d-9990-a1a6ddccd1c4","msg":"User credentials created"}
{"level":30,"time":1768363699973,"env":"test","module":"email-queue","jobId":"f8bda5a7-b223-4583-9b1c-17fc45067c96","to":"test-1768363699414-9lx3e8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363700009,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363700017,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363700017,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363700034,"env":"test","module":"auth-routes","userId":"6be5643e-6a2d-4454-bceb-9e278285f839","email":"test-1768363699414-9lx3e8@example.com","msg":"User registered"}
[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2mExpression Editor component behavior[2m > [22m[2mshould update validation when expression changes
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768363700030,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363700071,"env":"test","module":"email-queue","jobId":"0ee3f0d1-04a9-4590-af69-a06a5e22de74","to":"test-1768363699493-qnydu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363700058,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363700133,"env":"test","module":"auth-routes","userId":"629db5f6-7378-472d-9990-a1a6ddccd1c4","email":"test-1768363699493-qnydu@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mComplete Registration â†’ Login Flow[2m > [22m[2mshould complete registration, verify email, then login
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstderr[2m | tests/ui/expression-editor.test.tsx[2m > [22m[2mExpression Editor Hooks[2m > [22m[2mExpression Editor component behavior[2m > [22m[2mshould update validation when expression changes
[22m[39mWarning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould trust current device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363700310,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363700310,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/ui/expression-editor.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 3892[2mms[22m[39m
{"level":30,"time":1768363700398,"env":"test","module":"auth-routes","userId":"fd719219e5a82b4c28924a8e427fae93","msg":"User logged in successfully"}
{"level":30,"time":1768363700402,"env":"test","module":"auth-routes","userId":"9d4a9f86b43412dc248fc20a23d5b136","msg":"User logged in successfully"}
{"level":30,"time":1768363700424,"env":"test","module":"user-credentials-repository","userId":"-cr1q-A5XjsUusmZEHrDj","msg":"User credentials created"}
{"level":30,"time":1768363700455,"env":"test","module":"audit-log-service","userId":"fd719219e5a82b4c28924a8e427fae93","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363700484,"env":"test","module":"audit-log-service","userId":"9d4a9f86b43412dc248fc20a23d5b136","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363700489,"env":"test","module":"auth-service","tokenHash":"bdd831350ed92039a5b088ac33c8ac5153adda3551aadb8dacb6f39c435dfee6","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould list all active sessions for current user
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363700575,"env":"test","module":"auth-routes","userId":"629db5f6-7378-472d-9990-a1a6ddccd1c4","email":"test-1768363699493-qnydu@example.com","msg":"Login blocked: email not verified"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mComplete Registration â†’ Login Flow[2m > [22m[2mshould complete registration, verify email, then login
[22m[39mLogin Failed DEBUG: EmailNotVerifiedError: Please verify your email before logging in. Check your inbox for the verification link.
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:93:11)
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_006'[39m,
  statusCode: [33m403[39m,
  isOperational: [33mtrue[39m
}

{"level":50,"time":1768363700575,"env":"test","module":"auth-routes","error":{"name":"EmailNotVerifiedError","code":"AUTH_006","statusCode":403,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mComplete Registration â†’ Login Flow[2m > [22m[2mshould complete registration, verify email, then login
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363700777,"env":"test","module":"auth-routes","userId":"df5bf239c3510372975583b2380dcf82","msg":"Login requires MFA verification"}
{"level":30,"time":1768363700894,"env":"test","module":"mfa-service","userId":"df5bf239c3510372975583b2380dcf82","msg":"TOTP verification successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768363700964,"env":"test","module":"auth-routes","userId":"df5bf239c3510372975583b2380dcf82","msg":"MFA login successful"}
{"level":30,"time":1768363701088,"env":"test","module":"auth-routes","userId":"9d4a9f86b43412dc248fc20a23d5b136","msg":"User logged in successfully"}
{"level":30,"time":1768363701095,"env":"test","module":"mfa-service","userId":"fd719219e5a82b4c28924a8e427fae93","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363701095,"env":"test","module":"mfa-service","userId":"fd719219e5a82b4c28924a8e427fae93","msg":"Generated TOTP secret"}
{"level":30,"time":1768363701095,"env":"test","module":"auth-routes","userId":"fd719219e5a82b4c28924a8e427fae93","msg":"MFA setup initiated"}
{"level":30,"time":1768363701149,"env":"test","module":"auth-routes","userId":"df5bf239c3510372975583b2380dcf82","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363701150,"env":"test","module":"audit-log-service","userId":"9d4a9f86b43412dc248fc20a23d5b136","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould list all active sessions for current user
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363701215,"env":"test","module":"auth-routes","userId":"629db5f6-7378-472d-9990-a1a6ddccd1c4","msg":"User logged in successfully"}
{"level":30,"time":1768363701220,"env":"test","module":"user-credentials-repository","userId":"U2EKoDKM8ZiS7rAahqXfV","msg":"User credentials created"}
{"level":30,"time":1768363701226,"env":"test","module":"user-credentials-repository","userId":"d2fa0507-5abd-4fdc-997d-f8909dba9788","msg":"User credentials created"}
{"level":30,"time":1768363701267,"env":"test","module":"audit-log-service","userId":"629db5f6-7378-472d-9990-a1a6ddccd1c4","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363701280,"env":"test","module":"email-queue","jobId":"bc98f80b-9ea5-4e67-90e8-65eed40062c3","to":"newuser_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363701331,"env":"test","module":"email-queue","jobId":"4a18152f-3987-4a3d-95c4-1d0d46f6a9a5","to":"test-1768363700768-pzjgpg@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363701387,"env":"test","module":"auth-routes","userId":"d2fa0507-5abd-4fdc-997d-f8909dba9788","email":"test-1768363700768-pzjgpg@example.com","msg":"User registered"}
{"level":30,"time":1768363701421,"env":"test","module":"mfa-service","userId":"fd719219e5a82b4c28924a8e427fae93","msg":"MFA enabled successfully"}
{"level":30,"time":1768363701421,"env":"test","module":"auth-routes","userId":"fd719219e5a82b4c28924a8e427fae93","msg":"MFA enabled successfully"}
{"level":30,"time":1768363701475,"env":"test","module":"audit-log-service","userId":"fd719219e5a82b4c28924a8e427fae93","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363701650,"env":"test","module":"user-credentials-repository","userId":"C2loAvjv2cksmPGgl5X4A","msg":"User credentials created"}
{"level":30,"time":1768363701685,"env":"test","module":"auth-routes","userId":"9d4a9f86b43412dc248fc20a23d5b136","msg":"User logged in successfully"}
{"level":30,"time":1768363701710,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","plainTokenLen":19,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363701741,"env":"test","module":"audit-log-service","userId":"9d4a9f86b43412dc248fc20a23d5b136","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768363701770,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","msg":"Security: Unknown refresh token used (Not Found in DB)"}
{"level":30,"time":1768363701867,"env":"test","module":"auth-routes","userId":"9d4a9f86b43412dc248fc20a23d5b136","sessionCount":3,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363702267,"env":"test","module":"auth-service","allTokensCount":4920,"sampleToken":"2b484d683e217a5794883c3321285a69f23da26d5e0f749725f993d77b121982","msg":"DEBUG: Tokens in DB"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould set trust expiry to 30 days
[22m[39m[TEST UTILS] MFA Secret verified for 3a9317071bd4f8b7e89664d0f9966492

{"level":30,"time":1768363702540,"env":"test","module":"user-credentials-repository","userId":"4bc28a6d-f4de-4f39-9b51-dd709f4af8f3","msg":"User credentials created"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould set trust expiry to 30 days
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould reject invalid TOTP code during setup
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363702640,"env":"test","module":"email-queue","jobId":"cece2e51-afa2-4bd9-9181-84faa94fa32c","to":"test-1768363702118-ejx3yc@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363702648,"env":"test","module":"user-credentials-repository","userId":"VovrjTyJl4vgNZF7VMWXt","msg":"User credentials created"}
{"level":30,"time":1768363702691,"env":"test","module":"auth-routes","userId":"4bc28a6d-f4de-4f39-9b51-dd709f4af8f3","email":"test-1768363702118-ejx3yc@example.com","msg":"User registered"}
{"level":50,"time":1768363702710,"env":"test","module":"auth-routes","email":"test-1768363701909-um4wz6@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363702764,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","plainTokenLen":17,"msg":"DEBUG: rotateRefreshToken called"}
{"level":50,"time":1768363702819,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

{"level":40,"time":1768363702818,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","msg":"Security: Unknown refresh token used (Not Found in DB)"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould mark current session correctly
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould login with valid credentials
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363703158,"env":"test","module":"auth-routes","userId":"3a9317071bd4f8b7e89664d0f9966492","msg":"Login requires MFA verification"}
{"level":30,"time":1768363703188,"env":"test","module":"auth-service","allTokensCount":4918,"sampleToken":"2b484d683e217a5794883c3321285a69f23da26d5e0f749725f993d77b121982","msg":"DEBUG: Tokens in DB"}
{"level":30,"time":1768363703213,"env":"test","module":"auth-routes","userId":"9748d16d9a33ca5c963ac85d7ddd8e9f","msg":"User logged in successfully"}
{"level":30,"time":1768363703269,"env":"test","module":"audit-log-service","userId":"9748d16d9a33ca5c963ac85d7ddd8e9f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363703268,"env":"test","module":"mfa-service","userId":"3a9317071bd4f8b7e89664d0f9966492","msg":"TOTP verification successful"}
{"level":50,"time":1768363703305,"env":"test","module":"auth-routes","email":"test-1768363701909-um4wz6@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363703324,"env":"test","module":"auth-routes","userId":"3a9317071bd4f8b7e89664d0f9966492","msg":"MFA login successful"}
{"level":50,"time":1768363703411,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363703502,"env":"test","module":"auth-routes","userId":"3a9317071bd4f8b7e89664d0f9966492","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363703533,"env":"test","module":"auth-routes","userId":"7e951709471b7c0864d99e8492fad7f0","msg":"User logged in successfully"}
{"level":30,"time":1768363703572,"env":"test","module":"user-credentials-repository","userId":"GGI8MtyE9sKCEQwPRKBG6","msg":"User credentials created"}
{"level":30,"time":1768363703588,"env":"test","module":"audit-log-service","userId":"7e951709471b7c0864d99e8492fad7f0","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould mark current session correctly
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363703638,"env":"test","module":"auth-routes","userId":"14a5c2d755078fcd47a9cda9e3f6bc8a","msg":"User logged in successfully"}
{"level":30,"time":1768363703685,"env":"test","module":"auth-service","tokenHash":"37ddd80c6f58cd35249712c66d112df413614b6a314d143cac17e03efb176cb4","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363703689,"env":"test","module":"audit-log-service","userId":"14a5c2d755078fcd47a9cda9e3f6bc8a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768363703736,"env":"test","module":"auth-service","userId":"GGI8MtyE9sKCEQwPRKBG6","tokenHash":"37ddd80c6f58cd35249712c66d112df413614b6a314d143cac17e03efb176cb4","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363703815,"env":"test","module":"mfa-service","userId":"9748d16d9a33ca5c963ac85d7ddd8e9f","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363703815,"env":"test","module":"mfa-service","userId":"9748d16d9a33ca5c963ac85d7ddd8e9f","msg":"Generated TOTP secret"}
{"level":30,"time":1768363703815,"env":"test","module":"auth-routes","userId":"9748d16d9a33ca5c963ac85d7ddd8e9f","msg":"MFA setup initiated"}
{"level":50,"time":1768363703830,"env":"test","module":"auth-routes","email":"test-1768363701909-um4wz6@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":40,"time":1768363703923,"env":"test","module":"mfa-service","userId":"9748d16d9a33ca5c963ac85d7ddd8e9f","msg":"Invalid TOTP token provided"}
{"level":50,"time":1768363703932,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363704124,"env":"test","module":"auth-routes","userId":"7e951709471b7c0864d99e8492fad7f0","msg":"User logged in successfully"}
{"level":30,"time":1768363704168,"env":"test","module":"user-credentials-repository","userId":"zra0GAPMenLHDdIRFd1d9","msg":"User credentials created"}
{"level":30,"time":1768363704178,"env":"test","module":"audit-log-service","userId":"7e951709471b7c0864d99e8492fad7f0","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363704286,"env":"test","module":"auth-service","tokenHash":"36b29aadd781ff81ab5aab2bb72ecc1a7658ea793af3db1ba3db51302b2a6352","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363704295,"env":"test","module":"auth-routes","userId":"7e951709471b7c0864d99e8492fad7f0","sessionCount":2,"msg":"Listed active sessions"}
{"level":40,"time":1768363704335,"env":"test","module":"auth-service","tokenHash":"36b29aadd781ff81ab5aab2bb72ecc1a7658ea793af3db1ba3db51302b2a6352","msg":"Security: Unknown refresh token used (Not Found in DB)"}
{"level":50,"time":1768363704347,"env":"test","module":"auth-routes","email":"test-1768363701909-um4wz6@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

{"level":50,"time":1768363704452,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363704477,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould update expiry if device already trusted
[22m[39m[TEST UTILS] MFA Secret verified for f21a150726726e1476d6429e010a98ff

{"level":30,"time":1768363704711,"env":"test","module":"auth-service","allTokensCount":4921,"sampleToken":"2b484d683e217a5794883c3321285a69f23da26d5e0f749725f993d77b121982","msg":"DEBUG: Tokens in DB"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return 401 for invalid password
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363704784,"env":"test","module":"email-queue","jobId":"74d4711b-f0ce-48a8-b314-db9a5dc3c43b","to":"newuser_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":50,"time":1768363704885,"env":"test","module":"auth-routes","email":"test-1768363701909-um4wz6@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould update expiry if device already trusted
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363705093,"env":"test","module":"account-lockout","userId":"3fae97427ad4efbe836ee6409c31dc98","email":"test-1768363701909-um4wz6@example.com","lockedUntil":"2026-01-14T04:23:25.041Z","msg":"Account locked due to too many failed attempts"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

{"level":50,"time":1768363705093,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363705104,"env":"test","module":"user-credentials-repository","userId":"Inmo5D0q_d4CFysHVqalL","msg":"User credentials created"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould not allow MFA setup if already enabled
[22m[39m[TEST UTILS] MFA Secret verified for 7079f4779964ca528a41176697b8eb11

{"level":30,"time":1768363705162,"env":"test","module":"auth-service","tokenHash":"e25cd94c541c719832ac7baa7365d95571ff42916ceb957a912b94911c0c722c","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363705202,"env":"test","module":"auth-routes","userId":"3fae97427ad4efbe836ee6409c31dc98","email":"test-1768363701909-um4wz6@example.com","msg":"Login blocked: account locked"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould lock account after 5 failed attempts, then unlock after waiting
[22m[39mLogin Failed DEBUG: AccountLockedError: Account is locked until 2026-01-14T04:23:25.041Z
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:65:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_005'[39m,
  statusCode: [33m423[39m,
  isOperational: [33mtrue[39m,
  lockedUntil: [35m2026-01-14T04:23:25.041Z[39m,
  remainingMinutes: [33m15[39m
}

{"level":50,"time":1768363705202,"env":"test","module":"auth-routes","error":{"name":"AccountLockedError","code":"AUTH_005","statusCode":423,"isOperational":true,"lockedUntil":"2026-01-14T04:23:25.041Z","remainingMinutes":15},"msg":"Login failed"}
{"level":50,"time":1768363705211,"env":"test","module":"auth-routes","email":"test-1768363704323-avqfen@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":50,"time":1768363705313,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return 401 for invalid password
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould exclude revoked sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould not allow MFA setup if already enabled
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363705490,"env":"test","module":"auth-routes","userId":"f21a150726726e1476d6429e010a98ff","msg":"Login requires MFA verification"}
{"level":30,"time":1768363705593,"env":"test","module":"mfa-service","userId":"f21a150726726e1476d6429e010a98ff","msg":"TOTP verification successful"}
{"level":30,"time":1768363705646,"env":"test","module":"auth-routes","userId":"f21a150726726e1476d6429e010a98ff","msg":"MFA login successful"}
{"level":30,"time":1768363705815,"env":"test","module":"auth-routes","userId":"f21a150726726e1476d6429e010a98ff","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363705842,"env":"test","module":"user-credentials-repository","userId":"cRLXnru_aVe2-JjHmoAMK","msg":"User credentials created"}
{"level":30,"time":1768363705904,"env":"test","module":"auth-service","tokenHash":"ffe67c1a28e69eec1e2fbc6356773357bc5080909fa336130893fb5ab9595b7a","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363705905,"env":"test","module":"auth-service","tokenHash":"ffe67c1a28e69eec1e2fbc6356773357bc5080909fa336130893fb5ab9595b7a","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return 401 for non-existent user
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363705954,"env":"test","module":"auth-routes","userId":"da575d71e33690be955a9ef5e7661ce2","msg":"User logged in successfully"}
{"level":30,"time":1768363705962,"env":"test","module":"auth-routes","userId":"7079f4779964ca528a41176697b8eb11","msg":"Login requires MFA verification"}
{"level":50,"time":1768363705985,"env":"test","module":"auth-routes","email":"nonexistent@example.com","msg":"DEBUG: ValidateCredentials - User not found"}
{"level":30,"time":1768363706012,"env":"test","module":"audit-log-service","userId":"da575d71e33690be955a9ef5e7661ce2","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould exclude revoked sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768363706075,"env":"test","module":"auth-routes","userId":"f21a150726726e1476d6429e010a98ff","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Trusted device expiry updated"}
{"level":50,"time":1768363706092,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return 401 for non-existent user
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:58:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

{"level":30,"time":1768363706143,"env":"test","module":"email-queue","jobId":"c99e787f-2320-434f-a6e7-57e497c51912","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":40,"time":1768363706279,"env":"test","module":"auth-service","userId":"cRLXnru_aVe2-JjHmoAMK","tokenHash":"ffe67c1a28e69eec1e2fbc6356773357bc5080909fa336130893fb5ab9595b7a","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould record all login attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w10
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w12
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w6
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w4
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w1
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w10 (Reused: true)

{"level":30,"time":1768363706502,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363706507,"env":"test","module":"user-credentials-repository","userId":"f99bffd5-7942-4009-9702-47d7da43fee9","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w12 (Reused: true)

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w6 (Reused: true)

{"level":30,"time":1768363706521,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363706520,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363706523,"env":"test","module":"auth-routes","userId":"da575d71e33690be955a9ef5e7661ce2","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w4 (Reused: true)

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w1 (Reused: true)

{"level":30,"time":1768363706526,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363706526,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363706549,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363706569,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363706569,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363706572,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363706579,"env":"test","module":"audit-log-service","userId":"da575d71e33690be955a9ef5e7661ce2","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363706604,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363706614,"env":"test","module":"email-queue","jobId":"76489565-4920-4f33-a4a5-196bbbb57c2f","to":"test-1768363706095-4vrqmn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363706670,"env":"test","module":"auth-routes","userId":"f99bffd5-7942-4009-9702-47d7da43fee9","email":"test-1768363706095-4vrqmn@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return 403 for unverified email
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363706693,"env":"test","module":"user-credentials-repository","userId":"uTdO5szmxvLCo-WpP0-oo","msg":"User credentials created"}
{"level":30,"time":1768363706750,"env":"test","module":"auth-service","tokenHash":"9d48a3ebdabbeccfce93c4aec6c72682b740e7f434c0c76fd4498e4a8e2e18aa","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":50,"time":1768363706775,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363706805,"env":"test","module":"auth-routes","userId":"da575d71e33690be955a9ef5e7661ce2","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1768363706827,"env":"test","module":"auth-routes","email":"test-1768363706013-uwklwn@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":50,"time":1768363706930,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould record all login attempts
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould record all login attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould generate unique backup codes
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363707062,"env":"test","module":"auth-routes","userId":"f99bffd5-7942-4009-9702-47d7da43fee9","email":"test-1768363706095-4vrqmn@example.com","msg":"Login blocked: email not verified"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return 403 for unverified email
[22m[39mLogin Failed DEBUG: EmailNotVerifiedError: Please verify your email before logging in. Check your inbox for the verification link.
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:93:11)
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_006'[39m,
  statusCode: [33m403[39m,
  isOperational: [33mtrue[39m
}

{"level":50,"time":1768363707063,"env":"test","module":"auth-routes","error":{"name":"EmailNotVerifiedError","code":"AUTH_006","statusCode":403,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768363707095,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363707105,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363707117,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363707121,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363707126,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363707137,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768363707105,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363707106,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363707111,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363707116,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363707117,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363707117,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363707117,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363707114,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363707115,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363707127,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363707136,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363707136,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363707137,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363707137,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363707150,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768363707155,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363707157,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363707136,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363707136,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363707142,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363707149,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363707149,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363707149,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363707149,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363707131,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363707132,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363707139,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363707155,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363707155,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363707155,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363707155,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363707179,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768363707167,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363707167,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363707173,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363707178,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363707178,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363707178,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363707179,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould list all trusted devices
[22m[39m[TEST UTILS] MFA Secret verified for ba21c5899320703c15f43cd6fb7fa740

{"level":50,"time":1768363707418,"env":"test","module":"auth-routes","email":"test-1768363706013-uwklwn@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363707441,"env":"test","module":"user-credentials-repository","userId":"-1EjGiigqITl07-IIZyDI","msg":"User credentials created"}
{"level":30,"time":1768363707502,"env":"test","module":"auth-service","tokenHash":"a1edc50c15bf0c41256bfd1e2df52ea2dd040c855247818b58f2524959346bc8","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":50,"time":1768363707518,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould record all login attempts
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mAccount Lockout Flow[2m > [22m[2mshould record all login attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould record failed login attempt
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363707559,"env":"test","module":"auth-routes","userId":"ac7b19c9fad42ef17429536f86631b96","msg":"User logged in successfully"}
{"level":30,"time":1768363707611,"env":"test","module":"audit-log-service","userId":"ac7b19c9fad42ef17429536f86631b96","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould list all trusted devices
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363707686,"env":"test","module":"user-credentials-repository","userId":"6ad39354-a251-4da3-9d81-e78d9d23e847","msg":"User credentials created"}
{"level":30,"time":1768363707713,"env":"test","module":"user-credentials-repository","userId":"f699138f-2aa3-4967-91ed-be86ccbad618","msg":"User credentials created"}
{"level":30,"time":1768363707714,"env":"test","module":"user-credentials-repository","userId":"d6391640-1a0f-44f2-adad-8966d7e8f942","msg":"User credentials created"}
{"level":30,"time":1768363707744,"env":"test","module":"user-credentials-repository","userId":"6702110a-6f44-4c5d-8aee-8c9a597d2d93","msg":"User credentials created"}
{"level":30,"time":1768363707747,"env":"test","module":"user-credentials-repository","userId":"ca2150bc-8708-4bf2-8412-370f0d7e3c1b","msg":"User credentials created"}
{"level":30,"time":1768363707795,"env":"test","module":"email-queue","jobId":"0c6221b7-f708-4092-8ad7-6b09865bba46","to":"test-euHItG9Ushytke2btwR8_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363707814,"env":"test","module":"email-queue","jobId":"f6d38811-5be1-4557-bee2-a25f2f0883b8","to":"test-1Wv3YdG7_Ao2FpeLiWIk1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363707815,"env":"test","module":"email-queue","jobId":"f90a5db8-0165-4dcc-b0ef-7c0b92f2cc1d","to":"test-1T_BePHz-LxEGK0zl7kfa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363707851,"env":"test","module":"email-queue","jobId":"85eaf34b-c92a-4739-99da-f5963f02a873","to":"test-frKcplFpQ5eY6fXrmGTxg@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould order sessions by last used (most recent first)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363707856,"env":"test","module":"email-queue","jobId":"5e7f5f43-3b9e-4ecd-91ce-439a9e8ffb9f","to":"test-okfItKdElUtQpQhw2vfuU@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363707856,"env":"test","module":"auth-routes","userId":"6ad39354-a251-4da3-9d81-e78d9d23e847","email":"test-euHItG9Ushytke2btwR8_@example.com","msg":"User registered"}
{"level":30,"time":1768363707873,"env":"test","module":"auth-routes","userId":"d6391640-1a0f-44f2-adad-8966d7e8f942","email":"test-1T_BePHz-LxEGK0zl7kfa@example.com","msg":"User registered"}
{"level":30,"time":1768363707872,"env":"test","module":"auth-routes","userId":"f699138f-2aa3-4967-91ed-be86ccbad618","email":"test-1Wv3YdG7_Ao2FpeLiWIk1@example.com","msg":"User registered"}
{"level":30,"time":1768363707912,"env":"test","module":"auth-routes","userId":"6702110a-6f44-4c5d-8aee-8c9a597d2d93","email":"test-frKcplFpQ5eY6fXrmGTxg@example.com","msg":"User registered"}
{"level":30,"time":1768363707912,"env":"test","module":"auth-routes","userId":"ca2150bc-8708-4bf2-8412-370f0d7e3c1b","email":"test-okfItKdElUtQpQhw2vfuU@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w15
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":50,"time":1768363707960,"env":"test","module":"auth-routes","email":"test-1768363707066-g80e4f@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w15 (Reused: true)

{"level":30,"time":1768363707996,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363708047,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":50,"time":1768363708055,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould record failed login attempt
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

{"level":30,"time":1768363708070,"env":"test","module":"auth-routes","userId":"2948335d6a355f97ef39722c06d71be1","msg":"User logged in successfully"}
{"level":30,"time":1768363708109,"env":"test","module":"user-credentials-repository","userId":"do8MGlno-syk-VWAArB5V","msg":"User credentials created"}
{"level":30,"time":1768363708120,"env":"test","module":"audit-log-service","userId":"2948335d6a355f97ef39722c06d71be1","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363708155,"env":"test","module":"email-queue","jobId":"23bd0759-500d-45b1-9165-bd35bdf5f953","to":"newuser_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363708155,"env":"test","module":"mfa-service","userId":"ac7b19c9fad42ef17429536f86631b96","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363708155,"env":"test","module":"mfa-service","userId":"ac7b19c9fad42ef17429536f86631b96","msg":"Generated TOTP secret"}
{"level":30,"time":1768363708155,"env":"test","module":"auth-routes","userId":"ac7b19c9fad42ef17429536f86631b96","msg":"MFA setup initiated"}
{"level":30,"time":1768363708171,"env":"test","module":"auth-service","tokenHash":"cd36fe5ffb160c6b9507b68f46235e6f97f50e5744874e8bd76ff0e0bf4dff45","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363708199,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"Login requires MFA verification"}
{"level":30,"time":1768363708310,"env":"test","module":"mfa-service","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"TOTP verification successful"}
{"level":30,"time":1768363708361,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"MFA login successful"}
{"level":30,"time":1768363708371,"env":"test","module":"auth-routes","userId":"4400ba809ee643f0f7bd4fa86e030315","msg":"User logged in successfully"}
{"level":30,"time":1768363708426,"env":"test","module":"audit-log-service","userId":"4400ba809ee643f0f7bd4fa86e030315","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363708433,"env":"test","module":"user-credentials-repository","userId":"6bc1924c-03f5-437f-90e8-2651dc390cd5","msg":"User credentials created"}
{"level":30,"time":1768363708526,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould list all trusted devices
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould order sessions by last used (most recent first)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363708547,"env":"test","module":"email-queue","jobId":"8739110b-f83e-4407-99d0-a5b6d8d183d8","to":"session-test-phEGM81JdmhFJs0Dp9BA3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363708550,"env":"test","module":"user-credentials-repository","userId":"405fd0c7-da06-4c4e-9d8d-ff2b58a0bedb","msg":"User credentials created"}
{"level":30,"time":1768363708592,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363708604,"env":"test","module":"auth-routes","userId":"6bc1924c-03f5-437f-90e8-2651dc390cd5","email":"session-test-phEGM81JdmhFJs0Dp9BA3@example.com","msg":"User registered"}
{"level":30,"time":1768363708615,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363708615,"env":"test","module":"user-credentials-repository","userId":"f3026955-7e05-440d-a3e8-2ed3c12fbf6f","msg":"User credentials created"}
{"level":30,"time":1768363708601,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363708602,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363708608,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363708614,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363708614,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363708614,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363708615,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363708624,"env":"test","module":"user-credentials-repository","userId":"c5f8f1b7-0e86-4c1d-a3c8-30faddb072c1","msg":"User credentials created"}
{"level":30,"time":1768363708660,"env":"test","module":"email-queue","jobId":"2bdd1b2e-473c-4974-a6d3-cb4cc0c3a1bd","to":"middleware-test-Rh-OLzvah0BtGVtD5y-kh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mSession Creation and Tracking[2m > [22m[2mshould create refresh token on login
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363708717,"env":"test","module":"auth-routes","userId":"405fd0c7-da06-4c4e-9d8d-ff2b58a0bedb","email":"middleware-test-Rh-OLzvah0BtGVtD5y-kh@example.com","msg":"User registered"}
{"level":30,"time":1768363708725,"env":"test","module":"user-credentials-repository","userId":"kkrZHZbtcW26PlWcCFqIW","msg":"User credentials created"}
{"level":30,"time":1768363708725,"env":"test","module":"email-queue","jobId":"a83b868e-e25a-423a-89a5-5169a0e21b0b","to":"jwt-test-z1K8KxklPawXbVDOggWzK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363708731,"env":"test","module":"email-queue","jobId":"b451331d-4755-4c50-972d-f261a5bd72c1","to":"protected-test-C-drTXfEk9cUpi-kH0Y2a@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mrequireAuth Middleware[2m > [22m[2mshould allow access with valid JWT Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363708779,"env":"test","module":"auth-routes","userId":"f3026955-7e05-440d-a3e8-2ed3c12fbf6f","email":"jwt-test-z1K8KxklPawXbVDOggWzK@example.com","msg":"User registered"}
{"level":30,"time":1768363708786,"env":"test","module":"auth-routes","userId":"c5f8f1b7-0e86-4c1d-a3c8-30faddb072c1","email":"protected-test-C-drTXfEk9cUpi-kH0Y2a@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts[2m > [22m[2mOAuth2 Token Refresh Flow[2m > [22m[2mRefresh Token Lifecycle[2m > [22m[2mshould create refresh token on login
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mJWT Token Generation[2m > [22m[2mshould generate valid JWT token on successful login
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mGET Protected Routes[2m > [22m[2mshould allow access with valid Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363708945,"env":"test","module":"user-credentials-repository","userId":"b4b5f767-ac16-4b3b-9645-66a94db4094d","msg":"User credentials created"}
{"level":30,"time":1768363709023,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"Login requires MFA verification"}
{"level":30,"time":1768363709023,"env":"test","module":"auth-routes","userId":"4400ba809ee643f0f7bd4fa86e030315","msg":"User logged in successfully"}
{"level":30,"time":1768363709038,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjNiYjM1YmZmLWI3MjctNDUyMS04MmNiLWM0NzVhZWYzNGJjNCIsInJvbGUiOiJhZG1pbiIsInRlbmFudFJvbGUiOiJvd25lciIsImlhdCI6MTc2ODM2MzcwOCwiZXhwIjoxNzY4MzY0NjA4fQ.A9dNFJ4Vbdt3r9HOHxb4UIw0U_wKG-Anb81P7X5YcX4",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": null,
    "lastName": null,
    "profileImageUrl": null,
    "tenantId": "3bb35bff-b727-4521-82cb-c475aef34bc4",
    "role": "admin",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1768363709054,"env":"test","module":"email-queue","jobId":"c7123c8f-87c2-4daa-9c90-fc93e04aca54","to":"viewer-YBXSsBZxuOPD-znmZ2Lei@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363709075,"env":"test","module":"audit-log-service","userId":"4400ba809ee643f0f7bd4fa86e030315","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709105,"env":"test","module":"auth-routes","userId":"b4b5f767-ac16-4b3b-9645-66a94db4094d","email":"viewer-YBXSsBZxuOPD-znmZ2Lei@example.com","msg":"User registered"}
{"level":30,"time":1768363709151,"env":"test","module":"mfa-service","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"TOTP verification successful"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould order sessions by last used (most recent first)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363709208,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould store hashed backup codes
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mMFA Enrollment and Login Flow[2m > [22m[2mshould complete MFA setup and login with TOTP
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363709219,"env":"test","module":"rbac-middleware","userId":"b4b5f767-ac16-4b3b-9645-66a94db4094d","userRole":"viewer","permission":"workflow:create","path":"/projects/8a3d958c-4fe3-4c73-aa4b-704a5cb34726/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return requiresMfa=true for MFA-enabled users
[22m[39m[TEST UTILS] MFA Secret verified for 2c919d3da44fd837b54be75a2e535445

{"level":30,"time":1768363709228,"env":"test","module":"auth-routes","userId":"6bc1924c-03f5-437f-90e8-2651dc390cd5","msg":"User logged in successfully"}
{"level":30,"time":1768363709256,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768363709280,"env":"test","module":"audit-log-service","userId":"6bc1924c-03f5-437f-90e8-2651dc390cd5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709299,"env":"test","module":"auth-routes","userId":"405fd0c7-da06-4c4e-9d8d-ff2b58a0bedb","msg":"User logged in successfully"}
{"level":30,"time":1768363709352,"env":"test","module":"audit-log-service","userId":"405fd0c7-da06-4c4e-9d8d-ff2b58a0bedb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709374,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","deviceFingerprint":"091366faa1882b5c8dc1cba02126615a77a378274bbfd3375e821aa38bdd1b4f","msg":"Device marked as trusted"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould list all trusted devices
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363709406,"env":"test","module":"auth-routes","userId":"f3026955-7e05-440d-a3e8-2ed3c12fbf6f","msg":"User logged in successfully"}
{"level":30,"time":1768363709421,"env":"test","module":"auth-routes","userId":"kkrZHZbtcW26PlWcCFqIW","msg":"User logged in successfully"}
{"level":30,"time":1768363709459,"env":"test","module":"audit-log-service","userId":"f3026955-7e05-440d-a3e8-2ed3c12fbf6f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709472,"env":"test","module":"audit-log-service","userId":"kkrZHZbtcW26PlWcCFqIW","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709477,"env":"test","module":"auth-routes","userId":"c5f8f1b7-0e86-4c1d-a3c8-30faddb072c1","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return requiresMfa=true for MFA-enabled users
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363709532,"env":"test","module":"audit-log-service","userId":"c5f8f1b7-0e86-4c1d-a3c8-30faddb072c1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709693,"env":"test","module":"auth-routes","userId":"4400ba809ee643f0f7bd4fa86e030315","msg":"User logged in successfully"}
{"level":30,"time":1768363709718,"env":"test","module":"auth-routes","userId":"1389fefcd8fa0ed0a62882b9676bc576","msg":"User logged in successfully"}
{"level":30,"time":1768363709723,"env":"test","module":"auth-routes","userId":"e9e1ab80201f73e3313379da2588603d","msg":"User logged in successfully"}
{"level":30,"time":1768363709741,"env":"test","module":"user-credentials-repository","userId":"426e3ea7-5006-481d-a2b4-cc6654b831e4","msg":"User credentials created"}
{"level":30,"time":1768363709744,"env":"test","module":"audit-log-service","userId":"4400ba809ee643f0f7bd4fa86e030315","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709777,"env":"test","module":"audit-log-service","userId":"e9e1ab80201f73e3313379da2588603d","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709777,"env":"test","module":"audit-log-service","userId":"1389fefcd8fa0ed0a62882b9676bc576","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363709844,"env":"test","module":"email-queue","jobId":"1857abae-5dde-4219-966f-573adb13d08c","to":"session-test-O8qpQFnu2l0ICUkyORHNI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363709862,"env":"test","module":"auth-routes","userId":"4400ba809ee643f0f7bd4fa86e030315","sessionCount":3,"msg":"Listed active sessions"}
{"level":30,"time":1768363709880,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"Login requires MFA verification"}
{"level":30,"time":1768363709882,"env":"test","module":"user-credentials-repository","userId":"31c699cc-f9c8-4028-8111-50bb060380bc","msg":"User credentials created"}
{"level":30,"time":1768363709887,"env":"test","module":"user-credentials-repository","userId":"ab33d3f5-dec8-4c9c-a11a-2c8eb770e6d7","msg":"User credentials created"}
{"level":30,"time":1768363709892,"env":"test","module":"user-credentials-repository","userId":"vhHfx3jr-57IlAAFWYe_M","msg":"User credentials created"}
{"level":30,"time":1768363709896,"env":"test","module":"auth-routes","userId":"426e3ea7-5006-481d-a2b4-cc6654b831e4","email":"session-test-O8qpQFnu2l0ICUkyORHNI@example.com","msg":"User registered"}
{"level":30,"time":1768363709988,"env":"test","module":"email-queue","jobId":"51cc2a6b-572b-4836-b4d5-9481e2b42e1f","to":"jwt-test-j1vhlrbcNehEyzcOAqtVW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363709999,"env":"test","module":"mfa-service","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"TOTP verification successful"}
{"level":30,"time":1768363710002,"env":"test","module":"email-queue","jobId":"93890b86-1154-4196-b11a-4719cf0d7bee","to":"middleware-test-jvB58TJvw-viYnSOU8ViY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mSession Creation and Tracking[2m > [22m[2mshould track device metadata in session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363710012,"env":"test","module":"user-credentials-repository","userId":"cf6ee3d2-7779-4e5b-8a9b-5f454309e89b","msg":"User credentials created"}
{"level":30,"time":1768363710023,"env":"test","module":"auth-routes","userId":"2c919d3da44fd837b54be75a2e535445","msg":"Login requires MFA verification"}
{"level":30,"time":1768363710048,"env":"test","module":"auth-routes","userId":"31c699cc-f9c8-4028-8111-50bb060380bc","email":"jwt-test-j1vhlrbcNehEyzcOAqtVW@example.com","msg":"User registered"}
{"level":30,"time":1768363710051,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","msg":"MFA login successful"}
{"level":30,"time":1768363710055,"env":"test","module":"auth-routes","userId":"ab33d3f5-dec8-4c9c-a11a-2c8eb770e6d7","email":"middleware-test-jvB58TJvw-viYnSOU8ViY@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mJWT Token Generation[2m > [22m[2mshould include correct payload in JWT token
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mrequireAuth Middleware[2m > [22m[2mshould return 401 when no token provided
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363710114,"env":"test","module":"email-queue","jobId":"98bb3352-6424-4e99-8214-a7d42a235c7a","to":"protected-test-b7pComZ5SVo0AE_94M_tG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363710163,"env":"test","module":"auth-routes","userId":"ba21c5899320703c15f43cd6fb7fa740","deviceCount":2,"msg":"Listed trusted devices"}
{"level":30,"time":1768363710169,"env":"test","module":"auth-routes","userId":"cf6ee3d2-7779-4e5b-8a9b-5f454309e89b","email":"protected-test-b7pComZ5SVo0AE_94M_tG@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mGET Protected Routes[2m > [22m[2mshould reject access without Authorization header
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363710337,"env":"test","module":"mfa-service","userId":"1389fefcd8fa0ed0a62882b9676bc576","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363710337,"env":"test","module":"mfa-service","userId":"1389fefcd8fa0ed0a62882b9676bc576","msg":"Generated TOTP secret"}
{"level":30,"time":1768363710337,"env":"test","module":"auth-routes","userId":"1389fefcd8fa0ed0a62882b9676bc576","msg":"MFA setup initiated"}
{"level":30,"time":1768363710385,"env":"test","module":"mfa-service","userId":"e9e1ab80201f73e3313379da2588603d","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363710385,"env":"test","module":"mfa-service","userId":"e9e1ab80201f73e3313379da2588603d","msg":"Generated TOTP secret"}
{"level":30,"time":1768363710385,"env":"test","module":"auth-routes","userId":"e9e1ab80201f73e3313379da2588603d","msg":"MFA setup initiated"}
{"level":30,"time":1768363710468,"env":"test","module":"email-queue","jobId":"62122d27-da9c-4876-8f39-e2b50026e862","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363710489,"env":"test","module":"user-credentials-repository","userId":"pNcngCK7i_M1J7nUPrx7d","msg":"User credentials created"}
{"level":30,"time":1768363710572,"env":"test","module":"auth-routes","userId":"426e3ea7-5006-481d-a2b4-cc6654b831e4","msg":"User logged in successfully"}
{"level":30,"time":1768363710626,"env":"test","module":"auth-routes","userId":"31c699cc-f9c8-4028-8111-50bb060380bc","msg":"User logged in successfully"}
{"level":30,"time":1768363710632,"env":"test","module":"auth-routes","userId":"ab33d3f5-dec8-4c9c-a11a-2c8eb770e6d7","msg":"User logged in successfully"}
{"level":30,"time":1768363710670,"env":"test","module":"audit-log-service","userId":"426e3ea7-5006-481d-a2b4-cc6654b831e4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363710677,"env":"test","module":"audit-log-service","userId":"31c699cc-f9c8-4028-8111-50bb060380bc","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363710685,"env":"test","module":"audit-log-service","userId":"ab33d3f5-dec8-4c9c-a11a-2c8eb770e6d7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363710692,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363710710,"env":"test","module":"mfa-service","userId":"e9e1ab80201f73e3313379da2588603d","msg":"MFA enabled successfully"}
{"level":30,"time":1768363710710,"env":"test","module":"auth-routes","userId":"e9e1ab80201f73e3313379da2588603d","msg":"MFA enabled successfully"}
{"level":30,"time":1768363710768,"env":"test","module":"audit-log-service","userId":"e9e1ab80201f73e3313379da2588603d","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mMFA Enrollment and Login Flow[2m > [22m[2mshould complete MFA setup and login with TOTP
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363710823,"env":"test","module":"auth-routes","userId":"cf6ee3d2-7779-4e5b-8a9b-5f454309e89b","msg":"User logged in successfully"}
{"level":30,"time":1768363710880,"env":"test","module":"user-credentials-repository","userId":"4ZAknByVZNIZx_0BSVCwx","msg":"User credentials created"}
{"level":30,"time":1768363710880,"env":"test","module":"audit-log-service","userId":"cf6ee3d2-7779-4e5b-8a9b-5f454309e89b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363710886,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363711074,"env":"test","module":"user-credentials-repository","userId":"db947907-f638-4459-b0e9-c5afb88bb855","msg":"User credentials created"}
{"level":30,"time":1768363711085,"env":"test","module":"user-credentials-repository","userId":"795fb1fb-7819-4ce3-ab81-4d9709c27304","msg":"User credentials created"}
{"level":30,"time":1768363711125,"env":"test","module":"user-credentials-repository","userId":"8e2f71c1-1187-41bc-bc64-f631f1907e75","msg":"User credentials created"}
{"level":30,"time":1768363711176,"env":"test","module":"email-queue","jobId":"17f46fc3-4ee0-49ba-8a89-46e28de96aa2","to":"jwt-test-_jcYfYG7Z0GIZiN-KnmcC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363711188,"env":"test","module":"email-queue","jobId":"a00dc2e5-40a3-45fb-897d-df2e730ef2fd","to":"middleware-test-mlq2_XdpimZigcTtNcRt6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363711232,"env":"test","module":"auth-routes","userId":"db947907-f638-4459-b0e9-c5afb88bb855","email":"jwt-test-_jcYfYG7Z0GIZiN-KnmcC@example.com","msg":"User registered"}
{"level":30,"time":1768363711233,"env":"test","module":"email-queue","jobId":"edd5a8e1-d62b-4a5f-ae87-899a9868e0b4","to":"session-test-PVGZQNaa0PUzj5L7aEVm_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363711258,"env":"test","module":"auth-routes","userId":"795fb1fb-7819-4ce3-ab81-4d9709c27304","email":"middleware-test-mlq2_XdpimZigcTtNcRt6@example.com","msg":"User registered"}
{"level":30,"time":1768363711271,"env":"test","module":"auth-routes","userId":"e9e1ab80201f73e3313379da2588603d","msg":"Login requires MFA verification"}
{"level":30,"time":1768363711289,"env":"test","module":"user-credentials-repository","userId":"75369a22-8be7-4bee-ba46-300956086b6a","msg":"User credentials created"}
{"level":30,"time":1768363711290,"env":"test","module":"auth-routes","userId":"8e2f71c1-1187-41bc-bc64-f631f1907e75","email":"session-test-PVGZQNaa0PUzj5L7aEVm_@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mJWT Token Generation[2m > [22m[2mshould set JWT expiry to 15 minutes
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould filter sessions by current user only
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould mark current device
[22m[39m[TEST UTILS] MFA Secret verified for 3ab796c7a9f0188a5eab11fa37ed62df

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mrequireAuth Middleware[2m > [22m[2mshould return 401 with invalid token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363711388,"env":"test","module":"mfa-service","userId":"e9e1ab80201f73e3313379da2588603d","msg":"TOTP verification successful"}
{"level":30,"time":1768363711397,"env":"test","module":"email-queue","jobId":"f7d2013d-6b05-47f4-988c-17a6da17cbfa","to":"protected-test-0f6T1kKO3t5KGnIzoEawy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mSession Creation and Tracking[2m > [22m[2mshould create separate sessions for multiple device logins
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363711412,"env":"test","module":"auth-routes","email":"test-1768363710649-sho9gf@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363711430,"env":"test","module":"user-credentials-repository","userId":"BXUC9Tc1fSQCiihApuhDC","msg":"User credentials created"}
{"level":30,"time":1768363711444,"env":"test","module":"auth-routes","userId":"e9e1ab80201f73e3313379da2588603d","msg":"MFA login successful"}
{"level":30,"time":1768363711452,"env":"test","module":"auth-routes","userId":"75369a22-8be7-4bee-ba46-300956086b6a","email":"protected-test-0f6T1kKO3t5KGnIzoEawy@example.com","msg":"User registered"}
{"level":50,"time":1768363711453,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":50,"time":1768363711524,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould require MFA for enabled users
[22m[39m[TEST UTILS] MFA Secret verified for 99e3be0935613554ddb1b3f7a80d2c19

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mGET Protected Routes[2m > [22m[2mshould reject access with empty Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould mark current device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363711794,"env":"test","module":"auth-routes","userId":"db947907-f638-4459-b0e9-c5afb88bb855","msg":"User logged in successfully"}
{"level":30,"time":1768363711800,"env":"test","module":"auth-routes","userId":"d03104504a47e3f749217bdc1eb72a51","msg":"User logged in successfully"}
{"level":30,"time":1768363711811,"env":"test","module":"auth-routes","userId":"795fb1fb-7819-4ce3-ab81-4d9709c27304","msg":"User logged in successfully"}
{"level":30,"time":1768363711850,"env":"test","module":"audit-log-service","userId":"db947907-f638-4459-b0e9-c5afb88bb855","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould require MFA for enabled users
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363711853,"env":"test","module":"audit-log-service","userId":"d03104504a47e3f749217bdc1eb72a51","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould filter sessions by current user only
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363711865,"env":"test","module":"audit-log-service","userId":"795fb1fb-7819-4ce3-ab81-4d9709c27304","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363711869,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363711907,"env":"test","module":"auth-routes","userId":"8e2f71c1-1187-41bc-bc64-f631f1907e75","msg":"User logged in successfully"}
{"level":50,"time":1768363711921,"env":"test","module":"auth-routes","email":"test-1768363710649-sho9gf@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363711961,"env":"test","module":"audit-log-service","userId":"8e2f71c1-1187-41bc-bc64-f631f1907e75","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mSession Creation and Tracking[2m > [22m[2mshould create separate sessions for multiple device logins
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363712022,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363712039,"env":"test","module":"user-credentials-repository","userId":"urhFftEEy9GjJ7qDmXMnB","msg":"User credentials created"}
{"level":30,"time":1768363712076,"env":"test","module":"auth-routes","userId":"3ab796c7a9f0188a5eab11fa37ed62df","msg":"Login requires MFA verification"}
{"level":30,"time":1768363712107,"env":"test","module":"auth-routes","userId":"75369a22-8be7-4bee-ba46-300956086b6a","msg":"User logged in successfully"}
{"level":30,"time":1768363712158,"env":"test","module":"audit-log-service","userId":"75369a22-8be7-4bee-ba46-300956086b6a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363712162,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363712181,"env":"test","module":"mfa-service","userId":"3ab796c7a9f0188a5eab11fa37ed62df","msg":"TOTP verification successful"}
{"level":30,"time":1768363712235,"env":"test","module":"auth-routes","userId":"3ab796c7a9f0188a5eab11fa37ed62df","msg":"MFA login successful"}
{"level":30,"time":1768363712257,"env":"test","module":"user-credentials-repository","userId":"04850841-8bd5-4d33-90fd-ea24546b1d2f","msg":"User credentials created"}
{"level":30,"time":1768363712278,"env":"test","module":"user-credentials-repository","userId":"7953785d-0795-441f-bccc-c0252c00843b","msg":"User credentials created"}
{"level":30,"time":1768363712286,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363712287,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/services/WorkflowTemplateService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 16446[2mms[22m[39m
       [33m[2mâœ“[22m[39m should throw error if template belongs to different project [33m 612[2mms[22m[39m
       [33m[2mâœ“[22m[39m should automatically unset other primaries when setting new primary [33m 1081[2mms[22m[39m
         [33m[2mâœ“[22m[39m should list all templates for workflow version [33m 827[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return empty array for version with no templates [33m 556[2mms[22m[39m
         [33m[2mâœ“[22m[39m should get template mapping by id and version [33m 688[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error if mapping not found [33m 529[2mms[22m[39m
         [33m[2mâœ“[22m[39m should get template by key [33m 688[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error if key not found [33m 529[2mms[22m[39m
         [33m[2mâœ“[22m[39m should get primary template for workflow version [33m 801[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return null when no primary template exists [33m 664[2mms[22m[39m
         [33m[2mâœ“[22m[39m should update mapping key [33m 743[2mms[22m[39m
         [33m[2mâœ“[22m[39m should update isPrimary flag [33m 801[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error if new key already exists [33m 803[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error if mapping not found [33m 527[2mms[22m[39m
         [33m[2mâœ“[22m[39m should unset other primaries when setting isPrimary to true [33m 1062[2mms[22m[39m
         [33m[2mâœ“[22m[39m should detach template from workflow version [33m 767[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error if mapping not found [33m 522[2mms[22m[39m
         [33m[2mâœ“[22m[39m should set template as primary [33m 1000[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error if mapping not found [33m 528[2mms[22m[39m
         [33m[2mâœ“[22m[39m should support operations within a transaction [33m 802[2mms[22m[39m
         [33m[2mâœ“[22m[39m should rollback on transaction error [33m 798[2mms[22m[39m
{"level":30,"time":1768363712327,"env":"test","module":"email-queue","jobId":"7c3edf23-09ef-4ad9-befe-6d9e53362a53","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363712354,"env":"test","module":"auth-routes","userId":"99e3be0935613554ddb1b3f7a80d2c19","msg":"Login requires MFA verification"}
{"level":30,"time":1768363712361,"env":"test","module":"auth-routes","userId":"d03104504a47e3f749217bdc1eb72a51","msg":"User logged in successfully"}
{"level":30,"time":1768363712362,"env":"test","module":"email-queue","jobId":"90a97c45-4f5f-47f7-ae04-50a00f427939","to":"jwt-test-FisLbwPJnxTC7qROXepIq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363712380,"env":"test","module":"email-queue","jobId":"5a45499f-b4a9-4283-9fce-be30f744ef7b","to":"middleware-test-U7bMgCybOoNWqxWxLuufS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363712392,"env":"test","module":"auth-routes","userId":"3ab796c7a9f0188a5eab11fa37ed62df","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363712411,"env":"test","module":"audit-log-service","userId":"d03104504a47e3f749217bdc1eb72a51","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363712412,"env":"test","module":"auth-routes","email":"test-1768363710649-sho9gf@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363712418,"env":"test","module":"auth-routes","userId":"04850841-8bd5-4d33-90fd-ea24546b1d2f","email":"jwt-test-FisLbwPJnxTC7qROXepIq@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould filter sessions by current user only
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363712435,"env":"test","module":"auth-routes","userId":"7953785d-0795-441f-bccc-c0252c00843b","email":"middleware-test-U7bMgCybOoNWqxWxLuufS@example.com","msg":"User registered"}
{"level":30,"time":1768363712467,"env":"test","module":"auth-routes","userId":"8e2f71c1-1187-41bc-bc64-f631f1907e75","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mJWT Token Validation[2m > [22m[2mshould accept valid JWT token on protected routes
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mrequireAuth Middleware[2m > [22m[2mshould return 401 with expired token
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mMFA Enrollment and Login Flow[2m > [22m[2mshould login with backup code when TOTP unavailable
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363712503,"env":"test","module":"auth-routes","userId":"3ab796c7a9f0188a5eab11fa37ed62df","deviceCount":1,"msg":"Listed trusted devices"}
{"level":30,"time":1768363712517,"env":"test","module":"audit-log-service","userId":"8e2f71c1-1187-41bc-bc64-f631f1907e75","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363712517,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mSession Creation and Tracking[2m > [22m[2mshould create separate sessions for multiple device logins
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363712587,"env":"test","module":"user-credentials-repository","userId":"719f9453-0eb4-4609-ad1e-bad5f7fe0dab","msg":"User credentials created"}
{"level":30,"time":1768363712691,"env":"test","module":"email-queue","jobId":"747fbfb5-bc0a-4b1b-8a60-c1d93539622c","to":"protected-test-iwaAGU6BrJge2WsT-Ztzn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768363712745,"env":"test","module":"auth-routes","userId":"719f9453-0eb4-4609-ad1e-bad5f7fe0dab","email":"protected-test-iwaAGU6BrJge2WsT-Ztzn@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mGET Protected Routes[2m > [22m[2mshould reject access with malformed Authorization header
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363712908,"env":"test","module":"auth-routes","email":"test-1768363710649-sho9gf@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363712909,"env":"test","module":"auth-routes","userId":"f53f20ba1bfb6ebfb11b9087982d743e","msg":"User logged in successfully"}
{"level":30,"time":1768363712962,"env":"test","module":"audit-log-service","userId":"f53f20ba1bfb6ebfb11b9087982d743e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363712968,"env":"test","module":"auth-routes","userId":"04850841-8bd5-4d33-90fd-ea24546b1d2f","msg":"User logged in successfully"}
{"level":30,"time":1768363712986,"env":"test","module":"auth-routes","userId":"7953785d-0795-441f-bccc-c0252c00843b","msg":"User logged in successfully"}
{"level":30,"time":1768363712987,"env":"test","module":"auth-routes","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"User logged in successfully"}
{"level":50,"time":1768363713017,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768363713019,"env":"test","module":"auth-routes","userId":"8e2f71c1-1187-41bc-bc64-f631f1907e75","msg":"User logged in successfully"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

{"level":30,"time":1768363713019,"env":"test","module":"audit-log-service","userId":"04850841-8bd5-4d33-90fd-ea24546b1d2f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363713036,"env":"test","module":"audit-log-service","userId":"7953785d-0795-441f-bccc-c0252c00843b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363713042,"env":"test","module":"audit-log-service","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363713070,"env":"test","module":"auth-routes","userId":"d03104504a47e3f749217bdc1eb72a51","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768363713077,"env":"test","module":"audit-log-service","userId":"8e2f71c1-1187-41bc-bc64-f631f1907e75","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363713133,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363713137,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363713157,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363713158,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/transferOwnership.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 16777[2mms[22m[39m
       [33m[2mâœ“[22m[39m should transfer user-owned project to org [33m 1982[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent transfer to org if user is not a member [33m 1407[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow org member to transfer org-owned project to another org they belong to [33m 1815[2mms[22m[39m
       [33m[2mâœ“[22m[39m should detach workflow from project when transferring to different owner [33m 1485[2mms[22m[39m
       [33m[2mâœ“[22m[39m should keep workflow in project when transferring to same owner [33m 1507[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent non-member from transferring org workflow [33m 1426[2mms[22m[39m
       [33m[2mâœ“[22m[39m should transfer database ownership [33m 1126[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow org member to transfer org database [33m 1205[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent transfer to org if user is not a member [33m 1448[2mms[22m[39m
       [33m[2mâœ“[22m[39m should only allow transfer to self when targetOwnerType is user [33m 996[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow transfer from user to self (org member transferring org asset to themselves) [33m 1250[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363713388,"env":"test","module":"auth-routes","userId":"719f9453-0eb4-4609-ad1e-bad5f7fe0dab","msg":"User logged in successfully"}
{"level":50,"time":1768363713434,"env":"test","module":"auth-routes","email":"test-1768363710649-sho9gf@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363713444,"env":"test","module":"audit-log-service","userId":"719f9453-0eb4-4609-ad1e-bad5f7fe0dab","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363713449,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould complete MFA login with valid TOTP
[22m[39m[TEST UTILS] MFA Secret verified for f45d2be4d7990d05b00179c54d92af29

{"level":30,"time":1768363713546,"env":"test","module":"user-credentials-repository","userId":"540f39eb-9867-4aa4-8e88-09f7ed6ab48e","msg":"User credentials created"}
{"level":30,"time":1768363713548,"env":"test","module":"user-credentials-repository","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","msg":"User credentials created"}
{"level":30,"time":1768363713565,"env":"test","module":"mfa-service","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363713566,"env":"test","module":"mfa-service","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"Generated TOTP secret"}
{"level":30,"time":1768363713566,"env":"test","module":"auth-routes","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"MFA setup initiated"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude revoked devices
[22m[39m[TEST UTILS] MFA Secret verified for 90eb8c3f1657b867b2c905b2049b092a

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1768363713646,"env":"test","module":"account-lockout","userId":"12fb09e76ed5b7a3e6365fb30af605dd","email":"test-1768363710649-sho9gf@example.com","lockedUntil":"2026-01-14T04:23:33.595Z","msg":"Account locked due to too many failed attempts"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

{"level":50,"time":1768363713646,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363713656,"env":"test","module":"email-queue","jobId":"eb5ef519-3614-439b-acdc-5f867bbb1065","to":"jwt-test-IfTL2PX-WugmOtlD5oMqr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363713661,"env":"test","module":"email-queue","jobId":"e894f865-ef97-4c9e-b2c6-abd5687f044a","to":"session-test-9pQWN3w3Czjs-ruojevQb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w16
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363713713,"env":"test","module":"auth-routes","userId":"540f39eb-9867-4aa4-8e88-09f7ed6ab48e","email":"jwt-test-IfTL2PX-WugmOtlD5oMqr@example.com","msg":"User registered"}
{"level":30,"time":1768363713718,"env":"test","module":"auth-routes","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","email":"session-test-9pQWN3w3Czjs-ruojevQb@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w16 (Reused: true)

{"level":30,"time":1768363713746,"env":"test","msg":"DB: initializing... Local"}
{"level":40,"time":1768363713758,"env":"test","module":"auth-routes","userId":"12fb09e76ed5b7a3e6365fb30af605dd","email":"test-1768363710649-sho9gf@example.com","msg":"Login blocked: account locked"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould lock account after 5 failed attempts
[22m[39mLogin Failed DEBUG: AccountLockedError: Account is locked until 2026-01-14T04:23:33.595Z
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:65:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_005'[39m,
  statusCode: [33m423[39m,
  isOperational: [33mtrue[39m,
  lockedUntil: [35m2026-01-14T04:23:33.595Z[39m,
  remainingMinutes: [33m15[39m
}

{"level":50,"time":1768363713758,"env":"test","module":"auth-routes","error":{"name":"AccountLockedError","code":"AUTH_005","statusCode":423,"isOperational":true,"lockedUntil":"2026-01-14T04:23:33.595Z","remainingMinutes":15},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mJWT Token Validation[2m > [22m[2mshould accept request with missing Bearer prefix (lenient)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363713781,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould complete MFA login with valid TOTP
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould list all active sessions for user
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363713874,"env":"test","module":"user-credentials-repository","userId":"31ac20df-012a-4b1b-95ec-b590daf39035","msg":"User credentials created"}
{"level":30,"time":1768363713885,"env":"test","module":"mfa-service","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"MFA enabled successfully"}
{"level":30,"time":1768363713885,"env":"test","module":"auth-routes","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"MFA enabled successfully"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude revoked devices
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363713940,"env":"test","module":"audit-log-service","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mMFA Enrollment and Login Flow[2m > [22m[2mshould login with backup code when TOTP unavailable
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363713984,"env":"test","module":"email-queue","jobId":"5fa6dea5-f4b2-4574-b57f-dbf24df6513d","to":"protected-test-iGQAcJ3-qKwvA_WKgiHNh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363714041,"env":"test","module":"auth-routes","userId":"31ac20df-012a-4b1b-95ec-b590daf39035","email":"protected-test-iGQAcJ3-qKwvA_WKgiHNh@example.com","msg":"User registered"}
{"level":40,"time":1768363714141,"env":"test","module":"auth-middleware","error":{"name":"TokenExpiredError","code":"AUTH_002","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363714141,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mGET Protected Routes[2m > [22m[2mshould reject access with wrong token type
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 7a7f8eea-b98f-4662-8748-ef3b7b3252d5 tenantId: 3bb35bff-b727-4521-82cb-c475aef34bc4 userId: google-user-id

{"level":30,"time":1768363714254,"env":"test","module":"auth-routes","userId":"540f39eb-9867-4aa4-8e88-09f7ed6ab48e","msg":"User logged in successfully"}
{"level":30,"time":1768363714282,"env":"test","module":"auth-routes","userId":"f45d2be4d7990d05b00179c54d92af29","msg":"Login requires MFA verification"}
{"level":30,"time":1768363714313,"env":"test","module":"audit-log-service","userId":"540f39eb-9867-4aa4-8e88-09f7ed6ab48e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363714318,"env":"test","module":"auth-routes","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","msg":"User logged in successfully"}
{"level":50,"time":1768363714344,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363714374,"env":"test","module":"audit-log-service","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould list all active sessions for user
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363714385,"env":"test","module":"mfa-service","userId":"f45d2be4d7990d05b00179c54d92af29","msg":"TOTP verification successful"}
{"level":30,"time":1768363714390,"env":"test","module":"auth-routes","userId":"90eb8c3f1657b867b2c905b2049b092a","msg":"Login requires MFA verification"}
{"level":40,"time":1768363714421,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363714421,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363714440,"env":"test","module":"auth-routes","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"Login requires MFA verification"}
{"level":30,"time":1768363714440,"env":"test","module":"auth-routes","userId":"f45d2be4d7990d05b00179c54d92af29","msg":"MFA login successful"}
{"level":30,"time":1768363714446,"env":"test","module":"email-queue","jobId":"35efb162-53e0-48f1-9eee-2a922ade9625","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363714497,"env":"test","module":"mfa-service","userId":"90eb8c3f1657b867b2c905b2049b092a","msg":"TOTP verification successful"}
{"level":30,"time":1768363714533,"env":"test","module":"user-credentials-repository","userId":"21575915-3c53-4bc5-8e3d-9d3bf060d8aa","msg":"User credentials created"}
{"level":30,"time":1768363714553,"env":"test","module":"auth-routes","userId":"90eb8c3f1657b867b2c905b2049b092a","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 331e5dc5-c61d-46de-9fc4-9642e500f582 tenantId: 3bb35bff-b727-4521-82cb-c475aef34bc4 userId: google-user-id

{"level":30,"time":1768363714639,"env":"test","module":"email-queue","jobId":"8dc5dddb-3246-4af6-a8d9-03ce24070977","to":"middleware-test-a_DpSpNYN9IHE5KZpaPJ3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w17
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363714659,"env":"test","module":"mfa-service","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"Backup code verified and consumed"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w17 (Reused: true)

{"level":30,"time":1768363714693,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363714694,"env":"test","module":"auth-routes","userId":"31ac20df-012a-4b1b-95ec-b590daf39035","msg":"User logged in successfully"}
{"level":30,"time":1768363714694,"env":"test","module":"auth-routes","userId":"21575915-3c53-4bc5-8e3d-9d3bf060d8aa","email":"middleware-test-a_DpSpNYN9IHE5KZpaPJ3@example.com","msg":"User registered"}
{"level":30,"time":1768363714709,"env":"test","module":"auth-routes","userId":"90eb8c3f1657b867b2c905b2049b092a","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363714710,"env":"test","module":"auth-routes","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mMFA Enrollment and Login Flow[2m > [22m[2mshould login with backup code when TOTP unavailable
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould revoke specific session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363714725,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363714750,"env":"test","module":"audit-log-service","userId":"31ac20df-012a-4b1b-95ec-b590daf39035","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/logout[2m > [22m[2mshould logout and clear refresh token cookie
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould authenticate with JWT Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363714754,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363714755,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 9006b7d0-a343-41cc-93d2-67c91faade17 tenantId: 3bb35bff-b727-4521-82cb-c475aef34bc4 userId: google-user-id

{"level":30,"time":1768363714861,"env":"test","module":"auth-routes","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","msg":"User logged in successfully"}
{"level":30,"time":1768363714864,"env":"test","module":"auth-routes","userId":"90eb8c3f1657b867b2c905b2049b092a","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1768363714920,"env":"test","module":"audit-log-service","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould list all active sessions for user
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363715179,"env":"test","module":"user-credentials-repository","userId":"a9c16998-3b2f-46b2-9946-f04e19b42dcb","msg":"User credentials created"}
{"level":30,"time":1768363715233,"env":"test","module":"auth-routes","userId":"07fef351de7963d34c2285e56e1bff65","msg":"User logged in successfully"}
{"level":30,"time":1768363715234,"env":"test","module":"auth-routes","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"Login requires MFA verification"}
{"level":30,"time":1768363715262,"env":"test","module":"auth-routes","userId":"aad7701df7ebccc878865d860173e1b8","msg":"User logged in successfully"}
{"level":30,"time":1768363715268,"env":"test","module":"auth-routes","userId":"21575915-3c53-4bc5-8e3d-9d3bf060d8aa","msg":"User logged in successfully"}
{"level":30,"time":1768363715275,"env":"test","module":"email-queue","jobId":"0b00cdaf-4bfa-41e9-b0d4-aa7c608ebb8e","to":"protected-test-1HSemACEGCa3bDAHjo9GU@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363715284,"env":"test","module":"audit-log-service","userId":"07fef351de7963d34c2285e56e1bff65","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould revoke specific session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363715316,"env":"test","module":"audit-log-service","userId":"aad7701df7ebccc878865d860173e1b8","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363715323,"env":"test","module":"audit-log-service","userId":"21575915-3c53-4bc5-8e3d-9d3bf060d8aa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363715330,"env":"test","module":"auth-routes","userId":"a9c16998-3b2f-46b2-9946-f04e19b42dcb","email":"protected-test-1HSemACEGCa3bDAHjo9GU@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 2f27f97f-058b-4665-a033-670d47a14cee tenantId: 3bb35bff-b727-4521-82cb-c475aef34bc4 userId: google-user-id

{"level":30,"time":1768363715407,"env":"test","module":"auth-routes","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mPOST Protected Routes[2m > [22m[2mshould allow POST with valid Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363715456,"env":"test","module":"audit-log-service","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768363715528,"env":"test","module":"auth-middleware","error":{"name":"TokenExpiredError","code":"AUTH_002","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363715528,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould reject invalid TOTP during login
[22m[39m[TEST UTILS] MFA Secret verified for 9cd3f8e3531e9942d932f28c63f60b93

{"level":30,"time":1768363715565,"env":"test","module":"auth-routes","userId":"192440a9-303b-445d-93fe-74dfd5fc84e5","sessionCount":3,"msg":"Listed active sessions"}
{"level":30,"time":1768363715780,"env":"test","module":"auth-routes","userId":"07fef351de7963d34c2285e56e1bff65","msg":"User logged in successfully"}
{"level":30,"time":1768363715835,"env":"test","module":"user-credentials-repository","userId":"36356b31-1a9e-4af6-a663-ef0d0c4f5edd","msg":"User credentials created"}
{"level":30,"time":1768363715836,"env":"test","module":"audit-log-service","userId":"07fef351de7963d34c2285e56e1bff65","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould reject invalid TOTP during login
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363715852,"env":"test","module":"mfa-service","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"Invalid backup code provided"}
{"level":40,"time":1768363715853,"env":"test","module":"auth-routes","userId":"6a92220bcbc5e4cbb4031d5c7c38d382","msg":"MFA verification failed during login"}
{"level":30,"time":1768363715900,"env":"test","workflowId":"9e9b1b74-938c-4585-838e-27b8c912470a","userId":"f699138f-2aa3-4967-91ed-be86ccbad618","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363715935,"env":"test","module":"email-queue","jobId":"2f0964b1-0b2a-4009-b2c1-2fa196c59e1d","to":"middleware-test-mliQBPHLg6ZkHrmOtkgPG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363715949,"env":"test","module":"auth-routes","userId":"07fef351de7963d34c2285e56e1bff65","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768363715964,"env":"test","module":"user-credentials-repository","userId":"36395057-1f4e-4c60-97d3-8012599ce3a8","msg":"User credentials created"}
{"level":30,"time":1768363715980,"env":"test","module":"auth-routes","userId":"a9c16998-3b2f-46b2-9946-f04e19b42dcb","msg":"User logged in successfully"}
{"level":30,"time":1768363715983,"env":"test","module":"auth-routes","userId":"36356b31-1a9e-4af6-a663-ef0d0c4f5edd","email":"middleware-test-mliQBPHLg6ZkHrmOtkgPG@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude expired devices
[22m[39m[TEST UTILS] MFA Secret verified for b9beaf5e354df9c08125706f11350968

{"level":30,"time":1768363716036,"env":"test","module":"audit-log-service","userId":"a9c16998-3b2f-46b2-9946-f04e19b42dcb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould authenticate with refresh token cookie (GET only)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363716073,"env":"test","module":"email-queue","jobId":"e1ee0e93-802d-4e9a-926d-d584486444dd","to":"session-test-25lsYKFyaRd4tc3ys8FZH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363716109,"env":"test","module":"auth-routes","userId":"07fef351de7963d34c2285e56e1bff65","sessionId":"53ed1d22-80e8-4f1a-aebf-92e25d7d94ed","msg":"Session revoked"}
{"level":30,"time":1768363716126,"env":"test","module":"auth-routes","userId":"36395057-1f4e-4c60-97d3-8012599ce3a8","email":"session-test-25lsYKFyaRd4tc3ys8FZH@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 2525d369-65cb-44a9-bab7-8a2b50ca5bad tenantId: 3bb35bff-b727-4521-82cb-c475aef34bc4 userId: google-user-id

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould mark current session correctly
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363716268,"env":"test","module":"auth-routes","userId":"07fef351de7963d34c2285e56e1bff65","sessionCount":1,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude expired devices
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363716338,"env":"test","module":"auth-routes","userId":"9cd3f8e3531e9942d932f28c63f60b93","msg":"Login requires MFA verification"}
{"level":50,"time":1768363716338,"env":"test","error":{},"msg":"Error deleting row note"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/refresh-token[2m > [22m[2mshould refresh access token with valid refresh token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363716444,"env":"test","module":"mfa-service","userId":"9cd3f8e3531e9942d932f28c63f60b93","msg":"TOTP verification failed"}
{"level":40,"time":1768363716444,"env":"test","module":"auth-routes","userId":"9cd3f8e3531e9942d932f28c63f60b93","msg":"MFA verification failed during login"}
{"level":30,"time":1768363716493,"env":"test","module":"user-credentials-repository","userId":"4b21e23b-9028-4054-9cb8-d8ed208faaa1","msg":"User credentials created"}
{"level":30,"time":1768363716535,"env":"test","module":"auth-routes","userId":"36356b31-1a9e-4af6-a663-ef0d0c4f5edd","msg":"User logged in successfully"}
{"level":30,"time":1768363716586,"env":"test","module":"audit-log-service","userId":"36356b31-1a9e-4af6-a663-ef0d0c4f5edd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363716593,"env":"test","module":"email-queue","jobId":"cc664724-22f9-4083-bc5f-3f78f8918014","to":"protected-test-OZ6HN_hw47aLzA3i-Bb_J@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768363716635,"env":"test","module":"auth-middleware","error":{"name":"TokenExpiredError","code":"AUTH_002","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363716636,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363716648,"env":"test","module":"auth-routes","userId":"4b21e23b-9028-4054-9cb8-d8ed208faaa1","email":"protected-test-OZ6HN_hw47aLzA3i-Bb_J@example.com","msg":"User registered"}
{"level":30,"time":1768363716728,"env":"test","module":"auth-routes","userId":"36395057-1f4e-4c60-97d3-8012599ce3a8","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mPOST Protected Routes[2m > [22m[2mshould reject POST without Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363716779,"env":"test","module":"audit-log-service","userId":"36395057-1f4e-4c60-97d3-8012599ce3a8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould mark current session correctly
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363716784,"env":"test","module":"auth-routes","userId":"b9beaf5e354df9c08125706f11350968","msg":"Login requires MFA verification"}
{"level":30,"time":1768363716878,"env":"test","module":"auth-routes","userId":"0121c82b4ef19c3cff3c4be120601670","msg":"User logged in successfully"}
{"level":30,"time":1768363716902,"env":"test","module":"mfa-service","userId":"b9beaf5e354df9c08125706f11350968","msg":"TOTP verification successful"}
{"level":30,"time":1768363716936,"env":"test","module":"audit-log-service","userId":"0121c82b4ef19c3cff3c4be120601670","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363716941,"env":"test","module":"auth-service","tokenHash":"68b89f00a9ef97d08a9a9196c1c6e249846321c5ba4613b04cc2be665994b340","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363716951,"env":"test","module":"auth-routes","userId":"b9beaf5e354df9c08125706f11350968","msg":"MFA login successful"}
{"level":30,"time":1768363717103,"env":"test","module":"email-queue","jobId":"37574634-f997-4f32-8f7a-b77dd58228dc","to":"test-1768363716490-6xh1fe@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363717103,"env":"test","module":"auth-service","email":"test-1768363716490-6xh1fe@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768363717107,"env":"test","workflowId":"42768c85-052d-4b51-b2e0-a9cb4791dbe7","userId":"f699138f-2aa3-4967-91ed-be86ccbad618","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363717109,"env":"test","module":"auth-routes","userId":"b9beaf5e354df9c08125706f11350968","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363717170,"env":"test","module":"user-credentials-repository","userId":"94f073c8-fb49-4d9c-a1a9-4d05496ab87e","msg":"User credentials created"}
{"level":30,"time":1768363717272,"env":"test","module":"auth-routes","userId":"b9beaf5e354df9c08125706f11350968","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1768363717273,"env":"test","module":"email-queue","jobId":"87aa11cc-dbb0-4658-9a0a-0b20b32814b7","to":"middleware-test-I6SheE6a3b98WYT6CXvFm@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould prevent revoking current session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363717278,"env":"test","module":"auth-routes","userId":"36395057-1f4e-4c60-97d3-8012599ce3a8","msg":"User logged in successfully"}
{"level":30,"time":1768363717291,"env":"test","module":"auth-routes","userId":"4b21e23b-9028-4054-9cb8-d8ed208faaa1","msg":"User logged in successfully"}
{"level":30,"time":1768363717310,"env":"test","module":"email-queue","jobId":"e3b44b3f-bbb6-4ad2-8216-8e4f8bb4d4f7","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363717327,"env":"test","module":"auth-routes","userId":"94f073c8-fb49-4d9c-a1a9-4d05496ab87e","email":"middleware-test-I6SheE6a3b98WYT6CXvFm@example.com","msg":"User registered"}
{"level":30,"time":1768363717328,"env":"test","module":"audit-log-service","userId":"36395057-1f4e-4c60-97d3-8012599ce3a8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363717343,"env":"test","module":"audit-log-service","userId":"4b21e23b-9028-4054-9cb8-d8ed208faaa1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363717357,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould reject cookie auth for POST requests (mutation-strict)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363717418,"env":"test","module":"email-queue","jobId":"45814d14-aa7e-4efd-9eb2-3f9b31ae520d","to":"test-1768363716490-6xh1fe@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363717418,"env":"test","module":"auth-service","email":"test-1768363716490-6xh1fe@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768363717496,"env":"test","module":"auth-routes","userId":"36395057-1f4e-4c60-97d3-8012599ce3a8","sessionCount":2,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould accept TOTP codes within 60-second window
[22m[39m[TEST UTILS] MFA Secret verified for 6d67682fef2f38cbadfd96346d0dd34f

{"level":30,"time":1768363717688,"env":"test","module":"user-credentials-repository","userId":"798ecdb0-6db2-45a5-a5e2-0987018430cb","msg":"User credentials created"}
{"level":50,"time":1768363717772,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363717775,"env":"test","module":"auth-routes","userId":"5384683ebb247668a92b24f33f1da58a","msg":"User logged in successfully"}
{"level":30,"time":1768363717793,"env":"test","module":"email-queue","jobId":"b52575a8-d212-41b7-a752-c094f7e6d5b6","to":"jwt-test-xd-GH6r6rqgrAqPg0JFKh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768363717797,"env":"test","error":{},"workflowId":"e8a82b4a-450e-4fbf-a9e5-6e717168e541","userId":"f699138f-2aa3-4967-91ed-be86ccbad618","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":30,"time":1768363717807,"env":"test","module":"user-credentials-repository","userId":"a5c1695e-6a67-40a7-842a-551f47de3fd4","msg":"User credentials created"}
{"level":30,"time":1768363717814,"env":"test","module":"user-credentials-repository","userId":"KmHGahr3IkdsdzQQdAg-N","msg":"User credentials created"}
{"level":30,"time":1768363717822,"env":"test","module":"user-credentials-repository","userId":"9acb7774ac8b4509cf3f55ede7180c98","msg":"User password updated"}
{"level":30,"time":1768363717829,"env":"test","module":"audit-log-service","userId":"5384683ebb247668a92b24f33f1da58a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould accept TOTP codes within 60-second window
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363717844,"env":"test","module":"auth-routes","userId":"798ecdb0-6db2-45a5-a5e2-0987018430cb","email":"jwt-test-xd-GH6r6rqgrAqPg0JFKh@example.com","msg":"User registered"}
{"level":30,"time":1768363717894,"env":"test","module":"auth-routes","userId":"94f073c8-fb49-4d9c-a1a9-4d05496ab87e","msg":"User logged in successfully"}
{"level":30,"time":1768363717907,"env":"test","module":"user-credentials-repository","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","msg":"User credentials created"}
{"level":30,"time":1768363717913,"env":"test","module":"email-queue","jobId":"2deb5edb-eeed-4a7b-8430-ae85c39c6f65","to":"protected-test--MJ3v9As3KmwyM4BFEXfC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363717934,"env":"test","module":"auth-routes","userId":"5384683ebb247668a92b24f33f1da58a","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363717941,"env":"test","module":"audit-log-service","userId":"94f073c8-fb49-4d9c-a1a9-4d05496ab87e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363717945,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363717969,"env":"test","module":"auth-routes","userId":"a5c1695e-6a67-40a7-842a-551f47de3fd4","email":"protected-test--MJ3v9As3KmwyM4BFEXfC@example.com","msg":"User registered"}
{"level":30,"time":1768363717971,"env":"test","module":"audit-log-service","userId":"9acb7774ac8b4509cf3f55ede7180c98","eventType":"password_reset","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mPassword Reset Flow[2m > [22m[2mshould complete full password reset flow
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363718005,"env":"test","module":"email-queue","jobId":"30759d72-e287-4b70-a2dc-28be60653236","to":"session-test-6evKpKAE-JtiGdsVpoP_D@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768363718010,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363718056,"env":"test","module":"auth-routes","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","email":"session-test-6evKpKAE-JtiGdsVpoP_D@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mPOST Protected Routes[2m > [22m[2mshould reject POST with invalid token
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould not include revoked sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/refresh-token[2m > [22m[2mshould rotate refresh token after use
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363718282,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363718304,"env":"test","module":"user-credentials-repository","userId":"pCgBydcLctE-2y2xfignY","msg":"User credentials created"}
{"level":30,"time":1768363718310,"env":"test","module":"auth-routes","userId":"6d67682fef2f38cbadfd96346d0dd34f","msg":"Login requires MFA verification"}
{"level":30,"time":1768363718335,"env":"test","module":"user-credentials-repository","userId":"0853e6a6-f705-49de-8e78-f8c722d655c6","msg":"User credentials created"}
{"level":30,"time":1768363718359,"env":"test","module":"auth-service","tokenHash":"bf08878c478a092e357b124e34d36cd1e454effc7836161103906f71c9491fe7","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":50,"time":1768363718361,"env":"test","module":"auth-routes","email":"test-1768363716490-6xh1fe@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould revoke specific device
[22m[39m[TEST UTILS] MFA Secret verified for 4a3c25689812cce846b06ab9658ccdaf

{"level":30,"time":1768363718411,"env":"test","module":"user-credentials-repository","userId":"74876f62-52f5-4cbe-81f3-c96593e50658","msg":"User credentials created"}
{"level":30,"time":1768363718416,"env":"test","module":"mfa-service","userId":"6d67682fef2f38cbadfd96346d0dd34f","msg":"TOTP verification successful"}
{"level":30,"time":1768363718433,"env":"test","module":"email-queue","jobId":"faab6c0d-1548-4f42-8bc0-e48218fdab1b","to":"middleware-test-WQZhLi2Anurn2XZXME3dU@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768363718466,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768363718467,"env":"test","module":"auth-routes","userId":"6d67682fef2f38cbadfd96346d0dd34f","msg":"MFA login successful"}
[90mstderr[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mPassword Reset Flow[2m > [22m[2mshould complete full password reset flow
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould accept TOTP codes within 60-second window
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mPassword Reset Flow[2m > [22m[2mshould complete full password reset flow
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363718490,"env":"test","module":"auth-routes","userId":"0853e6a6-f705-49de-8e78-f8c722d655c6","email":"middleware-test-WQZhLi2Anurn2XZXME3dU@example.com","msg":"User registered"}
{"level":30,"time":1768363718524,"env":"test","module":"email-queue","jobId":"b98600c0-18e8-4a9f-9fed-e7830e7a31d9","to":"user1-VAFBI4nypYJzyA8yYI9TE@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould reject cookie auth for PUT requests
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363718565,"env":"test","module":"auth-service","tokenHash":"bf08878c478a092e357b124e34d36cd1e454effc7836161103906f71c9491fe7","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363718579,"env":"test","module":"auth-routes","userId":"74876f62-52f5-4cbe-81f3-c96593e50658","email":"user1-VAFBI4nypYJzyA8yYI9TE@example.com","msg":"User registered"}
{"level":30,"time":1768363718604,"env":"test","module":"auth-routes","userId":"a5c1695e-6a67-40a7-842a-551f47de3fd4","msg":"User logged in successfully"}
{"level":40,"time":1768363718617,"env":"test","module":"auth-service","userId":"pCgBydcLctE-2y2xfignY","tokenHash":"bf08878c478a092e357b124e34d36cd1e454effc7836161103906f71c9491fe7","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363718650,"env":"test","module":"auth-routes","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","msg":"User logged in successfully"}
{"level":30,"time":1768363718656,"env":"test","module":"audit-log-service","userId":"a5c1695e-6a67-40a7-842a-551f47de3fd4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363718659,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363718661,"env":"test","module":"auth-routes","userId":"691d47a41855a8a1ce5d2736dc93974e","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould revoke specific device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363718703,"env":"test","module":"audit-log-service","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould not include revoked sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363718713,"env":"test","module":"audit-log-service","userId":"691d47a41855a8a1ce5d2736dc93974e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363718717,"env":"test","module":"auth-service","tokenHash":"3a6548a8fb9a14b4280f099d42cded0179a5e33aae591c733faa4bc2b5476428","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363718930,"env":"test","module":"auth-service","tokenHash":"3a6548a8fb9a14b4280f099d42cded0179a5e33aae591c733faa4bc2b5476428","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363718981,"env":"test","module":"auth-service","userId":"691d47a41855a8a1ce5d2736dc93974e","tokenHash":"3a6548a8fb9a14b4280f099d42cded0179a5e33aae591c733faa4bc2b5476428","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363718988,"env":"test","module":"auth-routes","userId":"6d67682fef2f38cbadfd96346d0dd34f","msg":"Login requires MFA verification"}
{"level":30,"time":1768363718988,"env":"test","module":"auth-routes","userId":"9acb7774ac8b4509cf3f55ede7180c98","msg":"User logged in successfully"}
{"level":30,"time":1768363718994,"env":"test","module":"user-credentials-repository","userId":"41c3775a-725f-4425-9f0c-5e8a8d47fbc9","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'5095ce2b-905a-4119-8eb2-b61e3d3e98c8'[39m,
  tableId: [32m'569ca64e-8d89-493c-9a7b-0ef2051352c8'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2026-01-14T04:08:39.090Z'[39m
}

{"level":30,"time":1768363719028,"env":"test","module":"user-credentials-repository","userId":"SH4CZqi7MAVMSHqR-zjZr","msg":"User credentials created"}
{"level":30,"time":1768363719041,"env":"test","module":"auth-routes","userId":"0853e6a6-f705-49de-8e78-f8c722d655c6","msg":"User logged in successfully"}
{"level":30,"time":1768363719043,"env":"test","module":"audit-log-service","userId":"9acb7774ac8b4509cf3f55ede7180c98","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363719049,"env":"test","module":"email-queue","jobId":"ab302c75-cda9-492e-a5f7-9b387b1dec35","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363719067,"env":"test","module":"user-credentials-repository","userId":"2885f9ce-b037-437d-85d8-a484ca36cd24","msg":"User credentials created"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould return 404 for non-existent session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363719092,"env":"test","module":"mfa-service","userId":"6d67682fef2f38cbadfd96346d0dd34f","msg":"TOTP verification successful"}
{"level":30,"time":1768363719091,"env":"test","module":"audit-log-service","userId":"0853e6a6-f705-49de-8e78-f8c722d655c6","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363719097,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363719099,"env":"test","module":"email-queue","jobId":"4abe1b3d-acf0-45fe-9080-0ce3ac09485c","to":"user2-LgiXonpu_7lLW6MmrRR_H@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363719144,"env":"test","module":"auth-routes","userId":"6d67682fef2f38cbadfd96346d0dd34f","msg":"MFA login successful"}
{"level":30,"time":1768363719149,"env":"test","module":"user-credentials-repository","userId":"636dc74c-f5aa-4119-ae8a-643ed5daf47c","msg":"User credentials created"}
{"level":30,"time":1768363719152,"env":"test","module":"auth-routes","userId":"41c3775a-725f-4425-9f0c-5e8a8d47fbc9","email":"user2-LgiXonpu_7lLW6MmrRR_H@example.com","msg":"User registered"}
{"level":30,"time":1768363719162,"env":"test","module":"auth-routes","userId":"4a3c25689812cce846b06ab9658ccdaf","msg":"Login requires MFA verification"}
{"level":30,"time":1768363719169,"env":"test","module":"email-queue","jobId":"fdde2315-7f07-4890-9e9f-1934cd92fa66","to":"protected-test-2oS0iZP2bTdYkXgKe9wJ1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363719185,"env":"test","module":"auth-routes","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","msg":"User logged in successfully"}
{"level":30,"time":1768363719227,"env":"test","module":"auth-routes","userId":"2885f9ce-b037-437d-85d8-a484ca36cd24","email":"protected-test-2oS0iZP2bTdYkXgKe9wJ1@example.com","msg":"User registered"}
{"level":30,"time":1768363719240,"env":"test","module":"audit-log-service","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363719260,"env":"test","module":"email-queue","jobId":"eb463bd1-e57f-4eaa-bcc8-e9ffcbba779c","to":"test-workflows-JxEex0hgXef00EaJH8eMm@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363719269,"env":"test","module":"mfa-service","userId":"4a3c25689812cce846b06ab9658ccdaf","msg":"TOTP verification successful"}
{"level":30,"time":1768363719315,"env":"test","module":"auth-routes","userId":"636dc74c-f5aa-4119-ae8a-643ed5daf47c","email":"test-workflows-JxEex0hgXef00EaJH8eMm@example.com","msg":"User registered"}
{"level":30,"time":1768363719326,"env":"test","module":"auth-routes","userId":"4a3c25689812cce846b06ab9658ccdaf","msg":"MFA login successful"}
{"level":30,"time":1768363719343,"env":"test","module":"auth-routes","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","sessionCount":2,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mPUT Protected Routes[2m > [22m[2mshould allow PUT with valid Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363719487,"env":"test","module":"auth-routes","userId":"4a3c25689812cce846b06ab9658ccdaf","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363719500,"env":"test","module":"auth-routes","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","sessionId":"b4636529-d326-4f1d-a324-575d709e099f","msg":"Session revoked"}
{"level":50,"time":1768363719518,"env":"test","error":{},"workflowId":"2c503dac-1ec4-4773-9cc1-f54c0f70ba2f","userId":"636dc74c-f5aa-4119-ae8a-643ed5daf47c","projectId":"7dd59a0f-c498-4125-95c4-c80df2461ea8","msg":"Error moving workflow"}
{"level":30,"time":1768363719529,"env":"test","module":"user-credentials-repository","userId":"5a22092e-484f-4157-a9c4-38c43864b72b","msg":"User credentials created"}
{"level":30,"time":1768363719551,"env":"test","module":"user-credentials-repository","userId":"XbBJWhj5l2I1O_AACs3X0","msg":"User credentials created"}
{"level":30,"time":1768363719591,"env":"test","module":"auth-routes","userId":"4a3c25689812cce846b06ab9658ccdaf","deviceCount":1,"msg":"Listed trusted devices"}
{"level":30,"time":1768363719593,"env":"test","module":"auth-routes","userId":"feae3f88d116d0e0bda847e0ca45fb0a","msg":"User logged in successfully"}
{"level":30,"time":1768363719604,"env":"test","module":"auth-routes","userId":"cc99a1fe-e800-41fe-9ef7-893bf254fd2a","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363719608,"env":"test","module":"auth-service","tokenHash":"749cc38285e8597d819c7311b8916d7cd3e15af77b17e8e1d976416ae5fe8c04","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363719629,"env":"test","module":"email-queue","jobId":"0dee2388-f46d-4713-a9a1-f4dfbb6c29fa","to":"middleware-test-qg8J0hrhnBLuBn9HQwMNl@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363719645,"env":"test","module":"audit-log-service","userId":"feae3f88d116d0e0bda847e0ca45fb0a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363719656,"env":"test","module":"user-credentials-repository","userId":"13748ed7-36bd-47cf-a240-e137386d4c9f","msg":"User credentials created"}
{"level":30,"time":1768363719682,"env":"test","module":"auth-routes","userId":"5a22092e-484f-4157-a9c4-38c43864b72b","email":"middleware-test-qg8J0hrhnBLuBn9HQwMNl@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould reject cookie auth for DELETE requests
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363719754,"env":"test","module":"auth-routes","userId":"4a3c25689812cce846b06ab9658ccdaf","deviceId":"2a2ab71e-f7ab-4957-8db3-b8c3db462fec","msg":"Trusted device revoked"}
{"level":30,"time":1768363719763,"env":"test","module":"email-queue","jobId":"98d2c62f-1f70-4374-a8fd-1b42a87edb98","to":"jwt-test-HOWlD5ZcEfXc5vD4jxvLs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363719819,"env":"test","module":"auth-routes","userId":"13748ed7-36bd-47cf-a240-e137386d4c9f","email":"jwt-test-HOWlD5ZcEfXc5vD4jxvLs@example.com","msg":"User registered"}
{"level":50,"time":1768363719822,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363719879,"env":"test","module":"auth-routes","userId":"2885f9ce-b037-437d-85d8-a484ca36cd24","msg":"User logged in successfully"}
{"level":30,"time":1768363719912,"env":"test","module":"auth-routes","userId":"4a3c25689812cce846b06ab9658ccdaf","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1768363719930,"env":"test","module":"audit-log-service","userId":"2885f9ce-b037-437d-85d8-a484ca36cd24","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363719954,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":30,"time":1768363719988,"env":"test","module":"user-credentials-repository","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mPassword Reset Flow[2m > [22m[2mshould invalidate all sessions after password reset
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363720040,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"66f45810-9f0f-4d04-8652-1112816fd2d4","userId":"f699138f-2aa3-4967-91ed-be86ccbad618","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":30,"time":1768363720095,"env":"test","module":"email-queue","jobId":"d4301ca2-5161-4187-9fd7-6d49df3130cb","to":"session-test-zu4mKwxe0hi_1Y3svx8IN@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363720149,"env":"test","module":"auth-routes","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","email":"session-test-zu4mKwxe0hi_1Y3svx8IN@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould login with valid backup code
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363720161,"env":"test","module":"user-credentials-repository","userId":"atxkYa7IGXb6FrmY2el9z","msg":"User credentials created"}
{"level":30,"time":1768363720214,"env":"test","module":"user-credentials-repository","userId":"56e6393b-d0c8-497b-8deb-51a2651fc5b8","msg":"User credentials created"}
{"level":30,"time":1768363720217,"env":"test","module":"auth-service","tokenHash":"8191d39650850574e58c9f7f0095bfcabb1bb83996834ff4c166b530bc852a77","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363720218,"env":"test","module":"auth-routes","userId":"5a22092e-484f-4157-a9c4-38c43864b72b","msg":"User logged in successfully"}
{"level":30,"time":1768363720238,"env":"test","module":"email-queue","jobId":"ba01481f-361f-4243-a16f-2345b467bcc2","to":"test-1768363719637-bswfjc@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363720239,"env":"test","module":"auth-service","email":"test-1768363719637-bswfjc@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould order sessions by last used (most recent first)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363720267,"env":"test","module":"audit-log-service","userId":"5a22092e-484f-4157-a9c4-38c43864b72b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363720275,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363720318,"env":"test","module":"email-queue","jobId":"5d501993-2dcd-4375-bf2d-144df9c83f27","to":"jwt-test-Gn1K9aVGIgZiHXWBdjyQ6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363720371,"env":"test","module":"auth-routes","userId":"56e6393b-d0c8-497b-8deb-51a2651fc5b8","email":"jwt-test-Gn1K9aVGIgZiHXWBdjyQ6@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mHybrid Authentication Strategy[2m > [22m[2mshould allow GET requests with cookie auth only
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363720490,"env":"test","module":"user-credentials-repository","userId":"95b1da74-ba02-4108-a069-b82350f1dbc4","msg":"User credentials created"}
{"level":30,"time":1768363720510,"env":"test","module":"auth-routes","userId":"6821188d2a343297e89562058303eac4","msg":"User logged in successfully"}
{"level":30,"time":1768363720565,"env":"test","module":"audit-log-service","userId":"6821188d2a343297e89562058303eac4","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363720572,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"f3ccce6f-3692-470c-a233-ea0baecfccfe","userId":"f699138f-2aa3-4967-91ed-be86ccbad618","msg":"Error moving workflow"}
{"level":30,"time":1768363720595,"env":"test","module":"email-queue","jobId":"ce07e172-bbac-44e7-a160-2869c07cdb3e","to":"protected-test-2zFGJsgVMo4k2YX3OQEOf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363720646,"env":"test","module":"auth-routes","userId":"43e9741d71bfb2d65f0c46eaab2e558f","msg":"User logged in successfully"}
{"level":30,"time":1768363720650,"env":"test","module":"auth-routes","userId":"95b1da74-ba02-4108-a069-b82350f1dbc4","email":"protected-test-2zFGJsgVMo4k2YX3OQEOf@example.com","msg":"User registered"}
{"level":30,"time":1768363720666,"env":"test","module":"user-credentials-repository","userId":"8116fc20-9cdf-4576-8d3d-0f3e9c1701c6","msg":"User credentials created"}
{"level":30,"time":1768363720700,"env":"test","module":"audit-log-service","userId":"43e9741d71bfb2d65f0c46eaab2e558f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363720734,"env":"test","module":"auth-routes","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","msg":"User logged in successfully"}
{"level":30,"time":1768363720762,"env":"test","module":"user-credentials-repository","userId":"IlQIePbhiEkzmEfO8ga_l","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mPUT Protected Routes[2m > [22m[2mshould reject PUT without Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363720774,"env":"test","module":"email-queue","jobId":"0250d6a8-03be-4b25-848b-1e854bd233da","to":"middleware-test-RhMyV6m0iDMI9VeIeXHNa@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363720781,"env":"test","module":"email-queue","jobId":"7d51d9a3-27fc-4597-8757-b926c054c37a","to":"test-1768363719653-w4waet@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363720781,"env":"test","module":"auth-service","email":"test-1768363719653-w4waet@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768363720788,"env":"test","module":"audit-log-service","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363720816,"env":"test","module":"auth-service","tokenHash":"dcc5deb36656436963f03863fa5c6b3c3f0ee3ad804b589475cc3d331e3eb7d7","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363720840,"env":"test","module":"email-queue","jobId":"ab7e4d17-4a51-4543-81b9-2018237efaee","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363720844,"env":"test","module":"auth-routes","userId":"8116fc20-9cdf-4576-8d3d-0f3e9c1701c6","email":"middleware-test-RhMyV6m0iDMI9VeIeXHNa@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould order sessions by last used (most recent first)
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould allow cookie auth for HEAD requests
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363720940,"env":"test","module":"auth-routes","userId":"56e6393b-d0c8-497b-8deb-51a2651fc5b8","msg":"User logged in successfully"}
{"level":30,"time":1768363720994,"env":"test","module":"audit-log-service","userId":"56e6393b-d0c8-497b-8deb-51a2651fc5b8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould return 404 for non-existent device
[22m[39m[TEST UTILS] MFA Secret verified for e48a0673958ac2af71a2b553bc0e7e40

[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould prevent revoking other user's session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363721189,"env":"test","module":"user-credentials-repository","userId":"6821188d2a343297e89562058303eac4","msg":"User password updated"}
{"level":30,"time":1768363721286,"env":"test","module":"mfa-service","userId":"43e9741d71bfb2d65f0c46eaab2e558f","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363721286,"env":"test","module":"mfa-service","userId":"43e9741d71bfb2d65f0c46eaab2e558f","msg":"Generated TOTP secret"}
{"level":30,"time":1768363721286,"env":"test","module":"auth-routes","userId":"43e9741d71bfb2d65f0c46eaab2e558f","msg":"MFA setup initiated"}
{"level":30,"time":1768363721340,"env":"test","module":"auth-routes","userId":"95b1da74-ba02-4108-a069-b82350f1dbc4","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould return 404 for non-existent device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363721353,"env":"test","module":"audit-log-service","userId":"6821188d2a343297e89562058303eac4","eventType":"password_reset","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363721396,"env":"test","module":"audit-log-service","userId":"95b1da74-ba02-4108-a069-b82350f1dbc4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363721401,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363721411,"env":"test","module":"user-credentials-repository","userId":"mSMb36CjOu_KFdaz9soaq","msg":"User credentials created"}
{"level":30,"time":1768363721471,"env":"test","module":"auth-routes","userId":"8116fc20-9cdf-4576-8d3d-0f3e9c1701c6","msg":"User logged in successfully"}
{"level":30,"time":1768363721473,"env":"test","module":"auth-routes","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","msg":"User logged in successfully"}
{"level":30,"time":1768363721474,"env":"test","module":"auth-service","tokenHash":"9437e956ac1dad67c7cafab0f8e3498e915c6522824525e47aaff151f39451ad","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363721498,"env":"test","module":"user-credentials-repository","userId":"e59a8ad8-9689-420c-87a0-0aacc1998ae5","msg":"User credentials created"}
{"level":30,"time":1768363721515,"env":"test","module":"email-queue","jobId":"b9fcecaf-ce5d-48ff-a1f9-f188cd2cd657","to":"test-1768363720899-w4kvvl@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363721515,"env":"test","module":"auth-service","email":"test-1768363720899-w4kvvl@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768363721524,"env":"test","module":"audit-log-service","userId":"8116fc20-9cdf-4576-8d3d-0f3e9c1701c6","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363721525,"env":"test","module":"audit-log-service","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363721564,"env":"test","module":"user-credentials-repository","userId":"5287f5c7-efd2-4f7d-a67f-dca501f08076","msg":"User credentials created"}
{"level":30,"time":1768363721611,"env":"test","module":"mfa-service","userId":"43e9741d71bfb2d65f0c46eaab2e558f","msg":"MFA enabled successfully"}
{"level":30,"time":1768363721610,"env":"test","module":"email-queue","jobId":"f6dc344d-ac48-431e-a27f-57ec21b7852c","to":"test-workflows-k9KEhvhdg4HiJ7QvfiRy3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363721611,"env":"test","module":"auth-routes","userId":"43e9741d71bfb2d65f0c46eaab2e558f","msg":"MFA enabled successfully"}
{"level":30,"time":1768363721618,"env":"test","module":"auth-routes","userId":"7e1a255af338a80382c7a222d531687c","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mGET /api/auth/sessions[2m > [22m[2mshould order sessions by last used (most recent first)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363721629,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
{"level":30,"time":1768363721661,"env":"test","module":"auth-routes","userId":"e59a8ad8-9689-420c-87a0-0aacc1998ae5","email":"test-workflows-k9KEhvhdg4HiJ7QvfiRy3@example.com","msg":"User registered"}
{"level":30,"time":1768363721662,"env":"test","module":"audit-log-service","userId":"43e9741d71bfb2d65f0c46eaab2e558f","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363721668,"env":"test","module":"email-queue","jobId":"e820447b-66a8-4b34-9a36-dd4ca4ad8495","to":"jwt-test-fUo1VfUrWM0xRLoKFuCz4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363721668,"env":"test","module":"audit-log-service","userId":"7e1a255af338a80382c7a222d531687c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould login with valid backup code
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould prevent revoking other user's session
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363721721,"env":"test","module":"auth-routes","userId":"5287f5c7-efd2-4f7d-a67f-dca501f08076","email":"jwt-test-fUo1VfUrWM0xRLoKFuCz4@example.com","msg":"User registered"}
{"level":50,"time":1768363721724,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363721796,"env":"test","module":"user-credentials-repository","userId":"6f65a3f4-b3e2-4ba5-bf1a-2f782d28dba5","msg":"User credentials created"}
{"level":30,"time":1768363721846,"env":"test","module":"auth-routes","userId":"e48a0673958ac2af71a2b553bc0e7e40","msg":"Login requires MFA verification"}
{"level":30,"time":1768363721889,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363721889,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363721901,"env":"test","module":"email-queue","jobId":"ddb9c0a9-9fdb-403c-80ca-c21a90bd012e","to":"protected-test-3ENkP720atII4CRxJd-yT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363721907,"env":"test","module":"user-credentials-repository","userId":"abd82eef021660db74ddadf34cd3b0ad","msg":"User password updated"}
{"level":30,"time":1768363721952,"env":"test","module":"mfa-service","userId":"e48a0673958ac2af71a2b553bc0e7e40","msg":"TOTP verification successful"}
{"level":30,"time":1768363721952,"env":"test","module":"auth-routes","userId":"6f65a3f4-b3e2-4ba5-bf1a-2f782d28dba5","email":"protected-test-3ENkP720atII4CRxJd-yT@example.com","msg":"User registered"}
 [32mâœ“[39m tests/integration/auth/oauth2.token-refresh.test.ts [2m([22m[2m25 tests[22m[2m)[22m[33m 23661[2mms[22m[39m
       [33m[2mâœ“[22m[39m should refresh access token with valid refresh token [33m 713[2mms[22m[39m
       [33m[2mâœ“[22m[39m should rotate refresh token after use [33m 737[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 when refresh token is missing [33m 467[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 for invalid refresh token [33m 991[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 for expired refresh token [33m 933[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 for revoked refresh token [33m 594[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 when user is not found [33m 916[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update refresh token metadata on rotation [33m 726[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle concurrent refresh token requests (token reuse detection) [33m 897[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set secure cookie in production [33m 625[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set proper cookie attributes [33m 755[2mms[22m[39m
       [33m[2mâœ“[22m[39m should include user role information in response [33m 673[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create refresh token on login [33m 1136[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke refresh token on logout [33m 530[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle logout without refresh token gracefully [33m 491[2mms[22m[39m
       [33m[2mâœ“[22m[39m should support multiple active refresh tokens per user [33m 547[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke all user tokens on password reset [33m 610[2mms[22m[39m
       [33m[2mâœ“[22m[39m should use cryptographically strong random tokens [33m 5736[2mms[22m[39m
       [33m[2mâœ“[22m[39m should hash refresh tokens before storing in database [33m 531[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent refresh token reuse after rotation [33m 701[2mms[22m[39m
       [33m[2mâœ“[22m[39m should validate token ownership [33m 514[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set HttpOnly flag to prevent XSS [33m 640[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set SameSite=Strict to prevent CSRF [33m 598[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set proper cookie path [33m 596[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set appropriate expiry (30 days) [33m 664[2mms[22m[39m
{"level":30,"time":1768363722008,"env":"test","module":"auth-routes","userId":"e48a0673958ac2af71a2b553bc0e7e40","msg":"MFA login successful"}
{"level":30,"time":1768363722062,"env":"test","module":"audit-log-service","userId":"abd82eef021660db74ddadf34cd3b0ad","eventType":"password_reset","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mDELETE Protected Routes[2m > [22m[2mshould allow DELETE with valid Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/reset-password[2m > [22m[2mshould reset password with valid token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363722074,"env":"test","module":"user-credentials-repository","userId":"b1c2fca3-fa47-4e80-a2a6-52b7f588f70f","msg":"User credentials created"}
{"level":30,"time":1768363722126,"env":"test","module":"auth-routes","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","msg":"User logged in successfully"}
{"level":30,"time":1768363722160,"env":"test","module":"auth-routes","userId":"43e9741d71bfb2d65f0c46eaab2e558f","msg":"Login requires MFA verification"}
{"level":30,"time":1768363722179,"env":"test","module":"auth-routes","userId":"185c218ac1bc1db85188d5af2d167517","msg":"User logged in successfully"}
{"level":30,"time":1768363722180,"env":"test","module":"audit-log-service","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363722181,"env":"test","module":"email-queue","jobId":"d894ebbe-383b-4d6f-a81c-34ef9a010fa2","to":"middleware-test-zwrYGfGrC_PxzzCPPbUR6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363722237,"env":"test","module":"auth-routes","userId":"b1c2fca3-fa47-4e80-a2a6-52b7f588f70f","email":"middleware-test-zwrYGfGrC_PxzzCPPbUR6@example.com","msg":"User registered"}
{"level":30,"time":1768363722237,"env":"test","module":"audit-log-service","userId":"185c218ac1bc1db85188d5af2d167517","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363722277,"env":"test","module":"auth-routes","userId":"e59a8ad8-9689-420c-87a0-0aacc1998ae5","msg":"User logged in successfully"}
{"level":30,"time":1768363722284,"env":"test","module":"auth-routes","userId":"eb159163-b9b0-4e10-a6e7-a2a80a479763","sessionCount":3,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould prioritize JWT over cookie when both present
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363722331,"env":"test","module":"audit-log-service","userId":"e59a8ad8-9689-420c-87a0-0aacc1998ae5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363722339,"env":"test","module":"auth-routes","userId":"7e1a255af338a80382c7a222d531687c","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1768363722373,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":30,"time":1768363722374,"env":"test","module":"mfa-service","userId":"43e9741d71bfb2d65f0c46eaab2e558f","msg":"Backup code verified and consumed"}
{"level":30,"time":1768363722423,"env":"test","module":"auth-routes","userId":"43e9741d71bfb2d65f0c46eaab2e558f","msg":"MFA login successful"}
{"level":30,"time":1768363722568,"env":"test","module":"auth-routes","userId":"abd82eef021660db74ddadf34cd3b0ad","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mToken Refresh Flow[2m > [22m[2mshould rotate refresh token on each use
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363722607,"env":"test","module":"auth-routes","userId":"6f65a3f4-b3e2-4ba5-bf1a-2f782d28dba5","msg":"User logged in successfully"}
{"level":30,"time":1768363722626,"env":"test","module":"audit-log-service","userId":"abd82eef021660db74ddadf34cd3b0ad","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/reset-password[2m > [22m[2mshould reset password with valid token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363722649,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363722650,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363722661,"env":"test","module":"audit-log-service","userId":"6f65a3f4-b3e2-4ba5-bf1a-2f782d28dba5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363722682,"env":"test","module":"user-credentials-repository","userId":"5b28387d-da14-4974-b2ab-ab88ec59a7fc","msg":"User credentials created"}
{"level":50,"time":1768363722723,"env":"test","error":{},"workflowId":"27944472-4365-4549-b0af-661cb58f38e1","userId":"f699138f-2aa3-4967-91ed-be86ccbad618","projectId":"74f5660d-c840-409e-bc43-1b8879dde47e","msg":"Error moving workflow"}
{"level":30,"time":1768363722786,"env":"test","module":"email-queue","jobId":"d2dd42af-3d12-4f63-95e3-edc97313cc08","to":"session-test-Xq0dpdM5TNx1nGeqS2vGF@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363722786,"env":"test","module":"auth-routes","userId":"b1c2fca3-fa47-4e80-a2a6-52b7f588f70f","msg":"User logged in successfully"}
{"level":30,"time":1768363722838,"env":"test","module":"audit-log-service","userId":"b1c2fca3-fa47-4e80-a2a6-52b7f588f70f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363722842,"env":"test","module":"auth-routes","userId":"5b28387d-da14-4974-b2ab-ab88ec59a7fc","email":"session-test-Xq0dpdM5TNx1nGeqS2vGF@example.com","msg":"User registered"}
 [32mâœ“[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 15109[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a select column with options [33m 494[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a multiselect column with options [33m 514[2mms[22m[39m
       [33m[2mâœ“[22m[39m should validate select value against options [33m 1243[2mms[22m[39m
       [33m[2mâœ“[22m[39m should validate multiselect values as array [33m 884[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create an autonumber column with sequence [33m 469[2mms[22m[39m
       [33m[2mâœ“[22m[39m should format autonumber with prefix [33m 949[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a note for a row [33m 443[2mms[22m[39m
       [33m[2mâœ“[22m[39m should get all notes for a row [33m 755[2mms[22m[39m
       [33m[2mâœ“[22m[39m should delete a note [33m 731[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not allow deleting notes by other users [33m 652[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create an API token [33m 367[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke (delete) an API token [33m 596[2mms[22m[39m
       [33m[2mâœ“[22m[39m should grant table permission [33m 377[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list table permissions [33m 329[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update table permission role [33m 519[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke table permission [33m 637[2mms[22m[39m
       [33m[2mâœ“[22m[39m should enforce RBAC - only owners can manage permissions [33m 317[2mms[22m[39m
       [33m[2mâœ“[22m[39m should paginate rows efficiently [33m 1407[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return user-friendly error for missing required fields [33m 745[2mms[22m[39m
{"level":50,"time":1768363722957,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363723008,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363723009,"env":"test","msg":"DB: pool closed."}
{"level":50,"time":1768363723030,"env":"test","module":"auth-routes","email":"test-1768363720899-w4kvvl@example.com","msg":"DEBUG: ValidateCredentials - Password mismatch"}
{"level":30,"time":1768363723049,"env":"test","module":"email-queue","jobId":"87bb3b35-d234-436a-bb66-4b432efb8d30","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363723079,"env":"test","module":"auth-routes","userId":"8a65a69c24c373dafb4578e8a6bb3c83","msg":"User logged in successfully"}
{"level":30,"time":1768363723089,"env":"test","module":"user-credentials-repository","userId":"e43f8f8c-bac9-4b6b-90b1-478a6ed8de19","msg":"User credentials created"}
{"level":30,"time":1768363723135,"env":"test","module":"audit-log-service","userId":"8a65a69c24c373dafb4578e8a6bb3c83","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363723139,"env":"test","module":"auth-service","tokenHash":"de3ad4a64fb2faf3d28447ef9367c0f561a17642543b9ccfe5c3217a163602d7","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":50,"time":1768363723141,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstderr[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/reset-password[2m > [22m[2mshould reset password with valid token
[22m[39mLogin Failed DEBUG: InvalidCredentialsError: Invalid credentials
    at validateCredentials (C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:87:11)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/server/routes/auth.routes.ts:309:20 {
  code: [32m'AUTH_004'[39m,
  statusCode: [33m401[39m,
  isOperational: [33mtrue[39m
}

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould prevent revoking other user's device
[22m[39m[TEST UTILS] MFA Secret verified for 4ad5845bc681a53fb8e636e97452296c

{"level":30,"time":1768363723201,"env":"test","module":"email-queue","jobId":"eceb5db6-6a3a-4508-a93c-1217beee99db","to":"jwt-test-ZyuO8VNBonjzd_4EVRvB6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363723248,"env":"test","module":"user-credentials-repository","userId":"acc638d6-ed21-47c3-8ef6-1b1ca95604f0","msg":"User credentials created"}
{"level":30,"time":1768363723254,"env":"test","module":"auth-routes","userId":"e43f8f8c-bac9-4b6b-90b1-478a6ed8de19","email":"jwt-test-ZyuO8VNBonjzd_4EVRvB6@example.com","msg":"User registered"}
{"level":30,"time":1768363723258,"env":"test","module":"user-credentials-repository","userId":"bd80dde2-3842-460c-82b8-c9e4b6eac526","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests[2m > [22m[2mshould generate basic autonumber without prefix
[22m[39mRow 1 Basic Autonumber: 0001
Row 2 Basic Autonumber: 0002

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mToken Refresh Flow[2m > [22m[2mshould refresh access token using refresh token
[22m[39mDEBUG: LOGIN HANDLER HIT

 [32mâœ“[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 16950[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a new draft workflow [33m 385[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject without permission [33m 679[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list workflows [33m 519[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter by status [33m 533[2mms[22m[39m
       [33m[2mâœ“[22m[39m should search by name [33m 904[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update draft workflow [33m 712[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not allow editing published workflow [33m 831[2mms[22m[39m
       [33m[2mâœ“[22m[39m should publish workflow [33m 726[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list workflow versions [33m 884[2mms[22m[39m
       [33m[2mâœ“[22m[39m should move workflow to a project [33m 1629[2mms[22m[39m
       [33m[2mâœ“[22m[39m should move workflow to Main Folder (projectId = null) [33m 1206[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject move to non-existent project [33m 634[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject move without authentication [33m 485[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject move of workflow user does not own [33m 1235[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject move with invalid projectId format [33m 522[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject move without projectId in body [33m 532[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject move to project user does not have access to [33m 2151[2mms[22m[39m
{"level":30,"time":1768363723355,"env":"test","module":"email-queue","jobId":"e89b0a81-29a3-4fdf-ae55-fb6431e4b482","to":"user2-a3b-hjK9w_0wHBmkLFWNi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363723365,"env":"test","module":"auth-service","tokenHash":"e2969d9b9b3a6a420d918183e2e72a0418e935cfcd618622103691cd46f455af","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363723368,"env":"test","module":"email-queue","jobId":"744e02b3-1f8e-4502-aaaf-e7e57a4c6de4","to":"protected-test-Iop8RFgAUO_QBqi9VkqMy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363723381,"env":"test","module":"user-credentials-repository","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1768363723410,"env":"test","module":"auth-routes","userId":"acc638d6-ed21-47c3-8ef6-1b1ca95604f0","email":"user2-a3b-hjK9w_0wHBmkLFWNi@example.com","msg":"User registered"}
{"level":30,"time":1768363723422,"env":"test","module":"auth-routes","userId":"bd80dde2-3842-460c-82b8-c9e4b6eac526","email":"protected-test-Iop8RFgAUO_QBqi9VkqMy@example.com","msg":"User registered"}
[90mstderr[2m | tests/integration/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mrevokeInvite[2m > [22m[2mshould allow admin to revoke invite
[22m[39mFailed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at [90mC:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mpg-pool[24m\index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:21:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:840:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizationInvites.test.ts:334:13
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  length: [33m341[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (workspace_id)=(00000000-0000-0000-0000-000000000098) is not present in table "workspaces".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'audit_logs'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'audit_logs_workspace_id_workspaces_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2599'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould prioritize JWT over cookie when both present
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363723482,"env":"test","module":"email-queue","jobId":"4e0964c1-ad95-4d8a-aa64-2bb3c856219b","to":"session-test-eWrKp8iIEHS9NM68W34sW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mDELETE Protected Routes[2m > [22m[2mshould reject DELETE without Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363723550,"env":"test","module":"auth-routes","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","email":"session-test-eWrKp8iIEHS9NM68W34sW@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould mark backup code as used
[22m[39m[TEST UTILS] MFA Secret verified for 16d458fb42d77c87f9f5f5db37df99da

{"level":30,"time":1768363723592,"env":"test","module":"auth-service","tokenHash":"12be14217998a0cae2c2828ed0c49233da5fe284afd8530e2a8f8276080a711a","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould revoke specific session
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768363723855,"env":"test","module":"auth-routes","userId":"e43f8f8c-bac9-4b6b-90b1-478a6ed8de19","msg":"User logged in successfully"}
{"level":30,"time":1768363723914,"env":"test","module":"audit-log-service","userId":"e43f8f8c-bac9-4b6b-90b1-478a6ed8de19","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould prevent revoking other user's device
[22m[39m[TEST UTILS] MFA Secret verified for 26dc7b6453cc1f8ed18012efca351315

{"level":30,"time":1768363724036,"env":"test","module":"auth-routes","userId":"acc638d6-ed21-47c3-8ef6-1b1ca95604f0","msg":"User logged in successfully"}
{"level":30,"time":1768363724085,"env":"test","module":"audit-log-service","userId":"acc638d6-ed21-47c3-8ef6-1b1ca95604f0","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all other sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363724164,"env":"test","module":"auth-routes","userId":"bd80dde2-3842-460c-82b8-c9e4b6eac526","msg":"User logged in successfully"}
{"level":30,"time":1768363724211,"env":"test","module":"auth-routes","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","msg":"User logged in successfully"}
{"level":30,"time":1768363724215,"env":"test","module":"audit-log-service","userId":"bd80dde2-3842-460c-82b8-c9e4b6eac526","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363724221,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363724266,"env":"test","module":"audit-log-service","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould revoke specific session
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould prevent revoking other user's device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363724458,"env":"test","module":"email-queue","jobId":"79813b43-bcf2-4caa-a897-291552b6084c","to":"test-1768363723820-jss0w@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363724458,"env":"test","module":"auth-service","email":"test-1768363723820-jss0w@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363724589,"env":"test","module":"user-credentials-repository","userId":"ceccb984-8ce8-4a18-838a-82cdb44dd8d4","msg":"User credentials created"}
{"level":30,"time":1768363724595,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363724638,"env":"test","module":"user-credentials-repository","userId":"f44363f9-7fc3-47f1-8d2c-7520a149f7b1","msg":"User credentials created"}
{"level":30,"time":1768363724659,"env":"test","module":"auth-routes","userId":"474d78443150210bcadf2af170ed47b8","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w19
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363724689,"env":"test","module":"email-queue","jobId":"4d6bee71-806e-4b9d-b4c9-d8aa5c49c4bb","to":"middleware-test-QnNt_4w9T0NRKvxfi8ILy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363724710,"env":"test","module":"audit-log-service","userId":"474d78443150210bcadf2af170ed47b8","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all other sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w19 (Reused: true)

{"level":30,"time":1768363724734,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363724742,"env":"test","module":"auth-routes","userId":"ceccb984-8ce8-4a18-838a-82cdb44dd8d4","email":"middleware-test-QnNt_4w9T0NRKvxfi8ILy@example.com","msg":"User registered"}
{"level":30,"time":1768363724743,"env":"test","module":"email-queue","jobId":"2fb85bb1-4020-4f31-bd1d-b966712b40df","to":"protected-test-uJ1yoQthCjYYecck9VC7D@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363724763,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363724791,"env":"test","module":"auth-routes","userId":"4ad5845bc681a53fb8e636e97452296c","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould return 401 when no auth provided
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363724799,"env":"test","module":"auth-routes","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","msg":"User logged in successfully"}
{"level":30,"time":1768363724798,"env":"test","module":"auth-routes","userId":"f44363f9-7fc3-47f1-8d2c-7520a149f7b1","email":"protected-test-uJ1yoQthCjYYecck9VC7D@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mToken Refresh Flow[2m > [22m[2mshould detect and prevent refresh token reuse (token theft)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363724853,"env":"test","module":"audit-log-service","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363724900,"env":"test","module":"mfa-service","userId":"4ad5845bc681a53fb8e636e97452296c","msg":"TOTP verification successful"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mPATCH Protected Routes[2m > [22m[2mshould allow PATCH with valid Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363724920,"env":"test","module":"auth-service","tokenHash":"a124aea2e55ba75c0efe74a107c607d03d34d5c186e69c289de5426c5877e987","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363724952,"env":"test","module":"auth-routes","userId":"4ad5845bc681a53fb8e636e97452296c","msg":"MFA login successful"}
{"level":30,"time":1768363724957,"env":"test","module":"auth-routes","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","sessionCount":2,"msg":"Listed active sessions"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w20
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould prevent backup code reuse
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w20 (Reused: true)

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w18
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w18 (Reused: true)

{"level":30,"time":1768363725089,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363725111,"env":"test","module":"auth-routes","userId":"4ad5845bc681a53fb8e636e97452296c","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363725112,"env":"test","module":"auth-routes","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","sessionId":"918bb1db-2f96-4a72-863f-30b96209cc29","msg":"Session revoked"}
{"level":30,"time":1768363725116,"env":"test","module":"auth-service","tokenHash":"1fe95c22ebd31594a6737b28f741b7676835803c7ca196bce4167e9ef2bf61bb","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363725135,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":40,"time":1768363725172,"env":"test","module":"auth-service","userId":"bedb3503-ae1e-41eb-9c1a-3b13d9dadaeb","tokenHash":"1fe95c22ebd31594a6737b28f741b7676835803c7ca196bce4167e9ef2bf61bb","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363725200,"env":"test","module":"auth-routes","userId":"474d78443150210bcadf2af170ed47b8","msg":"User logged in successfully"}
{"level":30,"time":1768363725223,"env":"test","module":"auth-routes","userId":"4ad5845bc681a53fb8e636e97452296c","deviceCount":1,"msg":"Listed trusted devices"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould prevent revoking other user's device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363725252,"env":"test","module":"audit-log-service","userId":"474d78443150210bcadf2af170ed47b8","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all other sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363725277,"env":"test","module":"auth-routes","userId":"ceccb984-8ce8-4a18-838a-82cdb44dd8d4","msg":"User logged in successfully"}
{"level":30,"time":1768363725331,"env":"test","module":"audit-log-service","userId":"ceccb984-8ce8-4a18-838a-82cdb44dd8d4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363725332,"env":"test","module":"auth-routes","userId":"8b82f080b577aef09d03f28b16dc0fed","msg":"User logged in successfully"}
{"level":50,"time":1768363725335,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363725385,"env":"test","module":"audit-log-service","userId":"8b82f080b577aef09d03f28b16dc0fed","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363725389,"env":"test","module":"auth-service","tokenHash":"748097a3a3bd7f2319ff3001fb191288dafb75eb09b6465dd1b12c4fb7c88c0e","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363725467,"env":"test","module":"auth-routes","userId":"f44363f9-7fc3-47f1-8d2c-7520a149f7b1","msg":"User logged in successfully"}
{"level":30,"time":1768363725479,"env":"test","module":"email-queue","jobId":"9458f25f-6f41-4878-b544-3869ea9d2461","to":"existing_1768363695918@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768363725510,"env":"test","module":"auth-routes","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"User logged in successfully"}
{"level":30,"time":1768363725520,"env":"test","module":"audit-log-service","userId":"f44363f9-7fc3-47f1-8d2c-7520a149f7b1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363725541,"env":"test","module":"user-credentials-repository","userId":"39beec82-d594-434c-ba8d-13de17c9449e","msg":"User credentials created"}
{"level":30,"time":1768363725565,"env":"test","module":"audit-log-service","userId":"bdf68548b02faf5705f5f14e50dddbd5","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mGET /api/auth/me[2m > [22m[2mshould return current user for valid token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363725600,"env":"test","module":"auth-service","tokenHash":"748097a3a3bd7f2319ff3001fb191288dafb75eb09b6465dd1b12c4fb7c88c0e","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363725613,"env":"test","module":"user-credentials-repository","userId":"e53c8310-78da-48d7-95fc-5fbaf5ca2865","msg":"User credentials created"}
{"level":30,"time":1768363725647,"env":"test","module":"email-queue","jobId":"07396f0c-6997-40b1-93bb-073e48d7af11","to":"jwt-test-XN-5BD2mvVvKpMLmetjTM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768363725654,"env":"test","module":"auth-service","userId":"8b82f080b577aef09d03f28b16dc0fed","tokenHash":"748097a3a3bd7f2319ff3001fb191288dafb75eb09b6465dd1b12c4fb7c88c0e","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363725699,"env":"test","module":"auth-routes","userId":"39beec82-d594-434c-ba8d-13de17c9449e","email":"jwt-test-XN-5BD2mvVvKpMLmetjTM@example.com","msg":"User registered"}
{"level":30,"time":1768363725717,"env":"test","module":"email-queue","jobId":"779b9ee9-0251-423e-b82c-161ca70099ad","to":"session-test-zGZ5PLzIz98JuclZa3LSE@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363725722,"env":"test","module":"auth-routes","userId":"26dc7b6453cc1f8ed18012efca351315","msg":"Login requires MFA verification"}
{"level":30,"time":1768363725730,"env":"test","module":"user-credentials-repository","userId":"afa1ae4e-c5ad-438d-bc7a-82a4622c7ef1","msg":"User credentials created"}
{"level":30,"time":1768363725749,"env":"test","module":"auth-routes","userId":"474d78443150210bcadf2af170ed47b8","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mToken Refresh Flow[2m > [22m[2mshould rotate refresh token on use
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363725771,"env":"test","module":"auth-routes","userId":"e53c8310-78da-48d7-95fc-5fbaf5ca2865","email":"session-test-zGZ5PLzIz98JuclZa3LSE@example.com","msg":"User registered"}
{"level":30,"time":1768363725804,"env":"test","module":"audit-log-service","userId":"474d78443150210bcadf2af170ed47b8","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all other sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363725829,"env":"test","module":"mfa-service","userId":"26dc7b6453cc1f8ed18012efca351315","msg":"TOTP verification successful"}
{"level":30,"time":1768363725830,"env":"test","module":"email-queue","jobId":"d1615985-168a-45ca-8f14-b3d193cb552f","to":"middleware-test-iwcM-sweVQ_t1Pm87lPG2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstderr[2m | tests/integration/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mrevokeInvite[2m > [22m[2mshould prevent accepting revoked invite
[22m[39mFailed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at [90mC:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mpg-pool[24m\index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:21:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:840:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizationInvites.test.ts:350:13
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  length: [33m341[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (workspace_id)=(00000000-0000-0000-0000-000000000098) is not present in table "workspaces".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'audit_logs'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'audit_logs_workspace_id_workspaces_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2599'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould prevent revoking current session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363725880,"env":"test","module":"auth-routes","userId":"afa1ae4e-c5ad-438d-bc7a-82a4622c7ef1","email":"middleware-test-iwcM-sweVQ_t1Pm87lPG2@example.com","msg":"User registered"}
{"level":30,"time":1768363725881,"env":"test","module":"auth-routes","userId":"26dc7b6453cc1f8ed18012efca351315","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mhybridAuth Middleware[2m > [22m[2mshould return 401 when both JWT and cookie are invalid
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363726089,"env":"test","module":"mfa-service","userId":"bdf68548b02faf5705f5f14e50dddbd5","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363726088,"env":"test","module":"user-credentials-repository","userId":"J3mXbh3-l9Ksc3N3p_0yI","msg":"User credentials created"}
{"level":30,"time":1768363726089,"env":"test","module":"mfa-service","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"Generated TOTP secret"}
{"level":30,"time":1768363726089,"env":"test","module":"auth-routes","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"MFA setup initiated"}
{"level":30,"time":1768363726092,"env":"test","module":"auth-routes","userId":"b2accd7404d4a83d6e1f6d91205f8c74","msg":"User logged in successfully"}
{"level":30,"time":1768363726146,"env":"test","module":"audit-log-service","userId":"b2accd7404d4a83d6e1f6d91205f8c74","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363726289,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363726290,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363726313,"env":"test","module":"auth-routes","userId":"J3mXbh3-l9Ksc3N3p_0yI","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768363726341,"env":"test","module":"auth-routes","userId":"39beec82-d594-434c-ba8d-13de17c9449e","msg":"User logged in successfully"}
 [32mâœ“[39m tests/integration/organizationInvites.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 30357[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create placeholder user for non-existent email [33m 1790[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create invite for existing user without creating placeholder [33m 1376[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent duplicate pending invites [33m 1652[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent inviting existing members [33m 1097[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require admin access to create invite [33m 767[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set expiry to 7 days from now [33m 1435[2mms[22m[39m
       [33m[2mâœ“[22m[39m should accept invite and create membership [33m 1960[2mms[22m[39m
       [33m[2mâœ“[22m[39m should convert placeholder user to real user on accept [33m 1996[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject expired invite [33m 1885[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject already accepted invite [33m 2160[2mms[22m[39m
       [33m[2mâœ“[22m[39m should verify email matches invite [33m 1708[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject invalid token [33m 1115[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return pending invites for user email [33m 1754[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not return expired invites [33m 1781[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not return accepted invites [33m 2212[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow admin to revoke invite [33m 2136[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent accepting revoked invite [33m 2426[2mms[22m[39m
{"level":30,"time":1768363726357,"env":"test","module":"auth-routes","userId":"474d78443150210bcadf2af170ed47b8","msg":"User logged in successfully"}
{"level":30,"time":1768363726392,"env":"test","module":"audit-log-service","userId":"39beec82-d594-434c-ba8d-13de17c9449e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363726400,"env":"test","module":"auth-service","tokenHash":"0cad4194bc8d2ef0bc9724e09808bb68dafe1b2b15b8d8ae85d39b4de2606c05","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363726415,"env":"test","module":"audit-log-service","userId":"474d78443150210bcadf2af170ed47b8","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363726419,"env":"test","module":"mfa-service","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"MFA enabled successfully"}
{"level":30,"time":1768363726419,"env":"test","module":"auth-routes","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"MFA enabled successfully"}
{"level":30,"time":1768363726458,"env":"test","module":"auth-routes","userId":"e53c8310-78da-48d7-95fc-5fbaf5ca2865","msg":"User logged in successfully"}
{"level":30,"time":1768363726472,"env":"test","module":"audit-log-service","userId":"bdf68548b02faf5705f5f14e50dddbd5","eventType":"mfa_enabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould prevent backup code reuse
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363726511,"env":"test","module":"auth-routes","userId":"afa1ae4e-c5ad-438d-bc7a-82a4622c7ef1","msg":"User logged in successfully"}
{"level":30,"time":1768363726513,"env":"test","module":"audit-log-service","userId":"e53c8310-78da-48d7-95fc-5fbaf5ca2865","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363726570,"env":"test","module":"audit-log-service","userId":"afa1ae4e-c5ad-438d-bc7a-82a4622c7ef1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363726576,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363726581,"env":"test","module":"auth-routes","userId":"474d78443150210bcadf2af170ed47b8","msg":"All other sessions revoked"}
{"level":30,"time":1768363726623,"env":"test","module":"auth-routes","userId":"e53c8310-78da-48d7-95fc-5fbaf5ca2865","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363726629,"env":"test","module":"auth-service","tokenHash":"0cad4194bc8d2ef0bc9724e09808bb68dafe1b2b15b8d8ae85d39b4de2606c05","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363726638,"env":"test","module":"audit-log-service","userId":"474d78443150210bcadf2af170ed47b8","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768363726662,"env":"test","module":"user-credentials-repository","userId":"f8a0f360-be73-4b65-88e5-077e443b1797","msg":"User credentials created"}
{"level":40,"time":1768363726678,"env":"test","module":"auth-service","userId":"39beec82-d594-434c-ba8d-13de17c9449e","tokenHash":"0cad4194bc8d2ef0bc9724e09808bb68dafe1b2b15b8d8ae85d39b4de2606c05","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363726679,"env":"test","module":"user-credentials-repository","userId":"qd5b8E9rD1762OpqJPhZR","msg":"User credentials created"}
{"level":30,"time":1768363726735,"env":"test","module":"auth-service","tokenHash":"4ef0ef27bf33cf9a7a79a0e8e97a74cef370933b1af0fc82d34972ca401619fe","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768363726748,"env":"test","module":"auth-routes","userId":"474d78443150210bcadf2af170ed47b8","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363726772,"env":"test","module":"email-queue","jobId":"111636a7-b757-4591-8b12-e6f6afd2335b","to":"protected-test-MRpByyv0lt7JmNZGZpagQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768363726790,"env":"test","module":"auth-service","userId":"39beec82-d594-434c-ba8d-13de17c9449e","tokenHash":"4ef0ef27bf33cf9a7a79a0e8e97a74cef370933b1af0fc82d34972ca401619fe","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363726789,"env":"test","module":"auth-routes","userId":"qd5b8E9rD1762OpqJPhZR","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363726824,"env":"test","module":"auth-routes","userId":"f8a0f360-be73-4b65-88e5-077e443b1797","email":"protected-test-MRpByyv0lt7JmNZGZpagQ@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mSession Management Flow[2m > [22m[2mshould list all active sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363726897,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363726903,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mPATCH Protected Routes[2m > [22m[2mshould reject PATCH without Bearer token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363727024,"env":"test","module":"user-credentials-repository","userId":"09e0d69e-fa27-4a40-9ef4-5a035b44d371","msg":"User credentials created"}
{"level":30,"time":1768363727032,"env":"test","module":"auth-routes","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"Login requires MFA verification"}
{"level":30,"time":1768363727125,"env":"test","module":"email-queue","jobId":"1fd5bd3a-0c98-4e85-97b7-b05ccd436b7d","to":"middleware-test-xZ9-TEQzLlJ6bHGZTiHNT@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363727166,"env":"test","module":"user-credentials-repository","userId":"592572ae-8e58-494f-9f28-c6a702d8894d","msg":"User credentials created"}
{"level":30,"time":1768363727176,"env":"test","module":"auth-routes","userId":"09e0d69e-fa27-4a40-9ef4-5a035b44d371","email":"middleware-test-xZ9-TEQzLlJ6bHGZTiHNT@example.com","msg":"User registered"}
{"level":30,"time":1768363727177,"env":"test","module":"user-credentials-repository","userId":"gBXPqpCuEqOjaqNt0wvxX","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2moptionalHybridAuth Middleware[2m > [22m[2mshould authenticate with JWT if provided
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363727242,"env":"test","module":"mfa-service","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"Backup code verified and consumed"}
{"level":30,"time":1768363727265,"env":"test","module":"user-credentials-repository","userId":"4184fab8-a015-49c6-8c45-49398a16156e","msg":"User credentials created"}
{"level":30,"time":1768363727273,"env":"test","module":"email-queue","jobId":"ccb86f4d-0e0c-4a91-aadb-8724f17cd9c0","to":"session-test-HejRO14BFYmpGOj2T-f6d@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363727283,"env":"test","module":"auth-routes","userId":"gBXPqpCuEqOjaqNt0wvxX","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1768363727291,"env":"test","module":"auth-routes","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould prevent backup code reuse
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363727323,"env":"test","module":"auth-routes","userId":"592572ae-8e58-494f-9f28-c6a702d8894d","email":"session-test-HejRO14BFYmpGOj2T-f6d@example.com","msg":"User registered"}
{"level":30,"time":1768363727362,"env":"test","module":"auth-routes","userId":"a7b0862d0a7a7b430b434f3151d65388","msg":"User logged in successfully"}
{"level":30,"time":1768363727374,"env":"test","module":"email-queue","jobId":"f21462de-08c9-421f-8076-cacedede4527","to":"jwt-test-0H_Bz3R7IDx2ghcsnFJb-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould complete MFA login with valid TOTP code
[22m[39m[TEST UTILS] MFA Secret verified for 51ec7523b674eb653ecc1306931dab7c

{"level":30,"time":1768363727415,"env":"test","module":"audit-log-service","userId":"a7b0862d0a7a7b430b434f3151d65388","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mSession Management Flow[2m > [22m[2mshould list all active sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363727427,"env":"test","module":"auth-routes","userId":"4184fab8-a015-49c6-8c45-49398a16156e","email":"jwt-test-0H_Bz3R7IDx2ghcsnFJb-@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mToken Refresh Flow[2m > [22m[2mshould detect token reuse and revoke all user tokens
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363727488,"env":"test","module":"auth-routes","userId":"f8a0f360-be73-4b65-88e5-077e443b1797","msg":"User logged in successfully"}
{"level":30,"time":1768363727538,"env":"test","module":"audit-log-service","userId":"f8a0f360-be73-4b65-88e5-077e443b1797","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363727542,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363727649,"env":"test","module":"user-credentials-repository","userId":"MT6lEtfB0BlRk3IB19S0n","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould complete MFA login with valid TOTP code
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363727755,"env":"test","module":"auth-routes","userId":"MT6lEtfB0BlRk3IB19S0n","sessionCount":0,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould skip MFA for trusted device
[22m[39m[TEST UTILS] MFA Secret verified for 189d7ce2cb6c146fa4011eb3422c93f7

{"level":30,"time":1768363727797,"env":"test","module":"auth-routes","userId":"09e0d69e-fa27-4a40-9ef4-5a035b44d371","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould keep current session active
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363727845,"env":"test","module":"auth-routes","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"Login requires MFA verification"}
{"level":30,"time":1768363727852,"env":"test","module":"audit-log-service","userId":"09e0d69e-fa27-4a40-9ef4-5a035b44d371","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363727859,"env":"test","module":"user-credentials-repository","userId":"26bb8841-e362-4960-890a-0707427fbe3f","msg":"User credentials created"}
{"level":30,"time":1768363727952,"env":"test","module":"user-credentials-repository","userId":"6ddf29d3-0f84-4fb1-ba9a-3307e92528bd","msg":"User credentials created"}
{"level":30,"time":1768363727960,"env":"test","module":"auth-routes","userId":"a7b0862d0a7a7b430b434f3151d65388","msg":"User logged in successfully"}
{"level":30,"time":1768363727966,"env":"test","module":"email-queue","jobId":"12571ed2-a10f-4291-86a4-50f3a70d53aa","to":"user2-5AwFTyZ-1gG04KdjgFuy-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363727975,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363727975,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363727993,"env":"test","module":"auth-routes","userId":"4184fab8-a015-49c6-8c45-49398a16156e","msg":"User logged in successfully"}
{"level":30,"time":1768363728009,"env":"test","module":"audit-log-service","userId":"a7b0862d0a7a7b430b434f3151d65388","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [32mâœ“[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 14672[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a workflow template mapping [33m 670[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create non-primary mapping by default [33m 646[2mms[22m[39m
       [33m[2mâœ“[22m[39m should find all templates for a workflow version [33m 776[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return empty array for version with no templates [33m 635[2mms[22m[39m
       [33m[2mâœ“[22m[39m should order by createdAt desc (newest first) [33m 734[2mms[22m[39m
       [33m[2mâœ“[22m[39m should find mapping by workflow version and key [33m 701[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return undefined for non-existent key [33m 617[2mms[22m[39m
       [33m[2mâœ“[22m[39m should find primary template for workflow version [33m 733[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return undefined when no primary template exists [33m 674[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set a template as primary and unset others [33m 923[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle setting primary when none existed before [33m 874[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not delete mapping if workflow version does not match [33m 886[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return true if key exists in workflow version [33m 685[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return false if key does not exist [33m 633[2mms[22m[39m
       [33m[2mâœ“[22m[39m should exclude specified id when checking existence [33m 693[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return true if key exists on different mapping [33m 759[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update mapping fields [33m 700[2mms[22m[39m
       [33m[2mâœ“[22m[39m should find mapping by id [33m 690[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return undefined for non-existent id [33m 632[2mms[22m[39m
{"level":30,"time":1768363728021,"env":"test","module":"auth-routes","userId":"26bb8841-e362-4960-890a-0707427fbe3f","email":"user2-5AwFTyZ-1gG04KdjgFuy-@example.com","msg":"User registered"}
{"level":30,"time":1768363728043,"env":"test","module":"audit-log-service","userId":"4184fab8-a015-49c6-8c45-49398a16156e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mToken Refresh Flow[2m > [22m[2mshould detect token reuse and revoke all user tokens
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363728053,"env":"test","module":"email-queue","jobId":"90558943-918f-41cb-8d8b-e54906fe5f8e","to":"protected-test-6vZWJ1zdERtdnwVUlk0oU@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould not allow revoking other users sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests
[22m[39mError cleaning up table: Error: Table not found
    at DatavaultTablesService.verifyTenantOwnership (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:152:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablesService.deleteTable (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:290:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/datavault.autonumber.test.ts:91:9

{"level":30,"time":1768363728103,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363728104,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363728114,"env":"test","module":"auth-routes","userId":"6ddf29d3-0f84-4fb1-ba9a-3307e92528bd","email":"protected-test-6vZWJ1zdERtdnwVUlk0oU@example.com","msg":"User registered"}
{"level":30,"time":1768363728118,"env":"test","module":"auth-routes","userId":"a7b0862d0a7a7b430b434f3151d65388","sessionCount":2,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould skip MFA for trusted device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363728124,"env":"test","module":"user-credentials-repository","userId":"Od5Wn8Sm9UXPIi4001Ybt","msg":"User credentials created"}
 [32mâœ“[39m tests/integration/datavault.autonumber.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 13850[2mms[22m[39m
     [33m[2mâœ“[22m[39m should generate basic autonumber without prefix [33m 1168[2mms[22m[39m
     [33m[2mâœ“[22m[39m should generate autonumber with prefix [33m 1161[2mms[22m[39m
     [33m[2mâœ“[22m[39m should generate autonumber with yearly reset format [33m 1148[2mms[22m[39m
     [33m[2mâœ“[22m[39m should be atomic and prevent race conditions [33m 943[2mms[22m[39m
     [33m[2mâœ“[22m[39m should prevent manual updates to autonumber values [33m 1524[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Edge Cases[2m > [22m[2mshould handle Bearer token with extra spaces
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363728251,"env":"test","module":"auth-routes","userId":"51ec7523b674eb653ecc1306931dab7c","msg":"Login requires MFA verification"}
{"level":30,"time":1768363728301,"env":"test","module":"auth-routes","userId":"Od5Wn8Sm9UXPIi4001Ybt","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363728362,"env":"test","module":"auth-routes","userId":"74d665c0f066818241fd59bdc09caf20","msg":"User logged in successfully"}
{"level":30,"time":1768363728368,"env":"test","module":"mfa-service","userId":"51ec7523b674eb653ecc1306931dab7c","msg":"TOTP verification successful"}
{"level":30,"time":1768363728415,"env":"test","module":"audit-log-service","userId":"74d665c0f066818241fd59bdc09caf20","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould keep current session active
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363728420,"env":"test","module":"auth-routes","userId":"51ec7523b674eb653ecc1306931dab7c","msg":"MFA login successful"}
{"level":30,"time":1768363728455,"env":"test","module":"intake-service","runId":"f75e8f51-8098-4712-a71d-a693d9ffede2","slug":"hybrid-jwt-_XVD7wRt_7N0GA03KoCJq","userId":"09e0d69e-fa27-4a40-9ef4-5a035b44d371","msg":"Created intake run"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":30,"time":1768363728646,"env":"test","module":"auth-routes","userId":"4184fab8-a015-49c6-8c45-49398a16156e","msg":"User logged in successfully"}
{"level":30,"time":1768363728700,"env":"test","module":"audit-log-service","userId":"4184fab8-a015-49c6-8c45-49398a16156e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363728704,"env":"test","module":"auth-service","tokenHash":"82dac22c0108bcbb60ddd38c519fa1952adb36c70f4b028833aa168f081dcc39","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363728697,"env":"test","module":"mfa-service","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"Invalid backup code provided"}
{"level":30,"time":1768363728708,"env":"test","module":"auth-routes","userId":"26bb8841-e362-4960-890a-0707427fbe3f","msg":"User logged in successfully"}
{"level":30,"time":1768363728711,"env":"test","module":"auth-routes","userId":"189d7ce2cb6c146fa4011eb3422c93f7","msg":"Login requires MFA verification"}
{"level":30,"time":1768363728718,"env":"test","module":"user-credentials-repository","userId":"J9skXqGEdCCmzpmHsROi0","msg":"User credentials created"}
{"level":40,"time":1768363728758,"env":"test","module":"auth-routes","userId":"bdf68548b02faf5705f5f14e50dddbd5","msg":"MFA verification failed during login"}
{"level":30,"time":1768363728764,"env":"test","module":"audit-log-service","userId":"26bb8841-e362-4960-890a-0707427fbe3f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363728814,"env":"test","module":"mfa-service","userId":"189d7ce2cb6c146fa4011eb3422c93f7","msg":"TOTP verification successful"}
{"level":30,"time":1768363728833,"env":"test","module":"auth-routes","userId":"J9skXqGEdCCmzpmHsROi0","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363728869,"env":"test","module":"auth-routes","userId":"189d7ce2cb6c146fa4011eb3422c93f7","msg":"MFA login successful"}
{"level":30,"time":1768363728876,"env":"test","module":"auth-routes","userId":"26bb8841-e362-4960-890a-0707427fbe3f","sessionCount":2,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould not allow revoking other users sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768363728904,"env":"test","module":"user-credentials-repository","userId":"4110ba3a-892b-4ba9-9db5-54fac6887e09","msg":"User credentials created"}
{"level":30,"time":1768363728928,"env":"test","module":"auth-service","tokenHash":"82dac22c0108bcbb60ddd38c519fa1952adb36c70f4b028833aa168f081dcc39","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363728937,"env":"test","module":"auth-routes","userId":"6ddf29d3-0f84-4fb1-ba9a-3307e92528bd","msg":"User logged in successfully"}
{"level":30,"time":1768363728966,"env":"test","module":"auth-routes","userId":"74d665c0f066818241fd59bdc09caf20","msg":"User logged in successfully"}
{"level":40,"time":1768363728978,"env":"test","module":"auth-service","userId":"4184fab8-a015-49c6-8c45-49398a16156e","tokenHash":"82dac22c0108bcbb60ddd38c519fa1952adb36c70f4b028833aa168f081dcc39","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363728993,"env":"test","module":"audit-log-service","userId":"6ddf29d3-0f84-4fb1-ba9a-3307e92528bd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768363728999,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363729000,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363729010,"env":"test","module":"email-queue","jobId":"65cc0fc3-f638-4dc6-802a-41ca7ea45d34","to":"middleware-test-NZu4aBBA3dHjJxQDWZDe3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363729016,"env":"test","module":"audit-log-service","userId":"74d665c0f066818241fd59bdc09caf20","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363729026,"env":"test","module":"auth-routes","userId":"189d7ce2cb6c146fa4011eb3422c93f7","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363729037,"env":"test","module":"auth-service","tokenHash":"240b34a4ef78aff0c7fefa430145fe93041b4c9a6e4dd0d54c921c2acf48a558","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould skip MFA for trusted device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363729063,"env":"test","module":"auth-routes","userId":"4110ba3a-892b-4ba9-9db5-54fac6887e09","email":"middleware-test-NZu4aBBA3dHjJxQDWZDe3@example.com","msg":"User registered"}
{"level":40,"time":1768363729085,"env":"test","module":"auth-service","userId":"4184fab8-a015-49c6-8c45-49398a16156e","tokenHash":"240b34a4ef78aff0c7fefa430145fe93041b4c9a6e4dd0d54c921c2acf48a558","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2moptionalHybridAuth Middleware[2m > [22m[2mshould authenticate with cookie if JWT not provided
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mSession Management Flow[2m > [22m[2mshould revoke specific session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363729181,"env":"test","module":"auth-routes","userId":"74d665c0f066818241fd59bdc09caf20","msg":"All other sessions revoked"}
{"level":30,"time":1768363729208,"env":"test","module":"user-credentials-repository","userId":"Ot3kktcqjK5DpVmFofdqG","msg":"User credentials created"}
{"level":50,"time":1768363729214,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363729254,"env":"test","module":"audit-log-service","userId":"74d665c0f066818241fd59bdc09caf20","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363729371,"env":"test","module":"auth-service","tokenHash":"3149d5a84bfa1b7c1be8e2a904e2547bae64fb03577783ab18bbf11d150e1874","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363729411,"env":"test","module":"auth-routes","userId":"592572ae-8e58-494f-9f28-c6a702d8894d","msg":"User logged in successfully"}
{"level":30,"time":1768363729453,"env":"test","module":"user-credentials-repository","userId":"95de1fa2-7448-44c0-a8ac-e06fa9c43150","msg":"User credentials created"}
{"level":30,"time":1768363729463,"env":"test","module":"audit-log-service","userId":"592572ae-8e58-494f-9f28-c6a702d8894d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363729557,"env":"test","module":"email-queue","jobId":"2b4f300b-dbfc-4560-8b7e-df4746114351","to":"protected-test-2kg9cAsawkGoO4iqzGwer@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould reject invalid MFA code
[22m[39m[TEST UTILS] MFA Secret verified for 12d4833fc85581d75cfdc8dd199bf622

{"level":30,"time":1768363729589,"env":"test","module":"user-credentials-repository","userId":"C3EjDDWbvGPsl6X8a1gB0","msg":"User credentials created"}
{"level":30,"time":1768363729604,"env":"test","module":"user-credentials-repository","userId":"905eaeec-a7ea-4954-b3e0-ba41a6957972","msg":"User credentials created"}
{"level":30,"time":1768363729613,"env":"test","module":"auth-routes","userId":"95de1fa2-7448-44c0-a8ac-e06fa9c43150","email":"protected-test-2kg9cAsawkGoO4iqzGwer@example.com","msg":"User registered"}
{"level":30,"time":1768363729618,"env":"test","module":"auth-routes","userId":"189d7ce2cb6c146fa4011eb3422c93f7","msg":"Login from trusted device - MFA skipped"}
{"level":30,"time":1768363729671,"env":"test","module":"auth-routes","userId":"189d7ce2cb6c146fa4011eb3422c93f7","msg":"User logged in successfully"}
{"level":30,"time":1768363729685,"env":"test","module":"auth-routes","userId":"4110ba3a-892b-4ba9-9db5-54fac6887e09","msg":"User logged in successfully"}
{"level":30,"time":1768363729714,"env":"test","module":"email-queue","jobId":"f59976fa-6492-4129-b974-cb70728269f4","to":"jwt-test-acHC5v4kCFvNxKUGo9jMK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363729719,"env":"test","module":"auth-routes","userId":"5eddc57f7464cbb71becb99c4b1c2661","msg":"User logged in successfully"}
{"level":30,"time":1768363729727,"env":"test","module":"audit-log-service","userId":"189d7ce2cb6c146fa4011eb3422c93f7","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Edge Cases[2m > [22m[2mshould handle very long invalid token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363729737,"env":"test","module":"audit-log-service","userId":"4110ba3a-892b-4ba9-9db5-54fac6887e09","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363729771,"env":"test","module":"auth-routes","userId":"905eaeec-a7ea-4954-b3e0-ba41a6957972","email":"jwt-test-acHC5v4kCFvNxKUGo9jMK@example.com","msg":"User registered"}
{"level":30,"time":1768363729771,"env":"test","module":"audit-log-service","userId":"5eddc57f7464cbb71becb99c4b1c2661","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts[2m > [22m[2mAuth Flows Integration Tests (REAL)[2m > [22m[2mSession Management Flow[2m > [22m[2mshould revoke specific session
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363729817,"env":"test","module":"auth-routes","userId":"C3EjDDWbvGPsl6X8a1gB0","sessionId":"ca05dd55-e883-4a1b-af55-18c3a1adacc6","msg":"Session revoked"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mLogout Flow[2m > [22m[2mshould revoke refresh token on logout
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould try TOTP before backup code
[22m[39m[TEST UTILS] MFA Secret verified for dae6374971e280eb84cfdee4e3918e00

{"level":40,"time":1768363729965,"env":"test","module":"mfa-service","userId":"12d4833fc85581d75cfdc8dd199bf622","msg":"TOTP verification failed"}
{"level":40,"time":1768363729965,"env":"test","module":"auth-routes","userId":"12d4833fc85581d75cfdc8dd199bf622","msg":"MFA verification failed during login"}
{"level":30,"time":1768363729980,"env":"test","module":"user-credentials-repository","userId":"28edabc3-f31b-451c-927c-18f75220b5d8","msg":"User credentials created"}
{"level":30,"time":1768363730086,"env":"test","module":"email-queue","jobId":"3abd8186-3cf7-4135-badf-82d22ed3e51b","to":"session-test-j2pJNyi-CrrHUUEW63-2u@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363730142,"env":"test","module":"auth-routes","userId":"28edabc3-f31b-451c-927c-18f75220b5d8","email":"session-test-j2pJNyi-CrrHUUEW63-2u@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould try TOTP before backup code
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363730206,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363730243,"env":"test","module":"user-credentials-repository","userId":"9dm0kf3shsSypMKPRuZF6","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/:sessionId[2m > [22m[2mshould return 404 for non-existent session ID
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w22
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363730273,"env":"test","module":"intake-service","runId":"cc53ad67-d25f-41d9-a327-35ceced28b26","slug":"hybrid-cookie-ouryKxfbmUdDS-jVaTAOJ","msg":"Created intake run"}
{"level":30,"time":1768363730282,"env":"test","module":"auth-routes","userId":"5eddc57f7464cbb71becb99c4b1c2661","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w22 (Reused: true)

{"level":30,"time":1768363730306,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363730330,"env":"test","module":"auth-routes","userId":"95de1fa2-7448-44c0-a8ac-e06fa9c43150","msg":"User logged in successfully"}
{"level":30,"time":1768363730336,"env":"test","module":"audit-log-service","userId":"5eddc57f7464cbb71becb99c4b1c2661","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363730345,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363730349,"env":"test","module":"auth-routes","userId":"905eaeec-a7ea-4954-b3e0-ba41a6957972","msg":"User logged in successfully"}
{"level":30,"time":1768363730382,"env":"test","module":"audit-log-service","userId":"95de1fa2-7448-44c0-a8ac-e06fa9c43150","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363730388,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363730404,"env":"test","module":"audit-log-service","userId":"905eaeec-a7ea-4954-b3e0-ba41a6957972","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363730443,"env":"test","module":"auth-routes","userId":"5eddc57f7464cbb71becb99c4b1c2661","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768363730470,"env":"test","module":"auth-service","tokenHash":"a5ea6198d330ac371435f287a7e61f67695124f8d5f138c8b5d1fa0e19f12e0d","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363730523,"env":"test","module":"auth-service","userId":"905eaeec-a7ea-4954-b3e0-ba41a6957972","tokenHash":"a5ea6198d330ac371435f287a7e61f67695124f8d5f138c8b5d1fa0e19f12e0d","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363730582,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363730583,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363730594,"env":"test","module":"user-credentials-repository","userId":"ytV4K21a4I5hskASqEgKW","msg":"User credentials created"}
{"level":30,"time":1768363730610,"env":"test","module":"auth-routes","userId":"5eddc57f7464cbb71becb99c4b1c2661","sessionId":"a0bbbde4-0ec8-4357-abcc-302c68f2534d","msg":"Session revoked"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould return 400 if no active session found
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363730693,"env":"test","module":"user-credentials-repository","userId":"93335ad9-bcbc-4a84-95bf-3fd1ce083371","msg":"User credentials created"}
 [32mâœ“[39m tests/integration/auth.routes.real.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 32245[2mms[22m[39m
       [33m[2mâœ“[22m[39m should register a new user successfully [33m 1341[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 409 for duplicate email [33m 1350[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set httpOnly refresh token cookie [33m 576[2mms[22m[39m
       [33m[2mâœ“[22m[39m should login with valid credentials [33m 1628[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 for invalid password [33m 1602[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 403 for unverified email [33m 971[2mms[22m[39m
       [33m[2mâœ“[22m[39m should record failed login attempt [33m 1661[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return requiresMfa=true for MFA-enabled users [33m 1922[2mms[22m[39m
       [33m[2mâœ“[22m[39m should lock account after 5 failed attempts [33m 3725[2mms[22m[39m
       [33m[2mâœ“[22m[39m should logout and clear refresh token cookie [33m 1629[2mms[22m[39m
       [33m[2mâœ“[22m[39m should refresh access token with valid refresh token [33m 1791[2mms[22m[39m
       [33m[2mâœ“[22m[39m should rotate refresh token after use [33m 1839[2mms[22m[39m
       [33m[2mâœ“[22m[39m should send password reset email for existing user [33m 1202[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reset password with valid token [33m 2865[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 400 for weak new password [33m 1379[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return current user for valid token [33m 1694[2mms[22m[39m
         [33m[2mâœ“[22m[39m should complete MFA login with valid TOTP code [33m 2133[2mms[22m[39m
         [33m[2mâœ“[22m[39m should reject invalid MFA code [33m 1544[2mms[22m[39m
{"level":30,"time":1768363730694,"env":"test","module":"auth-routes","userId":"dae6374971e280eb84cfdee4e3918e00","msg":"Login requires MFA verification"}
{"level":30,"time":1768363730725,"env":"test","module":"auth-routes","userId":"5eddc57f7464cbb71becb99c4b1c2661","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363730766,"env":"test","module":"auth-routes","userId":"28edabc3-f31b-451c-927c-18f75220b5d8","msg":"User logged in successfully"}
{"level":30,"time":1768363730797,"env":"test","module":"email-queue","jobId":"c4275821-3400-4875-8370-6883e5c7f31d","to":"middleware-test-xgW8fyINSJBWjnIZXa6D-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363730805,"env":"test","module":"mfa-service","userId":"dae6374971e280eb84cfdee4e3918e00","msg":"TOTP verification successful"}
{"level":30,"time":1768363730819,"env":"test","module":"audit-log-service","userId":"28edabc3-f31b-451c-927c-18f75220b5d8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363730839,"env":"test","module":"user-credentials-repository","userId":"5e72b6ee-e8ee-4541-a807-2ee715c344af","msg":"User credentials created"}
{"level":30,"time":1768363730850,"env":"test","module":"auth-routes","userId":"93335ad9-bcbc-4a84-95bf-3fd1ce083371","email":"middleware-test-xgW8fyINSJBWjnIZXa6D-@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould require MFA for untrusted device
[22m[39m[TEST UTILS] MFA Secret verified for 2bbbae301d175eb9b5a9fa170fc1e155

{"level":30,"time":1768363730856,"env":"test","module":"auth-routes","userId":"dae6374971e280eb84cfdee4e3918e00","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2moptionalHybridAuth Middleware[2m > [22m[2mshould proceed anonymously if no auth provided
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363730942,"env":"test","module":"email-queue","jobId":"614ea9fe-a890-4046-a17b-ce843803f466","to":"protected-test-N_rSFrI9ascnWg2qFmGcL@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363730996,"env":"test","module":"auth-routes","userId":"5e72b6ee-e8ee-4541-a807-2ee715c344af","email":"protected-test-N_rSFrI9ascnWg2qFmGcL@example.com","msg":"User registered"}
{"level":30,"time":1768363731006,"env":"test","module":"user-credentials-repository","userId":"80290e88-05a9-41e4-997a-fd0680e11a46","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Edge Cases[2m > [22m[2mshould handle empty Authorization header
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363731126,"env":"test","module":"email-queue","jobId":"1bd3d368-7be8-46e1-a88d-93ec0331bba0","to":"jwt-test-8I39CPj0bfjoiGr4CC2es@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363731156,"env":"test","module":"user-credentials-repository","userId":"Kz1GZxS8_0CnJeNDks_9o","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould require MFA for untrusted device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363731183,"env":"test","module":"auth-routes","userId":"80290e88-05a9-41e4-997a-fd0680e11a46","email":"jwt-test-8I39CPj0bfjoiGr4CC2es@example.com","msg":"User registered"}
{"level":30,"time":1768363731190,"env":"test","module":"auth-routes","userId":"10bec06a3a467358c2342bbea1ab585b","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests[2m > [22m[2mLogout Flow[2m > [22m[2mshould clear refresh token cookie on logout
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363731259,"env":"test","module":"audit-log-service","userId":"10bec06a3a467358c2342bbea1ab585b","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363731362,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363731408,"env":"test","module":"user-credentials-repository","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","msg":"User credentials created"}
{"level":30,"time":1768363731478,"env":"test","module":"auth-routes","userId":"93335ad9-bcbc-4a84-95bf-3fd1ce083371","msg":"User logged in successfully"}
{"level":30,"time":1768363731363,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/auth.flows.real.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 32911[2mms[22m[39m
       [33m[2mâœ“[22m[39m should complete registration, verify email, then login [33m 2416[2mms[22m[39m
       [33m[2mâœ“[22m[39m should lock account after 5 failed attempts, then unlock after waiting [33m 4105[2mms[22m[39m
       [33m[2mâœ“[22m[39m should record all login attempts [33m 2797[2mms[22m[39m
       [33m[2mâœ“[22m[39m should complete MFA setup and login with TOTP [33m 3279[2mms[22m[39m
       [33m[2mâœ“[22m[39m should login with backup code when TOTP unavailable [33m 4400[2mms[22m[39m
       [33m[2mâœ“[22m[39m should complete full password reset flow [33m 3164[2mms[22m[39m
       [33m[2mâœ“[22m[39m should invalidate all sessions after password reset [33m 2527[2mms[22m[39m
       [33m[2mâœ“[22m[39m should rotate refresh token on each use [33m 2248[2mms[22m[39m
       [33m[2mâœ“[22m[39m should detect and prevent refresh token reuse (token theft) [33m 2009[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list all active sessions [33m 2307[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke specific session [33m 2616[2mms[22m[39m
{"level":30,"time":1768363731507,"env":"test","module":"email-queue","jobId":"fe58ce69-bddf-4811-8840-e8a7ae78b2b5","to":"session-test-rjTWH0HYDrbayeqIEFffu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363731532,"env":"test","module":"audit-log-service","userId":"93335ad9-bcbc-4a84-95bf-3fd1ce083371","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363731561,"env":"test","module":"auth-routes","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","email":"session-test-rjTWH0HYDrbayeqIEFffu@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all sessions except current
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363731688,"env":"test","module":"auth-routes","userId":"5e72b6ee-e8ee-4541-a807-2ee715c344af","msg":"User logged in successfully"}
{"level":30,"time":1768363731701,"env":"test","module":"auth-routes","userId":"2bbbae301d175eb9b5a9fa170fc1e155","msg":"Login requires MFA verification"}
{"level":30,"time":1768363731720,"env":"test","module":"user-credentials-repository","userId":"2Id9a-BsnwYt745iGS40X","msg":"User credentials created"}
{"level":50,"time":1768363731724,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363731744,"env":"test","module":"audit-log-service","userId":"5e72b6ee-e8ee-4541-a807-2ee715c344af","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363731750,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363731768,"env":"test","module":"auth-routes","userId":"80290e88-05a9-41e4-997a-fd0680e11a46","msg":"User logged in successfully"}
{"level":30,"time":1768363731818,"env":"test","module":"mfa-service","userId":"2bbbae301d175eb9b5a9fa170fc1e155","msg":"TOTP verification successful"}
{"level":30,"time":1768363731835,"env":"test","module":"audit-log-service","userId":"80290e88-05a9-41e4-997a-fd0680e11a46","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363731869,"env":"test","module":"auth-routes","userId":"2bbbae301d175eb9b5a9fa170fc1e155","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Status[2m > [22m[2mshould return MFA status for user
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363732030,"env":"test","module":"auth-routes","userId":"2bbbae301d175eb9b5a9fa170fc1e155","deviceFingerprint":"10fa3aea039bf6fec7b6bcb982cbed1cc6ab844dd3c0879bec32baefb2997b52","msg":"Device marked as trusted"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould require MFA for untrusted device
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363732081,"env":"test","module":"intake-service","runId":"f8c72c8a-95b6-42b1-9037-62bcdad1fd7b","slug":"hybrid-anon-YdBwOdji2-eMq-Skb0J9z","msg":"Created intake run"}
{"level":30,"time":1768363732123,"env":"test","module":"user-credentials-repository","userId":"XhvgkPBf9QOtmzhrFoR4X","msg":"User credentials created"}
{"level":30,"time":1768363732181,"env":"test","module":"user-credentials-repository","userId":"7c2a92d6-6998-4530-9e64-71694c8acd81","msg":"User credentials created"}
{"level":30,"time":1768363732184,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363732184,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363732213,"env":"test","module":"auth-routes","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","msg":"User logged in successfully"}
{"level":30,"time":1768363732268,"env":"test","module":"audit-log-service","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all sessions except current
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363732287,"env":"test","module":"email-queue","jobId":"2b22ee10-8a97-4246-8a5f-450960680a31","to":"protected-test-4JanlULT-IBy_gvkcgu16@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363732338,"env":"test","module":"auth-routes","userId":"7c2a92d6-6998-4530-9e64-71694c8acd81","email":"protected-test-4JanlULT-IBy_gvkcgu16@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all trusted devices
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363732402,"env":"test","module":"auth-routes","userId":"2eb911b55eee0409e4561bc74c42fa8f","msg":"User logged in successfully"}
{"level":30,"time":1768363732404,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363732457,"env":"test","module":"audit-log-service","userId":"2eb911b55eee0409e4561bc74c42fa8f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Edge Cases[2m > [22m[2mshould handle Authorization header with only Bearer
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363732497,"env":"test","module":"user-credentials-repository","userId":"b6153bfa-9678-48f3-b2a9-593cb7360bbc","msg":"User credentials created"}
 [32mâœ“[39m tests/integration/auth/jwt.authentication.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 26149[2mms[22m[39m
       [33m[2mâœ“[22m[39m should generate valid JWT token on successful login [33m 1250[2mms[22m[39m
       [33m[2mâœ“[22m[39m should include correct payload in JWT token [33m 1216[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set JWT expiry to 15 minutes [33m 1173[2mms[22m[39m
       [33m[2mâœ“[22m[39m should accept valid JWT token on protected routes [33m 1277[2mms[22m[39m
       [33m[2mâœ“[22m[39m should accept request with missing Bearer prefix (lenient) [33m 1280[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject expired JWT token [33m 1108[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return token_expired error code for expired tokens [33m 1108[2mms[22m[39m
       [33m[2mâœ“[22m[39m should exchange valid session cookie for JWT token [33m 731[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prefer Bearer token over cookie when both present [33m 1252[2mms[22m[39m
       [33m[2mâœ“[22m[39m should fall back to cookie if Bearer token is invalid [33m 560[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow GET requests with cookie auth only [33m 1333[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject POST requests with cookie auth only (mutation-strict) [33m 568[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow anonymous access to public workflows [33m 463[2mms[22m[39m
       [33m[2mâœ“[22m[39m should attach user info if authenticated on optional auth routes [33m 481[2mms[22m[39m
       [33m[2mâœ“[22m[39m should refresh access token using refresh token [33m 2459[2mms[22m[39m
       [33m[2mâœ“[22m[39m should rotate refresh token on use [33m 1729[2mms[22m[39m
       [33m[2mâœ“[22m[39m should detect token reuse and revoke all user tokens [33m 2286[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke refresh token on logout [33m 1434[2mms[22m[39m
       [33m[2mâœ“[22m[39m should clear refresh token cookie on logout [33m 1321[2mms[22m[39m
{"level":30,"time":1768363732557,"env":"test","module":"auth-routes","userId":"2bbbae301d175eb9b5a9fa170fc1e155","msg":"Login requires MFA verification"}
{"level":30,"time":1768363732597,"env":"test","module":"email-queue","jobId":"291c4730-e17a-466b-90fa-0ca9bcd66c1b","to":"middleware-test-HxLcaA0j2bl-pI8KfuaK3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363732603,"env":"test","module":"auth-routes","userId":"XhvgkPBf9QOtmzhrFoR4X","msg":"All other sessions revoked"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w24
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363732648,"env":"test","module":"auth-routes","userId":"b6153bfa-9678-48f3-b2a9-593cb7360bbc","email":"middleware-test-HxLcaA0j2bl-pI8KfuaK3@example.com","msg":"User registered"}
{"level":30,"time":1768363732656,"env":"test","module":"audit-log-service","userId":"XhvgkPBf9QOtmzhrFoR4X","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w24 (Reused: true)

{"level":30,"time":1768363732694,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2moptionalHybridAuth Middleware[2m > [22m[2mshould proceed anonymously if both JWT and cookie are invalid
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363732740,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363732832,"env":"test","module":"auth-routes","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","msg":"User logged in successfully"}
{"level":30,"time":1768363732888,"env":"test","module":"audit-log-service","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all sessions except current
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363732941,"env":"test","module":"auth-routes","userId":"dc4b14688f7cbf83450a5ce9a433ee43","msg":"User logged in successfully"}
{"level":30,"time":1768363732993,"env":"test","module":"audit-log-service","userId":"dc4b14688f7cbf83450a5ce9a433ee43","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768363733059,"env":"test","module":"auth-routes","userId":"7c2a92d6-6998-4530-9e64-71694c8acd81","msg":"User logged in successfully"}
{"level":30,"time":1768363733087,"env":"test","module":"user-credentials-repository","userId":"CtzFQPX15xDPR7n2I4v41","msg":"User credentials created"}
{"level":30,"time":1768363733116,"env":"test","module":"audit-log-service","userId":"7c2a92d6-6998-4530-9e64-71694c8acd81","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363733122,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768363733161,"env":"test","module":"auth-routes","userId":"dc4b14688f7cbf83450a5ce9a433ee43","deviceFingerprint":"5704edd074e9c212893f0aacd3ccb4ea052539cb69bd3f923d88aab5ed5844f1","msg":"Device marked as trusted"}
{"level":30,"time":1768363733222,"env":"test","module":"auth-routes","userId":"b6153bfa-9678-48f3-b2a9-593cb7360bbc","msg":"User logged in successfully"}
{"level":30,"time":1768363733276,"env":"test","module":"audit-log-service","userId":"b6153bfa-9678-48f3-b2a9-593cb7360bbc","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363733294,"env":"test","module":"auth-routes","userId":"CtzFQPX15xDPR7n2I4v41","msg":"All other sessions revoked"}
{"level":30,"time":1768363733329,"env":"test","module":"auth-routes","userId":"dc4b14688f7cbf83450a5ce9a433ee43","msg":"All other sessions revoked"}
{"level":30,"time":1768363733346,"env":"test","module":"audit-log-service","userId":"CtzFQPX15xDPR7n2I4v41","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768363733384,"env":"test","module":"audit-log-service","userId":"dc4b14688f7cbf83450a5ce9a433ee43","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768363733402,"env":"test","module":"auth-routes","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w25
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363733450,"env":"test","module":"audit-log-service","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w25 (Reused: true)

{"level":30,"time":1768363733458,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363733499,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363733534,"env":"test","module":"user-credentials-repository","userId":"7a869f1b-5bcb-4098-99cf-2622befbd9a2","msg":"User credentials created"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w21
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w21 (Reused: true)

{"level":30,"time":1768363733608,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363733636,"env":"test","module":"auth-routes","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","msg":"All other sessions revoked"}
{"level":30,"time":1768363733650,"env":"test","module":"email-queue","jobId":"5a07cad4-9ebe-47e6-98e0-a7b26f9dd894","to":"protected-test-MvucJEOtNvQ1_OSVuJ6an@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363733651,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Status[2m > [22m[2mshould return backup codes count for MFA users
[22m[39m[TEST UTILS] MFA Secret verified for aed47f8fd77ab74e3faea9ebf027c664

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould update lastUsedAt on trusted device login
[22m[39m[TEST UTILS] MFA Secret verified for 8ba2c3d28051110495f2eda3d802a8ae

{"level":30,"time":1768363733690,"env":"test","module":"audit-log-service","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","eventType":"all_sessions_revoked","ipAddress":"::1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768363733694,"env":"test","module":"auth-service","tokenHash":"4d2ff50f3ea17c1c56666e94192266f39a512856e414edccb1e4795d1bd7a401","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363733702,"env":"test","module":"auth-routes","userId":"7a869f1b-5bcb-4098-99cf-2622befbd9a2","email":"protected-test-MvucJEOtNvQ1_OSVuJ6an@example.com","msg":"User registered"}
{"level":30,"time":1768363733742,"env":"test","module":"user-credentials-repository","userId":"43k715fTFSBGzFCwmFQx4","msg":"User credentials created"}
{"level":30,"time":1768363733794,"env":"test","module":"intake-service","runId":"784c7b1a-1585-4757-a395-870e70e879d1","slug":"hybrid-invalid-SMlGBKKATRj25qqfjN_pz","msg":"Created intake run"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Edge Cases[2m > [22m[2mshould handle multiple Authorization headers
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363733910,"env":"test","module":"auth-service","tokenHash":"0dacc4822691599d6452b8559ad0c250c0cb86dbea2bf93588e26008c7701958","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363733962,"env":"test","module":"auth-service","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","tokenHash":"0dacc4822691599d6452b8559ad0c250c0cb86dbea2bf93588e26008c7701958","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould update lastUsedAt on trusted device login
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Status[2m > [22m[2mshould return backup codes count for MFA users
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363734015,"env":"test","module":"auth-service","tokenHash":"6065de06db60ebad03acd5e33289c87cd9e1ef90d556dc68e8b50e61047aa2f5","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363734068,"env":"test","module":"auth-service","userId":"0252aa5c-2fe2-4c31-928c-033d0edb3b99","tokenHash":"6065de06db60ebad03acd5e33289c87cd9e1ef90d556dc68e8b50e61047aa2f5","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363734103,"env":"test","module":"user-credentials-repository","userId":"sy0idOtBNwK10XGZS4Y-i","msg":"User credentials created"}
{"level":50,"time":1768363734106,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363734186,"env":"test","module":"user-credentials-repository","userId":"7dceddb0-ccba-4c61-a196-4b3611f70abd","msg":"User credentials created"}
{"level":30,"time":1768363734198,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363734221,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363734208,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363734209,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363734214,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363734221,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363734221,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363734221,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363734221,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363734289,"env":"test","module":"email-queue","jobId":"007959cd-ba62-47ed-8f4a-1622613f64a7","to":"middleware-test-Uifgn178XWN-P6VAck0rO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w26
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363734342,"env":"test","module":"auth-routes","userId":"7dceddb0-ccba-4c61-a196-4b3611f70abd","email":"middleware-test-Uifgn178XWN-P6VAck0rO@example.com","msg":"User registered"}
{"level":30,"time":1768363734348,"env":"test","module":"auth-routes","userId":"7a869f1b-5bcb-4098-99cf-2622befbd9a2","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w26 (Reused: true)

[90mstderr[2m | tests/unit/services/AuthService.test.ts
[22m[39mâš ï¸ Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "closeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:140:34
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mCookie Strategy Security[2m > [22m[2mshould only allow safe methods for cookie auth
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363734399,"env":"test","module":"audit-log-service","userId":"7a869f1b-5bcb-4098-99cf-2622befbd9a2","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363734403,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363734451,"env":"test","module":"user-credentials-repository","userId":"68y2INlI4Ixv9nUmN2Q6w","msg":"User credentials created"}
{"level":30,"time":1768363734480,"env":"test","module":"auth-routes","userId":"8ba2c3d28051110495f2eda3d802a8ae","msg":"Login requires MFA verification"}
{"level":30,"time":1768363734481,"env":"test","module":"auth-routes","userId":"aed47f8fd77ab74e3faea9ebf027c664","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould handle user with single session gracefully
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363734519,"env":"test","module":"user-credentials-repository","userId":"d88ce032-7fd1-4134-ba5f-0515df59ae12","msg":"User credentials created"}
{"level":30,"time":1768363734560,"env":"test","module":"auth-routes","userId":"68y2INlI4Ixv9nUmN2Q6w","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":30,"time":1768363734586,"env":"test","module":"mfa-service","userId":"8ba2c3d28051110495f2eda3d802a8ae","msg":"TOTP verification successful"}
{"level":30,"time":1768363734627,"env":"test","module":"email-queue","jobId":"3865e93b-ae37-4d5e-bf1c-acc57ac282fb","to":"session-test-du01iK-xrH5XxbSFpbtho@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363734643,"env":"test","module":"auth-routes","userId":"8ba2c3d28051110495f2eda3d802a8ae","msg":"MFA login successful"}
{"level":30,"time":1768363734644,"env":"test","module":"mfa-service","userId":"aed47f8fd77ab74e3faea9ebf027c664","msg":"TOTP verification successful"}
{"level":30,"time":1768363734678,"env":"test","module":"auth-routes","userId":"d88ce032-7fd1-4134-ba5f-0515df59ae12","email":"session-test-du01iK-xrH5XxbSFpbtho@example.com","msg":"User registered"}
{"level":30,"time":1768363734706,"env":"test","module":"auth-routes","userId":"aed47f8fd77ab74e3faea9ebf027c664","msg":"MFA login successful"}
{"level":30,"time":1768363734706,"env":"test","module":"user-credentials-repository","userId":"875305d1-a25a-41f9-8a77-4be729a02cc6","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mDELETE /api/auth/sessions/all[2m > [22m[2mshould revoke all trusted devices
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363734799,"env":"test","module":"user-credentials-repository","userId":"868ea3ad-69f5-423f-bd57-7b47b3da67bb","msg":"User credentials created"}
{"level":30,"time":1768363734810,"env":"test","module":"auth-routes","userId":"8ba2c3d28051110495f2eda3d802a8ae","deviceFingerprint":"18e0dd8a369af6a2dfab7c513f89e7699b63e8eb7dbfc933a8238e91b2dbc1e4","msg":"Device marked as trusted"}
{"level":30,"time":1768363734811,"env":"test","module":"email-queue","jobId":"99f83e21-0588-4f11-9e32-f0ae01ca73bb","to":"test-fmHdDcQQNllpNuZCfx0fD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768363734873,"env":"test","module":"auth-routes","userId":"7dceddb0-ccba-4c61-a196-4b3611f70abd","msg":"User logged in successfully"}
{"level":30,"time":1768363734875,"env":"test","module":"auth-routes","userId":"875305d1-a25a-41f9-8a77-4be729a02cc6","email":"test-fmHdDcQQNllpNuZCfx0fD@example.com","msg":"User registered"}
{"level":30,"time":1768363734902,"env":"test","module":"email-queue","jobId":"550a56af-75e3-4498-bd36-38fc73053125","to":"protected-test-Cm2b5Mv_0dTZMn-kQSof4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363734923,"env":"test","module":"audit-log-service","userId":"7dceddb0-ccba-4c61-a196-4b3611f70abd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363734947,"env":"test","module":"user-credentials-repository","userId":"sqkekHespMPqKM1qypQcl","msg":"User credentials created"}
{"level":30,"time":1768363734960,"env":"test","module":"auth-routes","userId":"868ea3ad-69f5-423f-bd57-7b47b3da67bb","email":"protected-test-Cm2b5Mv_0dTZMn-kQSof4@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould update lastUsedAt on trusted device login
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363734972,"env":"test","module":"auth-routes","userId":"16c1c289975a815c8436647ab1b9f513","msg":"User logged in successfully"}
{"level":30,"time":1768363735034,"env":"test","module":"audit-log-service","userId":"16c1c289975a815c8436647ab1b9f513","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363735058,"env":"test","module":"auth-routes","userId":"sqkekHespMPqKM1qypQcl","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Edge Cases[2m > [22m[2mshould reject token with SQL injection attempt
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363735091,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mPhase: beforePage[2m > [22m[2mshould execute beforePage hook and capture console output
[22m[39mTEST SETUP: workflowId = a005db59-fee8-4f26-a913-4abd1f57d290

{"level":30,"time":1768363735192,"env":"test","module":"auth-routes","userId":"16c1c289975a815c8436647ab1b9f513","msg":"All other sessions revoked"}
{"level":30,"time":1768363735228,"env":"test","module":"auth-routes","userId":"sqkekHespMPqKM1qypQcl","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Trusted device expiry updated"}
{"level":30,"time":1768363735244,"env":"test","module":"audit-log-service","userId":"16c1c289975a815c8436647ab1b9f513","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768363735266,"env":"test","module":"auth-routes","userId":"d88ce032-7fd1-4134-ba5f-0515df59ae12","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w23
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363735313,"env":"test","module":"audit-log-service","userId":"d88ce032-7fd1-4134-ba5f-0515df59ae12","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363735321,"env":"test","module":"email-queue","jobId":"e6552482-9efb-49e9-bf15-1903fc74ff68","to":"org-member@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w23 (Reused: true)

{"level":30,"time":1768363735342,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363735363,"env":"test","module":"auth-routes","userId":"16c1c289975a815c8436647ab1b9f513","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363735382,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":50,"time":1768363735440,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"Failed to render template"}
{"level":30,"time":1768363735465,"env":"test","module":"auth-routes","userId":"d88ce032-7fd1-4134-ba5f-0515df59ae12","deviceFingerprint":"377ad01217b8c93ca52518d515505c47ab7553fab66d6fddaa60af67802c5a4c","msg":"Device marked as trusted"}
{"level":30,"time":1768363735483,"env":"test","module":"user-credentials-repository","userId":"59442b6d-71ba-4d9a-aa21-64d39421fa03","msg":"User credentials created"}
{"level":30,"time":1768363735504,"env":"test","module":"auth-routes","userId":"8ba2c3d28051110495f2eda3d802a8ae","msg":"Login from trusted device - MFA skipped"}
{"level":30,"time":1768363735557,"env":"test","module":"auth-routes","userId":"8ba2c3d28051110495f2eda3d802a8ae","msg":"User logged in successfully"}
{"level":30,"time":1768363735571,"env":"test","module":"email-queue","jobId":"9c1054df-b1f9-4add-9ca3-aee8be65b7e0","to":"audit-user2@test.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768363735587,"env":"test","module":"email-queue","jobId":"de76d597-fdcc-4a4d-ac3c-4e2d323e78c8","to":"middleware-test-f4JUsajo7Tkgxf7SZbyty@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363735606,"env":"test","hookId":"94f6f749-0208-4750-aaca-76d4d7db5bca","workflowId":"a005db59-fee8-4f26-a913-4abd1f57d290","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363735610,"env":"test","module":"audit-log-service","userId":"8ba2c3d28051110495f2eda3d802a8ae","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363735616,"env":"test","module":"user-credentials-repository","userId":"woxRLbb8b7VhTUWS2Ja2M","msg":"User credentials created"}
{"level":30,"time":1768363735617,"env":"test","module":"auth-routes","userId":"868ea3ad-69f5-423f-bd57-7b47b3da67bb","msg":"User logged in successfully"}
{"level":30,"time":1768363735624,"env":"test","module":"auth-routes","userId":"d88ce032-7fd1-4134-ba5f-0515df59ae12","msg":"All other sessions revoked"}
{"level":30,"time":1768363735640,"env":"test","module":"auth-routes","userId":"59442b6d-71ba-4d9a-aa21-64d39421fa03","email":"middleware-test-f4JUsajo7Tkgxf7SZbyty@example.com","msg":"User registered"}
{"level":30,"time":1768363735672,"env":"test","module":"audit-log-service","userId":"868ea3ad-69f5-423f-bd57-7b47b3da67bb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363735676,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363735678,"env":"test","module":"audit-log-service","userId":"d88ce032-7fd1-4134-ba5f-0515df59ae12","eventType":"all_sessions_revoked","ipAddress":"::1","hasMetadata":false,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mCookie Strategy Security[2m > [22m[2mshould ignore cookies when Bearer token present
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363735725,"env":"test","module":"auth-routes","userId":"woxRLbb8b7VhTUWS2Ja2M","deviceCount":2,"msg":"Listed trusted devices"}
{"level":40,"time":1768363735773,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363735780,"env":"test","module":"auth-routes","userId":"d88ce032-7fd1-4134-ba5f-0515df59ae12","deviceCount":0,"msg":"Listed trusted devices"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mPhase: beforePage[2m > [22m[2mshould execute beforePage hook with mutation mode enabled
[22m[39mTEST SETUP: workflowId = c1214011-81b4-43f4-bf02-852659979311

{"level":30,"time":1768363735921,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363735939,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts[2m > [22m[2mDataVault Table Permissions API (v4 Micro-Phase 6)
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363735929,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363735929,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363735934,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363735939,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363735939,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363735939,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363735939,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould disable MFA with password verification
[22m[39m[TEST UTILS] MFA Secret verified for 7e044fbf15d508752869c45f56e5c529

{"level":30,"time":1768363736061,"env":"test","module":"user-credentials-repository","userId":"RuB0xx1JEw5hjE3y4LoAK","msg":"User credentials created"}
{"level":30,"time":1768363736068,"env":"test","module":"user-credentials-repository","userId":"2c4879ea-d14d-4d47-982c-935c8da76bf6","msg":"User credentials created"}
{"level":30,"time":1768363736170,"env":"test","module":"email-queue","jobId":"1de88c80-1d7d-4de9-a29e-a4163bf0f506","to":"protected-test-_O08OJ8cO1UVR8Cl-udzY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363736176,"env":"test","module":"user-credentials-repository","userId":"b5729d83-f1e8-46c8-859a-3f5d30d97fc8","msg":"User credentials created"}
{"level":30,"time":1768363736175,"env":"test","module":"auth-routes","userId":"59442b6d-71ba-4d9a-aa21-64d39421fa03","msg":"User logged in successfully"}
{"level":30,"time":1768363736176,"env":"test","module":"auth-routes","userId":"RuB0xx1JEw5hjE3y4LoAK","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1768363736223,"env":"test","module":"auth-routes","userId":"2c4879ea-d14d-4d47-982c-935c8da76bf6","email":"protected-test-_O08OJ8cO1UVR8Cl-udzY@example.com","msg":"User registered"}
{"level":30,"time":1768363736229,"env":"test","module":"audit-log-service","userId":"59442b6d-71ba-4d9a-aa21-64d39421fa03","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould disable MFA with password verification
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363736279,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363736280,"env":"test","module":"email-queue","jobId":"7cbb5a72-47f8-45fa-b1c9-9c4b739259da","to":"session-test-8NhdKDZGHJeoeW5lSeCG4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363736279,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363736306,"env":"test","hookId":"89c87c59-a2b5-4a5e-b331-047fa44f3eff","workflowId":"c1214011-81b4-43f4-bf02-852659979311","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Edge Cases[2m > [22m[2mshould reject token with XSS attempt
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363736336,"env":"test","module":"auth-routes","userId":"b5729d83-f1e8-46c8-859a-3f5d30d97fc8","email":"session-test-8NhdKDZGHJeoeW5lSeCG4@example.com","msg":"User registered"}
 [32mâœ“[39m tests/integration/trusted.devices.real.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 37981[2mms[22m[39m
       [33m[2mâœ“[22m[39m should trust current device [33m 2466[2mms[22m[39m
       [33m[2mâœ“[22m[39m should set trust expiry to 30 days [33m 2292[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update expiry if device already trusted [33m 2658[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list all trusted devices [33m 4006[2mms[22m[39m
       [33m[2mâœ“[22m[39m should mark current device [33m 2329[2mms[22m[39m
       [33m[2mâœ“[22m[39m should exclude revoked devices [33m 2389[2mms[22m[39m
       [33m[2mâœ“[22m[39m should exclude expired devices [33m 2404[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke specific device [33m 2630[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 404 for non-existent device [33m 2152[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent revoking other user's device [33m 4591[2mms[22m[39m
       [33m[2mâœ“[22m[39m should skip MFA for trusted device [33m 3063[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require MFA for untrusted device [33m 2848[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update lastUsedAt on trusted device login [33m 3088[2mms[22m[39m
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mSession Security[2m > [22m[2mshould include device metadata in sessions
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363736439,"env":"test","module":"user-credentials-repository","userId":"8cb6217a-cff0-4d83-9889-edf421f18cae","msg":"User credentials created"}
{"level":50,"time":1768363736448,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768363736465,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mPhase: beforePage[2m > [22m[2mshould handle errors gracefully without breaking workflow
[22m[39mTEST SETUP: workflowId = 0523a9c4-b38e-42e3-b82d-2f2e584dc8b4

{"level":30,"time":1768363736539,"env":"test","module":"user-credentials-repository","userId":"ld_C4-96mXzeAjHa1Bemd","msg":"User credentials created"}
{"level":30,"time":1768363736547,"env":"test","module":"email-queue","jobId":"354d7d15-3313-490e-b6e5-71c0af79993e","to":"test-CI4iTAZ9XmkMvE_oua6As@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363736604,"env":"test","module":"auth-routes","userId":"8cb6217a-cff0-4d83-9889-edf421f18cae","email":"test-CI4iTAZ9XmkMvE_oua6As@example.com","msg":"User registered"}
{"level":30,"time":1768363736666,"env":"test","module":"user-credentials-repository","userId":"ad9f4977-f05a-444b-8ebe-f191e64fe88c","msg":"User credentials created"}
{"level":30,"time":1768363736696,"env":"test","module":"auth-routes","userId":"ld_C4-96mXzeAjHa1Bemd","deviceId":"8467dfe1-d44a-4e46-a806-bc24dd91b7c0","msg":"Trusted device revoked"}
{"level":30,"time":1768363736720,"env":"test","module":"email-queue","jobId":"1459b5f5-8aef-4384-9806-32cf01f56501","to":"email-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768363736766,"env":"test","module":"email-queue","jobId":"60385802-0c2b-4d4f-b4e7-f312476b24d1","to":"cookie-test-xcTHO0sKMLRzSmxBsbtN2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363736774,"env":"test","module":"auth-routes","userId":"7e044fbf15d508752869c45f56e5c529","msg":"Login requires MFA verification"}
{"level":30,"time":1768363736816,"env":"test","module":"auth-routes","userId":"ad9f4977-f05a-444b-8ebe-f191e64fe88c","email":"cookie-test-xcTHO0sKMLRzSmxBsbtN2@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768363736868,"env":"test","module":"user-credentials-repository","userId":"f391b825-4097-49fb-b67d-a75ceb929bf5","msg":"User credentials created"}
{"level":30,"time":1768363736872,"env":"test","module":"auth-routes","userId":"2c4879ea-d14d-4d47-982c-935c8da76bf6","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mCookie Strategy Security[2m > [22m[2mshould ignore cookies when Bearer token present
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363736884,"env":"test","module":"mfa-service","userId":"7e044fbf15d508752869c45f56e5c529","msg":"TOTP verification successful"}
{"level":30,"time":1768363736899,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363736899,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363736923,"env":"test","module":"audit-log-service","userId":"2c4879ea-d14d-4d47-982c-935c8da76bf6","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363736928,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363736937,"env":"test","module":"auth-routes","userId":"7e044fbf15d508752869c45f56e5c529","msg":"MFA login successful"}
{"level":30,"time":1768363736936,"env":"test","module":"auth-routes","userId":"be55760379600f9f3f84852495ff8336","msg":"User logged in successfully"}
 [32mâœ“[39m tests/integration/organizationService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 12610[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create organization and auto-create admin membership [33m 1016[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return all organizations for user [33m 731[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return empty array for user with no memberships [33m 361[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow admin to update organization [33m 779[2mms[22m[39m
       [33m[2mâœ“[22m[39m should deny non-admin from updating organization [33m 745[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return all members of organization [33m 874[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow admin to promote member [33m 1148[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow admin to demote other admin [33m 1174[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent self-demotion [33m 738[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow admin to remove member [33m 1180[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent self-removal [33m 722[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow member to leave organization [33m 1025[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow admin to leave organization [33m 1093[2mms[22m[39m
{"level":30,"time":1768363736966,"env":"test","hookId":"e88466b9-43d6-4fa2-9376-0015def0c6eb","workflowId":"0523a9c4-b38e-42e3-b82d-2f2e584dc8b4","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363736967,"env":"test","module":"email-queue","jobId":"b2bd0f54-b036-4873-a72c-cf4b75044f82","to":"session-test-gmTNJACpNb0rOt8MdMrVj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363736991,"env":"test","module":"audit-log-service","userId":"be55760379600f9f3f84852495ff8336","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363737025,"env":"test","module":"auth-routes","userId":"f391b825-4097-49fb-b67d-a75ceb929bf5","email":"session-test-gmTNJACpNb0rOt8MdMrVj@example.com","msg":"User registered"}
{"level":30,"time":1768363737082,"env":"test","module":"user-credentials-repository","userId":"QO0R8QA4UyQdW3Ir45Grq","msg":"User credentials created"}
{"level":30,"time":1768363737095,"env":"test","module":"auth-routes","userId":"be55760379600f9f3f84852495ff8336","sessionCount":1,"msg":"Listed active sessions"}
{"level":40,"time":1768363737127,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mSession Expiration[2m > [22m[2mshould reject refresh token after 30 days
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363737162,"env":"test","module":"user-credentials-repository","userId":"f6273215-6b23-4310-8f85-4426cbbe9e09","msg":"User credentials created"}
{"level":40,"time":1768363737190,"env":"test","hookId":"e88466b9-43d6-4fa2-9376-0015def0c6eb","hookName":"Error Hook","error":"SandboxError: Intentional test error","msg":"LifecycleHookService: Hook execution failed"}
{"level":30,"time":1768363737217,"env":"test","workflowId":"d894fd15-5df3-4ff5-870c-55f709e7f0fe","userId":"62c4eae3-0188-420a-acdd-e5f1a88ca211","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mPhase: afterPage[2m > [22m[2mshould execute afterPage hook with user input data
[22m[39mTEST SETUP: workflowId = f5e0ca85-874a-429c-b13f-89e7fad9e63d

{"level":30,"time":1768363737259,"env":"test","module":"email-queue","jobId":"d52a5322-cf69-4a17-99cd-3354c3d352ca","to":"test-jy0zjmj_8_z3NUCRZzQEE@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768363737315,"env":"test","module":"auth-routes","userId":"f6273215-6b23-4310-8f85-4426cbbe9e09","email":"test-jy0zjmj_8_z3NUCRZzQEE@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363737334,"env":"test","module":"user-credentials-repository","userId":"295fad3e-cbf9-42a8-803e-f4e2ac76d06b","msg":"User credentials created"}
 [32mâœ“[39m tests/unit/services/PdfQueueService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 12709[2mms[22m[39m
       [33m[2mâœ“[22m[39m should enqueue a PDF conversion job [33m 745[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create output with empty storagePath initially [33m 725[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return job status for pending job [33m 691[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return null for non-existent job [33m 651[2mms[22m[39m
       [33m[2mâœ“[22m[39m should parse attempt count from error field [33m 700[2mms[22m[39m
       [33m[2mâœ“[22m[39m should convert DOCX to PDF immediately [33m 769[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle conversion errors gracefully [33m 696[2mms[22m[39m
       [33m[2mâœ“[22m[39m should start and stop service [33m 919[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not start if already running [33m 596[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle stop when not running [33m 594[2mms[22m[39m
       [33m[2mâœ“[22m[39m should process pending jobs when queue is processed [33m 1005[2mms[22m[39m
       [33m[2mâœ“[22m[39m should process multiple jobs in batch [33m 1290[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle missing DOCX output gracefully [33m 809[2mms[22m[39m
       [33m[2mâœ“[22m[39m should support enqueue within transaction [33m 784[2mms[22m[39m
       [33m[2mâœ“[22m[39m should support convertImmediate within transaction [33m 750[2mms[22m[39m
{"level":30,"time":1768363737379,"env":"test","module":"auth-routes","userId":"ad9f4977-f05a-444b-8ebe-f191e64fe88c","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts[2m > [22m[2mDataVault Table Permissions API (v4 Micro-Phase 6)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363737388,"env":"test","module":"email-queue","jobId":"0c86613d-6a6a-4825-b86d-fa431bf6a52e","to":"expired-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363737435,"env":"test","module":"audit-log-service","userId":"ad9f4977-f05a-444b-8ebe-f191e64fe88c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363737438,"env":"test","module":"user-credentials-repository","userId":"hWEvhULjU0FthwX_A03Wy","msg":"User credentials created"}
{"level":30,"time":1768363737440,"env":"test","module":"email-queue","jobId":"f5064747-416e-4ac8-89e0-f85a7a398b82","to":"protected-test-FHNDnjlW3IP-dKXV6ppYD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363737492,"env":"test","module":"mfa-service","userId":"7e044fbf15d508752869c45f56e5c529","msg":"MFA disabled"}
{"level":30,"time":1768363737492,"env":"test","module":"auth-routes","userId":"295fad3e-cbf9-42a8-803e-f4e2ac76d06b","email":"protected-test-FHNDnjlW3IP-dKXV6ppYD@example.com","msg":"User registered"}
{"level":30,"time":1768363737492,"env":"test","module":"auth-routes","userId":"7e044fbf15d508752869c45f56e5c529","msg":"MFA disabled by user"}
{"level":30,"time":1768363737540,"env":"test","module":"audit-log-service","userId":"7e044fbf15d508752869c45f56e5c529","eventType":"mfa_disabled","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Payload Validation[2m > [22m[2mshould reject token with missing userId
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363737614,"env":"test","workflowId":"d894fd15-5df3-4ff5-870c-55f709e7f0fe","userId":"40de0889-36d0-44e0-a841-c7860ddac014","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould disable MFA with password verification
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363737685,"env":"test","module":"auth-routes","userId":"f391b825-4097-49fb-b67d-a75ceb929bf5","msg":"User logged in successfully"}
{"level":30,"time":1768363737686,"env":"test","hookId":"7cf23c63-23a9-4c93-b5fb-2d3519509d9f","workflowId":"f5e0ca85-874a-429c-b13f-89e7fad9e63d","phase":"afterPage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363737734,"env":"test","module":"audit-log-service","userId":"f391b825-4097-49fb-b67d-a75ceb929bf5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

{"level":30,"time":1768363737841,"env":"test","module":"auth-service","tokenHash":"456a7167f2815c83088f825999aefb68f6295a794b6f3c1b68caf22b6f018448","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363737892,"env":"test","module":"auth-service","userId":"f391b825-4097-49fb-b67d-a75ceb929bf5","msg":"Security: Expired refresh token used"}
{"level":40,"time":1768363737902,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363737932,"env":"test","module":"user-credentials-repository","userId":"zsS-K2_T9rxj7xXdWidgJ","msg":"User credentials created"}
{"level":30,"time":1768363737943,"env":"test","module":"auth-routes","userId":"f6273215-6b23-4310-8f85-4426cbbe9e09","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mPhase: beforeFinalBlock[2m > [22m[2mshould execute beforeFinalBlock hook before document generation
[22m[39mTEST SETUP: workflowId = 9f397da7-54c6-4b95-ae7f-2d47412d425a

{"level":30,"time":1768363737960,"env":"test","module":"user-credentials-repository","userId":"914a19c2-703b-4c32-830e-490b8abddc00","msg":"User credentials created"}
{"level":30,"time":1768363738009,"env":"test","module":"audit-log-service","userId":"f6273215-6b23-4310-8f85-4426cbbe9e09","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363738039,"env":"test","module":"email-queue","jobId":"4b6f822a-defd-4ca3-ac34-fe897919d35a","to":"expired-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768363738052,"env":"test","module":"email-queue","jobId":"2b2159fa-57bf-4060-be0b-ade32f70aa06","to":"middleware-test-uitnVkZF0n0avcDEXpkPt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363738102,"env":"test","module":"auth-routes","userId":"914a19c2-703b-4c32-830e-490b8abddc00","email":"middleware-test-uitnVkZF0n0avcDEXpkPt@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mUser Context Attachment[2m > [22m[2mshould attach userId to request
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363738182,"env":"test","module":"auth-routes","userId":"295fad3e-cbf9-42a8-803e-f4e2ac76d06b","msg":"User logged in successfully"}
{"level":30,"time":1768363738186,"env":"test","module":"auth-routes","userId":"7e044fbf15d508752869c45f56e5c529","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mSession Security[2m > [22m[2mshould not expose sensitive token data
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363738235,"env":"test","module":"audit-log-service","userId":"7e044fbf15d508752869c45f56e5c529","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363738235,"env":"test","module":"audit-log-service","userId":"295fad3e-cbf9-42a8-803e-f4e2ac76d06b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363738295,"env":"test","module":"user-credentials-repository","userId":"ed29639b-c1a4-4d68-8be8-a4039b623da5","msg":"User credentials created"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363738378,"env":"test","module":"user-credentials-repository","userId":"bcz8p0wrZnrbF5s0krTc8","msg":"User credentials created"}
{"level":30,"time":1768363738388,"env":"test","hookId":"92f787bb-80c0-4ff8-bdf9-a164dafd97f8","workflowId":"9f397da7-54c6-4b95-ae7f-2d47412d425a","phase":"beforeFinalBlock","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363738395,"env":"test","module":"email-queue","jobId":"5412cc9c-9831-4b7a-b818-690a0c6ccde7","to":"session-test-NUKC3-x9SvUREoOjLRIGC@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363738409,"env":"test","module":"user-credentials-repository","userId":"2dd8064d-061f-4c69-8dfa-465c9bc616b8","msg":"User credentials created"}
{"level":30,"time":1768363738444,"env":"test","module":"auth-routes","userId":"ed29639b-c1a4-4d68-8be8-a4039b623da5","email":"session-test-NUKC3-x9SvUREoOjLRIGC@example.com","msg":"User registered"}
{"level":30,"time":1768363738512,"env":"test","module":"email-queue","jobId":"db04c798-6d33-4bb6-a3cc-6e45ab459bf9","to":"test-9kD3KntApk_SMkEbzPfRX@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mConcurrent Session Handling[2m > [22m[2mshould handle multiple concurrent logins
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mConcurrent Session Handling[2m > [22m[2mshould handle multiple concurrent logins
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mConcurrent Session Handling[2m > [22m[2mshould handle multiple concurrent logins
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363738549,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363738561,"env":"test","module":"auth-routes","userId":"2dd8064d-061f-4c69-8dfa-465c9bc616b8","email":"test-9kD3KntApk_SMkEbzPfRX@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363738583,"env":"test","module":"auth-service","tokenHash":"858fe93530025190caf7b3cf7dbbc869348ecb927217864af31f260f94886653","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mPhase: afterDocumentsGenerated[2m > [22m[2mshould execute afterDocumentsGenerated hook for cleanup
[22m[39mTEST SETUP: workflowId = c1989518-8545-4b12-8a51-2c7e03eeca9b

[90mstdout[2m | tests/integration/datavault.permissions.test.ts[2m > [22m[2mDataVault Table Permissions API (v4 Micro-Phase 6)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363738633,"env":"test","module":"auth-routes","userId":"914a19c2-703b-4c32-830e-490b8abddc00","msg":"User logged in successfully"}
{"level":30,"time":1768363738633,"env":"test","module":"user-credentials-repository","userId":"751c42d2-613d-459c-94e5-86d66ed684a1","msg":"User credentials created"}
{"level":30,"time":1768363738684,"env":"test","module":"audit-log-service","userId":"914a19c2-703b-4c32-830e-490b8abddc00","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363738695,"env":"test","module":"auth-routes","userId":"cba6322b6fa33d2a98fb8e8b8545e4ad","msg":"User logged in successfully"}
{"level":30,"time":1768363738736,"env":"test","module":"email-queue","jobId":"41602a6e-f038-48b0-a6a9-3e6b87b1da96","to":"protected-test-865Ztm_R-BU2qyPcEnNDs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363738746,"env":"test","module":"audit-log-service","userId":"cba6322b6fa33d2a98fb8e8b8545e4ad","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w28
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363738784,"env":"test","module":"auth-routes","userId":"751c42d2-613d-459c-94e5-86d66ed684a1","email":"protected-test-865Ztm_R-BU2qyPcEnNDs@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w28 (Reused: true)

{"level":30,"time":1768363738817,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363738846,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363738847,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363738857,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363738868,"env":"test","module":"auth-routes","userId":"cba6322b6fa33d2a98fb8e8b8545e4ad","sessionCount":1,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mToken Payload Validation[2m > [22m[2mshould reject token with non-existent userId
[22m[39mDEBUG: LOGIN HANDLER HIT

 [32mâœ“[39m tests/integration/auth/oauth2.sessions.test.ts [2m([22m[2m25 tests[22m[2m)[22m[33m 14190[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list all active sessions for current user [33m 593[2mms[22m[39m
       [33m[2mâœ“[22m[39m should mark current session as current [33m 466[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return empty array when user has no active sessions [33m 494[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not include expired sessions [33m 471[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not include revoked sessions [33m 546[2mms[22m[39m
       [33m[2mâœ“[22m[39m should parse device name from user agent [33m 534[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 for unauthenticated request [33m 380[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke a specific session [33m 654[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 404 for non-existent session [33m 378[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent revoking current session [33m 513[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent revoking another user's session [33m 602[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 for unauthenticated request [33m 361[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke all sessions except current [33m 983[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke all trusted devices [33m 692[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 400 when no active session found [33m 345[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 for unauthenticated request [33m 361[2mms[22m[39m
         [33m[2mâœ“[22m[39m should mark current device as trusted [33m 511[2mms[22m[39m
         [33m[2mâœ“[22m[39m should update existing trusted device expiry [33m 663[2mms[22m[39m
         [33m[2mâœ“[22m[39m should list all trusted devices [33m 446[2mms[22m[39m
         [33m[2mâœ“[22m[39m should not include revoked devices [33m 450[2mms[22m[39m
         [33m[2mâœ“[22m[39m should revoke a trusted device [33m 576[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return 404 for non-existent device [33m 334[2mms[22m[39m
       [33m[2mâœ“[22m[39m should track IP address for sessions [33m 469[2mms[22m[39m
       [33m[2mâœ“[22m[39m should track user agent for sessions [33m 485[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update lastUsedAt on token refresh [33m 804[2mms[22m[39m
{"level":30,"time":1768363739021,"env":"test","module":"auth-routes","userId":"ed29639b-c1a4-4d68-8be8-a4039b623da5","msg":"User logged in successfully"}
{"level":30,"time":1768363739025,"env":"test","hookId":"89b7455f-a6cf-41a3-9c51-86cf8c8ae985","workflowId":"c1989518-8545-4b12-8a51-2c7e03eeca9b","phase":"afterDocumentsGenerated","msg":"LifecycleHookService: Created lifecycle hook"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts[2m > [22m[2mAuthService[2m > [22m[2mJWT Token Management[2m > [22m[2mverifyToken()[2m > [22m[2mshould throw error for invalid token signature
[22m[39mDEBUG: verifyToken threw: Invalid or malformed token InvalidTokenError

{"level":30,"time":1768363739072,"env":"test","module":"audit-log-service","userId":"ed29639b-c1a4-4d68-8be8-a4039b623da5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363739132,"env":"test","module":"auth-routes","userId":"2dd8064d-061f-4c69-8dfa-465c9bc616b8","msg":"User logged in successfully"}
{"level":40,"time":1768363739184,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363739186,"env":"test","module":"audit-log-service","userId":"2dd8064d-061f-4c69-8dfa-465c9bc616b8","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363739210,"env":"test","module":"user-credentials-repository","userId":"67ba309d-1ffa-4b19-920f-d243a144b296","msg":"User credentials created"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mTimeout Enforcement[2m > [22m[2mshould timeout hook that exceeds timeoutMs limit
[22m[39mTEST SETUP: workflowId = 6dccd710-db95-43fe-8565-4aedc206aebb

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould require correct password to disable MFA
[22m[39m[TEST UTILS] MFA Secret verified for 8a0e7033710d47506de4fa4f4e9688b9

{"level":30,"time":1768363739312,"env":"test","module":"email-queue","jobId":"dc50b945-57db-44ce-978f-db4e34c8c333","to":"middleware-test-ktcU0GjyQoAx9wKA96rf4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363739321,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768363739325,"env":"test","module":"auth-routes","userId":"ed29639b-c1a4-4d68-8be8-a4039b623da5","msg":"User logged in successfully"}
{"level":30,"time":1768363739325,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768363739364,"env":"test","module":"auth-routes","userId":"67ba309d-1ffa-4b19-920f-d243a144b296","email":"middleware-test-ktcU0GjyQoAx9wKA96rf4@example.com","msg":"User registered"}
{"level":30,"time":1768363739364,"env":"test","module":"auth-service","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363739381,"env":"test","module":"audit-log-service","userId":"ed29639b-c1a4-4d68-8be8-a4039b623da5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363739384,"env":"test","module":"auth-routes","userId":"ed29639b-c1a4-4d68-8be8-a4039b623da5","msg":"User logged in successfully"}
{"level":30,"time":1768363739371,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","plainTokenLen":13,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363739371,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used (Not Found in DB)"}
{"level":30,"time":1768363739371,"env":"test","module":"auth-service","allTokensCount":0,"msg":"DEBUG: Tokens in DB"}
{"level":30,"time":1768363739373,"env":"test","module":"auth-service","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363739373,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363739376,"env":"test","module":"auth-service","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":40,"time":1768363739376,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1768363739386,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768363739388,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768363739390,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768363739392,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mUser Context Attachment[2m > [22m[2mshould attach userEmail to request
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363739431,"env":"test","module":"audit-log-service","userId":"ed29639b-c1a4-4d68-8be8-a4039b623da5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363739445,"env":"test","module":"auth-routes","userId":"751c42d2-613d-459c-94e5-86d66ed684a1","msg":"User logged in successfully"}
{"level":30,"time":1768363739497,"env":"test","module":"audit-log-service","userId":"751c42d2-613d-459c-94e5-86d66ed684a1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould require correct password to disable MFA
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363739603,"env":"test","module":"user-credentials-repository","userId":"05981fef-a509-4295-b1d2-16e1f47d21b4","msg":"User credentials created"}
{"level":30,"time":1768363739613,"env":"test","workflowId":"d894fd15-5df3-4ff5-870c-55f709e7f0fe","userId":"62c4eae3-0188-420a-acdd-e5f1a88ca211","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363739674,"env":"test","hookId":"d1aec6ef-d329-41c4-b3c5-b2e0c4def03a","workflowId":"6dccd710-db95-43fe-8565-4aedc206aebb","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363739700,"env":"test","module":"email-queue","jobId":"9560a826-fdf1-4168-adc8-ade5ff58849c","to":"test-RfkPzXoAiLG4OKX41z83b@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363739747,"env":"test","module":"auth-routes","userId":"05981fef-a509-4295-b1d2-16e1f47d21b4","email":"test-RfkPzXoAiLG4OKX41z83b@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts[2m > [22m[2mDataVault Table Permissions API (v4 Micro-Phase 6)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363739835,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363739906,"env":"test","module":"auth-routes","userId":"67ba309d-1ffa-4b19-920f-d243a144b296","msg":"User logged in successfully"}
{"level":30,"time":1768363739910,"env":"test","module":"user-credentials-repository","userId":"0462ed9c-57e1-42c6-bf92-766a623b3a11","msg":"User credentials created"}
[90mstdout[2m | tests/integration/session.management.real.test.ts[2m > [22m[2mSession Management Integration Tests (REAL)[2m > [22m[2mSession Security[2m > [22m[2mshould track session activity timestamps
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363739962,"env":"test","module":"audit-log-service","userId":"67ba309d-1ffa-4b19-920f-d243a144b296","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768363739992,"env":"test","hookId":"d1aec6ef-d329-41c4-b3c5-b2e0c4def03a","hookName":"Timeout Test","error":"TimeoutError: Execution exceeded time limit","msg":"LifecycleHookService: Hook execution failed"}
{"level":30,"time":1768363740009,"env":"test","module":"user-credentials-repository","userId":"d5339201-5a0b-4b97-ac7a-09179d592957","msg":"User credentials created"}
{"level":30,"time":1768363740010,"env":"test","module":"email-queue","jobId":"f07c74a5-3c37-45ca-b2a7-95eca1bc4989","to":"session-test-QMW7xz8lz_tmYwAbsWHE6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363740037,"env":"test","workflowId":"f83d5e50-64bc-40f6-84b3-835cc3db0e71","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mMultiple Hooks Execution Order[2m > [22m[2mshould execute multiple hooks in correct order
[22m[39mTEST SETUP: workflowId = 1ebce753-5a35-4b27-a536-d5c044777e25

{"level":30,"time":1768363740059,"env":"test","module":"auth-routes","userId":"0462ed9c-57e1-42c6-bf92-766a623b3a11","email":"session-test-QMW7xz8lz_tmYwAbsWHE6@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w27
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363740107,"env":"test","module":"email-queue","jobId":"dee5040b-24b8-4b9c-98be-5f8074c6974b","to":"protected-test-CS6T82e2xa4ts6QZ0utrz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w27 (Reused: true)

{"level":30,"time":1768363740121,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363740132,"env":"test","module":"auth-routes","userId":"8a0e7033710d47506de4fa4f4e9688b9","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts[2m > [22m[2mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22m[2mshould create draft version on successful AI edit
[22m[39mDEBUG: Instantiating GoogleGenerativeAI
DEBUG: Getting model
DEBUG: Building system prompt
DEBUG: Building workflow context
DEBUG: Workflow context built
DEBUG: About to build full prompt. Parts: { s: [32m'string'[39m, w: [32m'string'[39m, u: [32m'string'[39m }
DEBUG: Full prompt built. Length: [33m4128[39m

{"level":30,"time":1768363740158,"env":"test","module":"email-queue","jobId":"953e7ed6-9615-4a0e-9cf0-fa1060ab1e4d","to":"duplicate@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
{"level":30,"time":1768363740158,"env":"test","module":"auth-routes","userId":"d5339201-5a0b-4b97-ac7a-09179d592957","email":"protected-test-CS6T82e2xa4ts6QZ0utrz@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests[2m > [22m[2mConcurrent Session Handling[2m > [22m[2mshould handle concurrent token refreshes
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363740169,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363740234,"env":"test","module":"mfa-service","userId":"8a0e7033710d47506de4fa4f4e9688b9","msg":"TOTP verification successful"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mCross-User Authorization[2m > [22m[2mshould not allow user to access another user's resources
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363740281,"env":"test","module":"auth-routes","userId":"8a0e7033710d47506de4fa4f4e9688b9","msg":"MFA login successful"}
{"level":30,"time":1768363740355,"env":"test","module":"auth-routes","userId":"05981fef-a509-4295-b1d2-16e1f47d21b4","msg":"User logged in successfully"}
{"level":30,"time":1768363740368,"env":"test","module":"email-queue","jobId":"1b4bdc16-3456-4d77-bd18-35af0db30a59","to":"placeholder-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768363740405,"env":"test","module":"audit-log-service","userId":"05981fef-a509-4295-b1d2-16e1f47d21b4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363740452,"env":"test","module":"auth-routes","userId":"d3235ade7db64f31296a3a8f1a5e0998","msg":"User logged in successfully"}
{"level":30,"time":1768363740478,"env":"test","hookId":"9cb51a25-9185-4cae-91ae-959a9420ce6d","workflowId":"1ebce753-5a35-4b27-a536-d5c044777e25","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363740488,"env":"test","module":"user-credentials-repository","userId":"ee5c6db5-fbef-42ec-8d08-6b144f824e2a","msg":"User credentials created"}
{"level":30,"time":1768363740504,"env":"test","module":"audit-log-service","userId":"d3235ade7db64f31296a3a8f1a5e0998","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363740529,"env":"test","workflowId":"f83d5e50-64bc-40f6-84b3-835cc3db0e71","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":1,"stepsCount":1,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363740589,"env":"test","module":"email-queue","jobId":"381e5a53-63e5-47d5-869a-23be45dce3fb","to":"middleware-test-eAURUgK3pZhiKZlTDEEHE@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363740612,"env":"test","module":"auth-routes","userId":"d3235ade7db64f31296a3a8f1a5e0998","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768363740647,"env":"test","module":"auth-routes","userId":"ee5c6db5-fbef-42ec-8d08-6b144f824e2a","email":"middleware-test-eAURUgK3pZhiKZlTDEEHE@example.com","msg":"User registered"}
{"level":30,"time":1768363740652,"env":"test","module":"auth-routes","userId":"0462ed9c-57e1-42c6-bf92-766a623b3a11","msg":"User logged in successfully"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return consistent error format for missing token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363740705,"env":"test","module":"audit-log-service","userId":"0462ed9c-57e1-42c6-bf92-766a623b3a11","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363740709,"env":"test","module":"auth-service","tokenHash":"ea3487f01869aef9a5c227dd8861450f9d4868f08904840a0f6a7c5d52549940","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363740746,"env":"test","module":"version-service","workflowId":"f83d5e50-64bc-40f6-84b3-835cc3db0e71","versionId":"4f398a76-8ef2-4507-a425-10d3dba5428d","userId":"dff24424-c365-4cbc-b36f-77400955dfef","versionNumber":1,"msg":"Created draft version"}
{"level":30,"time":1768363740747,"env":"test","hookId":"1f08a91f-8257-4b53-9c65-02ac4b5e9524","workflowId":"1ebce753-5a35-4b27-a536-d5c044777e25","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363740804,"env":"test","module":"auth-routes","userId":"d5339201-5a0b-4b97-ac7a-09179d592957","msg":"User logged in successfully"}
{"level":30,"time":1768363740830,"env":"test","module":"user-credentials-repository","userId":"1a57e699-7260-48e9-94b4-6ce09ce67eb6","msg":"User credentials created"}
{"level":30,"time":1768363740855,"env":"test","module":"audit-log-service","userId":"d5339201-5a0b-4b97-ac7a-09179d592957","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363740858,"env":"test","module":"ai-workflow-edit-routes","workflowId":"f83d5e50-64bc-40f6-84b3-835cc3db0e71","versionId":"4f398a76-8ef2-4507-a425-10d3dba5428d","opsCount":2,"msg":"AI edit completed"}
{"level":30,"time":1768363740913,"env":"test","module":"auth-service","tokenHash":"ea3487f01869aef9a5c227dd8861450f9d4868f08904840a0f6a7c5d52549940","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363740931,"env":"test","module":"email-queue","jobId":"f2174545-ea61-49e2-bce3-056c80a90960","to":"test-6NrPLQACOE6LVtzl1z1DG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768363740960,"env":"test","module":"auth-service","userId":"0462ed9c-57e1-42c6-bf92-766a623b3a11","tokenHash":"ea3487f01869aef9a5c227dd8861450f9d4868f08904840a0f6a7c5d52549940","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363740963,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363740983,"env":"test","module":"auth-routes","userId":"1a57e699-7260-48e9-94b4-6ce09ce67eb6","email":"test-6NrPLQACOE6LVtzl1z1DG@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #8: Placeholder user cleanup[2m > [22m[2mshould cleanup placeholder user when invite is revoked
[22m[39mCleaned up placeholder user ead8398a-dfba-478e-bb8a-2a8d63ef9ded (no pending invites or memberships)

{"level":30,"time":1768363741017,"env":"test","module":"auth-service","tokenHash":"8c5ee9956e7e3adc51348519047a011de2e1c6c78bcb715910fffb4706cf1049","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363741018,"env":"test","hookId":"88dace88-52d5-4b47-9a15-322a5f2fdcb2","workflowId":"1ebce753-5a35-4b27-a536-d5c044777e25","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts[2m > [22m[2mDataVault Table Permissions API (v4 Micro-Phase 6)
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":40,"time":1768363741065,"env":"test","module":"auth-service","userId":"0462ed9c-57e1-42c6-bf92-766a623b3a11","tokenHash":"8c5ee9956e7e3adc51348519047a011de2e1c6c78bcb715910fffb4706cf1049","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768363741070,"env":"test","module":"email-queue","jobId":"427dfd83-3590-4a85-8db5-c64fd5bb5422","to":"expired@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
{"level":30,"time":1768363741139,"env":"test","workflowId":"74390b22-8755-4dc4-b374-9688845ff140","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":40,"time":1768363741173,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363741185,"env":"test","module":"auth-routes","userId":"ee5c6db5-fbef-42ec-8d08-6b144f824e2a","msg":"User logged in successfully"}
{"level":40,"time":1768363741230,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363741231,"env":"test","module":"audit-log-service","userId":"ee5c6db5-fbef-42ec-8d08-6b144f824e2a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363741236,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363741250,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts[2m > [22m[2mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22m[2mshould enforce draft mode (revert active workflow to draft)
[22m[39mDEBUG: Instantiating GoogleGenerativeAI
DEBUG: Getting model
DEBUG: Building system prompt
DEBUG: Building workflow context
DEBUG: Workflow context built
DEBUG: About to build full prompt. Parts: { s: [32m'string'[39m, w: [32m'string'[39m, u: [32m'string'[39m }
DEBUG: Full prompt built. Length: [33m4099[39m

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363741251,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363741252,"env":"test","module":"user-credentials-repository","userId":"cc29f27b-95dd-4545-8b94-c109171fa6c1","msg":"User credentials created"}
{"level":40,"time":1768363741293,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363741349,"env":"test","module":"email-queue","jobId":"3516ac5f-651c-4cc1-a25c-46212a339329","to":"user2-VK5EAkyCP0_CAdpHlJOTG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mâœ“[39m tests/integration/session.management.real.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 42953[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list all active sessions for current user [33m 3153[2mms[22m[39m
       [33m[2mâœ“[22m[39m should mark current session correctly [33m 2397[2mms[22m[39m
       [33m[2mâœ“[22m[39m should exclude revoked sessions [33m 2484[2mms[22m[39m
       [33m[2mâœ“[22m[39m should order sessions by last used (most recent first) [33m 3085[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter sessions by current user only [33m 3839[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke specific session [33m 2533[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent revoking current session [33m 1792[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 404 for non-existent session [33m 1642[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent revoking other user's session [33m 3400[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke all other sessions [33m 3689[2mms[22m[39m
       [33m[2mâœ“[22m[39m should keep current session active [33m 2818[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 400 if no active session found [33m 1745[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke all trusted devices [33m 2114[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle user with single session gracefully [33m 1922[2mms[22m[39m
       [33m[2mâœ“[22m[39m should include device metadata in sessions [33m 1743[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not expose sensitive token data [33m 1763[2mms[22m[39m
       [33m[2mâœ“[22m[39m should track session activity timestamps [33m 1744[2mms[22m[39m
{"level":30,"time":1768363741385,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363741386,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363741400,"env":"test","module":"auth-routes","userId":"cc29f27b-95dd-4545-8b94-c109171fa6c1","email":"user2-VK5EAkyCP0_CAdpHlJOTG@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mHook Management API[2m > [22m[2mshould list all hooks for a workflow
[22m[39mTEST SETUP: workflowId = 49d9212c-b65f-41a7-99ab-f3c9cc7f8c10

{"level":30,"time":1768363741466,"env":"test","module":"auth-service","tokenHash":"296605a6abe62551d9f5092c0560e790ab7a42aa4af5575d691b7312714ce4d6","plainTokenLen":80,"msg":"DEBUG: rotateRefreshToken called"}
{"level":30,"time":1768363741469,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":40,"time":1768363741479,"env":"test","workflowId":"fadb1e65-0883-497b-9315-6008b737d391","msg":"No current or pinned version found for workflow, run might be unstable"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mCross-User Authorization[2m > [22m[2mshould not allow user to access another user's resources
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363741570,"env":"test","module":"auth-routes","userId":"1a57e699-7260-48e9-94b4-6ce09ce67eb6","msg":"User logged in successfully"}
{"level":30,"time":1768363741621,"env":"test","workflowId":"74390b22-8755-4dc4-b374-9688845ff140","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":1,"stepsCount":1,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363741623,"env":"test","module":"audit-log-service","userId":"1a57e699-7260-48e9-94b4-6ce09ce67eb6","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363741658,"env":"test","module":"user-credentials-repository","userId":"bbc1938c-2a86-4b18-b7e3-83fadb6a519f","msg":"User credentials created"}
 [32mâœ“[39m tests/integration/auth/session.management.integration.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 35324[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create refresh token on login [33m 1297[2mms[22m[39m
       [33m[2mâœ“[22m[39m should track device metadata in session [33m 1387[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create separate sessions for multiple device logins [33m 2406[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list all active sessions for user [33m 2440[2mms[22m[39m
       [33m[2mâœ“[22m[39m should mark current session correctly [33m 1930[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not include revoked sessions [33m 2107[2mms[22m[39m
       [33m[2mâœ“[22m[39m should order sessions by last used (most recent first) [33m 2681[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require authentication [33m 673[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke specific session [33m 2268[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent revoking current session [33m 1504[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not allow revoking other users sessions [33m 2843[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 404 for non-existent session ID [33m 1303[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke all sessions except current [33m 3247[2mms[22m[39m
       [33m[2mâœ“[22m[39m should revoke all trusted devices [33m 1658[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require active session [33m 669[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject refresh token after 30 days [33m 1443[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle multiple concurrent logins [33m 1587[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle concurrent token refreshes [33m 1631[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w30
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363741760,"env":"test","module":"email-queue","jobId":"fd97b911-559a-4ac9-8790-1ac61ad8c8d3","to":"middleware-test-xsYvs8_ZZdTxii7BFDoxL@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w30 (Reused: true)

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768363741811,"env":"test","module":"auth-routes","userId":"bbc1938c-2a86-4b18-b7e3-83fadb6a519f","email":"middleware-test-xsYvs8_ZZdTxii7BFDoxL@example.com","msg":"User registered"}
{"level":30,"time":1768363741819,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363741820,"env":"test","msg":"DB: pool closed."}
{"level":50,"time":1768363741831,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"905d29a1-b5de-4e3c-9d6b-e3f8ba52d54e","workflowId":"fadb1e65-0883-497b-9315-6008b737d391","versionId":"draft","type":"run.start","timestamp":"2026-01-14T04:09:01.776Z","isPreview":false,"payload":{"accessMode":"anonymous"}},"msg":"Failed to record analytics event"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Regeneration[2m > [22m[2mshould regenerate backup codes
[22m[39m[TEST UTILS] MFA Secret verified for f2c98a825c93613226de7ccebf600fb4

{"level":30,"time":1768363741842,"env":"test","module":"version-service","workflowId":"74390b22-8755-4dc4-b374-9688845ff140","versionId":"ae4a47df-bdb4-4ae9-a9ca-0611ef7e4618","userId":"dff24424-c365-4cbc-b36f-77400955dfef","versionNumber":1,"msg":"Created draft version"}
{"level":30,"time":1768363741848,"env":"test","hookId":"6df36bc7-74bf-4d5d-a2c9-332e89366b2e","workflowId":"49d9212c-b65f-41a7-99ab-f3c9cc7f8c10","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return consistent error format for invalid token
[22m[39mDEBUG: LOGIN HANDLER HIT

 [32mâœ“[39m tests/unit/engine/templateNode.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 11975[2mms[22m[39m
       [33m[2mâœ“[22m[39m should resolve template by key from workflowTemplates mapping [33m 754[2mms[22m[39m
       [33m[2mâœ“[22m[39m should throw error if template key not found [33m 610[2mms[22m[39m
       [33m[2mâœ“[22m[39m should store output in runOutputs table [33m 763[2mms[22m[39m
       [33m[2mâœ“[22m[39m should resolve template by templateId directly [33m 623[2mms[22m[39m
       [33m[2mâœ“[22m[39m should throw error if templateId not found [33m 606[2mms[22m[39m
       [33m[2mâœ“[22m[39m should use docxRenderer2 by default (v2 engine) [33m 688[2mms[22m[39m
       [33m[2mâœ“[22m[39m should use legacy engine when engine="legacy" [33m 608[2mms[22m[39m
       [33m[2mâœ“[22m[39m should generate PDF when toPdf=true [33m 759[2mms[22m[39m
       [33m[2mâœ“[22m[39m should default to DOCX when toPdf=false [33m 753[2mms[22m[39m
       [33m[2mâœ“[22m[39m should skip execution when condition evaluates to false [33m 548[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute when condition evaluates to true [33m 591[2mms[22m[39m
       [33m[2mâœ“[22m[39m should resolve simple bindings [33m 589[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle binding resolution errors gracefully [33m 556[2mms[22m[39m
       [33m[2mâœ“[22m[39m should record failed output in runOutputs table [33m 713[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not throw errors (should return error in result) [33m 602[2mms[22m[39m
       [33m[2mâœ“[22m[39m should deny access to templates from different tenant [33m 603[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require either templateKey or templateId [33m 549[2mms[22m[39m
{"level":30,"time":1768363741953,"env":"test","module":"ai-workflow-edit-routes","workflowId":"74390b22-8755-4dc4-b374-9688845ff140","versionId":"ae4a47df-bdb4-4ae9-a9ca-0611ef7e4618","opsCount":2,"msg":"AI edit completed"}
{"level":30,"time":1768363742039,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768363742087,"env":"test","module":"auth-routes","userId":"cc29f27b-95dd-4545-8b94-c109171fa6c1","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mHook Management API[2m > [22m[2mshould update a hook
[22m[39mTEST SETUP: workflowId = 42624050-2d79-49a5-8ad7-7d862790c9fd

{"level":30,"time":1768363742138,"env":"test","module":"audit-log-service","userId":"cc29f27b-95dd-4545-8b94-c109171fa6c1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Regeneration[2m > [22m[2mshould regenerate backup codes
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363742174,"env":"test","workflowId":"5ba7dfef-fead-48ad-bc4d-6b791b9b8068","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":40,"time":1768363742199,"env":"test","module":"rbac-middleware","userId":"cc29f27b-95dd-4545-8b94-c109171fa6c1","userRole":"viewer","permission":"project:delete","path":"/41a165f1-2e3b-4431-b7cb-c169228d719f","msg":"Permission denied"}
{"level":50,"time":1768363742277,"env":"test","error":{},"msg":"Error fetching DataVault table"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts[2m > [22m[2mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22m[2mshould not create version when no changes detected (checksum match)
[22m[39mDEBUG: Instantiating GoogleGenerativeAI
DEBUG: Getting model
DEBUG: Building system prompt
DEBUG: Building workflow context
DEBUG: Workflow context built
DEBUG: About to build full prompt. Parts: { s: [32m'string'[39m, w: [32m'string'[39m, u: [32m'string'[39m }
DEBUG: Full prompt built. Length: [33m4094[39m

{"level":30,"time":1768363742372,"env":"test","module":"auth-routes","userId":"bbc1938c-2a86-4b18-b7e3-83fadb6a519f","msg":"User logged in successfully"}
{"level":30,"time":1768363742373,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363742374,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363742421,"env":"test","module":"audit-log-service","userId":"bbc1938c-2a86-4b18-b7e3-83fadb6a519f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363742425,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mâœ“[39m tests/integration/organizations-audit-fixes.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 10126[2mms[22m[39m
       [33m[2mâœ“[22m[39m should cascade ownership to workflow runs when project is transferred [33m 1025[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent double-acceptance via transaction [33m 1142[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not create invite if email fails [33m 672[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow re-invite after invite expires [33m 1367[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow last admin to delete empty organization [33m 674[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent deletion if org owns assets [33m 911[2mms[22m[39m
       [33m[2mâœ“[22m[39m should cleanup placeholder user when invite is revoked [33m 1380[2mms[22m[39m
       [33m[2mâœ“[22m[39m should fail fast on non-existent org [33m 454[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

{"level":50,"time":1768363742561,"env":"test","error":{},"msg":"Error updating DataVault table"}
{"level":30,"time":1768363742565,"env":"test","hookId":"2163ade0-5ea4-4435-9b26-b01ac298b5c9","workflowId":"42624050-2d79-49a5-8ad7-7d862790c9fd","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
[90mstderr[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
    at [90mC:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mpg-pool[24m\index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-workflow.test.ts:83:7 {
  length: [33m335[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(40de0889-36d0-44e0-a841-c7860ddac014) is still referenced from table "audit_logs".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'audit_logs'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'audit_logs_user_id_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

{"level":30,"time":1768363742601,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363742603,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363742624,"env":"test","workflowId":"5ba7dfef-fead-48ad-bc4d-6b791b9b8068","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":1,"stepsCount":1,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":50,"time":1768363742666,"env":"test","error":{},"msg":"Error updating DataVault table"}
 [32mâœ“[39m tests/integration/organizations-workflow.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 9614[2mms[22m[39m
       [33m[2mâœ“[22m[39m Step 1: Create organization [33m 676[2mms[22m[39m
       [33m[2mâœ“[22m[39m Step 2: Invite member via email [33m 649[2mms[22m[39m
       [33m[2mâœ“[22m[39m Step 3: Accept invite [33m 583[2mms[22m[39m
       [33m[2mâœ“[22m[39m Step 4: Create workflow owned by user [33m 315[2mms[22m[39m
       [33m[2mâœ“[22m[39m Step 5: Transfer workflow to organization [33m 316[2mms[22m[39m
       [33m[2mâœ“[22m[39m Step 6: Org member (user2) can access workflow [33m 575[2mms[22m[39m
       [33m[2mâœ“[22m[39m Step 14: Remove member from org [33m 312[2mms[22m[39m
       [33m[2mâœ“[22m[39m Step 16: Re-add member and verify access restored [33m 425[2mms[22m[39m
       [33m[2mâœ“[22m[39m Cannot invite same email twice (pending invite exists) [33m 927[2mms[22m[39m
       [33m[2mâœ“[22m[39m Cannot accept expired invite [33m 804[2mms[22m[39m
       [33m[2mâœ“[22m[39m Cannot transfer workflow to org user is not a member of [33m 637[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363742682,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363742691,"env":"test","module":"auth-routes","userId":"f2c98a825c93613226de7ccebf600fb4","msg":"Login requires MFA verification"}
{"level":30,"time":1768363742692,"env":"test","module":"user-credentials-repository","userId":"f39f5fbe-6a2f-4877-9fbf-a687d1fb24ec","msg":"User credentials created"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363742744,"env":"test","msg":"DB: initialized flag set."}
{"level":50,"time":1768363742767,"env":"test","error":{},"msg":"Error deleting DataVault table"}
{"level":30,"time":1768363742791,"env":"test","module":"email-queue","jobId":"d0c71f22-e7b4-4ac4-a672-63f3204b4c8b","to":"protected-test-JR0oztKtVXwePTMCGY7i3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363742797,"env":"test","module":"mfa-service","userId":"f2c98a825c93613226de7ccebf600fb4","msg":"TOTP verification successful"}
{"level":30,"time":1768363742840,"env":"test","module":"auth-routes","userId":"f39f5fbe-6a2f-4877-9fbf-a687d1fb24ec","email":"protected-test-JR0oztKtVXwePTMCGY7i3@example.com","msg":"User registered"}
{"level":30,"time":1768363742844,"env":"test","module":"version-service","workflowId":"5ba7dfef-fead-48ad-bc4d-6b791b9b8068","versionId":"3656cb8e-5d89-48e1-a36f-279516f720bb","userId":"dff24424-c365-4cbc-b36f-77400955dfef","versionNumber":1,"msg":"Created draft version"}
{"level":30,"time":1768363742845,"env":"test","hookId":"2163ade0-5ea4-4435-9b26-b01ac298b5c9","workflowId":"42624050-2d79-49a5-8ad7-7d862790c9fd","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1768363742846,"env":"test","module":"auth-routes","userId":"f2c98a825c93613226de7ccebf600fb4","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mHook Management API[2m > [22m[2mshould delete a hook
[22m[39mTEST SETUP: workflowId = 0c9ecf0b-adde-4deb-8764-e4c5da3ffc46

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":50,"time":1768363742866,"env":"test","error":{},"msg":"Error deleting DataVault table"}
{"level":30,"time":1768363742895,"env":"test","module":"user-credentials-repository","userId":"e338be84-00f0-4b8b-a364-b60f54fc86fa","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mUser Context Injection[2m > [22m[2mshould inject userId into request context
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363742955,"env":"test","module":"ai-workflow-edit-routes","workflowId":"5ba7dfef-fead-48ad-bc4d-6b791b9b8068","versionId":"3656cb8e-5d89-48e1-a36f-279516f720bb","opsCount":2,"msg":"AI edit completed"}
{"level":50,"time":1768363742971,"env":"test","error":{},"msg":"Error deleting DataVault table"}
 [32mâœ“[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m)[22m[33m 9021[2mms[22m[39m
         [33m[2mâœ“[22m[39m should generate different hashes for same password [33m 442[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return true for correct password [33m 460[2mms[22m[39m
         [33m[2mâœ“[22m[39m should return false for incorrect password [33m 513[2mms[22m[39m
         [33m[2mâœ“[22m[39m should be case-sensitive [33m 462[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle empty password comparison [33m 507[2mms[22m[39m
         [33m[2mâœ“[22m[39m should throw error for expired token [33m 1108[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle password with special characters [33m 530[2mms[22m[39m
         [33m[2mâœ“[22m[39m should handle password with newlines and tabs [33m 514[2mms[22m[39m
         [33m[2mâœ“[22m[39m should reject password with null bytes (if validation exists) [33m 494[2mms[22m[39m
         [33m[2mâœ“[22m[39m should support complete password reset workflow [33m 559[2mms[22m[39m
         [33m[2mâœ“[22m[39m should compare password in reasonable time (< 500ms) [33m 590[2mms[22m[39m
{"level":30,"time":1768363742995,"env":"test","module":"email-queue","jobId":"1d4f44ed-ecce-446d-bd4e-b84c6eeb2f64","to":"middleware-test-G6SStvT6n6IlQA4TUlpjh@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768363743044,"env":"test","module":"auth-routes","userId":"e338be84-00f0-4b8b-a364-b60f54fc86fa","email":"middleware-test-G6SStvT6n6IlQA4TUlpjh@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mError Handling[2m > [22m[2mshould return consistent error format for expired token
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363743128,"env":"test","workflowId":"5ba7dfef-fead-48ad-bc4d-6b791b9b8068","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":1,"stepsCount":1,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":50,"time":1768363743190,"env":"test","error":{},"msg":"Error fetching table permissions"}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768363743285,"env":"test","hookId":"a37015b0-1608-411f-8fa3-f6e9b273a794","workflowId":"0c9ecf0b-adde-4deb-8764-e4c5da3ffc46","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts[2m > [22m[2mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22m[2mshould not create version when no changes detected (checksum match)
[22m[39mDEBUG: Instantiating GoogleGenerativeAI
DEBUG: Getting model
DEBUG: Building system prompt
DEBUG: Building workflow context
DEBUG: Workflow context built
DEBUG: About to build full prompt. Parts: { s: [32m'string'[39m, w: [32m'string'[39m, u: [32m'string'[39m }
DEBUG: Full prompt built. Length: [33m4188[39m

{"level":30,"time":1768363743292,"env":"test","module":"mfa-service","userId":"f2c98a825c93613226de7ccebf600fb4","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768363743293,"env":"test","module":"mfa-service","userId":"f2c98a825c93613226de7ccebf600fb4","msg":"Regenerated backup codes"}
{"level":30,"time":1768363743293,"env":"test","module":"auth-routes","userId":"f2c98a825c93613226de7ccebf600fb4","msg":"Backup codes regenerated"}
{"level":50,"time":1768363743293,"env":"test","error":{},"msg":"Error fetching table permissions"}
{"level":30,"time":1768363743450,"env":"test","workflowId":"5ba7dfef-fead-48ad-bc4d-6b791b9b8068","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":1,"stepsCount":1,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363743503,"env":"test","module":"auth-routes","userId":"f39f5fbe-6a2f-4877-9fbf-a687d1fb24ec","msg":"User logged in successfully"}
{"level":50,"time":1768363743516,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"905d29a1-b5de-4e3c-9d6b-e3f8ba52d54e","workflowId":"fadb1e65-0883-497b-9315-6008b737d391","versionId":"draft","type":"block.start","blockId":"3361f4d4-c4e9-47f7-ab09-ac9c3cb1df6f","pageId":"d1079153-2bf8-4b58-bb94-f060b693e5ce","timestamp":"2026-01-14T04:09:03.470Z","isPreview":false,"payload":{"blockType":"write"}},"msg":"Failed to record analytics event"}
{"level":30,"time":1768363743543,"env":"test","hookId":"a37015b0-1608-411f-8fa3-f6e9b273a794","workflowId":"0c9ecf0b-adde-4deb-8764-e4c5da3ffc46","msg":"LifecycleHookService: Deleted lifecycle hook"}
{"level":30,"time":1768363743555,"env":"test","module":"audit-log-service","userId":"f39f5fbe-6a2f-4877-9fbf-a687d1fb24ec","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363743571,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"mode":"create","tableId":"16f89800-c7a0-47c0-86a6-e1c22feca842","dataSourceId":"7df2f593-45a6-4102-97c8-08609bf722a0","columnMappings":[{"value":"{{699ea4b4-975c-436e-81fa-e3db08e52e11}}","columnId":"64793bd8-d42b-47ed-a7ed-51f0e47bf547"}]},"tableId":"16f89800-c7a0-47c0-86a6-e1c22feca842","preview":false,"msg":"Starting write execution"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mHook Management API[2m > [22m[2mshould test a hook with sample data
[22m[39mTEST SETUP: workflowId = d33fbf93-cada-4e0f-a113-5ddb690a38e5

{"level":30,"time":1768363743602,"env":"test","module":"auth-routes","userId":"e338be84-00f0-4b8b-a364-b60f54fc86fa","msg":"User logged in successfully"}
{"level":30,"time":1768363743615,"env":"test","module":"ai-workflow-edit-routes","workflowId":"5ba7dfef-fead-48ad-bc4d-6b791b9b8068","msg":"AI made no changes (checksum match)"}
{"level":30,"time":1768363743649,"env":"test","module":"audit-log-service","userId":"e338be84-00f0-4b8b-a364-b60f54fc86fa","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363743859,"env":"test","workflowId":"53b53443-2643-4d5a-9ef9-9ee7bfab2175","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":50,"time":1768363743916,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts[2m > [22m[2mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22m[2mshould reject unsafe DataVault operations
[22m[39mDEBUG: Instantiating GoogleGenerativeAI
DEBUG: Getting model
DEBUG: Building system prompt
DEBUG: Building workflow context
DEBUG: Workflow context built
DEBUG: About to build full prompt. Parts: { s: [32m'string'[39m, w: [32m'string'[39m, u: [32m'string'[39m }
DEBUG: Full prompt built. Length: [33m4090[39m

{"level":50,"time":1768363743955,"env":"test","module":"ai-workflow-edit-routes","errors":["Validation failed for datavault.dropTable: Invalid operation schema: Invalid discriminator value. Expected 'workflow.setMetadata' | 'section.create' | 'section.update' | 'section.delete' | 'section.reorder' | 'step.create' | 'step.update' | 'step.delete' | 'step.move' | 'step.setVisibleIf' | 'step.setRequired' | 'logicRule.create' | 'logicRule.update' | 'logicRule.delete' | 'document.add' | 'document.update' | 'document.setConditional' | 'document.bindFields' | 'datavault.createTable' | 'datavault.addColumns' | 'datavault.createWritebackMapping'"],"workflowId":"53b53443-2643-4d5a-9ef9-9ee7bfab2175","msg":"Failed to apply some AI operations"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

{"level":50,"time":1768363744021,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":30,"time":1768363744021,"env":"test","hookId":"64f123d2-8995-43c9-9c34-bd4505a09050","workflowId":"d33fbf93-cada-4e0f-a113-5ddb690a38e5","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363744035,"env":"test","module":"user-credentials-repository","userId":"e36c25d2-4459-4c69-bda2-3ca99ee6d8ef","msg":"User credentials created"}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

{"level":50,"time":1768363744102,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"905d29a1-b5de-4e3c-9d6b-e3f8ba52d54e","workflowId":"fadb1e65-0883-497b-9315-6008b737d391","versionId":"draft","type":"block.complete","blockId":"3361f4d4-c4e9-47f7-ab09-ac9c3cb1df6f","pageId":"d1079153-2bf8-4b58-bb94-f060b693e5ce","timestamp":"2026-01-14T04:09:04.051Z","isPreview":false,"payload":{"blockType":"write"}},"msg":"Failed to record analytics event"}
{"level":30,"time":1768363744118,"env":"test","workflowId":"f9192b22-b704-4007-bd19-0490da21779b","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363744133,"env":"test","module":"email-queue","jobId":"b7fe494b-c940-477d-a105-204d652c0b48","to":"protected-test-B6MRTP5nbFRk9RP-AgDB9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363744181,"env":"test","module":"auth-routes","userId":"e36c25d2-4459-4c69-bda2-3ca99ee6d8ef","email":"protected-test-B6MRTP5nbFRk9RP-AgDB9@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts[2m > [22m[2mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22m[2mshould handle multi-operation edits with tempId resolution
[22m[39mDEBUG: Instantiating GoogleGenerativeAI
DEBUG: Getting model
DEBUG: Building system prompt
DEBUG: Building workflow context
DEBUG: Workflow context built
DEBUG: About to build full prompt. Parts: { s: [32m'string'[39m, w: [32m'string'[39m, u: [32m'string'[39m }
DEBUG: Full prompt built. Length: [33m4168[39m

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":40,"time":1768363744247,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mScript Console Logs[2m > [22m[2mshould retrieve execution logs for a run
[22m[39mTEST SETUP: workflowId = 7684d33a-49d7-47a4-afb0-69f652e7faf7

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mUser Context Injection[2m > [22m[2mshould inject tenantId into request context
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Regeneration[2m > [22m[2mshould return error if MFA not enabled
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":50,"time":1768363744494,"env":"test","error":{},"msg":"Error revoking table permission"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w35
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w31
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w35 (Reused: true)

{"level":30,"time":1768363744608,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w31 (Reused: true)

{"level":30,"time":1768363744652,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363744656,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts[2m > [22m[2mLifecycle Hooks Execution[2m > [22m[2mScript Console Logs[2m > [22m[2mshould clear execution logs for a run
[22m[39mTEST SETUP: workflowId = 5faf2813-5a11-4f68-bc1b-a81f086e6b4e

{"level":30,"time":1768363744704,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w29
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w29 (Reused: true)

{"level":30,"time":1768363744764,"env":"test","msg":"DB: initializing... Local"}
{"level":40,"time":1768363744805,"env":"test","module":"auth-middleware","error":{"name":"TokenExpiredError","code":"AUTH_002","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363744805,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363744838,"env":"test","workflowId":"f9192b22-b704-4007-bd19-0490da21779b","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":1,"stepsCount":2,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363744839,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363744883,"env":"test","module":"auth-routes","userId":"e36c25d2-4459-4c69-bda2-3ca99ee6d8ef","msg":"User logged in successfully"}
{"level":30,"time":1768363744889,"env":"test","module":"auth-routes","userId":"4ce40b059b86b6a3ba58a52ac491b0c0","msg":"User logged in successfully"}
{"level":30,"time":1768363744929,"env":"test","module":"audit-log-service","userId":"e36c25d2-4459-4c69-bda2-3ca99ee6d8ef","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363744937,"env":"test","module":"audit-log-service","userId":"4ce40b059b86b6a3ba58a52ac491b0c0","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768363745005,"env":"test","error":{},"msg":"Error updating DataVault table"}
{"level":30,"time":1768363745050,"env":"test","module":"version-service","workflowId":"f9192b22-b704-4007-bd19-0490da21779b","versionId":"30e8fbb1-6eec-4dde-a205-c453e5d99733","userId":"dff24424-c365-4cbc-b36f-77400955dfef","versionNumber":1,"msg":"Created draft version"}
{"level":40,"time":1768363745055,"env":"test","workflowId":"c65aa0d6-5404-45ff-b398-975762e2695c","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":30,"time":1768363745153,"env":"test","module":"ai-workflow-edit-routes","workflowId":"f9192b22-b704-4007-bd19-0490da21779b","versionId":"30e8fbb1-6eec-4dde-a205-c453e5d99733","opsCount":4,"msg":"AI edit completed"}
{"level":30,"time":1768363745258,"env":"test","module":"user-credentials-repository","userId":"e4394011-981e-4192-a4e8-aa9354b3d025","msg":"User credentials created"}
{"level":50,"time":1768363745326,"env":"test","error":{},"msg":"Error updating DataVault table"}
{"level":30,"time":1768363745360,"env":"test","module":"email-queue","jobId":"84f30f85-d96b-4b1e-afcb-208169139f6c","to":"middleware-test-ZTy19KEyi1TjiaTLP8-Yt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363745395,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363745407,"env":"test","module":"auth-routes","userId":"e4394011-981e-4192-a4e8-aa9354b3d025","email":"middleware-test-ZTy19KEyi1TjiaTLP8-Yt@example.com","msg":"User registered"}
{"level":30,"time":1768363745420,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts[2m > [22m[2mTemplates and Runs API Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363745422,"env":"test","workflowId":"fb9d5898-50a8-4059-805b-34db40f137ec","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363745407,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363745408,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363745413,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363745420,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363745420,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363745420,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363745420,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363745434,"env":"test","module":"user-credentials-repository","userId":"a8b3c77e-6a6d-4095-98f0-0ad2f42e5ee6","msg":"User credentials created"}
{"level":50,"time":1768363745442,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"33b5edd0-69a4-4eca-8838-eeb4c62063c2","workflowId":"c65aa0d6-5404-45ff-b398-975762e2695c","versionId":"draft","type":"run.start","timestamp":"2026-01-14T04:09:05.387Z","isPreview":false,"payload":{"accessMode":"anonymous"}},"msg":"Failed to record analytics event"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mError Handling[2m > [22m[2mshould handle malformed JWT gracefully
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363745476,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/lifecycle-hooks-execution.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363745477,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w36
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts[2m > [22m[2mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22m[2mshould create BEFORE and AFTER snapshots
[22m[39mDEBUG: Instantiating GoogleGenerativeAI
DEBUG: Getting model
DEBUG: Building system prompt
DEBUG: Building workflow context
DEBUG: Workflow context built
DEBUG: About to build full prompt. Parts: { s: [32m'string'[39m, w: [32m'string'[39m, u: [32m'string'[39m }
DEBUG: Full prompt built. Length: [33m4093[39m

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w36 (Reused: true)

{"level":30,"time":1768363745541,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363745541,"env":"test","module":"email-queue","jobId":"ec4bde52-662b-478e-bea9-580dd673abdf","to":"protected-test-XoxFQJL3V6LcO0P9j_YOx@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363745592,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363745593,"env":"test","module":"auth-routes","userId":"a8b3c77e-6a6d-4095-98f0-0ad2f42e5ee6","email":"protected-test-XoxFQJL3V6LcO0P9j_YOx@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstderr[2m | tests/ui/datavault/EditableCell.test.tsx[2m > [22m[2mEditableCell Component[2m > [22m[2mError Handling[2m > [22m[2mreverts value on save error
[22m[39mFailed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:206:36
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

{"level":30,"time":1768363745608,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363745609,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mUser Context Injection[2m > [22m[2mshould inject role into request context
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstderr[2m | tests/ui/datavault/EditableCell.test.tsx[2m > [22m[2mEditableCell Component[2m > [22m[2mError Handling[2m > [22m[2mdisplays error indicator on save failure
[22m[39mFailed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:222:36
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:145:11
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:26
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1209:10[90m)[39m
    at [90mfile:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:37
    at Traces.$ [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/traces.U4xDYhzZ.js:115:27[90m)[39m
    at trace [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/test.B8ej_ZHS.js:239:21[90m)[39m
    at runTest [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1653:12[90m)[39m

 [32mâœ“[39m tests/integration/lifecycle-hooks-execution.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 12316[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute beforePage hook and capture console output [33m 709[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute beforePage hook with mutation mode enabled [33m 647[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle errors gracefully without breaking workflow [33m 722[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute afterPage hook with user input data [33m 714[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute beforeFinalBlock hook before document generation [33m 650[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute afterDocumentsGenerated hook for cleanup [33m 635[2mms[22m[39m
       [33m[2mâœ“[22m[39m should timeout hook that exceeds timeoutMs limit [33m 798[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute multiple hooks in correct order [33m 1354[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list all hooks for a workflow [33m 720[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update a hook [33m 730[2mms[22m[39m
       [33m[2mâœ“[22m[39m should delete a hook [33m 751[2mms[22m[39m
       [33m[2mâœ“[22m[39m should test a hook with sample data [33m 655[2mms[22m[39m
       [33m[2mâœ“[22m[39m should retrieve execution logs for a run [33m 434[2mms[22m[39m
       [33m[2mâœ“[22m[39m should clear execution logs for a run [33m 488[2mms[22m[39m
{"level":30,"time":1768363745907,"env":"test","workflowId":"fb9d5898-50a8-4059-805b-34db40f137ec","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":1,"stepsCount":1,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363745992,"env":"test","module":"user-credentials-repository","userId":"936dcebb-5066-4b8f-b83d-d40ee9662e40","msg":"User credentials created"}
 [32mâœ“[39m tests/integration/datavault.permissions.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 10729[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow owner to update existing permission (upsert) [33m 312[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow owner to revoke permissions [33m 312[2mms[22m[39m
       [33m[2mâœ“[22m[39m should enforce write includes read but not owner [33m 310[2mms[22m[39m
{"level":30,"time":1768363746033,"env":"test","module":"auth-routes","userId":"e4394011-981e-4192-a4e8-aa9354b3d025","msg":"User logged in successfully"}
{"level":30,"time":1768363746089,"env":"test","module":"audit-log-service","userId":"e4394011-981e-4192-a4e8-aa9354b3d025","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w32
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":40,"time":1768363746094,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363746094,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363746104,"env":"test","module":"email-queue","jobId":"9bae5b03-22db-4964-8f78-30a037b13d0b","to":"test-ItFYsemEUeqNa2yIuJOdc@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363746120,"env":"test","module":"version-service","workflowId":"fb9d5898-50a8-4059-805b-34db40f137ec","versionId":"6e8aad7b-e3d5-4f5a-be27-047879e53a01","userId":"dff24424-c365-4cbc-b36f-77400955dfef","versionNumber":1,"msg":"Created draft version"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w32 (Reused: true)

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mTenant-Level MFA Enforcement[2m > [22m[2mshould enforce MFA for tenant users when required by tenant
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363746166,"env":"test","module":"auth-routes","userId":"936dcebb-5066-4b8f-b83d-d40ee9662e40","email":"test-ItFYsemEUeqNa2yIuJOdc@example.com","msg":"User registered"}
{"level":30,"time":1768363746228,"env":"test","module":"ai-workflow-edit-routes","workflowId":"fb9d5898-50a8-4059-805b-34db40f137ec","versionId":"6e8aad7b-e3d5-4f5a-be27-047879e53a01","opsCount":2,"msg":"AI edit completed"}
[90mstderr[2m | tests/ui/datavault/EditableCell.test.tsx[2m > [22m[2mEditableCell Component[2m > [22m[2mBoolean Type (Checkbox)[2m > [22m[2mshows loading spinner when saving checkbox
[22m[39mWarning: An update to EditableCell inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at EditableCell (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/EditableCell.tsx:12:25)

{"level":30,"time":1768363746294,"env":"test","module":"auth-routes","userId":"a8b3c77e-6a6d-4095-98f0-0ad2f42e5ee6","msg":"User logged in successfully"}
{"level":30,"time":1768363746344,"env":"test","module":"audit-log-service","userId":"a8b3c77e-6a6d-4095-98f0-0ad2f42e5ee6","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363746520,"env":"test","module":"user-credentials-repository","userId":"a5c7126d-5d1b-48fe-a0e4-fd3160f226ef","msg":"User credentials created"}
{"level":30,"time":1768363746604,"env":"test","module":"writeback-execution-service","runId":"982a8b2b-3f4b-4fe9-a520-f639d0f18648","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","msg":"Executing writeback mappings for completed run"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

{"level":30,"time":1768363746626,"env":"test","module":"email-queue","jobId":"3bfbf5a5-ade3-4559-a7e3-e4db44b2eb57","to":"middleware-test-jZ5Th-75ukdmizYWtPlnI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363746628,"env":"test","workflowId":"bed3f4d1-5e47-4251-b7cd-b89a763cc1a1","userId":"dff24424-c365-4cbc-b36f-77400955dfef","sectionsCount":1,"stepsCount":1,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768363746660,"env":"test","module":"writeback-execution-service","runId":"982a8b2b-3f4b-4fe9-a520-f639d0f18648","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","mappingCount":1,"msg":"Found writeback mappings"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768363746689,"env":"test","module":"auth-routes","userId":"a5c7126d-5d1b-48fe-a0e4-fd3160f226ef","email":"middleware-test-jZ5Th-75ukdmizYWtPlnI@example.com","msg":"User registered"}
{"level":30,"time":1768363746733,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363746741,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests[2m > [22m[2mError Handling[2m > [22m[2mshould handle JWT with wrong algorithm
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts[2m > [22m[2mPOST /api/workflows/:workflowId/ai/edit - Integration Test[2m > [22m[2mshould rollback on validation failure
[22m[39mDEBUG: Instantiating GoogleGenerativeAI
DEBUG: Getting model
DEBUG: Building system prompt
DEBUG: Building workflow context
DEBUG: Workflow context built
DEBUG: About to build full prompt. Parts: { s: [32m'string'[39m, w: [32m'string'[39m, u: [32m'string'[39m }
DEBUG: Full prompt built. Length: [33m4182[39m

{"level":30,"time":1768363746766,"env":"test","module":"auth-routes","userId":"532f67d7b455a2b65be39443a591060e","msg":"Login requires MFA verification"}
{"level":50,"time":1768363746800,"env":"test","module":"ai-workflow-edit-routes","errors":["Validation failed for step.create: Step alias 'email' already exists"],"workflowId":"bed3f4d1-5e47-4251-b7cd-b89a763cc1a1","msg":"Failed to apply some AI operations"}
{"level":30,"time":1768363746841,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [32mâœ“[39m tests/ui/datavault/EditableCell.test.tsx [2m([22m[2m29 tests[22m[2m)[22m[33m 5440[2mms[22m[39m
       [33m[2mâœ“[22m[39m saves on blur [33m 443[2mms[22m[39m
{"level":30,"time":1768363746879,"env":"test","module":"writeback-execution-service","runId":"982a8b2b-3f4b-4fe9-a520-f639d0f18648","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","mappingId":"0883b5ce-18d0-4710-858c-4e4b0165c8f1","tableId":"81f2f6bb-d1a7-4413-ad81-b99e61dbbfb5","msg":"Executing writeback mapping"}
{"level":30,"time":1768363746904,"env":"test","module":"user-credentials-repository","userId":"9af66895-c7ac-4c77-856d-5dfd1abeb69f","msg":"User credentials created"}
{"level":50,"time":1768363746975,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"33b5edd0-69a4-4eca-8838-eeb4c62063c2","workflowId":"c65aa0d6-5404-45ff-b398-975762e2695c","versionId":"draft","type":"block.start","blockId":"d2dc1d46-fd6c-4b31-815a-be7a951beae3","pageId":"49bde400-c22c-42b3-9e90-1985ef8bc096","timestamp":"2026-01-14T04:09:06.891Z","isPreview":false,"payload":{"blockType":"query"}},"msg":"Failed to record analytics event"}
{"level":30,"time":1768363747005,"env":"test","module":"email-queue","jobId":"c3a0937c-4760-4e55-9e14-96282a600068","to":"protected-test-wljHzil45wCPfekzBgXJt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363747036,"env":"test","workflowId":"c65aa0d6-5404-45ff-b398-975762e2695c","queryId":"fb8e1e49-e09c-4a63-8370-25179f6fc04f","outputVar":"my_results","msg":"Executing query block"}
{"level":30,"time":1768363747060,"env":"test","module":"auth-routes","userId":"9af66895-c7ac-4c77-856d-5dfd1abeb69f","email":"protected-test-wljHzil45wCPfekzBgXJt@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363747065,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363747130,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mRate Limiting on Protected Routes[2m > [22m[2mshould not apply general rate limiting to authenticated requests
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363747291,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768363747309,"env":"test","module":"auth-routes","userId":"a5c7126d-5d1b-48fe-a0e4-fd3160f226ef","msg":"User logged in successfully"}
{"level":30,"time":1768363747310,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363747311,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363747310,"env":"test","module":"writeback-execution-service","runId":"982a8b2b-3f4b-4fe9-a520-f639d0f18648","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","mappingId":"0883b5ce-18d0-4710-858c-4e4b0165c8f1","columnCount":3,"msg":"Successfully created DataVault row"}
{"level":30,"time":1768363747310,"env":"test","module":"writeback-execution-service","runId":"982a8b2b-3f4b-4fe9-a520-f639d0f18648","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","rowsCreated":1,"errorCount":0,"msg":"Writeback execution completed"}
{"level":30,"time":1768363747355,"env":"test","module":"audit-log-service","userId":"a5c7126d-5d1b-48fe-a0e4-fd3160f226ef","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768363747361,"env":"test","module":"auth-middleware","error":{"name":"InvalidTokenError","code":"AUTH_003","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363747361,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mâœ“[39m tests/integration/ai/workflowEdit.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 8907[2mms[22m[39m
     [33m[2mâœ“[22m[39m should create draft version on successful AI edit [33m 1412[2mms[22m[39m
     [33m[2mâœ“[22m[39m should enforce draft mode (revert active workflow to draft) [33m 1085[2mms[22m[39m
     [33m[2mâœ“[22m[39m should not create version when no changes detected (checksum match) [33m 1608[2mms[22m[39m
     [33m[2mâœ“[22m[39m should handle multi-operation edits with tempId resolution [33m 1296[2mms[22m[39m
     [33m[2mâœ“[22m[39m should create BEFORE and AFTER snapshots [33m 1034[2mms[22m[39m
     [33m[2mâœ“[22m[39m should rollback on validation failure [33m 621[2mms[22m[39m
{"level":50,"time":1768363747406,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"33b5edd0-69a4-4eca-8838-eeb4c62063c2","workflowId":"c65aa0d6-5404-45ff-b398-975762e2695c","versionId":"draft","type":"block.complete","blockId":"d2dc1d46-fd6c-4b31-815a-be7a951beae3","pageId":"49bde400-c22c-42b3-9e90-1985ef8bc096","timestamp":"2026-01-14T04:09:07.351Z","isPreview":false,"payload":{"blockType":"query"}},"msg":"Failed to record analytics event"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363747649,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363747649,"env":"test","msg":"DB: pool closed."}
{"level":50,"time":1768363747657,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"qpdf --decrypt \"C:\\Users\\scoot\\AppData\\Local\\Temp\\locked-1768363747557.pdf\" \"C:\\Users\\scoot\\AppData\\Local\\Temp\\unlocked-1768363747557.pdf\"","stdout":"","stderr":"'qpdf' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"Failed to unlock PDF with qpdf"}
{"level":40,"time":1768363747657,"env":"test","msg":"Returning original PDF buffer due to unlock failure"}
{"level":50,"time":1768363747660,"env":"test","error":{},"msg":"Failed to extract PDF fields"}
{"level":50,"time":1768363747660,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF processing failed"}
{"level":50,"time":1768363747660,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"81225c82-2b52-4f4d-bdfd-e27ca6001874"},"file":{"fieldname":"file","originalname":"test.pdf","encoding":"7bit","mimetype":"application/pdf","buffer":{"type":"Buffer","data":[37,80,68,70]},"size":4},"msg":"Error creating template"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768363747752,"env":"test","module":"auth-routes","userId":"9af66895-c7ac-4c77-856d-5dfd1abeb69f","msg":"User logged in successfully"}
{"level":50,"time":1768363747764,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"81225c82-2b52-4f4d-bdfd-e27ca6001874"},"msg":"Error creating template"}
{"level":50,"time":1768363747792,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"33b5edd0-69a4-4eca-8838-eeb4c62063c2","workflowId":"c65aa0d6-5404-45ff-b398-975762e2695c","versionId":"draft","type":"block.start","blockId":"68655d6f-1e64-445a-891b-eacc66305d31","pageId":"49bde400-c22c-42b3-9e90-1985ef8bc096","timestamp":"2026-01-14T04:09:07.406Z","isPreview":false,"payload":{"blockType":"validate"}},"msg":"Failed to record analytics event"}
{"level":30,"time":1768363747798,"env":"test","module":"audit-log-service","userId":"9af66895-c7ac-4c77-856d-5dfd1abeb69f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":30,"time":1768363747984,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

 [32mâœ“[39m tests/integration/auth/auth.middleware.integration.test.ts [2m([22m[2m27 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 41568[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow access with valid JWT Bearer token [33m 1307[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 when no token provided [33m 1229[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 with invalid token [33m 1177[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 with expired token [33m 2271[2mms[22m[39m
       [33m[2mâœ“[22m[39m should authenticate with JWT Bearer token [33m 1289[2mms[22m[39m
       [33m[2mâœ“[22m[39m should authenticate with refresh token cookie (GET only) [33m 1314[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject cookie auth for POST requests (mutation-strict) [33m 1201[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject cookie auth for PUT requests [33m 1151[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject cookie auth for DELETE requests [33m 1178[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow cookie auth for HEAD requests [33m 1406[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prioritize JWT over cookie when both present [33m 2513[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 when no auth provided [33m 1141[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 401 when both JWT and cookie are invalid [33m 1242[2mms[22m[39m
       [33m[2mâœ“[22m[39m should authenticate with JWT if provided [33m 1879[2mms[22m[39m
       [33m[2mâœ“[22m[39m should authenticate with cookie if JWT not provided [33m 1818[2mms[22m[39m
       [33m[2mâœ“[22m[39m should proceed anonymously if no auth provided [33m 1809[2mms[22m[39m
       [33m[2mâœ“[22m[39m should proceed anonymously if both JWT and cookie are invalid [33m 1711[2mms[22m[39m
       [33m[2mâœ“[22m[39m should only allow safe methods for cookie auth [33m 1297[2mms[22m[39m
       [33m[2mâœ“[22m[39m should ignore cookies when Bearer token present [33m 2448[2mms[22m[39m
       [33m[2mâœ“[22m[39m should attach userId to request [33m 1253[2mms[22m[39m
       [33m[2mâœ“[22m[39m should attach userEmail to request [33m 1277[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return consistent error format for missing token [33m 1168[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return consistent error format for invalid token [33m 1188[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return consistent error format for expired token [33m 2381[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle malformed JWT gracefully [33m 1288[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle JWT with wrong algorithm [33m 1267[2mms[22m[39m
{"level":50,"time":1768363748144,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"33b5edd0-69a4-4eca-8838-eeb4c62063c2","workflowId":"c65aa0d6-5404-45ff-b398-975762e2695c","versionId":"draft","type":"block.complete","blockId":"68655d6f-1e64-445a-891b-eacc66305d31","pageId":"49bde400-c22c-42b3-9e90-1985ef8bc096","timestamp":"2026-01-14T04:09:07.793Z","isPreview":false,"payload":{"blockType":"validate"}},"msg":"Failed to record analytics event"}
{"level":30,"time":1768363747985,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/mfa.flow.real.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 49685[2mms[22m[39m
       [33m[2mâœ“[22m[39m should complete full MFA setup flow [33m 2818[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject invalid TOTP code during setup [33m 2368[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not allow MFA setup if already enabled [33m 2017[2mms[22m[39m
       [33m[2mâœ“[22m[39m should generate unique backup codes [33m 2192[2mms[22m[39m
       [33m[2mâœ“[22m[39m should store hashed backup codes [33m 2271[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require MFA for enabled users [33m 1919[2mms[22m[39m
       [33m[2mâœ“[22m[39m should complete MFA login with valid TOTP [33m 2071[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject invalid TOTP during login [33m 2010[2mms[22m[39m
       [33m[2mâœ“[22m[39m should accept TOTP codes within 60-second window [33m 2705[2mms[22m[39m
       [33m[2mâœ“[22m[39m should login with valid backup code [33m 3293[2mms[22m[39m
       [33m[2mâœ“[22m[39m should mark backup code as used [33m 1582[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent backup code reuse [33m 4754[2mms[22m[39m
       [33m[2mâœ“[22m[39m should try TOTP before backup code [33m 2087[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return MFA status for user [33m 1716[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return backup codes count for MFA users [33m 2296[2mms[22m[39m
       [33m[2mâœ“[22m[39m should disable MFA with password verification [33m 3310[2mms[22m[39m
       [33m[2mâœ“[22m[39m should require correct password to disable MFA [33m 2528[2mms[22m[39m
       [33m[2mâœ“[22m[39m should regenerate backup codes [33m 2595[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return error if MFA not enabled [33m 1681[2mms[22m[39m
       [33m[2mâœ“[22m[39m should enforce MFA for tenant users when required by tenant [33m 2376[2mms[22m[39m
{"level":30,"time":1768363748357,"env":"test","msg":"Simulating External Send","destination":"Test Webhook","payload":{"message":"Hello Preview"}}
{"level":30,"time":1768363748437,"env":"test","module":"writeback-execution-service","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","msg":"Executing writeback mappings for completed run"}
{"level":30,"time":1768363748492,"env":"test","module":"writeback-execution-service","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","mappingCount":1,"msg":"Found writeback mappings"}
{"level":30,"time":1768363748623,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363748624,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363748703,"env":"test","module":"writeback-execution-service","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","mappingId":"0883b5ce-18d0-4710-858c-4e4b0165c8f1","tableId":"81f2f6bb-d1a7-4413-ad81-b99e61dbbfb5","msg":"Executing writeback mapping"}
{"level":30,"time":1768363748720,"env":"test","module":"user-credentials-repository","userId":"363fa8b7-cad2-42f6-a56b-f2b13c059749","msg":"User credentials created"}
{"level":30,"time":1768363748816,"env":"test","module":"email-queue","jobId":"861f0996-40cd-4b89-ab70-27c94f3d462c","to":"protected-test-IvM0OtcR5MU-REv9w5WOu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363748869,"env":"test","module":"auth-routes","userId":"363fa8b7-cad2-42f6-a56b-f2b13c059749","email":"protected-test-IvM0OtcR5MU-REv9w5WOu@example.com","msg":"User registered"}
 [32mâœ“[39m tests/integration/dataBlocks.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 8945[2mms[22m[39m
     [33m[2mâœ“[22m[39m should write data to DataVault via WriteBlock [33m 3497[2mms[22m[39m
     [33m[2mâœ“[22m[39m should query data from DataVault via QueryBlock and use in Logic [33m 3828[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mMixed Auth Scenarios[2m > [22m[2mshould handle request with both Bearer token and cookies
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363749126,"env":"test","module":"writeback-execution-service","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","mappingId":"0883b5ce-18d0-4710-858c-4e4b0165c8f1","columnCount":3,"msg":"Successfully created DataVault row"}
{"level":30,"time":1768363749127,"env":"test","module":"writeback-execution-service","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","rowsCreated":1,"errorCount":0,"msg":"Writeback execution completed"}
{"level":30,"time":1768363749127,"env":"test","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","rowsCreated":1,"msg":"DataVault writeback completed"}
{"level":30,"time":1768363749127,"env":"test","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","service":"DocumentGenerationService","msg":"Starting document generation for run"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":40,"time":1768363749234,"env":"test","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","service":"DocumentGenerationService","allSections":[{"id":"af801066-a65b-4044-a210-476d0e190e2d","config":{}}],"runId":"44feef14-dede-4bea-b00b-45f8dea543d1","msg":"No Final Documents sections found, skipping generation. This might cause the frontend to hang."}
{"level":30,"time":1768363749235,"env":"test","runId":"44feef14-dede-4bea-b00b-45f8dea543d1","msg":"Documents generated successfully"}
{"level":30,"time":1768363749268,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363749269,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/ownershipAccess.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 5125[2mms[22m[39m
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w38
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":50,"time":1768363749505,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"44feef14-dede-4bea-b00b-45f8dea543d1","workflowId":"b596812f-409f-4361-baf6-92567bf6011d","versionId":"draft","type":"workflow.complete","timestamp":"2026-01-14T04:09:09.452Z","isPreview":false,"payload":{"durationMs":1315,"stepCount":2}},"msg":"Failed to record analytics event"}
{"level":30,"time":1768363749513,"env":"test","module":"auth-routes","userId":"363fa8b7-cad2-42f6-a56b-f2b13c059749","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w38 (Reused: true)

{"level":50,"time":1768363749548,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"77e4a8fb-40e2-41eb-861c-64821a1e680c","workflowId":"c73d53e8-a5aa-457a-b980-dc7e25a6793c","versionId":"draft","type":"block.start","blockId":"e824e2bb-0db5-458e-a0a3-9f3d2e6afa7f","pageId":"e75ac590-2bba-49e8-b9e7-2034aa9854d9","timestamp":"2026-01-14T04:09:09.494Z","isPreview":false,"payload":{"blockType":"external_send"}},"msg":"Failed to record analytics event"}
{"level":30,"time":1768363749550,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363749566,"env":"test","module":"audit-log-service","userId":"363fa8b7-cad2-42f6-a56b-f2b13c059749","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mMixed Auth Scenarios[2m > [22m[2mshould handle request with both Bearer token and cookies
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363749622,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w40
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w40 (Reused: true)

{"level":30,"time":1768363749694,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363749711,"env":"test","msg":"External Send Completed","destination":"Test Webhook","success":true,"status":200}
{"level":30,"time":1768363749743,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":50,"time":1768363749765,"env":"test","error":{"length":137,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"input":{"runId":"77e4a8fb-40e2-41eb-861c-64821a1e680c","workflowId":"c73d53e8-a5aa-457a-b980-dc7e25a6793c","versionId":"draft","type":"block.complete","blockId":"e824e2bb-0db5-458e-a0a3-9f3d2e6afa7f","pageId":"e75ac590-2bba-49e8-b9e7-2034aa9854d9","timestamp":"2026-01-14T04:09:09.712Z","isPreview":false,"payload":{"blockType":"external_send"}},"msg":"Failed to record analytics event"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768363750162,"env":"test","module":"auth-routes","userId":"363fa8b7-cad2-42f6-a56b-f2b13c059749","msg":"User logged in successfully"}
{"level":30,"time":1768363750220,"env":"test","module":"audit-log-service","userId":"363fa8b7-cad2-42f6-a56b-f2b13c059749","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363750226,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363750226,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/externalSends.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 5140[2mms[22m[39m
     [33m[2mâœ“[22m[39m PREVIEW MODE: Should simulate send and NOT call fetch [33m 1662[2mms[22m[39m
     [33m[2mâœ“[22m[39m LIVE MODE: Should call fetch with mapped payload [33m 1407[2mms[22m[39m
{"level":30,"time":1768363750483,"env":"test","module":"user-credentials-repository","userId":"2b5c3135-8522-43f7-a837-c34955d671a6","msg":"User credentials created"}
{"level":30,"time":1768363750584,"env":"test","module":"email-queue","jobId":"839e8aab-f6b2-42e8-99ce-60f1b5a0b87f","to":"viewer-Jspjgo91fpZetfINJ0uGJ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/analytics_service.test.ts[2m > [22m[2mAnalytics Service Integration
[22m[39mMANUAL PATCH: Applied FK fix for workflow_run_events AND workflow_run_metrics

{"level":30,"time":1768363750639,"env":"test","module":"auth-routes","userId":"2b5c3135-8522-43f7-a837-c34955d671a6","email":"viewer-Jspjgo91fpZetfINJ0uGJ@example.com","msg":"User registered"}
{"level":40,"time":1768363750755,"env":"test","module":"rbac-middleware","userId":"2b5c3135-8522-43f7-a837-c34955d671a6","userRole":"viewer","permission":"workflow:run","path":"/workflows/eb90e3fe-eafb-430e-8f8f-d5fab13fd0a4/run","msg":"Permission denied"}
{"level":30,"time":1768363750784,"env":"test","module":"user-credentials-repository","userId":"d55f7007-3345-4adf-82ac-6635c1f8bdda","msg":"User credentials created"}
{"level":30,"time":1768363750884,"env":"test","module":"email-queue","jobId":"c0d01f90-8b54-4356-aea4-9fb3e1ec4c9c","to":"protected-test-uuX9SUT8AS_ruyW0xyD6_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363750908,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363750909,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363750937,"env":"test","module":"auth-routes","userId":"d55f7007-3345-4adf-82ac-6635c1f8bdda","email":"protected-test-uuX9SUT8AS_ruyW0xyD6_@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mMixed Auth Scenarios[2m > [22m[2mshould prioritize Bearer token over cookie when both present
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

 [32mâœ“[39m tests/unit/components/datavault/TableGridView.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 5252[2mms[22m[39m
     [33m[2mâœ“[22m[39m loads table schema and rows [33m 674[2mms[22m[39m
     [33m[2mâœ“[22m[39m enters edit mode on double click [33m 561[2mms[22m[39m
     [33m[2mâœ“[22m[39m updates cell value on blur [33m 838[2mms[22m[39m
     [33m[2mâœ“[22m[39m renders delete button for each row [33m 660[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363751226,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363751227,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/workflows/runtime-pipelines.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 7029[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create DataVault row on workflow completion [33m 991[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute writebacks via RunService.completeRun() [33m 2596[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768363751657,"env":"test","module":"auth-routes","userId":"d55f7007-3345-4adf-82ac-6635c1f8bdda","msg":"User logged in successfully"}
{"level":30,"time":1768363751708,"env":"test","module":"audit-log-service","userId":"d55f7007-3345-4adf-82ac-6635c1f8bdda","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mMixed Auth Scenarios[2m > [22m[2mshould prioritize Bearer token over cookie when both present
[22m[39mDEBUG: LOGIN HANDLER HIT

{"level":30,"time":1768363751773,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w33
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w33 (Reused: true)

{"level":30,"time":1768363751907,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363751955,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w44
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w44 (Reused: true)

{"level":30,"time":1768363752051,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w34
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363752103,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w34 (Reused: true)

{"level":30,"time":1768363752157,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363752222,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363752243,"env":"test","module":"writeback-execution-service","runId":"3e45f4c4-808f-4a07-8494-f229f5dc2bc0","workflowId":"ddd8f5a2-9c00-4827-a174-e3f2ea89a3a6","msg":"Executing writeback mappings for completed run"}
{"level":30,"time":1768363752295,"env":"test","runId":"3e45f4c4-808f-4a07-8494-f229f5dc2bc0","service":"DocumentGenerationService","msg":"Starting document generation for run"}
{"level":30,"time":1768363752298,"env":"test","module":"auth-routes","userId":"d55f7007-3345-4adf-82ac-6635c1f8bdda","msg":"User logged in successfully"}
{"level":30,"time":1768363752353,"env":"test","module":"audit-log-service","userId":"d55f7007-3345-4adf-82ac-6635c1f8bdda","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1768363752409,"env":"test","runId":"3e45f4c4-808f-4a07-8494-f229f5dc2bc0","service":"DocumentGenerationService","allSections":[],"runId":"3e45f4c4-808f-4a07-8494-f229f5dc2bc0","msg":"No Final Documents sections found, skipping generation. This might cause the frontend to hang."}
{"level":30,"time":1768363752409,"env":"test","runId":"3e45f4c4-808f-4a07-8494-f229f5dc2bc0","msg":"Documents generated successfully"}
{"level":30,"time":1768363752531,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363752553,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363752540,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363752540,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363752546,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363752552,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363752552,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363752553,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363752553,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363752776,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363752777,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363752809,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363752808,"env":"test","module":"user-credentials-repository","userId":"fffad4b4-759a-4dc5-86d3-687f3035789f","msg":"User credentials created"}
{"level":30,"time":1768363752838,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts[2m > [22m[2mIntake Workflow Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363752821,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363752822,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363752831,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363752837,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363752837,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363752838,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363752838,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363752910,"env":"test","module":"email-queue","jobId":"9ea7ec8e-60db-4350-af79-c9a436e6dce7","to":"user2-k0vAcB09ayb5UMak2DxQu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w41
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363752960,"env":"test","module":"auth-routes","userId":"fffad4b4-759a-4dc5-86d3-687f3035789f","email":"user2-k0vAcB09ayb5UMak2DxQu@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39m[Shim] Request to /api/auth/google, Session User ID: undefined

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w41 (Reused: true)

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mMixed Auth Scenarios[2m > [22m[2mshould prioritize Bearer token over cookie when both present
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w42
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w42 (Reused: true)

{"level":40,"time":1768363753233,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
 [32mâœ“[39m tests/integration/api.templates-runs.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 8459[2mms[22m[39m
         [33m[2mâœ“[22m[39m should list templates [33m 390[2mms[22m[39m
         [33m[2mâœ“[22m[39m should get template by ID [33m 305[2mms[22m[39m
         [33m[2mâœ“[22m[39m should update template name [33m 321[2mms[22m[39m
         [33m[2mâœ“[22m[39m should delete template [33m 446[2mms[22m[39m
         [33m[2mâœ“[22m[39m should reject without required permission [33m 689[2mms[22m[39m
         [33m[2mâœ“[22m[39m should list runs [33m 388[2mms[22m[39m
         [33m[2mâœ“[22m[39m should filter by workflowId [33m 409[2mms[22m[39m
         [33m[2mâœ“[22m[39m should get run by ID [33m 433[2mms[22m[39m
         [33m[2mâœ“[22m[39m should get run logs [33m 487[2mms[22m[39m
{"level":30,"time":1768363753283,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould list all runs with pagination
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768363753421,"env":"test","module":"user-credentials-repository","userId":"f27dab2d-f608-4587-92c4-9a7c0e9bb3bb","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by status
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363753535,"env":"test","module":"email-queue","jobId":"36cfee19-9ce7-4261-b612-3335bd1dc03c","to":"test-KRdF5CAtv_i_7QkAndYRj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by workflow
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768363753593,"env":"test","module":"auth-routes","userId":"f27dab2d-f608-4587-92c4-9a7c0e9bb3bb","email":"test-KRdF5CAtv_i_7QkAndYRj@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by project
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768363753652,"env":"test","module":"auth-routes","userId":"fffad4b4-759a-4dc5-86d3-687f3035789f","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by date range
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768363753710,"env":"test","module":"audit-log-service","userId":"fffad4b4-759a-4dc5-86d3-687f3035789f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768363753710,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363753711,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould search runs by query string
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

 [32mâœ“[39m tests/integration/collections.e2e.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 4469[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create multiple records [33m 399[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id[2m > [22m[2mshould get run by ID with all details
[22m[39m[Shim] Request to /api/runs/4e865f7e-6223-4ef2-a501-bf13ebb1d34d, Session User ID: test-user-runs-stage8

{"level":40,"time":1768363753876,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id[2m > [22m[2mshould return 404 for non-existent run
[22m[39m[Shim] Request to /api/runs/00000000-0000-0000-0000-000000000000, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id/logs[2m > [22m[2mshould get logs for a run
[22m[39m[Shim] Request to /api/runs/4e865f7e-6223-4ef2-a501-bf13ebb1d34d/logs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363754095,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363754157,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with same inputs
[22m[39m[Shim] Request to /api/runs/4e865f7e-6223-4ef2-a501-bf13ebb1d34d/rerun, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363754210,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363754096,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/analytics_service.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 5030[2mms[22m[39m
     [33m[2mâœ“[22m[39m should generate events and metrics on run completion [33m 3074[2mms[22m[39m
{"level":30,"time":1768363754228,"env":"test","module":"user-credentials-repository","userId":"73c65776-9ed4-49a5-b425-3ec6c3d70189","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363754297,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363754323,"env":"test","module":"email-queue","jobId":"ad974fef-8274-4c2c-b004-e9d59f0c8b9b","to":"protected-test-xow7pps_S2RVrKuc8KhDr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstderr[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with same inputs
[22m[39m[DEBUG Question] Node start executed. Key: start, Value: undefined. Context keys: 4

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w46
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363754365,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363754378,"env":"test","module":"auth-routes","userId":"73c65776-9ed4-49a5-b425-3ec6c3d70189","email":"protected-test-xow7pps_S2RVrKuc8KhDr@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w46 (Reused: true)

{"level":30,"time":1768363754408,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363754462,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mOptional Auth Routes[2m > [22m[2mshould allow unauthenticated access to optional auth routes
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with override inputs
[22m[39m[Shim] Request to /api/runs/4e865f7e-6223-4ef2-a501-bf13ebb1d34d/rerun, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w47
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w43
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w47 (Reused: true)

{"level":30,"time":1768363754603,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w43 (Reused: true)

[90mstderr[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with override inputs
[22m[39m[DEBUG Question] Node start executed. Key: start, Value: undefined. Context keys: 4

{"level":30,"time":1768363754698,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould return 404 for non-existent run
[22m[39m[Shim] Request to /api/runs/00000000-0000-0000-0000-000000000000/rerun, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/export.csv[2m > [22m[2mshould export runs to CSV
[22m[39m[Shim] Request to /api/runs/export.csv, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/export.csv[2m > [22m[2mshould export runs with filters applied
[22m[39m[Shim] Request to /api/runs/export.csv, Session User ID: test-user-runs-stage8

{"level":30,"time":1768363755091,"env":"test","module":"auth-routes","userId":"73c65776-9ed4-49a5-b425-3ec6c3d70189","msg":"User logged in successfully"}
{"level":30,"time":1768363755105,"env":"test","workflowId":"46ff9cdb-0044-4113-88d6-0eac5a9a38b1","userId":"f27dab2d-f608-4587-92c4-9a7c0e9bb3bb","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w49
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363755142,"env":"test","module":"audit-log-service","userId":"73c65776-9ed4-49a5-b425-3ec6c3d70189","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w49 (Reused: true)

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w45
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould compare two runs
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w45 (Reused: true)

{"level":30,"time":1768363755388,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363755389,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/variableSafety.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 3826[2mms[22m[39m
     [33m[2mâœ“[22m[39m REPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided [33m 653[2mms[22m[39m
     [33m[2mâœ“[22m[39m ScriptEngine resolves alias 'input_variable' when aliasMap is provided [33m 608[2mms[22m[39m
     [33m[2mâœ“[22m[39m REPRO: BlockRunner fails to resolve alias in CreateRecordConfig [33m 594[2mms[22m[39m
     [33m[2mâœ“[22m[39m BlockRunner logic resolves alias with aliasMap [33m 631[2mms[22m[39m
{"level":30,"time":1768363755496,"env":"test","connectionId":"07299a4a-3fe1-4b2f-bc66-773d75a04b8e","projectId":"efa98e90-5e66-4351-8474-9b54ea2be1e5","name":"Test OAuth2 Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363755611,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould identify changed input keys
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768363755677,"env":"test","module":"intake-service","runId":"b628a1df-8127-42df-b0a8-0f1dd1ace7fa","slug":"public-EOw_W4msBJrFocr4d-37q","msg":"Created intake run"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363755676,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould return 404 if run A not found
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

{"level":30,"time":1768363755823,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould return 404 if run B not found
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363756007,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363756058,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":50,"time":1768363756069,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:168:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":50,"time":1768363756071,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:168:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google authentication failed"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1768363756125,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1768363756126,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:92:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:158:23"},"msg":"Google token verification failed"}
{"level":50,"time":1768363756126,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:92:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:158:23"},"msg":"Google authentication failed"}
{"level":30,"time":1768363756145,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363756146,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w37
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363756180,"env":"test","module":"user-credentials-repository","userId":"962b7d31-69b1-4133-9f23-6556b0bf3d55","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mRBAC and Tenant Isolation[2m > [22m[2mshould enforce tenant isolation on runs list
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w37 (Reused: true)

{"level":30,"time":1768363756233,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363756281,"env":"test","module":"email-queue","jobId":"b9a396ea-9f93-4156-ba1b-f93f9f9a6280","to":"protected-test-LjvSB1dds1VMGXhGqLL7i@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mâœ“[39m tests/ui/datavault/TableCard.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 3661[2mms[22m[39m
     [33m[2mâœ“[22m[39m should call onDelete when delete button is clicked [33m 1146[2mms[22m[39m
{"level":30,"time":1768363756291,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363756323,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363756335,"env":"test","module":"auth-routes","userId":"962b7d31-69b1-4133-9f23-6556b0bf3d55","email":"protected-test-LjvSB1dds1VMGXhGqLL7i@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363756386,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests[2m > [22m[2mOptional Auth Routes[2m > [22m[2mshould enhance optional auth routes with user context when authenticated
[22m[39mDEBUG: LOGIN HANDLER HIT

[90mstderr[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39mCleanup error (non-fatal): error: syntax error at or near "="
    at [90mC:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mpg-pool[24m\index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.runs.graph.test.ts:256:9 {
  length: [33m90[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'42601'[39m,
  detail: [90mundefined[39m,
  hint: [90mundefined[39m,
  position: [32m'32'[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [90mundefined[39m,
  table: [90mundefined[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [90mundefined[39m,
  file: [32m'scan.l'[39m,
  line: [32m'1244'[39m,
  routine: [32m'scanner_yyerror'[39m
}

{"level":30,"time":1768363756473,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363756474,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363756536,"env":"test","module":"auth","email":"existing@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768363756625,"env":"test","connectionId":"43026fe5-d929-4f49-ac63-6c1dc9e6e9fa","projectId":"efa98e90-5e66-4351-8474-9b54ea2be1e5","name":"Status Test Connection","type":"oauth2_3leg","msg":"Connection created:"}
{"level":30,"time":1768363756828,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363756829,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363756845,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363756846,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363756849,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363756874,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363756859,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363756860,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363756865,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363756873,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363756874,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363756874,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363756874,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363756958,"env":"test","module":"auth","email":"refresh@example.com","msg":"OAuth2 login successful"}
 [32mâœ“[39m tests/integration/api.runs.graph.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 5014[2mms[22m[39m
       [33m[2mâœ“[22m[39m should re-run workflow with same inputs [33m 346[2mms[22m[39m
       [33m[2mâœ“[22m[39m should re-run workflow with override inputs [33m 341[2mms[22m[39m
       [33m[2mâœ“[22m[39m should compare two runs [33m 454[2mms[22m[39m
       [33m[2mâœ“[22m[39m should enforce tenant isolation on runs list [33m 520[2mms[22m[39m
 [32mâœ“[39m tests/unit/collab.client.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[33m 4182[2mms[22m[39m
     [33m[2mâœ“[22m[39m should add a comment [33m 636[2mms[22m[39m
     [33m[2mâœ“[22m[39m should allow comment owner to delete their comment [33m 328[2mms[22m[39m
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363757052,"env":"test","module":"auth-routes","userId":"962b7d31-69b1-4133-9f23-6556b0bf3d55","msg":"User logged in successfully"}
{"level":30,"time":1768363757104,"env":"test","module":"audit-log-service","userId":"962b7d31-69b1-4133-9f23-6556b0bf3d55","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstderr[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx[2m > [22m[2mTableGridView - Drag & Drop[2m > [22m[2mrenders DndContext wrapper
[22m[39mWarning: validateDOMNesting(...): <th> cannot appear as a child of <div>.
    at th
    at SortableColumnHeader (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/SortableColumnHeader.tsx:12:33)
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
Warning: validateDOMNesting(...): <div> cannot appear as a child of <tr>.
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

{"level":30,"time":1768363757358,"env":"test","module":"auth","email":"idtoken@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768363757387,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/integration/intake.workflow.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 5167[2mms[22m[39m
     [33m[2mâœ“[22m[39m should allow designating a workflow as Intake [33m 1267[2mms[22m[39m
     [33m[2mâœ“[22m[39m should allow linking a downstream workflow to an intake workflow [33m 1399[2mms[22m[39m
{"level":30,"time":1768363757388,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/auth/oauth2.callback.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 3434[2mms[22m[39m
       [33m[2mâœ“[22m[39m should initiate OAuth2 3-legged flow and generate authorization URL [33m 367[2mms[22m[39m
       [33m[2mâœ“[22m[39m should track OAuth2 connection status [33m 375[2mms[22m[39m
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w51
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w51 (Reused: true)

{"level":30,"time":1768363757588,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363757618,"env":"test","module":"intake-service","runId":"792224f2-1810-4908-a389-9dd7f336f317","slug":"optional-tlz5EbPCeofBXGwdsMYvF","userId":"962b7d31-69b1-4133-9f23-6556b0bf3d55","msg":"Created intake run"}
{"level":30,"time":1768363757641,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363757655,"env":"test","module":"user-credentials-repository","userId":"d4c1e331-e990-4e03-9040-cecd2eed5e50","msg":"User credentials created"}
{"level":30,"time":1768363757765,"env":"test","module":"email-queue","jobId":"91ed8e73-20ed-4f05-86a6-1e323dc452b4","to":"test-docx-tb7rUIA8H8uHAhvdmPNkE@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363757774,"env":"test","module":"auth","email":"minimal@example.com","msg":"OAuth2 login successful"}
{"level":40,"time":1768363757795,"env":"test","error":{},"msg":"libreoffice-convert not available, trying system LibreOffice"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

{"level":30,"time":1768363757822,"env":"test","module":"auth-routes","userId":"d4c1e331-e990-4e03-9040-cecd2eed5e50","email":"test-docx-tb7rUIA8H8uHAhvdmPNkE@example.com","msg":"User registered"}
{"level":50,"time":1768363757882,"env":"test","module":"auth","err":{"type":"Error","message":"Token verification failed","stack":"Error: Token verification failed\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:428:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":40,"time":1768363757925,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"libreoffice --headless --convert-to pdf --outdir \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\" \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\\simple-template-1768363757755.docx\"","stdout":"","stderr":"'libreoffice' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"System LibreOffice conversion failed"}
{"level":40,"time":1768363757925,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF conversion failed"}
{"level":40,"time":1768363757928,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1768363757928,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:92:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
{"level":30,"time":1768363757932,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363757933,"env":"test","msg":"DB: pool closed."}
{"level":50,"time":1768363757976,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token payload","stack":"Error: Invalid token payload\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:88:26)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
 [32mâœ“[39m tests/unit/docxRenderer.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 3246[2mms[22m[39m
       [33m[2mâœ“[22m[39m should use custom output name [33m 349[2mms[22m[39m
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w39
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363758030,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363758031,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w39 (Reused: true)

{"level":30,"time":1768363758056,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363758105,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363758122,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363758123,"env":"test","msg":"DB: pool closed."}
[90mstderr[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39mDeprecated method ".compile", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.compile (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:475:7)
    at TemplateScanner.validateBuffer (C:/Users/scoot/poll/VaultLogic/server/services/document/TemplateScanner.ts:192:13)
    at TemplateScanner.scanAndFix (C:/Users/scoot/poll/VaultLogic/server/services/document/TemplateScanner.ts:71:22)
    at C:/Users/scoot/poll/VaultLogic/server/api/templates.ts:333:52
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

 [32mâœ“[39m tests/integration/auth/oauth2.google.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 3921[2mms[22m[39m
       [33m[2mâœ“[22m[39m should successfully authenticate with valid Google ID token [33m 629[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update existing user on subsequent logins [33m 455[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create refresh token record in database [33m 429[2mms[22m[39m
       [33m[2mâœ“[22m[39m should support both "token" and "idToken" fields [33m 347[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle missing profile information gracefully [33m 367[2mms[22m[39m
 [32mâœ“[39m tests/integration/auth/protected.routes.test.ts [2m([22m[2m33 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 52045[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow access with valid Bearer token [33m 1380[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject access without Authorization header [33m 1295[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject access with empty Bearer token [33m 1276[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject access with malformed Authorization header [33m 1287[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject access with wrong token type [33m 1305[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow POST with valid Bearer token [33m 1341[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject POST without Bearer token [33m 1260[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject POST with invalid token [33m 1301[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow PUT with valid Bearer token [33m 1436[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject PUT without Bearer token [33m 1307[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow DELETE with valid Bearer token [33m 1440[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject DELETE without Bearer token [33m 1380[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow PATCH with valid Bearer token [33m 2030[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject PATCH without Bearer token [33m 1290[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle Bearer token with extra spaces [33m 1458[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle very long invalid token [33m 1388[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle empty Authorization header [33m 1362[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle Authorization header with only Bearer [33m 1374[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle multiple Authorization headers [33m 1280[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject token with SQL injection attempt [33m 1272[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject token with XSS attempt [33m 1251[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject token with missing userId [33m 1313[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject token with non-existent userId [33m 1362[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not allow user to access another user's resources [33m 2597[2mms[22m[39m
       [33m[2mâœ“[22m[39m should inject userId into request context [33m 1408[2mms[22m[39m
       [33m[2mâœ“[22m[39m should inject tenantId into request context [33m 1378[2mms[22m[39m
       [33m[2mâœ“[22m[39m should inject role into request context [33m 1417[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not apply general rate limiting to authenticated requests [33m 1881[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle request with both Bearer token and cookies [33m 1990[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prioritize Bearer token over cookie when both present [33m 3538[2mms[22m[39m
       [33m[2mâœ“[22m[39m should allow unauthenticated access to optional auth routes [33m 1913[2mms[22m[39m
       [33m[2mâœ“[22m[39m should enhance optional auth routes with user context when authenticated [33m 2017[2mms[22m[39m
{"level":30,"time":1768363758646,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363758673,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.projects.test.ts[2m > [22m[2mProjects API Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363758659,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363758660,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363758665,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363758672,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363758672,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363758673,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363758673,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstderr[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests[2m > [22m[2mPOST /api/workflows/:id/run - Template Node Execution[2m > [22m[2mshould execute workflow with template node and generate DOCX
[22m[39mDeprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:153:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:202:28)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:277:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:117:24

{"level":30,"time":1768363759345,"env":"test","module":"user-credentials-repository","userId":"536791e3-114b-45ea-870b-f6ccb02f9169","msg":"User credentials created"}
{"level":30,"time":1768363759346,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363759347,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363759453,"env":"test","module":"email-queue","jobId":"128b6504-fe9d-4079-b41a-36ba0af70ded","to":"test-projects-r09gG4jv9RDbLbgCk_eD0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363759523,"env":"test","module":"auth-routes","userId":"536791e3-114b-45ea-870b-f6ccb02f9169","email":"test-projects-r09gG4jv9RDbLbgCk_eD0@example.com","msg":"User registered"}
 [32mâœ“[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 4653[2mms[22m[39m
     [33m[2mâœ“[22m[39m renders DndContext wrapper [33m 308[2mms[22m[39m
     [33m[2mâœ“[22m[39m displays columns in order based on orderIndex [33m 1083[2mms[22m[39m
     [33m[2mâœ“[22m[39m maintains column order after successful reorder [33m 499[2mms[22m[39m
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

{"level":50,"time":1768363759712,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363759742,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstderr[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests[2m > [22m[2mPOST /api/workflows/:id/run - Template Node Execution[2m > [22m[2mshould handle missing template data gracefully
[22m[39mDeprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:153:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:202:28)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:277:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:117:24

{"level":30,"time":1768363759957,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":40,"time":1768363760143,"env":"test","msg":"Failed to parse legacy string condition: \"trigger == \", defaulting to visible"}
{"level":40,"time":1768363760144,"env":"test","msg":"Failed to parse legacy string condition: \"trigger == \", defaulting to visible"}
[90mstderr[2m | tests/integration/regression-REG-1.test.ts[2m > [22m[2mREG-1: Workflow Logic Regression
[22m[39mCleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at [90mC:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mpg-pool[24m\index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/integration/regression-REG-1.test.ts:85:13 {
  length: [33m376[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(c845c565-0a24-422f-8cbb-855adadcb0a2) is still referenced from table "workflow_versions".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'workflow_versions'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'workflow_versions_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

{"level":30,"time":1768363760210,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363760210,"env":"test","msg":"DB: pool closed."}
[90mstderr[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests[2m > [22m[2mGET /api/runs/:id/download - Download Generated DOCX
[22m[39mDeprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:153:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:202:28)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:277:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:117:24

 [32mâœ“[39m tests/integration/regression-REG-1.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 3138[2mms[22m[39m
       [33m[2mâœ“[22m[39m should block Next when required visible question is empty [33m 305[2mms[22m[39m
       [33m[2mâœ“[22m[39m should NOT block Next when required question is hidden [33m 371[2mms[22m[39m
       [33m[2mâœ“[22m[39m should skip hidden required page entirely [33m 410[2mms[22m[39m
       [33m[2mâœ“[22m[39m should enforce required on visible page [33m 388[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w60
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstderr[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39mCleanup error (non-fatal): error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at [90mC:\Users\scoot\poll\VaultLogic\[39mnode_modules\[4mpg-pool[24m\index.js:45:11
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.runs.docx.test.ts:198:9 {
  length: [33m311[39m,
  severity: [32m'ERROR'[39m,
  code: [32m'23503'[39m,
  detail: [32m'Key (id)=(d4c1e331-e990-4e03-9040-cecd2eed5e50) is still referenced from table "runs".'[39m,
  hint: [90mundefined[39m,
  position: [90mundefined[39m,
  internalPosition: [90mundefined[39m,
  internalQuery: [90mundefined[39m,
  where: [90mundefined[39m,
  schema: [32m'public'[39m,
  table: [32m'runs'[39m,
  column: [90mundefined[39m,
  dataType: [90mundefined[39m,
  constraint: [32m'runs_created_by_users_id_fk'[39m,
  file: [32m'ri_triggers.c'[39m,
  line: [32m'2612'[39m,
  routine: [32m'ri_ReportViolation'[39m
}

{"level":30,"time":1768363761064,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363761064,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w60 (Reused: true)

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w52
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w52 (Reused: true)

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

 [32mâœ“[39m tests/integration/api.runs.docx.test.ts [2m([22m[2m6 tests[22m[2m)[22m[33m 5356[2mms[22m[39m
       [33m[2mâœ“[22m[39m should execute workflow with template node and generate DOCX [33m 603[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle missing template data gracefully [33m 376[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

{"level":30,"time":1768363761848,"env":"test","module":"user-credentials-repository","userId":"bcb3737f-4ba1-4715-b0fb-efe1962a7b1e","msg":"User credentials created"}
{"level":30,"time":1768363761947,"env":"test","module":"email-queue","jobId":"760ef9dd-cde2-4c67-a64b-a628d807dfaf","to":"other-272CtehsNPIUi5LXvGJbV@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363761997,"env":"test","module":"auth-routes","userId":"bcb3737f-4ba1-4715-b0fb-efe1962a7b1e","email":"other-272CtehsNPIUi5LXvGJbV@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w56
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w61
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w56 (Reused: true)

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w61 (Reused: true)

{"level":30,"time":1768363762322,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363762323,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363762412,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363762413,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363762455,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363762480,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/ui/runs.components.test.tsx [2m([22m[2m19 tests[22m[2m)[22m[33m 8260[2mms[22m[39m
       [33m[2mâœ“[22m[39m should show download options for successful runs [33m 2789[2mms[22m[39m
       [33m[2mâœ“[22m[39m should call onChange when status filter changes [33m 1175[2mms[22m[39m
       [33m[2mâœ“[22m[39m should call onChange when search is submitted [33m 430[2mms[22m[39m
{"level":30,"time":1768363762555,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363762560,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w54
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w54 (Reused: true)

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w57
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/integration/api.projects.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 4855[2mms[22m[39m
       [33m[2mâœ“[22m[39m should soft-delete project [33m 319[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not allow cross-tenant access [33m 992[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w57 (Reused: true)

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363763075,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363763159,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363763203,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363763204,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363763229,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/services/docxHelpers.test.ts [2m([22m[2m39 tests[22m[2m)[22m[33m 2616[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w55
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w55 (Reused: true)

{"level":30,"time":1768363763398,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w58
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w62
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w58 (Reused: true)

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w62 (Reused: true)

{"level":30,"time":1768363763478,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w59
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w59 (Reused: true)

{"level":30,"time":1768363763804,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363763805,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/workflow/QueryBlock.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2233[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363763915,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363763988,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363764209,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w63
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w63 (Reused: true)

{"level":30,"time":1768363764371,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363764372,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363764437,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/ui/common/Breadcrumbs.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 2876[2mms[22m[39m
{"level":30,"time":1768363764459,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363764511,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363764523,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363764588,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768363764764,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363764765,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363764823,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363764822,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363764858,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363764886,"env":"test","msg":"DB: initialized flag set."}
 [32mâœ“[39m tests/unit/components/datavault/CellRenderer.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 4058[2mms[22m[39m
     [33m[2mâœ“[22m[39m renders boolean value as Yes/No [33m 632[2mms[22m[39m
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363764990,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363765021,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363765021,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/ui/datavault/TemplateCard.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[33m 2748[2mms[22m[39m
{"level":30,"time":1768363765061,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

 [32mâœ“[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 3256[2mms[22m[39m
{"level":30,"time":1768363765094,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363765095,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w48
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/integration/auth.routes.test.ts [2m([22m[2m41 tests[22m[2m)[22m[33m 2033[2mms[22m[39m
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w48 (Reused: true)

{"level":30,"time":1768363765185,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w50
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w50 (Reused: true)

{"level":30,"time":1768363765253,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363765253,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363765306,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w66
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363765313,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w66 (Reused: true)

{"level":30,"time":1768363765361,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":30,"time":1768363765734,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363765735,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w67
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363765784,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363765791,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1768363765807,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts[2m > [22m[2mExpression Validation API Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363765791,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768363765796,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1768363765795,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363765796,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363765801,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363765806,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363765806,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363765807,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363765807,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w67 (Reused: true)

 [32mâœ“[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 2834[2mms[22m[39m
{"level":30,"time":1768363765884,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363765887,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
{"level":30,"time":1768363765908,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/js_helpers.test.ts[2m > [22m[2mDetailed Verification: JS Helper Availability
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363765894,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363765895,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363765901,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363765907,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363765907,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363765908,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363765908,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768363765971,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363765972,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

 [32mâœ“[39m tests/unit/services/docxRenderer2.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 2159[2mms[22m[39m
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w68
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363766058,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1768363766058,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768363766058,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1768363766068,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w65
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363766087,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w68 (Reused: true)

{"level":30,"time":1768363766088,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363766089,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w65 (Reused: true)

{"level":30,"time":1768363766122,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363766172,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [32mâœ“[39m tests/integration/metrics.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 2944[2mms[22m[39m
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w70
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w70 (Reused: true)

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w69
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":40,"time":1768363766313,"env":"test","workflowId":"54d68ff7-00ef-4c3d-b3c8-2d859f883bcd","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":30,"time":1768363766339,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363766340,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w69 (Reused: true)

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363766406,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363766454,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363766491,"env":"test","module":"user-credentials-repository","userId":"d22eb10e-d235-4f7a-8a5c-0ce3b89cfaab","msg":"User credentials created"}
 [32mâœ“[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 3527[2mms[22m[39m
     [33m[2mâœ“[22m[39m should render database settings page with breadcrumbs [33m 585[2mms[22m[39m
{"level":30,"time":1768363766589,"env":"test","module":"email-queue","jobId":"9c8c4b04-86aa-4235-b9e2-ba978762c534","to":"test-gjOt6X9T-lldee6AyqmVi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768363766645,"env":"test","module":"auth-routes","userId":"d22eb10e-d235-4f7a-8a5c-0ce3b89cfaab","email":"test-gjOt6X9T-lldee6AyqmVi@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

{"level":30,"time":1768363766701,"env":"test","module":"runs-routes","runId":"4b1b8d01-efbe-4a41-aeca-138b3f2e27c1","sectionId":"d434dab6-e391-4803-8eab-65b3b2e05465","valuesType":"object","isArray":true,"valuesLength":0,"bodyKeys":["values"],"msg":"Section submit request received"}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363766852,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363766902,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w71
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w71 (Reused: true)

[90mstderr[2m | tests/unit/shared/workflowLogic.test.ts[2m > [22m[2mworkflowLogic[2m > [22m[2mevaluateRules[2m > [22m[2mOperators[2m > [22m[2mUnknown operator[2m > [22m[2mshould return false and log warning for unknown operator
[22m[39mUnknown operator: unknown_operator

{"level":30,"time":1768363767089,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363767090,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/shared/workflowLogic.test.ts [2m([22m[2m65 tests[22m[2m)[22m[33m 2189[2mms[22m[39m
{"level":40,"time":1768363767205,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363767328,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w72
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363767374,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363767397,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w72 (Reused: true)

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363767423,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363767450,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363767451,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363767454,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

 [32mâœ“[39m tests/unit/utils/conditionalLogic-simple.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2126[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w73
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w64
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363767544,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w73 (Reused: true)

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w64 (Reused: true)

{"level":50,"time":1768363767638,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768363767679,"env":"test","blockId":"53d75f59-cddc-4c38-b780-35cae8016189","virtualStepId":"979e0b80-92e2-4bdb-b89a-79f0e2d9073e","outputVar":"userList","msg":"Created read table block with virtual step"}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w75
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":50,"time":1768363767819,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w74
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w75 (Reused: true)

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

{"level":30,"time":1768363767864,"env":"test","module":"runs-routes","runId":"4b1b8d01-efbe-4a41-aeca-138b3f2e27c1","sectionId":"d434dab6-e391-4803-8eab-65b3b2e05465","msg":"Section submitted successfully"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w74 (Reused: true)

{"level":30,"time":1768363767923,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363767923,"env":"test","msg":"DB: pool closed."}
[90mstderr[2m | tests/unit/client/choice-utils.test.ts[2m > [22m[2mchoice-utils[2m > [22m[2mhandles missing content gracefully
[22m[39m[generateOptionsFromList] Invalid list data: [1mnull[22m

{"level":30,"time":1768363767943,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363767944,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363767977,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363767978,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/client/choice-utils.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2282[2mms[22m[39m
{"level":50,"time":1768363767997,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mâœ“[39m tests/integration/mfa.flow.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 2115[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363768096,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363768143,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363768144,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363768168,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363768169,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/dynamic_options_workflow.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 2482[2mms[22m[39m
     [33m[2mâœ“[22m[39m should successfully configure a workflow with Read Table -> Dynamic Choice [33m 445[2mms[22m[39m
 [32mâœ“[39m tests/unit/utils/variableResolver.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 2294[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363768257,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363768270,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363768271,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w53
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w53 (Reused: true)

{"level":30,"time":1768363768358,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363768417,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

 [32mâœ“[39m tests/integration/js_helpers.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 3142[2mms[22m[39m
     [33m[2mâœ“[22m[39m should execute a JS block that uses helper functions [33m 1788[2mms[22m[39m
{"level":30,"time":1768363768438,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363768516,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363768544,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363768573,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w76
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363768638,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w76 (Reused: true)

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w77
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363768756,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/integration/api.expression-validation.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 3557[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w77 (Reused: true)

{"level":30,"time":1768363768812,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363768903,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1768363768925,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363768931,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363768959,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363768931,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363769005,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363769050,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":40,"time":1768363769058,"env":"test","module":"rbac-middleware","path":"/api/workflows","permission":"workflow:create","msg":"Unauthenticated user attempted to access protected resource"}
 [32mâœ“[39m tests/unit/workflows/validation.test.ts [2m([22m[2m66 tests[22m[2m)[22m[33m 2584[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts[2m > [22m[2mData Sources API - Native Catalog
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":40,"time":1768363769062,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permission":"workflow:create","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1768363769064,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"permission":"workflow:view","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1768363769065,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permissions":["workflow:create","workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (none of required permissions)"}
{"level":40,"time":1768363769067,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","permissions":["workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (missing some required permissions)"}
{"level":40,"time":1768363769069,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1768363769070,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"requiredRoles":["owner"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1768363769071,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","requiredRoles":["owner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768363769072,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"runner","requiredRoles":["owner","builder"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768363769074,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder","runner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768363769077,"env":"test","module":"rbac-middleware","path":"/api/test","permission":"workflow:view","msg":"Unauthenticated user attempted to access protected resource"}
{"level":40,"time":1768363769077,"env":"test","module":"rbac-middleware","userId":"user-123","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":40,"time":1768363769077,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"invalid-role","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":30,"time":1768363769078,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363769078,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363769025,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363769026,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363769033,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363769049,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363769050,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363769050,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363769050,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
 [32mâœ“[39m tests/unit/middleware/rbac.test.ts [2m([22m[2m44 tests[22m[2m)[22m[33m 2158[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363769152,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363769153,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

 [32mâœ“[39m tests/unit/services/RunExecutionCoordinator.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 2097[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w78
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w78 (Reused: true)

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w79
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363769535,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363769536,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363769550,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363769552,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363769553,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/ui/builder.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 2194[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w79 (Reused: true)

 [32mâœ“[39m tests/unit/engine.expr.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 2140[2mms[22m[39m
{"level":30,"time":1768363769602,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363769715,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363769716,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w80
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363769739,"env":"test","module":"user-credentials-repository","userId":"cb2d9d45-68c1-4761-9c19-b6fcaa15fdbc","msg":"User credentials created"}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w81
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w80 (Reused: true)

 [32mâœ“[39m tests/ui/datavault/ColumnTypeIcon.test.tsx [2m([22m[2m27 tests[22m[2m)[22m[33m 2691[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w81 (Reused: true)

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w82
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363769843,"env":"test","module":"email-queue","jobId":"1888fded-7038-442f-87f2-3a221df67e59","to":"test-dd0ndzdiFGKWgt0dB7-uG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w82 (Reused: true)

{"level":30,"time":1768363769912,"env":"test","module":"auth-routes","userId":"cb2d9d45-68c1-4761-9c19-b6fcaa15fdbc","email":"test-dd0ndzdiFGKWgt0dB7-uG@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

{"level":30,"time":1768363770153,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768363770154,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768363770155,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":66,"totalTokens":878,"durationMs":1,"estimatedCostUSD":0.00010760000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768363770158,"env":"test","module":"ai-service","duration":5,"workflowId":"123","changeCount":1,"msg":"AI workflow revision succeeded"}
{"level":30,"time":1768363770162,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768363770162,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768363770162,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":45,"totalTokens":857,"durationMs":0,"estimatedCostUSD":0.00009920000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768363770163,"env":"test","module":"ai-service","duration":1,"workflowId":"123","changeCount":0,"msg":"AI workflow revision succeeded"}
{"level":30,"time":1768363770163,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768363770163,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768363770164,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":1,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1768363770164,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1768363770164,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1768363770164,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":1,"msg":"AI workflow revision failed"}
{"level":40,"time":1768363770165,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"actualOutputTokens":4,"responseLength":13,"msg":"Single-shot revision truncated - automatically retrying with chunking"}
{"level":30,"time":1768363770165,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768363770165,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1768363770165,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1768363770165,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1768363770165,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":0,"msg":"AI workflow revision failed"}
{"level":50,"time":1768363770165,"env":"test","module":"ai-service","duration":2,"error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"msg":"AI workflow revision failed"}
{"level":30,"time":1768363770168,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363770168,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363770262,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/services/AIService.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1979[2mms[22m[39m
{"level":30,"time":1768363770347,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363770426,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w84
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w84 (Reused: true)

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363770531,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363770570,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363770576,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363770701,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363770757,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w85
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w85 (Reused: true)

{"level":30,"time":1768363770850,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363770851,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/shared/validation/Validator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 2568[2mms[22m[39m
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w86
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w86 (Reused: true)

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363771025,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768363771046,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363771047,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363771070,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363771087,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363771127,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363771133,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363771128,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/conditions/conditionEvaluation.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2059[2mms[22m[39m
{"level":30,"time":1768363771251,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363771252,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/captcha.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 2277[2mms[22m[39m
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w87
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w87 (Reused: true)

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w83
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w89
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w83 (Reused: true)

{"level":30,"time":1768363771414,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/integration/api.dataSources.native.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 3183[2mms[22m[39m
     [33m[2mâœ“[22m[39m should list databases and databases' tables in the catalog [33m 395[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w89 (Reused: true)

[90mstderr[2m | tests/unit/shared/conditionEvaluator.test.ts[2m > [22m[2mconditionEvaluator[2m > [22m[2mComparison operators[2m > [22m[2mUnknown operator[2m > [22m[2mshould default to true and log warning
[22m[39mUnknown operator: unknown_operator

{"level":30,"time":1768363771463,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363771466,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363771471,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/shared/conditionEvaluator.test.ts [2m([22m[2m70 tests[22m[2m)[22m[33m 2160[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w90
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363771594,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363771595,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/intake.portal.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2170[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w90 (Reused: true)

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363771643,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363771653,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363771654,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363771703,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

 [32mâœ“[39m tests/unit/utils/conditionalLogic.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 2269[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363771796,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768363771871,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363772129,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

{"level":30,"time":1768363772185,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363772269,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363772270,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2409[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w91
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w88
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w91 (Reused: true)

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w88 (Reused: true)

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

{"level":30,"time":1768363772434,"env":"test","module":"version-service","workflowId":"27913743-1831-4123-b60a-5f65c0f47be5","versionId":"904b3460-dde0-45cc-8433-587aaf9545f7","userId":"20eda50d-e258-4c3c-a7b6-21ef96e14aba","versionNumber":1,"msg":"Published new version"}
{"level":50,"time":1768363772467,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"datavault.createTable","databaseId":"db-123","name":"Submissions","columns":[{"name":"email","type":"text"},{"name":"submitted_at","type":"date"}]},"msg":"Failed to apply operation"}
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w92
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":50,"time":1768363772467,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"datavault.addColumns","tableId":"table-123","columns":[{"name":"phone","type":"text"}]},"msg":"Failed to apply operation"}
{"level":50,"time":1768363772470,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"step.create","sectionRef":"temp-section-1","type":"short_text","title":"Field 1","alias":"field1"},"msg":"Failed to apply operation"}
{"level":50,"time":1768363772529,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"document.bindFields","id":"template-123","bindings":{"client_name":"nonExistentAlias"}},"msg":"Failed to apply operation"}
{"level":30,"time":1768363772533,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363772534,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363772535,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w92 (Reused: true)

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

{"level":30,"time":1768363772574,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/services/WorkflowPatchService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 2206[2mms[22m[39m
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363772621,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363772635,"env":"test","module":"version-service","workflowId":"27913743-1831-4123-b60a-5f65c0f47be5","versionId":"477f1fd8-fa3c-4232-b551-983d39863dcd","userId":"20eda50d-e258-4c3c-a7b6-21ef96e14aba","versionNumber":2,"msg":"Published new version"}
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363772640,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363772671,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363772685,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363772789,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363772790,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/session.management.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 2285[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w95
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w95 (Reused: true)

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w93
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w96
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w93 (Reused: true)

{"level":30,"time":1768363773152,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363773153,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w97
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w96 (Reused: true)

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w97 (Reused: true)

{"level":30,"time":1768363773199,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363773211,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363773213,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/workflow_versioning.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2192[2mms[22m[39m
     [33m[2mâœ“[22m[39m should create a version and populate changelog [33m 410[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w94
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363773242,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363773242,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363773255,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363773255,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363773257,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

 [32mâœ“[39m tests/unit/services/repeater.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2394[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w94 (Reused: true)

 [32mâœ“[39m tests/unit/shared/validation/stepConfigSchemas.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2069[2mms[22m[39m
 [32mâœ“[39m tests/unit/utils/encryption.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 2266[2mms[22m[39m
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363773376,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363773433,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

{"level":50,"time":1768363773789,"env":"test","status":401,"statusText":"Unauthorized","error":"Invalid client credentials","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1768363773789,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773792,"env":"test","data":{"token_type":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1768363773792,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773792,"env":"test","data":{"access_token":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1768363773793,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773794,"env":"test","error":"Network error: ECONNREFUSED","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363773923,"env":"test","msg":"DB: initializing... Local"}
{"level":50,"time":1768363773925,"env":"test","error":"Invalid credentials","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":50,"time":1768363773926,"env":"test","error":"ECONNREFUSED","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773932,"env":"test","status":400,"statusText":"Bad Request","error":"Invalid grant_type","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1768363773932,"env":"test","error":"OAuth2 token request failed: 400 Bad Request","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773933,"env":"test","status":401,"statusText":"Unauthorized","error":"Client authentication failed","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1768363773933,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773934,"env":"test","status":403,"statusText":"Forbidden","error":"Access denied","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1768363773934,"env":"test","error":"OAuth2 token request failed: 403 Forbidden","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773935,"env":"test","status":500,"statusText":"Internal Server Error","error":"Server error","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token request failed"}
{"level":50,"time":1768363773935,"env":"test","error":"OAuth2 token request failed: 500 Internal Server Error","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773936,"env":"test","error":"Unexpected token in JSON","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768363773938,"env":"test","error":"Request timeout","tokenUrl":"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢","msg":"OAuth2 token fetch error"}
{"level":30,"time":1768363773941,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363773942,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363773978,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363774009,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363774010,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w100
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/integration/auth/oauth2.client-credentials.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 2061[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w98
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w100 (Reused: true)

 [32mâœ“[39m tests/unit/services/TemplateAnalysisService.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 1920[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w98 (Reused: true)

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363774195,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363774200,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/services/MfaService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 2243[2mms[22m[39m
         [33m[2mâœ“[22m[39m should try multiple codes if first doesn't match [33m 490[2mms[22m[39m
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363774249,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363774280,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w99
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363774310,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363774328,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w99 (Reused: true)

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363774556,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363774607,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mMOCK SETUP DONE. Mock questions: [
  {
    id: [32m'q1'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q1'[39m,
    order: [33m0[39m,
    isVirtual: [33mfalse[39m,
    alias: [32m'show'[39m,
    visibleIf: [1mnull[22m
  },
  {
    id: [32m'q2'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q2'[39m,
    order: [33m1[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: { op: [32m'equals'[39m, left: [36m[Object][39m, right: [36m[Object][39m }
  },
  {
    id: [32m'q3'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q3'[39m,
    order: [33m2[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: [1mnull[22m
  }
]
Calling getVisibleQuestionCount...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mCOUNT RESULT: [33m0[39m
Mock called times: [33m1[39m
Mock last call args: [ [ [32m'section1'[39m ] ]

{"level":50,"time":1768363774625,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363774628,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363774628,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/services/intakeQuestionVisibility.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 2263[2mms[22m[39m
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":30,"time":1768363774851,"env":"test","warnings":["Python code does not call emit(). Script will not produce output."],"msg":"Script validation warnings"}
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363774861,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363774862,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/listPipeline.semantics.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363774854,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363774855,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w104
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/unit/listPipeline.semantics.test.ts [2m([22m[2m70 tests[22m[2m)[22m[33m 2122[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w104 (Reused: true)

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mâœ“[39m tests/unit/ScriptEngine.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 2221[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w102
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w101
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w102 (Reused: true)

{"level":30,"time":1768363775032,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w101 (Reused: true)

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":30,"time":1768363775033,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/HelperLibrary.test.ts [2m([22m[2m60 tests[22m[2m)[22m[33m 2226[2mms[22m[39m
{"level":30,"time":1768363775130,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363775131,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363775146,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/WorkflowChangeAnalyzer.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 2444[2mms[22m[39m
{"level":30,"time":1768363775196,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363775259,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363775309,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w103
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w105
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w103 (Reused: true)

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363775402,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w105 (Reused: true)

{"level":30,"time":1768363775454,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w107
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w106
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w107 (Reused: true)

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w106 (Reused: true)

{"level":30,"time":1768363775759,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363775760,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/api.ai.test.ts [2m([22m[2m32 tests[22m[2m)[22m[33m 2232[2mms[22m[39m
{"level":50,"time":1768363775845,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":50,"time":1768363775847,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating skipIf condition"}
{"level":30,"time":1768363775850,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363775851,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/services/intakeNavigation.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 2304[2mms[22m[39m
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w108
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w108 (Reused: true)

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363775981,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363776020,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363776026,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768363776035,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768363776085,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":30,"time":1768363776026,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"responseTokens":91,"totalTokens":1303,"durationMs":1,"estimatedCostUSD":0.014849999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768363776033,"env":"test","module":"workflow-quality-validator","overall":99,"breakdown":{"aliases":100,"types":100,"structure":100,"ux":95,"completeness":100,"validation":100},"issuesCount":1,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768363776033,"env":"test","module":"ai-service","duration":9,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":99,"qualityBreakdown":{"aliases":100,"types":100,"structure":100,"ux":95,"completeness":100,"validation":100},"qualityPassed":true,"issuesCount":1,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768363776038,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768363776039,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":49,"totalTokens":1250,"durationMs":0,"estimatedCostUSD":0.013479999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768363776039,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"ðŸ”§ Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768363776043,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768363776044,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":68,"totalTokens":1269,"durationMs":1,"estimatedCostUSD":0.01405,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768363776044,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"ðŸ”§ Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768363776047,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768363776047,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":89,"totalTokens":1290,"durationMs":0,"estimatedCostUSD":0.014679999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768363776047,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"ðŸ”§ Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1768363776051,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1768363776051,"env":"test","module":"ai-service","attempt":0,"waitMs":1000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768363776051,"env":"test","module":"ai-service","attempt":1,"waitMs":2000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768363776051,"env":"test","module":"ai-service","attempt":2,"waitMs":4000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768363776091,"env":"test","module":"ai-service","attempt":3,"waitMs":8000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768363776091,"env":"test","module":"ai-service","attempt":4,"waitMs":16000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768363776104,"env":"test","module":"ai-service","attempt":5,"waitMs":32000,"msg":"Rate limit hit, retrying..."}
{"level":50,"time":1768363776108,"env":"test","module":"ai-service","event":"ai_request_failed","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","errorType":"RATE_LIMIT","durationMs":54,"attempts":7,"msg":"AI request failed: rate limit"}
{"level":50,"time":1768363776109,"env":"test","module":"ai-service","error":{"code":"RATE_LIMIT","details":{"originalError":"Rate limit exceeded","retryAfterSeconds":60},"troubleshooting":"ðŸ”§ Troubleshooting Steps:\n1. You've hit the AI provider's rate limit\n2. Solutions:\n   - Wait 60 seconds and try again\n   - Check your API key quota at your provider's dashboard\n   - Consider upgrading your API plan for higher limits\n   - If using free tier, you may need to wait until limits reset"},"duration":57,"msg":"AI workflow generation failed"}
{"level":30,"time":1768363776134,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768363776141,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":6,"totalTokens":1207,"durationMs":25,"estimatedCostUSD":0.01219,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768363776142,"env":"test","module":"ai-service","error":{},"duration":26,"msg":"AI workflow generation failed"}
{"level":30,"time":1768363776148,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768363776149,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"responseTokens":68,"totalTokens":1280,"durationMs":1,"estimatedCostUSD":0.004656,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768363776149,"env":"test","module":"workflow-quality-validator","overall":100,"breakdown":{"aliases":100,"types":100,"structure":100,"ux":100,"completeness":100,"validation":100},"issuesCount":0,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768363776149,"env":"test","module":"ai-service","duration":1,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":100,"qualityBreakdown":{"aliases":100,"types":100,"structure":100,"ux":100,"completeness":100,"validation":100},"qualityPassed":true,"issuesCount":0,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768363776152,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768363776153,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"responseTokens":33,"totalTokens":1234,"durationMs":1,"estimatedCostUSD":0.004098,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768363776153,"env":"test","module":"workflow-quality-validator","overall":96,"breakdown":{"aliases":100,"types":100,"structure":80,"ux":100,"completeness":90,"validation":100},"issuesCount":2,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768363776153,"env":"test","module":"ai-service","duration":1,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":96,"qualityBreakdown":{"aliases":100,"types":100,"structure":80,"ux":100,"completeness":90,"validation":100},"qualityPassed":true,"issuesCount":2,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768363776157,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"maxTokens":4000,"msg":"AI request started"}
{"level":30,"time":1768363776158,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"responseTokens":44,"totalTokens":302,"durationMs":1,"estimatedCostUSD":0.0039,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768363776158,"env":"test","module":"ai-service","duration":1,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
{"level":30,"time":1768363776159,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363776160,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/ai.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 2331[2mms[22m[39m
{"level":30,"time":1768363776291,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/WorkflowService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1745[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return workflow if user is the creator [33m 1238[2mms[22m[39m
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363776461,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363776531,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w110
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363776565,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w110 (Reused: true)

{"level":30,"time":1768363776626,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363776627,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363776657,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363776659,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363776692,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

 [32mâœ“[39m tests/unit/utils/pagination.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 2137[2mms[22m[39m
 [32mâœ“[39m tests/unit/workflows/conditionTruthTable.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 2060[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363776940,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363776985,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363776988,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363776997,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363777040,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363777043,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":40,"time":1768363777076,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363777262,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363777262,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/client/list-choice-options.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 2331[2mms[22m[39m
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":40,"time":1768363777126,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768363777184,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768363777218,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768363777245,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768363777308,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363777309,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w113
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/unit/isolatedVmBridge.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 2411[2mms[22m[39m
[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w113 (Reused: true)

{"level":40,"time":1768363777549,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":50,"time":1768363777564,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363777566,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363777566,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363777567,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363777567,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363777567,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768363777569,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"JWT Strategy verification failed"}
{"level":50,"time":1768363777570,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363777571,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363777571,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768363777571,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768363777573,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
{"level":30,"time":1768363777573,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363777574,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363777611,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363777611,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/middleware/auth.middleware.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 2460[2mms[22m[39m
 [32mâœ“[39m tests/unit/engine/Performance.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2547[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363777661,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363777662,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363777669,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/shared/validation/PageValidator.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2156[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w111
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363777713,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w111 (Reused: true)

{"level":30,"time":1768363777753,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363777803,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768363778309,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363778310,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/WorkflowOptimizationService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 2254[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768363778765,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363778766,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w116
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/integration/analytics_preservation.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1547[2mms[22m[39m
     [33m[2mâœ“[22m[39m should preserve lifetime user count when a user is deleted [33m 463[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w116 (Reused: true)

{"level":30,"time":1768363778864,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363778936,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/BlockRunner.validate.test.ts [2m([22m[2m7 tests[22m[2m)[22m[33m 2196[2mms[22m[39m
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363779474,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363779476,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w117
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/unit/services/DataSourceService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 1099[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w117 (Reused: true)

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363779604,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w118
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w118 (Reused: true)

{"level":30,"time":1768363779673,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363779714,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363779722,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w115
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w115 (Reused: true)

{"level":30,"time":1768363779923,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768363779979,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w114
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w114 (Reused: true)

{"level":30,"time":1768363780051,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363780112,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts[2m > [22m[2mDatavaultColumnsService[2m > [22m[2mgetColumns[2m > [22m[2mshould throw 404 if table not found
[22m[39m[DEBUG] Table not found: 660e8400-e29b-41d4-a716-446655440001

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363780388,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363780388,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363780424,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363780425,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/schema/documentEngine.test.ts [2m([22m[2m33 tests[22m[2m)[22m[33m 1295[2mms[22m[39m
 [32mâœ“[39m tests/unit/services/DatavaultColumnsService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1268[2mms[22m[39m
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w122
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363780590,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w120
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363780641,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w122 (Reused: true)

{"level":30,"time":1768363780642,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363780667,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","msg":"AI workflow revision job enqueued"}
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w120 (Reused: true)

{"level":30,"time":1768363780675,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363780683,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","descriptionLength":26,"msg":"AI logic generation requested"}
{"level":30,"time":1768363780689,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363780685,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","duration":9,"changeCount":0,"msg":"AI logic generation succeeded"}
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363780695,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363780701,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1768363780716,"env":"test","module":"ai-controller","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["workflowId"]},{"code":"invalid_type","expected":"object","received":"undefined","path":["currentWorkflow"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["userInstruction"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
{"level":30,"time":1768363780721,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363780722,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363780731,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363780746,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363780757,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363780758,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/api.ai.revise.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1322[2mms[22m[39m
 [32mâœ“[39m tests/unit/api.ai.logic.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1251[2mms[22m[39m
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w124
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w124 (Reused: true)

{"level":30,"time":1768363781011,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363781072,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363781207,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363781208,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w121
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/services/EmailTemplateMetadataService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1123[2mms[22m[39m
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w121 (Reused: true)

{"level":30,"time":1768363781268,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363781274,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363781274,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363781347,"env":"test","msg":"DB: initialized flag set."}
 [32mâœ“[39m tests/integration/datavault.api-tokens.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 1052[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w125
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363781622,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363781623,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w125 (Reused: true)

{"level":30,"time":1768363781655,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/lib/queries/QueryRunner.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 1190[2mms[22m[39m
{"level":30,"time":1768363781707,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768363781950,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363781951,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/branding.routes.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 1186[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w119
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w119 (Reused: true)

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":30,"time":1768363782149,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363782083,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363782227,"env":"test","msg":"DB: initialized flag set."}
{"level":30,"time":1768363782264,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363782265,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/services/CollectionService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1070[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768363782687,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould skip question when condition is false
[22m[39m[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 3

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould execute question when condition is true
[22m[39m[DEBUG Question] Node q1 executed. Key: has_code, Value: true. Context keys: 4

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould execute question when condition is true
[22m[39m[DEBUG Question] Node q2 executed. Key: code, Value: ABC123. Context keys: 5

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould skip compute node when condition is false
[22m[39m[DEBUG Question] Node q1 executed. Key: amount, Value: 0. Context keys: 3

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould execute compute node when condition is true
[22m[39m[DEBUG Question] Node q1 executed. Key: amount, Value: 100. Context keys: 3

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
DB: Skipping auto-init because NODE_ENV=test

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould handle complex workflow with multiple conditions
[22m[39m[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 4

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mConditional Execution[2m > [22m[2mshould handle complex workflow with multiple conditions
[22m[39m[DEBUG Question] Node q3 executed. Key: amount, Value: 1000. Context keys: 5

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w129
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mDebug Mode[2m > [22m[2mshould return trace when debug is enabled
[22m[39m[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

[90mstderr[2m | tests/unit/engine.run-conditions.test.ts[2m > [22m[2mEngine - Conditional Execution[2m > [22m[2mDebug Mode[2m > [22m[2mshould not return trace when debug is disabled
[22m[39m[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

{"level":30,"time":1768363783146,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363783146,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w129 (Reused: true)

{"level":30,"time":1768363783161,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w128
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363783215,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w128 (Reused: true)

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363783302,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/engine.run-conditions.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1555[2mms[22m[39m
{"level":30,"time":1768363783359,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w131
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w131 (Reused: true)

{"level":30,"time":1768363783728,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363783782,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363783802,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363783803,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/repositories/DatavaultTablesRepository.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1238[2mms[22m[39m
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w126
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363783993,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363783994,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w132
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w126 (Reused: true)

{"level":30,"time":1768363784040,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w123
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w132 (Reused: true)

{"level":30,"time":1768363784051,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w133
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363784095,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w123 (Reused: true)

{"level":30,"time":1768363784096,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363784101,"env":"test","msg":"DB: initialized flag set."}
 [32mâœ“[39m tests/unit/schema/collections.test.ts [2m([22m[2m34 tests[22m[2m)[22m[33m 1321[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w133 (Reused: true)

{"level":30,"time":1768363784139,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363784172,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363784188,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w127
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w127 (Reused: true)

{"level":30,"time":1768363784263,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w134
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363784316,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w134 (Reused: true)

{"level":30,"time":1768363784362,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363784365,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363784366,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363784419,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

 [32mâœ“[39m tests/unit/services/StepService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1179[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops

[90mstderr[2m | tests/unit/debugging/Lineage.test.ts[2m > [22m[2mDebug & Lineage[2m > [22m[2mshould generate execution trace with lineage
[22m[39m[DEBUG Question] Node q1 executed. Key: userName, Value: Alice. Context keys: 3

{"level":30,"time":1768363784668,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363784669,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363784671,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363784672,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363784695,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363784696,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w135
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/services/BrandingService.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 1040[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w135 (Reused: true)

{"level":30,"time":1768363784747,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363784748,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363784748,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/services/RecordService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 1131[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363784794,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

 [32mâœ“[39m tests/unit/debugging/Lineage.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1125[2mms[22m[39m
{"level":30,"time":1768363784891,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363784892,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363784946,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363784946,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/unit/services/DocumentTemplateService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1036[2mms[22m[39m
 [32mâœ“[39m tests/integration/datavault.routes.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1118[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
DB: Skipping auto-init because NODE_ENV=test

 [32mâœ“[39m tests/unit/workflow/PreviewExecution.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1068[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w136
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w136 (Reused: true)

{"level":30,"time":1768363785323,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363785343,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363785344,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363785372,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

 [32mâœ“[39m tests/unit/services/CollectionFieldService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 1053[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w137
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w137 (Reused: true)

{"level":30,"time":1768363785741,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363785792,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  override existing env vars with { override: true }

{"level":30,"time":1768363785911,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363785912,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }

 [32mâœ“[39m tests/unit/repositories/DocumentTemplateRepository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1132[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w138
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363786363,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363786364,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w138 (Reused: true)

{"level":30,"time":1768363786374,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363786422,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

 [32mâœ“[39m tests/unit/services/DatavaultTablesService.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1178[2mms[22m[39m
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w143
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363786824,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w143 (Reused: true)

[90mstderr[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâš ï¸ Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "closeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17[90m)[39m
    at Object.get [90m(file:///C:/Users/scoot/poll/VaultLogic/[39mnode_modules/[4mvitest[24m/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16[90m)[39m
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:140:34
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m {
  codeFrame: [32m'vi.mock(import("../../../server/db"), async (importOriginal) => {\n'[39m +
    [32m'  const actual = await importOriginal()\n'[39m +
    [32m'  return {\n'[39m +
    [32m'    ...actual,\n'[39m +
    [32m'    // your mocked methods\n'[39m +
    [32m'  }\n'[39m +
    [32m'})'[39m
}

{"level":30,"time":1768363786839,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
{"level":30,"time":1768363786840,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1768363786841,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768363786843,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1768363786843,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/writes/WriteRunner.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 523[2mms[22m[39m
{"level":30,"time":1768363786993,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363786994,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w130
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w130 (Reused: true)

{"level":30,"time":1768363787050,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w147
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363787112,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w147 (Reused: true)

[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":30,"time":1768363787138,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363787145,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
 [32mâœ“[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1121[2mms[22m[39m
 [32mâœ“[39m tests/unit/external/ExternalSendRunner.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 521[2mms[22m[39m
[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
DB: Skipping auto-init because NODE_ENV=test

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w145
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w145 (Reused: true)

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/EmailTemplateMetadataService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 622[2mms[22m[39m
{"level":30,"time":1768363787705,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363787706,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w141
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w141 (Reused: true)

{"level":30,"time":1768363787898,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w112
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w112 (Reused: true)

{"level":30,"time":1768363787958,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/integration/datavault.row-notes.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1181[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w146
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

{"level":30,"time":1768363788007,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w139
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363788042,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w146 (Reused: true)

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w109
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w139 (Reused: true)

{"level":30,"time":1768363788074,"env":"test","msg":"DB: initializing... Local"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w109 (Reused: true)

{"level":30,"time":1768363788111,"env":"test","msg":"DB: initializing... Local"}
 [32mâœ“[39m tests/unit/repositories/DatavaultRowsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 578[2mms[22m[39m
{"level":30,"time":1768363788137,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363788170,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ“¡ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1768363788543,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts[2m > [22m[2mPersonalization API Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363788554,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363788556,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363788563,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":40,"time":1768363788664,"env":"test","sourceListVar":"nonexistent_list","inputKey":"nonexistent_list","msg":"Input list not found, treating as empty array"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363788665,"env":"test","msg":"DB: closing pool..."}
{"level":30,"time":1768363788666,"env":"test","msg":"DB: pool closed."}
{"level":30,"time":1768363788684,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363788685,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w142
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

 [32mâœ“[39m tests/ListTools.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1343[2mms[22m[39m
{"level":30,"time":1768363788751,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w144
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w142 (Reused: true)

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

 [32mâœ“[39m tests/unit/debug_import.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1070[2mms[22m[39m
{"level":30,"time":1768363788776,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts[2m > [22m[2mStage 13: Workflow Snapshots & Versioning
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363788760,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363788760,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363788768,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363788775,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363788775,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363788776,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363788776,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w144 (Reused: true)

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: âš™ï¸  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild

 [32mâœ“[39m tests/unit/services/AccountLockoutService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 604[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w148
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w148 (Reused: true)

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363789073,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363789074,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mSETUP: Loading setup.ts...
[dotenv@17.2.3] injecting env (20) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit

 [32mâœ“[39m tests/unit/services/AuditLogService.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 501[2mms[22m[39m
[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/PortalAuthService.test.ts [2m([22m[2m42 tests[22m[2m)[22m[33m 894[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w149
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w149 (Reused: true)

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/engine/FinalBlockSnapshot.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 545[2mms[22m[39m
 [32mâœ“[39m tests/integration/api.ai.personalization.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1560[2mms[22m[39m
{"level":30,"time":1768363789611,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363789612,"env":"test","msg":"DB: pool closed."}
[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w151
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w152
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w153
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w151 (Reused: true)

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w152 (Reused: true)

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w153 (Reused: true)

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [32mâœ“[39m tests/unit/services/BrandingService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 477[2mms[22m[39m
 [32mâœ“[39m tests/unit/services/Guardrail.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 476[2mms[22m[39m
 [32mâœ“[39m tests/unit/services/DatavaultRowsService.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 471[2mms[22m[39m
 [32mâœ“[39m tests/integration/api.snapshots.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 2006[2mms[22m[39m
     [33m[2mâœ“[22m[39m should maintain immutability of runs across versions [33m 498[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
DB: Skipping auto-init because NODE_ENV=test

{"level":30,"time":1768363790332,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w150
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w150 (Reused: true)

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

 [2m[90mâ†“[39m[22m tests/unit/collab.server.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m
 [32mâœ“[39m tests/unit/services/DatavaultReferenceColumns.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 447[2mms[22m[39m
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w154
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w154 (Reused: true)

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâš ï¸ DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":40,"time":1768363790733,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":50,"time":1768363790737,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1768363790740,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768363790749,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1768363790753,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
 [32mâœ“[39m tests/unit/LifecycleHookService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 455[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâœ… OpenAPI specification loaded successfully

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[SchemaManager] Reusing existing isolated schema: test_schema_w140
[SchemaManager] Detected Neon DB. Switching to Direct Connection (5432) for schema isolation.

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mðŸ”’ Test Schema Isolated: test_schema_w140 (Reused: true)

{"level":30,"time":1768363792971,"env":"test","msg":"DB: initializing... Local"}
{"level":30,"time":1768363793007,"env":"test","msg":"DB: initialized flag set."}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâœ… Database initialized for tests
â© Schema reused, skipping migrations.

{"level":30,"time":1768363793520,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768363793535,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests
[22m[39mðŸ“š API Documentation available at /api-docs
[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768363793526,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768363793527,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768363793530,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768363793534,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768363793535,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768363793535,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768363793535,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":40,"time":1768363793556,"env":"test","error":{},"msg":"Deterministic DOCX extraction failed"}
{"level":30,"time":1768363793592,"env":"test","msg":"DB: closing pool..."}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mðŸ§¹ Cleaning up test environment...

{"level":30,"time":1768363793593,"env":"test","msg":"DB: pool closed."}
 [32mâœ“[39m tests/integration/api.ai.doc.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 1020[2mms[22m[39m

[2m Test Files [22m [1m[32m155 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (156)[39m
[2m      Tests [22m [1m[32m2613 passed[39m[22m[2m | [22m[33m21 skipped[39m[90m (2634)[39m
[2m   Start at [22m 22:08:12
[2m   Duration [22m 110.10s[2m (transform 49.09s, setup 29.16s, import 351.62s, tests 919.85s, environment 31.47s)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   23.55 |    17.28 |   18.83 |   23.85 |                   
 client/src        |       0 |        0 |       0 |       0 |                   
  App.tsx          |       0 |        0 |       0 |       0 | 19-213            
  main.tsx         |       0 |      100 |     100 |       0 | 9-11              
  vite-env.d.ts    |       0 |        0 |       0 |       0 |                   
 ...src/components |       0 |        0 |       0 |       0 |                   
  AIHeroCard.tsx   |       0 |        0 |       0 |       0 | 12                
  ...ackWidget.tsx |       0 |        0 |       0 |       0 | 15-34             
  GoogleLogin.tsx  |       0 |        0 |       0 |       0 | 16-127            
 ...mponents/admin |       0 |        0 |       0 |       0 |                   
  ...ceMonitor.tsx |       0 |        0 |       0 |       0 | 57-494            
 ...ents/analytics |       0 |        0 |       0 |       0 |                   
  DropoffList.tsx  |       0 |        0 |       0 |       0 | 12-50             
  ...Dashboard.tsx |       0 |        0 |       0 |       0 | 58-236            
  ...althPanel.tsx |       0 |        0 |       0 |       0 | 12-35             
 ...ponents/blocks |       0 |        0 |       0 |       0 |                   
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 30-148            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 39-160            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 24-496            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 32-311            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 40-179            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 48-428            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 48-488            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 35-386            
 ...nents/branding |       0 |        0 |       0 |       0 |                   
  ...mainModal.tsx |       0 |        0 |       0 |       0 | 32-282            
  ...ngContext.tsx |       0 |        0 |       0 |       0 | 55-272            
  ...ngPreview.tsx |       0 |        0 |       0 |       0 | 24-78             
  EmailPreview.tsx |       0 |        0 |       0 |       0 | 27-184            
  index.ts         |       0 |        0 |       0 |       0 |                   
 ...onents/builder |       0 |        0 |       0 |       0 |                   
  ...sistPanel.tsx |       0 |        0 |       0 |       0 | 34-339            
  ...ackWidget.tsx |       0 |        0 |       0 |       0 | 59-306            
  ...ateToggle.tsx |       0 |        0 |       0 |       0 | 29-74             
  ...nipDialog.tsx |       0 |        0 |       0 |       0 | 37-205            
  ...odeBanner.tsx |       0 |        0 |       0 |       0 | 8-24              
  ...tionPanel.tsx |       0 |        0 |       0 |       0 | 36-425            
  ...torDialog.tsx |       0 |        0 |       0 |       0 | 46-435            
  BlocksPanel.tsx  |       0 |      100 |       0 |       0 | 7-8               
  CanvasEditor.tsx |       0 |        0 |       0 |       0 | 19-295            
  ...tionModal.tsx |       0 |        0 |       0 |       0 | 47-227            
  ...braryDocs.tsx |       0 |        0 |       0 |       0 | 13-15             
  Inspector.tsx    |       0 |        0 |       0 |       0 | 17-64             
  ...keContext.tsx |       0 |        0 |       0 |       0 | 16-66             
  ...Inspector.tsx |       0 |        0 |       0 |       0 | 40-197            
  ...ctorPanel.tsx |       0 |        0 |       0 |       0 | 22-166            
  LogicPanel.tsx   |       0 |        0 |       0 |       0 | 27-192            
  ...ataButton.tsx |       0 |        0 |       0 |       0 | 34-79             
  ...erPreview.tsx |       0 |      100 |       0 |       0 | 12-14             
  ...ngsDialog.tsx |       0 |        0 |       0 |       0 | 29-91             
  SidebarTree.tsx  |       0 |        0 |       0 |       0 | 50-641            
  ...tiesPanel.tsx |       0 |        0 |       0 |       0 | 47-480            
  ...ocksPanel.tsx |       0 |        0 |       0 |       0 | 22-359            
  ...rmSummary.tsx |       0 |        0 |       0 |       0 | 19-37             
  ...lesEditor.tsx |       0 |        0 |       0 |       0 | 35-429            
  ...Inspector.tsx |       0 |        0 |       0 |       0 | 29-245            
  ...wSettings.tsx |       0 |        0 |       0 |       0 | 19-128            
 ...nts/builder/ai |       0 |        0 |       0 |       0 |                   
  ...antDialog.tsx |       0 |        0 |       0 |       0 | 34-201            
  ...tionPanel.tsx |       0 |        0 |       0 |       0 | 42-294            
  AiDiffView.tsx   |       0 |        0 |       0 |       0 | 20-86             
 .../builder/cards |       0 |        0 |       0 |       0 |                   
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 40-141            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 33-202            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 59-810            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 39-117            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 33-106            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 48-205            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 44-216            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 36-280            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 33-108            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 49-312            
  ...ockEditor.tsx |       0 |        0 |       0 |       0 | 53-388            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 37-274            
  ...ardEditor.tsx |       0 |        0 |       0 |       0 | 33-106            
  index.tsx        |       0 |        0 |       0 |       0 |                   
 ...r/cards/common |       0 |        0 |       0 |       0 |                   
  AliasField.tsx   |       0 |        0 |       0 |       0 | 19-91             
  EditorField.tsx  |       0 |        0 |       0 |       0 | 24-204            
  LabelField.tsx   |       0 |        0 |       0 |       0 | 19-37             
  ...redToggle.tsx |       0 |      100 |       0 |       0 | 15                
 ...r/data-sources |       0 |        0 |       0 |       0 |                   
  ...onsDrawer.tsx |       0 |        0 |       0 |       0 | 45-236            
 .../builder/final |       0 |        0 |       0 |       0 |                   
  ...ionEditor.tsx |       0 |        0 |       0 |       0 | 38-215            
 ...builder/layout |       0 |        0 |       0 |       0 |                   
  ...derLayout.tsx |       0 |        0 |       0 |       0 | 14-30             
  ...derTabNav.tsx |       0 |        0 |       0 |       0 | 28-60             
  ...derLayout.tsx |       0 |        0 |       0 |       0 | 17-182            
 .../builder/pages |       0 |        0 |       0 |       0 |                   
  BlockCard.tsx    |       0 |        0 |       0 |       0 | 49-496            
  LogicAddMenu.tsx |       0 |        0 |       0 |       0 | 28-200            
  PageCanvas.tsx   |       0 |        0 |       0 |       0 | 50-332            
  PageCard.tsx     |       0 |        0 |       0 |       0 | 51-400            
  ...onAddMenu.tsx |       0 |        0 |       0 |       0 | 38-108            
  ...lePalette.tsx |       0 |        0 |       0 |       0 | 21-113            
 ...lder/questions |       0 |        0 |       0 |       0 |                   
  ...ionEditor.tsx |       0 |        0 |       0 |       0 | 44-240            
  ...onsEditor.tsx |       0 |        0 |       0 |       0 | 58-576            
  QuestionCard.tsx |       0 |        0 |       0 |       0 | 81-805            
 ...uilder/sidebar |       0 |        0 |       0 |       0 |                   
  ...atusPanel.tsx |       0 |        0 |       0 |       0 | 18-189            
 ...s/builder/tabs |       0 |        0 |       0 |       0 |                   
  ...gnmentTab.tsx |       0 |        0 |       0 |       0 | 31-171            
  ...ourcesTab.tsx |       0 |        0 |       0 |       0 | 34-230            
  ReviewTab.tsx    |       0 |        0 |       0 |       0 | 29-202            
  SectionsTab.tsx  |       0 |        0 |       0 |       0 | 18-46             
  SettingsTab.tsx  |       0 |        0 |       0 |       0 | 40-501            
  SnapshotsTab.tsx |       0 |        0 |       0 |       0 | 33-292            
  TemplatesTab.tsx |       0 |        0 |       0 |       0 | 52-451            
  ...uilderTab.tsx |       0 |        0 |       0 |       0 | 22-180            
 ...lder/templates |       0 |        0 |       0 |       0 |                   
  ...ingEditor.tsx |       0 |        0 |       0 |       0 | 21-686            
 ...der/transforms |       0 |        0 |       0 |       0 |                   
  ...ansformUI.tsx |       0 |        0 |       0 |       0 | 21-53             
  ...BuilderUI.tsx |       0 |        0 |       0 |       0 | 23-250            
  ...ontrolsUI.tsx |       0 |        0 |       0 |       0 | 19-49             
  ...BuilderUI.tsx |       0 |        0 |       0 |       0 | 23-159            
  index.ts         |       0 |        0 |       0 |       0 |                   
 ...der/versioning |       0 |        0 |       0 |       0 |                   
  DiffViewer.tsx   |       0 |        0 |       0 |       0 | 33-160            
  ...lowDialog.tsx |       0 |        0 |       0 |       0 | 17-38             
  VersionBadge.tsx |       0 |        0 |       0 |       0 | 15                
  ...toryPanel.tsx |       0 |        0 |       0 |       0 | 34-124            
 ...ponents/charts |       0 |        0 |       0 |       0 |                   
  KeywordList.tsx  |       0 |        0 |       0 |       0 | 14-49             
  ...oiceChart.tsx |       0 |        0 |       0 |       0 | 15-99             
  ResultsCard.tsx  |       0 |        0 |       0 |       0 | 19-95             
  TagCloud.tsx     |       0 |        0 |       0 |       0 | 16-71             
  YesNoChart.tsx   |       0 |        0 |       0 |       0 | 15-77             
  index.ts         |       0 |        0 |       0 |       0 |                   
 ...ponents/collab |   41.42 |       44 |   43.47 |   44.61 |                   
  ...onContext.tsx |       0 |        0 |       0 |       0 | 10-77             
  ...entsPanel.tsx |      80 |    66.66 |    87.5 |   83.33 | 50-52,181         
  ...sorsLayer.tsx |       0 |        0 |       0 |       0 | 19-71             
  ...ceAvatars.tsx |      90 |    61.53 |     100 |      90 | 97                
 ...ts/collections |       0 |        0 |       0 |       0 |                   
  ...ctionCard.tsx |       0 |        0 |       0 |       0 | 20-51             
  ...tionModal.tsx |       0 |        0 |       0 |       0 | 28-126            
  ...ieldModal.tsx |       0 |        0 |       0 |       0 | 28-309            
  FieldsList.tsx   |       0 |        0 |       0 |       0 | 19-124            
  ...itorModal.tsx |       0 |        0 |       0 |       0 | 51-330            
  RecordTable.tsx  |       0 |        0 |       0 |       0 | 51-240            
  RecordsList.tsx  |       0 |        0 |       0 |       0 | 40-77             
 ...ponents/common |    6.15 |    16.17 |    7.14 |    6.34 |                   
  Breadcrumbs.tsx  |     100 |      100 |     100 |     100 |                   
  ...blePicker.tsx |       0 |        0 |       0 |       0 | 29-294            
  ...bleSelect.tsx |       0 |        0 |       0 |       0 | 20-85             
 ...ents/dashboard |       0 |        0 |       0 |       0 |                   
  ProjectCard.tsx  |       0 |        0 |       0 |       0 | 22-68             
  ...lowDialog.tsx |       0 |        0 |       0 |       0 | 32-157            
  WorkflowCard.tsx |       0 |        0 |       0 |       0 | 23-98             
  index.ts         |       0 |        0 |       0 |       0 |                   
 ...nts/dataSource |       0 |        0 |       0 |       0 |                   
  ...etsDialog.tsx |       0 |        0 |       0 |       0 | 38-234            
  ...bleDialog.tsx |       0 |        0 |       0 |       0 | 30-195            
 ...ents/datavault |   18.94 |    21.57 |   11.82 |   19.96 |                   
  AddRowButton.tsx |      28 |    41.86 |   15.78 |   33.33 | ...22-155,164,197 
  ...nsToolbar.tsx |       0 |        0 |       0 |       0 | 25-27             
  CellRenderer.tsx |      44 |    43.61 |   29.72 |   45.74 | ...99-300,320-487 
  ...eaderCell.tsx |       0 |        0 |       0 |       0 | 23-25             
  ...mnManager.tsx |       0 |        0 |       0 |       0 | 44-375            
  ...erWithDnd.tsx |       0 |        0 |       0 |       0 | 93-544            
  ...nTypeIcon.tsx |   92.85 |    93.33 |     100 |   92.85 | 69,113,152        
  ...baseModal.tsx |       0 |        0 |       0 |       0 | 49-207            
  ...ableModal.tsx |       0 |        0 |       0 |       0 | 36-230            
  DataGrid.tsx     |       0 |        0 |       0 |       0 | 62-292            
  ...mptyState.tsx |       0 |        0 |       0 |       0 | 19-64             
  ...dSkeleton.tsx |       0 |        0 |       0 |       0 | 14-30             
  ...ApiTokens.tsx |   27.94 |    14.63 |    6.25 |   29.68 | ...37-147,168-373 
  DatabaseCard.tsx |       0 |        0 |       0 |       0 | 30-105            
  ...eSettings.tsx |   47.82 |    48.78 |   14.28 |   47.82 | ...,74-77,118-187 
  ...TableTabs.tsx |       0 |        0 |       0 |       0 | 27-77             
  ...RowButton.tsx |   35.71 |       25 |   33.33 |   35.71 | 35-54,61          
  EditableCell.tsx |      88 |    83.67 |   84.61 |   90.27 | 105-111,142-143   
  ...eDataGrid.tsx |       0 |        0 |       0 |       0 | 69-451            
  FilterPanel.tsx  |       0 |        0 |       0 |       0 | 30-277            
  ...eDataGrid.tsx |       0 |        0 |       0 |       0 | 54-118            
  ...eDataGrid.tsx |       0 |        0 |       0 |       0 | 41-202            
  ...gSkeleton.tsx |       0 |      100 |       0 |       0 | 10-41             
  ...ableModal.tsx |       0 |        0 |       0 |       0 | 48-122            
  NoteItem.tsx     |       0 |        0 |       0 |       0 | 33-57             
  NotesTab.tsx     |       0 |        0 |       0 |       0 | 24-164            
  ...onsEditor.tsx |       0 |        0 |       0 |       0 | 20-179            
  ...renceCell.tsx |       0 |        0 |       0 |       0 | 19-79             
  ...ailDrawer.tsx |       0 |        0 |       0 |       0 | 31-34             
  ...itorModal.tsx |       0 |        0 |       0 |       0 | 44-225            
  ...umnHeader.tsx |     100 |    77.77 |     100 |     100 | 36-43             
  TableCard.tsx    |      70 |    66.66 |      80 |   77.77 | 74-75             
  ...eGridView.tsx |   63.93 |    62.79 |      60 |   66.66 | ...41-163,233-277 
  ...rmissions.tsx |       0 |        0 |       0 |       0 | 51-491            
  TemplateCard.tsx |     100 |      100 |     100 |     100 |                   
 ...nents/devpanel |       0 |        0 |       0 |       0 |                   
  DevPanel.tsx     |       0 |        0 |       0 |       0 | 27-49             
  ...nTimeline.tsx |       0 |        0 |       0 |       0 | 28-143            
  ...iableList.tsx |       0 |        0 |       0 |       0 | 25-218            
  ...dDevPanel.tsx |       0 |        0 |       0 |       0 | 30                
  VariableList.tsx |       0 |        0 |       0 |       0 | 26-179            
 ...nents/devtools |       0 |        0 |       0 |       0 |                   
  ...oolsPanel.tsx |       0 |        0 |       0 |       0 | 21-140            
  JsonViewer.tsx   |       0 |        0 |       0 |       0 | 13-247            
 ...onents/dialogs |       0 |        0 |       0 |       0 |                   
  ...hipDialog.tsx |       0 |        0 |       0 |       0 | 37-171            
 ...onents/history |       0 |        0 |       0 |       0 |                   
  ...etailView.tsx |       0 |        0 |       0 |       0 | 18-138            
  ...oryDialog.tsx |       0 |        0 |       0 |       0 | 36-192            
 ...ponents/intake |       0 |        0 |       0 |       0 |                   
  IntakeDemo.tsx   |       0 |        0 |       0 |       0 | 34-154            
  IntakeFooter.tsx |       0 |        0 |       0 |       0 | 31                
  IntakeHeader.tsx |       0 |        0 |       0 |       0 | 34-41             
  IntakeLayout.tsx |       0 |        0 |       0 |       0 | 54                
  ...ogressBar.tsx |       0 |        0 |       0 |       0 | 41-43             
  ThemedButton.tsx |       0 |        0 |       0 |       0 | 33-174            
  ThemedInput.tsx  |       0 |        0 |       0 |       0 | 46-220            
  index.ts         |       0 |        0 |       0 |       0 |                   
 ...ponents/layout |       0 |        0 |       0 |       0 |                   
  ...ndPalette.tsx |       0 |        0 |       0 |       0 | 35-110            
  Header.tsx       |       0 |        0 |       0 |       0 | 21-121            
  ...cutHelper.tsx |       0 |        0 |       0 |       0 | 13-87             
  Sidebar.tsx      |       0 |        0 |       0 |       0 | 19-112            
 ...mponents/logic |       0 |        0 |       0 |       0 |                   
  ...tionGroup.tsx |       0 |        0 |       0 |       0 | 45-168            
  ConditionRow.tsx |       0 |        0 |       0 |       0 | 53-287            
  LogicBuilder.tsx |       0 |        0 |       0 |       0 | 59-179            
  ...Indicator.tsx |       0 |        0 |       0 |       0 | 43-142            
  ...ogicSheet.tsx |       0 |        0 |       0 |       0 | 41-72             
  index.ts         |       0 |        0 |       0 |       0 |                   
 ...onents/preview |       0 |        0 |       0 |       0 |                   
  DevToolbar.tsx   |       0 |        0 |       0 |       0 | 58-90             
  ...iewRunner.tsx |       0 |        0 |       0 |       0 | 25-228            
 ...ents/providers |       0 |        0 |       0 |       0 |                   
  ...gProvider.tsx |       0 |        0 |       0 |       0 | 21-120            
 ...ponents/runner |       0 |        0 |       0 |       0 |                   
  ...nerLayout.tsx |       0 |        0 |       0 |       0 | 23                
  ...ataButton.tsx |       0 |        0 |       0 |       0 | 43-133            
 .../runner/blocks |       0 |        0 |       0 |       0 |                   
  AddressBlock.tsx |       0 |        0 |       0 |       0 | 53-410            
  ...kRenderer.tsx |       0 |        0 |       0 |       0 | 71-173            
  BooleanBlock.tsx |       0 |        0 |       0 |       0 | 35-97             
  ChoiceBlock.tsx  |       0 |        0 |       0 |       0 | 85-426            
  ...encyBlock.tsx |       0 |        0 |       0 |       0 | 29-117            
  DateBlock.tsx    |       0 |        0 |       0 |       0 | 27-42             
  ...TimeBlock.tsx |       0 |        0 |       0 |       0 | 28-39             
  DisplayBlock.tsx |       0 |        0 |       0 |       0 | 25-42             
  EmailBlock.tsx   |       0 |        0 |       0 |       0 | 27-35             
  FinalBlock.tsx   |       0 |        0 |       0 |       0 | 44-210            
  ...ieldBlock.tsx |       0 |        0 |       0 |       0 | 40-112            
  NumberBlock.tsx  |       0 |        0 |       0 |       0 | 28-75             
  PhoneBlock.tsx   |       0 |        0 |       0 |       0 | 28-68             
  ScaleBlock.tsx   |       0 |        0 |       0 |       0 | 29-100            
  ...kRenderer.tsx |       0 |        0 |       0 |       0 | 66-262            
  TextBlock.tsx    |       0 |        0 |       0 |       0 | 34-92             
  TimeBlock.tsx    |       0 |        0 |       0 |       0 | 27-38             
  WebsiteBlock.tsx |       0 |        0 |       0 |       0 | 27-42             
  index.ts         |       0 |        0 |       0 |       0 |                   
  validation.ts    |       0 |        0 |       0 |       0 | 22-150            
 ...unner/sections |       0 |        0 |       0 |       0 |                   
  ...tsSection.tsx |       0 |        0 |       0 |       0 | 45-268            
  ...ntSection.tsx |       0 |        0 |       0 |       0 | 27-85             
  ...ewSection.tsx |       0 |        0 |       0 |       0 | 24-92             
 ...omponents/runs |   38.34 |     47.5 |   40.47 |   37.98 |                   
  RunFilters.tsx   |   77.77 |    68.18 |   55.55 |   77.77 | 41,49,92-103      
  ...putsPanel.tsx |       0 |        0 |       0 |       0 | 48-328            
  RunsTable.tsx    |      75 |    63.15 |     100 |   76.92 | 31-33,41          
  TracePanel.tsx   |   89.28 |    88.23 |     100 |   89.28 | 32,50,61          
 ...ponents/shared |   32.32 |    28.68 |   21.87 |   32.43 |                   
  ...mptyState.tsx |       0 |        0 |       0 |       0 | 20                
  ...ionDialog.tsx |       0 |        0 |       0 |       0 | 34-38             
  DataTable.tsx    |       0 |        0 |       0 |       0 | 42-76             
  EmptyState.tsx   |       0 |        0 |       0 |       0 | 24-44             
  EntityCard.tsx   |       0 |        0 |       0 |       0 | 67-146            
  ...ableTitle.tsx |       0 |        0 |       0 |       0 | 22-86             
  JsonViewer.tsx   |   59.81 |    59.82 |   43.75 |   63.82 | ...30-267,318-347 
  LoadingState.tsx |       0 |        0 |       0 |       0 | 7-35              
  ...ionButton.tsx |       0 |        0 |       0 |       0 | 47-74             
  SkeletonCard.tsx |       0 |        0 |       0 |       0 | 14-17             
  SkeletonList.tsx |       0 |        0 |       0 |       0 | 14-17             
  ...etonTable.tsx |       0 |        0 |       0 |       0 | 12-28             
  StatCard.tsx     |       0 |        0 |       0 |       0 | 16-34             
  StatusBadge.tsx  |       0 |        0 |       0 |       0 | 24-77             
  index.ts         |       0 |        0 |       0 |       0 |                   
 ...ents/templates |       0 |        0 |       0 |       0 |                   
  ...veyDialog.tsx |       0 |        0 |       0 |       0 | 41-141            
  ...lateModal.tsx |       0 |        0 |       0 |       0 | 28-115            
  ...lateModal.tsx |       0 |        0 |       0 |       0 | 39-297            
  ...serDialog.tsx |       0 |        0 |       0 |       0 | 52-211            
 ...es-test-runner |       0 |        0 |       0 |       0 |                   
  ResultsPanel.tsx |       0 |        0 |       0 |       0 | 22-130            
  ...ataEditor.tsx |       0 |        0 |       0 |       0 | 21-110            
  StatusPill.tsx   |       0 |      100 |       0 |       0 | 16-47             
  index.ts         |       0 |        0 |       0 |       0 |                   
  types.ts         |       0 |        0 |       0 |       0 |                   
  ...mplateTest.ts |       0 |        0 |       0 |       0 | 20-73             
 .../components/ui |   19.12 |     3.49 |   13.67 |   19.32 |                   
  accordion.tsx    |       0 |      100 |       0 |       0 | 7-54              
  alert-dialog.tsx |   74.07 |      100 |    12.5 |   74.07 | ...,78,90,103,115 
  alert.tsx        |      90 |      100 |   66.66 |      90 | 39                
  aspect-ratio.tsx |       0 |      100 |     100 |       0 | 3                 
  ...-textarea.tsx |       0 |        0 |       0 |       0 | 20-90             
  avatar.tsx       |   88.88 |      100 |   66.66 |   88.88 | 27                
  badge.tsx        |     100 |      100 |     100 |     100 |                   
  breadcrumb.tsx   |       0 |        0 |       0 |       0 | 7-105             
  button.tsx       |     100 |    66.66 |     100 |     100 | 44                
  calendar.tsx     |       0 |        0 |       0 |       0 | 16-66             
  card.tsx         |   94.44 |      100 |   83.33 |   94.44 | 71                
  carousel.tsx     |       0 |        0 |       0 |       0 | 31-251            
  chart.tsx        |       0 |        0 |       0 |       0 | 9-371             
  checkbox.tsx     |     100 |      100 |     100 |     100 |                   
  collapsible.tsx  |       0 |      100 |     100 |       0 | 5-9               
  command.tsx      |       0 |      100 |       0 |       0 | 9-139             
  context-menu.tsx |       0 |        0 |       0 |       0 | 7-180             
  dialog.tsx       |   77.27 |      100 |   16.66 |   77.27 | 21,60,74,88,103   
  drawer.tsx       |       0 |        0 |       0 |       0 | 8-105             
  ...down-menu.tsx |   81.81 |    28.57 |   33.33 |   81.81 | ...97,121,145,173 
  file-upload.tsx  |       0 |        0 |       0 |       0 | 38-335            
  form.tsx         |       0 |        0 |       0 |       0 | 18-167            
  hover-card.tsx   |       0 |        0 |       0 |       0 | 8-27              
  input-otp.tsx    |       0 |        0 |       0 |       0 | 7-67              
  input.tsx        |     100 |      100 |     100 |     100 |                   
  label.tsx        |     100 |      100 |     100 |     100 |                   
  loader.tsx       |       0 |        0 |       0 |       0 | 11-26             
  menubar.tsx      |       0 |        0 |       0 |       0 | 12-237            
  ...tion-menu.tsx |       0 |      100 |       0 |       0 | 8-115             
  pagination.tsx   |       0 |        0 |       0 |       0 | 7-107             
  popover.tsx      |      80 |        0 |       0 |      80 | 14                
  progress.tsx     |       0 |        0 |       0 |       0 | 8-26              
  radio-group.tsx  |       0 |      100 |       0 |       0 | 7-40              
  resizable.tsx    |       0 |        0 |       0 |       0 | 8-30              
  scroll-area.tsx  |     100 |       80 |     100 |     100 | 35                
  select.tsx       |   91.66 |      100 |   71.42 |   91.66 | 106,141           
  separator.tsx    |       0 |        0 |       0 |       0 | 6-27              
  sheet.tsx        |       0 |        0 |       0 |       0 | 10-127            
  sidebar.tsx      |       0 |        0 |       0 |       0 | 26-744            
  skeleton.tsx     |       0 |      100 |       0 |       0 | 7                 
  slider.tsx       |       0 |      100 |       0 |       0 | 6-24              
  stats-card.tsx   |       0 |        0 |       0 |       0 | 26-45             
  switch.tsx       |     100 |      100 |     100 |     100 |                   
  table.tsx        |   91.66 |      100 |      75 |   91.66 | 43,100            
  tabs.tsx         |       0 |      100 |       0 |       0 | 6-51              
  textarea.tsx     |     100 |      100 |     100 |     100 |                   
  toast.tsx        |       0 |      100 |       0 |       0 | 8-111             
  toaster.tsx      |       0 |        0 |       0 |       0 | 12-17             
  toggle-group.tsx |       0 |        0 |       0 |       0 | 10-59             
  toggle.tsx       |       0 |      100 |       0 |       0 | 7-41              
  tooltip.tsx      |     100 |      100 |     100 |     100 |                   
 ...flows/settings |       0 |        0 |       0 |       0 |                   
  ...flowModal.tsx |       0 |        0 |       0 |       0 | 34                
  ...ntSection.tsx |       0 |        0 |       0 |       0 | 53-175            
 ...tes/components |       0 |        0 |       0 |       0 |                   
  ...lateModal.tsx |       0 |        0 |       0 |       0 | 27-200            
  index.ts         |       0 |        0 |       0 |       0 |                   
 client/src/hooks  |    3.32 |      2.6 |    2.99 |    3.22 |                   
  use-mobile.tsx   |       0 |      100 |       0 |       0 | 3-18              
  use-toast.ts     |   32.07 |        5 |   16.66 |   33.33 | ...24,134-164,187 
  ...lyticsData.ts |       0 |        0 |       0 |       0 | 46-136            
  useAuth.ts       |       0 |        0 |       0 |       0 | 15-61             
  useAutoSave.ts   |       0 |        0 |       0 |       0 | 29-137            
  ...References.ts |      16 |        0 |      25 |   13.63 | 27-44,49-79       
  ...Operations.ts |       0 |        0 |       0 |       0 | 13-277            
  ...randingAPI.ts |       0 |        0 |       0 |       0 | 29-161            
  ...ionalLogic.ts |       0 |        0 |       0 |       0 | 11-61             
  useConfetti.ts   |       0 |        0 |       0 |       0 | 13-136            
  ...tDatabases.ts |       0 |        0 |       0 |       0 | 16-106            
  ...aultTables.ts |       0 |        0 |       0 |       0 | 19-149            
  useGroups.ts     |       0 |        0 |       0 |       0 | 26-160            
  ...finiteRows.ts |    87.5 |    66.66 |     100 |   85.71 | 27                
  ...akeRuntime.ts |       0 |        0 |       0 |       0 | 14-90             
  ...onObserver.ts |   36.36 |       60 |      50 |      30 | 25-42             
  ...dShortcuts.ts |       0 |        0 |       0 |       0 | 25-93             
  ...anizations.ts |       0 |        0 |       0 |       0 | 16-190            
  ...iewSession.ts |       0 |        0 |       0 |       0 | 17-128            
  ...ferenceRow.ts |       0 |        0 |       0 |       0 | 18-37             
  useReordering.ts |       0 |        0 |       0 |       0 | 10-61             
  ...oordinator.ts |       0 |      100 |       0 |       0 | 10-31             
  ...bleColumns.ts |       0 |        0 |       0 |       0 | 14-137            
  useTableRows.ts  |       0 |        0 |       0 |       0 | 13-137            
  useTemplates.ts  |       0 |        0 |       0 |       0 | 60-181            
  ...references.ts |       0 |        0 |       0 |       0 | 18-116            
  ...kflowGraph.ts |       0 |      100 |       0 |       0 | 5-6               
  ...iablesLive.ts |       0 |        0 |       0 |       0 | 33-63             
  ...Visibility.ts |       0 |        0 |       0 |       0 | 39-170            
 ...c/hooks/collab |   74.32 |    50.81 |    75.8 |   76.61 |                   
  ...etProvider.ts |   73.72 |    51.21 |      70 |    73.5 | ...41-258,272-274 
  ...llabClient.ts |   70.37 |    40.35 |   70.96 |   73.77 | ...21-325,335-342 
  useComments.ts   |   88.37 |       75 |     100 |   94.87 | 27-28             
 client/src/lib    |    3.99 |     4.73 |    1.07 |    4.25 |                   
  ai-operations.ts |       0 |        0 |       0 |       0 | 49-118            
  analytics.ts     |       0 |        0 |       0 |       0 | 20-98             
  ...yticsUtils.ts |       0 |        0 |       0 |       0 | 12-128            
  api-client.ts    |       0 |        0 |       0 |       0 | 9-41              
  api.ts           |       0 |      100 |       0 |       0 | 3-18              
  authUtils.ts     |       0 |      100 |       0 |       0 | 2                 
  ...kRegistry.tsx |       0 |        0 |       0 |       0 | 96-469            
  choice-utils.ts  |   46.37 |    38.46 |   33.33 |   48.48 | 102-203           
  colorUtils.ts    |       0 |        0 |       0 |       0 | 13-211            
  datavault-api.ts |       0 |        0 |       0 |       0 | 42-398            
  ...ault-hooks.ts |    2.12 |        0 |    2.35 |    2.18 | 16-19,22,24-453   
  devpanelBus.ts   |       0 |      100 |       0 |       0 | 9-44              
  dnd.ts           |       0 |        0 |       0 |       0 | 22-76             
  formatting.ts    |       0 |        0 |       0 |       0 | 12-68             
  index.ts         |       0 |        0 |       0 |       0 |                   
  labels.ts        |       0 |      100 |     100 |       0 | 7                 
  logger.ts        |       0 |        0 |       0 |       0 | 18-47             
  mode.ts          |       0 |        0 |       0 |       0 | 17-92             
  queryClient.ts   |       0 |        0 |       0 |       0 | 7-160             
  queryKeys.ts     |       0 |      100 |       0 |       0 | 10-50             
  ...e-workflow.ts |       0 |      100 |       0 |       0 | 13-136            
  ...thWarnings.ts |       0 |        0 |       0 |       0 | 8-28              
  tenantTheme.ts   |       0 |        0 |       0 |       0 | 65-294            
  utils.ts         |     100 |      100 |     100 |     100 |                   
  vault-api.ts     |    8.18 |     2.38 |    0.51 |    9.06 | ...1636,1702-1731 
  vault-hooks.ts   |       0 |        0 |       0 |       0 | 17-1239           
 ...nt/src/lib/api |    0.71 |        0 |       0 |    0.79 |                   
  datavault.ts     |     0.8 |        0 |       0 |     0.9 | 25-440            
  organizations.ts |       0 |      100 |       0 |       0 | 51-142            
 ...src/lib/config |   47.82 |    41.66 |   11.11 |   47.82 |                   
  environment.ts   |   47.82 |    41.66 |   11.11 |   47.82 | 27-34,58-62,73    
 ...lib/connectors |       0 |        0 |       0 |       0 |                   
  interface.ts     |       0 |        0 |       0 |       0 | 102-351           
 ...b/featureFlags |       0 |        0 |       0 |       0 |                   
  definitions.ts   |       0 |        0 |       0 |       0 | 3-47              
  provider.tsx     |       0 |        0 |       0 |       0 | 11-49             
  server.ts        |       0 |        0 |       0 |       0 | 7-14              
 ...b/googleSheets |       0 |        0 |       0 |       0 |                   
  columnMapping.ts |       0 |        0 |       0 |       0 | 50-107            
  ...eConnector.ts |       0 |        0 |       0 |       0 | 19-258            
 ...rc/lib/preview |       0 |        0 |       0 |       0 |                   
  ...iewSession.ts |       0 |        0 |       0 |       0 | 48-461            
 .../previewRunner |       0 |        0 |       0 |       0 |                   
  ...oadManager.ts |       0 |        0 |       0 |       0 | 14-51             
  ...ationLayer.ts |       0 |        0 |       0 |       0 | 25-75             
  ...nvironment.ts |       0 |        0 |       0 |       0 | 49-186            
  PreviewRouter.ts |       0 |        0 |       0 |       0 | 15-73             
  ...leResolver.ts |       0 |        0 |       0 |       0 | 23-56             
  ...nvironment.ts |       0 |        0 |       0 |       0 | 7-23              
 ...ner/testRunner |       0 |        0 |       0 |       0 |                   
  ...TestRunner.ts |       0 |        0 |       0 |       0 | 35-86             
 ...lib/randomizer |       0 |        0 |       0 |       0 |                   
  aiRandomFill.ts  |       0 |        0 |       0 |       0 | 24-359            
  randomFill.ts    |       0 |        0 |       0 |       0 | 42-609            
 .../src/lib/snips |       0 |        0 |       0 |       0 |                   
  importService.ts |       0 |        0 |       0 |       0 | 20-337            
  registry.ts      |       0 |      100 |       0 |       0 | 12-148            
  types.ts         |       0 |        0 |       0 |       0 |                   
 ...src/lib/stores |       0 |        0 |       0 |       0 |                   
  ...ationStore.ts |       0 |        0 |       0 |       0 | 17-58             
 .../src/marketing |       0 |      100 |       0 |       0 |                   
  LandingPage.tsx  |       0 |      100 |       0 |       0 | 13-39             
 ...ing/components |       0 |      100 |       0 |       0 |                   
  AIAnalytics.tsx  |       0 |      100 |       0 |       0 | 6                 
  ...ncedStory.tsx |       0 |      100 |       0 |       0 | 7                 
  FeatureGrid.tsx  |       0 |      100 |       0 |       0 | 6-21              
  FinalCTA.tsx     |       0 |      100 |       0 |       0 | 8                 
  Hero.tsx         |       0 |      100 |       0 |       0 | 8                 
  HowItWorks.tsx   |       0 |      100 |       0 |       0 | 6-19              
  ...tAudience.tsx |       0 |      100 |       0 |       0 | 6-37              
  Testimonials.tsx |       0 |      100 |       0 |       0 | 5-17              
 .../marketing/lib |       0 |      100 |     100 |       0 |                   
  brand.ts         |       0 |      100 |     100 |       0 | 1                 
 client/src/pages  |       0 |        0 |       0 |       0 |                   
  AcceptInvite.tsx |       0 |        0 |       0 |       0 | 11-60             
  ...iSettings.tsx |       0 |        0 |       0 |       0 | 22-151            
  ...Dashboard.tsx |       0 |        0 |       0 |       0 | 27-98             
  AdminLogs.tsx    |       0 |        0 |       0 |       0 | 35-367            
  AdminUsers.tsx   |       0 |        0 |       0 |       0 | 38-270            
  ...tingsPage.tsx |       0 |        0 |       0 |       0 | 43-464            
  ...etailPage.tsx |       0 |        0 |       0 |       0 | 42-415            
  ...tionsPage.tsx |       0 |        0 |       0 |       0 | 31-191            
  Dashboard.tsx    |       0 |        0 |       0 |       0 | 28-287            
  ...tingsPage.tsx |       0 |        0 |       0 |       0 | 41-349            
  ...ditorPage.tsx |       0 |        0 |       0 |       0 | 43-379            
  ...latesPage.tsx |       0 |        0 |       0 |       0 | 32-191            
  ...eviewPage.tsx |       0 |        0 |       0 |       0 | 24-119            
  Landing.tsx      |       0 |        0 |       0 |       0 | 22-566            
  Marketplace.tsx  |       0 |        0 |       0 |       0 | 27-168            
  NewWorkflow.tsx  |       0 |        0 |       0 |       0 | 22-210            
  ...ionDetail.tsx |       0 |        0 |       0 |       0 | 28-634            
  ...nizations.tsx |       0 |        0 |       0 |       0 | 14-170            
  ProjectView.tsx  |       0 |        0 |       0 |       0 | 49-350            
  ...etionView.tsx |       0 |        0 |       0 |       0 | 33-180            
  RunDetails.tsx   |       0 |        0 |       0 |       0 | 30-322            
  RunsCompare.tsx  |       0 |        0 |       0 |       0 | 18-135            
  ...Dashboard.tsx |       0 |        0 |       0 |       0 | 20-90             
  SettingsPage.tsx |       0 |        0 |       0 |       0 | 21-474            
  ...estRunner.tsx |       0 |        0 |       0 |       0 | 30-124            
  ...latesPage.tsx |       0 |        0 |       0 |       0 | 58-650            
  ...owBuilder.tsx |       0 |        0 |       0 |       0 | 47-361            
  ...Analytics.tsx |       0 |        0 |       0 |       0 | 42-202            
  ...owBuilder.tsx |       0 |        0 |       0 |       0 | 66-395            
  ...Dashboard.tsx |       0 |        0 |       0 |       0 | 60-506            
  ...owPreview.tsx |       0 |        0 |       0 |       0 | 7-17              
  ...lowRunner.tsx |       0 |        0 |       0 |       0 | 57-1033           
  ...flowsList.tsx |       0 |        0 |       0 |       0 | 34-518            
  not-found.tsx    |       0 |      100 |       0 |       0 | 6                 
 ...src/pages/auth |       0 |        0 |       0 |       0 |                   
  ...swordPage.tsx |       0 |        0 |       0 |       0 | 16-98             
  LoginPage.tsx    |       0 |        0 |       0 |       0 | 17-229            
  RegisterPage.tsx |       0 |        0 |       0 |       0 | 17-177            
  ...swordPage.tsx |       0 |        0 |       0 |       0 | 16-135            
  ...EmailPage.tsx |       0 |        0 |       0 |       0 | 11-36             
 .../pages/billing |       0 |        0 |       0 |       0 |                   
  ...Dashboard.tsx |       0 |        0 |       0 |       0 | 33-84             
  PricingPage.tsx  |       0 |        0 |       0 |       0 | 8-46              
 ...ages/datavault |     2.1 |      1.2 |    1.73 |    2.27 |                   
  ...tingsPage.tsx |   81.81 |      100 |      50 |   81.81 | 47,98             
  [databaseId].tsx |       0 |        0 |       0 |       0 | 58-490            
  [tableId].tsx    |       0 |        0 |       0 |       0 | 56-608            
  databases.tsx    |       0 |        0 |       0 |       0 | 38-293            
  index.tsx        |       0 |        0 |       0 |       0 | 14-18             
  tables.tsx       |       0 |        0 |       0 |       0 | 45-366            
 ...ages/developer |       0 |        0 |       0 |       0 |                   
  OAuthApps.tsx    |       0 |        0 |       0 |       0 | 14-79             
 ...src/pages/docs |       0 |        0 |       0 |       0 |                   
  ...metersDoc.tsx |       0 |        0 |       0 |       0 | 15-291            
 ...s/optimization |       0 |        0 |       0 |       0 |                   
  ...ionWizard.tsx |       0 |        0 |       0 |       0 | 28-277            
 ...c/pages/portal |       0 |        0 |       0 |       0 |                   
  ...Dashboard.tsx |       0 |        0 |       0 |       0 | 25-152            
  PortalLogin.tsx  |       0 |        0 |       0 |       0 | 11-80             
  ...MagicLink.tsx |       0 |        0 |       0 |       0 | 9-51              
 ...c/pages/public |       0 |        0 |       0 |       0 |                   
  PublicRunner.tsx |       0 |        0 |       0 |       0 | 20-87             
 ...lic/components |       0 |        0 |       0 |       0 |                   
  ...gAIAssist.tsx |       0 |        0 |       0 |       0 | 26-190            
 ...pages/settings |       0 |        0 |       0 |       0 |                   
  ...gSettings.tsx |       0 |        0 |       0 |       0 | 19-151            
  DomainList.tsx   |       0 |        0 |       0 |       0 | 17-108            
 ...der/components |       0 |        0 |       0 |       0 |                   
  ...sistPanel.tsx |       0 |        0 |       0 |       0 | 23-152            
  ...derCanvas.tsx |       0 |        0 |       0 |       0 | 33-109            
  ...ionsPanel.tsx |       0 |        0 |       0 |       0 | 15-92             
  ...ateEditor.tsx |       0 |        0 |       0 |       0 | 24-96             
  ...ionEditor.tsx |       0 |        0 |       0 |       0 | 34-144            
  ...onToolbar.tsx |       0 |        0 |       0 |       0 | 33-272            
  NodeCard.tsx     |       0 |        0 |       0 |       0 | 15-152            
  NodeSidebar.tsx  |       0 |        0 |       0 |       0 | 27-435            
  PreviewPanel.tsx |       0 |        0 |       0 |       0 | 24-220            
  ...mentPanel.tsx |       0 |        0 |       0 |       0 | 81-434            
  ...estRunner.tsx |       0 |        0 |       0 |       0 | 88-466            
  ...oadDialog.tsx |       0 |        0 |       0 |       0 | 41-183            
  ...oadWizard.tsx |       0 |        0 |       0 |       0 | 37-204            
  Toolbar.tsx      |       0 |        0 |       0 |       0 | 37-161            
 ...ransformEditor |       0 |        0 |       0 |       0 |                   
  ...sistPanel.tsx |       0 |        0 |       0 |       0 | 9-82              
  GraphView.tsx    |       0 |      100 |       0 |       0 | 7-8               
  ...ormEditor.tsx |       0 |        0 |       0 |       0 | 11-25             
  ...sformList.tsx |       0 |        0 |       0 |       0 | 8-17              
  ...layground.tsx |       0 |      100 |       0 |       0 | 7-17              
 ...-builder/hooks |      30 |    30.43 |      20 |   30.58 |                   
  ...ilableVars.ts |       0 |        0 |       0 |       0 | 7-41              
  ...Validation.ts |   87.09 |    73.68 |   88.88 |   89.65 | 25-26,94          
  useHelpers.ts    |       0 |        0 |       0 |       0 | 7-47              
  ...orkflowAPI.ts |       0 |        0 |       0 |       0 | 10-239            
 ...-builder/store |    23.8 |    21.62 |    30.3 |   24.32 |                   
  ...ilderStore.ts |    23.8 |    21.62 |    30.3 |   24.32 | ...76,209,237-311 
 client/src/store  |       0 |        0 |       0 |       0 |                   
  devpanel.ts      |       0 |        0 |       0 |       0 | 27-65             
  preview.ts       |       0 |      100 |       0 |       0 | 27-46             
  ...ow-builder.ts |       0 |      100 |       0 |       0 | 40-61             
 client/src/stores |       0 |        0 |       0 |       0 |                   
  ...ilterStore.ts |       0 |        0 |       0 |       0 | 14-98             
 client/src/styles |       0 |        0 |       0 |       0 |                   
  chartTheme.ts    |       0 |        0 |       0 |       0 | 6-72              
 server            |   25.36 |    33.52 |   11.71 |   25.91 |                   
  cron.ts          |       0 |      100 |       0 |       0 | 6-22              
  db.ts            |   72.22 |    61.76 |      80 |   71.69 | ...92,113,118-122 
  googleAuth.ts    |    82.5 |    68.18 |     100 |   85.52 | ...73,124,134,168 
  index.ts         |       0 |        0 |       0 |       0 | 4-279             
  logger.ts        |   38.46 |    66.66 |   33.33 |   38.46 | 60-80             
  production.ts    |       0 |        0 |       0 |       0 | 16-135            
  routes.ts        |   44.82 |    33.33 |   33.33 |   44.82 | 34-53,73-74       
  standby.ts       |       0 |        0 |       0 |       0 | 7-41              
  static.ts        |       0 |        0 |       0 |       0 | 11-34             
  storage.ts       |       0 |      100 |       0 |       0 | 188-504           
  types.ts         |       0 |        0 |       0 |       0 |                   
  utils.ts         |       0 |        0 |       0 |       0 | 4-25              
  vite.ts          |       0 |        0 |       0 |       0 | 16-109            
 server/api        |    51.1 |    40.57 |   59.42 |   51.26 |                   
  projects.ts      |   82.35 |     62.5 |   85.71 |   83.58 | ...31,262,276-277 
  runs.ts          |   60.98 |    48.84 |   58.62 |   61.47 | ...1057,1072-1163 
  templates.ts     |    28.3 |    20.73 |   38.88 |   28.45 | ...1107,1122-1153 
  workflows.ts     |   63.51 |       47 |   73.33 |   63.47 | ...08,714,771-772 
 ...api/validators |     100 |      100 |     100 |     100 |                   
  projects.ts      |     100 |      100 |     100 |     100 |                   
  runs.ts          |     100 |      100 |     100 |     100 |                   
  templates.ts     |     100 |      100 |     100 |     100 |                   
  workflows.ts     |     100 |      100 |     100 |     100 |                   
 server/config     |   43.13 |    33.33 |   27.27 |   43.13 |                   
  aiPrompts.ts     |       0 |      100 |       0 |       0 | 27-138            
  auth.ts          |     100 |      100 |     100 |     100 |                   
  ...Validation.ts |   31.03 |    33.33 |   22.22 |   31.03 | ...08,228,243-296 
 ...er/controllers |   23.94 |     1.61 |     100 |   23.94 |                   
  AiController.ts  |   23.94 |     1.61 |     100 |   23.94 | ...16-517,531-574 
 server/di         |       0 |        0 |       0 |       0 |                   
  container.ts     |       0 |        0 |       0 |       0 | 58-208            
  index.ts         |       0 |        0 |       0 |       0 |                   
  registrations.ts |       0 |      100 |       0 |       0 | 50-282            
  tokens.ts        |       0 |      100 |     100 |       0 | 20-208            
 server/engine     |   78.07 |    65.61 |   73.68 |   79.38 |                   
  expr.ts          |   81.19 |    71.42 |   67.85 |   83.33 | ...95,306,325-331 
  index.ts         |      75 |    68.57 |   66.66 |   76.22 | ...75-476,488-489 
  registry.ts      |   36.36 |    20.83 |   33.33 |   36.36 | ...68-220,244-271 
  validate.ts      |   88.32 |    72.05 |     100 |      90 | ...24,279-286,327 
 ...r/engine/nodes |   29.86 |    25.36 |   30.23 |   30.33 |                   
  branch.ts        |       0 |        0 |       0 |       0 | 42-77             
  compute.ts       |      80 |       50 |     100 |      80 | 46,65             
  data.ts          |   66.66 |     46.6 |   77.77 |   69.79 | ...49,295-308,323 
  esign.ts         |       0 |        0 |       0 |       0 | 63-134            
  final.ts         |   78.57 |     37.5 |   66.66 |   78.57 | 73-77,104         
  http.ts          |       0 |        0 |       0 |       0 | 93-556            
  question.ts      |   45.83 |    38.29 |      50 |   47.82 | ...42,146,149-151 
  review.ts        |       0 |        0 |       0 |       0 | 60-102            
  template.ts      |   70.96 |    74.19 |      50 |   70.96 | 154-187,285       
  webhook.ts       |       0 |        0 |       0 |       0 | 57-292            
 server/errors     |   33.69 |    29.78 |   28.57 |   32.96 |                   
  AppError.ts      |       0 |        0 |       0 |       0 | 14-54             
  AuthErrors.ts    |   81.57 |    66.66 |   76.92 |   81.08 | 126-139,154-157   
  ...ationError.ts |       0 |        0 |       0 |       0 | 135-417           
 server/jobs       |       0 |        0 |       0 |       0 |                   
  metricsRollup.ts |       0 |        0 |       0 |       0 | 35-300            
 server/lib        |     100 |      100 |     100 |     100 |                   
  rateLimit.ts     |     100 |      100 |     100 |     100 |                   
 server/lib/ai     |    50.3 |    32.72 |   56.52 |   52.53 |                   
  ...istService.ts |   65.51 |    36.36 |   71.42 |   68.67 | ...00,213-223,253 
  ...nalization.ts |   39.21 |       25 |      50 |   41.66 | ...3,58-59,87-158 
  ...mGenerator.ts |   21.42 |       25 |       0 |   21.42 | 19-66             
  ...rmRevision.ts |   23.07 |       50 |       0 |   23.07 | 15-62             
 server/lib/audit  |     4.1 |     4.44 |    7.14 |    4.54 |                   
  auditLogger.ts   |     100 |      100 |     100 |     100 |                   
  blockAudit.ts    |       0 |        0 |       0 |       0 | 15-45             
  index.ts         |       0 |        0 |       0 |       0 | 13-37             
  miscAudit.ts     |       0 |      100 |       0 |       0 | 6-25              
  scriptAudit.ts   |       0 |        0 |       0 |       0 | 9-20              
  workflowAudit.ts |       0 |        0 |       0 |       0 | 21-67             
 server/lib/authz  |    4.47 |        0 |   16.66 |    4.54 |                   
  ...Permission.ts |    12.5 |        0 |       0 |   13.33 | 37-76             
  enforce.ts       |    4.76 |        0 |   33.33 |    4.76 | 7-15,20-42        
  externalAuth.ts  |       0 |        0 |       0 |       0 | 26-99             
 ...er/lib/billing |     7.4 |        0 |   45.45 |    7.69 |                   
  ...ionService.ts |    5.26 |        0 |   71.42 |    5.88 | 20-85             
  billingConfig.ts |     100 |      100 |     100 |     100 |                   
  ...PlanLimits.ts |       0 |        0 |       0 |       0 | 18-92             
 ...ling/providers |    12.5 |      100 |       0 |    12.5 |                   
  ...ngProvider.ts |       0 |        0 |       0 |       0 |                   
  ...peProvider.ts |    12.5 |      100 |       0 |    12.5 | 12-34             
 ...r/lib/external |   68.75 |    57.69 |   66.66 |   70.21 |                   
  ...SendRunner.ts |   68.75 |    57.69 |   66.66 |   70.21 | ...85,129,147-170 
  interfaces.ts    |       0 |        0 |       0 |       0 |                   
 ...ernal/adapters |       0 |        0 |       0 |       0 |                   
  ...ookAdapter.ts |       0 |        0 |       0 |       0 | 5-58              
 server/lib/guards |       0 |        0 |       0 |       0 |                   
  ResourceGuard.ts |       0 |        0 |       0 |       0 | 3-27              
 server/lib/logic  |       0 |        0 |       0 |       0 |                   
  optimizer.ts     |       0 |        0 |       0 |       0 | 20-48             
 ...r/lib/metering |       0 |        0 |      50 |       0 |                   
  ...Aggregator.ts |       0 |      100 |     100 |       0 | 15-62             
  usageMeter.ts    |       0 |        0 |       0 |       0 | 24-52             
 ...lib/migrations |       0 |        0 |       0 |       0 |                   
  pipeline.ts      |       0 |        0 |       0 |       0 | 32-77             
 .../observability |      12 |     12.5 |       0 |   13.04 |                   
  logger.ts        |      30 |       25 |       0 |      30 | 24-49             
  metrics.ts       |       0 |        0 |       0 |       0 | 20-73             
 ...ib/performance |       0 |        0 |       0 |       0 |                   
  profiler.ts      |       0 |        0 |       0 |       0 | 9-39              
 ...er/lib/queries |   61.84 |    51.21 |     100 |   60.56 |                   
  QueryRunner.ts   |   61.84 |    51.21 |     100 |   60.56 | 58-105,130-133    
 server/lib/shared |   67.39 |       60 |     100 |   73.17 |                   
  ...leResolver.ts |   67.39 |       60 |     100 |   73.17 | 39-55,70-76       
 .../lib/templates |    6.66 |        0 |       0 |    6.66 |                   
  ...ateService.ts |    6.66 |        0 |       0 |    6.66 | 33-106            
  types.ts         |       0 |        0 |       0 |       0 |                   
 ...er/lib/tenancy |       0 |        0 |       0 |       0 |                   
  tenantContext.ts |       0 |        0 |       0 |       0 | 10-32             
 ...lib/transforms |     8.1 |        5 |   28.57 |    8.33 |                   
  debugger.ts      |       0 |        0 |   33.33 |       0 | 5-73              
  schemaAlign.ts   |   23.07 |       50 |       0 |   23.07 | 20-50             
 ...orms/optimizer |       0 |        0 |       0 |       0 |                   
  ...Transforms.ts |       0 |      100 |       0 |       0 | 5                 
  ...Overwrites.ts |       0 |      100 |       0 |       0 | 5                 
  foldConstants.ts |       0 |      100 |       0 |       0 | 5                 
  ...Transforms.ts |       0 |      100 |       0 |       0 | 6                 
  ...Transforms.ts |       0 |        0 |       0 |       0 | 7-13              
  ...Transforms.ts |       0 |        0 |       0 |       0 | 10-12             
 ...r/lib/webhooks |       0 |        0 |      75 |       0 |                   
  dispatcher.ts    |       0 |        0 |      75 |       0 | 14-90             
 server/lib/writes |   52.23 |    47.72 |   71.42 |   53.03 |                   
  WriteRunner.ts   |   52.23 |    47.72 |   71.42 |   53.03 | ...06-112,222-247 
 server/middleware |   28.03 |    25.06 |   24.52 |   27.96 |                   
  aclAuth.ts       |    5.12 |        0 |      25 |    5.12 | 20-123            
  adminAuth.ts     |    8.33 |        0 |       0 |    8.33 | 12-74             
  ai.middleware.ts |      76 |       60 |     100 |      75 | 21,26,43,64,78-79 
  apiTokenAuth.ts  |       0 |        0 |       0 |       0 | 9-208             
  asyncHandler.ts  |       0 |      100 |       0 |       0 | 9-11              
  auth.ts          |    90.8 |    76.36 |   76.92 |   90.47 | ...04,235,251,274 
  ...ertToDraft.ts |    5.88 |        0 |       0 |    5.88 | 18-54             
  domainTenant.ts  |       0 |        0 |       0 |       0 | 6-109             
  ...r.examples.ts |       0 |        0 |       0 |       0 | 11-420            
  errorHandler.ts  |    1.49 |        0 |    4.76 |    1.61 | 35-272,313-387    
  index.ts         |       0 |        0 |       0 |       0 |                   
  rateLimiter.ts   |    87.5 |     87.5 |   66.66 |    87.5 | 57,71             
  rateLimiting.ts  |       0 |        0 |       0 |       0 | 18-128            
  rbac.ts          |   88.15 |    88.46 |     100 |   87.83 | ...62-267,314-319 
  requestId.ts     |       0 |        0 |       0 |       0 | 24-46             
  requireUser.ts   |   26.66 |    17.39 |      20 |   26.66 | ...2,59-64,73-129 
  runTokenAuth.ts  |     8.1 |     4.54 |      50 |     8.1 | 36-86,120-169     
  ...ityHeaders.ts |       0 |        0 |       0 |       0 | 31-227            
  tenant.ts        |    8.06 |     4.16 |   16.66 |    8.06 | 20-30,51-240      
  timeout.ts       |       0 |        0 |       0 |       0 | 5-68              
  validateId.ts    |   39.02 |    17.85 |   21.73 |   45.31 | ...95-106,112-215 
 .../observability |   48.57 |       40 |   36.36 |   48.57 |                   
  prom.ts          |       0 |        0 |       0 |       0 | 58-154            
  telemetry.ts     |   77.27 |       50 |      80 |   77.27 | 23-24,51,65,81    
 server/queues     |    2.84 |     4.09 |       0 |    2.95 |                   
  ...isionQueue.ts |    7.69 |     6.94 |       0 |    8.33 | 59-184,195-219    
  ...ationQueue.ts |       0 |        0 |       0 |       0 | 83-326            
  ...tionWorker.ts |       0 |        0 |       0 |       0 | 31-377            
 server/realtime   |    7.06 |     3.24 |    4.87 |    7.12 |                   
  auth.ts          |    1.66 |        0 |       0 |    1.69 | 27-243            
  awareness.ts     |    2.27 |        0 |       0 |    2.27 | 28-208            
  collabServer.ts  |   11.04 |        0 |    8.33 |   11.17 | ...27-525,537-607 
  persistence.ts   |    5.84 |    11.36 |    4.16 |    5.88 | 29-424            
 ...r/repositories |   36.84 |     19.2 |   39.03 |   36.99 |                   
  AclRepository.ts |   31.25 |        0 |   33.33 |   33.33 | ...57-158,195-250 
  ...Repository.ts |    2.46 |        0 |   11.11 |    2.59 | 25-258            
  ...Repository.ts |    1.05 |        0 |    2.08 |    1.08 | 39-799            
  ...Repository.ts |   59.45 |    33.33 |      70 |   57.14 | 69-81,134-154     
  ...Repository.ts |    42.1 |       25 |   44.44 |    42.1 | 84-127            
  ...Repository.ts |    62.5 |       50 |   66.66 |    62.5 | 38-44,64,84-85    
  ...Repository.ts |   71.42 |       50 |      80 |   71.42 | 34-40,55          
  ...Repository.ts |   58.82 |        0 |    62.5 |   58.82 | 34-74,121-122     
  ...Repository.ts |   69.23 |    66.66 |   66.66 |      68 | ...,88-94,133-134 
  ...Repository.ts |   43.24 |       35 |   28.57 |   44.44 | ...65-173,211-298 
  ...Repository.ts |   69.23 |      100 |   71.42 |   69.23 | 33-35,109-110     
  ...Repository.ts |   59.57 |    55.95 |   51.42 |   62.01 | ...74-608,651-680 
  ...Repository.ts |   63.15 |      100 |    62.5 |   63.15 | 63-64,105-126     
  ...Repository.ts |   56.66 |       50 |      60 |   58.62 | ...07-108,133-177 
  ...Repository.ts |   19.04 |      100 |   22.22 |   19.04 | 41-126            
  ...Repository.ts |   11.76 |        0 |   16.66 |   11.76 | 30-116            
  ...Repository.ts |     100 |      100 |     100 |     100 |                   
  ...Repository.ts |      20 |        0 |       0 |      25 | 10-23             
  ...Repository.ts |    5.55 |        0 |    6.66 |    5.71 | 20-144            
  ...Repository.ts |   76.47 |       75 |   66.66 |   76.47 | 42-43,101-102     
  ...Repository.ts |     100 |      100 |     100 |     100 |                   
  ...Repository.ts |    8.69 |        0 |      20 |    8.69 | 22-142            
  ...Repository.ts |   80.76 |       50 |   71.42 |   80.76 | 48,58-59,111-112  
  ...Repository.ts |    12.5 |        0 |   14.28 |    12.5 | 26-117            
  ...Repository.ts |   44.44 |      100 |      50 |   44.44 | 37-47             
  ...Repository.ts |   64.28 |      100 |   66.66 |   64.28 | 45-46,82-87       
  ...Repository.ts |   66.66 |       75 |      75 |   66.66 | 46-59             
  ...Repository.ts |    8.33 |        0 |      10 |    8.33 | 33-171            
  ...Repository.ts |    8.33 |        0 |      20 |    8.33 | 36-122            
  ...Repository.ts |   55.88 |    44.44 |      50 |   56.25 | 115-166           
  ...Repository.ts |     100 |      100 |     100 |     100 |                   
  ...Repository.ts |   47.36 |    33.33 |      50 |   47.36 | 22-31,41-90       
  ...Repository.ts |   31.57 |      100 |    37.5 |   31.57 | ...,59-83,105-133 
  ...Repository.ts |    5.26 |        0 |       0 |    5.26 | 22-117            
  ...Repository.ts |       5 |        0 |   11.11 |       5 | 12-80,108-172     
  ...Repository.ts |    37.5 |      100 |      30 |    37.5 | ...,81-82,100-144 
  ...Repository.ts |   56.66 |       50 |   66.66 |   56.66 | 53-54,75,81-109   
  ...Repository.ts |   11.76 |        0 |      25 |   11.76 | 20-76             
  ...Repository.ts |   40.57 |    20.93 |   27.27 |   38.98 | 102-241           
  ...Repository.ts |      50 |      100 |      50 |      50 | 27-28             
  ...Repository.ts |   48.38 |       20 |   53.84 |   47.54 | ...54-282,311-325 
  ...Repository.ts |       8 |        0 |   11.11 |       8 | 25-129            
  ...Repository.ts |      88 |      100 |    87.5 |      88 | 67-77             
  index.ts         |       0 |        0 |       0 |       0 |                   
 server/routes     |   23.59 |     9.79 |    21.8 |   23.67 |                   
  ...unt.routes.ts |   36.36 |        0 |   66.66 |   36.36 | 20-29,51-64       
  ...ngs.routes.ts |     4.5 |        0 |    3.57 |     4.9 | ...73-206,218-267 
  ...nup.routes.ts |       0 |        0 |       0 |       0 | 18-61             
  admin.routes.ts  |     9.5 |        0 |       5 |    9.64 | ...92-607,620-661 
  admin.ts         |      24 |        0 |       0 |      24 | ...29,34-62,68-72 
  ai.doc.routes.ts |   38.46 |    22.72 |   45.45 |    38.7 | ...19-134,148,163 
  ...ack.routes.ts |    9.09 |        0 |    8.33 |     9.3 | 42-94,110-172     
  ai.routes.ts     |     100 |      100 |     100 |     100 |                   
  ...ion.routes.ts |   15.78 |        0 |       0 |   15.78 | 13-26,32-43       
  ...ion.routes.ts |   44.28 |    13.33 |      50 |   46.96 | ...35-140,157-158 
  ...orm.routes.ts |      20 |        0 |       0 |      20 | ...00-106,111-121 
  ...cts.routes.ts |     100 |      100 |     100 |     100 |                   
  ...uns.routes.ts |     100 |      100 |     100 |     100 |                   
  ...tes.routes.ts |     100 |      100 |     100 |     100 |                   
  ...ows.routes.ts |     100 |      100 |     100 |     100 |                   
  auth.routes.ts   |   74.42 |    74.78 |   87.09 |   77.95 | ...1176,1183-1233 
  ...ing.routes.ts |   33.33 |        0 |   33.33 |   33.33 | 17-41,47-51       
  blocks.routes.ts |    5.59 |        0 |    9.09 |    5.63 | ...26-248,258-350 
  ...int.routes.ts |   19.23 |        0 |      25 |   19.23 | 10-17,23-43,49-68 
  ...ing.routes.ts |    10.9 |        0 |   16.66 |    10.9 | ...39-180,198-224 
  ...ons.routes.ts |    8.84 |        0 |    4.76 |    8.84 | ...43-552,561-568 
  ...-v2.routes.ts |   17.82 |        0 |   18.18 |   17.82 | ...69-297,309-365 
  ...ard.routes.ts |    7.59 |        0 |    6.66 |    8.57 | ...75-109,118-161 
  ...rce.routes.ts |   34.82 |    31.81 |   38.46 |   34.23 | ...46-262,271-280 
  ...ult.routes.ts |   35.59 |     16.3 |   31.81 |   35.47 | ...1308,1335-1371 
  ...ens.routes.ts |   52.94 |    22.22 |   83.33 |   52.94 | ...67,171,179-182 
  debug.routes.ts  |       0 |        0 |       0 |       0 | 15-71             
  ...tic.routes.ts |   42.85 |        0 |      50 |   42.85 | 14-19             
  docs.routes.ts   |      52 |       25 |      25 |      52 | ...9,78,90,95-101 
  ...oks.routes.ts |   18.51 |        0 |       0 |   18.51 | ...81-189,201-219 
  ...nts.routes.ts |     9.3 |        0 |      25 |    9.52 | 44-103,115-160    
  ...tes.routes.ts |   13.88 |        0 |      20 |   13.88 | ...79-112,129-143 
  esign.routes.ts  |   18.18 |        0 |   14.28 |   18.18 | ...17-221,236-247 
  export.routes.ts |       0 |      100 |       0 |       0 | 9-19              
  ...nal.routes.ts |   20.68 |        0 |       0 |   20.68 | 20-40,46-93,100   
  files.routes.ts  |    9.09 |        0 |      50 |    9.09 | 40-123            
  ...ock.routes.ts |    6.66 |        0 |    12.5 |    6.89 | ...11-288,306-365 
  health.ts        |   16.66 |        0 |       0 |   16.66 | 45-82,94-103,120  
  index.ts         |   98.48 |       50 |     100 |   98.48 | 115               
  intake.routes.ts |   21.83 |     2.43 |      20 |   21.83 | ...37-267,277-309 
  ...oks.routes.ts |   73.52 |        0 |    87.5 |   73.52 | ...14-221,246,266 
  marketplace.ts   |   15.62 |        0 |       0 |   15.62 | ...41,47-61,67-79 
  metrics.ts       |   81.25 |       90 |     100 |   81.25 | 37,48-49          
  oauth.routes.ts  |    9.09 |        0 |       0 |    9.09 | ...3,69-85,91-142 
  ...ons.routes.ts |    9.26 |        0 |    5.88 |    9.26 | ...54-472,483-505 
  places.routes.ts |   20.83 |        0 |       0 |   20.83 | 22-34,39-50       
  portal.routes.ts |   19.64 |        0 |       0 |   20.37 | ...28-134,143-153 
  ...iew.routes.ts |   45.45 |      100 |      50 |   45.45 | 24-32             
  ...cts.routes.ts |   13.01 |        0 |   14.28 |   13.01 | ...97-321,332-364 
  public.routes.ts |      50 |    33.33 |   33.33 |      50 | ...46-47,55,60-79 
  reviewTasks.ts   |       0 |        0 |       0 |       0 | 10-116            
  ...uts.routes.ts |   13.63 |        0 |      20 |   13.63 | ...58-108,119-152 
  runs.routes.ts   |    15.7 |      3.7 |   18.75 |    15.7 | ...02-618,627-635 
  ...ets.routes.ts |    8.42 |        0 |    12.5 |    8.42 | ...16-235,245-259 
  ...ons.routes.ts |    7.43 |        0 |      10 |    7.43 | ...18-233,242-255 
  sharing.ts       |    14.7 |        0 |       0 |    14.7 | ...37-103,109-134 
  signatures.ts    |       0 |        0 |       0 |       0 | 10-147            
  ...ots.routes.ts |   10.67 |        0 |   11.11 |   10.67 | ...08-225,237-254 
  steps.routes.ts  |    6.84 |        0 |    8.33 |    6.84 | ...67-282,291-304 
  teams.routes.ts  |   12.08 |        0 |    12.5 |   12.08 | ...82-213,222-243 
  ...sis.routes.ts |   23.07 |        0 |      20 |   23.07 | ...96-109,129-145 
  ...ing.routes.ts |       0 |        0 |       0 |       0 | 8-195             
  tenant.routes.ts |    9.63 |        0 |    12.5 |      10 | ...29-273,285-337 
  ...cks.routes.ts |       9 |        0 |      10 |       9 | ...66-190,199-235 
  ...ces.routes.ts |    12.5 |        0 |      25 |    12.5 | 18-29,38-50,59-70 
  ...ion.routes.ts |     7.4 |        0 |       0 |       8 | 21-76             
  ...ons.routes.ts |   12.35 |        0 |    12.5 |   12.35 | ...84-202,211-224 
  ...oks.routes.ts |      20 |        0 |       0 |      20 | 15-22,28-48,54-66 
  ...ics.routes.ts |   11.11 |        0 |    7.14 |   11.18 | ...89-400,409-598 
  ...rts.routes.ts |    8.33 |        0 |      50 |    8.33 | 19-46             
  ...tes.routes.ts |   28.88 |        0 |    12.5 |   28.88 | ...54-166,180-189 
  ...ows.routes.ts |   17.17 |     5.55 |   19.04 |   17.17 | ...34-579,600-636 
 server/routes/ai  |    79.2 |    50.74 |     100 |   79.59 |                   
  ...dit.routes.ts |    79.2 |    50.74 |     100 |   79.59 | ...77-278,283,353 
 server/schemas    |     100 |      100 |     100 |     100 |                   
  ...dit.schema.ts |     100 |      100 |     100 |     100 |                   
 server/services   |   42.82 |    38.28 |   46.68 |   43.47 |                   
  ...refactored.ts |       0 |        0 |       0 |       0 | 59-981            
  AIService.ts     |   46.35 |    33.09 |   42.22 |   46.59 | ...1630,1670-2129 
  ...outService.ts |     100 |      100 |     100 |     100 |                   
  ...untService.ts |   53.84 |       40 |   66.66 |   53.84 | 20-26,41,46       
  AclService.ts    |   69.38 |    68.75 |   77.77 |   70.83 | ...50,160-167,174 
  ...LogService.ts |       4 |     3.33 |   11.11 |    4.16 | 19-141            
  ...ngsService.ts |   54.54 |       25 |   66.66 |   54.54 | 44,61-74          
  ...LogService.ts |   53.73 |    58.53 |      50 |   53.03 | ...83,254,361-498 
  AuthService.ts   |   86.58 |    82.79 |     100 |   88.31 | ...38,322,483-485 
  BlockRunner.ts   |   70.37 |    53.57 |   71.42 |   70.37 | ...63,277-305,329 
  BlockService.ts  |   22.91 |    28.57 |   38.46 |   19.56 | 33-159            
  ...ingService.ts |   90.47 |      100 |     100 |   90.47 | ...31-132,209-210 
  ...chaService.ts |   61.01 |    53.84 |     100 |   61.01 | ...98,133-166,177 
  ...eldService.ts |   84.14 |    81.69 |   73.33 |   84.14 | ...23,228,250-262 
  ...ionService.ts |   95.12 |    94.44 |   85.71 |   95.12 | 175-187           
  ...rceService.ts |   66.66 |       70 |      60 |   66.66 | 71,80-91,110-121  
  ...ensService.ts |   58.69 |    61.76 |   55.55 |   58.69 | ...25,161,176-207 
  ...mnsService.ts |   66.46 |    61.07 |   60.86 |   67.48 | ...07,531,547-548 
  ...sesService.ts |   34.69 |    36.11 |   33.33 |   34.69 | ...48,152,177,183 
  ...tesService.ts |   68.29 |    70.83 |      75 |   68.29 | ...35-136,165-190 
  ...owsService.ts |   62.96 |    65.94 |   59.37 |   64.36 | ...25-426,448-602 
  ...onsService.ts |      75 |    74.07 |   77.77 |      75 | ...76,182,196-202 
  ...lesService.ts |   72.97 |    76.92 |   73.68 |   72.97 | ...10-231,302-340 
  ...ionService.ts |   19.04 |     7.14 |      60 |   19.27 | 48,70-266         
  ...ateService.ts |   81.48 |    70.58 |      75 |   81.48 | ...91,216,227-228 
  ...eueService.ts |   20.37 |     8.69 |   22.22 |   22.44 | 40-169            
  ...ataService.ts |   91.42 |    96.15 |     100 |   90.76 | ...54-155,200-201 
  ...ionService.ts |   26.66 |    33.33 |   33.33 |   26.66 | 20-39,68-88       
  ...cesService.ts |    8.82 |        0 |       0 |    8.82 | 48-115            
  ...ionService.ts |   89.55 |    76.66 |      90 |   89.06 | 82,229-245        
  ...ityService.ts |      90 |    74.07 |   92.85 |   90.59 | ...39-241,371-390 
  ...iptService.ts |       5 |        0 |       0 |    5.71 | 31-126            
  IntakeService.ts |   17.64 |    16.41 |      20 |   17.64 | ...46,155,180-313 
  ...ockService.ts |      20 |    32.25 |   33.33 |   20.68 | 54-144            
  LogicService.ts  |   21.18 |    13.51 |   23.07 |   21.51 | ...94,320,343-523 
  ...icsService.ts |   54.34 |    71.42 |      50 |   54.34 | ...11,129,148-206 
  MfaService.ts    |     100 |       95 |     100 |     100 | 47                
  ...ionService.ts |   85.48 |    68.18 |   95.45 |   85.48 | ...4,973,993,1003 
  ...eueService.ts |   72.16 |     67.5 |   56.25 |   72.16 | ...33-281,387-397 
  ...nupService.ts |       0 |        0 |       0 |       0 | 19-119            
  ...uthService.ts |     100 |      100 |     100 |     100 |                   
  PortalService.ts |   11.11 |        0 |       0 |    12.5 | 15-59             
  ...ectService.ts |   46.47 |    57.14 |   33.33 |   45.71 | ...83-103,122-246 
  ...ockService.ts |      20 |    32.25 |   33.33 |   20.68 | 53-142            
  QueryService.ts  |       0 |        0 |       0 |       0 | 16-100            
  ...ockService.ts |   46.15 |    34.28 |   66.66 |      50 | ...,80,83,134-164 
  RecordService.ts |   66.37 |    60.68 |    87.5 |   66.08 | ...25,342-367,385 
  ...terService.ts |   96.38 |       86 |     100 |    97.4 | 89-90             
  ...askService.ts |    8.77 |       16 |   11.11 |    8.77 | 35-222            
  RunService.ts    |   25.22 |    36.36 |   20.68 |   27.58 | ...88-498,522-792 
  ...ionService.ts |    11.9 |    36.36 |    9.09 |    11.9 | 36-162            
  ...estService.ts |    7.93 |    23.52 |      10 |    7.93 | 41-257            
  ...hotService.ts |      25 |     5.88 |     100 |   29.09 | ...74-178,185-214 
  StepService.ts   |   43.29 |    52.77 |   47.05 |    42.7 | ...16-118,159-325 
  TeamService.ts   |    7.69 |       20 |    9.09 |    7.84 | 33-219            
  ...sisService.ts |       0 |        0 |       0 |       0 | 80-434            
  ...icsService.ts |       1 |        0 |       0 |    1.05 | 118-487           
  ...ionService.ts |       0 |      100 |       0 |       0 | 32-43             
  ...iewService.ts |       0 |        0 |       0 |       0 | 100-318           
  ...ateService.ts |    3.44 |        0 |       0 |       4 | 32-140            
  ...ingService.ts |    8.21 |     2.63 |   15.38 |    8.33 | ...99,207,217-245 
  ...estService.ts |    3.03 |        0 |       0 |    3.03 | 52-228            
  ...ionService.ts |       0 |        0 |       0 |       0 | 68-364            
  ...ferService.ts |    82.6 |    77.77 |      75 |    82.6 | 50-53,73-89       
  ...ockService.ts |    8.57 |    13.39 |   18.18 |    8.69 | 58-443,473-555    
  ...cesService.ts |    9.09 |        0 |       0 |    9.09 | 15-56             
  ...bleService.ts |   19.04 |       50 |   14.28 |   21.05 | 32-81             
  ...ionService.ts |   25.89 |     21.5 |   23.52 |   26.86 | ...31,290,373-535 
  ...dleService.ts |       0 |        0 |       0 |       0 | 16-76             
  ...nerService.ts |       0 |        0 |       0 |       0 | 11-149            
  ...ortService.ts |   10.76 |    32.43 |    7.69 |   11.47 | 42-170            
  ...tchService.ts |   61.88 |    47.53 |   94.44 |   65.41 | ...58,764-765,784 
  ...yValidator.ts |   78.57 |    58.46 |   94.28 |   78.07 | ...30,435,446-459 
  ...lowService.ts |   38.99 |    39.61 |   39.02 |   40.09 | ...17-331,370-784 
  ...ateService.ts |   83.33 |    82.75 |      80 |    85.1 | ...78,219-224,244 
  ...ionService.ts |   75.43 |    55.55 |     100 |   74.54 | ...44-149,158-159 
  alerts.ts        |       0 |        0 |       0 |       0 | 38-320            
  cache.ts         |   36.61 |    28.57 |      36 |   36.61 | ...76-311,331-391 
  connections.ts   |   16.43 |    20.94 |   31.25 |   16.43 | ...25,236,275-647 
  docxHelpers.ts   |   85.89 |    89.13 |   90.47 |   85.24 | 108,138,261-272   
  docxRenderer.ts  |   73.56 |    57.69 |   55.55 |   74.41 | ...91,249,281-285 
  docxRenderer2.ts |   35.87 |    26.15 |   61.53 |    37.9 | ...06-210,218-367 
  emailService.ts  |   31.11 |    22.72 |      50 |   33.33 | 22-23,79-160      
  ...onnections.ts |       0 |        0 |       0 |       0 | 66-328            
  fileService.ts   |   16.36 |     6.66 |       0 |   16.66 | ...3,60-64,79-170 
  geminiService.ts |   31.57 |       25 |   33.33 |   31.57 | 23-24,37-290      
  index.ts         |       0 |        0 |       0 |       0 |                   
  metrics.ts       |   55.55 |    43.47 |   38.46 |   54.28 | ...49-302,339,342 
  oauth2.ts        |   57.42 |       46 |   58.82 |   59.18 | ...21-322,339-458 
  randomizer.ts    |       0 |        0 |   66.66 |       0 | 8-55              
  runs.ts          |   26.78 |    14.81 |      60 |   27.77 | ...15-116,137-228 
  secrets.ts       |       0 |        0 |       0 |       0 | 56-283            
  sendgrid.ts      |       0 |        0 |       0 |       0 | 6-341             
  sli.ts           |       0 |        0 |       0 |       0 | 49-327            
  templates.ts     |   60.65 |       40 |   64.28 |   63.15 | ...67,205,222-223 
 ...er/services/ai |   29.75 |    20.51 |      45 |    30.1 |                   
  ...mptBuilder.ts |    37.5 |       40 |   41.66 |    40.9 | ...42-254,294-402 
  ...iderClient.ts |       0 |        0 |       0 |       0 | 25-347            
  ...rviceUtils.ts |       0 |        0 |       0 |       0 | 11-304            
  ...ionService.ts |   59.06 |       40 |   68.75 |   63.77 | ...32,352-353,355 
  index.ts         |       0 |        0 |       0 |       0 |                   
  types.ts         |       0 |      100 |     100 |       0 | 10-27             
 ...ices/analytics |    34.9 |       20 |      36 |    33.7 |                   
  ...ionService.ts |   57.14 |       24 |   61.53 |   56.66 | 75,87-89,93-120   
  ...icsService.ts |   52.63 |    54.54 |      25 |   58.82 | 79-111            
  ...ingService.ts |    4.34 |        0 |       0 |    4.54 | 32-88             
  ...offService.ts |    8.33 |        0 |       0 |    9.09 | 32-97             
  ...mapService.ts |      10 |        0 |       0 |   11.11 | 21-41             
 ...vices/analyzer |   70.37 |     50.6 |    87.5 |   67.56 |                   
  ...geAnalyzer.ts |   70.37 |     50.6 |    87.5 |   67.56 | ...92,198-202,213 
  types.ts         |       0 |        0 |       0 |       0 |                   
 ...s/blockRunners |   30.76 |    24.56 |   54.38 |   31.15 |                   
  ...lockRunner.ts |   30.85 |    30.76 |      50 |   32.95 | ...05,218,230-281 
  ...lockRunner.ts |   16.66 |        0 |      50 |   16.66 | 17-28             
  ...lockRunner.ts |       2 |     2.81 |    12.5 |       2 | 31-328            
  ...lockRunner.ts |   47.05 |    33.33 |     100 |   47.05 | ...46,62-63,73-96 
  ...lockRunner.ts |   69.44 |    66.66 |     100 |   69.44 | ...,86-98,108-109 
  ...lockRunner.ts |    7.14 |        0 |      50 |    7.14 | 16-38             
  ...lockRunner.ts |   56.41 |       40 |     100 |   56.41 | ...,90-91,101-126 
  ...lockRunner.ts |    0.78 |        0 |    9.09 |     0.8 | 24-341            
  ...lockRunner.ts |   88.13 |       70 |     100 |   87.93 | 147-149,156-160   
  ...lockRunner.ts |   52.77 |       36 |     100 |   52.77 | ...,86-87,116-126 
  index.ts         |       0 |        0 |       0 |       0 |                   
  types.ts         |       0 |        0 |       0 |       0 |                   
 .../services/diff |   34.57 |    26.92 |   36.84 |   38.29 |                   
  ...iffService.ts |   77.08 |    55.26 |    87.5 |   85.71 | ...96,127,131,141 
  diffWorkflows.ts |       0 |        0 |       0 |       0 | 44-185            
 ...vices/document |    6.82 |     2.62 |    8.94 |    7.13 |                   
  ...mentEngine.ts |   13.04 |        0 |      50 |   13.04 | 43-89             
  DocxSanitizer.ts |       0 |        0 |       0 |       0 | 66-365            
  ...mentEngine.ts |    3.48 |        0 |    8.33 |    3.57 | 182-513,537-546   
  ...ckRenderer.ts |    2.66 |        0 |       0 |    2.66 | 137-385,415-462   
  ...nterpreter.ts |       0 |        0 |       0 |       0 | 116-567           
  ...gValidator.ts |       0 |        0 |       0 |       0 | 107-494           
  PdfConverter.ts  |   10.71 |    28.57 |      25 |   10.71 | 31-147,160,167    
  PdfService.ts    |   20.51 |        0 |   42.85 |   22.22 | 59,81-142,158-202 
  ...lateParser.ts |       0 |        0 |       0 |       0 | 21-147            
  ...ateScanner.ts |      50 |    36.84 |   55.55 |   53.42 | ...72,179,196-225 
  ...Normalizer.ts |       0 |        0 |       0 |       0 | 86-491            
  ZipBundler.ts    |    3.17 |        0 |       0 |    3.44 | 69-354            
 ...ent/extractors |       0 |        0 |       0 |       0 |                   
  IPdfExtractor.ts |       0 |        0 |       0 |       0 | 70-139            
  OcrExtractor.ts  |       0 |        0 |       0 |       0 | 43-165            
  ...dExtractor.ts |       0 |        0 |       0 |       0 | 35-241            
  ...sExtractor.ts |       0 |        0 |       0 |       0 | 32-110            
  ...bExtractor.ts |       0 |        0 |       0 |       0 | 26-200            
 ...services/esign |    0.97 |        0 |   33.33 |    1.02 |                   
  ...gnProvider.ts |       0 |        0 |       0 |       0 | 61-518            
  ...opeBuilder.ts |       0 |        0 |      20 |       0 | 70-268            
  EsignProvider.ts |    5.26 |        0 |      50 |    5.26 | 227-301           
  ...ockService.ts |    2.17 |        0 |      80 |    2.17 | 107-366           
  index.ts         |       0 |        0 |       0 |       0 | 47-60             
 ...ces/migrations |       0 |        0 |       0 |       0 |                   
  index.ts         |       0 |        0 |       0 |       0 |                   
  registry.ts      |       0 |      100 |       0 |       0 | 23-30             
  runner.ts        |       0 |        0 |       0 |       0 | 15-46             
 ...ions/migrators |       0 |        0 |       0 |       0 |                   
  ...k_refactor.ts |       0 |        0 |       0 |       0 | 13-95             
  ..._migration.ts |       0 |        0 |       0 |       0 | 12-78             
  ..._migration.ts |       0 |        0 |       0 |       0 | 10-48             
 .../services/runs |   71.77 |    62.31 |      80 |   74.78 |                   
  ...thResolver.ts |   76.19 |    67.85 |     100 |   81.57 | 32,49-58,88,107   
  ...oordinator.ts |   64.51 |    51.61 |   66.66 |   65.51 | ...25-133,139,226 
  ...enceWriter.ts |      85 |       80 |   85.71 |   89.47 | 26,39             
 ...ices/scripting |   63.11 |    53.45 |   78.94 |   63.32 |                   
  ASTValidator.ts  |   71.24 |    60.81 |   86.66 |   73.46 | ...44-548,561-565 
  ...ookService.ts |    1.19 |        0 |       0 |    1.19 | 36-438            
  HelperLibrary.ts |   70.06 |    53.57 |   85.45 |   69.59 | ...25,413-419,480 
  ...ookService.ts |   84.15 |     78.4 |     100 |      84 | ...77,493,499,503 
  ScriptContext.ts |      50 |    42.85 |      50 |      50 | 43                
  ScriptEngine.ts  |   79.16 |    80.43 |      75 |   79.16 | ...56,176,193-227 
 ...rvices/storage |       0 |        0 |       0 |       0 |                   
  ...geProvider.ts |       0 |        0 |       0 |       0 |                   
  ...geProvider.ts |       0 |        0 |       0 |       0 | 23-220            
  ...geProvider.ts |       0 |        0 |       0 |       0 | 42-232            
  ...ageFactory.ts |       0 |        0 |       0 |       0 | 23-59             
  index.ts         |       0 |        0 |       0 |       0 |                   
 .../workflow-runs |   30.18 |    31.37 |   36.36 |   31.13 |                   
  ...cleService.ts |      31 |    30.61 |      40 |   32.23 | ...32,363,375-376 
  ...icsService.ts |   62.16 |    72.72 |   66.66 |   62.16 | ...91,108,138-187 
  ...ateService.ts |    7.14 |     6.06 |   16.66 |     7.4 | 40-48,66-193      
  types.ts         |       0 |        0 |       0 |       0 |                   
 server/utils      |   19.23 |    12.17 |   25.66 |   19.24 |                   
  ...Formatting.ts |       0 |        0 |       0 |       0 | 17-102            
  checksum.ts      |      50 |      100 |      50 |      50 | 32-33             
  cookies.ts       |     100 |      100 |     100 |     100 |                   
  ...ingerprint.ts |   54.54 |       40 |      75 |   55.55 | 50-68             
  diff.ts          |       0 |        0 |       0 |       0 | 36-199            
  encryption.ts    |   92.18 |      100 |   91.66 |   91.93 | 76,196-205        
  ...oxExecutor.ts |    20.8 |    27.36 |   19.04 |    21.3 | ...07-710,736-739 
  errorHandler.ts  |       0 |        0 |       0 |       0 | 14-155            
  errors.ts        |   73.07 |    56.25 |      60 |   73.07 | ...04,112,124,154 
  ...Normalizer.ts |       0 |        0 |       0 |       0 | 67-464            
  formatters.ts    |   36.66 |    18.91 |   55.55 |   37.93 | ...-72,87,107-125 
  index.ts         |       0 |        0 |       0 |       0 |                   
  jsonselect.ts    |       0 |        0 |       0 |       0 | 27-231            
  ...eValidator.ts |       0 |        0 |       0 |       0 | 14-84             
  ...shipAccess.ts |   81.48 |    70.58 |   88.88 |   80.76 | 51,163-180        
  pagination.ts    |   95.45 |      100 |     100 |   95.45 | 65                
  responses.ts     |   32.14 |    27.27 |   11.76 |   32.14 | ...31-185,210-234 
  sanitize.ts      |       0 |        0 |       0 |       0 | 9-63              
  ...hotHelpers.ts |       0 |        0 |       0 |       0 | 40-190            
  ...onfigUtils.ts |       0 |        0 |       0 |       0 | 43-705            
  validation.ts    |   23.52 |        0 |       0 |      25 | 47-75             
  ...onMessages.ts |    7.69 |        0 |       0 |    7.69 | 8-89,97-108       
  ...leResolver.ts |     100 |      100 |     100 |     100 |                   
  ...ersionHash.ts |       0 |        0 |       0 |       0 | 31-64             
 server/workflows  |   51.56 |    64.87 |   46.15 |   51.79 |                   
  ...ionAdapter.ts |   42.05 |    41.41 |   42.85 |   43.01 | ...10,356,367-383 
  conditions.ts    |   71.42 |    72.51 |   80.95 |   71.73 | ...58,461,468-469 
  examples.ts      |       0 |      100 |       0 |       0 | 23-425            
  ...ateMachine.ts |       0 |        0 |       0 |       0 | 52-213            
  validation.ts    |   88.88 |    93.24 |   77.77 |      90 | 141-151           
 shared            |   75.23 |    76.91 |   54.47 |   73.73 |                   
  ...nEvaluator.ts |   86.66 |     82.6 |   97.14 |   90.64 | ...57,371,495,506 
  ...ionalLogic.ts |    52.6 |    55.03 |   58.82 |   51.91 | ...27-339,359-481 
  config.ts        |     100 |       65 |     100 |     100 | 77-99             
  listPipeline.ts  |   92.53 |    80.12 |     100 |   93.16 | ...40-141,328-332 
  schema.ts        |   69.97 |      100 |   44.56 |   66.66 | ...3728,3741,3806 
  workflowLogic.ts |   99.22 |    96.03 |     100 |   99.16 | 228               
  zod-schemas.ts   |     100 |      100 |     100 |     100 |                   
 shared/validation |   48.85 |    29.91 |   36.36 |   52.47 |                   
  ...Validation.ts |       0 |        0 |       0 |       0 | 53-157            
  PageValidator.ts |   13.41 |     6.02 |    9.09 |   14.66 | ...79-107,120-210 
  ...dationRule.ts |       0 |        0 |       0 |       0 |                   
  ...tionSchema.ts |       0 |        0 |       0 |       0 |                   
  Validator.ts     |   88.23 |    72.61 |     100 |   88.23 | ...74-177,185-186 
  messages.ts      |     100 |      100 |     100 |     100 |                   
  ...figSchemas.ts |     100 |      100 |     100 |     100 |                   
-------------------|---------|----------|---------|---------|-------------------

=============================== Coverage summary ===============================
Statements   : 23.55% ( 10365/43999 )
Branches     : 17.28% ( 4981/28819 )
Functions    : 18.83% ( 1848/9812 )
Lines        : 23.85% ( 10002/41934 )
================================================================================
