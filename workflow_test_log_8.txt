npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764813133164,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764813135358,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764813137133,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764813137133,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764813137141,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764813137141,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764813137141,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764813137141,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764813137648,"env":"test","module":"user-credentials-repository","userId":"ULIwmnrgtBUMmnf4vTfBx","msg":"User credentials created"}
{"level":30,"time":1764813137650,"env":"test","module":"auth-routes","userId":"ULIwmnrgtBUMmnf4vTfBx","email":"test-workflows-1HV1dS4FwSY8pNRAcaIjd@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"1fca7329-a11c-488b-95d0-54aa52799d77","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ULIwmnrgtBUMmnf4vTfBx","tenantId":"a1bb9d37-438a-4587-b5e3-375bcbf2fe7f","createdBy":"ULIwmnrgtBUMmnf4vTfBx","ownerId":"ULIwmnrgtBUMmnf4vTfBx","status":"active","archived":false,"createdAt":"2025-12-04T01:52:17.865Z","updatedAt":"2025-12-04T01:52:17.865Z"}

{"level":30,"time":1764813138402,"env":"test","module":"user-credentials-repository","userId":"AXrCqfbaLqhVs_hiQRwM_","msg":"User credentials created"}
{"level":30,"time":1764813138403,"env":"test","module":"auth-routes","userId":"AXrCqfbaLqhVs_hiQRwM_","email":"viewer-M6qNc5el0vgTTLugR4BOp@example.com","msg":"User registered successfully"}
{"level":40,"time":1764813138506,"env":"test","module":"rbac-middleware","userId":"AXrCqfbaLqhVs_hiQRwM_","userRole":"viewer","permission":"workflow:create","path":"/projects/1fca7329-a11c-488b-95d0-54aa52799d77/workflows","msg":"Permission denied"}
{"level":50,"time":1764813145068,"env":"test","error":{},"workflowId":"e01af534-b4b5-40a2-ba8c-1e2a7a273d65","userId":"ULIwmnrgtBUMmnf4vTfBx","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764813145437,"env":"test","module":"auth-middleware","path":"/api/workflows/fea68ad3-2d1b-4180-9b93-db6a4f12004a/move","msg":"No valid authentication found"}
{"level":40,"time":1764813145810,"env":"test","module":"auth-middleware","path":"/api/workflows/b3892ab3-db83-4e84-8680-a055aba742a0/move","msg":"No valid authentication found"}
{"level":50,"time":1764813146251,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"695cdebd-de12-4982-959d-a4ec4660d558","userId":"ULIwmnrgtBUMmnf4vTfBx","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764813146685,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"72dea97d-910e-4983-8bb2-59d2d605fb42","userId":"ULIwmnrgtBUMmnf4vTfBx","msg":"Error moving workflow"}
{"level":40,"time":1764813147068,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764813147120,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"c20e33ee-9a96-4473-b45f-ffae7eb60455","userId":"ULIwmnrgtBUMmnf4vTfBx","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 10313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 381[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 308[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 534[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 900[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 677[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[33m 461[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[33m 739[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 682[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 835[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 533[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 435[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 434[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 6 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:198:10
    196|         .set("Authorization", `Bearer ${authToken}`)
    197|         .send({})
    198|         .expect(200);
       |          ^
    199| 
    200|       // Try to edit
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
AssertionError: expected { Î“Ã‡Âª(19) } to have property "status" with value 'published'

Expected: "published"
Received: "active"

 Î“Â¥Â» tests/integration/api.workflows.test.ts:230:29
    228|         .expect(200);
    229| 
    230|       expect(response.body).toHaveProperty("status", "published");
       |                             ^
    231|       expect(response.body.currentVersion).toHaveProperty("published",Î“Ã‡Âª
    232|       expect(response.body.currentVersion).toHaveProperty("publishedAtÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
AssertionError: expected { Î“Ã‡Âª(12) } to have property "published" with value true

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/api.workflows.test.ts:260:38
    258|       expect(response.body).toHaveProperty("items");
    259|       expect(response.body.items.length).toBeGreaterThan(0);
    260|       expect(response.body.items[0]).toHaveProperty("published", true);
       |                                      ^
    261|     });
    262|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:330:10
    328|         .get(`/api/workflows/${workflowId}`)
    329|         .set("Authorization", `Bearer ${authToken}`)
    330|         .expect(200);
       |          ^
    331| 
    332|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:374:10
    372|         .set("Authorization", `Bearer ${authToken2}`)
    373|         .send({ projectId: targetProjectId })
    374|         .expect(403);
       |          ^
    375| 
    376|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:430:10
    428|         .set("Authorization", `Bearer ${authToken}`)
    429|         .send({ projectId: user2ProjectId })
    430|         .expect(403);
       |          ^
    431| 
    432|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m6 failed[39m[22m[2m | [22m[1m[32m11 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 19:52:09
[2m   Duration [22m 18.23s[2m (transform 3.01s, setup 962ms, collect 5.97s, tests 10.31s, environment 0ms, prepare 19ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764813240243,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764813242676,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764813245090,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764813245090,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764813245105,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764813245105,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764813245105,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764813245106,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764813245661,"env":"test","module":"user-credentials-repository","userId":"xVVDxy_6urzzJdmCWOSYE","msg":"User credentials created"}
{"level":30,"time":1764813245665,"env":"test","module":"auth-routes","userId":"xVVDxy_6urzzJdmCWOSYE","email":"test-workflows-yM33zJf9nKxHCPgr9utb5@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"482d619b-58c6-406a-835b-ae75d7457002","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"xVVDxy_6urzzJdmCWOSYE","tenantId":"3e719c5a-5b1b-428c-ab29-80dc411f4bfa","createdBy":"xVVDxy_6urzzJdmCWOSYE","ownerId":"xVVDxy_6urzzJdmCWOSYE","status":"active","archived":false,"createdAt":"2025-12-04T01:54:05.975Z","updatedAt":"2025-12-04T01:54:05.975Z"}

{"level":30,"time":1764813246552,"env":"test","module":"user-credentials-repository","userId":"GazEyhlhZ63ZhT50GtgoG","msg":"User credentials created"}
{"level":30,"time":1764813246553,"env":"test","module":"auth-routes","userId":"GazEyhlhZ63ZhT50GtgoG","email":"viewer-XBwRuOM-oM4N1OPjmpnEF@example.com","msg":"User registered successfully"}
{"level":40,"time":1764813246665,"env":"test","module":"rbac-middleware","userId":"GazEyhlhZ63ZhT50GtgoG","userRole":"viewer","permission":"workflow:create","path":"/projects/482d619b-58c6-406a-835b-ae75d7457002/workflows","msg":"Permission denied"}
{"level":50,"time":1764813254342,"env":"test","error":{},"workflowId":"0ec7dc60-dc16-43e8-903a-25f6c8181c34","userId":"xVVDxy_6urzzJdmCWOSYE","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764813254790,"env":"test","module":"auth-middleware","path":"/api/workflows/01eef4df-783f-48e3-9dfb-1e2c13051e38/move","msg":"No valid authentication found"}
{"level":40,"time":1764813255206,"env":"test","module":"auth-middleware","path":"/api/workflows/38b7e6c9-2528-43d2-a83f-536bc0001376/move","msg":"No valid authentication found"}
{"level":50,"time":1764813255647,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8bc62013-0367-455b-b43d-e7486982d58e","userId":"xVVDxy_6urzzJdmCWOSYE","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764813256086,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"7c436d82-897b-48b9-8f60-34ec01e25495","userId":"xVVDxy_6urzzJdmCWOSYE","msg":"Error moving workflow"}
{"level":40,"time":1764813256485,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
{"level":50,"time":1764813256541,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4572a30f-4fe6-4ca6-8e81-7fbd675409df","userId":"xVVDxy_6urzzJdmCWOSYE","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 11768[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 398[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 939[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 923[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 760[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 953[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 721[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 876[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 447[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 416[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 438[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 457[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:381:10
    379|         .set("Authorization", `Bearer ${authToken2}`)
    380|         .send({ projectId: targetProjectId })
    381|         .expect(403);
       |          ^
    382| 
    383|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:437:10
    435|         .set("Authorization", `Bearer ${authToken}`)
    436|         .send({ projectId: user2ProjectId })
    437|         .expect(403);
       |          ^
    438| 
    439|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 19:53:57
[2m   Duration [22m 19.13s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764813636504,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764813640391,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764813646848,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764813646849,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764813646859,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764813646859,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764813646859,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764813646860,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764813647497,"env":"test","module":"user-credentials-repository","userId":"6KdICI-AsDIxgtRVg3bDy","msg":"User credentials created"}
{"level":30,"time":1764813647502,"env":"test","module":"auth-routes","userId":"6KdICI-AsDIxgtRVg3bDy","email":"test-workflows-WuqphrvXiPGBehcEgPy1B@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"32f2873b-5d4d-4dfa-b702-bce1fc692f22","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"6KdICI-AsDIxgtRVg3bDy","tenantId":"86c281a4-2e05-4a2d-a9c9-edd025d62f31","createdBy":"6KdICI-AsDIxgtRVg3bDy","ownerId":"6KdICI-AsDIxgtRVg3bDy","status":"active","archived":false,"createdAt":"2025-12-04T02:00:47.792Z","updatedAt":"2025-12-04T02:00:47.792Z"}

{"level":30,"time":1764813648363,"env":"test","module":"user-credentials-repository","userId":"lLe5HuPYbK1RL2gmdHQXU","msg":"User credentials created"}
{"level":30,"time":1764813648364,"env":"test","module":"auth-routes","userId":"lLe5HuPYbK1RL2gmdHQXU","email":"viewer-yhIn0CsF3xrNkchm5pWYh@example.com","msg":"User registered successfully"}
{"level":40,"time":1764813648474,"env":"test","module":"rbac-middleware","userId":"lLe5HuPYbK1RL2gmdHQXU","userRole":"viewer","permission":"workflow:create","path":"/projects/32f2873b-5d4d-4dfa-b702-bce1fc692f22/workflows","msg":"Permission denied"}
{"level":40,"time":1764813651526,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813651588,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/projects/32f2873b-5d4d-4dfa-b702-bce1fc692f22/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813651649,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813651714,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/projects/32f2873b-5d4d-4dfa-b702-bce1fc692f22/workflows","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813651772,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/workflows/undefined/publish","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813651830,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/workflows/undefined/versions","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813652097,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(6KdICI-AsDIxgtRVg3bDy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6KdICI-AsDIxgtRVg3bDy","msg":"Error creating workflow"}
{"level":40,"time":1764813652160,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813682506,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(6KdICI-AsDIxgtRVg3bDy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6KdICI-AsDIxgtRVg3bDy","msg":"Error creating workflow"}
{"level":40,"time":1764813682555,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813712932,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(6KdICI-AsDIxgtRVg3bDy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6KdICI-AsDIxgtRVg3bDy","msg":"Error creating workflow"}
{"level":40,"time":1764813712984,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/","msg":"User does not have an associated tenant"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'undefined'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764813713086,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"6KdICI-AsDIxgtRVg3bDy","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: error: invalid input syntax for type uuid: "undefined"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at NeonPreparedQuery.execute (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
    at WorkflowRepository.findById (C:/Users/scoot/poll/VaultLogic/server/repositories/BaseRepository.ts:52:22)
    at WorkflowRepository.findByIdOrSlug (C:/Users/scoot/poll/VaultLogic/server/repositories/WorkflowRepository.ts:87:18)
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:44:22)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24 {
  length: 141,
  severity: 'ERROR',
  code: '22P02',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: "unnamed portal parameter $1 = '...'",
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'uuid.c',
  line: '138',
  routine: 'string_to_uuid'
}

{"level":50,"time":1764813713457,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(6KdICI-AsDIxgtRVg3bDy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6KdICI-AsDIxgtRVg3bDy","msg":"Error creating workflow"}
{"level":40,"time":1764813713509,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813713513,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764813713705,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(6KdICI-AsDIxgtRVg3bDy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6KdICI-AsDIxgtRVg3bDy","msg":"Error creating workflow"}
{"level":40,"time":1764813713759,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813713766,"env":"test","module":"auth-middleware","path":"/api/workflows/undefined/move","msg":"No valid authentication found"}
{"level":50,"time":1764813713974,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(6KdICI-AsDIxgtRVg3bDy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6KdICI-AsDIxgtRVg3bDy","msg":"Error creating workflow"}
{"level":40,"time":1764813714036,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813744395,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(6KdICI-AsDIxgtRVg3bDy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6KdICI-AsDIxgtRVg3bDy","msg":"Error creating workflow"}
{"level":40,"time":1764813744445,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764813775071,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(6KdICI-AsDIxgtRVg3bDy) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"6KdICI-AsDIxgtRVg3bDy","msg":"Error creating workflow"}
{"level":40,"time":1764813775124,"env":"test","module":"tenant-middleware","userId":"6KdICI-AsDIxgtRVg3bDy","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764813775130,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 188290[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 401[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 337[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 562[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 922[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 691[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow editing published workflow[39m[33m 339[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should publish workflow[39m[32m 122[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[32m 181[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[33m 30332[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 30393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[33m 531[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 425[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 253[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30273[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30409[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30678[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/11]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 10 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PATCH /api/workflows/:id > should not allow editing published workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:201:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/workflows/:id/publish > should publish workflow
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:231:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
Error: expected 200 "OK", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:263:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:297:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:316:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Error: expected 404 "Not Found", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:349:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:381:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:397:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/11]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:407:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/11]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 5 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should move workflow to a project". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should move workflow to Main Folder (projectId = null)". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:234:15
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
    155| 
    156|         logger.debug({ userId: payload.userId, path: req.path }, 'JWT Î“Ã‡Âª
    157|         next();
       |         ^
    158|         return;
    159|       } catch (error) {
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m10 failed[39m[22m[2m | [22m[1m[32m7 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m5 errors[39m[22m
[2m   Start at [22m 20:00:30
[2m   Duration [22m 203.31s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764813836704,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764813837694,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764813838806,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764813838807,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764813838813,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764813838813,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764813838813,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764813838813,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764813839258,"env":"test","module":"user-credentials-repository","userId":"zJkzhq4LmjXVZD7F-Uk1R","msg":"User credentials created"}
{"level":30,"time":1764813839260,"env":"test","module":"auth-routes","userId":"zJkzhq4LmjXVZD7F-Uk1R","email":"test-workflows-xETiLXH1Fnf3CwiW6o28Z@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"daf3c12d-2f10-40be-983f-a5c22581bb6d","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"zJkzhq4LmjXVZD7F-Uk1R","tenantId":"6ab0ea0f-b6dc-469d-82ff-9395d9663fd6","createdBy":"zJkzhq4LmjXVZD7F-Uk1R","ownerId":"zJkzhq4LmjXVZD7F-Uk1R","status":"active","archived":false,"createdAt":"2025-12-04T02:03:59.501Z","updatedAt":"2025-12-04T02:03:59.501Z"}

{"level":30,"time":1764813840016,"env":"test","module":"user-credentials-repository","userId":"NBkOYAoLtR0spO-LdHEi6","msg":"User credentials created"}
{"level":30,"time":1764813840017,"env":"test","module":"auth-routes","userId":"NBkOYAoLtR0spO-LdHEi6","email":"viewer--K2BLqKg5UN7FZ4dpV5wb@example.com","msg":"User registered successfully"}
{"level":40,"time":1764813840124,"env":"test","module":"rbac-middleware","userId":"NBkOYAoLtR0spO-LdHEi6","userRole":"viewer","permission":"workflow:create","path":"/projects/daf3c12d-2f10-40be-983f-a5c22581bb6d/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'54b3e653-45c9-45c7-ab18-e01312823af0'[39m,
  projectId: [32m'd4940986-a0f3-4c96-8740-84910e096d64'[39m,
  body: { projectId: [32m'd4940986-a0f3-4c96-8740-84910e096d64'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'54b3e653-45c9-45c7-ab18-e01312823af0'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'zJkzhq4LmjXVZD7F-Uk1R'[39m,
  ownerId: [32m'zJkzhq4LmjXVZD7F-Uk1R'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'd4940986-a0f3-4c96-8740-84910e096d64'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:04:05.479Z[39m,
  updatedAt: [35m2025-12-04T02:04:06.039Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'0721734f-86fd-4263-9aeb-828fe7ca6597'[39m,
  projectId: [32m'3f563bda-8336-4f91-b6b6-ba0d4d81c61e'[39m,
  body: { projectId: [32m'3f563bda-8336-4f91-b6b6-ba0d4d81c61e'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'0721734f-86fd-4263-9aeb-828fe7ca6597'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'zJkzhq4LmjXVZD7F-Uk1R'[39m,
  ownerId: [32m'zJkzhq4LmjXVZD7F-Uk1R'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'3f563bda-8336-4f91-b6b6-ba0d4d81c61e'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:04:06.385Z[39m,
  updatedAt: [35m2025-12-04T02:04:06.732Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'0721734f-86fd-4263-9aeb-828fe7ca6597'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'0721734f-86fd-4263-9aeb-828fe7ca6597'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'zJkzhq4LmjXVZD7F-Uk1R'[39m,
  ownerId: [32m'zJkzhq4LmjXVZD7F-Uk1R'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:04:06.385Z[39m,
  updatedAt: [35m2025-12-04T02:04:06.888Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'2a521998-58eb-4a5d-91a4-757eaebab59d'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764813847594,"env":"test","error":{},"workflowId":"2a521998-58eb-4a5d-91a4-757eaebab59d","userId":"zJkzhq4LmjXVZD7F-Uk1R","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764813847995,"env":"test","module":"auth-middleware","path":"/api/workflows/6c918e69-6efa-47ff-b301-aafc19a1d2ff/move","msg":"No valid authentication found"}
{"level":40,"time":1764813848377,"env":"test","module":"auth-middleware","path":"/api/workflows/22bea8b3-dd40-43f5-b4a0-321e2ace84ac/move","msg":"No valid authentication found"}
{"level":40,"time":1764813909789,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 130987[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 318[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 521[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 510[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 900[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 860[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 744[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 921[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 940[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 830[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 399[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 384[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30510[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30509[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:381:10
    379|         .set("Authorization", `Bearer ${authToken2}`)
    380|         .send({ projectId: targetProjectId })
    381|         .expect(403);
       |          ^
    382| 
    383|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:5
    385|     });
    386| 
    387|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    388|       const response = await request(baseURL)
    389|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:397:5
    395|     });
    396| 
    397|     it("should reject move without projectId in body", async () => {
       |     ^
    398|       const response = await request(baseURL)
    399|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:407:5
    405|     });
    406| 
    407|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    408|       // Create a second user with their own project
    409|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:03:55
[2m   Duration [22m 134.31s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":40,"time":1764814023030,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764814025350,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764814028659,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764814028659,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764814028681,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764814028681,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764814028681,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764814028681,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764814029236,"env":"test","module":"user-credentials-repository","userId":"-AkMCxQNRAcBf3LVxrpXh","msg":"User credentials created"}
{"level":30,"time":1764814029239,"env":"test","module":"auth-routes","userId":"-AkMCxQNRAcBf3LVxrpXh","email":"test-workflows-HSm9iE3B_npIrn4t7P3Ci@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"868509d9-c2be-43b8-bb67-7825c513aaeb","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"-AkMCxQNRAcBf3LVxrpXh","tenantId":"4b00fbbe-0ce6-44b4-b5b7-d095a4ba7dd6","createdBy":"-AkMCxQNRAcBf3LVxrpXh","ownerId":"-AkMCxQNRAcBf3LVxrpXh","status":"active","archived":false,"createdAt":"2025-12-04T02:07:09.492Z","updatedAt":"2025-12-04T02:07:09.492Z"}

{"level":30,"time":1764814030062,"env":"test","module":"user-credentials-repository","userId":"m3DzWvJ3lUR3wsxekV1vG","msg":"User credentials created"}
{"level":30,"time":1764814030063,"env":"test","module":"auth-routes","userId":"m3DzWvJ3lUR3wsxekV1vG","email":"viewer-0dpRsTy_QOziz_KnQVOKd@example.com","msg":"User registered successfully"}
{"level":40,"time":1764814030175,"env":"test","module":"rbac-middleware","userId":"m3DzWvJ3lUR3wsxekV1vG","userRole":"viewer","permission":"workflow:create","path":"/projects/868509d9-c2be-43b8-bb67-7825c513aaeb/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'4aea1dc5-ed12-4282-a914-9dafd125739d'[39m,
  projectId: [32m'7979b5cb-c021-41ab-882d-273f1d86b2e7'[39m,
  body: { projectId: [32m'7979b5cb-c021-41ab-882d-273f1d86b2e7'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'4aea1dc5-ed12-4282-a914-9dafd125739d'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'-AkMCxQNRAcBf3LVxrpXh'[39m,
  ownerId: [32m'-AkMCxQNRAcBf3LVxrpXh'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'7979b5cb-c021-41ab-882d-273f1d86b2e7'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:07:15.838Z[39m,
  updatedAt: [35m2025-12-04T02:07:16.268Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'33c3dcd2-2231-41e4-bea1-27cdb0f107fc'[39m,
  projectId: [32m'58bbc2f2-0220-46a4-a1fe-5332011b2d25'[39m,
  body: { projectId: [32m'58bbc2f2-0220-46a4-a1fe-5332011b2d25'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'33c3dcd2-2231-41e4-bea1-27cdb0f107fc'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'-AkMCxQNRAcBf3LVxrpXh'[39m,
  ownerId: [32m'-AkMCxQNRAcBf3LVxrpXh'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'58bbc2f2-0220-46a4-a1fe-5332011b2d25'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:07:16.621Z[39m,
  updatedAt: [35m2025-12-04T02:07:17.044Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'33c3dcd2-2231-41e4-bea1-27cdb0f107fc'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'33c3dcd2-2231-41e4-bea1-27cdb0f107fc'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'-AkMCxQNRAcBf3LVxrpXh'[39m,
  ownerId: [32m'-AkMCxQNRAcBf3LVxrpXh'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:07:16.621Z[39m,
  updatedAt: [35m2025-12-04T02:07:17.227Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'1cd26c57-0af8-4074-878d-8d47a2d8f580'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764814037960,"env":"test","error":{},"workflowId":"1cd26c57-0af8-4074-878d-8d47a2d8f580","userId":"-AkMCxQNRAcBf3LVxrpXh","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764814038372,"env":"test","module":"auth-middleware","path":"/api/workflows/c93ce6b1-f6ee-46f1-b0a8-49e5f091a45d/move","msg":"No valid authentication found"}
{"level":40,"time":1764814038760,"env":"test","module":"auth-middleware","path":"/api/workflows/6e539be6-65c5-4f85-80f3-b4f6fe953af4/move","msg":"No valid authentication found"}
{"level":40,"time":1764814102013,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mUser 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 133362[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 412[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 338[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 548[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 901[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 695[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 886[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 1058[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 790[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 962[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 559[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 410[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 389[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30392[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30799[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 32056[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:381:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:387:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:397:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:407:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:06:59
[2m   Duration [22m 141.74s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764814165663,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764814168172,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764814172490,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764814172491,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764814172507,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764814172507,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764814172507,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764814172507,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764814173115,"env":"test","module":"user-credentials-repository","userId":"9CJxAbcQjxEP2PR2kgB2t","msg":"User credentials created"}
{"level":30,"time":1764814173120,"env":"test","module":"auth-routes","userId":"9CJxAbcQjxEP2PR2kgB2t","email":"test-workflows-ntswSng0rtyLefInq-nf0@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"2c707d18-ae03-47e0-aff0-060ddaf79d9a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"9CJxAbcQjxEP2PR2kgB2t","tenantId":"3b1a5253-71c7-43be-bd0a-2b9147a4dfcb","createdBy":"9CJxAbcQjxEP2PR2kgB2t","ownerId":"9CJxAbcQjxEP2PR2kgB2t","status":"active","archived":false,"createdAt":"2025-12-04T02:09:33.365Z","updatedAt":"2025-12-04T02:09:33.365Z"}

{"level":30,"time":1764814173953,"env":"test","module":"user-credentials-repository","userId":"Ds59FRtHe8TUQYjdhRCzW","msg":"User credentials created"}
{"level":30,"time":1764814173954,"env":"test","module":"auth-routes","userId":"Ds59FRtHe8TUQYjdhRCzW","email":"viewer-FmgqOekg7-Ed74hO2j6Cu@example.com","msg":"User registered successfully"}
{"level":40,"time":1764814174121,"env":"test","module":"rbac-middleware","userId":"Ds59FRtHe8TUQYjdhRCzW","userRole":"viewer","permission":"workflow:create","path":"/projects/2c707d18-ae03-47e0-aff0-060ddaf79d9a/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'9f284fcd-8d4a-409a-8ef5-3714e0af3c4a'[39m,
  projectId: [32m'308c6666-d119-445c-b1ff-2e249ee4883a'[39m,
  body: { projectId: [32m'308c6666-d119-445c-b1ff-2e249ee4883a'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'9f284fcd-8d4a-409a-8ef5-3714e0af3c4a'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'9CJxAbcQjxEP2PR2kgB2t'[39m,
  ownerId: [32m'9CJxAbcQjxEP2PR2kgB2t'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'308c6666-d119-445c-b1ff-2e249ee4883a'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:09:39.879Z[39m,
  updatedAt: [35m2025-12-04T02:09:40.353Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'ab863aab-1f0d-4c68-b15f-149c2e99ab9a'[39m,
  projectId: [32m'a034d677-c86d-4940-82c8-ea79b889daaa'[39m,
  body: { projectId: [32m'a034d677-c86d-4940-82c8-ea79b889daaa'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'ab863aab-1f0d-4c68-b15f-149c2e99ab9a'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'9CJxAbcQjxEP2PR2kgB2t'[39m,
  ownerId: [32m'9CJxAbcQjxEP2PR2kgB2t'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'a034d677-c86d-4940-82c8-ea79b889daaa'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:09:40.694Z[39m,
  updatedAt: [35m2025-12-04T02:09:41.066Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'ab863aab-1f0d-4c68-b15f-149c2e99ab9a'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'ab863aab-1f0d-4c68-b15f-149c2e99ab9a'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'9CJxAbcQjxEP2PR2kgB2t'[39m,
  ownerId: [32m'9CJxAbcQjxEP2PR2kgB2t'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:09:40.694Z[39m,
  updatedAt: [35m2025-12-04T02:09:41.230Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'9660d45e-c7cc-4aa0-98bd-a10a2a7737cf'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764814181929,"env":"test","error":{},"workflowId":"9660d45e-c7cc-4aa0-98bd-a10a2a7737cf","userId":"9CJxAbcQjxEP2PR2kgB2t","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764814182319,"env":"test","module":"auth-middleware","path":"/api/workflows/6f815551-e4ec-4e3f-bacb-5acb111b1d2a/move","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mAuth Token 2: Unset

{"level":40,"time":1764814182708,"env":"test","module":"auth-middleware","path":"/api/workflows/db72a788-54e8-45a4-afee-8bdc0e412558/move","msg":"No valid authentication found"}
{"level":40,"time":1764814244383,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mUser 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 131906[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 395[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 587[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 975[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 721[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 894[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 1025[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 852[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 869[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 389[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30378[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30551[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30741[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:382:10
    380|         .set("Authorization", `Bearer ${authToken2}`)
    381|         .send({ projectId: targetProjectId })
    382|         .expect(403);
       |          ^
    383| 
    384|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:388:5
    386|     });
    387| 
    388|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    389|       const response = await request(baseURL)
    390|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:398:5
    396|     });
    397| 
    398|     it("should reject move without projectId in body", async () => {
       |     ^
    399|       const response = await request(baseURL)
    400|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:408:5
    406|     });
    407| 
    408|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    409|       // Create a second user with their own project
    410|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:09:22
[2m   Duration [22m 141.96s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1764814782077,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764814784453,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764814787858,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764814787858,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764814787869,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764814787869,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764814787870,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764814787870,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764814788421,"env":"test","module":"user-credentials-repository","userId":"XPOhd7KHnhjEfpQL-jc7B","msg":"User credentials created"}
{"level":30,"time":1764814788424,"env":"test","module":"auth-routes","userId":"XPOhd7KHnhjEfpQL-jc7B","email":"test-workflows-WMFzFhOdVIkasWuZ7DssK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"eee31282-98b5-43c6-89cb-99eba76fa777","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"XPOhd7KHnhjEfpQL-jc7B","tenantId":"12cdbf71-c899-42f0-b359-3e5953687fd0","createdBy":"XPOhd7KHnhjEfpQL-jc7B","ownerId":"XPOhd7KHnhjEfpQL-jc7B","status":"active","archived":false,"createdAt":"2025-12-04T02:19:48.686Z","updatedAt":"2025-12-04T02:19:48.686Z"}

{"level":30,"time":1764814789237,"env":"test","module":"user-credentials-repository","userId":"330PgCZI-yq6zaRSdi3Gr","msg":"User credentials created"}
{"level":30,"time":1764814789237,"env":"test","module":"auth-routes","userId":"330PgCZI-yq6zaRSdi3Gr","email":"viewer-UU283ZWukw-Qi5tHgeWBk@example.com","msg":"User registered successfully"}
{"level":40,"time":1764814789346,"env":"test","module":"rbac-middleware","userId":"330PgCZI-yq6zaRSdi3Gr","userRole":"viewer","permission":"workflow:create","path":"/projects/eee31282-98b5-43c6-89cb-99eba76fa777/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'3f63954f-043a-40df-9dd6-bad7f9a5a94f'[39m,
  projectId: [32m'210af90f-b45f-4b6c-a13d-09d4c16e24eb'[39m,
  body: { projectId: [32m'210af90f-b45f-4b6c-a13d-09d4c16e24eb'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'3f63954f-043a-40df-9dd6-bad7f9a5a94f'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'XPOhd7KHnhjEfpQL-jc7B'[39m,
  ownerId: [32m'XPOhd7KHnhjEfpQL-jc7B'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'210af90f-b45f-4b6c-a13d-09d4c16e24eb'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:19:55.006Z[39m,
  updatedAt: [35m2025-12-04T02:19:55.372Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'c0b5881c-7b6d-401c-a6e7-ab9645aac23b'[39m,
  projectId: [32m'a90ca389-63b2-407a-92d6-bf126a21a353'[39m,
  body: { projectId: [32m'a90ca389-63b2-407a-92d6-bf126a21a353'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'c0b5881c-7b6d-401c-a6e7-ab9645aac23b'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'XPOhd7KHnhjEfpQL-jc7B'[39m,
  ownerId: [32m'XPOhd7KHnhjEfpQL-jc7B'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'a90ca389-63b2-407a-92d6-bf126a21a353'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:19:55.735Z[39m,
  updatedAt: [35m2025-12-04T02:19:56.142Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'c0b5881c-7b6d-401c-a6e7-ab9645aac23b'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'c0b5881c-7b6d-401c-a6e7-ab9645aac23b'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'XPOhd7KHnhjEfpQL-jc7B'[39m,
  ownerId: [32m'XPOhd7KHnhjEfpQL-jc7B'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:19:55.735Z[39m,
  updatedAt: [35m2025-12-04T02:19:56.313Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'd83b5ee2-e370-4ebb-9f28-f9ae327f06a1'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764814797273,"env":"test","error":{},"workflowId":"d83b5ee2-e370-4ebb-9f28-f9ae327f06a1","userId":"XPOhd7KHnhjEfpQL-jc7B","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764814797665,"env":"test","module":"auth-middleware","path":"/api/workflows/548a8dd7-0452-4c0a-9907-a83cfbd0bc3b/move","msg":"No valid authentication found"}
{"level":40,"time":1764814798071,"env":"test","module":"auth-middleware","path":"/api/workflows/dd278562-3fa0-4301-8e8c-28952b6ad1d9/move","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mAuth Token 2: Unset

{"level":40,"time":1764814859713,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m401[39m {"message":"Authentication required","error":"unauthorized"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 131858[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 403[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 569[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 557[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 942[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 937[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 795[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 925[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 736[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 1062[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 672[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 392[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 405[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30382[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30592[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30662[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:382:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:388:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:398:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:408:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:19:39
[2m   Duration [22m 140.16s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx7 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1764814922343,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764814923987,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764814925911,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764814925912,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764814925919,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764814925920,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764814925920,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764814925920,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764814926396,"env":"test","module":"user-credentials-repository","userId":"BTQXzq-QqqXN-wF9QD_Fs","msg":"User credentials created"}
{"level":30,"time":1764814926398,"env":"test","module":"auth-routes","userId":"BTQXzq-QqqXN-wF9QD_Fs","email":"test-workflows-EeEFHbnMJQBZoPnAqI26t@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"a9c94a16-9689-4e5e-a863-6d0220e81115","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"BTQXzq-QqqXN-wF9QD_Fs","tenantId":"1acc36aa-9233-4de3-9b78-23c3d290ab04","createdBy":"BTQXzq-QqqXN-wF9QD_Fs","ownerId":"BTQXzq-QqqXN-wF9QD_Fs","status":"active","archived":false,"createdAt":"2025-12-04T02:22:06.645Z","updatedAt":"2025-12-04T02:22:06.645Z"}

{"level":30,"time":1764814927126,"env":"test","module":"user-credentials-repository","userId":"mF5HyADmXCsQ0HY9Jdu_d","msg":"User credentials created"}
{"level":30,"time":1764814927127,"env":"test","module":"auth-routes","userId":"mF5HyADmXCsQ0HY9Jdu_d","email":"viewer-IpjC_dXhlNl0GSapxiPwY@example.com","msg":"User registered successfully"}
{"level":40,"time":1764814927236,"env":"test","module":"rbac-middleware","userId":"mF5HyADmXCsQ0HY9Jdu_d","userRole":"viewer","permission":"workflow:create","path":"/projects/a9c94a16-9689-4e5e-a863-6d0220e81115/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'46581f9f-4653-4171-a6f7-98f651d8e4ef'[39m,
  projectId: [32m'8b270013-fc33-4135-8636-6d0032e968fa'[39m,
  body: { projectId: [32m'8b270013-fc33-4135-8636-6d0032e968fa'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'46581f9f-4653-4171-a6f7-98f651d8e4ef'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'BTQXzq-QqqXN-wF9QD_Fs'[39m,
  ownerId: [32m'BTQXzq-QqqXN-wF9QD_Fs'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'8b270013-fc33-4135-8636-6d0032e968fa'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:22:12.705Z[39m,
  updatedAt: [35m2025-12-04T02:22:13.026Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'eee7bc9a-d5db-4ea3-a75d-51438a672971'[39m,
  projectId: [32m'431a684e-f365-4e3e-a402-e9dffcccf391'[39m,
  body: { projectId: [32m'431a684e-f365-4e3e-a402-e9dffcccf391'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'eee7bc9a-d5db-4ea3-a75d-51438a672971'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'BTQXzq-QqqXN-wF9QD_Fs'[39m,
  ownerId: [32m'BTQXzq-QqqXN-wF9QD_Fs'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'431a684e-f365-4e3e-a402-e9dffcccf391'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:22:13.374Z[39m,
  updatedAt: [35m2025-12-04T02:22:13.700Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'eee7bc9a-d5db-4ea3-a75d-51438a672971'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'eee7bc9a-d5db-4ea3-a75d-51438a672971'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'BTQXzq-QqqXN-wF9QD_Fs'[39m,
  ownerId: [32m'BTQXzq-QqqXN-wF9QD_Fs'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T02:22:13.374Z[39m,
  updatedAt: [35m2025-12-04T02:22:13.860Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'f3ee43f0-4cf1-4c52-8440-17fbaa71a10a'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764814934550,"env":"test","error":{},"workflowId":"f3ee43f0-4cf1-4c52-8440-17fbaa71a10a","userId":"BTQXzq-QqqXN-wF9QD_Fs","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764814934906,"env":"test","module":"auth-middleware","path":"/api/workflows/814f7c32-b97d-4c69-a115-2a397cc521dd/move","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m400[39m {"message":"Password must contain at least one uppercase letter","error":"weak_password"}
Auth Token 2: Unset

{"level":40,"time":1764814935273,"env":"test","module":"auth-middleware","path":"/api/workflows/ea6a9f87-9b57-4b39-8b13-0bd2e39727d3/move","msg":"No valid authentication found"}
{"level":40,"time":1764815004368,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m401[39m {"message":"Authentication required","error":"unauthorized"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 138463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 320[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 519[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 524[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 884[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 666[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 819[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 720[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 1145[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 669[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 846[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 521[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 367[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30362[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30524[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 38206[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:383:10
    381|         .set("Authorization", `Bearer ${authToken2}`)
    382|         .send({ projectId: targetProjectId })
    383|         .expect(403);
       |          ^
    384| 
    385|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5
    407|     });
    408| 
    409|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    410|       // Create a second user with their own project
    411|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 20:21:59
[2m   Duration [22m 144.20s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx8 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764851241714,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764851244291,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764851248917,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764851248917,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764851248929,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764851248929,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764851248929,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764851248929,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764851249450,"env":"test","module":"user-credentials-repository","userId":"tS01ArgWVvn-vWfBaiNsU","msg":"User credentials created"}
{"level":30,"time":1764851249454,"env":"test","module":"auth-routes","userId":"tS01ArgWVvn-vWfBaiNsU","email":"test-workflows-KS1vCperQwqEN3YqGJdJy@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"1e4e985f-f0a5-4469-b381-a48d73b46722","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"tS01ArgWVvn-vWfBaiNsU","tenantId":"be744e1d-8e48-4c2c-b966-3670821ab15a","createdBy":"tS01ArgWVvn-vWfBaiNsU","ownerId":"tS01ArgWVvn-vWfBaiNsU","status":"active","archived":false,"createdAt":"2025-12-04T12:27:30.479Z","updatedAt":"2025-12-04T12:27:30.479Z"}

{"level":30,"time":1764851250224,"env":"test","module":"user-credentials-repository","userId":"hRzcybiK5FvPc0p_JXwQa","msg":"User credentials created"}
{"level":30,"time":1764851250225,"env":"test","module":"auth-routes","userId":"hRzcybiK5FvPc0p_JXwQa","email":"viewer-EO1RZPZ4amEYqTkm7hbtk@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851250336,"env":"test","module":"rbac-middleware","userId":"hRzcybiK5FvPc0p_JXwQa","userRole":"viewer","permission":"workflow:create","path":"/projects/1e4e985f-f0a5-4469-b381-a48d73b46722/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'633843d7-6433-40f4-9d56-0be6d290417a'[39m,
  projectId: [32m'f08cbfe3-94fd-4dae-953c-caa32e530e13'[39m,
  body: { projectId: [32m'f08cbfe3-94fd-4dae-953c-caa32e530e13'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'633843d7-6433-40f4-9d56-0be6d290417a'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'tS01ArgWVvn-vWfBaiNsU'[39m,
  ownerId: [32m'tS01ArgWVvn-vWfBaiNsU'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'f08cbfe3-94fd-4dae-953c-caa32e530e13'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:27:36.482Z[39m,
  updatedAt: [35m2025-12-04T12:27:36.066Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'12de4054-8132-4634-8896-030633df7fa3'[39m,
  projectId: [32m'56e905ce-d300-4596-b598-46c1deea774e'[39m,
  body: { projectId: [32m'56e905ce-d300-4596-b598-46c1deea774e'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'12de4054-8132-4634-8896-030633df7fa3'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'tS01ArgWVvn-vWfBaiNsU'[39m,
  ownerId: [32m'tS01ArgWVvn-vWfBaiNsU'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'56e905ce-d300-4596-b598-46c1deea774e'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:27:37.201Z[39m,
  updatedAt: [35m2025-12-04T12:27:36.786Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'12de4054-8132-4634-8896-030633df7fa3'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'12de4054-8132-4634-8896-030633df7fa3'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'tS01ArgWVvn-vWfBaiNsU'[39m,
  ownerId: [32m'tS01ArgWVvn-vWfBaiNsU'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:27:37.201Z[39m,
  updatedAt: [35m2025-12-04T12:27:36.947Z[39m
}

{"level":50,"time":1764851257655,"env":"test","error":{},"workflowId":"3f7a3320-12e8-45fa-834a-8bb55a36d525","userId":"tS01ArgWVvn-vWfBaiNsU","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'3f7a3320-12e8-45fa-834a-8bb55a36d525'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764851258044,"env":"test","module":"auth-middleware","path":"/api/workflows/d2b7ccda-b03d-4e9a-b983-baa6494d5d7b/move","msg":"No valid authentication found"}
{"level":30,"time":1764851258654,"env":"test","module":"user-credentials-repository","userId":"XecetNKIbC_JjSGpdAzN3","msg":"User credentials created"}
{"level":30,"time":1764851258654,"env":"test","module":"auth-routes","userId":"XecetNKIbC_JjSGpdAzN3","email":"test-workflows-EhdUWyyDKqtscN8rwV5E1@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJYZWNldE5LSWJDX0pqU0dwZEF6TjMiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLUVoZFVXeXlES3F0c2NOOHJ3VjVFMUBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiYmU3NDRlMWQtOGU0OC00YzJjLWI5NjYtMzY3MDgyMWFiMTVhIiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUxMjU4LCJleHAiOjE3NjU0NTYwNTh9.NWM6GjYwHqjU0x_wXv_6JyxNrAXheoEAooc8xkkGkTc","user":{"id":"XecetNKIbC_JjSGpdAzN3","email":"test-workflows-EhdUWyyDKqtscN8rwV5E1@example.com","firstName":null,"lastName":null,"tenantId":"be744e1d-8e48-4c2c-b966-3670821ab15a","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'635c7f19-d7ea-452f-8ef2-25f82dce6dfc'[39m,
  projectId: [32m'7002d577-5e8a-451d-8b8b-5405923aca14'[39m,
  body: { projectId: [32m'7002d577-5e8a-451d-8b8b-5405923aca14'[39m }
}

{"level":50,"time":1764851258715,"env":"test","error":{},"workflowId":"635c7f19-d7ea-452f-8ef2-25f82dce6dfc","userId":"XecetNKIbC_JjSGpdAzN3","projectId":"7002d577-5e8a-451d-8b8b-5405923aca14","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":50,"time":1764851289609,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(tS01ArgWVvn-vWfBaiNsU) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"tS01ArgWVvn-vWfBaiNsU","msg":"Error creating workflow"}
{"level":40,"time":1764851289664,"env":"test","module":"tenant-middleware","userId":"tS01ArgWVvn-vWfBaiNsU","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764851320027,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(tS01ArgWVvn-vWfBaiNsU) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"tS01ArgWVvn-vWfBaiNsU","msg":"Error creating workflow"}
{"level":40,"time":1764851320079,"env":"test","module":"tenant-middleware","userId":"tS01ArgWVvn-vWfBaiNsU","path":"/","msg":"User does not have an associated tenant"}
{"level":40,"time":1764851320086,"env":"test","module":"auth-middleware","path":"/","msg":"No valid authentication found"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m401[39m {"message":"Authentication required","error":"unauthorized"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 131186[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 334[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 520[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 895[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 680[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 865[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 922[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 706[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 895[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 671[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30384[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30566[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30415[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:27:16
[2m   Duration [22m 142.13s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx9 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":40,"time":1764851384085,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764851386395,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764851388537,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764851388538,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764851388549,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764851388549,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764851388550,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764851388550,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764851389048,"env":"test","module":"user-credentials-repository","userId":"67oar1BmHIlV7yprPKWl8","msg":"User credentials created"}
{"level":30,"time":1764851389051,"env":"test","module":"auth-routes","userId":"67oar1BmHIlV7yprPKWl8","email":"test-workflows-qb1otWWQcHkspkjENysPh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"49c7a5cd-4a4c-4d3f-b81f-da3bba6b1f7e","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"67oar1BmHIlV7yprPKWl8","tenantId":"27c8de2d-06a2-49da-97c9-59089ded1da5","createdBy":"67oar1BmHIlV7yprPKWl8","ownerId":"67oar1BmHIlV7yprPKWl8","status":"active","archived":false,"createdAt":"2025-12-04T12:29:50.089Z","updatedAt":"2025-12-04T12:29:50.089Z"}

{"level":30,"time":1764851389846,"env":"test","module":"user-credentials-repository","userId":"nBN-1pxB9iUDSOz3u0ff_","msg":"User credentials created"}
{"level":30,"time":1764851389847,"env":"test","module":"auth-routes","userId":"nBN-1pxB9iUDSOz3u0ff_","email":"viewer-5dePGd_rFBk3AVwfPd9tP@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851389958,"env":"test","module":"rbac-middleware","userId":"nBN-1pxB9iUDSOz3u0ff_","userRole":"viewer","permission":"workflow:create","path":"/projects/49c7a5cd-4a4c-4d3f-b81f-da3bba6b1f7e/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'b2486494-c448-411c-8291-02c1c4220a77'[39m,
  projectId: [32m'08db4396-5c2c-4d6b-864b-9e99e83c9639'[39m,
  body: { projectId: [32m'08db4396-5c2c-4d6b-864b-9e99e83c9639'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'b2486494-c448-411c-8291-02c1c4220a77'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'67oar1BmHIlV7yprPKWl8'[39m,
  ownerId: [32m'67oar1BmHIlV7yprPKWl8'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'08db4396-5c2c-4d6b-864b-9e99e83c9639'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:29:56.239Z[39m,
  updatedAt: [35m2025-12-04T12:29:55.839Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'e663c1c4-3ffa-4c45-9e45-5f34a6d7a57d'[39m,
  projectId: [32m'00391eae-d2b1-4242-9bd5-865dc4b0f0a1'[39m,
  body: { projectId: [32m'00391eae-d2b1-4242-9bd5-865dc4b0f0a1'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'e663c1c4-3ffa-4c45-9e45-5f34a6d7a57d'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'67oar1BmHIlV7yprPKWl8'[39m,
  ownerId: [32m'67oar1BmHIlV7yprPKWl8'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'00391eae-d2b1-4242-9bd5-865dc4b0f0a1'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:29:56.979Z[39m,
  updatedAt: [35m2025-12-04T12:29:56.579Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'e663c1c4-3ffa-4c45-9e45-5f34a6d7a57d'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'e663c1c4-3ffa-4c45-9e45-5f34a6d7a57d'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'67oar1BmHIlV7yprPKWl8'[39m,
  ownerId: [32m'67oar1BmHIlV7yprPKWl8'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:29:56.979Z[39m,
  updatedAt: [35m2025-12-04T12:29:56.748Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'01083ab1-b536-437f-b50a-4b10434e13b0'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764851397501,"env":"test","error":{},"workflowId":"01083ab1-b536-437f-b50a-4b10434e13b0","userId":"67oar1BmHIlV7yprPKWl8","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764851397896,"env":"test","module":"auth-middleware","path":"/api/workflows/b302ff49-bca7-4707-b326-49101fbffe9e/move","msg":"No valid authentication found"}
{"level":30,"time":1764851398520,"env":"test","module":"user-credentials-repository","userId":"5AGR4X5SDEhztIhUwHh8j","msg":"User credentials created"}
{"level":30,"time":1764851398521,"env":"test","module":"auth-routes","userId":"5AGR4X5SDEhztIhUwHh8j","email":"test-workflows-9hFwui0egbjv9lMM2k330@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI1QUdSNFg1U0RFaHp0SWhVd0hoOGoiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLTloRnd1aTBlZ2JqdjlsTU0yazMzMEBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiMjdjOGRlMmQtMDZhMi00OWRhLTk3YzktNTkwODlkZWQxZGE1Iiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUxMzk4LCJleHAiOjE3NjU0NTYxOTh9.opcM-YArv7r_eIe9GmK21PN5gM28pRUSgedEYf8D8to","user":{"id":"5AGR4X5SDEhztIhUwHh8j","email":"test-workflows-9hFwui0egbjv9lMM2k330@example.com","firstName":null,"lastName":null,"tenantId":"27c8de2d-06a2-49da-97c9-59089ded1da5","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'752d3667-e91a-4bbf-b41d-ed0f73b7eb22'[39m,
  projectId: [32m'10088dab-98e3-49bb-a5fd-13b92954748f'[39m,
  body: { projectId: [32m'10088dab-98e3-49bb-a5fd-13b92954748f'[39m }
}

{"level":50,"time":1764851398674,"env":"test","error":{},"workflowId":"752d3667-e91a-4bbf-b41d-ed0f73b7eb22","userId":"5AGR4X5SDEhztIhUwHh8j","projectId":"10088dab-98e3-49bb-a5fd-13b92954748f","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Workflow not found
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:47:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":50,"time":1764851398886,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(67oar1BmHIlV7yprPKWl8) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"67oar1BmHIlV7yprPKWl8","msg":"Error creating workflow"}
{"level":40,"time":1764851398940,"env":"test","module":"tenant-middleware","userId":"67oar1BmHIlV7yprPKWl8","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764851429300,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(67oar1BmHIlV7yprPKWl8) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"67oar1BmHIlV7yprPKWl8","msg":"Error creating workflow"}
{"level":40,"time":1764851429352,"env":"test","module":"tenant-middleware","userId":"67oar1BmHIlV7yprPKWl8","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764851459701,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(67oar1BmHIlV7yprPKWl8) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"67oar1BmHIlV7yprPKWl8","msg":"Error creating workflow"}
{"level":40,"time":1764851459751,"env":"test","module":"tenant-middleware","userId":"67oar1BmHIlV7yprPKWl8","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764851459967,"env":"test","module":"user-credentials-repository","userId":"6HVj7RriCQJYdV8XgiI9I","msg":"User credentials created"}
{"level":30,"time":1764851459968,"env":"test","module":"auth-routes","userId":"6HVj7RriCQJYdV8XgiI9I","email":"test-workflows-d84OGewKNjTfqjY_15rpi@example.com","msg":"User registered successfully"}
{"level":40,"time":1764851459971,"env":"test","module":"rbac-middleware","userId":"6HVj7RriCQJYdV8XgiI9I","userRole":null,"permission":"project:create","path":"/","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m403[39m {"message":"Permission denied","error":"forbidden","details":"Required permission: project:create"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 131230[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 384[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 341[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 541[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 932[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 702[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 874[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 758[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 939[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 743[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 911[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 393[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[33m 779[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30267[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30411[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30400[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:383:10
    381|         .set("Authorization", `Bearer ${authToken2}`)
    382|         .send({ projectId: targetProjectId })
    383|         .expect(403);
       |          ^
    384| 
    385|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5
    407|     });
    408| 
    409|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    410|       // Create a second user with their own project
    411|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m12 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:29:40
[2m   Duration [22m 138.64s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx10 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764852090979,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852095144,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852099579,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852099579,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852099593,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852099593,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852099593,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852099593,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852100234,"env":"test","module":"user-credentials-repository","userId":"WAhDMKSeeQYxLjrsNDjc9","msg":"User credentials created"}
{"level":30,"time":1764852100238,"env":"test","module":"auth-routes","userId":"WAhDMKSeeQYxLjrsNDjc9","email":"test-workflows-Buio8SnOYvLn_fuF0gZ6a@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"1c679398-c124-4dea-94a1-f7acd80fcadc","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"WAhDMKSeeQYxLjrsNDjc9","tenantId":"1813a0b8-cfde-47fc-84d9-f6b62113cd49","createdBy":"WAhDMKSeeQYxLjrsNDjc9","ownerId":"WAhDMKSeeQYxLjrsNDjc9","status":"active","archived":false,"createdAt":"2025-12-04T12:41:41.295Z","updatedAt":"2025-12-04T12:41:41.295Z"}

{"level":30,"time":1764852101022,"env":"test","module":"user-credentials-repository","userId":"h1W6ckpmY2XHSo7moCpMz","msg":"User credentials created"}
{"level":30,"time":1764852101023,"env":"test","module":"auth-routes","userId":"h1W6ckpmY2XHSo7moCpMz","email":"viewer-hPKn9Z657t97OUAOTS3sN@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852101127,"env":"test","module":"rbac-middleware","userId":"h1W6ckpmY2XHSo7moCpMz","userRole":"viewer","permission":"workflow:create","path":"/projects/1c679398-c124-4dea-94a1-f7acd80fcadc/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'75fb8916-f131-4bfa-9cec-2158da634a9d'[39m,
  projectId: [32m'a8091ab5-ff75-4910-81f3-d84b30406fdc'[39m,
  body: { projectId: [32m'a8091ab5-ff75-4910-81f3-d84b30406fdc'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'75fb8916-f131-4bfa-9cec-2158da634a9d'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'WAhDMKSeeQYxLjrsNDjc9'[39m,
  ownerId: [32m'WAhDMKSeeQYxLjrsNDjc9'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'a8091ab5-ff75-4910-81f3-d84b30406fdc'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:47.173Z[39m,
  updatedAt: [35m2025-12-04T12:41:46.734Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'fd2772a5-78bc-4108-affa-2faf1a456a5c'[39m,
  projectId: [32m'bba8fd06-4edf-4c56-95ae-dacde312107c'[39m,
  body: { projectId: [32m'bba8fd06-4edf-4c56-95ae-dacde312107c'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'fd2772a5-78bc-4108-affa-2faf1a456a5c'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'WAhDMKSeeQYxLjrsNDjc9'[39m,
  ownerId: [32m'WAhDMKSeeQYxLjrsNDjc9'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'bba8fd06-4edf-4c56-95ae-dacde312107c'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:47.870Z[39m,
  updatedAt: [35m2025-12-04T12:41:47.417Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'fd2772a5-78bc-4108-affa-2faf1a456a5c'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'fd2772a5-78bc-4108-affa-2faf1a456a5c'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'WAhDMKSeeQYxLjrsNDjc9'[39m,
  ownerId: [32m'WAhDMKSeeQYxLjrsNDjc9'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:41:47.870Z[39m,
  updatedAt: [35m2025-12-04T12:41:47.582Z[39m
}

{"level":50,"time":1764852108298,"env":"test","error":{},"workflowId":"ff114672-9a8f-43f1-a526-59906100c48c","userId":"WAhDMKSeeQYxLjrsNDjc9","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'ff114672-9a8f-43f1-a526-59906100c48c'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764852108676,"env":"test","module":"auth-middleware","path":"/api/workflows/cc5dbb80-257f-4488-b1e1-e016dafe551a/move","msg":"No valid authentication found"}
{"level":30,"time":1764852109341,"env":"test","module":"user-credentials-repository","userId":"DIVB1sMf-Q-cAAOCT0UFc","msg":"User credentials created"}
{"level":30,"time":1764852109342,"env":"test","module":"auth-routes","userId":"DIVB1sMf-Q-cAAOCT0UFc","email":"test-workflows-iA7AbDh3zi4_oVc0N_Oc3@example.com","msg":"User registered successfully"}
{"level":50,"time":1764852109398,"env":"test","error":{},"workflowId":"d1a852c3-a96f-458d-9ff8-aaf56a84ae97","userId":"DIVB1sMf-Q-cAAOCT0UFc","projectId":"6fde3cf1-3be9-449e-8349-aec0ecdcd94f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJESVZCMXNNZi1RLWNBQU9DVDBVRmMiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLWlBN0FiRGgzemk0X29WYzBOX09jM0BleGFtcGxlLmNvbSIsInRlbmFudElkIjoiMTgxM2EwYjgtY2ZkZS00N2ZjLTg0ZDktZjZiNjIxMTNjZDQ5Iiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyMTA5LCJleHAiOjE3NjU0NTY5MDl9.-NVK_6aX3OcelIzHoFut_T9u9JauxbU15dyoD_qkSi0","user":{"id":"DIVB1sMf-Q-cAAOCT0UFc","email":"test-workflows-iA7AbDh3zi4_oVc0N_Oc3@example.com","firstName":null,"lastName":null,"tenantId":"1813a0b8-cfde-47fc-84d9-f6b62113cd49","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'd1a852c3-a96f-458d-9ff8-aaf56a84ae97'[39m,
  projectId: [32m'6fde3cf1-3be9-449e-8349-aec0ecdcd94f'[39m,
  body: { projectId: [32m'6fde3cf1-3be9-449e-8349-aec0ecdcd94f'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764852171046,"env":"test","module":"user-credentials-repository","userId":"Bwn9cMGLHgnv7_4ITdoLI","msg":"User credentials created"}
{"level":30,"time":1764852171047,"env":"test","module":"auth-routes","userId":"Bwn9cMGLHgnv7_4ITdoLI","email":"test-workflows-vWaFrgK3aQuBOB7vY_wsG@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852171101,"env":"test","module":"rbac-middleware","userId":"Bwn9cMGLHgnv7_4ITdoLI","userRole":null,"permission":"project:create","path":"/","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m403[39m {"message":"Permission denied","error":"forbidden","details":"Required permission: project:create"}
User 2 Project ID: [90mundefined[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 131269[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 380[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 516[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 521[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 871[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 668[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 845[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 729[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 912[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 705[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 850[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 554[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 377[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 722[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30361[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30550[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 30526[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/5]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/5]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:409:5
    407|     });
    408| 
    409|     it("should reject move to project user does not have access to", aÎ“Ã‡Âª
       |     ^
    410|       // Create a second user with their own project
    411|       const email2 = `test-workflows-${nanoid()}@example.com`;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/5]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 3 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move to project user does not have access to". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m4 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m3 errors[39m[22m
[2m   Start at [22m 06:41:27
[2m   Duration [22m 142.80s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx11 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":40,"time":1764852395245,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852400190,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852405103,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852405104,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852405115,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852405115,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852405115,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852405115,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852405926,"env":"test","module":"user-credentials-repository","userId":"6jnB_ymeA3W6j5o_2J9mT","msg":"User credentials created"}
{"level":30,"time":1764852405929,"env":"test","module":"auth-routes","userId":"6jnB_ymeA3W6j5o_2J9mT","email":"test-workflows-pX1s82hTS1nBLjxaRFdka@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"abf4c140-3164-41ca-880f-e1f332017971","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"6jnB_ymeA3W6j5o_2J9mT","tenantId":"73443047-efe2-482b-8d8a-e60a00e2fcef","createdBy":"6jnB_ymeA3W6j5o_2J9mT","ownerId":"6jnB_ymeA3W6j5o_2J9mT","status":"active","archived":false,"createdAt":"2025-12-04T12:46:46.995Z","updatedAt":"2025-12-04T12:46:46.995Z"}

{"level":30,"time":1764852406756,"env":"test","module":"user-credentials-repository","userId":"lweB1efXl0qevgi9lkqcG","msg":"User credentials created"}
{"level":30,"time":1764852406757,"env":"test","module":"auth-routes","userId":"lweB1efXl0qevgi9lkqcG","email":"viewer-VLWBojsuVbi50dS4a5hfK@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852406869,"env":"test","module":"rbac-middleware","userId":"lweB1efXl0qevgi9lkqcG","userRole":"viewer","permission":"workflow:create","path":"/projects/abf4c140-3164-41ca-880f-e1f332017971/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'07a84e06-8dd3-43a5-9ca2-2cd9e399590c'[39m,
  projectId: [32m'03898ca2-2de7-4ba0-bfdc-9327009d1fd0'[39m,
  body: { projectId: [32m'03898ca2-2de7-4ba0-bfdc-9327009d1fd0'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'07a84e06-8dd3-43a5-9ca2-2cd9e399590c'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'6jnB_ymeA3W6j5o_2J9mT'[39m,
  ownerId: [32m'6jnB_ymeA3W6j5o_2J9mT'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'03898ca2-2de7-4ba0-bfdc-9327009d1fd0'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:53.095Z[39m,
  updatedAt: [35m2025-12-04T12:46:52.634Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'7aea50a1-e8c3-4d14-acf2-282574fd0b15'[39m,
  projectId: [32m'f889e2a0-ccc3-4069-8d22-0180556460c3'[39m,
  body: { projectId: [32m'f889e2a0-ccc3-4069-8d22-0180556460c3'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'7aea50a1-e8c3-4d14-acf2-282574fd0b15'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'6jnB_ymeA3W6j5o_2J9mT'[39m,
  ownerId: [32m'6jnB_ymeA3W6j5o_2J9mT'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'f889e2a0-ccc3-4069-8d22-0180556460c3'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:53.785Z[39m,
  updatedAt: [35m2025-12-04T12:46:53.315Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'7aea50a1-e8c3-4d14-acf2-282574fd0b15'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'7aea50a1-e8c3-4d14-acf2-282574fd0b15'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'6jnB_ymeA3W6j5o_2J9mT'[39m,
  ownerId: [32m'6jnB_ymeA3W6j5o_2J9mT'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T12:46:53.785Z[39m,
  updatedAt: [35m2025-12-04T12:46:53.479Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'239275a9-f84c-4a85-93c5-4bd79d91b3a4'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

{"level":50,"time":1764852414195,"env":"test","error":{},"workflowId":"239275a9-f84c-4a85-93c5-4bd79d91b3a4","userId":"6jnB_ymeA3W6j5o_2J9mT","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":40,"time":1764852414575,"env":"test","module":"auth-middleware","path":"/api/workflows/49a5781d-ccf9-4794-b147-906db1d2d7b4/move","msg":"No valid authentication found"}
{"level":30,"time":1764852415166,"env":"test","module":"user-credentials-repository","userId":"0VEzgh0doMQ2SRUXA8V1g","msg":"User credentials created"}
{"level":30,"time":1764852415167,"env":"test","module":"auth-routes","userId":"0VEzgh0doMQ2SRUXA8V1g","email":"test-workflows-n8mQBmdSvq6dGVpkMKv9E@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIwVkV6Z2gwZG9NUTJTUlVYQThWMWciLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLW44bVFCbWRTdnE2ZEdWcGtNS3Y5RUBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiNzM0NDMwNDctZWZlMi00ODJiLThkOGEtZTYwYTAwZTJmY2VmIiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyNDE1LCJleHAiOjE3NjU0NTcyMTV9.S26DbK0nQmZTYNqloIKJUbb7GopkS5LHE9Ww2ph9X0w","user":{"id":"0VEzgh0doMQ2SRUXA8V1g","email":"test-workflows-n8mQBmdSvq6dGVpkMKv9E@example.com","firstName":null,"lastName":null,"tenantId":"73443047-efe2-482b-8d8a-e60a00e2fcef","role":null}}
Auth Token 2: Set

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'cfea1fa9-aadc-4d63-81fd-4bd64972cc82'[39m,
  projectId: [32m'0a0cb75a-88ca-446f-83e6-4e4940aff230'[39m,
  body: { projectId: [32m'0a0cb75a-88ca-446f-83e6-4e4940aff230'[39m }
}

{"level":50,"time":1764852415226,"env":"test","error":{},"workflowId":"cfea1fa9-aadc-4d63-81fd-4bd64972cc82","userId":"0VEzgh0doMQ2SRUXA8V1g","projectId":"0a0cb75a-88ca-446f-83e6-4e4940aff230","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":30,"time":1764852476918,"env":"test","module":"user-credentials-repository","userId":"wqmYS6Ii7-AENr197OmfU","msg":"User credentials created"}
{"level":30,"time":1764852476919,"env":"test","module":"auth-routes","userId":"wqmYS6Ii7-AENr197OmfU","email":"test-workflows-yJpJFvGElqQsDPpYnjboB@example.com","msg":"User registered successfully"}
{"level":30,"time":1764852477135,"env":"test","module":"auth-routes","userId":"wqmYS6Ii7-AENr197OmfU","email":"test-workflows-yJpJFvGElqQsDPpYnjboB@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m201[39m {"id":"a8a46a50-b81e-4f63-a393-5d0f60ec2e2c","title":"User 2 Project","name":"User 2 Project","description":"Project owned by user 2","creatorId":"wqmYS6Ii7-AENr197OmfU","tenantId":"73443047-efe2-482b-8d8a-e60a00e2fcef","createdBy":"wqmYS6Ii7-AENr197OmfU","ownerId":"wqmYS6Ii7-AENr197OmfU","status":"active","archived":false,"createdAt":"2025-12-04T12:47:58.083Z","updatedAt":"2025-12-04T12:47:58.083Z"}
User 2 Project ID: a8a46a50-b81e-4f63-a393-5d0f60ec2e2c

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'd4016754-267a-4b5d-b1c3-e81149440096'[39m,
  projectId: [32m'a8a46a50-b81e-4f63-a393-5d0f60ec2e2c'[39m,
  body: { projectId: [32m'a8a46a50-b81e-4f63-a393-5d0f60ec2e2c'[39m }
}

{"level":50,"time":1764852477355,"env":"test","error":{},"workflowId":"d4016754-267a-4b5d-b1c3-e81149440096","userId":"6jnB_ymeA3W6j5o_2J9mT","projectId":"a8a46a50-b81e-4f63-a393-5d0f60ec2e2c","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: Error: Access denied - you do not have access to the target project
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:199:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 72589[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 574[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 906[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 678[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 835[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 902[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 690[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 852[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 545[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 651[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30368[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30582[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1179[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/api.workflows.test.ts:79:7
     77|       await db.delete(schema.workflows);
     78|       await db.delete(schema.projects);
     79|       await db.delete(schema.users);
       |       ^
     80|       await db.delete(schema.tenants).where(eq(schema.tenants.id, tenaÎ“Ã‡Âª
     81|     }

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/4]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:389:5
    387|     });
    388| 
    389|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    390|       const response = await request(baseURL)
    391|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/4]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:399:5
    397|     });
    398| 
    399|     it("should reject move without projectId in body", async () => {
       |     ^
    400|       const response = await request(baseURL)
    401|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/4]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m14 passed[39m[22m[90m (17)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 06:46:31
[2m   Duration [22m 85.81s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx12 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1764852782011,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764852792688,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764852835595,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764852835595,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764852835606,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764852835606,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764852835606,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764852835606,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764852836099,"env":"test","module":"user-credentials-repository","userId":"ioHuslZe-pjCYSs8c7RVK","msg":"User credentials created"}
{"level":30,"time":1764852836103,"env":"test","module":"auth-routes","userId":"ioHuslZe-pjCYSs8c7RVK","email":"test-workflows-Az4fQA0bUmapMH6yl-smo@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"53701fab-f9a4-40fe-84f5-d18ddc541b60","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"ioHuslZe-pjCYSs8c7RVK","tenantId":"b1a908be-c6aa-4289-9e2d-5f851dadcc4a","createdBy":"ioHuslZe-pjCYSs8c7RVK","ownerId":"ioHuslZe-pjCYSs8c7RVK","status":"active","archived":false,"createdAt":"2025-12-04T12:53:57.206Z","updatedAt":"2025-12-04T12:53:57.206Z"}

{"level":30,"time":1764852836927,"env":"test","module":"user-credentials-repository","userId":"gevSlzh7BEjwdeqcKMB04","msg":"User credentials created"}
{"level":30,"time":1764852836928,"env":"test","module":"auth-routes","userId":"gevSlzh7BEjwdeqcKMB04","email":"viewer-FDCwpZpp5Apus8PoQkfcQ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764852837029,"env":"test","module":"rbac-middleware","userId":"gevSlzh7BEjwdeqcKMB04","userRole":"viewer","permission":"workflow:create","path":"/projects/53701fab-f9a4-40fe-84f5-d18ddc541b60/workflows","msg":"Permission denied"}
{"level":50,"time":1764852844409,"env":"test","error":{},"workflowId":"1108f6ff-a35e-45e7-9bb5-861c30a16b6c","userId":"ioHuslZe-pjCYSs8c7RVK","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764852844826,"env":"test","module":"auth-middleware","path":"/api/workflows/5e94e61e-bb91-41fd-ad4c-1d494d15f672/move","msg":"No valid authentication found"}
{"level":30,"time":1764852845434,"env":"test","module":"user-credentials-repository","userId":"G20-cpluTbF3vnGd6-wT6","msg":"User credentials created"}
{"level":30,"time":1764852845435,"env":"test","module":"auth-routes","userId":"G20-cpluTbF3vnGd6-wT6","email":"test-workflows-lekUcU1FnO0vf37DbmSUh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mRegister 2 Response: [33m201[39m {"message":"Registration successful","token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJHMjAtY3BsdVRiRjN2bkdkNi13VDYiLCJlbWFpbCI6InRlc3Qtd29ya2Zsb3dzLWxla1VjVTFGbk8wdmYzN0RibVNVaEBleGFtcGxlLmNvbSIsInRlbmFudElkIjoiYjFhOTA4YmUtYzZhYS00Mjg5LTllMmQtNWY4NTFkYWRjYzRhIiwicm9sZSI6bnVsbCwiaWF0IjoxNzY0ODUyODQ1LCJleHAiOjE3NjU0NTc2NDV9.9WlfrBRExkQDJfOaB7BEd9vDGY7x0c6mJkbprWlxCME","user":{"id":"G20-cpluTbF3vnGd6-wT6","email":"test-workflows-lekUcU1FnO0vf37DbmSUh@example.com","firstName":null,"lastName":null,"tenantId":"b1a908be-c6aa-4289-9e2d-5f851dadcc4a","role":null}}
Auth Token 2: Set

{"level":50,"time":1764852845510,"env":"test","error":{},"workflowId":"a1b6e614-ff06-41c3-8559-03aa53293a9f","userId":"G20-cpluTbF3vnGd6-wT6","projectId":"54950dd9-4e5b-4f52-b9d1-8fed96131e36","msg":"Error moving workflow"}
{"level":50,"time":1764852845930,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"8f6dd34e-4dc9-4d18-b14e-393123744e61","userId":"ioHuslZe-pjCYSs8c7RVK","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764852846363,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"22ddd7a8-522b-4659-a115-dec9e98f91d6","userId":"ioHuslZe-pjCYSs8c7RVK","msg":"Error moving workflow"}
{"level":30,"time":1764852846943,"env":"test","module":"user-credentials-repository","userId":"eg0DnijMUJt-32Q-Iz2gW","msg":"User credentials created"}
{"level":30,"time":1764852846945,"env":"test","module":"auth-routes","userId":"eg0DnijMUJt-32Q-Iz2gW","email":"test-workflows-aGVBW8KYzvEqK1Dcyo3QF@example.com","msg":"User registered successfully"}
{"level":30,"time":1764852847161,"env":"test","module":"auth-routes","userId":"eg0DnijMUJt-32Q-Iz2gW","email":"test-workflows-aGVBW8KYzvEqK1Dcyo3QF@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mProject 2 Response: [33m201[39m {"id":"387302f7-5a68-46cd-ac21-a2d8c49a0a38","title":"User 2 Project","name":"User 2 Project","description":"Project owned by user 2","creatorId":"eg0DnijMUJt-32Q-Iz2gW","tenantId":"b1a908be-c6aa-4289-9e2d-5f851dadcc4a","createdBy":"eg0DnijMUJt-32Q-Iz2gW","ownerId":"eg0DnijMUJt-32Q-Iz2gW","status":"active","archived":false,"createdAt":"2025-12-04T12:54:08.100Z","updatedAt":"2025-12-04T12:54:08.100Z"}
User 2 Project ID: 387302f7-5a68-46cd-ac21-a2d8c49a0a38

{"level":50,"time":1764852847371,"env":"test","error":{},"workflowId":"c0ed0ac9-b9ea-47c7-b597-a177bffb0084","userId":"ioHuslZe-pjCYSs8c7RVK","projectId":"387302f7-5a68-46cd-ac21-a2d8c49a0a38","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12100[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 394[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 532[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 889[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 699[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 898[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 873[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 756[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 900[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 518[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 417[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 684[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 419[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 1008[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 06:52:54
[2m   Duration [22m 71.18s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx13 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21
  
  "await" can only be used inside an "async" function
  376 |  
  377 |      // Try to move the first user's workflow as the second user
  378 |      const response = await request(baseURL)
      |                       ^
  379 |        .put(`/api/workflows/${workflowId}/move`)
  380 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 06:56:28
[2m   Duration [22m 52ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx14 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:378:21
  
  "await" can only be used inside an "async" function
  376 |  
  377 |      // Try to move the first user's workflow as the second user
  378 |      const response = await request(baseURL)
      |                       ^
  379 |        .put(`/api/workflows/${workflowId}/move`)
  380 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:04:25
[2m   Duration [22m 38ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx15 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: Transform failed with 1 error:
C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:365:21: ERROR: "await" can only be used inside an "async" function
  Plugin: vite:esbuild
  File: C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:365:21
  
  "await" can only be used inside an "async" function
  363 |  
  364 |      // Try to move the first user's workflow as the second user
  365 |      const response = await request(baseURL)
      |                       ^
  366 |        .put(`/api/workflows/${workflowId}/move`)
  367 |        .set("Authorization", `Bearer ${authToken2}`)
  
 Î“Â¥Â» failureErrorWithLog node_modules/esbuild/lib/main.js:1467:15
 Î“Â¥Â» node_modules/esbuild/lib/main.js:736:50
 Î“Â¥Â» responseCallbacks.<computed> node_modules/esbuild/lib/main.js:603:9
 Î“Â¥Â» handleIncomingPacket node_modules/esbuild/lib/main.js:658:12
 Î“Â¥Â» Socket.readFromStdout node_modules/esbuild/lib/main.js:581:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:05:17
[2m   Duration [22m 34ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx16 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts [ tests/integration/api.workflows.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [2mno tests[22m
[2m   Start at [22m 07:06:04
[2m   Duration [22m 55ms

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx17 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1764853575501,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764853582097,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764853587587,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764853587593,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764853587605,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764853587605,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764853587605,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764853587605,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764853588284,"env":"test","module":"user-credentials-repository","userId":"cYAlqIGb5eIfbpcaQ9gEB","msg":"User credentials created"}
{"level":30,"time":1764853588288,"env":"test","module":"auth-routes","userId":"cYAlqIGb5eIfbpcaQ9gEB","email":"test-workflows-RhKH5W2cufhMFY6uh-kza@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853588860,"env":"test","module":"user-credentials-repository","userId":"MTomVCnIckjZtFwoYbJ--","msg":"User credentials created"}
{"level":30,"time":1764853588862,"env":"test","module":"auth-routes","userId":"MTomVCnIckjZtFwoYbJ--","email":"viewer-empbbfHfkAh3CVji9iKpE@example.com","msg":"User registered successfully"}
{"level":40,"time":1764853588976,"env":"test","module":"rbac-middleware","userId":"MTomVCnIckjZtFwoYbJ--","userRole":"viewer","permission":"workflow:create","path":"/projects/df1a377a-63a7-46d2-82ca-2942d40cfec7/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"df1a377a-63a7-46d2-82ca-2942d40cfec7","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"cYAlqIGb5eIfbpcaQ9gEB","tenantId":"997d5ee4-88d4-4f7a-9be0-24a8b3d13a08","createdBy":"cYAlqIGb5eIfbpcaQ9gEB","ownerId":"cYAlqIGb5eIfbpcaQ9gEB","status":"active","archived":false,"createdAt":"2025-12-04T13:06:29.376Z","updatedAt":"2025-12-04T13:06:29.376Z"}

{"level":50,"time":1764853596518,"env":"test","error":{},"workflowId":"0c8d2bee-26fb-4fed-8fbf-6bfab11c5dba","userId":"cYAlqIGb5eIfbpcaQ9gEB","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764853596982,"env":"test","module":"auth-middleware","path":"/api/workflows/a9856f7e-63db-4ff9-823b-259888a848d4/move","msg":"No valid authentication found"}
{"level":30,"time":1764853597618,"env":"test","module":"user-credentials-repository","userId":"c2_x7WI_e0kVO6igJnEoX","msg":"User credentials created"}
{"level":30,"time":1764853597620,"env":"test","module":"auth-routes","userId":"c2_x7WI_e0kVO6igJnEoX","email":"test-workflows-s74bD9ONT7M8xc1Bogq4S@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853598248,"env":"test","module":"user-credentials-repository","userId":"rAMgoltom7PYEOgbE1Lzs","msg":"User credentials created"}
{"level":30,"time":1764853598249,"env":"test","module":"auth-routes","userId":"rAMgoltom7PYEOgbE1Lzs","email":"test-workflows-Sux3gBi_tKqK9yxeaztcZ@example.com","msg":"User registered successfully"}
{"level":50,"time":1764853598309,"env":"test","error":{},"workflowId":"7ebbb3be-c484-48a2-84db-2426442d4e1e","userId":"rAMgoltom7PYEOgbE1Lzs","projectId":"7d31da00-543c-4d66-aca8-85484ce6d2d0","msg":"Error moving workflow"}
{"level":50,"time":1764853598768,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"dea4bbff-020d-4a83-906e-3ffba789584e","userId":"cYAlqIGb5eIfbpcaQ9gEB","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764853599208,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"2b1a6fc3-5451-448c-8b90-0563d0fd7b4d","userId":"cYAlqIGb5eIfbpcaQ9gEB","msg":"Error moving workflow"}
{"level":30,"time":1764853600034,"env":"test","module":"user-credentials-repository","userId":"wWqM2ijXYDw0PHl7_gO-4","msg":"User credentials created"}
{"level":30,"time":1764853600035,"env":"test","module":"auth-routes","userId":"wWqM2ijXYDw0PHl7_gO-4","email":"test-workflows-TqRrqrio-Mbx8qAQimhY2@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853600255,"env":"test","module":"auth-routes","userId":"wWqM2ijXYDw0PHl7_gO-4","email":"test-workflows-TqRrqrio-Mbx8qAQimhY2@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764853600490,"env":"test","error":{},"workflowId":"946e87e6-6558-4e97-bcb7-f84835ddedbb","userId":"cYAlqIGb5eIfbpcaQ9gEB","projectId":"a40ac281-3b38-4fa7-94b0-ec1e9b962525","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 13234[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a new draft workflow[39m[32m 4[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 498[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 935[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 886[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 769[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 924[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 717[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 877[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 639[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 440[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1283[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 3 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:projectId/workflows > should create a new draft workflow
ReferenceError: response is not defined
 Î“Â¥Â» tests/integration/api.workflows.test.ts:91:14
     89|   describe("POST /api/projects/:projectId/workflows", () => {
     90|     it("should create a new draft workflow", async () => {
     91|       expect(response.body.currentVersion).toHaveProperty("published",Î“Ã‡Âª
       |              ^
     92|     });
     93| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:324:10
    322|         .get(`/api/workflows/${workflowId}`)
    323|         .set("Authorization", `Bearer ${authToken}`)
    324|         .expect(200);
       |          ^
    325| 
    326|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/3]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:451:10
    449|         .set("Authorization", `Bearer ${authToken}`)
    450|         .send({ projectId: user2ProjectId })
    451|         .expect(403);
       |          ^
    452| 
    453|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/3]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (18)[39m
[2m   Start at [22m 07:06:10
[2m   Duration [22m 29.85s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mtests/integration/api.workflows.test.ts [22m[34mx18 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":40,"time":1764853868232,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764853871588,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764853874796,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764853874797,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764853874809,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764853874809,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764853874809,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764853874809,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764853875398,"env":"test","module":"user-credentials-repository","userId":"nL7RCyTCPOUYCI-aNcN0Y","msg":"User credentials created"}
{"level":30,"time":1764853875401,"env":"test","module":"auth-routes","userId":"nL7RCyTCPOUYCI-aNcN0Y","email":"test-workflows-8ZQcrMB0Sh7eV18gveBQk@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"4b8992de-ec20-43b1-9c96-2178e4979289","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"nL7RCyTCPOUYCI-aNcN0Y","tenantId":"66436ae9-b6bc-4d8e-9969-993bd7e24527","createdBy":"nL7RCyTCPOUYCI-aNcN0Y","ownerId":"nL7RCyTCPOUYCI-aNcN0Y","status":"active","archived":false,"createdAt":"2025-12-04T13:11:16.479Z","updatedAt":"2025-12-04T13:11:16.479Z"}

{"level":30,"time":1764853876169,"env":"test","module":"user-credentials-repository","userId":"iZcfMQQKwakdJf-q2-HJ4","msg":"User credentials created"}
{"level":30,"time":1764853876170,"env":"test","module":"auth-routes","userId":"iZcfMQQKwakdJf-q2-HJ4","email":"viewer-h3R9QB8ApaFZHnnIhJqXh@example.com","msg":"User registered successfully"}
{"level":40,"time":1764853876278,"env":"test","module":"rbac-middleware","userId":"iZcfMQQKwakdJf-q2-HJ4","userRole":"viewer","permission":"workflow:create","path":"/projects/4b8992de-ec20-43b1-9c96-2178e4979289/workflows","msg":"Permission denied"}
{"level":50,"time":1764853883615,"env":"test","error":{},"workflowId":"3176657e-ccab-429f-950c-cc3de1575676","userId":"nL7RCyTCPOUYCI-aNcN0Y","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764853884009,"env":"test","module":"auth-middleware","path":"/api/workflows/51c85a60-9fde-4238-9f62-df93eac393a6/move","msg":"No valid authentication found"}
{"level":30,"time":1764853884637,"env":"test","module":"user-credentials-repository","userId":"tzC4u4MSXLKbiaad5dC3_","msg":"User credentials created"}
{"level":30,"time":1764853884638,"env":"test","module":"auth-routes","userId":"tzC4u4MSXLKbiaad5dC3_","email":"test-workflows-YtE0O5Wc6IcULHSxLSNg_@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853885240,"env":"test","module":"user-credentials-repository","userId":"ijwHxQvtYsCjxddmtVUd4","msg":"User credentials created"}
{"level":30,"time":1764853885240,"env":"test","module":"auth-routes","userId":"ijwHxQvtYsCjxddmtVUd4","email":"test-workflows-3EfzgMOKTTUS53SWcqKiq@example.com","msg":"User registered successfully"}
{"level":50,"time":1764853885293,"env":"test","error":{},"workflowId":"6106a174-7410-4a14-974d-03d904b9a336","userId":"ijwHxQvtYsCjxddmtVUd4","projectId":"b7283a3b-067b-4c0a-88ae-ba4625c62886","msg":"Error moving workflow"}
{"level":50,"time":1764853885723,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"988f206f-5b32-4087-8b87-dd89b3f72950","userId":"nL7RCyTCPOUYCI-aNcN0Y","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764853886159,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"63797ed3-2073-4ab3-a371-062e9f29eacf","userId":"nL7RCyTCPOUYCI-aNcN0Y","msg":"Error moving workflow"}
{"level":30,"time":1764853886778,"env":"test","module":"user-credentials-repository","userId":"Aeeux4J3CiXH0oxVLebpn","msg":"User credentials created"}
{"level":30,"time":1764853886778,"env":"test","module":"auth-routes","userId":"Aeeux4J3CiXH0oxVLebpn","email":"test-workflows-pFOBOqtkxOWeXaqKy_uzj@example.com","msg":"User registered successfully"}
{"level":30,"time":1764853886995,"env":"test","module":"auth-routes","userId":"Aeeux4J3CiXH0oxVLebpn","email":"test-workflows-pFOBOqtkxOWeXaqKy_uzj@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764853887215,"env":"test","error":{},"workflowId":"50bfcdf5-0d45-4b8f-917a-0a5326b41f66","userId":"nL7RCyTCPOUYCI-aNcN0Y","projectId":"a24a5cc3-4e90-4dea-9618-bd7d76bdda1e","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 12787[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 388[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 319[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 910[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 857[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 766[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 901[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 716[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 867[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 394[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 628[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 655[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 430[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 437[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1056[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:464:10
    462|         .set("Authorization", `Bearer ${authToken}`)
    463|         .send({ projectId: user2ProjectId })
    464|         .expect(403);
       |          ^
    465| 
    466|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (18)[39m
[2m   Start at [22m 07:11:03
[2m   Duration [22m 23.58s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx19 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":40,"time":1764854523446,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764854532335,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764854538910,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764854538911,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764854538923,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764854538923,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764854538924,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764854538924,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764854539566,"env":"test","module":"user-credentials-repository","userId":"tHeVC5eWdcpoqZ4cW667-","msg":"User credentials created"}
{"level":30,"time":1764854539569,"env":"test","module":"auth-routes","userId":"tHeVC5eWdcpoqZ4cW667-","email":"test-workflows-Y5IbBcIcnONgO5a7LfU0_@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"212c5a5b-0ef5-40a1-8cf5-88c813e512d1","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"tHeVC5eWdcpoqZ4cW667-","tenantId":"7c87eefc-03ef-4a39-a528-4718385052bf","createdBy":"tHeVC5eWdcpoqZ4cW667-","ownerId":"tHeVC5eWdcpoqZ4cW667-","status":"active","archived":false,"createdAt":"2025-12-04T13:22:20.678Z","updatedAt":"2025-12-04T13:22:20.678Z"}

{"level":30,"time":1764854540435,"env":"test","module":"user-credentials-repository","userId":"QX5DdqltbGbK2a_P90kD_","msg":"User credentials created"}
{"level":30,"time":1764854540436,"env":"test","module":"auth-routes","userId":"QX5DdqltbGbK2a_P90kD_","email":"viewer-mGYYBICb-nRYJ71cQIs9d@example.com","msg":"User registered successfully"}
{"level":40,"time":1764854540564,"env":"test","module":"rbac-middleware","userId":"QX5DdqltbGbK2a_P90kD_","userRole":"viewer","permission":"workflow:create","path":"/projects/212c5a5b-0ef5-40a1-8cf5-88c813e512d1/workflows","msg":"Permission denied"}
{"level":50,"time":1764854548158,"env":"test","error":{},"workflowId":"c2d9e1e9-6948-438a-8e2c-7a1887364990","userId":"tHeVC5eWdcpoqZ4cW667-","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764854548557,"env":"test","module":"auth-middleware","path":"/api/workflows/60f0c65e-d2de-4e3f-b9a2-40990f548a8f/move","msg":"No valid authentication found"}
{"level":30,"time":1764854549177,"env":"test","module":"user-credentials-repository","userId":"Ue6hH-wUbAl-rcaP2SWai","msg":"User credentials created"}
{"level":30,"time":1764854549178,"env":"test","module":"auth-routes","userId":"Ue6hH-wUbAl-rcaP2SWai","email":"test-workflows-FxlO6LBJdFDWo47ctCQD6@example.com","msg":"User registered successfully"}
{"level":30,"time":1764854549798,"env":"test","module":"user-credentials-repository","userId":"YOjNZPsNqs5Mj18mUPtDa","msg":"User credentials created"}
{"level":30,"time":1764854549798,"env":"test","module":"auth-routes","userId":"YOjNZPsNqs5Mj18mUPtDa","email":"test-workflows-cf85Z2A1obQn1sf40pNpe@example.com","msg":"User registered successfully"}
{"level":50,"time":1764854549855,"env":"test","error":{},"workflowId":"ab51f091-1005-4102-949f-606563029fcd","userId":"YOjNZPsNqs5Mj18mUPtDa","projectId":"fe094970-9b77-4c69-888c-d2b9d7a84d54","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow request: {
  workflowId: [32m'8e16a0fd-5b0f-4a3f-a148-403da9de0b78'[39m,
  projectId: [32m'01aaaafa-1983-4f18-b895-05980680c3ff'[39m,
  body: { projectId: [32m'01aaaafa-1983-4f18-b895-05980680c3ff'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to a project
[22m[39mMove workflow result: {
  id: [32m'8e16a0fd-5b0f-4a3f-a148-403da9de0b78'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'tHeVC5eWdcpoqZ4cW667-'[39m,
  ownerId: [32m'tHeVC5eWdcpoqZ4cW667-'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'01aaaafa-1983-4f18-b895-05980680c3ff'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T13:22:27.004Z[39m,
  updatedAt: [35m2025-12-04T13:22:26.540Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'403b351a-3678-4cc2-86d0-8a182bd54fcd'[39m,
  projectId: [32m'1d829b8f-c110-4d28-aaa9-573798881a6f'[39m,
  body: { projectId: [32m'1d829b8f-c110-4d28-aaa9-573798881a6f'[39m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'403b351a-3678-4cc2-86d0-8a182bd54fcd'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'tHeVC5eWdcpoqZ4cW667-'[39m,
  ownerId: [32m'tHeVC5eWdcpoqZ4cW667-'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [32m'1d829b8f-c110-4d28-aaa9-573798881a6f'[39m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T13:22:27.747Z[39m,
  updatedAt: [35m2025-12-04T13:22:27.272Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow request: {
  workflowId: [32m'403b351a-3678-4cc2-86d0-8a182bd54fcd'[39m,
  projectId: [1mnull[22m,
  body: { projectId: [1mnull[22m }
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould move workflow to Main Folder (projectId = null)
[22m[39mMove workflow result: {
  id: [32m'403b351a-3678-4cc2-86d0-8a182bd54fcd'[39m,
  title: [32m'Move Test Workflow'[39m,
  description: [32m'Test workflow for move operations'[39m,
  creatorId: [32m'tHeVC5eWdcpoqZ4cW667-'[39m,
  ownerId: [32m'tHeVC5eWdcpoqZ4cW667-'[39m,
  modeOverride: [1mnull[22m,
  publicLink: [1mnull[22m,
  name: [1mnull[22m,
  projectId: [1mnull[22m,
  currentVersionId: [1mnull[22m,
  isPublic: [33mfalse[39m,
  slug: [1mnull[22m,
  requireLogin: [33mfalse[39m,
  intakeConfig: {},
  pinnedVersionId: [1mnull[22m,
  status: [32m'draft'[39m,
  createdAt: [35m2025-12-04T13:22:27.747Z[39m,
  updatedAt: [35m2025-12-04T13:22:27.440Z[39m
}

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to non-existent project
[22m[39mMove workflow request: {
  workflowId: [32m'c2d9e1e9-6948-438a-8e2c-7a1887364990'[39m,
  projectId: [32m'00000000-0000-0000-0000-000000000000'[39m,
  body: { projectId: [32m'00000000-0000-0000-0000-000000000000'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
Move workflow error: Error: Target project not found
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:194:15)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move of workflow user does not own
[22m[39mMove workflow request: {
  workflowId: [32m'ab51f091-1005-4102-949f-606563029fcd'[39m,
  projectId: [32m'fe094970-9b77-4c69-888c-d2b9d7a84d54'[39m,
  body: { projectId: [32m'fe094970-9b77-4c69-888c-d2b9d7a84d54'[39m }
}

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
Move workflow error: Error: Access denied - you do not own this workflow
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:51:13)
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24

{"level":50,"time":1764854581140,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(tHeVC5eWdcpoqZ4cW667-) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"tHeVC5eWdcpoqZ4cW667-","msg":"Error creating workflow"}
{"level":40,"time":1764854581199,"env":"test","module":"tenant-middleware","userId":"tHeVC5eWdcpoqZ4cW667-","path":"/","msg":"User does not have an associated tenant"}
{"level":50,"time":1764854611567,"env":"test","error":{"length":301,"name":"error","severity":"ERROR","code":"23503","detail":"Key (creator_id)=(tHeVC5eWdcpoqZ4cW667-) is not present in table \"users\".","schema":"public","table":"workflows","constraint":"workflows_creator_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"tHeVC5eWdcpoqZ4cW667-","msg":"Error creating workflow"}
{"level":40,"time":1764854611619,"env":"test","module":"tenant-middleware","userId":"tHeVC5eWdcpoqZ4cW667-","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1764854611835,"env":"test","module":"user-credentials-repository","userId":"xqHa0UdGtPKs11AUanLHs","msg":"User credentials created"}
{"level":30,"time":1764854611836,"env":"test","module":"auth-routes","userId":"xqHa0UdGtPKs11AUanLHs","email":"test-workflows-Hfekhhyzul3b-3y4QBICh@example.com","msg":"User registered successfully"}
{"level":30,"time":1764854612050,"env":"test","module":"auth-routes","userId":"xqHa0UdGtPKs11AUanLHs","email":"test-workflows-Hfekhhyzul3b-3y4QBICh@example.com","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests[2m > [22m[2mPUT /api/workflows/:id/move[2m > [22m[2mshould reject move to project user does not have access to
[22m[39mMove workflow request: {
  workflowId: [32m'undefined'[39m,
  projectId: [32m'404089ab-9c99-4212-9535-ccb775c890db'[39m,
  body: { projectId: [32m'404089ab-9c99-4212-9535-ccb775c890db'[39m }
}

{"level":50,"time":1764854612221,"env":"test","error":{"length":141,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $1 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"workflowId":"undefined","userId":"tHeVC5eWdcpoqZ4cW667-","projectId":"404089ab-9c99-4212-9535-ccb775c890db","msg":"Error moving workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Move workflow error: error: invalid input syntax for type uuid: "undefined"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at NeonPreparedQuery.execute (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/neon-serverless/session.js:76:20)
    at WorkflowRepository.findById (C:/Users/scoot/poll/VaultLogic/server/repositories/BaseRepository.ts:52:22)
    at WorkflowRepository.findByIdOrSlug (C:/Users/scoot/poll/VaultLogic/server/repositories/WorkflowRepository.ts:87:18)
    at WorkflowService.verifyOwnership (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:44:22)
    at WorkflowService.moveToProject (C:/Users/scoot/poll/VaultLogic/server/services/WorkflowService.ts:187:5)
    at C:/Users/scoot/poll/VaultLogic/server/routes/workflows.routes.ts:231:24 {
  length: 141,
  severity: 'ERROR',
  code: '22P02',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: "unnamed portal parameter $1 = '...'",
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'uuid.c',
  line: '138',
  routine: 'string_to_uuid'
}

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 103323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 400[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 411[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 566[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 933[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 905[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 769[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list workflow versions[39m[33m 946[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 748[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 894[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 553[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 397[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 678[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[33m 30390[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[33m 30956[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1020[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Error: Hook timed out in 30000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:72:3
     70|   });
     71| 
     72|   afterAll(async () => {
       |   ^
     73|     if (tenantId) {
     74|       // Clean up in reverse order of dependencies

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/6]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 5 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > GET /api/workflows/:id/versions > should list workflow versions
AssertionError: expected 0 to be greater than 0
 Î“Â¥Â» tests/integration/api.workflows.test.ts:266:42
    264| 
    265|       expect(response.body).toHaveProperty("items");
    266|       expect(response.body.items.length).toBeGreaterThan(0);
       |                                          ^
    267|       expect(response.body.items[0]).toHaveProperty("published", true);
    268|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:337:10
    335|         .get(`/api/workflows/${workflowId}`)
    336|         .set("Authorization", `Bearer ${authToken}`)
    337|         .expect(200);
       |          ^
    338| 
    339|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:400:5
    398|     });
    399| 
    400|     it("should reject move with invalid projectId format", async () =>Î“Ã‡Âª
       |     ^
    401|       const response = await request(baseURL)
    402|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/integration/api.workflows.test.ts:410:5
    408|     });
    409| 
    410|     it("should reject move without projectId in body", async () => {
       |     ^
    411|       const response = await request(baseURL)
    412|         .put(`/api/workflows/${workflowId}/move`)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/6]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:464:10
    462|         .set("Authorization", `Bearer ${authToken}`)
    463|         .send({ projectId: user2ProjectId })
    464|         .expect(403);
       |          ^
    465| 
    466|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/6]Î“Ã„Â»

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Errors Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

Vitest caught 2 unhandled errors during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move with invalid projectId format". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Unhandled Rejection Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»
TypeError: Cannot read properties of undefined (reading 'value')
 Î“Â¥Â» formatProperty node:internal/util/inspect:2279:12
 Î“Â¥Â» formatRaw node:internal/util/inspect:1176:9
 Î“Â¥Â» formatValue node:internal/util/inspect:932:10
 Î“Â¥Â» inspect node:internal/util/inspect:409:10
 Î“Â¥Â» formatWithOptionsInternal node:internal/util/inspect:2644:40
 Î“Â¥Â» formatWithOptions node:internal/util/inspect:2506:10
 Î“Â¥Â» Console.value node:internal/console/constructor:356:14
 Î“Â¥Â» Console.error node:internal/console/constructor:423:61
 Î“Â¥Â» server/routes/workflows.routes.ts:235:15
    233|       res.json(workflow);
    234|     } catch (error: any) {
    235|       console.error('Move workflow error:', error);
       |               ^
    236|       logger.error({ error, workflowId: req.params.workflowId, userId:Î“Ã‡Âª
    237| 
 Î“Â¥Â» Layer.handle [as handle_request] node_modules/express/lib/router/layer.js:95:5
 Î“Â¥Â» next node_modules/express/lib/router/route.js:149:13
 Î“Â¥Â» hybridAuth server/middleware/auth.ts:157:9
 Î“Â¥Â» processTicksAndRejections node:internal/process/task_queues:103:5

This error originated in "tests/integration/api.workflows.test.ts" test file. It doesn't mean the error was thrown inside the file itself, but while it was running.
The latest test that might've caused the error is "should reject move without projectId in body". It might mean one of the following:
- The error was thrown, while Vitest was running this test.
- If the error occurred after the test had been completed, this was the last documented test before it was thrown.
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (18)[39m
[2m     Errors [22m [1m[31m2 errors[39m[22m
[2m   Start at [22m 07:21:54
[2m   Duration [22m 124.64s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
