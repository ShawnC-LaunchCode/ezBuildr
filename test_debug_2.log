npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

> ezbuildr@1.0.0 test
> vitest run --coverage tests/unit/services/AuthService.test.ts tests/unit/server/transferOwnership.test.ts tests/integration/api.workflows.test.ts

 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

stderr | tests/unit/services/AuthService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "dbInitPromise" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:107:34
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767814524813,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould transfer user-owned project to org
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of e8ec72c1-d9ab-4029-a4ea-8b33140b6d9a (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould transfer user-owned project to org
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org e8ec72c1-d9ab-4029-a4ea-8b33140b6d9a with role member

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould transfer user-owned project to org
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of e8ec72c1-d9ab-4029-a4ea-8b33140b6d9a

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 0b50bc53-e01f-4829-97d1-ee1ad35b22d8 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org 0b50bc53-e01f-4829-97d1-ee1ad35b22d8 with role member

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 2b599e66-0a96-4118-a32b-af8caf4c7a0c (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 7db9a830-0c43-4f75-a884-1fff65520a5f (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org 7db9a830-0c43-4f75-a884-1fff65520a5f with role member

{"level":30,"time":1767814528100,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767814528103,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":40,"time":1767814528123,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used"}
{"level":40,"time":1767814528124,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1767814528126,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1767814528128,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767814528129,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767814528129,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767814528130,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of c7a73f6b-6cd2-4e33-989e-062b08e36fb7 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org c7a73f6b-6cd2-4e33-989e-062b08e36fb7 with role member

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould detach workflow from project when transferring to different owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 9a4dd8d0-31c0-4c70-87a9-7dc5ad8e1dd2 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould detach workflow from project when transferring to different owner
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org 9a4dd8d0-31c0-4c70-87a9-7dc5ad8e1dd2 with role member

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould detach workflow from project when transferring to different owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of 9a4dd8d0-31c0-4c70-87a9-7dc5ad8e1dd2

{"level":30,"time":1767814529858,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767814530106,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767814530122,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767814530112,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767814530113,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767814530116,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767814530121,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767814530121,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767814530122,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767814530122,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767814530281,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould keep workflow in project when transferring to same owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 0d6d2296-35b2-45f7-aa31-42e7612fd5db (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould keep workflow in project when transferring to same owner
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org 0d6d2296-35b2-45f7-aa31-42e7612fd5db with role member

{"level":30,"time":1767814530587,"env":"test","module":"user-credentials-repository","userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"User credentials created"}
{"level":30,"time":1767814530692,"env":"test","module":"email-queue","jobId":"514a3ca6-95a1-45c5-badc-4d7f2aa2ebb7","to":"test-f-fWAS5_u2x2G52VldrYu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767814530751,"env":"test","module":"auth-routes","userId":"PgSAOOUHlhK9vc-fkPuj5","email":"test-f-fWAS5_u2x2G52VldrYu@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould keep workflow in project when transferring to same owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of 0d6d2296-35b2-45f7-aa31-42e7612fd5db

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 7393[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should hash a password using bcrypt with 12 rounds[32m 223[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate different hashes for same password [33m 440[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle empty passwords[32m 212[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle long passwords[32m 210[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle unicode characters in password[32m 212[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return true for correct password [33m 422[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return false for incorrect password [33m 442[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should be case-sensitive [33m 431[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle empty password comparison [33m 431[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept valid email addresses[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails longer than 254 characters (RFC 5321)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails shorter than 3 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with consecutive dots[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without @ symbol[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without domain[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with spaces[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without TLD[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject null or undefined[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with local part longer than 64 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept valid strong passwords[32m 22[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject passwords shorter than 8 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject passwords longer than 128 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject weak passwords with zxcvbn score < 3[32m 5[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should provide helpful feedback for weak passwords[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject password containing user's email[32m 5[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject password containing user's name[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept strong password even with user inputs provided[32m 5[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept password with exactly 8 characters if strong enough[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept password with exactly 128 characters if strong[32m 107[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return score in result object[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create a valid JWT token for a user[32m 6[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include userId, email, tenantId, and role in token payload[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should set token expiry to 15 minutes by default[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error if JWT_SECRET is not configured[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle null tenantId and role[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify and decode a valid token[32m 2[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error for expired token [33m 1104[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for invalid token signature[39m[32m 10[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for malformed token[39m[32m 2[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for invalid token[39m[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should extract token from Bearer authorization header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return token if no Bearer prefix[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for undefined header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for empty header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle Bearer with multiple spaces[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return true for JWT-like tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for non-JWT tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for empty token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for null/undefined[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create a valid portal token for an email[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include email and portal flag in token payload[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should set token expiry to 24 hours[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify and decode a valid portal token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for non-portal token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for token without email[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for expired portal token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should generate password reset token for existing user[32m 219[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for non-existent user[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should invalidate previous reset tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return userId for valid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for invalid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for used token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should mark token as used[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should generate verification token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should have 24 hour expiry[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify email with valid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for invalid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for expired token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should delete token after successful verification[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create refresh token with 30-day expiry[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should store device metadata[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return userId for valid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for revoked token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should rotate valid token and return new one[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for unknown token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all tokens on reuse detection[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke specific token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all tokens for user[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired refresh tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired password reset tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired email verification tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup old login attempts via accountLockoutService[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should use JWT_SECRET if provided[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should warn if JWT_SECRET is less than 32 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject token with modified payload[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject token with valid structure but invalid signature[39m[32m 2[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with special characters [33m 433[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle password with only spaces[32m 214[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with newlines and tabs [33m 426[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject password with null bytes (if validation exists) [33m 424[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email with unicode domain (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email starting with dot (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email ending with dot before @ (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle email with plus addressing[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle email with subdomain[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email with invalid TLD (single char)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept email with numeric TLD[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should prevent timing attacks on token validation[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should support full user authentication lifecycle[32m 217[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support complete password reset workflow [33m 423[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should prevent reuse of password reset tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should support multiple valid refresh tokens per user[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all user tokens on security event[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle database connection failures gracefully[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle transaction failures[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error if JWT signing fails[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should hash password in reasonable time (< 500ms)[32m 226[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should compare password in reasonable time (< 500ms) [33m 417[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create JWT token in < 10ms[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify JWT token in < 10ms[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould prevent non-member from transferring org workflow
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of a3816a76-3db6-48db-9594-6117038fb6de (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould prevent non-member from transferring org workflow
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org a3816a76-3db6-48db-9594-6117038fb6de with role member

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould transfer database ownership
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of d44feca5-b769-4093-bdeb-b96f03829c49 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould transfer database ownership
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org d44feca5-b769-4093-bdeb-b96f03829c49 with role member

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould transfer database ownership
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of d44feca5-b769-4093-bdeb-b96f03829c49

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of ce417c6a-5b62-47d0-ae30-0d64726f5485 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org ce417c6a-5b62-47d0-ae30-0d64726f5485 with role member

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of ce417c6a-5b62-47d0-ae30-0d64726f5485

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of ce417c6a-5b62-47d0-ae30-0d64726f5485

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of ce417c6a-5b62-47d0-ae30-0d64726f5485

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 5e8c8a15-39a1-47aa-9aeb-bb565c39ed29 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org 5e8c8a15-39a1-47aa-9aeb-bb565c39ed29 with role member

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 is NOT member of 49695635-643e-4103-810c-9e673bbd0c09 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould only allow transfer to self when targetOwnerType is user
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of bc2a49ef-f999-4264-aab4-67511fb87a88 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould only allow transfer to self when targetOwnerType is user
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org bc2a49ef-f999-4264-aab4-67511fb87a88 with role member

{"level":50,"time":1767814536562,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"Error creating workflow"}
{"level":50,"time":1767814536763,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"Error creating workflow"}
{"level":50,"time":1767814536958,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"Error creating workflow"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould allow transfer from user to self (org member transferring org asset to themselves)
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 7e46584f-9666-4723-bd0f-68fde2514a93 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould allow transfer from user to self (org member transferring org asset to themselves)
[22m[39m[OrganizationService] Adding member 00000000-0000-0000-0000-000000000032 to org 7e46584f-9666-4723-bd0f-68fde2514a93 with role member

{"level":50,"time":1767814537165,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"Error creating workflow"}
{"level":50,"time":1767814537375,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"Error creating workflow"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/server/transferOwnership.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 13693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer user-owned project to org [33m 1637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1171[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow org member to transfer org-owned project to another org they belong to[39m[33m 1134[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should detach workflow from project when transferring to different owner [33m 1339[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should keep workflow in project when transferring to same owner[39m[33m 1340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent non-member from transferring org workflow [33m 1288[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer database ownership [33m 972[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org database [33m 1080[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1251[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should only allow transfer to self when targetOwnerType is user [33m 880[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow transfer from user to self (org member transferring org asset to themselves)[39m[33m 800[2mms[22m[39m
{"level":50,"time":1767814537579,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"Error creating workflow"}
{"level":50,"time":1767814537784,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"Error creating workflow"}
{"level":50,"time":1767814537985,"env":"test","error":{"length":153,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $7 = '...'","file":"uuid.c","line":"138","routine":"string_to_uuid"},"userId":"PgSAOOUHlhK9vc-fkPuj5","msg":"Error creating workflow"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:29:5 {
  length: 361,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(PgSAOOUHlhK9vc-fkPuj5) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m9 failed[39m[2m)[22m[33m 8724[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 369[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject without permission[39m[32m 9[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 515[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 538[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 879[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 679[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 847[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 892[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to a project[39m[32m 206[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[32m 201[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to non-existent project[39m[32m 195[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without authentication[39m[32m 207[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move of workflow user does not own[39m[32m 209[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move with invalid projectId format[39m[32m 204[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move without projectId in body[39m[32m 206[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[32m 201[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 16 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > POST /api/projects/:ctx.projectId/workflows > should reject without permission
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:56:10
     54|         .post("/api/auth/register")
     55|         .send({ email: viewerEmail, password: "TestPassword123" })
     56|         .expect(201);
       |          ^
     57| 
     58|       await db.update(schema.users)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/16]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to a project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to non-existent project
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without authentication
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move of workflow user does not own
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move with invalid projectId format
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move without projectId in body
 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Failed to create workflow: 500
 Î“Â¥Â» tests/integration/api.workflows.test.ts:229:15
    227| 
    228|       if (workflowResponse.status !== 201) {
    229|         throw new Error(`Failed to create workflow: ${workflowResponseÎ“Ã‡Âª
       |               ^
    230|       }
    231|       workflowId = workflowResponse.body.id;

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/16]Î“Ã„Â»

 FAIL  tests/unit/server/transferOwnership.test.ts > Transfer Ownership > Project Transfer > should allow org member to transfer org-owned project to another org they belong to
Error: Access denied - you do not have permission to access this project
 Î“Â¥Â» ProjectService.verifyOwnership server/services/ProjectService.ts:50:11
     48|     }
     49| 
     50|     throw new Error("Access denied - you do not have permission to accÎ“Ã‡Âª
       |           ^
     51|   }
     52| 
 Î“Â¥Â» ProjectService.transferOwnership server/services/ProjectService.ts:274:21
 Î“Â¥Â» tests/unit/server/transferOwnership.test.ts:157:27

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/16]Î“Ã„Â»

 FAIL  tests/unit/server/transferOwnership.test.ts > Transfer Ownership > Workflow Transfer > should keep workflow in project when transferring to same owner
AssertionError: expected null to be 'a94e7e26-ad99-4398-a156-6cfad29a8b4d' // Object.is equality

- Expected: 
"a94e7e26-ad99-4398-a156-6cfad29a8b4d"

+ Received: 
null

 Î“Â¥Â» tests/unit/server/transferOwnership.test.ts:227:37
    225|       expect(transferred.ownerType).toBe('org');
    226|       expect(transferred.ownerUuid).toBe(testOrgId);
    227|       expect(transferred.projectId).toBe(testProjectId); // Still in pÎ“Ã‡Âª
       |                                     ^
    228|     });
    229| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/16]Î“Ã„Â»

 FAIL  tests/unit/server/transferOwnership.test.ts > Transfer Ownership > Transfer Validation > should allow transfer from user to self (org member transferring org asset to themselves)
Error: Access denied - you do not have permission to access this project
 Î“Â¥Â» ProjectService.verifyOwnership server/services/ProjectService.ts:50:11
     48|     }
     49| 
     50|     throw new Error("Access denied - you do not have permission to accÎ“Ã‡Âª
       |           ^
     51|   }
     52| 
 Î“Â¥Â» ProjectService.transferOwnership server/services/ProjectService.ts:274:21
 Î“Â¥Â» tests/unit/server/transferOwnership.test.ts:359:27

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/16]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for invalid token signature
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:507:62
    506| 
    507|         try {
    508|           authService.verifyToken(tamperedToken);
       |                                     ^
    509|           console.error("DEBUG: verifyToken DID NOT THROW");
    510|         } catch (e: any) {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/16]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for malformed token
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:511:68
    509|           console.error("DEBUG: verifyToken DID NOT THROW");
    510|         } catch (e: any) {
    511|           console.log("DEBUG: verifyToken threw:", e.message, e.constrÎ“Ã‡Âª
       |                                                                    ^
    512|         }
    513| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/16]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for invalid token
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:516:64
    515|       });
    516| 
    517|       it("should throw error for malformed token", () => {
       |                                                              ^
    518|         expect(() => authService.verifyToken("not.a.valid.token")).toTÎ“Ã‡Âª
    519|       });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/16]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > Security Edge Cases > Token Manipulation > should reject token with valid structure but invalid signature
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:1058:58
    1056|         const tamperedToken = `${parts[0]}.${modifiedPayload}.${parts[Î“Ã‡Âª
    1057| 
    1058|         expect(() => authService.verifyToken(tamperedToken)).toThrow();
       |                                                          ^
    1059|       });
    1060| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/16]Î“Ã„Â»


[2m Test Files [22m [1m[31m3 failed[39m[22m[90m (3)[39m
[2m      Tests [22m [1m[31m16 failed[39m[22m[2m | [22m[1m[32m125 passed[39m[22m[90m (141)[39m
[2m   Start at [22m 13:35:21
[2m   Duration [22m 23.65s[2m (transform 3.65s, setup 605ms, import 8.99s, tests 29.81s, environment 0ms)[22m

