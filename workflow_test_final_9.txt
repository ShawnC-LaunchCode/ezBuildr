npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

[1m[44m DEV [49m[22m [34mv4.0.5 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764867335337,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867337615,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867339526,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867339527,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867339537,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867339537,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867339537,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867339537,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867339961,"env":"test","module":"user-credentials-repository","userId":"n_AhWwakMfbp-KVz0Cq1Y","msg":"User credentials created"}
{"level":30,"time":1764867339964,"env":"test","module":"auth-routes","userId":"n_AhWwakMfbp-KVz0Cq1Y","email":"test-workflows-WtB_7ddzJD0sc12cnO2-B@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"793c6e72-5e5e-42de-95fb-9cdff60093af","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"n_AhWwakMfbp-KVz0Cq1Y","tenantId":"16e36e7c-0835-43de-81fb-8e21f96e59b1","createdBy":"n_AhWwakMfbp-KVz0Cq1Y","ownerId":"n_AhWwakMfbp-KVz0Cq1Y","status":"active","archived":false,"createdAt":"2025-12-04T16:55:41.456Z","updatedAt":"2025-12-04T16:55:41.456Z"}

{"level":30,"time":1764867340621,"env":"test","module":"user-credentials-repository","userId":"v-_MnQ6QsHeM285XBJX-J","msg":"User credentials created"}
{"level":30,"time":1764867340622,"env":"test","module":"auth-routes","userId":"v-_MnQ6QsHeM285XBJX-J","email":"viewer-Df4NuzammQgEpVb-icX_n@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867340721,"env":"test","module":"rbac-middleware","userId":"v-_MnQ6QsHeM285XBJX-J","userRole":"viewer","permission":"workflow:create","path":"/projects/793c6e72-5e5e-42de-95fb-9cdff60093af/workflows","msg":"Permission denied"}
{"level":50,"time":1764867347063,"env":"test","error":{},"workflowId":"acf07223-67c1-47bf-812d-72781be91a7e","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867347416,"env":"test","module":"auth-middleware","path":"/api/workflows/65135e4e-1240-4311-842a-90bf016ce005/move","msg":"No valid authentication found"}
{"level":30,"time":1764867347951,"env":"test","module":"user-credentials-repository","userId":"QUM5xO4JwoHg7kOvjlCDL","msg":"User credentials created"}
{"level":30,"time":1764867347952,"env":"test","module":"auth-routes","userId":"QUM5xO4JwoHg7kOvjlCDL","email":"test-workflows-YCaHp-0LU5Jkspa1Z8F-4@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867348000,"env":"test","error":{},"workflowId":"855f8e93-ab65-4f19-a0b5-01ced33f0740","userId":"QUM5xO4JwoHg7kOvjlCDL","projectId":"5c900065-f606-4aef-b9aa-9077c8f086bb","msg":"Error moving workflow"}
{"level":50,"time":1764867348464,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"786c3a6c-d847-4936-9b0c-ae94a96b1499","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867349306,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ca9e2f3a-a709-4551-bd32-231ba677e272","userId":"n_AhWwakMfbp-KVz0Cq1Y","msg":"Error moving workflow"}
{"level":30,"time":1764867350593,"env":"test","module":"user-credentials-repository","userId":"MM09cPm_Xr38hoSKIGDki","msg":"User credentials created"}
{"level":30,"time":1764867350595,"env":"test","module":"auth-routes","userId":"MM09cPm_Xr38hoSKIGDki","email":"test-workflows-WPOdtjHkWT6Dek16grhG0@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867351001,"env":"test","module":"auth-routes","userId":"MM09cPm_Xr38hoSKIGDki","email":"test-workflows-WPOdtjHkWT6Dek16grhG0@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867351496,"env":"test","error":{},"workflowId":"5b399ea0-9ba1-4b90-970d-0c8826c01014","userId":"n_AhWwakMfbp-KVz0Cq1Y","projectId":"cd5926cb-e97e-43f4-a04a-4efb70e7e228","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 12735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 298[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 443[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 457[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 632[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 747[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 640[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 613[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 777[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 463[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 352[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 839[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 2190[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:55:31
[2m   Duration [22m 20.40s[2m (transform 3.12s, setup 884ms, collect 6.08s, tests 12.74s, environment 0ms, prepare 15ms)[22m

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx1 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":40,"time":1764867556285,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867558412,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867560698,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867560699,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867560711,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867560711,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867560712,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867560712,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867561152,"env":"test","module":"user-credentials-repository","userId":"iTiLInqGGfrXAqfIMo4xk","msg":"User credentials created"}
{"level":30,"time":1764867561155,"env":"test","module":"auth-routes","userId":"iTiLInqGGfrXAqfIMo4xk","email":"test-workflows-lbxA80i89IKeGBv-PdNb1@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"f48f17f0-fb3b-4f32-a483-58c76765c2ab","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"iTiLInqGGfrXAqfIMo4xk","tenantId":"776b7510-5b57-461e-a5d2-fbf059e42ac6","createdBy":"iTiLInqGGfrXAqfIMo4xk","ownerId":"iTiLInqGGfrXAqfIMo4xk","status":"active","archived":false,"createdAt":"2025-12-04T16:59:22.662Z","updatedAt":"2025-12-04T16:59:22.662Z"}

{"level":30,"time":1764867561806,"env":"test","module":"user-credentials-repository","userId":"ISLTrWmnD1JCDCMbDsAbl","msg":"User credentials created"}
{"level":30,"time":1764867561807,"env":"test","module":"auth-routes","userId":"ISLTrWmnD1JCDCMbDsAbl","email":"viewer-XYiSPkR5fP5YBMsS4PC64@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867561898,"env":"test","module":"rbac-middleware","userId":"ISLTrWmnD1JCDCMbDsAbl","userRole":"viewer","permission":"workflow:create","path":"/projects/f48f17f0-fb3b-4f32-a483-58c76765c2ab/workflows","msg":"Permission denied"}
{"level":50,"time":1764867567807,"env":"test","error":{},"workflowId":"47e72e9e-6016-4156-a242-8071e6a71383","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867568102,"env":"test","module":"auth-middleware","path":"/api/workflows/d62a112f-44e3-4f6f-a7e9-2ce4ea49adc4/move","msg":"No valid authentication found"}
{"level":30,"time":1764867568597,"env":"test","module":"user-credentials-repository","userId":"uGQx6UdQViumga6Fryg2B","msg":"User credentials created"}
{"level":30,"time":1764867568597,"env":"test","module":"auth-routes","userId":"uGQx6UdQViumga6Fryg2B","email":"test-workflows-f347j_tkOneKi8rrNuwgO@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867568647,"env":"test","error":{},"workflowId":"3f53f430-6ad9-4bb5-822d-f8a08344d13e","userId":"uGQx6UdQViumga6Fryg2B","projectId":"c0db19be-6d1d-4d82-ad33-1519b59f0b80","msg":"Error moving workflow"}
{"level":50,"time":1764867568997,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9fbd8015-4b5f-4acb-9057-08d232b675bb","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867569345,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"de1e67b3-1cb9-4fbb-a86c-11e5e2fba4c2","userId":"iTiLInqGGfrXAqfIMo4xk","msg":"Error moving workflow"}
{"level":30,"time":1764867569851,"env":"test","module":"user-credentials-repository","userId":"cbeJWs0ieClHkQLeIlT1X","msg":"User credentials created"}
{"level":30,"time":1764867569851,"env":"test","module":"auth-routes","userId":"cbeJWs0ieClHkQLeIlT1X","email":"test-workflows-h48jGqF17ko7w8P0hpszZ@example.com","msg":"User registered successfully"}
{"level":30,"time":1764867570084,"env":"test","module":"auth-routes","userId":"cbeJWs0ieClHkQLeIlT1X","email":"test-workflows-h48jGqF17ko7w8P0hpszZ@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764867570264,"env":"test","error":{},"workflowId":"c67bcfa3-5adc-4ec7-8c08-d914f467248a","userId":"iTiLInqGGfrXAqfIMo4xk","projectId":"314d4857-53af-4b9f-9e6e-d4ee035156cf","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 307[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 289[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 734[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 565[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 722[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 578[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 446[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 292[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 546[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 350[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 920[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 10:59:13
[2m   Duration [22m 16.76s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx2 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764867689302,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764867691012,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764867692749,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764867692750,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764867692757,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764867692757,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764867692757,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764867692757,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764867693206,"env":"test","module":"user-credentials-repository","userId":"__yJkzj4roX023YEvXyba","msg":"User credentials created"}
{"level":30,"time":1764867693208,"env":"test","module":"auth-routes","userId":"__yJkzj4roX023YEvXyba","email":"test-workflows-gqCHDX5dhYiUf4c-WFSmx@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"3d6b8f74-e48c-4c67-905a-57dd7eca1c6c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"__yJkzj4roX023YEvXyba","tenantId":"fcbd0d97-42e2-450a-a393-bad963b26e24","createdBy":"__yJkzj4roX023YEvXyba","ownerId":"__yJkzj4roX023YEvXyba","status":"active","archived":false,"createdAt":"2025-12-04T17:01:34.711Z","updatedAt":"2025-12-04T17:01:34.711Z"}

{"level":30,"time":1764867693857,"env":"test","module":"user-credentials-repository","userId":"3jJKdvAlgHW8t4lSOCQlz","msg":"User credentials created"}
{"level":30,"time":1764867693857,"env":"test","module":"auth-routes","userId":"3jJKdvAlgHW8t4lSOCQlz","email":"viewer-n_CaeqzVjISuSqScccRS7@example.com","msg":"User registered successfully"}
{"level":40,"time":1764867693947,"env":"test","module":"rbac-middleware","userId":"3jJKdvAlgHW8t4lSOCQlz","userRole":"viewer","permission":"workflow:create","path":"/projects/3d6b8f74-e48c-4c67-905a-57dd7eca1c6c/workflows","msg":"Permission denied"}
{"level":50,"time":1764867700015,"env":"test","error":{},"workflowId":"796a3733-a5c8-4758-b324-ba0cdfac2111","userId":"__yJkzj4roX023YEvXyba","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764867700313,"env":"test","module":"auth-middleware","path":"/api/workflows/3bd66a17-0cbb-46ad-9f62-c520f9dd6b27/move","msg":"No valid authentication found"}
{"level":30,"time":1764867700856,"env":"test","module":"user-credentials-repository","userId":"c98tnl2B0WVEWGXKAuhvq","msg":"User credentials created"}
{"level":30,"time":1764867700857,"env":"test","module":"auth-routes","userId":"c98tnl2B0WVEWGXKAuhvq","email":"test-workflows-9y5FWDPZi9MXG3eKfH7yv@example.com","msg":"User registered successfully"}
{"level":50,"time":1764867700913,"env":"test","error":{},"workflowId":"1d9a5536-4c90-432a-b18b-36c89f6deaf6","userId":"c98tnl2B0WVEWGXKAuhvq","projectId":"f8d0a6df-fd0a-441e-8889-c5dbf0420bf7","msg":"Error moving workflow"}
{"level":50,"time":1764867701282,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"9bf1daa2-d38b-4d79-998c-fc658206a38c","userId":"__yJkzj4roX023YEvXyba","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764867701625,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"1e8ca94e-69ed-4347-8fe7-b97099cfae27","userId":"__yJkzj4roX023YEvXyba","msg":"Error moving workflow"}
{"level":50,"time":1764867702124,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rLqtL2ahz_cKEoUVtnGgx) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"rLqtL2ahz_cKEoUVtnGgx","msg":"Failed to create user credentials"}
{"level":50,"time":1764867702124,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(rLqtL2ahz_cKEoUVtnGgx) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 9757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 317[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 280[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 453[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 606[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 705[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 448[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject move without authentication[32m 297[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 343[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 500[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:01:26
[2m   Duration [22m 15.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx3 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1764868031607,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868033407,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868035482,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868035482,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868035493,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868035493,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868035494,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868035494,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868036998,"env":"test","module":"user-credentials-repository","userId":"HXXqgbtHrvCim1zxI9297","msg":"User credentials created"}
{"level":30,"time":1764868037003,"env":"test","module":"auth-routes","userId":"HXXqgbtHrvCim1zxI9297","email":"test-workflows-HmbKd0XiQimXlvgxr_PTh@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"e795daa9-8409-4b4a-ac2f-8f95d9bcb45c","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"HXXqgbtHrvCim1zxI9297","tenantId":"1d7c8fa4-769a-433c-b8be-7e1ab31ee482","createdBy":"HXXqgbtHrvCim1zxI9297","ownerId":"HXXqgbtHrvCim1zxI9297","status":"active","archived":false,"createdAt":"2025-12-04T17:07:18.521Z","updatedAt":"2025-12-04T17:07:18.521Z"}

{"level":30,"time":1764868037656,"env":"test","module":"user-credentials-repository","userId":"FsBOBNzo8LX7tv62ToEpn","msg":"User credentials created"}
{"level":30,"time":1764868037657,"env":"test","module":"auth-routes","userId":"FsBOBNzo8LX7tv62ToEpn","email":"viewer-M0UzMZu9qsJ7S7HMFwCZ9@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868037748,"env":"test","module":"rbac-middleware","userId":"FsBOBNzo8LX7tv62ToEpn","userRole":"viewer","permission":"workflow:create","path":"/projects/e795daa9-8409-4b4a-ac2f-8f95d9bcb45c/workflows","msg":"Permission denied"}
{"level":50,"time":1764868043970,"env":"test","error":{},"workflowId":"85be08fd-0645-4e33-87d2-4bf1ea87b3ac","userId":"HXXqgbtHrvCim1zxI9297","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868044304,"env":"test","module":"auth-middleware","path":"/api/workflows/27214331-8641-4f30-ae80-fed53406643b/move","msg":"No valid authentication found"}
{"level":30,"time":1764868044801,"env":"test","module":"user-credentials-repository","userId":"7baCjN4fg76jWPKOht1Ra","msg":"User credentials created"}
{"level":30,"time":1764868044802,"env":"test","module":"auth-routes","userId":"7baCjN4fg76jWPKOht1Ra","email":"test-workflows-4VU0ZcQDhH-rxxaa3ny5Z@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868044852,"env":"test","error":{},"workflowId":"688a2c9d-47d9-402d-85c9-1172ce9bc7c1","userId":"7baCjN4fg76jWPKOht1Ra","projectId":"6b553486-d9ec-4a29-b9c9-0900385ad6d6","msg":"Error moving workflow"}
{"level":50,"time":1764868045222,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"7721c327-c21c-4165-b2ce-eea6bb21bcde","userId":"HXXqgbtHrvCim1zxI9297","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868045595,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e0eacc40-b7b2-41ac-be0f-1bd14929ab0b","userId":"HXXqgbtHrvCim1zxI9297","msg":"Error moving workflow"}
{"level":30,"time":1764868046119,"env":"test","module":"user-credentials-repository","userId":"dNZjjty9VrCz2hd35d7IG","msg":"User credentials created"}
{"level":30,"time":1764868046120,"env":"test","module":"auth-routes","userId":"dNZjjty9VrCz2hd35d7IG","email":"test-workflows-AzjzGBv-SlhAzdFkNhiL4@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868046328,"env":"test","module":"auth-routes","userId":"dNZjjty9VrCz2hd35d7IG","email":"test-workflows-AzjzGBv-SlhAzdFkNhiL4@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868046510,"env":"test","error":{},"workflowId":"f2cb878d-d5c4-437b-8ad8-6f2773a2db20","userId":"HXXqgbtHrvCim1zxI9297","projectId":"02446088-c604-440d-8c50-aefd18b2ca2f","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 11327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 321[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 274[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 442[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 471[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 786[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 716[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 603[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 478[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 373[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 917[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:07:08
[2m   Duration [22m 17.69s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/routes/workflows.routes.ts [22m[34mx4 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868270640,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868272374,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868274194,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868274195,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868274206,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868274206,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868274206,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868274206,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868274660,"env":"test","module":"user-credentials-repository","userId":"SesN3IwvAkozAM6VH0yKv","msg":"User credentials created"}
{"level":30,"time":1764868274663,"env":"test","module":"auth-routes","userId":"SesN3IwvAkozAM6VH0yKv","email":"test-workflows-H47U3-CsPBZDNdc7LmXVT@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"7b394b4f-afbf-4c96-9364-68bdb7493a20","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"SesN3IwvAkozAM6VH0yKv","tenantId":"20cf9008-738d-4ad9-bbcb-141dba657891","createdBy":"SesN3IwvAkozAM6VH0yKv","ownerId":"SesN3IwvAkozAM6VH0yKv","status":"active","archived":false,"createdAt":"2025-12-04T17:11:16.168Z","updatedAt":"2025-12-04T17:11:16.168Z"}

{"level":30,"time":1764868275329,"env":"test","module":"user-credentials-repository","userId":"Wshr5S4brBDP2sNmPCz91","msg":"User credentials created"}
{"level":30,"time":1764868275331,"env":"test","module":"auth-routes","userId":"Wshr5S4brBDP2sNmPCz91","email":"viewer-BTKHO65mm4VOjiNwfYZyc@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868275427,"env":"test","module":"rbac-middleware","userId":"Wshr5S4brBDP2sNmPCz91","userRole":"viewer","permission":"workflow:create","path":"/projects/7b394b4f-afbf-4c96-9364-68bdb7493a20/workflows","msg":"Permission denied"}
{"level":50,"time":1764868281786,"env":"test","error":{},"workflowId":"a8abc182-2342-42f5-860d-3a9893e7a25e","userId":"SesN3IwvAkozAM6VH0yKv","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868282119,"env":"test","module":"auth-middleware","path":"/api/workflows/7fd02a52-a879-4423-bf1a-8c6e4af23c9d/move","msg":"No valid authentication found"}
{"level":30,"time":1764868282644,"env":"test","module":"user-credentials-repository","userId":"loipOzSaTAzK4rj3rcq1E","msg":"User credentials created"}
{"level":30,"time":1764868282644,"env":"test","module":"auth-routes","userId":"loipOzSaTAzK4rj3rcq1E","email":"test-workflows-JzQxnuGB8l4oWNBZrdrXC@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868282695,"env":"test","error":{},"workflowId":"03750cb7-043e-4f80-ba9e-5efedacd913d","userId":"loipOzSaTAzK4rj3rcq1E","projectId":"4123b93d-2e8d-4020-a4cd-ff92a3c973e1","msg":"Error moving workflow"}
{"level":50,"time":1764868283065,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"b049a974-d67b-4717-bb11-044a8573e678","userId":"SesN3IwvAkozAM6VH0yKv","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868283442,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"b77a068d-c44d-40eb-a4a1-a6d9734282c3","userId":"SesN3IwvAkozAM6VH0yKv","msg":"Error moving workflow"}
{"level":50,"time":1764868283969,"env":"test","module":"user-credentials-repository","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(tAA3Q40BHsxFFZqA_Mtk5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"userId":"tAA3Q40BHsxFFZqA_Mtk5","msg":"Failed to create user credentials"}
{"level":50,"time":1764868283969,"env":"test","module":"auth-routes","error":{"length":320,"name":"error","severity":"ERROR","code":"23503","detail":"Key (user_id)=(tAA3Q40BHsxFFZqA_Mtk5) is not present in table \"users\".","schema":"public","table":"user_credentials","constraint":"user_credentials_user_id_users_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Registration failed"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 10164[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 335[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject without permission[32m 290[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 772[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 740[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 827[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 613[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should move workflow to Main Folder (projectId = null)[39m[33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 461[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 576[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 370[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 529[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should move workflow to Main Folder (projectId = null)
Error: expected 200 "OK", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:341:10
    339|         .get(`/api/workflows/${workflowId}`)
    340|         .set("Authorization", `Bearer ${authToken}`)
    341|         .expect(200);
       |          ^
    342| 
    343|       expect(verifyResponse.body.projectId).toBeNull();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m15 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:11:07
[2m   Duration [22m 16.01s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/2]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/api.workflows.test.ts:426:51
    424| 
    425|       const authToken2 = registerResponse2.body.token;
    426|       const user2Id = registerResponse2.body.user.id;
       |                                                   ^
    427| 
    428|       await db.update(schema.users)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/2]Î“Ã„Â»

c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx5 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1764868528894,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868531043,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868533336,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868533336,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868533354,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868533354,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868533355,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868533355,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868533814,"env":"test","module":"user-credentials-repository","userId":"G8hJILui9Jhp7kK9CMsaK","msg":"User credentials created"}
{"level":30,"time":1764868533816,"env":"test","module":"auth-routes","userId":"G8hJILui9Jhp7kK9CMsaK","email":"test-workflows-8kq2iyCstk0MGPczLBLwK@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"9090abbf-debc-4309-b224-f63056b0d63a","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"G8hJILui9Jhp7kK9CMsaK","tenantId":"d1c0e36a-c45b-4235-b96d-c72a560d3c75","createdBy":"G8hJILui9Jhp7kK9CMsaK","ownerId":"G8hJILui9Jhp7kK9CMsaK","status":"active","archived":false,"createdAt":"2025-12-04T17:15:35.336Z","updatedAt":"2025-12-04T17:15:35.336Z"}

{"level":30,"time":1764868534500,"env":"test","module":"user-credentials-repository","userId":"aVTYicKhTy9fGBUrxfrG4","msg":"User credentials created"}
{"level":30,"time":1764868534501,"env":"test","module":"auth-routes","userId":"aVTYicKhTy9fGBUrxfrG4","email":"viewer-sNwAGo-510dHtOe0D0bIJ@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868534591,"env":"test","module":"rbac-middleware","userId":"aVTYicKhTy9fGBUrxfrG4","userRole":"viewer","permission":"workflow:create","path":"/projects/9090abbf-debc-4309-b224-f63056b0d63a/workflows","msg":"Permission denied"}
{"level":50,"time":1764868540848,"env":"test","error":{},"workflowId":"4dd23760-17a8-4520-ac42-0747ba64770c","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868541162,"env":"test","module":"auth-middleware","path":"/api/workflows/2bc537db-f930-454f-b2f6-4188b3987d72/move","msg":"No valid authentication found"}
{"level":30,"time":1764868541668,"env":"test","module":"user-credentials-repository","userId":"8-kdqVN-Gq_nQHXfW4oLm","msg":"User credentials created"}
{"level":30,"time":1764868541668,"env":"test","module":"auth-routes","userId":"8-kdqVN-Gq_nQHXfW4oLm","email":"test-workflows-9nSXEJWr2EPGpKPcDfox1@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868541712,"env":"test","error":{},"workflowId":"fb0000bc-384a-44d6-825b-356804c39192","userId":"8-kdqVN-Gq_nQHXfW4oLm","projectId":"27d83555-5ed4-40ce-a5c5-b69a25a5f552","msg":"Error moving workflow"}
{"level":50,"time":1764868542083,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3746b720-af9e-4db7-bfe2-911e8a6818e9","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868542550,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"e18d5176-fff2-4043-a836-850521c57284","userId":"G8hJILui9Jhp7kK9CMsaK","msg":"Error moving workflow"}
{"level":30,"time":1764868543279,"env":"test","module":"user-credentials-repository","userId":"Vu5GO0hXAWNC4Mc9oZeln","msg":"User credentials created"}
{"level":30,"time":1764868543280,"env":"test","module":"auth-routes","userId":"Vu5GO0hXAWNC4Mc9oZeln","email":"test-workflows-L3TTwPQGBkWYsid3ZukFI@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868543487,"env":"test","module":"auth-routes","userId":"Vu5GO0hXAWNC4Mc9oZeln","email":"test-workflows-L3TTwPQGBkWYsid3ZukFI@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868543685,"env":"test","error":{},"workflowId":"66ba193a-781d-4b5f-aece-601426a717e0","userId":"G8hJILui9Jhp7kK9CMsaK","projectId":"165c9c34-542b-40e7-b8fd-0c6e6a9f64c6","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 304[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 460[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 636[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 601[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 313[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 550[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 371[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 467[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1137[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:15:25
[2m   Duration [22m 17.91s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
c[3J[1m[44m RERUN [49m[22m [34m[2mserver/api/workflows.ts [22m[34mx6 [34m[39m
       [2m Filename pattern: [22m[34mtests/integration/api.workflows.test.ts[39m

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (11) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":40,"time":1764868816231,"env":"test","module":"auth-service","msg":"JWT_SECRET not set - falling back to SESSION_SECRET. This is acceptable for development but should be fixed for production."}
{"level":30,"time":1764868818422,"env":"test","multerImportKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceKeys":["diskStorage","memoryStorage","MulterError"],"multerInstanceType":"function","uploadKeys":["storage","limits","preservePath","fileFilter"],"uploadType":"object","uploadPrototype":{},"msg":"Debug Multer Import"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1764868820549,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1764868820550,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1764868820591,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1764868820591,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1764868820592,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1764868820592,"env":"test","module":"routes","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1764868821064,"env":"test","module":"user-credentials-repository","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"User credentials created"}
{"level":30,"time":1764868821067,"env":"test","module":"auth-routes","userId":"BK_BYPqXIDyTgbjkilWlk","email":"test-workflows-M8NiEXD9DYC6t-eh3-Hzt@example.com","msg":"User registered successfully"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39mProject creation response: [33m201[39m {"id":"67c6eb7e-5408-4b05-a3c4-a03b4b4f0214","title":"Test Project for Workflows","name":"Test Project for Workflows","description":null,"creatorId":"BK_BYPqXIDyTgbjkilWlk","tenantId":"95c8a6d5-0ef6-4880-986a-bdb1ffcfee58","createdBy":"BK_BYPqXIDyTgbjkilWlk","ownerId":"BK_BYPqXIDyTgbjkilWlk","status":"active","archived":false,"createdAt":"2025-12-04T17:20:22.598Z","updatedAt":"2025-12-04T17:20:22.598Z"}

{"level":30,"time":1764868821781,"env":"test","module":"user-credentials-repository","userId":"ZRqX7i7500lrOTuRTrKBQ","msg":"User credentials created"}
{"level":30,"time":1764868821782,"env":"test","module":"auth-routes","userId":"ZRqX7i7500lrOTuRTrKBQ","email":"viewer-iiuS7Oguh_1idAKsie8GA@example.com","msg":"User registered successfully"}
{"level":40,"time":1764868821882,"env":"test","module":"rbac-middleware","userId":"ZRqX7i7500lrOTuRTrKBQ","userRole":"viewer","permission":"workflow:create","path":"/projects/67c6eb7e-5408-4b05-a3c4-a03b4b4f0214/workflows","msg":"Permission denied"}
{"level":50,"time":1764868828301,"env":"test","error":{},"workflowId":"78796961-4d6a-4330-862f-e0823f0e90e5","userId":"BK_BYPqXIDyTgbjkilWlk","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":40,"time":1764868828633,"env":"test","module":"auth-middleware","path":"/api/workflows/ff65731f-afed-43bf-b622-34892c1df313/move","msg":"No valid authentication found"}
{"level":30,"time":1764868829178,"env":"test","module":"user-credentials-repository","userId":"U7zKEol77EhjG8Z5kksyk","msg":"User credentials created"}
{"level":30,"time":1764868829179,"env":"test","module":"auth-routes","userId":"U7zKEol77EhjG8Z5kksyk","email":"test-workflows-3yn_0CyeVZgOsJsHDjZhA@example.com","msg":"User registered successfully"}
{"level":50,"time":1764868829227,"env":"test","error":{},"workflowId":"afde417f-15d6-40c6-bcdf-98e410a6be30","userId":"U7zKEol77EhjG8Z5kksyk","projectId":"b954a6af-2b5b-41f0-965c-1c606cb68adc","msg":"Error moving workflow"}
{"level":50,"time":1764868829603,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1397538a-28c4-49f1-b65c-ce324566c752","userId":"BK_BYPqXIDyTgbjkilWlk","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":50,"time":1764868830043,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"a58aeab4-1f47-4c5a-acfd-959502d730c9","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"Error moving workflow"}
{"level":30,"time":1764868830643,"env":"test","module":"user-credentials-repository","userId":"1FGGsjCw8SjFULk0WazKO","msg":"User credentials created"}
{"level":30,"time":1764868830644,"env":"test","module":"auth-routes","userId":"1FGGsjCw8SjFULk0WazKO","email":"test-workflows-cSN4sUAgeFr3z_y0adTRk@example.com","msg":"User registered successfully"}
{"level":30,"time":1764868830845,"env":"test","module":"auth-routes","userId":"1FGGsjCw8SjFULk0WazKO","email":"test-workflows-cSN4sUAgeFr3z_y0adTRk@example.com","msg":"User logged in successfully"}
{"level":50,"time":1764868831093,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"4636e286-9204-422d-b090-e13e14b2df61","userId":"BK_BYPqXIDyTgbjkilWlk","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 10792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 339[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 494[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 818[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 652[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 753[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 770[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 332[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 594[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 440[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1051[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 1 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: expected 403 "Forbidden", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.workflows.test.ts:457:10
    455|         .set("Authorization", `Bearer ${authToken}`)
    456|         .send({ projectId: user2ProjectId })
    457|         .expect(403);
       |          ^
    458| 
    459|       expect(response.body).toHaveProperty("message");
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/1]Î“Ã„Â»


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m16 passed[39m[22m[90m (17)[39m
[2m   Start at [22m 11:20:13
[2m   Duration [22m 17.62s

[1m[41m FAIL [49m[22m [31mTests failed. Watching for file changes...[39m
       [2mpress [22m[1mh[22m[2m to show help[22m[2m, [22m[2mpress [22m[1mq[22m[2m to quit[22m
