npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.
 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/organizations-audit-fixes.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063178740,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178775,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178818,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178820,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178843,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/auth/oauth2.sessions.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063178869,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178890,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178888,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178911,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178917,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178921,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178939,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178957,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063178967,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/mfa.flow.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/session.management.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/integration/auth/oauth2.token-refresh.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/integration/trusted.devices.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/auth.routes.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/auth.flows.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063179348,"env":"test","module":"email-queue","jobId":"d2163508-9b44-4bdb-a5c3-77e5ce052081","to":"audit-user2@test.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1768063179819,"env":"test","module":"user-credentials-repository","userId":"gBpuq2rWz07qxIAlpOGKg","msg":"User credentials created"}
{"level":30,"time":1768063179891,"env":"test","module":"user-credentials-repository","userId":"S35yJE9LimvOVXHvpSC0B","msg":"User credentials created"}
{"level":30,"time":1768063180025,"env":"test","module":"auth-routes","userId":"gBpuq2rWz07qxIAlpOGKg","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1768063180394,"env":"test","module":"user-credentials-repository","userId":"nNkGoHRnbnSRqBhLMeUSH","msg":"User credentials created"}
{"level":30,"time":1768063180409,"env":"test","module":"user-credentials-repository","userId":"992c0140-82ea-412f-9b6e-7388145af719","msg":"User credentials created"}
{"level":30,"time":1768063180424,"env":"test","module":"user-credentials-repository","userId":"b3689735-d830-4c54-88d5-d6919f41a175","msg":"User credentials created"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould trust current device
[22m[39m[TEST UTILS] MFA Secret verified for 0f0a6a9faad76d27ab672db3392a7ff6

{"level":30,"time":1768063180509,"env":"test","module":"auth-routes","userId":"nNkGoHRnbnSRqBhLMeUSH","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1768063180525,"env":"test","module":"email-queue","jobId":"1cc54f5b-f526-47ef-a293-4a24eafe4450","to":"email-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768063180526,"env":"test","module":"email-queue","jobId":"e89a9bf1-138a-484f-8252-9145a35ef18f","to":"test-1768063179942-9ewvy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063180538,"env":"test","module":"email-queue","jobId":"1e09d25f-83ff-46d7-b7d5-ff65a217272d","to":"test-1768063179970-7yu0ji@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063180566,"env":"test","module":"user-credentials-repository","userId":"602akAujnCOed2arDp4Ro","msg":"User credentials created"}
{"level":30,"time":1768063180587,"env":"test","module":"auth-routes","userId":"992c0140-82ea-412f-9b6e-7388145af719","email":"test-1768063179942-9ewvy@example.com","msg":"User registered"}
{"level":30,"time":1768063180593,"env":"test","module":"auth-routes","userId":"b3689735-d830-4c54-88d5-d6919f41a175","email":"test-1768063179970-7yu0ji@example.com","msg":"User registered"}
{"level":30,"time":1768063180827,"env":"test","module":"auth-routes","userId":"a9de4890517e2a3126013ddfb7a263c3","msg":"User logged in successfully"}
{"level":30,"time":1768063180852,"env":"test","module":"user-credentials-repository","userId":"luJVNzhgoIwCbs3B4RwDl","msg":"User credentials created"}
{"level":30,"time":1768063180881,"env":"test","module":"audit-log-service","userId":"a9de4890517e2a3126013ddfb7a263c3","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063180890,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063180967,"env":"test","module":"auth-routes","userId":"luJVNzhgoIwCbs3B4RwDl","sessionCount":0,"msg":"Listed active sessions"}
{"level":50,"time":1768063181036,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063181156,"env":"test","module":"mfa-service","userId":"0f0a6a9faad76d27ab672db3392a7ff6","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063181156,"env":"test","module":"auth-routes","userId":"0f0a6a9faad76d27ab672db3392a7ff6","msg":"MFA verification failed during login"}
{"level":50,"time":1768063181163,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063181204,"env":"test","module":"email-queue","jobId":"17504851-ed23-4f1d-a785-db6caa7eb97b","to":"expired-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768063181288,"env":"test","module":"user-credentials-repository","userId":"7tKlTm0-FtDH5qi8HxTlu","msg":"User credentials created"}
{"level":30,"time":1768063181384,"env":"test","module":"user-credentials-repository","userId":"36jTqbUk4aXP7zFx3m7Jt","msg":"User credentials created"}
{"level":30,"time":1768063181421,"env":"test","module":"mfa-service","userId":"a9de4890517e2a3126013ddfb7a263c3","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1768063181421,"env":"test","module":"mfa-service","userId":"a9de4890517e2a3126013ddfb7a263c3","msg":"Generated TOTP secret"}
{"level":30,"time":1768063181421,"env":"test","module":"auth-routes","userId":"a9de4890517e2a3126013ddfb7a263c3","msg":"MFA setup initiated"}
{"level":30,"time":1768063181491,"env":"test","module":"auth-routes","userId":"7de7b8a30b700414c90ccce8c910510e","msg":"User logged in successfully"}
{"level":30,"time":1768063181504,"env":"test","module":"auth-routes","userId":"36jTqbUk4aXP7zFx3m7Jt","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1768063181549,"env":"test","module":"audit-log-service","userId":"7de7b8a30b700414c90ccce8c910510e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063181712,"env":"test","module":"user-credentials-repository","userId":"m4aLeIlzALVbD_9SORSvw","msg":"User credentials created"}
{"level":40,"time":1768063181835,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1768063181839,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063181876,"env":"test","module":"user-credentials-repository","userId":"k91TbfdWGqQbHgvKiDNGp","msg":"User credentials created"}
{"level":30,"time":1768063181896,"env":"test","module":"email-queue","jobId":"c756177c-7e66-4124-af62-3b3e21fd7b70","to":"expired-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":30,"time":1768063182047,"env":"test","module":"auth-routes","userId":"k91TbfdWGqQbHgvKiDNGp","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1768063182074,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/trust-device[2m > [22m[2mshould set trust expiry to 30 days
[22m[39m[TEST UTILS] MFA Secret verified for 6d9f5579847ac74abf212b5afc422ff7

{"level":50,"time":1768063182112,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063182119,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063182173,"env":"test","module":"user-credentials-repository","userId":"TcLoI1r1th_UMA7BzpGYf","msg":"User credentials created"}
{"level":40,"time":1768063182339,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1768063182361,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063182427,"env":"test","module":"user-credentials-repository","userId":"qpkaSk5Zunx-3zPiqLDOC","msg":"User credentials created"}
{"level":30,"time":1768063182543,"env":"test","module":"auth-routes","userId":"qpkaSk5Zunx-3zPiqLDOC","sessionCount":1,"msg":"Listed active sessions"}
{"level":50,"time":1768063182622,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063182631,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063182637,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063182645,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063182676,"env":"test","module":"user-credentials-repository","userId":"OWKKE8efmbfvUWj_Do9bc","msg":"User credentials created"}
{"level":50,"time":1768063182728,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063182833,"env":"test","module":"auth-service","tokenHash":"2cbfddf2e42c4e78be7f9b8e5c932bd0f549d1f7ceca061aa57327d3710b3e77","msg":"Security: Unknown refresh token used"}
{"level":40,"time":1768063182839,"env":"test","module":"mfa-service","userId":"6d9f5579847ac74abf212b5afc422ff7","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063182839,"env":"test","module":"auth-routes","userId":"6d9f5579847ac74abf212b5afc422ff7","msg":"MFA verification failed during login"}
{"level":50,"time":1768063182844,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063182888,"env":"test","module":"user-credentials-repository","userId":"T7iQ0p9p0TwPZW3c47mkN","msg":"User credentials created"}
{"level":50,"time":1768063182892,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063182924,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063183168,"env":"test","module":"user-credentials-repository","userId":"nHv1GsrYDMY0lDeyG9Z6P","msg":"User credentials created"}
{"level":50,"time":1768063183203,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063183206,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063183229,"env":"test","module":"user-credentials-repository","userId":"YF0ZX6qVlyNELpp5LX93d","msg":"User credentials created"}
{"level":40,"time":1768063183331,"env":"test","module":"auth-service","tokenHash":"bb131c42fcff65150141a7c3f1981874a469ba80a467616257c720839f85cde7","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768063183449,"env":"test","module":"auth-routes","userId":"YF0ZX6qVlyNELpp5LX93d","sessionId":"375ec48e-eb59-46ad-8c0b-0adfc66503b3","msg":"Session revoked"}
{"level":50,"time":1768063183471,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063183490,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Setup Flow[2m > [22m[2mshould not allow MFA setup if already enabled
[22m[39m[TEST UTILS] MFA Secret verified for 06f4149245c9934a4236750bb4d4e2d4

{"level":30,"time":1768063183685,"env":"test","module":"user-credentials-repository","userId":"577944b9-c191-4aea-b9e1-d7809eba07dc","msg":"User credentials created"}
{"level":30,"time":1768063183758,"env":"test","module":"user-credentials-repository","userId":"LSjFy0C3chZNTHSC6G7xz","msg":"User credentials created"}
{"level":30,"time":1768063183790,"env":"test","module":"email-queue","jobId":"15893d11-bf43-43f0-93b5-530e66d01d7e","to":"test-1768063183271-yhno0i@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063183846,"env":"test","module":"auth-routes","userId":"577944b9-c191-4aea-b9e1-d7809eba07dc","email":"test-1768063183271-yhno0i@example.com","msg":"User registered"}
{"level":30,"time":1768063183886,"env":"test","module":"user-credentials-repository","userId":"seLUd4HbkIIQC2sHzC2D5","msg":"User credentials created"}
{"level":50,"time":1768063184130,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063184147,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063184244,"env":"test","module":"user-credentials-repository","userId":"AOlU8UU6-uaC6oJ9ogo0w","msg":"User credentials created"}
{"level":30,"time":1768063184424,"env":"test","module":"user-credentials-repository","userId":"o-54fVApPECfisGd6OAqL","msg":"User credentials created"}
{"level":30,"time":1768063184445,"env":"test","module":"email-queue","jobId":"2ab7bbf7-a6ba-433c-b2fd-8881a712f12c","to":"placeholder-test@example.com","subject":"You've been invited to join Test Org Audit","msg":"Email added to queue"}
{"level":50,"time":1768063184551,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063184588,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063184719,"env":"test","module":"auth-service","tokenHash":"597b3935cf17880994fb5e6446266f61b336c60009b199fb27802eb750f6cf69","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768063184769,"env":"test","module":"user-credentials-repository","userId":"WC4A6zY4EXOTo9V92K6eS","msg":"User credentials created"}
{"level":50,"time":1768063184816,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063184854,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #8: Placeholder user cleanup > should cleanup placeholder user when invite is revoked
Failed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:20:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:833:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:270:7
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:20 {
  length: 341,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (workspace_id)=(a244753d-90f9-4207-b12a-ac5e5851f5e4) is not present in table "workspaces".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_workspace_id_workspaces_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould list all trusted devices
[22m[39m[TEST UTILS] MFA Secret verified for 376d8739618867be1db359aac68c4091

{"level":30,"time":1768063185043,"env":"test","module":"user-credentials-repository","userId":"_gTXvCnWglDgh_DmJMAJN","msg":"User credentials created"}
{"level":50,"time":1768063185119,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #8: Placeholder user cleanup[2m > [22m[2mshould cleanup placeholder user when invite is revoked
[22m[39mCleaned up placeholder user 3a664641-ca40-4772-a493-004b37635e27 (no pending invites or memberships)

{"level":30,"time":1768063185131,"env":"test","module":"user-credentials-repository","userId":"2a227991-c4fe-4927-8fea-b75dc331897c","msg":"User credentials created"}
{"level":30,"time":1768063185239,"env":"test","module":"email-queue","jobId":"1770d448-037c-47e5-ad78-2a08786397eb","to":"test-1768063184737-q06f5g@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063185292,"env":"test","module":"auth-routes","userId":"2a227991-c4fe-4927-8fea-b75dc331897c","email":"test-1768063184737-q06f5g@example.com","msg":"User registered"}
{"level":30,"time":1768063185334,"env":"test","module":"user-credentials-repository","userId":"BFoPjAKaw3oAEH3Uwqw9d","msg":"User credentials created"}
{"level":50,"time":1768063185338,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063185421,"env":"test","module":"auth-routes","userId":"871ca965142e0f3a12f1f3eee3c2a4a7","msg":"User logged in successfully"}
{"level":30,"time":1768063185472,"env":"test","module":"audit-log-service","userId":"871ca965142e0f3a12f1f3eee3c2a4a7","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063185571,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/integration/api.runs.docx.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/api.templates-runs.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/api.workflows.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/auth/session.management.integration.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/auth/auth.middleware.integration.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/auth/jwt.authentication.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/auth/protected.routes.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":40,"time":1768063185680,"env":"test","module":"mfa-service","userId":"376d8739618867be1db359aac68c4091","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063185680,"env":"test","module":"auth-routes","userId":"376d8739618867be1db359aac68c4091","msg":"MFA verification failed during login"}
{"level":50,"time":1768063185684,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063185690,"env":"test","module":"user-credentials-repository","userId":"706ugN6JPkU_tuSxoNX4h","msg":"User credentials created"}
{"level":30,"time":1768063185712,"env":"test","module":"user-credentials-repository","userId":"5seZ9VHfTSZmi6IAmMdvQ","msg":"User credentials created"}
{"level":50,"time":1768063185913,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063185914,"env":"test","module":"mfa-service","userId":"871ca965142e0f3a12f1f3eee3c2a4a7","count":10,"msg":"Stored backup codes"}
stderr | tests/integration/auth/protected.routes.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:190:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

stderr | tests/integration/api.templates-runs.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:190:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

stderr | tests/integration/auth/session.management.integration.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:190:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1768063185914,"env":"test","module":"mfa-service","userId":"871ca965142e0f3a12f1f3eee3c2a4a7","msg":"Generated TOTP secret"}
{"level":30,"time":1768063185914,"env":"test","module":"auth-routes","userId":"871ca965142e0f3a12f1f3eee3c2a4a7","msg":"MFA setup initiated"}
{"level":30,"time":1768063185919,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063185919,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063185918,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":30,"time":1768063185934,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768063185935,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768063185934,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts[2m > [22m[2mTemplates and Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063185926,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063185927,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063185931,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063185934,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063185934,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063185934,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063185934,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768063185927,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063185927,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063185931,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063185934,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063185934,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063185935,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063185935,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768063185925,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063185926,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063185930,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063185934,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063185934,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063185934,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063185934,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1768063185949,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063186036,"env":"test","module":"auth-routes","userId":"5seZ9VHfTSZmi6IAmMdvQ","msg":"All other sessions revoked"}
{"level":40,"time":1768063186054,"env":"test","module":"mfa-service","userId":"376d8739618867be1db359aac68c4091","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063186054,"env":"test","module":"auth-routes","userId":"376d8739618867be1db359aac68c4091","msg":"MFA verification failed during login"}
{"level":50,"time":1768063186057,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063186071,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063186086,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063186087,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063186077,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063186078,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063186081,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063186085,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063186085,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063186086,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063186086,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768063186090,"env":"test","module":"audit-log-service","userId":"5seZ9VHfTSZmi6IAmMdvQ","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768063186101,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063186093,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063186094,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063186097,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063186100,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063186101,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063186101,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063186101,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1768063186253,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063186256,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:70:7 {
  length: 336,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(8e8f9a82-00f6-4dc4-9f53-31102144f313) is still referenced from table "workflows".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflows',
  column: undefined,
  dataType: undefined,
  constraint: 'workflows_creator_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/organizations-audit-fixes.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 9597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should cascade ownership to workflow runs when project is transferred [33m 1057[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent double-acceptance via transaction [33m 1185[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not create invite if email fails [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow re-invite after invite expires [33m 1433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow last admin to delete empty organization [33m 734[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent deletion if org owns assets[39m[33m 1020[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should cleanup placeholder user when invite is revoked [33m 1479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should fail fast on non-existent org [33m 642[2mms[22m[39m
{"level":50,"time":1768063186272,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063186288,"env":"test","module":"user-credentials-repository","userId":"Q9q5_2Qs8FtCVKXwOZSXC","msg":"User credentials created"}
{"level":50,"time":1768063186308,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063186414,"env":"test","module":"mfa-service","userId":"376d8739618867be1db359aac68c4091","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063186414,"env":"test","module":"auth-routes","userId":"376d8739618867be1db359aac68c4091","msg":"MFA verification failed during login"}
{"level":50,"time":1768063186418,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063186484,"env":"test","module":"user-credentials-repository","userId":"6MMA5Ko9nIXUs1wp42Lz8","msg":"User credentials created"}
{"level":30,"time":1768063186563,"env":"test","module":"user-credentials-repository","userId":"be65399d-73d1-4582-ad35-3123e7a3fa74","msg":"User credentials created"}
{"level":30,"time":1768063186564,"env":"test","module":"user-credentials-repository","userId":"b65db8ab-5f1f-41fa-a94d-06a73be9f828","msg":"User credentials created"}
{"level":30,"time":1768063186568,"env":"test","module":"user-credentials-repository","userId":"027f92ec-9ca6-4d0e-8b97-7b09677593d9","msg":"User credentials created"}
{"level":30,"time":1768063186586,"env":"test","module":"user-credentials-repository","userId":"182b9909-3e87-41ea-b400-6e9f76da6d4b","msg":"User credentials created"}
{"level":30,"time":1768063186586,"env":"test","module":"user-credentials-repository","userId":"d371f2bd-e37f-46e5-926b-0e1247788a52","msg":"User credentials created"}
{"level":50,"time":1768063186635,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063186638,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063186665,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063186666,"env":"test","module":"email-queue","jobId":"538e9e97-5ff8-44c1-bd8b-00aecc705afe","to":"test-b-aiiPL7z5Zx7foCMvM09@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063186673,"env":"test","module":"email-queue","jobId":"729efebd-c828-4c5c-a82c-38eb935bff96","to":"test-fTyTDLIJGv_jdiT0YEUBq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063186674,"env":"test","module":"email-queue","jobId":"bbe1951a-baa1-4965-964e-f1e5970bb21b","to":"test-GnH29_HLMZTOZoY_qdk3L@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063186675,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063186669,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063186670,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063186672,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063186675,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063186675,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063186675,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063186675,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768063186690,"env":"test","module":"email-queue","jobId":"4b833b19-98f4-4738-9e28-7ba7227716f9","to":"test-DVV9LOGZ9J-oA_Ob1g8g9@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063186690,"env":"test","module":"email-queue","jobId":"ea4dd67f-a925-4448-b15b-6424fe9a7c33","to":"test-BBX44G6TYrUJ_jZB7NWWt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063186699,"env":"test","module":"auth-routes","userId":"6MMA5Ko9nIXUs1wp42Lz8","msg":"All other sessions revoked"}
{"level":30,"time":1768063186723,"env":"test","module":"auth-routes","userId":"be65399d-73d1-4582-ad35-3123e7a3fa74","email":"test-b-aiiPL7z5Zx7foCMvM09@example.com","msg":"User registered"}
{"level":30,"time":1768063186730,"env":"test","module":"auth-routes","userId":"027f92ec-9ca6-4d0e-8b97-7b09677593d9","email":"test-fTyTDLIJGv_jdiT0YEUBq@example.com","msg":"User registered"}
{"level":30,"time":1768063186731,"env":"test","module":"auth-routes","userId":"b65db8ab-5f1f-41fa-a94d-06a73be9f828","email":"test-GnH29_HLMZTOZoY_qdk3L@example.com","msg":"User registered"}
{"level":30,"time":1768063186747,"env":"test","module":"auth-routes","userId":"d371f2bd-e37f-46e5-926b-0e1247788a52","email":"test-BBX44G6TYrUJ_jZB7NWWt@example.com","msg":"User registered"}
{"level":30,"time":1768063186749,"env":"test","module":"auth-routes","userId":"182b9909-3e87-41ea-b400-6e9f76da6d4b","email":"test-DVV9LOGZ9J-oA_Ob1g8g9@example.com","msg":"User registered"}
{"level":30,"time":1768063186751,"env":"test","module":"audit-log-service","userId":"6MMA5Ko9nIXUs1wp42Lz8","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":50,"time":1768063186798,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063186875,"env":"test","module":"user-credentials-repository","userId":"mXF91ZnAVb9IKWdqcFziq","msg":"User credentials created"}
{"level":50,"time":1768063186947,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063186952,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063187132,"env":"test","module":"user-credentials-repository","userId":"Pdk98GHpqDLTOdG_Ckfiy","msg":"User credentials created"}
{"level":30,"time":1768063187169,"env":"test","module":"user-credentials-repository","userId":"066acf93-9fa0-4a0d-a5aa-2c698f055f0b","msg":"User credentials created"}
{"level":50,"time":1768063187207,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063187280,"env":"test","module":"email-queue","jobId":"99cec30d-62bf-4d91-b10f-b4c43e9c7bea","to":"test-docx-umGLVqRrmzQOsf_gJJzs2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063187309,"env":"test","module":"user-credentials-repository","userId":"fabb9edd-ade4-46d8-92dc-468d713ef983","msg":"User credentials created"}
{"level":50,"time":1768063187329,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063187334,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063187335,"env":"test","module":"auth-routes","userId":"066acf93-9fa0-4a0d-a5aa-2c698f055f0b","email":"test-docx-umGLVqRrmzQOsf_gJJzs2@example.com","msg":"User registered"}
{"level":30,"time":1768063187399,"env":"test","module":"user-credentials-repository","userId":"24a39631-d61c-4dc7-a024-54ec96f14875","msg":"User credentials created"}
{"level":30,"time":1768063187400,"env":"test","module":"user-credentials-repository","userId":"3c550d7a-daa0-467f-a947-4a63a8581112","msg":"User credentials created"}
{"level":30,"time":1768063187422,"env":"test","module":"email-queue","jobId":"f3edf2fd-b9d2-4cdd-aca4-4b6f42393f3f","to":"session-test-T8dZakE2fKbTvwgNzCCCi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063187483,"env":"test","module":"user-credentials-repository","userId":"Uik80duWIBZSgeNc3kb-O","msg":"User credentials created"}
{"level":30,"time":1768063187484,"env":"test","module":"auth-routes","userId":"fabb9edd-ade4-46d8-92dc-468d713ef983","email":"session-test-T8dZakE2fKbTvwgNzCCCi@example.com","msg":"User registered"}
{"level":50,"time":1768063187487,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768063187510,"env":"test","module":"email-queue","jobId":"00989e22-ec58-44a3-8f0a-c2b9ecf2045c","to":"middleware-test-syDFLLs26D24dS7Mq0n-T@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063187514,"env":"test","module":"email-queue","jobId":"1dd06eea-d23e-473a-861d-fe961eca3b11","to":"protected-test-irVbtQMRaMFKD--z0_R8k@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063187555,"env":"test","module":"user-credentials-repository","userId":"cZlLCmfZSUAg2ZhkipP6O","msg":"User credentials created"}
{"level":30,"time":1768063187561,"env":"test","module":"auth-routes","userId":"24a39631-d61c-4dc7-a024-54ec96f14875","email":"middleware-test-syDFLLs26D24dS7Mq0n-T@example.com","msg":"User registered"}
{"level":30,"time":1768063187569,"env":"test","module":"auth-routes","userId":"3c550d7a-daa0-467f-a947-4a63a8581112","email":"protected-test-irVbtQMRaMFKD--z0_R8k@example.com","msg":"User registered"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Deprecated method ".compile", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.compile (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:475:7)
    at TemplateScanner.validateBuffer (C:/Users/scoot/poll/VaultLogic/server/services/document/TemplateScanner.ts:190:13)
    at TemplateScanner.scanAndFix (C:/Users/scoot/poll/VaultLogic/server/services/document/TemplateScanner.ts:69:22)
    at C:/Users/scoot/poll/VaultLogic/server/api/templates.ts:328:52
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063187847,"env":"test","module":"user-credentials-repository","userId":"sGV6k_hQozHiT1DgLtdLj","msg":"User credentials created"}
{"level":30,"time":1768063187856,"env":"test","module":"user-credentials-repository","userId":"449a8896-5f39-4606-99a9-5b3683e4e738","msg":"User credentials created"}
{"level":50,"time":1768063187868,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063187870,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063187944,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould require MFA for enabled users
[22m[39m[TEST UTILS] MFA Secret verified for 1bf330358ddb4865dc5e5f79a2ab254c

{"level":30,"time":1768063187959,"env":"test","module":"auth-routes","userId":"sGV6k_hQozHiT1DgLtdLj","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":30,"time":1768063187961,"env":"test","module":"email-queue","jobId":"5297bd64-0d75-4b69-82f6-a984d0a2d136","to":"viewer-4_b9-9rTu464SXtHdBTgB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063188016,"env":"test","module":"auth-routes","userId":"449a8896-5f39-4606-99a9-5b3683e4e738","email":"viewer-4_b9-9rTu464SXtHdBTgB@example.com","msg":"User registered"}
{"level":30,"time":1768063188051,"env":"test","module":"user-credentials-repository","userId":"Y8RfcF_B60TtRUY3e68XD","msg":"User credentials created"}
{"level":50,"time":1768063188111,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"qpdf --decrypt \"C:\\Users\\scoot\\AppData\\Local\\Temp\\locked-1768063188058.pdf\" \"C:\\Users\\scoot\\AppData\\Local\\Temp\\unlocked-1768063188058.pdf\"","stdout":"","stderr":"'qpdf' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"Failed to unlock PDF with qpdf"}
{"level":40,"time":1768063188111,"env":"test","msg":"Returning original PDF buffer due to unlock failure"}
{"level":50,"time":1768063188114,"env":"test","error":{},"msg":"Failed to extract PDF fields"}
{"level":50,"time":1768063188114,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF processing failed"}
{"level":50,"time":1768063188114,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"5806fe1b-9f81-47c9-887a-4b80ce12904f"},"file":{"fieldname":"file","originalname":"test.pdf","encoding":"7bit","mimetype":"application/pdf","buffer":{"type":"Buffer","data":[37,80,68,70]},"size":4},"msg":"Error creating template"}
{"level":50,"time":1768063188121,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063188132,"env":"test","module":"rbac-middleware","userId":"449a8896-5f39-4606-99a9-5b3683e4e738","userRole":"viewer","permission":"workflow:create","path":"/projects/fa461d6e-1638-455c-a8d5-1c9db0b3adc1/workflows","msg":"Permission denied"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude revoked devices
[22m[39m[TEST UTILS] MFA Secret verified for ddb8eea3cc0edeea8364c84ce1ca1ceb

{"level":50,"time":1768063188221,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"5806fe1b-9f81-47c9-887a-4b80ce12904f"},"msg":"Error creating template"}
{"level":30,"time":1768063188306,"env":"test","module":"user-credentials-repository","userId":"769d3479-4c80-476d-a163-81135ae58be0","msg":"User credentials created"}
{"level":30,"time":1768063188338,"env":"test","module":"user-credentials-repository","userId":"bd076d0f-3f46-4dfd-b381-0325825ea433","msg":"User credentials created"}
{"level":50,"time":1768063188380,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063188381,"env":"test","module":"user-credentials-repository","userId":"089ae32a-4312-46c0-98f2-f0aedd07b2de","msg":"User credentials created"}
{"level":30,"time":1768063188399,"env":"test","module":"user-credentials-repository","userId":"WbpNJE0HN_fAzpFta4nMW","msg":"User credentials created"}
{"level":30,"time":1768063188411,"env":"test","module":"email-queue","jobId":"e9b8cd05-3be0-43f4-a31d-5e86fcf5537e","to":"middleware-test-rgNtsLlHT__h2q9UrIFLG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063188451,"env":"test","module":"email-queue","jobId":"6c90ab21-46f4-4aa1-9838-e175d47f55d3","to":"session-test-N4UM4dzTv55cJqd-pHFSj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063188464,"env":"test","module":"auth-routes","userId":"769d3479-4c80-476d-a163-81135ae58be0","email":"middleware-test-rgNtsLlHT__h2q9UrIFLG@example.com","msg":"User registered"}
{"level":30,"time":1768063188484,"env":"test","module":"email-queue","jobId":"8214bce5-270d-487b-a09e-b607919bfd78","to":"protected-test-yWBnd1KLqxWeTpaZpF7cw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063188491,"env":"test","module":"user-credentials-repository","userId":"lljeLW6jZOoMVKdbj-olu","msg":"User credentials created"}
{"level":30,"time":1768063188493,"env":"test","module":"email-queue","jobId":"038de57d-e0c5-43d8-bbd9-c834bf00110a","to":"test-1768063187857-kl3bch@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063188493,"env":"test","module":"auth-service","email":"test-1768063187857-kl3bch@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768063188505,"env":"test","module":"auth-routes","userId":"bd076d0f-3f46-4dfd-b381-0325825ea433","email":"session-test-N4UM4dzTv55cJqd-pHFSj@example.com","msg":"User registered"}
{"level":30,"time":1768063188510,"env":"test","module":"auth-routes","userId":"WbpNJE0HN_fAzpFta4nMW","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":50,"time":1768063188529,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063188542,"env":"test","module":"auth-routes","userId":"089ae32a-4312-46c0-98f2-f0aedd07b2de","email":"protected-test-yWBnd1KLqxWeTpaZpF7cw@example.com","msg":"User registered"}
{"level":50,"time":1768063188554,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/datavault/EditableCell.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063188638,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063188642,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063188679,"env":"test","module":"auth-routes","userId":"WbpNJE0HN_fAzpFta4nMW","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Trusted device expiry updated"}
{"level":30,"time":1768063188816,"env":"test","module":"email-queue","jobId":"a7db44e4-103d-4fdd-8273-cf86ffa400a5","to":"test-1768063187857-kl3bch@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063188816,"env":"test","module":"auth-service","email":"test-1768063187857-kl3bch@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768063188981,"env":"test","module":"auth-routes","userId":"ddb8eea3cc0edeea8364c84ce1ca1ceb","msg":"Login requires MFA verification"}
{"level":30,"time":1768063189008,"env":"test","module":"auth-routes","userId":"769d3479-4c80-476d-a163-81135ae58be0","msg":"User logged in successfully"}
{"level":30,"time":1768063189059,"env":"test","module":"audit-log-service","userId":"769d3479-4c80-476d-a163-81135ae58be0","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063189061,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063189066,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > POST /api/workflows/:id/run - Template Node Execution > should execute workflow with template node and generate DOCX
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

{"level":40,"time":1768063189094,"env":"test","module":"mfa-service","userId":"ddb8eea3cc0edeea8364c84ce1ca1ceb","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063189094,"env":"test","module":"auth-routes","userId":"ddb8eea3cc0edeea8364c84ce1ca1ceb","msg":"MFA verification failed during login"}
{"level":30,"time":1768063189097,"env":"test","module":"user-credentials-repository","userId":"FrKTch2_SiQtyUNfDvSoy","msg":"User credentials created"}
{"level":50,"time":1768063189100,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063189107,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063189103,"env":"test","module":"user-credentials-repository","userId":"vWt4rbVVRfvuAv2P1tFR1","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063189124,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768063189115,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063189116,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063189119,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063189124,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063189124,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063189124,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063189124,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1768063189158,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063189165,"env":"test","module":"auth-routes","userId":"089ae32a-4312-46c0-98f2-f0aedd07b2de","msg":"User logged in successfully"}
{"level":30,"time":1768063189176,"env":"test","module":"auth-routes","userId":"bd076d0f-3f46-4dfd-b381-0325825ea433","msg":"User logged in successfully"}
{"level":30,"time":1768063189218,"env":"test","module":"auth-routes","userId":"vWt4rbVVRfvuAv2P1tFR1","deviceCount":2,"msg":"Listed trusted devices"}
{"level":30,"time":1768063189225,"env":"test","module":"audit-log-service","userId":"089ae32a-4312-46c0-98f2-f0aedd07b2de","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063189231,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063189232,"env":"test","module":"audit-log-service","userId":"bd076d0f-3f46-4dfd-b381-0325825ea433","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063189292,"env":"test","module":"user-credentials-repository","error":{},"userId":"69bf8dd774b6087a53bf1f13150edf4a","msg":"Failed to update user password"}
{"level":50,"time":1768063189292,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":30,"time":1768063189481,"env":"test","module":"user-credentials-repository","userId":"33ed8c01-6d42-4d79-9ca2-05f2037fb0f5","msg":"User credentials created"}
{"level":30,"time":1768063189569,"env":"test","module":"user-credentials-repository","userId":"oCxZfLyljbJ_8hAj8UINu","msg":"User credentials created"}
{"level":50,"time":1768063189581,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063189587,"env":"test","module":"email-queue","jobId":"b839e50b-f8e3-4969-aff2-8db99ce194a2","to":"middleware-test-twKu0CLi7T2AyJ7h5TWpb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063189639,"env":"test","module":"auth-routes","userId":"33ed8c01-6d42-4d79-9ca2-05f2037fb0f5","email":"middleware-test-twKu0CLi7T2AyJ7h5TWpb@example.com","msg":"User registered"}
{"level":30,"time":1768063189641,"env":"test","module":"user-credentials-repository","userId":"54d8bba3-9c1b-4819-9a6d-064b0470c062","msg":"User credentials created"}
{"level":30,"time":1768063189660,"env":"test","module":"user-credentials-repository","userId":"065fbbf2-ca78-470c-9cf7-db2e46d2e5c6","msg":"User credentials created"}
{"level":30,"time":1768063189685,"env":"test","module":"auth-routes","userId":"oCxZfLyljbJ_8hAj8UINu","deviceCount":0,"msg":"Listed trusted devices"}
{"level":30,"time":1768063189724,"env":"test","module":"user-credentials-repository","userId":"ea258c5f-de1c-47ee-8525-1f46d0c13d01","msg":"User credentials created"}
{"level":30,"time":1768063189760,"env":"test","module":"email-queue","jobId":"df009d15-8f58-4276-800e-f4be023fad54","to":"test-GWnyCvxCXeyWtP-JoL-cG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063189765,"env":"test","module":"email-queue","jobId":"f69f6716-2716-4037-8f29-203b3ffbfbb0","to":"protected-test-wSljB84DnR5SEAn0ZJho3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063189765,"env":"test","module":"user-credentials-repository","userId":"3qtqMvVEot6aCF7vpJ1MW","msg":"User credentials created"}
{"level":30,"time":1768063189818,"env":"test","module":"auth-routes","userId":"065fbbf2-ca78-470c-9cf7-db2e46d2e5c6","email":"protected-test-wSljB84DnR5SEAn0ZJho3@example.com","msg":"User registered"}
{"level":30,"time":1768063189820,"env":"test","module":"auth-routes","userId":"54d8bba3-9c1b-4819-9a6d-064b0470c062","email":"test-GWnyCvxCXeyWtP-JoL-cG@example.com","msg":"User registered"}
{"level":30,"time":1768063189832,"env":"test","module":"email-queue","jobId":"0a88e7d3-e7cb-4a83-b848-14049764807f","to":"session-test-liqCr3iXZn0wFXWCw4Sq5@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063189886,"env":"test","module":"auth-routes","userId":"ea258c5f-de1c-47ee-8525-1f46d0c13d01","email":"session-test-liqCr3iXZn0wFXWCw4Sq5@example.com","msg":"User registered"}
{"level":50,"time":1768063189948,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063190038,"env":"test","module":"user-credentials-repository","userId":"8ALrCmeVLKEOVabLVyNZ8","msg":"User credentials created"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mGET /api/auth/trusted-devices[2m > [22m[2mshould exclude expired devices
[22m[39m[TEST UTILS] MFA Secret verified for 6825432237384465c95afd16fd6363c0

stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > reverts value on save error
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:204:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":50,"time":1768063190174,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063190196,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063190196,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063190202,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063190202,"env":"test","module":"auth-routes","userId":"8ALrCmeVLKEOVabLVyNZ8","deviceId":"6c38a46e-5ad1-43d9-895e-b249de619f9e","msg":"Trusted device revoked"}
{"level":50,"time":1768063190207,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > displays error indicator on save failure
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:220:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":50,"time":1768063190275,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063190354,"env":"test","module":"user-credentials-repository","userId":"623c936e-0f90-4916-9280-3879caefac0f","msg":"User credentials created"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould reject invalid TOTP during login
[22m[39m[TEST UTILS] MFA Secret verified for 1c42fd61990316fd4264a65096cc5ae0

{"level":50,"time":1768063190373,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063190384,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Boolean Type (Checkbox) > shows loading spinner when saving checkbox
Warning: An update to EditableCell inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at EditableCell (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/EditableCell.tsx:12:25)

{"level":50,"time":1768063190446,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063190450,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063190458,"env":"test","module":"email-queue","jobId":"0f0aa2f5-4ee2-4a9d-88e2-23e646908c1e","to":"middleware-test-Pi5YM5odZiVrq98FHZpk7@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063190514,"env":"test","module":"auth-routes","userId":"623c936e-0f90-4916-9280-3879caefac0f","email":"middleware-test-Pi5YM5odZiVrq98FHZpk7@example.com","msg":"User registered"}
{"level":30,"time":1768063190601,"env":"test","module":"user-credentials-repository","userId":"6c06beaf-46a2-4e14-9f7f-14c95856cae9","msg":"User credentials created"}
{"level":30,"time":1768063190622,"env":"test","module":"user-credentials-repository","userId":"F9s-klMRH1ikFkbceIQPT","msg":"User credentials created"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/datavault/EditableCell.test.tsx [2m([22m[2m29 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 2733[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders value in display mode initially[32m 45[2mms[22m[39m
       [32mÎ“Â£Ã´[39m shows double-click hint on hover[32m 205[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not show hint for read-only cells[32m 22[2mms[22m[39m
       [32mÎ“Â£Ã´[39m includes proper ARIA label with column name and value[32m 19[2mms[22m[39m
       [32mÎ“Â£Ã´[39m indicates read-only status in ARIA label[32m 15[2mms[22m[39m
       [32mÎ“Â£Ã´[39m is focusable when editable[32m 16[2mms[22m[39m
       [32mÎ“Â£Ã´[39m is not focusable when read-only[32m 22[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on double-click[32m 132[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on Enter key press[32m 40[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on Space key press[32m 47[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not enter edit mode when read-only[32m 15[2mms[22m[39m
       [32mÎ“Â£Ã´[39m focuses and selects input text on edit mode entry[32m 42[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves on blur[32m 137[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves on Enter key press[32m 98[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not save if value unchanged[32m 38[2mms[22m[39m
       [32mÎ“Â£Ã´[39m cancels edit on Escape key press[32m 83[2mms[22m[39m
       [32mÎ“Â£Ã´[39m reverts value on save error[32m 87[2mms[22m[39m
       [32mÎ“Â£Ã´[39m displays error indicator on save failure[32m 94[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders checkbox for boolean type[32m 39[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves immediately on checkbox change[32m 34[2mms[22m[39m
       [32mÎ“Â£Ã´[39m disables checkbox when read-only[32m 26[2mms[22m[39m
       [32mÎ“Â£Ã´[39m shows loading spinner when saving checkbox[32m 50[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders number input for number type[32m 67[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders email input for email type[32m 36[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders url input for url type[32m 25[2mms[22m[39m
       [32mÎ“Â£Ã´[39m includes placeholder text in edit mode[32m 29[2mms[22m[39m
       [32mÎ“Â£Ã´[39m formats date values for display[32m 34[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m formats boolean values as Yes/No[39m[32m 14[2mms[22m[39m
       [32mÎ“Â£Ã´[39m handles null values gracefully[32m 10[2mms[22m[39m
{"level":50,"time":1768063190651,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063190674,"env":"test","module":"auth-routes","userId":"01b2723b2a2e0253629d591040b5d19e","msg":"User logged in successfully"}
{"level":30,"time":1768063190693,"env":"test","module":"user-credentials-repository","userId":"924383d5-6bd1-4c8e-aabe-59484a1fa258","msg":"User credentials created"}
{"level":30,"time":1768063190703,"env":"test","module":"email-queue","jobId":"deea36dd-bf40-45a8-8e00-91a37de33005","to":"protected-test-hQ-xq274DZ9Ymo7vj3ugO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063190732,"env":"test","module":"audit-log-service","userId":"01b2723b2a2e0253629d591040b5d19e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > POST /api/workflows/:id/run - Template Node Execution > should handle missing template data gracefully
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

{"level":40,"time":1768063190759,"env":"test","module":"mfa-service","userId":"6825432237384465c95afd16fd6363c0","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063190760,"env":"test","module":"auth-routes","userId":"6825432237384465c95afd16fd6363c0","msg":"MFA verification failed during login"}
{"level":30,"time":1768063190761,"env":"test","module":"auth-routes","userId":"6c06beaf-46a2-4e14-9f7f-14c95856cae9","email":"protected-test-hQ-xq274DZ9Ymo7vj3ugO@example.com","msg":"User registered"}
{"level":50,"time":1768063190764,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063190802,"env":"test","module":"email-queue","jobId":"56c628c3-d5c9-4886-bfa8-6009d51138d7","to":"session-test-yktSOXE1Sr5hGLAJCf5a1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063190815,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063190825,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063190857,"env":"test","module":"auth-routes","userId":"924383d5-6bd1-4c8e-aabe-59484a1fa258","email":"session-test-yktSOXE1Sr5hGLAJCf5a1@example.com","msg":"User registered"}
{"level":30,"time":1768063190863,"env":"test","module":"user-credentials-repository","userId":"d8b2f776-184b-4868-9e83-1bb48df6b470","msg":"User credentials created"}
{"level":50,"time":1768063190931,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063190954,"env":"test","module":"email-queue","jobId":"2ab3c964-41a4-4097-a4d7-831f67b75fc2","to":"test-1768063189714-1u29zq@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063190954,"env":"test","module":"auth-service","email":"test-1768063189714-1u29zq@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768063190958,"env":"test","module":"user-credentials-repository","userId":"kKamrkhrGDvgd6r6g6kkl","msg":"User credentials created"}
{"level":30,"time":1768063190972,"env":"test","module":"email-queue","jobId":"0cc5f78b-8e89-40d3-88d8-ff231870f125","to":"test-1768063190466-18cfw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063191030,"env":"test","module":"auth-routes","userId":"d8b2f776-184b-4868-9e83-1bb48df6b470","email":"test-1768063190466-18cfw@example.com","msg":"User registered"}
{"level":40,"time":1768063191035,"env":"test","module":"mfa-service","userId":"1c42fd61990316fd4264a65096cc5ae0","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063191035,"env":"test","module":"auth-routes","userId":"1c42fd61990316fd4264a65096cc5ae0","msg":"MFA verification failed during login"}
{"level":50,"time":1768063191130,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063191214,"env":"test","module":"user-credentials-repository","userId":"dcf6a0c7-afa3-4320-aebe-2c04634b74e9","msg":"User credentials created"}
{"level":50,"time":1768063191234,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063191305,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063191317,"env":"test","module":"email-queue","jobId":"6a591c95-6387-4846-a2c7-4c65f21866bb","to":"middleware-test-AMTy7BIp_o0RiCcdxgVzm@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063191340,"env":"test","module":"user-credentials-repository","error":{},"userId":"01b2723b2a2e0253629d591040b5d19e","msg":"Failed to update user password"}
{"level":50,"time":1768063191340,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":30,"time":1768063191372,"env":"test","module":"auth-routes","userId":"dcf6a0c7-afa3-4320-aebe-2c04634b74e9","email":"middleware-test-AMTy7BIp_o0RiCcdxgVzm@example.com","msg":"User registered"}
{"level":30,"time":1768063191399,"env":"test","module":"user-credentials-repository","userId":"p2tlr33MNcCQtG-IwmznY","msg":"User credentials created"}
{"level":50,"time":1768063191489,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063191508,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063191515,"env":"test","module":"user-credentials-repository","userId":"e4eda53a-bce3-49e8-8c44-514e98ff0c1c","msg":"User credentials created"}
{"level":30,"time":1768063191624,"env":"test","module":"email-queue","jobId":"0e0fe4fc-6653-4a8b-b81d-eb478bc28548","to":"protected-test-9yiZurwu3NGAUF3NAtc2X@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063191631,"env":"test","module":"user-credentials-repository","userId":"cfba30ed-29a4-40bf-b69b-7c2532daee62","msg":"User credentials created"}
{"level":30,"time":1768063191678,"env":"test","module":"auth-routes","userId":"e4eda53a-bce3-49e8-8c44-514e98ff0c1c","email":"protected-test-9yiZurwu3NGAUF3NAtc2X@example.com","msg":"User registered"}
{"level":50,"time":1768063191686,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould revoke specific device
[22m[39m[TEST UTILS] MFA Secret verified for 80424a05fa6e282251c4e3e6c2e2a31b

{"level":30,"time":1768063191740,"env":"test","module":"email-queue","jobId":"d6a41989-f3bb-40bf-b542-3ee097838d3e","to":"session-test-cJ7ahoA3XDdrnY87ds5-Z@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063191797,"env":"test","module":"auth-routes","userId":"cfba30ed-29a4-40bf-b69b-7c2532daee62","email":"session-test-cJ7ahoA3XDdrnY87ds5-Z@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > GET /api/runs/:id/download - Download Generated DOCX
Deprecated method ".setData", view upgrade guide : https://docxtemplater.com/docs/api/#upgrade-guide, stack : Error: 
    at deprecatedMethod (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:184:167)
    at Docxtemplater.setData (C:\Users\scoot\poll\VaultLogic\node_modules\docxtemplater\js\docxtemplater.js:694:7)
    at renderDocx2 (C:/Users/scoot/poll/VaultLogic/server/services/docxRenderer2.ts:150:9)
    at executeTemplateNode (C:/Users/scoot/poll/VaultLogic/server/engine/nodes/template.ts:199:28)
    at executeNode (C:/Users/scoot/poll/VaultLogic/server/engine/registry.ts:163:14)
    at runGraph (C:/Users/scoot/poll/VaultLogic/server/engine/index.ts:276:30)
    at C:/Users/scoot/poll/VaultLogic/server/api/runs.ts:112:24

{"level":30,"time":1768063191823,"env":"test","module":"user-credentials-repository","userId":"fkJfBqbfVz9nxJBvmizbV","msg":"User credentials created"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Login Flow[2m > [22m[2mshould accept TOTP codes within 60-second window
[22m[39m[TEST UTILS] MFA Secret verified for a143fa8da8532810241d85c663eb74ed

{"level":50,"time":1768063192039,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063192080,"env":"test","module":"user-credentials-repository","userId":"1af3acb3-3ac5-40eb-b78a-3dc4c36129a6","msg":"User credentials created"}
{"level":40,"time":1768063192091,"env":"test","module":"auth-service","tokenHash":"e419d05f5cc4e21ed5c6ba8977ba0117c6b6a179c9571956bf9055955e794f40","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.sessions.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 13277[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list all active sessions for current user [33m 561[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark current session as current [33m 477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array when user has no active sessions [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include expired sessions [33m 536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include revoked sessions [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should parse device name from user agent [33m 496[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 348[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke a specific session [33m 614[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent session [33m 389[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent revoking current session [33m 525[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent revoking another user's session [33m 568[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 349[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all sessions except current[39m[33m 814[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all trusted devices [33m 653[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 when no active session found [33m 331[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 351[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should mark current device as trusted [33m 528[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should update existing trusted device expiry[39m[33m 719[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list all trusted devices [33m 486[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should not include revoked devices [33m 466[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should revoke a trusted device[39m[33m 570[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent device [33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track IP address for sessions [33m 439[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track user agent for sessions [33m 439[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update lastUsedAt on token refresh[39m[33m 642[2mms[22m[39m
{"level":50,"time":1768063192182,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063192187,"env":"test","module":"email-queue","jobId":"b842ac0d-37b1-4e08-acf9-637418c802a7","to":"middleware-test-VpeMNTG0YNijvcgtnA93s@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stderr | tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.templates-runs.test.ts:83:5 {
  length: 311,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(b65db8ab-5f1f-41fa-a94d-06a73be9f828) is still referenced from table "runs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'runs',
  column: undefined,
  dataType: undefined,
  constraint: 'runs_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.templates-runs.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 6601[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create template with file upload[32m 168[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject non-docx files[39m[32m 174[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject without file[32m 105[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list templates [33m 334[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should get template by ID[32m 271[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should extract placeholders[32m 275[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update template name [33m 344[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should delete template [33m 438[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should execute workflow[32m 287[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include logs in debug mode[32m 276[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject without required permission[39m[32m 7[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list runs [33m 380[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should filter by workflowId [33m 386[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get run by ID [33m 431[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get run logs [33m 500[2mms[22m[39m
{"level":30,"time":1768063192245,"env":"test","module":"auth-routes","userId":"1af3acb3-3ac5-40eb-b78a-3dc4c36129a6","email":"middleware-test-VpeMNTG0YNijvcgtnA93s@example.com","msg":"User registered"}
{"level":50,"time":1768063192258,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063192366,"env":"test","module":"mfa-service","userId":"80424a05fa6e282251c4e3e6c2e2a31b","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063192366,"env":"test","module":"auth-routes","userId":"80424a05fa6e282251c4e3e6c2e2a31b","msg":"MFA verification failed during login"}
{"level":50,"time":1768063192370,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063192374,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063192438,"env":"test","module":"user-credentials-repository","userId":"bc00dac6-9ba9-4e45-bb97-7cdd5d4e87a7","msg":"User credentials created"}
{"level":50,"time":1768063192463,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063192565,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063192577,"env":"test","module":"mfa-service","userId":"a143fa8da8532810241d85c663eb74ed","msg":"No enabled MFA secret found for user"}
{"level":30,"time":1768063192580,"env":"test","module":"email-queue","jobId":"d7264435-c6a9-400b-81ad-e7426fba96d3","to":"protected-test--jlCiRcpIM2HLh3ulJ-pA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768063192577,"env":"test","module":"auth-routes","userId":"a143fa8da8532810241d85c663eb74ed","msg":"MFA verification failed during login"}
{"level":30,"time":1768063192601,"env":"test","module":"user-credentials-repository","userId":"fadf9fdf-3cc8-4409-ae01-1b5e97639196","msg":"User credentials created"}
{"level":50,"time":1768063192604,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768063192639,"env":"test","module":"auth-routes","userId":"bc00dac6-9ba9-4e45-bb97-7cdd5d4e87a7","email":"protected-test--jlCiRcpIM2HLh3ulJ-pA@example.com","msg":"User registered"}
{"level":30,"time":1768063192723,"env":"test","module":"email-queue","jobId":"ff9a5a9d-4aef-4a78-92ef-748f6bd1507e","to":"session-test-jV8bfSx0IjaW1Jl3Q06-E@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063192785,"env":"test","module":"auth-routes","userId":"fadf9fdf-3cc8-4409-ae01-1b5e97639196","email":"session-test-jV8bfSx0IjaW1Jl3Q06-E@example.com","msg":"User registered"}
{"level":30,"time":1768063192842,"env":"test","module":"auth-routes","userId":"9434742702c30d1caec147815a1c072e","msg":"User logged in successfully"}
{"level":30,"time":1768063192895,"env":"test","module":"audit-log-service","userId":"9434742702c30d1caec147815a1c072e","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063193001,"env":"test","module":"user-credentials-repository","userId":"48f7a60d-7ba0-457e-a4ee-3d00f51d1b15","msg":"User credentials created"}
{"level":30,"time":1768063193003,"env":"test","module":"auth-routes","userId":"2e3fcb8757216fa856aad5815680a764","msg":"User logged in successfully"}
{"level":50,"time":1768063193019,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063193063,"env":"test","module":"audit-log-service","userId":"2e3fcb8757216fa856aad5815680a764","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063193103,"env":"test","module":"email-queue","jobId":"9337978e-d93c-4b53-b73c-3c7e5cfcdf49","to":"middleware-test-84vrTwwNzB9gGARUTsuvv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063193110,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063193155,"env":"test","module":"auth-routes","userId":"48f7a60d-7ba0-457e-a4ee-3d00f51d1b15","email":"middleware-test-84vrTwwNzB9gGARUTsuvv@example.com","msg":"User registered"}
{"level":50,"time":1768063193182,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063193215,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768063193349,"env":"test","module":"auth-service","tokenHash":"21a6f066431b69609db81ed062aeb947b4211a32386a09e6ae04ccc3831a099f","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDELETE /api/auth/trusted-devices/:deviceId[2m > [22m[2mshould return 404 for non-existent device
[22m[39m[TEST UTILS] MFA Secret verified for 64144e02e759e0c9a7666f3360becb7e

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768063193480,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Cleanup error (non-fatal): error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.runs.docx.test.ts:189:9 {
  length: 311,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(066acf93-9fa0-4a0d-a5aa-2c698f055f0b) is still referenced from table "runs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'runs',
  column: undefined,
  dataType: undefined,
  constraint: 'runs_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/jwt.authentication.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 7930[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate valid JWT token on successful login[39m[32m 14[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include correct payload in JWT token[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set JWT expiry to 15 minutes[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept valid JWT token on protected routes[39m[32m 179[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject request without authorization header[32m 5[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject request with malformed token[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject request with missing Bearer prefix[39m[32m 167[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject token with invalid signature[32m 10[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired JWT token [33m 1106[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return token_expired error code for expired tokens[39m[33m 1120[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should authenticate with Bearer token in Authorization header[32m 120[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should work with Bearer token on POST requests[32m 109[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should work with Bearer token on PUT requests[39m[32m 68[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should work with Bearer token on DELETE requests[39m[32m 297[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exchange valid session cookie for JWT token[39m[32m 7[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject token exchange without valid cookie[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prefer Bearer token over cookie when both present[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fall back to cookie if Bearer token is invalid[39m[32m 10[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow GET requests with cookie auth only[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST requests with cookie auth only (mutation-strict)[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow anonymous access to public workflows[39m[32m 114[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach user info if authenticated on optional auth routes[39m[32m 60[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token using refresh token[39m[32m 14[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token on use[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should detect token reuse and revoke all user tokens[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke refresh token on logout[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should clear refresh token cookie on logout[39m[32m 16[2mms[22m[39m
{"level":30,"time":1768063193567,"env":"test","module":"user-credentials-repository","userId":"2dfc573d-0a3a-4557-a8b6-4921788570db","msg":"User credentials created"}
{"level":30,"time":1768063193669,"env":"test","module":"email-queue","jobId":"f5670e58-3dfb-4240-af04-77094ae52695","to":"protected-test-CvyWLSJ07GPSOHL0R8G6F@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063193739,"env":"test","module":"auth-routes","userId":"2dfc573d-0a3a-4557-a8b6-4921788570db","email":"protected-test-CvyWLSJ07GPSOHL0R8G6F@example.com","msg":"User registered"}
{"level":30,"time":1768063193623,"env":"test","module":"user-credentials-repository","userId":"e1b9ce5a-7e19-4b2c-9f93-3e7ea0b4e4a5","msg":"User credentials created"}
{"level":30,"time":1768063193738,"env":"test","module":"email-queue","jobId":"8f58e59a-9476-4fc3-a9c0-fd75fa579b54","to":"session-test-ZkPGuLgmuGS7N7VUL537W@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063193790,"env":"test","module":"auth-routes","userId":"e1b9ce5a-7e19-4b2c-9f93-3e7ea0b4e4a5","email":"session-test-ZkPGuLgmuGS7N7VUL537W@example.com","msg":"User registered"}
{"level":50,"time":1768063193692,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063193696,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.runs.docx.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 8242[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should execute workflow with template node and generate DOCX [33m 1695[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing template data gracefully [33m 1072[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should download DOCX output from successful run[39m[32m 184[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for PDF when not generated[39m[32m 182[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 404 for non-existent run[32m 119[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should extract placeholders from uploaded template[32m 130[2mms[22m[39m
{"level":30,"time":1768063193856,"env":"test","module":"user-credentials-repository","userId":"6f0cacaa-874d-44e4-9727-eeb79532bf92","msg":"User credentials created"}
stderr | tests/ui/runs.components.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063193903,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063193964,"env":"test","module":"email-queue","jobId":"1b19b5fa-fa6f-4f8a-9865-f9006544bde4","to":"middleware-test-lJlWiUQoWzBNhmVMqtNDv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768063194017,"env":"test","module":"mfa-service","userId":"64144e02e759e0c9a7666f3360becb7e","msg":"No enabled MFA secret found for user"}
{"level":30,"time":1768063194017,"env":"test","module":"auth-routes","userId":"6f0cacaa-874d-44e4-9727-eeb79532bf92","email":"middleware-test-lJlWiUQoWzBNhmVMqtNDv@example.com","msg":"User registered"}
{"level":40,"time":1768063194017,"env":"test","module":"auth-routes","userId":"64144e02e759e0c9a7666f3360becb7e","msg":"MFA verification failed during login"}
{"level":50,"time":1768063194021,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/regression-REG-1.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063194106,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063194181,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063194338,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":50,"time":1768063194401,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
{"level":50,"time":1768063194466,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1768063194519,"env":"test","module":"user-credentials-repository","userId":"2b64dffe-c986-444d-86cb-d2809d573977","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mPOST /api/auth/login[2m > [22m[2mshould return requiresMfa=true for MFA-enabled users
[22m[39m[TEST UTILS] MFA Secret verified for 102372f6faf2adde3a932d0e4065cb75

{"level":30,"time":1768063194615,"env":"test","module":"user-credentials-repository","userId":"7aac3043-6d13-44ec-9c6d-405adbcfc41e","msg":"User credentials created"}
{"level":30,"time":1768063194621,"env":"test","module":"email-queue","jobId":"4fef792e-6d88-44e5-956c-2f7cb0a4ed01","to":"protected-test-OVLZ3htoUzs3D9epOr_zP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063194664,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063194667,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063194672,"env":"test","module":"auth-routes","userId":"2b64dffe-c986-444d-86cb-d2809d573977","email":"protected-test-OVLZ3htoUzs3D9epOr_zP@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould mark backup code as used
[22m[39m[TEST UTILS] MFA Secret verified for d5b506112fa6bc6671743755ba739e46

{"level":30,"time":1768063194719,"env":"test","module":"email-queue","jobId":"17cf21d1-6ba9-428e-b9dd-09514e1f2518","to":"session-test-jMtVukF7nM8cM_hfqnPfV@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063194779,"env":"test","module":"auth-routes","userId":"7aac3043-6d13-44ec-9c6d-405adbcfc41e","email":"session-test-jMtVukF7nM8cM_hfqnPfV@example.com","msg":"User registered"}
{"level":30,"time":1768063194780,"env":"test","module":"user-credentials-repository","userId":"04a18d4b-13c3-4014-a386-ee943b5d699e","msg":"User credentials created"}
{"level":30,"time":1768063194850,"env":"test","workflowId":"b3f4e077-70c8-4d75-ba9b-1bbd07d99c48","userId":"d371f2bd-e37f-46e5-926b-0e1247788a52","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768063194885,"env":"test","module":"email-queue","jobId":"6c1587bb-cf20-427a-8151-f3b76c6d8f8d","to":"middleware-test-5XmMnvlpsRcBjfcZtaXd-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063194891,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063194937,"env":"test","module":"auth-routes","userId":"04a18d4b-13c3-4014-a386-ee943b5d699e","email":"middleware-test-5XmMnvlpsRcBjfcZtaXd-@example.com","msg":"User registered"}
{"level":50,"time":1768063195029,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063195107,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063195262,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063195313,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768063195473,"env":"test","module":"user-credentials-repository","userId":"7ab69b80-e2fa-4080-86c3-584fb26de527","msg":"User credentials created"}
{"level":30,"time":1768063195516,"env":"test","module":"user-credentials-repository","userId":"3e16d796-6984-43b3-986d-69c8b954638c","msg":"User credentials created"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768063195555,"env":"test","module":"user-credentials-repository","userId":"h2Gs4NQ2-V4RvuhM1lEtj","msg":"User credentials created"}
stderr | tests/ui/expression-editor.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063195585,"env":"test","module":"email-queue","jobId":"88271eb5-1561-472f-adbb-7c3ad541cd27","to":"session-test-sp5HIr5SVk1CWLMC5hiFx@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063195621,"env":"test","module":"email-queue","jobId":"9c20821b-976c-467a-bb54-75a9d291f7fb","to":"protected-test-untHpIK2r_86KoZxAvfJr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063195637,"env":"test","module":"auth-routes","userId":"7ab69b80-e2fa-4080-86c3-584fb26de527","email":"session-test-sp5HIr5SVk1CWLMC5hiFx@example.com","msg":"User registered"}
{"level":40,"time":1768063195641,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":50,"time":1768063195651,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063195675,"env":"test","module":"auth-routes","userId":"3e16d796-6984-43b3-986d-69c8b954638c","email":"protected-test-untHpIK2r_86KoZxAvfJr@example.com","msg":"User registered"}
{"level":30,"time":1768063195693,"env":"test","module":"user-credentials-repository","userId":"1fc034fa-3431-40e4-a4a1-9172c9f06e85","msg":"User credentials created"}
{"level":30,"time":1768063195800,"env":"test","module":"email-queue","jobId":"5dd9f5be-bcf8-4796-acec-6077644cbd99","to":"middleware-test-vdehJZcwSOWeQuMClsqxK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063195831,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063195851,"env":"test","module":"auth-routes","userId":"1fc034fa-3431-40e4-a4a1-9172c9f06e85","email":"middleware-test-vdehJZcwSOWeQuMClsqxK@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould skip MFA for trusted device
[22m[39m[TEST UTILS] MFA Secret verified for 83d9c5c421e2e08660f3ca5e8028d1bc

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/runs.components.test.tsx [2m([22m[2m19 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 3348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should render runs table with correct columns[39m[32m 26[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should render run data correctly[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show success badge for successful runs[39m[32m 44[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show error badge for failed runs[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format duration correctly[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show download options for successful runs[39m[32m 22[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should render all filter controls[32m 193[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should call onChange when status filter changes [33m 779[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should call onChange when search is submitted[32m 127[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show clear filters button when filters are active[32m 29[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should clear all filters when clear button is clicked[32m 48[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should render all trace entries[32m 56[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show executed badge for executed nodes[32m 24[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show skipped badge for skipped nodes[32m 18[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should display conditions and their results[32m 21[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should display error messages[32m 14[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should toggle show skipped nodes[32m 20[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should expand outputs delta when clicked[32m 39[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should copy trace as JSON[32m 26[2mms[22m[39m
{"level":50,"time":1768063195931,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063195937,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":50,"time":1768063196014,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063196009,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":50,"time":1768063196040,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063196041,"env":"test","workflowId":"b0dda29d-1a38-4127-b205-ae5b86d3f0cc","userId":"d371f2bd-e37f-46e5-926b-0e1247788a52","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":50,"time":1768063196094,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768063196131,"env":"test","module":"user-credentials-repository","userId":"OHx-On5XAHoTpOz12Q0y1","msg":"User credentials created"}
{"level":50,"time":1768063196148,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063196154,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063196185,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should debounce validation calls
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1768063196362,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063196398,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":50,"time":1768063196456,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1768063196455,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1768063196457,"env":"test","module":"user-credentials-repository","userId":"b2a12e49-d96d-488f-a1a5-318c62556fa9","msg":"User credentials created"}
{"level":40,"time":1768063196455,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768063196455,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768063196456,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768063196458,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768063196458,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768063196458,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1768063196466,"env":"test","module":"auth-service","tokenHash":"d5c5be277d2c474407a2bbb94f3223c8f6db1eda5d6ee1e6db7125fcb085b52b","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768063196471,"env":"test","module":"user-credentials-repository","userId":"52c928ae-385b-404d-828f-b5f57790a1c3","msg":"User credentials created"}
stderr | tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/regression-REG-1.test.ts:79:13 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(f92672e1-f96e-4630-9aad-3c62735d81ce) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/regression-REG-1.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 2486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should block Next when required visible question is empty [33m 327[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should NOT block Next when required question is hidden[39m[33m 333[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should block when required becomes visible and is empty [33m 323[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip hidden required page entirely[39m[33m 369[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce required on visible page [33m 444[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should evaluate visibility consistently across modes[39m[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle malformed visibility expression gracefully[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle missing variable in visibility expression[32m 0[2mms[22m[39m
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate helper functions in expressions
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768063196570,"env":"test","module":"email-queue","jobId":"5e05cd2f-dcfa-4929-a05b-f0666a9275e7","to":"session-test-8gwg1zKcCIlFOIq2B67M3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768063196581,"env":"test","module":"mfa-service","userId":"83d9c5c421e2e08660f3ca5e8028d1bc","msg":"No enabled MFA secret found for user"}
{"level":30,"time":1768063196581,"env":"test","module":"email-queue","jobId":"efa11956-7492-487d-81ec-2b7a5ec24a77","to":"protected-test-LP1ZL0ykap6KsqC1fBd3G@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768063196581,"env":"test","module":"auth-routes","userId":"83d9c5c421e2e08660f3ca5e8028d1bc","msg":"MFA verification failed during login"}
{"level":50,"time":1768063196585,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063196598,"env":"test","module":"user-credentials-repository","userId":"611f5a28-1601-4343-9eff-50bd55fed66a","msg":"User credentials created"}
{"level":30,"time":1768063196625,"env":"test","module":"auth-routes","userId":"b2a12e49-d96d-488f-a1a5-318c62556fa9","email":"session-test-8gwg1zKcCIlFOIq2B67M3@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768063196635,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063196637,"env":"test","module":"auth-routes","userId":"52c928ae-385b-404d-828f-b5f57790a1c3","email":"protected-test-LP1ZL0ykap6KsqC1fBd3G@example.com","msg":"User registered"}
{"level":50,"time":1768063196643,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063196719,"env":"test","module":"email-queue","jobId":"0ef4d825-3bce-49f7-aecf-96e0d92fbf8c","to":"middleware-test-sMSKnAEwLqHNKTYsv6FIR@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate complex expressions with multiple helpers
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/integration/metrics.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063196763,"env":"test","error":{},"workflowId":"7f3d4cc4-0eac-46e4-a3f3-4d9c63f07471","userId":"d371f2bd-e37f-46e5-926b-0e1247788a52","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
{"level":30,"time":1768063196778,"env":"test","module":"auth-routes","userId":"611f5a28-1601-4343-9eff-50bd55fed66a","email":"middleware-test-sMSKnAEwLqHNKTYsv6FIR@example.com","msg":"User registered"}
{"level":30,"time":1768063196824,"env":"test","module":"user-credentials-repository","userId":"jH0oiuizd866foZOUuudW","msg":"User credentials created"}
{"level":50,"time":1768063196854,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should handle syntax errors
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1768063196915,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":50,"time":1768063197015,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063197027,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768063197093,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Flow[2m > [22m[2mshould try TOTP before backup code
[22m[39m[TEST UTILS] MFA Secret verified for cff6346f1df4776ecfcbc7cda1147555

{"level":50,"time":1768063197190,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768063197292,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/datavault/TableCard.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063197301,"env":"test","module":"auth-routes","userId":"fe5f4b9f73c4ab28d12a31c1fd0d4d6f","msg":"User logged in successfully"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1768063197344,"env":"test","module":"user-credentials-repository","userId":"nBbg4fjqyW2hGZ4MypiMl","msg":"User credentials created"}
{"level":30,"time":1768063197358,"env":"test","module":"audit-log-service","userId":"fe5f4b9f73c4ab28d12a31c1fd0d4d6f","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063197425,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1768063197425,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768063197427,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1768063197440,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/expression-editor.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 2750[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with null validation result[32m 30[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate expression after debounce[39m[32m 12[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return validation errors for invalid expression[39m[32m 179[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should debounce validation calls[32m 108[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should not validate when workflowId or nodeId is missing[32m 156[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate helper functions in expressions[32m 158[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate complex expressions with multiple helpers[32m 158[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle syntax errors[32m 158[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle empty expressions[32m 3[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update validation when expression changes [33m 405[2mms[22m[39m
{"level":30,"time":1768063197457,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
{"level":30,"time":1768063197470,"env":"test","module":"user-credentials-repository","userId":"15d190b5-765b-48fa-a263-439d41fbca59","msg":"User credentials created"}
{"level":50,"time":1768063197469,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063197497,"env":"test","module":"user-credentials-repository","userId":"5d877bd9-c2c0-4f95-b7a9-6735e2be4f40","msg":"User credentials created"}
{"level":30,"time":1768063197543,"env":"test","module":"user-credentials-repository","userId":"dfab17c1-55a8-473c-9d5e-82bdccee9610","msg":"User credentials created"}
{"level":30,"time":1768063197582,"env":"test","module":"email-queue","jobId":"ff2587e0-a725-4e69-8bf3-41b7f42d3889","to":"protected-test-vwHRZqFvbWGLDPZRNLSEs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063197634,"env":"test","module":"auth-routes","userId":"15d190b5-765b-48fa-a263-439d41fbca59","email":"protected-test-vwHRZqFvbWGLDPZRNLSEs@example.com","msg":"User registered"}
{"level":30,"time":1768063197625,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1768063197625,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1768063197637,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":50,"time":1768063197654,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063197659,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth.flows.real.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 18669[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete registration, verify email, then login[39m[33m 1375[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should lock account after 5 failed attempts, then unlock after waiting[39m[33m 2593[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should record all login attempts[39m[33m 1682[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete MFA setup and login with TOTP[39m[33m 1084[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with backup code when TOTP unavailable[39m[33m 1188[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete full password reset flow[39m[33m 1851[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should invalidate all sessions after password reset [33m 2269[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token on each use[39m[33m 1785[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should detect and prevent refresh token reuse (token theft)[39m[33m 1116[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions[39m[33m 1471[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1722[2mms[22m[39m
{"level":30,"time":1768063197679,"env":"test","module":"email-queue","jobId":"d4b65050-98c0-407f-b5c0-7278601eff57","to":"session-test-_WnCRvwFfd08gSgZJP0Uq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768063197686,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1768063197707,"env":"test","module":"email-queue","jobId":"6f877f49-bc72-41ab-bd60-175f3e40c6b9","to":"middleware-test-NzcMOXmH7BUXyESLPm3ZS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063197737,"env":"test","module":"auth-routes","userId":"5d877bd9-c2c0-4f95-b7a9-6735e2be4f40","email":"session-test-_WnCRvwFfd08gSgZJP0Uq@example.com","msg":"User registered"}
{"level":30,"time":1768063197739,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/metrics.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1763[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should expose /metrics endpoint[39m[32m 233[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should protect /metrics if API key is set[32m 281[2mms[22m[39m
{"level":50,"time":1768063197749,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063197761,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063197765,"env":"test","module":"auth-routes","userId":"dfab17c1-55a8-473c-9d5e-82bdccee9610","email":"middleware-test-NzcMOXmH7BUXyESLPm3ZS@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould require MFA for untrusted device
[22m[39m[TEST UTILS] MFA Secret verified for 12abb1e6b55553cbe3cdf64cb2917e02

{"level":30,"time":1768063197874,"env":"test","module":"mfa-service","userId":"cff6346f1df4776ecfcbc7cda1147555","msg":"TOTP verification successful"}
{"level":30,"time":1768063197928,"env":"test","module":"auth-routes","userId":"cff6346f1df4776ecfcbc7cda1147555","msg":"MFA login successful"}
{"level":50,"time":1768063198023,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063198040,"env":"test","module":"user-credentials-repository","userId":"crNb56bZnGdl_Dmc9cwAl","msg":"User credentials created"}
{"level":30,"time":1768063198063,"env":"test","module":"auth-routes","userId":"422bedf7530884a6f20c0e72b74e7d46","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768063198117,"env":"test","module":"audit-log-service","userId":"422bedf7530884a6f20c0e72b74e7d46","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768063198285,"env":"test","module":"auth-routes","userId":"15d190b5-765b-48fa-a263-439d41fbca59","msg":"User logged in successfully"}
{"level":30,"time":1768063198311,"env":"test","module":"user-credentials-repository","userId":"a1183160-0261-4445-a68e-e639889722e6","msg":"User credentials created"}
{"level":30,"time":1768063198349,"env":"test","module":"audit-log-service","userId":"15d190b5-765b-48fa-a263-439d41fbca59","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063198345,"env":"test","module":"user-credentials-repository","userId":"c7d02972-d277-4a48-aedf-b31a380d1e7d","msg":"User credentials created"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768063198383,"env":"test","module":"auth-routes","userId":"dfab17c1-55a8-473c-9d5e-82bdccee9610","msg":"User logged in successfully"}
{"level":40,"time":1768063198411,"env":"test","module":"tenant-middleware","userId":"15d190b5-765b-48fa-a263-439d41fbca59","path":"/","msg":"User does not have an associated tenant"}
{"level":30,"time":1768063198432,"env":"test","module":"email-queue","jobId":"24a40e2a-a17c-4451-83af-1a8b02bdaae2","to":"test-workflows-z01NwXFLnZdp-z3I_SiP0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063198437,"env":"test","module":"audit-log-service","userId":"dfab17c1-55a8-473c-9d5e-82bdccee9610","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063198443,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063198486,"env":"test","module":"auth-routes","userId":"a1183160-0261-4445-a68e-e639889722e6","email":"test-workflows-z01NwXFLnZdp-z3I_SiP0@example.com","msg":"User registered"}
{"level":30,"time":1768063198493,"env":"test","module":"email-queue","jobId":"bf98588e-c96e-4ef2-ac21-1d2245ae0b9b","to":"user2-NpLrd-Ivxu-iIbVEbhijV@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/ui/datavault/TableCard.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 2036[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render table name and description[39m[32m 154[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render table slug[32m 11[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render table slug[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render column and row counts[32m 13[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should call onClick when card is clicked[32m 20[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should call onDelete when delete button is clicked[39m[33m 427[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should show placeholder when description is missing[32m 10[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should format dates correctly[32m 9[2mms[22m[39m
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768063198552,"env":"test","module":"auth-routes","userId":"c7d02972-d277-4a48-aedf-b31a380d1e7d","email":"user2-NpLrd-Ivxu-iIbVEbhijV@example.com","msg":"User registered"}
{"level":30,"time":1768063198645,"env":"test","module":"auth-routes","userId":"12abb1e6b55553cbe3cdf64cb2917e02","msg":"Login requires MFA verification"}
{"level":30,"time":1768063198652,"env":"test","module":"auth-routes","userId":"422bedf7530884a6f20c0e72b74e7d46","msg":"User logged in successfully"}
{"level":30,"time":1768063198672,"env":"test","module":"user-credentials-repository","userId":"Ux1YIBJSKO9_yVruZvxU3","msg":"User credentials created"}
{"level":30,"time":1768063198706,"env":"test","module":"audit-log-service","userId":"422bedf7530884a6f20c0e72b74e7d46","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063198716,"env":"test","error":{},"workflowId":"c3ec7043-204d-4868-8882-d39a99550156","userId":"a1183160-0261-4445-a68e-e639889722e6","projectId":"c8d98fb1-9341-4fa2-babb-4fd2d7c8fc57","msg":"Error moving workflow"}
{"level":40,"time":1768063198767,"env":"test","module":"mfa-service","userId":"12abb1e6b55553cbe3cdf64cb2917e02","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063198767,"env":"test","module":"auth-routes","userId":"12abb1e6b55553cbe3cdf64cb2917e02","msg":"MFA verification failed during login"}
{"level":50,"time":1768063198773,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768063198782,"env":"test","module":"auth-service","tokenHash":"201f7f703568136d9f589a63f0b1bbb3ef23d28304c8ca782fdd6ee3c004e805","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768063198824,"env":"test","module":"user-credentials-repository","userId":"610f2c77-227a-4627-a5d2-f736ca095339","msg":"User credentials created"}
{"level":30,"time":1768063198868,"env":"test","module":"auth-routes","userId":"422bedf7530884a6f20c0e72b74e7d46","msg":"All other sessions revoked"}
{"level":30,"time":1768063198870,"env":"test","module":"user-credentials-repository","userId":"7ccf3c35-aaf4-4dba-b11b-6e10230a1212","msg":"User credentials created"}
{"level":50,"time":1768063198891,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063198921,"env":"test","module":"audit-log-service","userId":"422bedf7530884a6f20c0e72b74e7d46","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1768063198928,"env":"test","module":"email-queue","jobId":"1c0da6fe-7a5c-4bad-a6d6-280f7ac05185","to":"protected-test-t7oIf03FYrOVhu9b15vyP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768063198974,"env":"test","module":"email-queue","jobId":"bf3d6864-af86-459c-8992-18c4279f1c51","to":"middleware-test-Vx5Xr4q0D--7XxsUGX_b-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063198981,"env":"test","module":"auth-routes","userId":"610f2c77-227a-4627-a5d2-f736ca095339","email":"protected-test-t7oIf03FYrOVhu9b15vyP@example.com","msg":"User registered"}
{"level":50,"time":1768063199017,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063199024,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063199026,"env":"test","module":"auth-routes","userId":"7ccf3c35-aaf4-4dba-b11b-6e10230a1212","email":"middleware-test-Vx5Xr4q0D--7XxsUGX_b-@example.com","msg":"User registered"}
{"level":50,"time":1768063199037,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":40,"time":1768063199085,"env":"test","module":"auth-service","tokenHash":"337cb158aaa6cf29ca430bc0953387228356ca0370ff9170638f823073a6cc00","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1768063199153,"env":"test","module":"user-credentials-repository","userId":"bSVLPOIqm0pdPDekW94Is","msg":"User credentials created"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/workflow_versioning.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":50,"time":1768063199277,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"3b5eac6d-0fd2-4d66-adfc-27ba8fdff782","userId":"d371f2bd-e37f-46e5-926b-0e1247788a52","projectId":"invalid-uuid","msg":"Error moving workflow"}
{"level":30,"time":1768063199340,"env":"test","module":"user-credentials-repository","userId":"c88871e4-4174-4bb6-b1a3-ef9a42e91de9","msg":"User credentials created"}
{"level":50,"time":1768063199341,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063199348,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768063199457,"env":"test","module":"email-queue","jobId":"122569ae-83dc-412e-9b0f-c809d0f6a72f","to":"session-test-D8E-AM00mdk95B4pHS5Mk@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
stderr | tests/integration/datavault.permissions.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063199516,"env":"test","module":"auth-routes","userId":"c88871e4-4174-4bb6-b1a3-ef9a42e91de9","email":"session-test-D8E-AM00mdk95B4pHS5Mk@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.token-refresh.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 20543[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token with valid refresh token[39m[33m 672[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token after use[39m[33m 660[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when refresh token is missing [33m 465[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid refresh token [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for expired refresh token [33m 503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for revoked refresh token [33m 494[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when user is not found[39m[33m 500[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update refresh token metadata on rotation[39m[33m 751[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle concurrent refresh token requests (token reuse detection) [33m 635[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set secure cookie in production [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set proper cookie attributes [33m 643[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include user role information in response[39m[33m 602[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create refresh token on login[39m[33m 651[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke refresh token on logout[39m[33m 508[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle logout without refresh token gracefully [33m 389[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support multiple active refresh tokens per user [33m 609[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all user tokens on password reset [33m 648[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use cryptographically strong random tokens [33m 5785[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should hash refresh tokens before storing in database [33m 571[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent refresh token reuse after rotation [33m 748[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate token ownership[39m[33m 513[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set HttpOnly flag to prevent XSS [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set SameSite=Strict to prevent CSRF [33m 693[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set proper cookie path [33m 469[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set appropriate expiry (30 days) [33m 653[2mms[22m[39m
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/ai/workflowEdit.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063199593,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063199764,"env":"test","module":"user-credentials-repository","userId":"59821a17-6f19-49de-9d24-21fe9e90fa20","msg":"User credentials created"}
{"level":30,"time":1768063199791,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063199820,"env":"test","module":"user-credentials-repository","userId":"1fdabfa4-b5b6-4d72-bff2-5e5ea6ffdcff","msg":"User credentials created"}
{"level":50,"time":1768063199860,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"3387e817-022e-47f5-9080-e1cf56c9227f","userId":"d371f2bd-e37f-46e5-926b-0e1247788a52","msg":"Error moving workflow"}
{"level":30,"time":1768063199872,"env":"test","module":"email-queue","jobId":"79309718-a73b-4a16-8ed6-a5f49d4043de","to":"middleware-test-_uq-NAPkp4zNMJbMMO7ju@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063199914,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063199928,"env":"test","module":"email-queue","jobId":"041cd7c6-88e9-4948-a8ae-3ee3a797b7af","to":"protected-test-My99GV6r8QZdUnL2LJIYd@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063199931,"env":"test","module":"auth-routes","userId":"59821a17-6f19-49de-9d24-21fe9e90fa20","email":"middleware-test-_uq-NAPkp4zNMJbMMO7ju@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts[2m > [22m[2mTrusted Devices Integration Tests (REAL)[2m > [22m[2mDevice Trust with MFA Login[2m > [22m[2mshould update lastUsedAt on trusted device login
[22m[39m[TEST UTILS] MFA Secret verified for bb3b5332de442750808aeea2c5b5c579

{"level":30,"time":1768063199979,"env":"test","module":"auth-routes","userId":"1fdabfa4-b5b6-4d72-bff2-5e5ea6ffdcff","email":"protected-test-My99GV6r8QZdUnL2LJIYd@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Status[2m > [22m[2mshould return backup codes count for MFA users
[22m[39m[TEST UTILS] MFA Secret verified for 02bd911becac962ba55af22dc0d582a9

{"level":50,"time":1768063200184,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063200188,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":50,"time":1768063200251,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/workflow_versioning.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1068[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should diff two versions correctly[32m 2[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should create a version and populate changelog[39m[32m 5[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should track execution lineage via snapshot[39m[32m 55[2mms[22m[39m
{"level":50,"time":1768063200351,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063200397,"env":"test","module":"user-credentials-repository","userId":"8d8ec37b-f8ad-4684-b054-2823f1fdf247","msg":"User credentials created"}
{"level":50,"time":1768063200410,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200431,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200439,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200447,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200473,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200482,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200499,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063200508,"env":"test","module":"email-queue","jobId":"5d0cfb68-6a32-439e-b7d6-3bfb1a72ab16","to":"session-test-PmftwEgsrXL516u7ufFQA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063200552,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200556,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063200559,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063200564,"env":"test","module":"auth-routes","userId":"8d8ec37b-f8ad-4684-b054-2823f1fdf247","email":"session-test-PmftwEgsrXL516u7ufFQA@example.com","msg":"User registered"}
{"level":50,"time":1768063200573,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200582,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200588,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200593,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1768063200601,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/ai/workflowEdit.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 1021[2mms[22m[39m
     [2m[90mÎ“Ã¥Ã´[39m[22m should create draft version on successful AI edit
     [2m[90mÎ“Ã¥Ã´[39m[22m should enforce draft mode (revert active workflow to draft)
     [2m[90mÎ“Ã¥Ã´[39m[22m should not create version when no changes detected (checksum match)
     [2m[90mÎ“Ã¥Ã´[39m[22m should reject unauthorized access
     [2m[90mÎ“Ã¥Ã´[39m[22m should reject unsafe DataVault operations
     [2m[90mÎ“Ã¥Ã´[39m[22m should handle multi-operation edits with tempId resolution
     [2m[90mÎ“Ã¥Ã´[39m[22m should create BEFORE and AFTER snapshots
     [2m[90mÎ“Ã¥Ã´[39m[22m should rollback on validation failure
{"level":50,"time":1768063200604,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/analytics_service.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063200611,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768063200669,"env":"test","module":"mfa-service","userId":"bb3b5332de442750808aeea2c5b5c579","msg":"No enabled MFA secret found for user"}
{"level":50,"time":1768063200671,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768063200669,"env":"test","module":"auth-routes","userId":"bb3b5332de442750808aeea2c5b5c579","msg":"MFA verification failed during login"}
{"level":50,"time":1768063200673,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063200675,"env":"test","module":"user-credentials-repository","userId":"7ba027ae-7045-4c98-8783-175a5f76c9c0","msg":"User credentials created"}
{"level":50,"time":1768063200676,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/trusted.devices.real.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 21759[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should trust current device[39m[33m 1675[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set trust expiry to 30 days[39m[33m 1676[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update expiry if device already trusted[39m[33m 897[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 403[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all trusted devices[39m[33m 2272[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current device[39m[33m 879[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude revoked devices[39m[33m 1862[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude expired devices[39m[33m 1656[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific device[39m[33m 1559[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent device[39m[33m 1648[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking other user's device[39m[33m 925[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip MFA for trusted device[39m[33m 1908[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require MFA for untrusted device[39m[33m 2183[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update lastUsedAt on trusted device login[39m[33m 1695[2mms[22m[39m
{"level":50,"time":1768063200738,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063200784,"env":"test","module":"email-queue","jobId":"e4897ebe-0042-43b2-9268-81411524e0f1","to":"middleware-test-PoCleALe2w-0-0Eo6WCHL@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063200784,"env":"test","module":"user-credentials-repository","userId":"32b6da9d-418e-4314-93f1-1d91c3d169b0","msg":"User credentials created"}
{"level":50,"time":1768063200799,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200805,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200811,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063200816,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063200819,"env":"test","module":"user-credentials-repository","userId":"95574b41-d81e-4d1c-985e-129f4e91c30b","msg":"User credentials created"}
{"level":30,"time":1768063200836,"env":"test","module":"auth-routes","userId":"7ba027ae-7045-4c98-8783-175a5f76c9c0","email":"middleware-test-PoCleALe2w-0-0Eo6WCHL@example.com","msg":"User registered"}
{"level":30,"time":1768063200889,"env":"test","module":"email-queue","jobId":"796d5468-30c5-4fe9-a4b3-579201e233ed","to":"protected-test-aUB_1vBKZxsdQ1qAntdHj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/portal.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1768063200934,"env":"test","module":"email-queue","jobId":"f1d2e5a2-13ed-4672-a505-a40eedeb5a99","to":"test-workflows-h6qHiIvMhW9sQZkNIkdrI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063200945,"env":"test","module":"auth-routes","userId":"32b6da9d-418e-4314-93f1-1d91c3d169b0","email":"protected-test-aUB_1vBKZxsdQ1qAntdHj@example.com","msg":"User registered"}
{"level":50,"time":1768063200974,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063200987,"env":"test","module":"auth-routes","userId":"95574b41-d81e-4d1c-985e-129f4e91c30b","email":"test-workflows-h6qHiIvMhW9sQZkNIkdrI@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault.permissions.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m22 failed[39m[2m)[22m[33m 1596[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to read table[39m[32m 30[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow writer to read table[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow reader to read table[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny non-member from reading table[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to update table[39m[32m 28[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from updating table[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from updating table[39m[32m 64[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from deleting table[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from deleting table[39m[32m 12[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny non-member from deleting table[39m[32m 10[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to view permissions[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from viewing permissions[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from viewing permissions[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to grant permissions[39m[32m 10[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to update existing permission (upsert)[39m[32m 59[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from granting permissions[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent modifying table owner permissions[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to revoke permissions[39m[32m 62[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from revoking permissions[39m[32m 61[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce owner includes write and read[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce write includes read but not owner[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce read is read-only[39m[32m 5[2mms[22m[39m
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":50,"time":1768063201321,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063201323,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":50,"time":1768063201324,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:29:5 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(d371f2bd-e37f-46e5-926b-0e1247788a52) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768063201399,"env":"test","module":"auth-routes","userId":"fbc36b54dcc478e0a30d19a3b1abcccf","msg":"User logged in successfully"}
 [31mÎ“Â¥Â»[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 15773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 394[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 707[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 549[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 559[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 931[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 890[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 808[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 967[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 1359[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 1192[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 665[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 529[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 1425[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 560[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 584[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject move to project user does not have access to[39m[33m 1461[2mms[22m[39m
{"level":30,"time":1768063201431,"env":"test","module":"user-credentials-repository","userId":"eed8253b-935f-4918-8fe5-cc68d8f3d9ad","msg":"User credentials created"}
{"level":30,"time":1768063201447,"env":"test","module":"auth-routes","userId":"7ba027ae-7045-4c98-8783-175a5f76c9c0","msg":"User logged in successfully"}
{"level":30,"time":1768063201454,"env":"test","module":"audit-log-service","userId":"fbc36b54dcc478e0a30d19a3b1abcccf","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063201498,"env":"test","module":"audit-log-service","userId":"7ba027ae-7045-4c98-8783-175a5f76c9c0","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/analytics_service.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 910[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should generate events and metrics on run completion[39m[32m 57[2mms[22m[39m
{"level":30,"time":1768063201543,"env":"test","module":"email-queue","jobId":"c1cd5ee0-6733-4bdb-9704-d152113e6119","to":"session-test-WpEc5BeYQ5PbtNhpUQ983@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768063201599,"env":"test","module":"auth-routes","userId":"eed8253b-935f-4918-8fe5-cc68d8f3d9ad","email":"session-test-WpEc5BeYQ5PbtNhpUQ983@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1768063201749,"env":"test","module":"user-credentials-repository","userId":"09dcb333-ee20-4883-a800-63a786bbe77e","msg":"User credentials created"}
{"level":30,"time":1768063201853,"env":"test","module":"email-queue","jobId":"2bd4c293-0e32-4950-8a5f-2ff1bc9c02b1","to":"protected-test-wq2-EQBJNai9BBRjpwLWl@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063201907,"env":"test","module":"auth-routes","userId":"09dcb333-ee20-4883-a800-63a786bbe77e","email":"protected-test-wq2-EQBJNai9BBRjpwLWl@example.com","msg":"User registered"}
{"level":50,"time":1768063202017,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063202050,"env":"test","module":"intake-service","runId":"1986d929-30cf-4a19-b0d7-84891120b614","slug":"hybrid-cookie-nEHq2Vv2cZtvIi6nLKz9Y","msg":"Created intake run"}
{"level":30,"time":1768063202044,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":50,"time":1768063202285,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/WorkflowTemplateService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063202464,"env":"test","module":"user-credentials-repository","userId":"422144eb-f257-4a4c-b864-f6dd58e3e54f","msg":"User credentials created"}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768063202531,"env":"test","module":"user-credentials-repository","userId":"75bfff61-822c-4e9e-a2a8-e2cb4c184c3b","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/organizationInvites.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063202578,"env":"test","module":"email-queue","jobId":"873a18da-2a3c-40a5-89d9-37a76bab775d","to":"session-test-Nkg9hwdwtghdgLbxZP6ZD@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063202633,"env":"test","module":"email-queue","jobId":"0889ae01-185b-423f-ad5e-7efab49c0507","to":"middleware-test-XfBTIi-vaYl1Bqe-vZGnt@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063202635,"env":"test","module":"auth-routes","userId":"422144eb-f257-4a4c-b864-f6dd58e3e54f","email":"session-test-Nkg9hwdwtghdgLbxZP6ZD@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mMFA Disable Flow[2m > [22m[2mshould require correct password to disable MFA
[22m[39m[TEST UTILS] MFA Secret verified for 30b41ada32b798063eadc64532918223

{"level":30,"time":1768063202684,"env":"test","module":"auth-routes","userId":"75bfff61-822c-4e9e-a2a8-e2cb4c184c3b","email":"middleware-test-XfBTIi-vaYl1Bqe-vZGnt@example.com","msg":"User registered"}
{"level":30,"time":1768063202745,"env":"test","module":"auth-routes","userId":"5afbe9522cf2e63deb0ed169eb96c0e6","msg":"User logged in successfully"}
{"level":50,"time":1768063202752,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063202758,"env":"test","module":"user-credentials-repository","userId":"afef8563-0892-4e74-a2f9-103d3d868da6","msg":"User credentials created"}
{"level":30,"time":1768063202797,"env":"test","module":"audit-log-service","userId":"5afbe9522cf2e63deb0ed169eb96c0e6","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063202868,"env":"test","module":"email-queue","jobId":"3357ac30-5b59-4141-a407-f617bfab6fed","to":"protected-test-e0xyqVJFX3JDBIvWn5qK2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063202922,"env":"test","module":"auth-routes","userId":"afef8563-0892-4e74-a2f9-103d3d868da6","email":"protected-test-e0xyqVJFX3JDBIvWn5qK2@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/transferOwnership.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063202960,"env":"test","module":"auth-routes","userId":"5afbe9522cf2e63deb0ed169eb96c0e6","msg":"All other sessions revoked"}
{"level":30,"time":1768063203013,"env":"test","module":"audit-log-service","userId":"5afbe9522cf2e63deb0ed169eb96c0e6","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768063203122,"env":"test","module":"auth-routes","userId":"5afbe9522cf2e63deb0ed169eb96c0e6","sessionCount":0,"msg":"Listed active sessions"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/repositories/WorkflowTemplateRepository.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":50,"time":1768063203193,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063203203,"env":"test","module":"user-credentials-repository","userId":"0bb71029-3ae3-4840-a339-dc35c114cf05","msg":"User credentials created"}
{"level":50,"time":1768063203287,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063203293,"env":"test","module":"auth-routes","userId":"75bfff61-822c-4e9e-a2a8-e2cb4c184c3b","msg":"User logged in successfully"}
{"level":40,"time":1768063203303,"env":"test","module":"mfa-service","userId":"30b41ada32b798063eadc64532918223","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063203303,"env":"test","module":"auth-routes","userId":"30b41ada32b798063eadc64532918223","msg":"MFA verification failed during login"}
{"level":50,"time":1768063203313,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063203315,"env":"test","module":"email-queue","jobId":"f7406f3c-7df9-48af-a8b8-1c710eb49307","to":"session-test-i8ZSJErtZEa4uztWb3xfy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063203344,"env":"test","module":"audit-log-service","userId":"75bfff61-822c-4e9e-a2a8-e2cb4c184c3b","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/organizationService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063203372,"env":"test","module":"auth-routes","userId":"0bb71029-3ae3-4840-a339-dc35c114cf05","email":"session-test-i8ZSJErtZEa4uztWb3xfy@example.com","msg":"User registered"}
{"level":30,"time":1768063203487,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063203707,"env":"test","module":"user-credentials-repository","userId":"1acd1efc-6235-4429-92fc-d701ca56ebf2","msg":"User credentials created"}
{"level":50,"time":1768063203762,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063203811,"env":"test","module":"email-queue","jobId":"6891d8cc-78b3-455a-b835-91c48896445c","to":"protected-test-18Fch1n020GySOpRrfJ-O@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063203868,"env":"test","module":"auth-routes","userId":"1acd1efc-6235-4429-92fc-d701ca56ebf2","email":"protected-test-18Fch1n020GySOpRrfJ-O@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.snapshots.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063203887,"env":"test","module":"intake-service","runId":"2a915061-1943-4da2-8721-a3c01bf95df7","slug":"hybrid-anon-7kFP_V3NNN7dp4iIt3tDF","msg":"Created intake run"}
{"level":30,"time":1768063204175,"env":"test","module":"user-credentials-repository","userId":"0a1f29c1-0419-455a-aabe-057a42fe8741","msg":"User credentials created"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts[2m > [22m[2mMFA Flow Integration Tests (REAL)[2m > [22m[2mBackup Code Regeneration[2m > [22m[2mshould regenerate backup codes
[22m[39m[TEST UTILS] MFA Secret verified for c98ded2618d607192388f925c7c1c7f2

{"level":50,"time":1768063204243,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063204285,"env":"test","module":"email-queue","jobId":"1ba384ca-7819-4ddd-8a94-e5bb9ab4d89e","to":"session-test-sJ3rfnEoOGUovgFLZQpSG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063204299,"env":"test","module":"auth-routes","userId":"c14ebec2f19b2899cbbda2292e81130a","msg":"User logged in successfully"}
{"level":30,"time":1768063204320,"env":"test","module":"email-queue","jobId":"9714b63f-0abd-4da4-9515-144cff12dbc9","to":"newuser_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768063204338,"env":"test","module":"user-credentials-repository","userId":"582ee496-ab43-43f9-b812-8ff3a60ba8c2","msg":"User credentials created"}
{"level":30,"time":1768063204340,"env":"test","module":"auth-routes","userId":"0a1f29c1-0419-455a-aabe-057a42fe8741","email":"session-test-sJ3rfnEoOGUovgFLZQpSG@example.com","msg":"User registered"}
{"level":30,"time":1768063204352,"env":"test","module":"audit-log-service","userId":"c14ebec2f19b2899cbbda2292e81130a","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063204360,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063204375,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts[2m > [22m[2mStage 13: Workflow Snapshots & Versioning
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063204367,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063204367,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063204370,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063204374,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063204374,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063204375,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063204375,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768063204446,"env":"test","module":"email-queue","jobId":"9018de75-1ef7-413f-aa6c-e2ae8037968f","to":"middleware-test-f8LQlsf58zcV2ppeywN2e@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063204445,"env":"test","module":"auth-routes","userId":"ba82be5275fcc1db0885434e01a1ceb9","msg":"User logged in successfully"}
{"level":30,"time":1768063204498,"env":"test","module":"auth-routes","userId":"582ee496-ab43-43f9-b812-8ff3a60ba8c2","email":"middleware-test-f8LQlsf58zcV2ppeywN2e@example.com","msg":"User registered"}
{"level":30,"time":1768063204498,"env":"test","module":"audit-log-service","userId":"ba82be5275fcc1db0885434e01a1ceb9","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063204617,"env":"test","module":"auth-routes","userId":"ba82be5275fcc1db0885434e01a1ceb9","sessionCount":1,"msg":"Listed active sessions"}
{"level":40,"time":1768063204633,"env":"test","module":"auth-service","userId":"c14ebec2f19b2899cbbda2292e81130a","tokenHash":"7967e00a3fe2d2dfbbf8cd44a43dc5ffcfe04f66f60a81c8adf1cc04ef2e7232","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":30,"time":1768063204649,"env":"test","module":"user-credentials-repository","userId":"0acf5bb8-0012-440c-b91c-9e17b4da1440","msg":"User credentials created"}
{"level":30,"time":1768063204752,"env":"test","module":"email-queue","jobId":"ac8d7965-766e-4fb5-9f4e-5958bd6a2126","to":"protected-test-lyFVhUgh09To0zdDYuJv-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063204804,"env":"test","module":"auth-routes","userId":"0acf5bb8-0012-440c-b91c-9e17b4da1440","email":"protected-test-lyFVhUgh09To0zdDYuJv-@example.com","msg":"User registered"}
{"level":50,"time":1768063204864,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063204860,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.snapshots.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1109[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should maintain immutability of runs across versions[39m[32m 290[2mms[22m[39m
{"level":30,"time":1768063205049,"env":"test","module":"auth-routes","userId":"c98ded2618d607192388f925c7c1c7f2","msg":"Login requires MFA verification"}
{"level":30,"time":1768063205050,"env":"test","module":"auth-routes","userId":"0a1f29c1-0419-455a-aabe-057a42fe8741","msg":"User logged in successfully"}
{"level":30,"time":1768063205075,"env":"test","module":"auth-routes","userId":"582ee496-ab43-43f9-b812-8ff3a60ba8c2","msg":"User logged in successfully"}
{"level":30,"time":1768063205116,"env":"test","module":"audit-log-service","userId":"0a1f29c1-0419-455a-aabe-057a42fe8741","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063205128,"env":"test","module":"audit-log-service","userId":"582ee496-ab43-43f9-b812-8ff3a60ba8c2","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063205136,"env":"test","module":"auth-routes","userId":"0a1f29c1-0419-455a-aabe-057a42fe8741","msg":"User logged in successfully"}
{"level":40,"time":1768063205159,"env":"test","module":"mfa-service","userId":"c98ded2618d607192388f925c7c1c7f2","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1768063205159,"env":"test","module":"auth-routes","userId":"c98ded2618d607192388f925c7c1c7f2","msg":"MFA verification failed during login"}
{"level":50,"time":1768063205165,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063205169,"env":"test","module":"auth-routes","userId":"0a1f29c1-0419-455a-aabe-057a42fe8741","msg":"User logged in successfully"}
{"level":50,"time":1768063205177,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063205191,"env":"test","module":"audit-log-service","userId":"0a1f29c1-0419-455a-aabe-057a42fe8741","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063205230,"env":"test","module":"audit-log-service","userId":"0a1f29c1-0419-455a-aabe-057a42fe8741","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768063205598,"env":"test","module":"user-credentials-repository","userId":"1ebde565-41d6-4eb1-83d6-167c19d48d18","msg":"User credentials created"}
{"level":30,"time":1768063205652,"env":"test","module":"intake-service","runId":"6df4d445-3716-4ce7-9104-5158285a7a57","slug":"hybrid-invalid-OzW4hzM5-RuTabFxuDRdG","msg":"Created intake run"}
{"level":30,"time":1768063205706,"env":"test","module":"email-queue","jobId":"e4a2a9c2-efca-468c-b285-46e29e9c2e27","to":"protected-test-KwUI9f-trhu_CwzA0mC9g@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1768063205710,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063205716,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063205726,"env":"test","module":"user-credentials-repository","userId":"cbc0f927-06dc-4beb-bbdf-a9b4deb04228","msg":"User credentials created"}
{"level":30,"time":1768063205731,"env":"test","module":"email-queue","jobId":"e50f15ef-1414-4f35-914d-86f4499b3ae9","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768063205757,"env":"test","module":"auth-routes","userId":"1ebde565-41d6-4eb1-83d6-167c19d48d18","email":"protected-test-KwUI9f-trhu_CwzA0mC9g@example.com","msg":"User registered"}
{"level":30,"time":1768063205832,"env":"test","module":"email-queue","jobId":"f02bf067-a8c5-42a0-9ace-c4e2320948e0","to":"session-test-lNWVTFlaTzRKdELEupLeu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/js_helpers.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063205890,"env":"test","module":"auth-routes","userId":"cbc0f927-06dc-4beb-bbdf-a9b4deb04228","email":"session-test-lNWVTFlaTzRKdELEupLeu@example.com","msg":"User registered"}
{"level":30,"time":1768063206062,"env":"test","module":"user-credentials-repository","userId":"de3bc938-5192-4a9f-9bae-649c07a142f3","msg":"User credentials created"}
{"level":30,"time":1768063206167,"env":"test","module":"email-queue","jobId":"655e84fc-f747-45d1-8a36-cbd0779a8164","to":"middleware-test-wGU_ngg8q5f0UbInU047h@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063206184,"env":"test","module":"email-queue","jobId":"e1ba41c9-a733-4cd3-9678-b58d32b6707a","to":"test-1768063205558-jp92si@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063206184,"env":"test","module":"auth-service","email":"test-1768063205558-jp92si@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768063206220,"env":"test","module":"auth-routes","userId":"de3bc938-5192-4a9f-9bae-649c07a142f3","email":"middleware-test-wGU_ngg8q5f0UbInU047h@example.com","msg":"User registered"}
{"level":50,"time":1768063206255,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":50,"time":1768063206260,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063206290,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/session.management.integration.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[33m 20748[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create refresh token on login[39m[33m 954[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track device metadata in session [33m 1417[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create separate sessions for multiple device logins[39m[33m 986[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions for user[39m[33m 959[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current session correctly[39m[33m 948[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not include revoked sessions[39m[33m 1000[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should order sessions by last used (most recent first)[39m[33m 999[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 709[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1124[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 1013[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow revoking other users sessions[39m[33m 1865[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent session ID[39m[33m 1024[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all sessions except current[39m[33m 1058[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all trusted devices[39m[33m 1043[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require active session [33m 734[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject refresh token after 30 days[39m[33m 1011[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle multiple concurrent logins [33m 1521[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle concurrent token refreshes[39m[33m 1008[2mms[22m[39m
{"level":30,"time":1768063206360,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063206384,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/js_helpers.test.ts[2m > [22m[2mDetailed Verification: JS Helper Availability
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063206368,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063206368,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063206376,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063206383,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063206383,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063206383,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063206383,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768063206410,"env":"test","module":"auth-routes","userId":"1ebde565-41d6-4eb1-83d6-167c19d48d18","msg":"User logged in successfully"}
{"level":30,"time":1768063206463,"env":"test","module":"audit-log-service","userId":"1ebde565-41d6-4eb1-83d6-167c19d48d18","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063206471,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/PdfQueueService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063206572,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063206714,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/js_helpers.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 869[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should execute a JS block that uses helper functions[39m[32m 125[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.ai.doc.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063206806,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063206810,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/session.management.real.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 27831[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions for current user[39m[33m 2056[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current session correctly[39m[33m 1346[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude revoked sessions[39m[33m 1395[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should order sessions by last used (most recent first)[39m[33m 1770[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter sessions by current user only[39m[33m 2003[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 420[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1389[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 1058[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent session [33m 1444[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking other user's session[39m[33m 1714[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all other sessions[39m[33m 1969[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should keep current session active[39m[33m 2451[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 400 if no active session found[39m[33m 1102[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all trusted devices[39m[33m 1135[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle user with single session gracefully[39m[33m 1800[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should include device metadata in sessions [33m 1494[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not expose sensitive token data[39m[33m 1099[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track session activity timestamps[39m[33m 1094[2mms[22m[39m
{"level":30,"time":1768063206886,"env":"test","module":"user-credentials-repository","userId":"9e2065c4-dc3a-4ec7-ae9b-9e61cc3b956a","msg":"User credentials created"}
{"level":30,"time":1768063206989,"env":"test","module":"email-queue","jobId":"46a8e31e-8600-4064-97c4-fc42e7bed690","to":"protected-test-y6k_JuFT2wkwhpq-x_GZn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063207017,"env":"test","module":"user-credentials-repository","userId":"b085927d-b353-42a0-ace2-1d0a0cda920d","msg":"User credentials created"}
{"level":30,"time":1768063207039,"env":"test","module":"auth-routes","userId":"9e2065c4-dc3a-4ec7-ae9b-9e61cc3b956a","email":"protected-test-y6k_JuFT2wkwhpq-x_GZn@example.com","msg":"User registered"}
{"level":30,"time":1768063207121,"env":"test","module":"email-queue","jobId":"1110886d-57d1-4369-9641-a504be344633","to":"middleware-test-gf2aWzy_kqk0cZOFlaGQP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768063207175,"env":"test","module":"auth-routes","userId":"b085927d-b353-42a0-ace2-1d0a0cda920d","email":"middleware-test-gf2aWzy_kqk0cZOFlaGQP@example.com","msg":"User registered"}
{"level":30,"time":1768063207182,"env":"test","module":"email-queue","jobId":"cc0b167e-1b9d-4fa8-a3e0-fd687d709d7b","to":"newuser_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768063207261,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063207280,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063207270,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063207270,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063207275,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063207280,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063207280,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063207280,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063207280,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests[2m > [22m[2mPOST /api/ai/doc/analyze[2m > [22m[2mshould analyze a DOCX file and return variables
[22m[39mFAIL_STATUS: 500
FAIL_BODY: {}

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.ai.doc.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 624[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should analyze a DOCX file and return variables[39m[32m 52[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fail if no file is provided[39m[32m 14[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should suggest mappings between template and workflow variables[32m 38[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return improvement suggestions[32m 14[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1768063207420,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":50,"time":1768063207488,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063207776,"env":"test","module":"auth-routes","userId":"474a691a462a76a67194b1783f960e46","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/mfa.flow.real.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 28861[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete full MFA setup flow[39m[33m 2055[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject invalid TOTP code during setup[39m[33m 1111[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow MFA setup if already enabled[39m[33m 1489[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should generate unique backup codes [33m 1784[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should store hashed backup codes[39m[33m 1095[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require MFA for enabled users[39m[33m 1520[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete MFA login with valid TOTP[39m[33m 936[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid TOTP during login [33m 1569[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept TOTP codes within 60-second window[39m[33m 1544[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with valid backup code[39m[33m 1220[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark backup code as used [33m 1277[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent backup code reuse[39m[33m 1177[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should try TOTP before backup code [33m 1674[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return MFA status for user[39m[33m 1096[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return backup codes count for MFA users[39m[33m 1629[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should disable MFA with password verification[39m[33m 979[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require correct password to disable MFA[39m[33m 1682[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should regenerate backup codes[39m[33m 1851[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return error if MFA not enabled[39m[33m 1096[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce MFA for tenant users when required by tenant [33m 1572[2mms[22m[39m
{"level":30,"time":1768063207838,"env":"test","module":"user-credentials-repository","userId":"ae42d26a-2cf9-4bd8-b29e-da59e548c15e","msg":"User credentials created"}
{"level":30,"time":1768063207913,"env":"test","module":"user-credentials-repository","userId":"d8f14b4c-6a5e-49cd-8de9-3caef1c2f03d","msg":"User credentials created"}
{"level":30,"time":1768063207939,"env":"test","module":"email-queue","jobId":"5421a34e-8803-4116-9d8f-c2012915b1d5","to":"protected-test-jo1ZdX-Rse5axgphg28NQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063207987,"env":"test","module":"auth-routes","userId":"ae42d26a-2cf9-4bd8-b29e-da59e548c15e","email":"protected-test-jo1ZdX-Rse5axgphg28NQ@example.com","msg":"User registered"}
{"level":30,"time":1768063208022,"env":"test","module":"email-queue","jobId":"0c0012d7-4796-4003-ae9f-f508e5239ad5","to":"middleware-test-9qwpD7fdTbKQ0PYY3_MMb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768063208074,"env":"test","module":"auth-routes","userId":"d8f14b4c-6a5e-49cd-8de9-3caef1c2f03d","email":"middleware-test-9qwpD7fdTbKQ0PYY3_MMb@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/docxRenderer.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":50,"time":1768063208349,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063208398,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/datavault.autonumber.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063208569,"env":"test","module":"email-queue","jobId":"1efbf696-a551-4c3d-853b-2f9ebe413b55","to":"test-1768063207927-jtiowj@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063208569,"env":"test","module":"auth-service","email":"test-1768063207927-jtiowj@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/datavault-v4-regression.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1768063208764,"env":"test","module":"user-credentials-repository","userId":"d10786cc-c8a0-44f5-a383-41c046ffda65","msg":"User credentials created"}
{"level":30,"time":1768063208793,"env":"test","module":"user-credentials-repository","userId":"483801f8-d74e-4f13-b26e-a1873eb4b5ac","msg":"User credentials created"}
{"level":30,"time":1768063208869,"env":"test","module":"email-queue","jobId":"63358f72-ae8a-434a-ac14-fca90b6c7794","to":"protected-test-uihvAhsmAxr54YMyp92CQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063208903,"env":"test","module":"email-queue","jobId":"6a64b431-685f-46ac-9b8d-d0bceb237021","to":"middleware-test-ZOgBv9Nw_-sWgOR2J1g5P@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063208923,"env":"test","module":"auth-routes","userId":"d10786cc-c8a0-44f5-a383-41c046ffda65","email":"protected-test-uihvAhsmAxr54YMyp92CQ@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/engine/templateNode.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063208954,"env":"test","module":"auth-routes","userId":"483801f8-d74e-4f13-b26e-a1873eb4b5ac","email":"middleware-test-ZOgBv9Nw_-sWgOR2J1g5P@example.com","msg":"User registered"}
{"level":30,"time":1768063208997,"env":"test","module":"user-credentials-repository","userId":"41bdae774201adc8125027e70078e30c","msg":"User password updated"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/organizations-workflow.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063209137,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063209152,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063209143,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063209144,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063209148,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063209152,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063209152,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063209152,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063209152,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1768063209167,"env":"test","module":"audit-log-service","userId":"41bdae774201adc8125027e70078e30c","eventType":"password_reset","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/AuthService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063209495,"env":"test","module":"auth-routes","userId":"483801f8-d74e-4f13-b26e-a1873eb4b5ac","msg":"User logged in successfully"}
{"level":30,"time":1768063209496,"env":"test","module":"auth-routes","userId":"d10786cc-c8a0-44f5-a383-41c046ffda65","msg":"User logged in successfully"}
{"level":30,"time":1768063209547,"env":"test","module":"audit-log-service","userId":"d10786cc-c8a0-44f5-a383-41c046ffda65","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063209548,"env":"test","module":"audit-log-service","userId":"483801f8-d74e-4f13-b26e-a1873eb4b5ac","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063209553,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063209551,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6ImE3MTM0YjA2LThkMDMtNDcxZC04NzdiLTUwM2U1YTQ3MjI1NCIsInJvbGUiOiJhZG1pbiIsInRlbmFudFJvbGUiOiJvd25lciIsImlhdCI6MTc2ODA2MzIwOSwiZXhwIjoxNzY4MDY0MTA5fQ.jZOxucQAleY7zKKROkz6fJjseAnNQ2EyeRtoha-_tvY",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": null,
    "lastName": null,
    "profileImageUrl": null,
    "tenantId": "a7134b06-8d03-471d-877b-503e5a472254",
    "role": "admin",
    "tenantRole": "owner"
  }
}

{"level":30,"time":1768063209659,"env":"test","module":"auth-routes","userId":"41bdae774201adc8125027e70078e30c","msg":"User logged in successfully"}
{"level":30,"time":1768063209709,"env":"test","module":"audit-log-service","userId":"41bdae774201adc8125027e70078e30c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063209776,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768063209930,"env":"test","module":"user-credentials-repository","userId":"b370b576-63f3-4a9d-afba-df85f9dbbda2","msg":"User credentials created"}
{"level":30,"time":1768063210032,"env":"test","module":"user-credentials-repository","userId":"cd0af9b9-f816-433e-841f-89307962b623","msg":"User credentials created"}
{"level":30,"time":1768063210032,"env":"test","module":"email-queue","jobId":"f7928bfe-e1bf-4154-bfbe-c7b06a1cdeb8","to":"protected-test-watv7H8KeRZ_5W8n4ETnG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063210083,"env":"test","module":"auth-routes","userId":"b370b576-63f3-4a9d-afba-df85f9dbbda2","email":"protected-test-watv7H8KeRZ_5W8n4ETnG@example.com","msg":"User registered"}
{"level":30,"time":1768063210140,"env":"test","module":"email-queue","jobId":"4e33f040-b730-424f-9d47-88248ff13975","to":"middleware-test-4VUOElE_O_nPlBmYMiVD1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063210191,"env":"test","module":"auth-routes","userId":"cd0af9b9-f816-433e-841f-89307962b623","email":"middleware-test-4VUOElE_O_nPlBmYMiVD1@example.com","msg":"User registered"}
{"level":50,"time":1768063210198,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063210635,"env":"test","module":"email-queue","jobId":"cf00012d-75e8-49a3-a547-a7cf33fb7f4b","to":"org-member@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
{"level":30,"time":1768063210678,"env":"test","module":"auth-routes","userId":"b370b576-63f3-4a9d-afba-df85f9dbbda2","msg":"User logged in successfully"}
{"level":30,"time":1768063210723,"env":"test","module":"auth-routes","userId":"cd0af9b9-f816-433e-841f-89307962b623","msg":"User logged in successfully"}
{"level":30,"time":1768063210731,"env":"test","module":"audit-log-service","userId":"b370b576-63f3-4a9d-afba-df85f9dbbda2","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063210773,"env":"test","module":"audit-log-service","userId":"cd0af9b9-f816-433e-841f-89307962b623","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063210776,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063210786,"env":"test","module":"email-queue","jobId":"6ca6d7c4-3b2f-4b8f-ad3d-571b5885e0da","to":"newuser_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768063211116,"env":"test","module":"user-credentials-repository","userId":"97e6e45b-fce0-47e7-b126-2970ff629075","msg":"User credentials created"}
{"level":30,"time":1768063211155,"env":"test","module":"user-credentials-repository","userId":"d132fa12-905f-4701-aff2-2e5d3b54a5d0","msg":"User credentials created"}
{"level":30,"time":1768063211214,"env":"test","module":"email-queue","jobId":"46006bdd-891b-4977-98c6-4064eeb5f95a","to":"protected-test-bkrDyXGYDU63rybIxDexO@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063211263,"env":"test","module":"email-queue","jobId":"65c1167e-e35d-40aa-b808-07c882ef529a","to":"middleware-test-qHVEBjA49o6uEcW3YejDz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063211267,"env":"test","module":"auth-routes","userId":"97e6e45b-fce0-47e7-b126-2970ff629075","email":"protected-test-bkrDyXGYDU63rybIxDexO@example.com","msg":"User registered"}
{"level":30,"time":1768063211315,"env":"test","module":"auth-routes","userId":"d132fa12-905f-4701-aff2-2e5d3b54a5d0","email":"middleware-test-qHVEBjA49o6uEcW3YejDz@example.com","msg":"User registered"}
{"level":50,"time":1768063211638,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063211644,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1768063211903,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":30,"time":1768063212030,"env":"test","module":"user-credentials-repository","userId":"458ed8eb-bc52-4edb-97cb-c1694b826e37","msg":"User credentials created"}
{"level":30,"time":1768063212031,"env":"test","module":"user-credentials-repository","userId":"36a955ed-d9da-49b1-a630-db0359e60f9a","msg":"User credentials created"}
{"level":30,"time":1768063212135,"env":"test","module":"email-queue","jobId":"87c9abda-a8c8-48bc-8fd3-239631bba418","to":"protected-test-8HU3t7k3W398H0vEfEqcs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063212140,"env":"test","module":"email-queue","jobId":"38e76911-6f5d-4871-bfba-842ce8c964af","to":"middleware-test-W7rU9Kvp5PANf-6YML4YJ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063212188,"env":"test","module":"auth-routes","userId":"458ed8eb-bc52-4edb-97cb-c1694b826e37","email":"protected-test-8HU3t7k3W398H0vEfEqcs@example.com","msg":"User registered"}
{"level":30,"time":1768063212189,"env":"test","module":"email-queue","jobId":"69d5126d-e4ba-49da-962f-9fa92464a1ba","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768063212193,"env":"test","module":"auth-routes","userId":"36a955ed-d9da-49b1-a630-db0359e60f9a","email":"middleware-test-W7rU9Kvp5PANf-6YML4YJ@example.com","msg":"User registered"}
{"level":30,"time":1768063212396,"env":"test","workflowId":"12facbcf-7b34-4402-967e-929ceb64b1d6","userId":"7d8d128a-afb7-4638-a798-c2fe6cebc0d3","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768063212515,"env":"test","module":"email-queue","jobId":"aca10979-f5d7-4ced-8621-c5d95841eda2","to":"test-1768063211917-9fv5fe@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063212515,"env":"test","module":"auth-service","email":"test-1768063211917-9fv5fe@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768063212732,"env":"test","module":"auth-routes","userId":"36a955ed-d9da-49b1-a630-db0359e60f9a","msg":"User logged in successfully"}
{"level":30,"time":1768063212786,"env":"test","module":"audit-log-service","userId":"36a955ed-d9da-49b1-a630-db0359e60f9a","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063212794,"env":"test","module":"auth-routes","userId":"458ed8eb-bc52-4edb-97cb-c1694b826e37","msg":"User logged in successfully"}
{"level":30,"time":1768063212844,"env":"test","workflowId":"12facbcf-7b34-4402-967e-929ceb64b1d6","userId":"526230a3-273c-4505-9825-46e3c2c834b7","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768063212849,"env":"test","module":"audit-log-service","userId":"458ed8eb-bc52-4edb-97cb-c1694b826e37","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063213238,"env":"test","module":"user-credentials-repository","userId":"93fc3b78-616b-4dd5-9500-4d01721aefe5","msg":"User credentials created"}
{"level":30,"time":1768063213348,"env":"test","module":"email-queue","jobId":"8f802a34-59ce-4592-bdf1-9a124fa5da3d","to":"user2-H4Ci9L4GENZzrEzu75aFe@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063213398,"env":"test","module":"auth-routes","userId":"93fc3b78-616b-4dd5-9500-4d01721aefe5","email":"user2-H4Ci9L4GENZzrEzu75aFe@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts[2m > [22m[2mAuthService[2m > [22m[2mJWT Token Management[2m > [22m[2mverifyToken()[2m > [22m[2mshould throw error for invalid token signature
[22m[39mDEBUG: verifyToken threw: Invalid or malformed token InvalidTokenError

{"level":50,"time":1768063213709,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1768063213848,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768063213851,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":40,"time":1768063213865,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1768063213876,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"Failed to render template"}
{"level":40,"time":1768063213866,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1768063213868,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1768063213870,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768063213871,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768063213872,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1768063213872,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":50,"time":1768063213892,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768063214002,"env":"test","error":{},"msg":"libreoffice-convert not available, trying system LibreOffice"}
{"level":40,"time":1768063214026,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"libreoffice --headless --convert-to pdf --outdir \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\" \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\\simple-template-1768063213251.docx\"","stdout":"","stderr":"'libreoffice' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"System LibreOffice conversion failed"}
{"level":40,"time":1768063214026,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF conversion failed"}
{"level":30,"time":1768063214086,"env":"test","module":"user-credentials-repository","userId":"33c473ff-bec9-4eda-97d2-761d90d263cd","msg":"User credentials created"}
{"level":30,"time":1768063214197,"env":"test","module":"email-queue","jobId":"3eb4fcc2-fd10-4968-9128-9e9ae9b4ab5b","to":"protected-test-Z_m0vKPiwDbiZBg-9G96X@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063214235,"env":"test","module":"email-queue","jobId":"068014d5-3d93-46f4-a393-b26b068ad5e8","to":"newuser_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768063214246,"env":"test","module":"auth-routes","userId":"33c473ff-bec9-4eda-97d2-761d90d263cd","email":"protected-test-Z_m0vKPiwDbiZBg-9G96X@example.com","msg":"User registered"}
{"level":30,"time":1768063214272,"env":"test","module":"user-credentials-repository","userId":"f6b20f31-e8b1-4782-8557-650638e2061c","msg":"User credentials created"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 7037[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should render a template with simple data [33m 1202[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use formatters in templates [33m 1056[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing data gracefully [33m 1061[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use custom output name [33m 1162[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should attempt PDF conversion when requested [33m 1123[2mms[22m[39m
{"level":30,"time":1768063214381,"env":"test","module":"email-queue","jobId":"409b3661-fbf2-4633-9468-c68a6eedeeab","to":"middleware-test-1x3RdiJbF61qBJCrDaGD-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063214382,"env":"test","module":"auth-routes","userId":"33befb72dc3a3cdda53b4934deff3dac","msg":"User logged in successfully"}
{"level":30,"time":1768063214434,"env":"test","module":"auth-routes","userId":"f6b20f31-e8b1-4782-8557-650638e2061c","email":"middleware-test-1x3RdiJbF61qBJCrDaGD-@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests[2m > [22m[2mshould generate basic autonumber without prefix
[22m[39mRow 1 Basic Autonumber: 0001
Row 2 Basic Autonumber: 0002

{"level":30,"time":1768063214439,"env":"test","module":"audit-log-service","userId":"33befb72dc3a3cdda53b4934deff3dac","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: de0ac399-fbe8-4fce-8813-6eac97eb9357 tenantId: a7134b06-8d03-471d-877b-503e5a472254 userId: google-user-id

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1768063214853,"env":"test","module":"auth-routes","userId":"33c473ff-bec9-4eda-97d2-761d90d263cd","msg":"User logged in successfully"}
{"level":30,"time":1768063214891,"env":"test","workflowId":"12facbcf-7b34-4402-967e-929ceb64b1d6","userId":"7d8d128a-afb7-4638-a798-c2fe6cebc0d3","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1768063214905,"env":"test","module":"audit-log-service","userId":"33c473ff-bec9-4eda-97d2-761d90d263cd","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1768063214970,"env":"test","module":"auth-routes","userId":"f6b20f31-e8b1-4782-8557-650638e2061c","msg":"User logged in successfully"}
{"level":30,"time":1768063215023,"env":"test","module":"audit-log-service","userId":"f6b20f31-e8b1-4782-8557-650638e2061c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063215027,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 3792c523-7cba-4b37-a775-633ded49a108 tenantId: a7134b06-8d03-471d-877b-503e5a472254 userId: google-user-id

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 987e8536-aa58-438f-b761-42a0bc65cd74 tenantId: a7134b06-8d03-471d-877b-503e5a472254 userId: google-user-id

{"level":50,"time":1768063215405,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063215407,"env":"test","module":"user-credentials-repository","userId":"dd40eb59-1439-4ef7-8aee-76bb04566711","msg":"User credentials created"}
{"level":30,"time":1768063215418,"env":"test","module":"user-credentials-repository","userId":"036a5db9-ea76-4cc7-9d51-77dc5cfece6d","msg":"User credentials created"}
{"level":30,"time":1768063215441,"env":"test","module":"email-queue","jobId":"2bb07fe0-7cb2-49ee-9489-2a11eb011b19","to":"duplicate@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/organizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizationService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 12126[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create organization and auto-create admin membership [33m 979[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return all organizations for user [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array for user with no memberships [33m 385[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to update organization [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should deny non-admin from updating organization [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return all members of organization [33m 905[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to promote member [33m 1170[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to demote other admin [33m 1122[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent self-demotion [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to remove member [33m 1172[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent self-removal [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow member to leave organization [33m 1061[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to leave organization [33m 1101[2mms[22m[39m
{"level":30,"time":1768063215515,"env":"test","module":"email-queue","jobId":"074f2df1-85ee-4894-a648-66e4a853d8b2","to":"protected-test-LDPq1wwI0HcFFM6D3Tedb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063215527,"env":"test","module":"email-queue","jobId":"c1e321d7-11a9-4698-85ae-f4381faf0c96","to":"middleware-test-jteAY2gwIbdUv6MIugOmH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063215566,"env":"test","module":"auth-routes","userId":"dd40eb59-1439-4ef7-8aee-76bb04566711","email":"protected-test-LDPq1wwI0HcFFM6D3Tedb@example.com","msg":"User registered"}
{"level":30,"time":1768063215579,"env":"test","module":"auth-routes","userId":"036a5db9-ea76-4cc7-9d51-77dc5cfece6d","email":"middleware-test-jteAY2gwIbdUv6MIugOmH@example.com","msg":"User registered"}
{"level":30,"time":1768063215659,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: 6d8c5921-a1ce-4d10-9c53-996d2057b779 tenantId: a7134b06-8d03-471d-877b-503e5a472254 userId: google-user-id

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/workflows/runtime-pipelines.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063216116,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1768063216138,"env":"test","module":"auth-routes","userId":"036a5db9-ea76-4cc7-9d51-77dc5cfece6d","msg":"User logged in successfully"}
{"level":30,"time":1768063216173,"env":"test","module":"auth-routes","userId":"dd40eb59-1439-4ef7-8aee-76bb04566711","msg":"User logged in successfully"}
{"level":30,"time":1768063216191,"env":"test","module":"audit-log-service","userId":"036a5db9-ea76-4cc7-9d51-77dc5cfece6d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1768063216198,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063216226,"env":"test","module":"audit-log-service","userId":"dd40eb59-1439-4ef7-8aee-76bb04566711","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/auth.middleware.integration.test.ts:41:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(027f92ec-9ca6-4d0e-8b97-7b09677593d9) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/auth.middleware.integration.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m16 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 30645[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow access with valid JWT Bearer token[39m[33m 864[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when no token provided [33m 1197[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 with invalid token[39m[33m 882[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 with expired token[39m[33m 876[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should proceed without authentication if no token provided
[31m       [31mâ”œÃ¹[31m should authenticate with JWT Bearer token[39m[33m 860[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with refresh token cookie (GET only)[39m[33m 880[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for POST requests (mutation-strict)[39m[33m 914[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for PUT requests[39m[33m 859[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for DELETE requests[39m[33m 923[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow cookie auth for HEAD requests[39m[33m 925[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prioritize JWT over cookie when both present[39m[33m 905[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when no auth provided [33m 1351[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when both JWT and cookie are invalid[39m[33m 898[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with JWT if provided[39m[33m 909[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with cookie if JWT not provided [33m 1798[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should proceed anonymously if no auth provided [33m 1838[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should proceed anonymously if both JWT and cookie are invalid [33m 1765[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should only allow safe methods for cookie auth[39m[33m 920[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should ignore cookies when Bearer token present[39m[33m 916[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach userId to request[39m[33m 909[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should attach userEmail to request [33m 1259[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return consistent error format for missing token [33m 1119[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent error format for invalid token[39m[33m 862[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return consistent error format for expired token [33m 2253[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle malformed JWT gracefully [33m 1135[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle JWT with wrong algorithm [33m 1173[2mms[22m[39m
{"level":50,"time":1768063216261,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1768063216366,"env":"test","module":"email-queue","jobId":"726f83ca-616e-4390-b39d-189dfe732ad4","to":"expired@test.com","subject":"You've been invited to join Test Organization","msg":"Email added to queue"}
{"level":30,"time":1768063216386,"env":"test","module":"email-queue","jobId":"ac10c96b-d085-4874-8678-74b6a0cff53f","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: c1119686-f593-4012-81a5-f7661f647089 tenantId: a7134b06-8d03-471d-877b-503e5a472254 userId: google-user-id

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":30,"time":1768063216754,"env":"test","module":"user-credentials-repository","userId":"afb158bf-094a-462b-9175-89571d686086","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m)[22m[33m 7499[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate different hashes for same password [33m 431[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return true for correct password [33m 426[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return false for incorrect password [33m 423[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should be case-sensitive [33m 431[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle empty password comparison [33m 433[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error for expired token [33m 1103[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with special characters [33m 434[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with newlines and tabs [33m 435[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject password with null bytes (if validation exists) [33m 447[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support complete password reset workflow [33m 458[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should compare password in reasonable time (< 500ms) [33m 481[2mms[22m[39m
{"level":50,"time":1768063216857,"env":"test","error":{},"msg":"Error deleting row note"}
{"level":30,"time":1768063216860,"env":"test","module":"email-queue","jobId":"ae1772e3-f45e-4a3e-b669-b00f91cc2d99","to":"protected-test-BV6fdeXluGLA3x1OiD--y@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063216910,"env":"test","module":"auth-routes","userId":"afb158bf-094a-462b-9175-89571d686086","email":"protected-test-BV6fdeXluGLA3x1OiD--y@example.com","msg":"User registered"}
{"level":50,"time":1768063217284,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/ownershipAccess.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 14255[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a workflow template mapping [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create non-primary mapping by default [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find all templates for a workflow version [33m 755[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array for version with no templates [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should order by createdAt desc (newest first) [33m 749[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find mapping by workflow version and key [33m 711[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined for non-existent key [33m 651[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find primary template for workflow version [33m 736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined when no primary template exists [33m 682[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set a template as primary and unset others [33m 906[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle setting primary when none existed before [33m 903[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not delete mapping if workflow version does not match [33m 848[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return true if key exists in workflow version [33m 708[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return false if key does not exist [33m 639[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should exclude specified id when checking existence [33m 703[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return true if key exists on different mapping [33m 752[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update mapping fields [33m 699[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find mapping by id [33m 690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined for non-existent id [33m 637[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould complete MFA login with valid TOTP code
[22m[39m[TEST UTILS] MFA Secret verified for df3e23322516258f611397e470ed49b2

{"level":30,"time":1768063217694,"env":"test","module":"user-credentials-repository","userId":"5a216258-f0e5-4c7e-8a6d-f4a3c6f3c88d","msg":"User credentials created"}
{"level":30,"time":1768063217805,"env":"test","module":"email-queue","jobId":"52c857f9-c3f9-4686-825d-a6f9c5fbda57","to":"protected-test-LdkLH1ec-zIVycMrWnsne@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063217812,"env":"test","module":"writeback-execution-service","runId":"3c4fc6ad-06cc-474f-9458-24c54b1c69a4","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","msg":"Executing writeback mappings for completed run"}
{"level":30,"time":1768063217864,"env":"test","module":"writeback-execution-service","runId":"3c4fc6ad-06cc-474f-9458-24c54b1c69a4","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","mappingCount":1,"msg":"Found writeback mappings"}
{"level":30,"time":1768063217860,"env":"test","module":"auth-routes","userId":"5a216258-f0e5-4c7e-8a6d-f4a3c6f3c88d","email":"protected-test-LdkLH1ec-zIVycMrWnsne@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

stderr | tests/integration/organizations-workflow.test.ts > Organization Workflow Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-workflow.test.ts:81:7 {
  length: 335,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(526230a3-273c-4505-9825-46e3c2c834b7) is still referenced from table "audit_logs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_user_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 8842[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 1: Create organization [33m 520[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 2: Invite member via email [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 3: Accept invite [33m 577[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 4: Create workflow owned by user [33m 322[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 5: Transfer workflow to organization [33m 327[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 6: Org member (user2) can access workflow [33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 14: Remove member from org [33m 323[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 16: Re-add member and verify access restored [33m 421[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot invite same email twice (pending invite exists) [33m 942[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot accept expired invite [33m 802[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot transfer workflow to org user is not a member of [33m 649[2mms[22m[39m
{"level":30,"time":1768063218075,"env":"test","module":"writeback-execution-service","runId":"3c4fc6ad-06cc-474f-9458-24c54b1c69a4","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","mappingId":"d19792ed-4722-4364-a80f-11ff16acebcc","tableId":"82676374-0b9c-4280-842c-a4f525cb5b13","msg":"Executing writeback mapping"}
{"level":30,"time":1768063218125,"env":"test","module":"email-queue","jobId":"27120a8f-d941-4d4a-a409-0dbd9868aaa1","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":50,"time":1768063218328,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768063218487,"env":"test","module":"writeback-execution-service","runId":"3c4fc6ad-06cc-474f-9458-24c54b1c69a4","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","mappingId":"d19792ed-4722-4364-a80f-11ff16acebcc","columnCount":3,"msg":"Successfully created DataVault row"}
{"level":30,"time":1768063218487,"env":"test","module":"writeback-execution-service","runId":"3c4fc6ad-06cc-474f-9458-24c54b1c69a4","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","rowsCreated":1,"errorCount":0,"msg":"Writeback execution completed"}
{"level":30,"time":1768063218493,"env":"test","module":"auth-routes","userId":"5a216258-f0e5-4c7e-8a6d-f4a3c6f3c88d","msg":"User logged in successfully"}
{"level":30,"time":1768063218494,"env":"test","module":"auth-routes","userId":"df3e23322516258f611397e470ed49b2","msg":"Login requires MFA verification"}
{"level":30,"time":1768063218545,"env":"test","module":"audit-log-service","userId":"5a216258-f0e5-4c7e-8a6d-f4a3c6f3c88d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 12018[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enqueue a PDF conversion job [33m 710[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create output with empty storagePath initially [33m 712[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return job status for pending job [33m 694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return null for non-existent job [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should parse attempt count from error field [33m 668[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should convert DOCX to PDF immediately [33m 745[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle conversion errors gracefully [33m 696[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should start and stop service [33m 725[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not start if already running [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle stop when not running [33m 575[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should process pending jobs when queue is processed [33m 1041[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should process multiple jobs in batch [33m 1272[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing DOCX output gracefully [33m 792[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support enqueue within transaction [33m 833[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support convertImmediate within transaction [33m 766[2mms[22m[39m
{"level":30,"time":1768063218607,"env":"test","module":"mfa-service","userId":"df3e23322516258f611397e470ed49b2","msg":"TOTP verification successful"}
{"level":30,"time":1768063218658,"env":"test","module":"auth-routes","userId":"df3e23322516258f611397e470ed49b2","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/dataBlocks.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 16620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if template belongs to different project [33m 620[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should automatically unset other primaries when setting new primary [33m 1122[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list all templates for workflow version [33m 826[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return empty array for version with no templates [33m 570[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get template mapping by id and version [33m 731[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 566[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get template by key [33m 731[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if key not found [33m 549[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get primary template for workflow version [33m 836[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return null when no primary template exists [33m 649[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update mapping key [33m 769[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update isPrimary flag [33m 829[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if new key already exists [33m 839[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 556[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should unset other primaries when setting isPrimary to true [33m 1103[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should detach template from workflow version [33m 759[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 560[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should set template as primary [33m 1043[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 560[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support operations within a transaction [33m 849[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should rollback on transaction error [33m 852[2mms[22m[39m
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests
[22m[39mError cleaning up table: Error: Table not found
    at DatavaultTablesService.verifyTenantOwnership (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:150:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablesService.deleteTable (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:290:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/datavault.autonumber.test.ts:90:9

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.autonumber.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 10674[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate basic autonumber without prefix [33m 1166[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate autonumber with prefix [33m 1170[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate autonumber with yearly reset format [33m 1167[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should be atomic and prevent race conditions [33m 792[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should prevent manual updates to autonumber values [33m 1578[2mms[22m[39m
{"level":30,"time":1768063219412,"env":"test","module":"user-credentials-repository","userId":"005a233f-0934-4998-80cc-8ddb491c3960","msg":"User credentials created"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1768063219527,"env":"test","module":"email-queue","jobId":"f3523e66-4dea-4c6a-a33e-df8f22e30693","to":"protected-test-zhKqKKOD9Bx7iTF5RV6lK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1768063219589,"env":"test","module":"auth-routes","userId":"005a233f-0934-4998-80cc-8ddb491c3960","email":"protected-test-zhKqKKOD9Bx7iTF5RV6lK@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: {
  id: [32m'fc91e694-e4c4-4850-99a7-11a66a4b1f41'[39m,
  tableId: [32m'7f7265f4-fecc-477e-b1fd-679f25cee235'[39m,
  userId: [32m'other-user-id'[39m,
  role: [32m'write'[39m,
  createdAt: [32m'2026-01-10T16:40:20.561Z'[39m
}

[90mstdout[2m | tests/integration/transferOwnership.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/transferOwnership.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 16701[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer user-owned project to org [33m 1843[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1486[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org-owned project to another org they belong to [33m 1916[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should detach workflow from project when transferring to different owner [33m 1522[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should keep workflow in project when transferring to same owner [33m 1605[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent non-member from transferring org workflow [33m 1491[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer database ownership [33m 1155[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org database [33m 1247[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1501[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should only allow transfer to self when targetOwnerType is user [33m 1062[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow transfer from user to self (org member transferring org asset to themselves) [33m 1338[2mms[22m[39m
{"level":30,"time":1768063219701,"env":"test","module":"writeback-execution-service","runId":"a1271629-668d-47c6-8f80-84121edcb94b","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","msg":"Executing writeback mappings for completed run"}
{"level":30,"time":1768063219753,"env":"test","module":"writeback-execution-service","runId":"a1271629-668d-47c6-8f80-84121edcb94b","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","mappingCount":1,"msg":"Found writeback mappings"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

{"level":30,"time":1768063219961,"env":"test","module":"writeback-execution-service","runId":"a1271629-668d-47c6-8f80-84121edcb94b","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","mappingId":"d19792ed-4722-4364-a80f-11ff16acebcc","tableId":"82676374-0b9c-4280-842c-a4f525cb5b13","msg":"Executing writeback mapping"}
{"level":50,"time":1768063219969,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth.routes.real.test.ts[2m > [22m[2mAuth Routes Integration Tests (REAL)[2m > [22m[2mMFA Routes[2m > [22m[2mPOST /api/auth/mfa/verify-login[2m > [22m[2mshould reject invalid MFA code
[22m[39m[TEST UTILS] MFA Secret verified for c865cd06adfa4aa311551385922dc9b2

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/collections.e2e.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":40,"time":1768063220141,"env":"test","workflowId":"ffafc2eb-5f8d-4de8-9638-5f1591aa5a4b","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":30,"time":1768063220148,"env":"test","module":"email-queue","jobId":"79c249d9-dd59-4720-936a-f37855958ef9","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1768063220385,"env":"test","module":"writeback-execution-service","runId":"a1271629-668d-47c6-8f80-84121edcb94b","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","mappingId":"d19792ed-4722-4364-a80f-11ff16acebcc","columnCount":3,"msg":"Successfully created DataVault row"}
{"level":30,"time":1768063220385,"env":"test","module":"writeback-execution-service","runId":"a1271629-668d-47c6-8f80-84121edcb94b","workflowId":"89034a01-cdd7-490c-97cf-a52cd4452276","rowsCreated":1,"errorCount":0,"msg":"Writeback execution completed"}
{"level":30,"time":1768063220385,"env":"test","runId":"a1271629-668d-47c6-8f80-84121edcb94b","rowsCreated":1,"msg":"DataVault writeback completed"}
{"level":30,"time":1768063220385,"env":"test","runId":"a1271629-668d-47c6-8f80-84121edcb94b","service":"DocumentGenerationService","msg":"Starting document generation for run"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768063220404,"env":"test","module":"user-credentials-repository","userId":"3b63abee-d571-4ac8-935b-e7f123848bd4","msg":"User credentials created"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 11546[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve template by key from workflowTemplates mapping [33m 726[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if template key not found [33m 611[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should store output in runOutputs table [33m 776[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve template by templateId directly [33m 622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if templateId not found [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use docxRenderer2 by default (v2 engine) [33m 642[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use legacy engine when engine="legacy" [33m 608[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should generate PDF when toPdf=true [33m 782[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should default to DOCX when toPdf=false [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should skip execution when condition evaluates to false [33m 553[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should execute when condition evaluates to true [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve simple bindings [33m 650[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle binding resolution errors gracefully [33m 567[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should record failed output in runOutputs table [33m 718[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not throw errors (should return error in result) [33m 631[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should deny access to templates from different tenant [33m 613[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require either templateKey or templateId [33m 581[2mms[22m[39m
stderr | tests/unit/components/datavault/TableGridView.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":40,"time":1768063220489,"env":"test","runId":"a1271629-668d-47c6-8f80-84121edcb94b","service":"DocumentGenerationService","allSections":[{"id":"2a4ec095-edca-4306-a824-69247cad85b7","config":{}}],"runId":"a1271629-668d-47c6-8f80-84121edcb94b","msg":"No Final Documents sections found, skipping generation. This might cause the frontend to hang."}
{"level":30,"time":1768063220515,"env":"test","module":"email-queue","jobId":"5506d094-6d2e-41db-8b78-ade9a8c4608b","to":"protected-test-JSLR7skL3Shyf99PKhSVS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1768063220532,"env":"test","module":"mfa-service","userId":"c865cd06adfa4aa311551385922dc9b2","msg":"TOTP verification failed"}
{"level":40,"time":1768063220532,"env":"test","module":"auth-routes","userId":"c865cd06adfa4aa311551385922dc9b2","msg":"MFA verification failed during login"}
{"level":30,"time":1768063220574,"env":"test","module":"auth-routes","userId":"3b63abee-d571-4ac8-935b-e7f123848bd4","email":"protected-test-JSLR7skL3Shyf99PKhSVS@example.com","msg":"User registered"}
{"level":50,"time":1768063220585,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768063220735,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth.routes.real.test.ts [2m([22m[2m26 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[33m 41982[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should register a new user successfully [33m 1584[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for invalid email format [33m 871[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for weak password [33m 878[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 409 for duplicate email [33m 1472[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set httpOnly refresh token cookie [33m 1387[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with valid credentials[39m[33m 1514[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid password [33m 1762[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for non-existent user [33m 1051[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 403 for unverified email[39m[33m 1685[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should record failed login attempt [33m 1879[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return requiresMfa=true for MFA-enabled users[39m[33m 1932[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should lock account after 5 failed attempts[39m[33m 2913[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should logout and clear refresh token cookie[39m[33m 1564[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should refresh access token with valid refresh token [33m 2078[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for missing refresh token [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should rotate refresh token after use [33m 2160[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should send password reset email for existing user [33m 1492[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not reveal if email exists (security) [33m 912[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reset password with valid token [33m 3094[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for invalid token [33m 901[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for weak new password [33m 1544[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return current user for valid token [33m 1921[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for missing token [33m 870[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid token [33m 878[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should complete MFA login with valid TOTP code [33m 2368[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject invalid MFA code [33m 1877[2mms[22m[39m
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/externalSends.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063221212,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1768063221265,"env":"test","module":"auth-routes","userId":"3b63abee-d571-4ac8-935b-e7f123848bd4","msg":"User logged in successfully"}
{"level":30,"time":1768063221319,"env":"test","module":"audit-log-service","userId":"3b63abee-d571-4ac8-935b-e7f123848bd4","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":50,"time":1768063221593,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768063221712,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"mode":"create","tableId":"9692cde4-f386-42b5-80d8-8542868f9710","dataSourceId":"aea8ff66-13db-4146-9975-a4c18ba28f28","columnMappings":[{"value":"{{4b05eb55-0a96-4fbb-a9ea-4e0b5c551fe2}}","columnId":"2bccdb8b-9b86-4499-acf4-8abdf7b63678"}]},"tableId":"9692cde4-f386-42b5-80d8-8542868f9710","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768063222019,"env":"test","module":"user-credentials-repository","userId":"e7182c69-e72e-4839-a0ba-edf381b56c85","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/auth/oauth2.google.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063222121,"env":"test","module":"email-queue","jobId":"f2020fbc-9a9e-4ac1-8a9e-6fdc4bc0f1e0","to":"protected-test-JMOYPx55xZQ-zxhZw_hls@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063222175,"env":"test","module":"auth-routes","userId":"e7182c69-e72e-4839-a0ba-edf381b56c85","email":"protected-test-JMOYPx55xZQ-zxhZw_hls@example.com","msg":"User registered"}
{"level":50,"time":1768063222176,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/workflows/runtime-pipelines.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 6165[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create DataVault row on workflow completion [33m 944[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should execute writebacks via RunService.completeRun() [33m 2335[2mms[22m[39m
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/ownershipAccess.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 5127[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow member of multiple orgs to access all their org assets [33m 332[2mms[22m[39m
{"level":30,"time":1768063222519,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":50,"time":1768063222686,"env":"test","error":{"length":375,"name":"error","severity":"ERROR","code":"23503","detail":"Key (table_id)=(f3b13f66-4079-4f3c-9a8c-7c8cbe3b5296) is not present in table \"datavault_tables\".","schema":"public","table":"datavault_columns","constraint":"datavault_columns_table_id_datavault_tables_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Error creating DataVault column"}
{"level":30,"time":1768063222738,"env":"test","module":"email-queue","jobId":"0087f151-7692-45bc-8226-1b6b564067e8","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":50,"time":1768063222751,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":40,"time":1768063222760,"env":"test","workflowId":"5f44952e-6f71-471b-b9ff-9833a69c866c","msg":"No current or pinned version found for workflow, run might be unstable"}
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 3325[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m loads table schema and rows [33m 482[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m updates cell value on blur [33m 406[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m renders delete button for each row [33m 327[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768063222940,"env":"test","module":"auth-routes","userId":"e7182c69-e72e-4839-a0ba-edf381b56c85","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/variableSafety.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063222998,"env":"test","module":"audit-log-service","userId":"e7182c69-e72e-4839-a0ba-edf381b56c85","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 14368[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 481[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1224[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 905[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 485[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 937[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 773[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 651[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 380[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 229[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 638[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 221[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list table permissions [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update table permission role [33m 558[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke table permission [33m 659[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce RBAC - only owners can manage permissions [33m 340[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 1295[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return user-friendly error for invalid column type [33m 303[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return user-friendly error for missing required fields[39m[33m 568[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 225[2mms[22m[39m
{"level":30,"time":1768063223125,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1768063223372,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":50,"time":1768063223373,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google authentication failed"}
{"level":40,"time":1768063223430,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1768063223430,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google token verification failed"}
{"level":50,"time":1768063223430,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google authentication failed"}
{"level":30,"time":1768063223553,"env":"test","module":"intake-service","runId":"e5708caf-5837-427f-8b1f-c438c1e7c3f6","slug":"public-yqq2knSnMwjIBTgnaPrKD","msg":"Created intake run"}
{"level":30,"time":1768063223607,"env":"test","msg":"Simulating External Send","destination":"Test Webhook","payload":{"message":"Hello Preview"}}
{"level":30,"time":1768063223872,"env":"test","module":"auth","email":"existing@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1768063223953,"env":"test","workflowId":"5f44952e-6f71-471b-b9ff-9833a69c866c","queryId":"29dd2317-ad18-4dcf-93b6-ed539265d81e","outputVar":"my_results","msg":"Executing query block"}
{"level":30,"time":1768063224060,"env":"test","module":"user-credentials-repository","userId":"62583f8a-1d39-4724-b7bb-1027b7466a93","msg":"User credentials created"}
{"level":40,"time":1768063224115,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1768063224173,"env":"test","module":"email-queue","jobId":"4f9c8221-dfa8-479b-b706-f5e693e91cec","to":"protected-test-xUyZu65XE_WEO9JUfEn90@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063224231,"env":"test","module":"auth-routes","userId":"62583f8a-1d39-4724-b7bb-1027b7466a93","email":"protected-test-xUyZu65XE_WEO9JUfEn90@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768063224322,"env":"test","module":"auth","email":"refresh@example.com","msg":"OAuth2 login successful"}
 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 4204[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create multiple records [33m 442[2mms[22m[39m
{"level":30,"time":1768063224359,"env":"test","module":"email-queue","jobId":"fea7c6fe-e17c-4360-81ef-654dce388398","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/dataBlocks.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 5751[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should write data to DataVault via WriteBlock [33m 2620[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should query data from DataVault via QueryBlock and use in Logic [33m 1950[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1768063224764,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1768063224766,"env":"test","module":"auth","email":"idtoken@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768063224869,"env":"test","module":"auth-routes","userId":"62583f8a-1d39-4724-b7bb-1027b7466a93","msg":"User logged in successfully"}
{"level":30,"time":1768063224908,"env":"test","msg":"External Send Completed","destination":"Test Webhook","success":true,"status":200}
{"level":30,"time":1768063224929,"env":"test","module":"audit-log-service","userId":"62583f8a-1d39-4724-b7bb-1027b7466a93","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/auth/oauth2.callback.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/unit/collab.client.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/externalSends.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 3826[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m PREVIEW MODE: Should simulate send and NOT call fetch [33m 1491[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m LIVE MODE: Should call fetch with mapped payload [33m 1300[2mms[22m[39m
{"level":30,"time":1768063225204,"env":"test","module":"auth","email":"minimal@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.runs.graph.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063225323,"env":"test","module":"auth","err":{"type":"Error","message":"Token verification failed","stack":"Error: Token verification failed\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:425:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":40,"time":1768063225383,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1768063225383,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
{"level":50,"time":1768063225442,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token payload","stack":"Error: Invalid token payload\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:85:25)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.google.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 3454[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should successfully authenticate with valid Google ID token [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update existing user on subsequent logins [33m 496[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create refresh token record in database [33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support both "token" and "idToken" fields [33m 391[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing profile information gracefully [33m 382[2mms[22m[39m
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768063225657,"env":"test","module":"intake-service","runId":"e29a44ea-7fd6-4770-b61b-2ace55e7c0ed","slug":"optional-f5razLm99CVpUND94mWzm","userId":"62583f8a-1d39-4724-b7bb-1027b7466a93","msg":"Created intake run"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/intake.workflow.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063225839,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063225859,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063225847,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063225848,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063225853,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063225858,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063225858,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063225859,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063225859,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

stderr | tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/protected.routes.test.ts:37:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(be65399d-73d1-4582-ad35-3123e7a3fa74) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/protected.routes.test.ts [2m([22m[2m33 tests[22m[2m | [22m[31m24 failed[39m[2m)[22m[33m 40275[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow access with valid Bearer token[39m[33m 941[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject access without Authorization header [33m 1286[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with empty Bearer token[39m[33m 965[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with malformed Authorization header[39m[33m 933[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with wrong token type[39m[33m 909[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow POST with valid Bearer token[39m[33m 980[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST without Bearer token[39m[33m 1087[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST with invalid token[39m[33m 924[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow PUT with valid Bearer token[39m[33m 1009[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject PUT without Bearer token[39m[33m 976[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow DELETE with valid Bearer token[39m[33m 1396[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject DELETE without Bearer token[39m[33m 937[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow PATCH with valid Bearer token[39m[33m 1004[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject PATCH without Bearer token[39m[33m 972[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle Bearer token with extra spaces[39m[33m 962[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle token with newlines[39m[33m 1001[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle very long invalid token[39m[33m 957[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle empty Authorization header[39m[33m 934[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle Authorization header with only Bearer [33m 1294[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle multiple Authorization headers[39m[33m 949[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with SQL injection attempt[39m[33m 929[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject token with XSS attempt [33m 1204[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject token with missing userId [33m 1182[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with non-existent userId[39m[33m 909[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow user to access another user's resources[39m[33m 2065[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should inject userId into request context [33m 1301[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should inject tenantId into request context [33m 1325[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should inject role into request context[39m[33m 951[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not apply general rate limiting to authenticated requests [33m 1711[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle request with both Bearer token and cookies[39m[33m 973[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prioritize Bearer token over cookie when both present[39m[33m 1625[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow unauthenticated access to optional auth routes [33m 2012[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enhance optional auth routes with user context when authenticated [33m 2222[2mms[22m[39m
{"level":30,"time":1768063226067,"env":"test","module":"email-queue","jobId":"3448388c-18b2-4025-9e18-5e096ccc8585","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
{"level":30,"time":1768063226135,"env":"test","connectionId":"b644afd0-08ec-48e6-ab77-936176db4364","projectId":"9ec2e7c1-80ca-4ff9-ab79-40e80ff3be64","name":"Test OAuth2 Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests
[22m[39m[Shim] Request to /api/auth/google, Session User ID: undefined

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/variableSafety.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 3372[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m REPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided [33m 675[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m ScriptEngine resolves alias 'input_variable' when aliasMap is provided [33m 647[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m REPRO: BlockRunner fails to resolve alias in CreateRecordConfig [33m 636[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m BlockRunner logic resolves alias with aliasMap [33m 641[2mms[22m[39m
{"level":30,"time":1768063226347,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063226366,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts[2m > [22m[2mIntake Workflow Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063226354,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063226354,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063226358,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063226365,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063226365,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063226365,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063226365,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould list all runs with pagination
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by status
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by workflow
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by project
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768063226951,"env":"test","module":"user-credentials-repository","userId":"267214ca-bda6-4e82-948d-67d4a2870bcf","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould filter runs by date range
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs[2m > [22m[2mshould search runs by query string
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768063227065,"env":"test","module":"email-queue","jobId":"1be632b5-4d65-4f1a-9226-ad9739eda2c9","to":"test-7_f4KSfoxdbma6TtBqStk@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id[2m > [22m[2mshould get run by ID with all details
[22m[39m[Shim] Request to /api/runs/92df7641-cf41-432a-b3ab-34345ab68bbb, Session User ID: test-user-runs-stage8

{"level":30,"time":1768063227122,"env":"test","module":"auth-routes","userId":"267214ca-bda6-4e82-948d-67d4a2870bcf","email":"test-7_f4KSfoxdbma6TtBqStk@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/auth/oauth2.client-credentials.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id[2m > [22m[2mshould return 404 for non-existent run
[22m[39m[Shim] Request to /api/runs/00000000-0000-0000-0000-000000000000, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/:id/logs[2m > [22m[2mshould get logs for a run
[22m[39m[Shim] Request to /api/runs/92df7641-cf41-432a-b3ab-34345ab68bbb/logs, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.projects.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1768063227415,"env":"test","connectionId":"12f3bf73-4e4a-4c83-b812-5f4148593001","projectId":"9ec2e7c1-80ca-4ff9-ab79-40e80ff3be64","name":"Status Test Connection","type":"oauth2_3leg","msg":"Connection created:"}
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with same inputs
[22m[39m[Shim] Request to /api/runs/92df7641-cf41-432a-b3ab-34345ab68bbb/rerun, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests > POST /api/runs/:id/rerun > should re-run workflow with same inputs
[DEBUG Question] Node start executed. Key: start, Value: undefined. Context keys: 4

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768063227727,"env":"test","status":401,"statusText":"Unauthorized","error":"Invalid client credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768063227727,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227730,"env":"test","data":{"token_type":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1768063227730,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227731,"env":"test","data":{"access_token":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1768063227731,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227732,"env":"test","error":"Network error: ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/components/datavault/CellRenderer.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould re-run workflow with override inputs
[22m[39m[Shim] Request to /api/runs/92df7641-cf41-432a-b3ab-34345ab68bbb/rerun, Session User ID: test-user-runs-stage8

{"level":50,"time":1768063227843,"env":"test","error":"Invalid credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768063227843,"env":"test","error":"ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227845,"env":"test","status":400,"statusText":"Bad Request","error":"Invalid grant_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768063227845,"env":"test","error":"OAuth2 token request failed: 400 Bad Request","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227846,"env":"test","status":401,"statusText":"Unauthorized","error":"Client authentication failed","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768063227846,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227846,"env":"test","status":403,"statusText":"Forbidden","error":"Access denied","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768063227846,"env":"test","error":"OAuth2 token request failed: 403 Forbidden","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227847,"env":"test","status":500,"statusText":"Internal Server Error","error":"Server error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1768063227847,"env":"test","error":"OAuth2 token request failed: 500 Internal Server Error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227847,"env":"test","error":"Unexpected token in JSON","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1768063227848,"env":"test","error":"Request timeout","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1857[2mms[22m[39m
{"level":30,"time":1768063227886,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.projects.test.ts[2m > [22m[2mProjects API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063227906,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1768063227895,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063227895,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063227900,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063227905,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063227906,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063227906,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063227906,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stderr | tests/unit/isolatedVmBridge.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[33m 4174[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should add a comment [33m 722[2mms[22m[39m
stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests > POST /api/runs/:id/rerun > should re-run workflow with override inputs
[DEBUG Question] Node start executed. Key: start, Value: undefined. Context keys: 4

{"level":30,"time":1768063228156,"env":"test","module":"email-queue","jobId":"eb5b044a-b2e4-476a-9eff-2ce9373329ca","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 3196[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should initiate OAuth2 3-legged flow and generate authorization URL [33m 402[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track OAuth2 connection status [33m 505[2mms[22m[39m
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mPOST /api/runs/:id/rerun[2m > [22m[2mshould return 404 for non-existent run
[22m[39m[Shim] Request to /api/runs/00000000-0000-0000-0000-000000000000/rerun, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/export.csv[2m > [22m[2mshould export runs to CSV
[22m[39m[Shim] Request to /api/runs/export.csv, Session User ID: test-user-runs-stage8

stderr | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx > TableGridView - Drag & Drop > renders DndContext wrapper
Warning: validateDOMNesting(...): <th> cannot appear as a child of <div>.
    at th
    at SortableColumnHeader (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/SortableColumnHeader.tsx:12:33)
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
Warning: validateDOMNesting(...): <div> cannot appear as a child of <tr>.
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

{"level":30,"time":1768063228443,"env":"test","module":"user-credentials-repository","userId":"c3ab2f73-fb13-4eb9-88d2-87f1f83be9c5","msg":"User credentials created"}
{"level":30,"time":1768063228456,"env":"test","workflowId":"b5952a44-9be7-4244-b4f4-e12d74e7ba2f","userId":"267214ca-bda6-4e82-948d-67d4a2870bcf","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":40,"time":1768063228458,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/export.csv[2m > [22m[2mshould export runs with filters applied
[22m[39m[Shim] Request to /api/runs/export.csv, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768063228486,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768063228490,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768063228494,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1768063228506,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
 [32mÎ“Â£Ã´[39m tests/unit/isolatedVmBridge.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 1704[2mms[22m[39m
stderr | tests/integration/organizationInvites.test.ts > Organization Invites > revokeInvite > should allow admin to revoke invite
Failed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:20:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:833:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizationInvites.test.ts:333:13
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:20 {
  length: 341,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (workspace_id)=(00000000-0000-0000-0000-000000000098) is not present in table "workspaces".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_workspace_id_workspaces_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768063228558,"env":"test","module":"email-queue","jobId":"793c97f7-466e-4d5e-aac6-df2e71ee2e3c","to":"test-projects-bMtPjjJIFgfdIX5p1ZGwj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould compare two runs
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

{"level":30,"time":1768063228622,"env":"test","module":"auth-routes","userId":"c3ab2f73-fb13-4eb9-88d2-87f1f83be9c5","email":"test-projects-bMtPjjJIFgfdIX5p1ZGwj@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 2251[2mms[22m[39m
{"level":50,"time":1768063228839,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould identify changed input keys
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould return 404 if run A not found
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mGET /api/runs/compare[2m > [22m[2mshould return 404 if run B not found
[22m[39m[Shim] Request to /api/runs/compare, Session User ID: test-user-runs-stage8

{"level":30,"time":1768063229206,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/api.runs.graph.test.ts[2m > [22m[2mStage 8: Runs API Integration Tests[2m > [22m[2mRBAC and Tenant Isolation[2m > [22m[2mshould enforce tenant isolation on runs list
[22m[39m[Shim] Request to /api/runs, Session User ID: test-user-runs-stage8

{"level":30,"time":1768063229490,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 2976[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m displays columns in order based on orderIndex [33m 571[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 2764[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m renders boolean value as Yes/No [33m 639[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

stderr | tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests
Cleanup error (non-fatal): error: syntax error at or near "="
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.runs.graph.test.ts:252:9 {
  length: 90,
  severity: 'ERROR',
  code: '42601',
  detail: undefined,
  hint: undefined,
  position: '32',
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'scan.l',
  line: '1244',
  routine: 'scanner_yyerror'
}

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.runs.graph.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 4435[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should re-run workflow with same inputs [33m 354[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should re-run workflow with override inputs [33m 345[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce tenant isolation on runs list [33m 531[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/utils/pagination.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/intake.workflow.test.ts > Intake Workflow Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/intake.workflow.test.ts:20:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(267214ca-bda6-4e82-948d-67d4a2870bcf) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/intake.workflow.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 4179[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow designating a workflow as Intake [33m 1098[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow linking a downstream workflow to an intake workflow [33m 1419[2mms[22m[39m
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/dynamic_options_workflow.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/captcha.service.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063230339,"env":"test","module":"email-queue","jobId":"167f3599-1f2f-4443-8d72-5aae39c85dbe","to":"existing_1768063202527@test.com","subject":"You've been invited to join Invite Test Org","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 1682[2mms[22m[39m
[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/datavault/TemplateCard.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/datavault/ColumnTypeIcon.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/integration/organizationInvites.test.ts > Organization Invites > revokeInvite > should prevent accepting revoked invite
Failed to write audit log: error: insert or update on table "audit_logs" violates foreign key constraint "audit_logs_workspace_id_workspaces_id_fk"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at AuditLogger.log (C:/Users/scoot/poll/VaultLogic/server/lib/audit/auditLogger.ts:20:13)
    at OrganizationService.revokeInvite (C:/Users/scoot/poll/VaultLogic/server/services/OrganizationService.ts:833:7)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizationInvites.test.ts:349:13
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:20 {
  length: 341,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (workspace_id)=(00000000-0000-0000-0000-000000000098) is not present in table "workspaces".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'audit_logs',
  column: undefined,
  dataType: undefined,
  constraint: 'audit_logs_workspace_id_workspaces_id_fk',
  file: 'ri_triggers.c',
  line: '2599',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 1704[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/AIService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/shared/validation/Validator.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1768063231015,"env":"test","module":"user-credentials-repository","userId":"ddb39952-5184-4c8c-af87-b4d62f575083","msg":"User credentials created"}
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1768063231135,"env":"test","module":"email-queue","jobId":"a3c278bb-6307-4b9f-a50e-5ed0e786260b","to":"other-l_R8kwOxiv81X8MH6AQc0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/organizationInvites.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizationInvites.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 28622[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create placeholder user for non-existent email [33m 1637[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create invite for existing user without creating placeholder [33m 1404[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent duplicate pending invites [33m 1687[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent inviting existing members [33m 1140[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require admin access to create invite [33m 797[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set expiry to 7 days from now [33m 1422[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should accept invite and create membership [33m 2020[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should convert placeholder user to real user on accept [33m 2045[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired invite [33m 1690[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject already accepted invite [33m 2046[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should verify email matches invite [33m 1627[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid token [33m 970[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return pending invites for user email [33m 1615[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not return expired invites [33m 1676[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not return accepted invites [33m 2137[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to revoke invite [33m 1988[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent accepting revoked invite [33m 2180[2mms[22m[39m
{"level":30,"time":1768063231191,"env":"test","module":"auth-routes","userId":"ddb39952-5184-4c8c-af87-b4d62f575083","email":"other-l_R8kwOxiv81X8MH6AQc0@example.com","msg":"User registered"}
{"level":30,"time":1768063231385,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768063231387,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768063231387,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":66,"totalTokens":878,"durationMs":1,"estimatedCostUSD":0.00010760000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768063231390,"env":"test","module":"ai-service","duration":4,"workflowId":"123","changeCount":1,"msg":"AI workflow revision succeeded"}
{"level":30,"time":1768063231394,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768063231394,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768063231394,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":45,"totalTokens":857,"durationMs":0,"estimatedCostUSD":0.00009920000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768063231394,"env":"test","module":"ai-service","duration":0,"workflowId":"123","changeCount":0,"msg":"AI workflow revision succeeded"}
{"level":30,"time":1768063231395,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1768063231395,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768063231396,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":1,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1768063231396,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1768063231396,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1768063231397,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":2,"msg":"AI workflow revision failed"}
{"level":40,"time":1768063231397,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"actualOutputTokens":4,"responseLength":13,"msg":"Single-shot revision truncated - automatically retrying with chunking"}
{"level":30,"time":1768063231397,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1768063231397,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1768063231397,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1768063231397,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1768063231397,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":0,"msg":"AI workflow revision failed"}
{"level":50,"time":1768063231397,"env":"test","module":"ai-service","duration":2,"error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"msg":"AI workflow revision failed"}
 [32mÎ“Â£Ã´[39m tests/unit/services/AIService.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1661[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1818[2mms[22m[39m
{"level":30,"time":1768063231590,"env":"test","blockId":"d8aa687b-02ea-4430-84ea-05abc3d9f47c","virtualStepId":"69efb994-ca27-48f7-b1ff-76ab7d2cda7b","outputVar":"userList","msg":"Created read table block with virtual step"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.projects.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 4221[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should soft-delete project [33m 343[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow cross-tenant access [33m 972[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx [2m([22m[2m27 tests[22m[2m)[22m[33m 2159[2mms[22m[39m
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/TemplateCard.test.tsx [2m([22m[2m6 tests[22m[2m)[22m[33m 2385[2mms[22m[39m
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/client/choice-utils.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/dynamic_options_workflow.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1974[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should successfully configure a workflow with Read Table -> Dynamic Choice [33m 467[2mms[22m[39m
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/intake.portal.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/unit/client/choice-utils.test.ts > choice-utils > handles missing content gracefully
[generateOptionsFromList] Invalid list data: null

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/client/choice-utils.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 1783[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/session.management.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/docxRenderer2.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2217[2mms[22m[39m
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/builder.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 2238[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 1706[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/builder.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 1743[2mms[22m[39m
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/client/list-choice-options.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/unit/middleware/rbac.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/engine.expr.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/RunExecutionCoordinator.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/common/Breadcrumbs.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/shared/validation/PageValidator.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/unit/services/TemplateAnalysisService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":40,"time":1768063234758,"env":"test","module":"rbac-middleware","path":"/api/workflows","permission":"workflow:create","msg":"Unauthenticated user attempted to access protected resource"}
[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1768063234761,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permission":"workflow:create","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1768063234763,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"permission":"workflow:view","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1768063234765,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permissions":["workflow:create","workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (none of required permissions)"}
{"level":40,"time":1768063234767,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","permissions":["workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (missing some required permissions)"}
{"level":40,"time":1768063234769,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1768063234770,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"requiredRoles":["owner"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1768063234771,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","requiredRoles":["owner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768063234772,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"runner","requiredRoles":["owner","builder"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768063234774,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder","runner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1768063234777,"env":"test","module":"rbac-middleware","path":"/api/test","permission":"workflow:view","msg":"Unauthenticated user attempted to access protected resource"}
{"level":40,"time":1768063234778,"env":"test","module":"rbac-middleware","userId":"user-123","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":40,"time":1768063234778,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"invalid-role","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts [2m([22m[2m44 tests[22m[2m)[22m[33m 2241[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1822[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/RunExecutionCoordinator.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 2027[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 1801[2mms[22m[39m
stderr | tests/unit/utils/conditionalLogic.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 1838[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/PageValidator.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1869[2mms[22m[39m
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.expression-validation.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/common/Breadcrumbs.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 2100[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1741[2mms[22m[39m
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.dataSources.native.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063235753,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768063235773,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.expression-validation.test.ts[2m > [22m[2mExpression Validation API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063235761,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063235762,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063235767,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063235772,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063235772,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063235772,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063235772,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/intakeQuestionVisibility.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/repeater.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063236185,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1768063236206,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts[2m > [22m[2mData Sources API - Native Catalog
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063236193,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063236193,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063236201,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1768063236206,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1768063236206,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1768063236206,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1768063236206,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1768063236345,"env":"test","module":"user-credentials-repository","userId":"e6ec8153-5602-4024-8aea-233d03f850be","msg":"User credentials created"}
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768063236455,"env":"test","module":"email-queue","jobId":"52fd7970-0598-4863-9a2c-f35f601d7bc4","to":"test-dxwNUdkaggT4UEUaIxd75@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063236519,"env":"test","module":"auth-routes","userId":"e6ec8153-5602-4024-8aea-233d03f850be","email":"test-dxwNUdkaggT4UEUaIxd75@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mMOCK SETUP DONE. Mock questions: [
  {
    id: [32m'q1'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q1'[39m,
    order: [33m0[39m,
    isVirtual: [33mfalse[39m,
    alias: [32m'show'[39m,
    visibleIf: [1mnull[22m
  },
  {
    id: [32m'q2'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q2'[39m,
    order: [33m1[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: { op: [32m'equals'[39m, left: [36m[Object][39m, right: [36m[Object][39m }
  },
  {
    id: [32m'q3'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q3'[39m,
    order: [33m2[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: [1mnull[22m
  }
]
Calling getVisibleQuestionCount...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mCOUNT RESULT: [33m0[39m
Mock called times: [33m1[39m
Mock last call args: [ [ [32m'section1'[39m ] ]

{"level":50,"time":1768063236569,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/intakeQuestionVisibility.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 1937[2mms[22m[39m
[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/ScriptEngine.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1933[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1768063236767,"env":"test","module":"user-credentials-repository","userId":"417367e3-4e0f-4e1c-a8e9-0f2859c06775","msg":"User credentials created"}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/components/datavault/SortableColumnHeader.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1768063236877,"env":"test","module":"email-queue","jobId":"49eac846-960f-4b89-b0ed-776433359dc2","to":"test-vobwYTHlQb7QVoOJWAHm_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1768063236937,"env":"test","module":"auth-routes","userId":"417367e3-4e0f-4e1c-a8e9-0f2859c06775","email":"test-vobwYTHlQb7QVoOJWAHm_@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 1805[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/docxHelpers.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/unit/workflows/validation.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/mfa.flow.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/workflows/conditionTruthTable.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768063237577,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/integration/auth.routes.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":50,"time":1768063237767,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 2178[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.dataSources.native.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 2187[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should list databases and databases' tables in the catalog [33m 417[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1768063237952,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/integration/mfa.flow.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:190:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:170:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:132:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 1991[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts [2m([22m[2m66 tests[22m[2m)[22m[33m 2011[2mms[22m[39m
stderr | tests/integration/api.expression-validation.test.ts > Expression Validation API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:154:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.expression-validation.test.ts:75:5 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(e6ec8153-5602-4024-8aea-233d03f850be) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2755[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/shared/conditionEvaluator.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts [2m([22m[2m39 tests[22m[2m)[22m[33m 2045[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 1636[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/utils/encryption.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts [2m([22m[2m41 tests[22m[2m)[22m[33m 1762[2mms[22m[39m
[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 1799[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/workflow/QueryBlock.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

stderr | tests/unit/shared/conditionEvaluator.test.ts > conditionEvaluator > Comparison operators > Unknown operator > should default to true and log warning
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts [2m([22m[2m70 tests[22m[2m)[22m[33m 1910[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1777[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflow/QueryBlock.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1692[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/HelperLibrary.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

stderr | tests/unit/shared/validation/stepConfigSchemas.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts [2m([22m[2m60 tests[22m[2m)[22m[33m 1832[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2049[2mms[22m[39m
stderr | tests/unit/shared/workflowLogic.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/engine/Performance.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2040[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/utils/variableResolver.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/unit/shared/workflowLogic.test.ts > workflowLogic > evaluateRules > Operators > Unknown operator > should return false and log warning for unknown operator
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts [2m([22m[2m65 tests[22m[2m)[22m[33m 1972[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/Performance.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1765[2mms[22m[39m
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.ai.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/ai.service.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/utils/conditionalLogic-simple.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 1740[2mms[22m[39m
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

stderr | tests/unit/services/intakeNavigation.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/WorkflowOptimizationService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts [2m([22m[2m32 tests[22m[2m)[22m[33m 2463[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic-simple.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1851[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1768063242067,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768063242068,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"responseTokens":91,"totalTokens":1303,"durationMs":2,"estimatedCostUSD":0.014849999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768063242072,"env":"test","module":"workflow-quality-validator","overall":99,"breakdown":{"aliases":100,"types":100,"structure":100,"ux":95,"completeness":100,"validation":100},"issuesCount":1,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768063242073,"env":"test","module":"ai-service","duration":7,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":99,"qualityBreakdown":{"aliases":100,"types":100,"structure":100,"ux":95,"completeness":100,"validation":100},"qualityPassed":true,"issuesCount":1,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768063242076,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768063242077,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":49,"totalTokens":1250,"durationMs":1,"estimatedCostUSD":0.013479999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768063242078,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":2,"msg":"AI workflow generation failed"}
{"level":30,"time":1768063242082,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768063242083,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":68,"totalTokens":1269,"durationMs":1,"estimatedCostUSD":0.01405,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768063242083,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768063242086,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768063242086,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":89,"totalTokens":1290,"durationMs":0,"estimatedCostUSD":0.014679999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768063242086,"env":"test","module":"ai-service","error":{"code":"VALIDATION_ERROR","troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1768063242090,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1768063242090,"env":"test","module":"ai-service","attempt":0,"waitMs":1000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768063242090,"env":"test","module":"ai-service","attempt":1,"waitMs":2000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768063242090,"env":"test","module":"ai-service","attempt":2,"waitMs":4000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768063242090,"env":"test","module":"ai-service","attempt":3,"waitMs":8000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768063242090,"env":"test","module":"ai-service","attempt":4,"waitMs":16000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1768063242090,"env":"test","module":"ai-service","attempt":5,"waitMs":32000,"msg":"Rate limit hit, retrying..."}
{"level":50,"time":1768063242090,"env":"test","module":"ai-service","event":"ai_request_failed","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","errorType":"RATE_LIMIT","durationMs":1,"attempts":7,"msg":"AI request failed: rate limit"}
{"level":50,"time":1768063242091,"env":"test","module":"ai-service","error":{"code":"RATE_LIMIT","details":{"originalError":"Rate limit exceeded","retryAfterSeconds":60},"troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. You've hit the AI provider's rate limit\n2. Solutions:\n   - Wait 60 seconds and try again\n   - Check your API key quota at your provider's dashboard\n   - Consider upgrading your API plan for higher limits\n   - If using free tier, you may need to wait until limits reset"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1768063242097,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768063242137,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":6,"totalTokens":1207,"durationMs":40,"estimatedCostUSD":0.01219,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1768063242137,"env":"test","module":"ai-service","error":{},"duration":40,"msg":"AI workflow generation failed"}
{"level":30,"time":1768063242143,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768063242143,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"responseTokens":68,"totalTokens":1280,"durationMs":0,"estimatedCostUSD":0.004656,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768063242144,"env":"test","module":"workflow-quality-validator","overall":100,"breakdown":{"aliases":100,"types":100,"structure":100,"ux":100,"completeness":100,"validation":100},"issuesCount":0,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768063242144,"env":"test","module":"ai-service","duration":1,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":100,"qualityBreakdown":{"aliases":100,"types":100,"structure":100,"ux":100,"completeness":100,"validation":100},"qualityPassed":true,"issuesCount":0,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768063242150,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1768063242150,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"responseTokens":33,"totalTokens":1234,"durationMs":0,"estimatedCostUSD":0.004098,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768063242151,"env":"test","module":"workflow-quality-validator","overall":96,"breakdown":{"aliases":100,"types":100,"structure":80,"ux":100,"completeness":90,"validation":100},"issuesCount":2,"passed":true,"msg":"Workflow quality validation completed"}
{"level":30,"time":1768063242151,"env":"test","module":"ai-service","duration":1,"sectionsCount":1,"rulesCount":0,"blocksCount":0,"qualityScore":96,"qualityBreakdown":{"aliases":100,"types":100,"structure":80,"ux":100,"completeness":90,"validation":100},"qualityPassed":true,"issuesCount":2,"msg":"AI workflow generation succeeded"}
{"level":30,"time":1768063242156,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"maxTokens":4000,"msg":"AI request started"}
{"level":30,"time":1768063242156,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"responseTokens":44,"totalTokens":302,"durationMs":0,"estimatedCostUSD":0.0039,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1768063242157,"env":"test","module":"ai-service","duration":1,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
 [32mÎ“Â£Ã´[39m tests/unit/ai.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 2482[2mms[22m[39m
{"level":50,"time":1768063242180,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768063242182,"env":"test","module":"intake-navigation","error":{},"pageId":"page1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating skipIf condition"}
 [32mÎ“Â£Ã´[39m tests/unit/services/intakeNavigation.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 2508[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/integration/conditions/conditionEvaluation.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/WorkflowChangeAnalyzer.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowOptimizationService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 2310[2mms[22m[39m
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/WorkflowPatchService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/analytics_preservation.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 2149[2mms[22m[39m
{"level":30,"time":1768063242974,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1419[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return workflow if user is the creator [33m 1381[2mms[22m[39m
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 2319[2mms[22m[39m
[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 2228[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate TOTP secret, QR code, and backup codes [33m 356[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate unique backup codes [33m 369[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should try multiple codes if first doesn't match [33m 439[2mms[22m[39m
{"level":50,"time":1768063243196,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"datavault.createTable","databaseId":"db-123","name":"Submissions","columns":[{"name":"email","type":"text"},{"name":"submitted_at","type":"date"}]},"msg":"Failed to apply operation"}
[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768063243196,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"datavault.addColumns","tableId":"table-123","columns":[{"name":"phone","type":"text"}]},"msg":"Failed to apply operation"}
{"level":50,"time":1768063243199,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"step.create","sectionRef":"temp-section-1","type":"short_text","title":"Field 1","alias":"field1"},"msg":"Failed to apply operation"}
{"level":50,"time":1768063243232,"env":"test","module":"workflow-patch-service","error":{},"op":{"op":"document.bindFields","id":"template-123","bindings":{"client_name":"nonExistentAlias"}},"msg":"Failed to apply operation"}
 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowPatchService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 2243[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/analytics_preservation.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1021[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should preserve lifetime user count when a user is deleted [33m 485[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

stderr | tests/unit/repositories/DocumentTemplateRepository.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/schema/collections.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/unit/middleware/auth.middleware.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/schema/documentEngine.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1177[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/DatavaultColumnsService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/services/EmailTemplateMetadataService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1768063245839,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/schema/collections.test.ts [2m([22m[2m34 tests[22m[2m)[22m[33m 1034[2mms[22m[39m
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768063245858,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245860,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245861,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245861,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245862,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245865,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245870,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245871,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245871,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1768063245871,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1768063245873,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
 [32mÎ“Â£Ã´[39m tests/unit/middleware/auth.middleware.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 2763[2mms[22m[39m
[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts [2m([22m[2m33 tests[22m[2m)[22m[33m 1049[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/repositories/DatavaultTablesRepository.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/DocumentTemplateService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 829[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts[2m > [22m[2mDatavaultColumnsService[2m > [22m[2mgetColumns[2m > [22m[2mshould throw 404 if table not found
[22m[39m[DEBUG] Table not found: 660e8400-e29b-41d4-a716-446655440001

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 952[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/DatavaultTablesService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/CollectionService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1040[2mms[22m[39m
[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/lib/queries/QueryRunner.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

stderr | tests/unit/repositories/DatavaultColumnsRepository.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 850[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/ListTools.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 609[2mms[22m[39m
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 657[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1008[2mms[22m[39m
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 804[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":40,"time":1768063247774,"env":"test","sourceListVar":"nonexistent_list","inputKey":"nonexistent_list","msg":"Input list not found, treating as empty array"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ListTools.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 614[2mms[22m[39m
{"level":30,"time":1768063247960,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/DataSourceService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 785[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/LifecycleHookService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/CollectionFieldService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/engine.run-conditions.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 721[2mms[22m[39m
{"level":40,"time":1768063250248,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1768063250252,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1768063250254,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1768063250260,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1768063250262,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 847[2mms[22m[39m
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/branding.routes.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip question when condition is false
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q1 executed. Key: has_code, Value: true. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q2 executed. Key: code, Value: ABC123. Context keys: 5

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip compute node when condition is false
[DEBUG Question] Node q1 executed. Key: amount, Value: 0. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute compute node when condition is true
[DEBUG Question] Node q1 executed. Key: amount, Value: 100. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q3 executed. Key: amount, Value: 1000. Context keys: 5

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should return trace when debug is enabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should not return trace when debug is disabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/engine.run-conditions.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 897[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate a simple graph[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should detect duplicate node IDs[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should detect invalid edge references[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate node conditions[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should detect typos in variable names[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate compute node expressions[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate branch conditions[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate template bindings[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should skip question when condition is false[32m 11[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should execute question when condition is true[32m 5[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should skip compute node when condition is false[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should execute compute node when condition is true[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle complex workflow with multiple conditions[39m[32m 214[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return trace when debug is enabled[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should not return trace when debug is disabled[32m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/RecordService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/datavault.api-tokens.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/unit/services/StepService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/api.ai.revise.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 770[2mms[22m[39m
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/api.ai.logic.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 595[2mms[22m[39m
[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 613[2mms[22m[39m
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/StepService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 634[2mms[22m[39m
{"level":30,"time":1768063251797,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063251840,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","descriptionLength":26,"msg":"AI logic generation requested"}
{"level":30,"time":1768063251841,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","duration":2,"changeCount":0,"msg":"AI logic generation succeeded"}
{"level":30,"time":1768063251852,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":30,"time":1768063251885,"env":"test","module":"ai-controller","userId":"user-123","workflowId":"123e4567-e89b-12d3-a456-426614174000","msg":"AI workflow revision job enqueued"}
{"level":30,"time":1768063251890,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063251900,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1768063251912,"env":"test","module":"ai-controller","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["workflowId"]},{"code":"invalid_type","expected":"object","received":"undefined","path":["currentWorkflow"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["userInstruction"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1768063251942,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/api.ai.revise.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 834[2mms[22m[39m
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/api.ai.logic.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 728[2mms[22m[39m
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

{"level":30,"time":1768063252150,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768063252163,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
 [32mÎ“Â£Ã´[39m tests/unit/external/ExternalSendRunner.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 22[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/services/BrandingService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts [2m([22m[2m42 tests[22m[2m)[22m[32m 201[2mms[22m[39m
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/writes/WriteRunner.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/datavault.row-notes.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1768063252966,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768063253136,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1768063253136,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1768063253138,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1768063253140,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1768063253140,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
 [32mÎ“Â£Ã´[39m tests/unit/writes/WriteRunner.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 186[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 646[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/debugging/Lineage.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/workflow/PreviewExecution.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 606[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/datavault.routes.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

stderr | tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should generate execution trace with lineage
[DEBUG Question] Node q1 executed. Key: userName, Value: Alice. Context keys: 3

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/debugging/Lineage.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 628[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 27[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 22[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 601[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflow/PreviewExecution.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 932[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 26[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/BlockRunner.validate.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 17[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 24[2mms[22m[39m
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/debug_import.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.ai.personalization.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): Error: No file ./migrations/0008_flashy_jimmy_woo.sql found in ./migrations folder
    at readMigrationFiles (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/migrator.js:26:13)
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:3:22)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:120:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 100[2mms[22m[39m
[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/Guardrail.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 19[2mms[22m[39m
{"level":30,"time":1768063255593,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts[2m > [22m[2mPersonalization API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1768063255601,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1768063255602,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1768063255606,"env":"test","module":"documents-routes","msg":"Document routes registered"}
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/debug_import.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 617[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.ai.personalization.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 937[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… DB module loaded but appears to be a mock. Skipping real DB setup.

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/FinalBlockSnapshot.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 13[2mms[22m[39m
[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 2 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/ai/workflowEdit.test.ts > POST /api/workflows/:workflowId/ai/edit - Integration Test
error: duplicate key value violates unique constraint "tenants_pkey"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/ai/workflowEdit.test.ts:72:22
     70| 
     71|     // Create test tenant (with valid UUID to avoid syntax error)
     72|     const [tenant] = await db.insert(tenants).values({
       |                      ^
     73|       id: '987fcdeb-51a2-43d7-9012-345678901234',
     74|       name: 'Test Tenant',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/199]Î“Ã„Â»

 FAIL  tests/integration/auth/portal.authentication.test.ts [ tests/integration/auth/portal.authentication.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/auth/portal.authentication.test.ts
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/199]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 197 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/analytics_service.test.ts > Analytics Service Integration > should generate events and metrics on run completion
Error: Workflow is not active
 Î“Â¥Â» RunAuthResolver.verifyCreateAccess server/services/runs/RunAuthResolver.ts:110:53
    108| 
    109|             if (!workflow) throw new Error('Workflow not found');
    110|             if (workflow.status !== 'active') throw new Error('WorkfloÎ“Ã‡Âª
       |                                                     ^
    111|             if (!workflow.isPublic) throw new Error('Workflow is not pÎ“Ã‡Âª
    112| 
 Î“Â¥Â» RunService.createRun server/services/RunService.ts:202:22
 Î“Â¥Â» tests/integration/analytics_service.test.ts:42:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/199]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should analyze a DOCX file and return variables
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:143:37
    141|                 } catch (e) { console.log("FAIL_BODY: " + response.texÎ“Ã‡Âª
    142|             }
    143|             expect(response.status).toBe(200);
       |                                     ^
    144| 
    145|             expect(response.body.data).toHaveProperty("variables");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/199]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should fail if no file is provided
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:168:18
    166|             await request(baseURL)
    167|                 .post("/api/ai/doc/analyze")
    168|                 .expect(400);
       |                  ^
    169|         });
    170|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/199]Î“Ã„Â»

 FAIL  tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > GET /api/runs/:id/download - Download Generated DOCX > should download DOCX output from successful run
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/api.runs.docx.test.ts:277:10
    275|         .get(`/api/runs/${runId}/download?type=docx`)
    276|         .set('Authorization', `Bearer ${authToken}`)
    277|         .expect(200);
       |          ^
    278| 
    279|       expect(response.headers['content-type']).toBe(
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/199]Î“Ã„Â»

 FAIL  tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests > GET /api/runs/:id/download - Download Generated DOCX > should return 404 for PDF when not generated
AssertionError: expected '{"error":{"code":"NOT_FOUND","messageÎ“Ã‡Âª' to contain 'PDF'

Expected: "PDF"
Received: "{"error":{"code":"NOT_FOUND","message":"Run output not available not found"}}"

 Î“Â¥Â» tests/integration/api.runs.docx.test.ts:293:45
    291|         .expect(404);
    292| 
    293|       expect(JSON.stringify(response.body)).toContain('PDF');
       |                                             ^
    294|     });
    295| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/199]Î“Ã„Â»

 FAIL  tests/integration/api.snapshots.test.ts > Stage 13: Workflow Snapshots & Versioning > should maintain immutability of runs across versions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/api.snapshots.test.ts:199:37
    197|         // 7. Verify Run 1 still sees Version 1 Question
    198|         const run1Response = await agent.get(`/api/runs/${run1.id}`);
    199|         expect(run1Response.status).toBe(200);
       |                                     ^
    200|         const run1Graph = run1Response.body.workflowVersion.graphJson;
    201|         expect(run1Graph.nodes[0].config.question).toBe('Version 1 QueÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/199]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Templates API > POST /api/projects/:ctx.projectId/templates > should reject non-docx files
Error: expected 500 "Internal Server Error", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:119:12
    117|           .field("name", "Test Template")
    118|           .attach("file", mockPdf, "test.pdf")
    119|           .expect(500); // Multer rejects before handler
       |            ^
    120|       });
    121| 
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/199]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Runs API > POST /api/workflows/:id/run > should reject without required permission
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:289:12
    287|           .post("/api/auth/register")
    288|           .send({ email: viewerEmail, password: "TestPassword123" })
    289|           .expect(201);
       |            ^
    290| 
    291|         await db.update(schema.users)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/199]Î“Ã„Â»

 FAIL  tests/integration/api.workflows.test.ts > Workflows API Integration Tests > PUT /api/workflows/:id/move > should reject move to project user does not have access to
Error: Login failed: 401 {"success":false,"error":{"code":"AUTH_004","message":"Invalid credentials","details":{"errorType":"InvalidCredentialsError"},"timestamp":"2026-01-10T16:40:01.321Z"}}
 Î“Â¥Â» tests/integration/api.workflows.test.ts:396:15
    394| 
    395|       if (loginResponse2.status !== 200) {
    396|         throw new Error(`Login failed: ${loginResponse2.status} ${JSONÎ“Ã‡Âª
       |               ^
    397|       }
    398|       if (!loginResponse2.body.token) {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Complete Registration Î“Ã¥Ã† Login Flow > should complete registration, verify email, then login
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:55:36
     53|         .send({ email, password });
     54| 
     55|       expect(loginAttempt1.status).toBe(403);
       |                                    ^
     56|       expect(loginAttempt1.body.message || loginAttempt1.body.error).tÎ“Ã‡Âª
     57| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should lock account after 5 failed attempts, then unlock after waiting
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:110:36
    108|         });
    109| 
    110|       expect(lockedAttempt.status).toBe(423);
       |                                    ^
    111|       expect(lockedAttempt.body.message || lockedAttempt.body.error).tÎ“Ã‡Âª
    112| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should record all login attempts
AssertionError: expected 1 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 1

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:145:31
    143|       });
    144| 
    145|       expect(attempts.length).toBe(3);
       |                               ^
    146|       expect(attempts.filter(a => !a.successful).length).toBe(2);
    147|       expect(attempts.filter(a => a.successful).length).toBe(1);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should complete MFA setup and login with TOTP
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:167:36
    165|         .set("Authorization", `Bearer ${token}`);
    166| 
    167|       expect(setupResponse.status).toBe(200);
       |                                    ^
    168|       expect(setupResponse.body.qrCodeDataUrl).toBeDefined();
    169|       expect(setupResponse.body.backupCodes).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should login with backup code when TOTP unavailable
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:248:52
    246|       });
    247| 
    248|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    249| 
    250|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Password Reset Flow > should complete full password reset flow
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:332:36
    330|         });
    331| 
    332|       expect(resetResponse.status).toBe(200);
       |                                    ^
    333| 
    334|       // Step 4: Verify old password no longer works

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should rotate refresh token on each use
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:415:40
    413|           .set('Cookie', refreshTokenCookie!);
    414| 
    415|         expect(refreshResponse.status).toBe(200);
       |                                        ^
    416|         expect(refreshResponse.body.token).toBeDefined();
    417| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should detect and prevent refresh token reuse (token theft)
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:438:44
    436| 
    437|       const cookies = loginResponse.headers['set-cookie'] as unknown aÎ“Ã‡Âª
    438|       const originalRefreshToken = cookies.find(c => c.startsWith('refÎ“Ã‡Âª
       |                                            ^
    439| 
    440|       // Use token once (rotation happens)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should list all active sessions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:492:39
    490|         .set("Authorization", `Bearer ${token}`);
    491| 
    492|       expect(sessionsResponse.status).toBe(200);
       |                                       ^
    493|       expect(sessionsResponse.body.sessions).toBeDefined();
    494|       expect(sessionsResponse.body.sessions.length).toBeGreaterThanOrEÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[20/199]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:517:40
    515| 
    516|       const sessions = sessionsResponse.body.sessions;
    517|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    518| 
    519|       // Revoke first session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[21/199]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should login with valid credentials
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:138:31
    136|         .send({ email, password });
    137| 
    138|       expect(response.status).toBe(200);
       |                               ^
    139|       expect((response.body as any).message).toBe("Login successful");
    140|       expect((response.body as any).token).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[22/199]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return 403 for unverified email
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:192:31
    190|         .send({ email, password });
    191| 
    192|       expect(response.status).toBe(403);
       |                               ^
    193|       expect(response.body.message || response.body.error).toBeDefinedÎ“Ã‡Âª
    194|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[23/199]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return requiresMfa=true for MFA-enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:223:31
    221|         .send({ email, password });
    222| 
    223|       expect(response.status).toBe(200);
       |                               ^
    224|       expect(response.body.requiresMfa).toBe(true);
    225|       expect(response.body.userId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[24/199]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should lock account after 5 failed attempts
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:250:31
    248|         });
    249| 
    250|       expect(response.status).toBe(423);
       |                               ^
    251|       expect(response.body).toBeDefined();
    252|       expect(response.body.error || response.body.message).toBeDefinedÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[25/199]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/logout > should logout and clear refresh token cookie
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:266:23
    264| 
    265|       const cookies = (loginResponse.headers as any)['set-cookie'] as Î“Ã‡Âª
    266|       expect(cookies).toBeDefined();
       |                       ^
    267|       const refreshTokenCookie = cookies!.find(c => c.startsWith('refrÎ“Ã‡Âª
    268|       expect(refreshTokenCookie).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[26/199]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
AssertionError: expected +0 to be 100 // Object.is equality

- Expected
+ Received

- 100
+ 0

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:713:46
    711|       expect(response.status).toBe(200);
    712|       expect(response.body.rows).toHaveLength(25);
    713|       expect(response.body.pagination.total).toBe(100);
       |                                              ^
    714|     });
    715| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[27/199]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Error Handling > should return user-friendly error for missing required fields
AssertionError: expected 403 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:758:31
    756| 
    757|       // Improved error handling returns 400
    758|       expect(response.status).toBe(400);
       |                               ^
    759|       expect(response.body.message).toBeDefined();
    760|       expect(response.body.message).toContain('Required');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[28/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow owner to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:154:26
    152|         .set('Cookie', ownerCookie);
    153| 
    154|       expect(res.status).toBe(200);
       |                          ^
    155|       expect(res.body.id).toBe(tableId);
    156|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[29/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow writer to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:163:26
    161|         .set('Cookie', writerCookie);
    162| 
    163|       expect(res.status).toBe(200);
       |                          ^
    164|       expect(res.body.id).toBe(tableId);
    165|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[30/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow reader to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:172:26
    170|         .set('Cookie', readerCookie);
    171| 
    172|       expect(res.status).toBe(200);
       |                          ^
    173|       expect(res.body.id).toBe(tableId);
    174|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[31/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should deny non-member from reading table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:181:26
    179|         .set('Cookie', nonMemberCookie);
    180| 
    181|       expect(res.status).toBe(403);
       |                          ^
    182|       expect(res.body.message).toContain('Access denied');
    183|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[32/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should allow owner to update table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:193:26
    191|         .send({ description: 'Updated by owner' });
    192| 
    193|       expect(res.status).toBe(200);
       |                          ^
    194|     });
    195| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[33/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should deny writer from updating table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:202:26
    200|         .send({ description: 'Attempt by writer' });
    201| 
    202|       expect(res.status).toBe(403);
       |                          ^
    203|       expect(res.body.message).toContain('Access denied');
    204|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[34/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should deny reader from updating table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:212:26
    210|         .send({ description: 'Attempt by reader' });
    211| 
    212|       expect(res.status).toBe(403);
       |                          ^
    213|       expect(res.body.message).toContain('Access denied');
    214|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[35/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny writer from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:223:26
    221|         .set('Cookie', writerCookie);
    222| 
    223|       expect(res.status).toBe(403);
       |                          ^
    224|       expect(res.body.message).toContain('Access denied');
    225|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[36/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny reader from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:232:26
    230|         .set('Cookie', readerCookie);
    231| 
    232|       expect(res.status).toBe(403);
       |                          ^
    233|       expect(res.body.message).toContain('Access denied');
    234|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[37/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny non-member from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:241:26
    239|         .set('Cookie', nonMemberCookie);
    240| 
    241|       expect(res.status).toBe(403);
       |                          ^
    242|       expect(res.body.message).toContain('Access denied');
    243|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[38/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should allow owner to view permissions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:252:26
    250|         .set('Cookie', ownerCookie);
    251| 
    252|       expect(res.status).toBe(200);
       |                          ^
    253|       expect(Array.isArray(res.body)).toBe(true);
    254|       expect(res.body.length).toBe(2); // writer and reader

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[39/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should deny writer from viewing permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:262:26
    260|         .set('Cookie', writerCookie);
    261| 
    262|       expect(res.status).toBe(403);
       |                          ^
    263|       expect(res.body.message).toContain('Access denied');
    264|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[40/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should deny reader from viewing permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:271:26
    269|         .set('Cookie', readerCookie);
    270| 
    271|       expect(res.status).toBe(403);
       |                          ^
    272|       expect(res.body.message).toContain('Access denied');
    273|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[41/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should allow owner to grant permissions
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:283:26
    281|         .send({ userId: nonMemberId, role: 'read' });
    282| 
    283|       expect(res.status).toBe(201);
       |                          ^
    284|       expect(res.body.userId).toBe(nonMemberId);
    285|       expect(res.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[42/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should allow owner to update existing permission (upsert)
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:301:26
    299|         .send({ userId: readerId, role: 'write' }); // Upgrade reader Î“Ã‡Âª
    300| 
    301|       expect(res.status).toBe(201);
       |                          ^
    302|       expect(res.body.role).toBe('write');
    303| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[43/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should deny writer from granting permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:317:26
    315|         .send({ userId: nonMemberId, role: 'read' });
    316| 
    317|       expect(res.status).toBe(403);
       |                          ^
    318|       expect(res.body.message).toContain('Access denied');
    319|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[44/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should prevent modifying table owner permissions
AssertionError: expected 401 to be 500 // Object.is equality

- Expected
+ Received

- 500
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:327:26
    325|         .send({ userId: ownerId, role: 'read' });
    326| 
    327|       expect(res.status).toBe(500);
       |                          ^
    328|       expect(res.body.message).toContain('Cannot modify permissions foÎ“Ã‡Âª
    329|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[45/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/permissions/:permissionId > should allow owner to revoke permissions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:347:26
    345|         .set('Cookie', ownerCookie);
    346| 
    347|       expect(res.status).toBe(200);
       |                          ^
    348|       expect(res.body.success).toBe(true);
    349| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[46/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/permissions/:permissionId > should deny writer from revoking permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:370:26
    368|         .set('Cookie', writerCookie);
    369| 
    370|       expect(res.status).toBe(403);
       |                          ^
    371|       expect(res.body.message).toContain('Access denied');
    372|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[47/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce owner includes write and read
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:381:30
    379|         .get(`/api/datavault/tables/${tableId}`)
    380|         .set('Cookie', ownerCookie);
    381|       expect(readRes.status).toBe(200);
       |                              ^
    382| 
    383|       // Owner can update table

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[48/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce write includes read but not owner
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:396:30
    394|         .get(`/api/datavault/tables/${tableId}`)
    395|         .set('Cookie', writerCookie);
    396|       expect(readRes.status).toBe(200);
       |                              ^
    397| 
    398|       // Writer cannot update table schema

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[49/199]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce read is read-only
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:411:30
    409|         .get(`/api/datavault/tables/${tableId}`)
    410|         .set('Cookie', readerCookie);
    411|       expect(readRes.status).toBe(200);
       |                              ^
    412| 
    413|       // Reader cannot update

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[50/199]Î“Ã„Â»

 FAIL  tests/integration/js_helpers.test.ts > Detailed Verification: JS Helper Availability > should execute a JS block that uses helper functions
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/js_helpers.test.ts:136:31
    134|         // 3. Create a Run
    135|         const runRes = await agent.post(`/api/workflows/${workflowId}/Î“Ã‡Âª
    136|         expect(runRes.status).toBe(201); // 201 Created
       |                               ^
    137|         const runId = runRes.body.id;
    138| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[51/199]Î“Ã„Â»

 FAIL  tests/integration/metrics.test.ts > Metrics Integration > should expose /metrics endpoint
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/metrics.test.ts:33:33
     31|         const response = await request(app).get('/metrics');
     32| 
     33|         expect(response.status).toBe(200);
       |                                 ^
     34|         expect(response.headers['content-type']).toContain('text/plainÎ“Ã‡Âª
     35|         // Prometheus metrics usually contain comments like # HELP or Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[52/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should complete full MFA setup flow
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:68:25
     66|       });
     67| 
     68|       expect(mfaSecret).toBeDefined();
       |                         ^
     69|       expect(mfaSecret!.enabled).toBe(false); // Not enabled until verÎ“Ã‡Âª
     70| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[53/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should reject invalid TOTP code during setup
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:117:37
    115|         .send({ token: "000000" }); // Invalid code
    116| 
    117|       expect(verifyResponse.status).toBe(400);
       |                                     ^
    118|       expect(verifyResponse.body.message).toContain("Invalid");
    119| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[54/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should not allow MFA setup if already enabled
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:135:46
    133|         .send({ email, password });
    134| 
    135|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    136| 
    137|       // Can't test setup with MFA user since we can't login without MÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[55/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should store hashed backup codes
AssertionError: expected [] to have a length of 10 but got +0

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:177:27
    175|       });
    176| 
    177|       expect(storedCodes).toHaveLength(10);
       |                           ^
    178| 
    179|       // Hashes should not match plain codes

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[56/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should require MFA for enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:195:36
    193|         .send({ email, password });
    194| 
    195|       expect(loginResponse.status).toBe(200);
       |                                    ^
    196|       expect(loginResponse.body.requiresMfa).toBe(true);
    197|       expect(loginResponse.body.userId).toBe(userId);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[57/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should complete MFA login with valid TOTP
Error: [TEST UTILS] MFA Secret verification failed for a12e959e25f5562b73f6c20570baf0fc
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:202:55

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[58/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should accept TOTP codes within 60-second window
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:264:32
    262|         .send({ userId, token: totpCode });
    263| 
    264|       expect(response1.status).toBe(200);
       |                                ^
    265| 
    266|       // Login again for second test

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[59/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should login with valid backup code
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:305:52
    303|       });
    304| 
    305|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    306| 
    307|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[60/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should prevent backup code reuse
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:375:52
    373|       });
    374| 
    375|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    376| 
    377|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[61/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Status > should return MFA status for user
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:446:37
    444|         .set("Authorization", `Bearer ${loginResponse.body.token}`);
    445| 
    446|       expect(statusResponse.status).toBe(200);
       |                                     ^
    447|       expect(statusResponse.body.mfaEnabled).toBe(false);
    448|       expect(statusResponse.body.backupCodesRemaining).toBe(0);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[62/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Status > should return backup codes count for MFA users
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:464:52
    462|       });
    463| 
    464|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    465| 
    466|       const mfaLoginResponse = await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[63/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should disable MFA with password verification
Error: [TEST UTILS] MFA Secret verification failed for a4e8a630859768f7a22059c2467e3542
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:488:55

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[64/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should require correct password to disable MFA
AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:557:44
    555| 
    556|       expect(disableResponse.status).toBe(401);
    557|       expect(disableResponse.body.message).toContain("Invalid passwordÎ“Ã‡Âª
       |                                            ^
    558| 
    559|       // MFA should still be enabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[65/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should regenerate backup codes
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:588:41
    586|         .set("Authorization", `Bearer ${token}`);
    587| 
    588|       expect(regenerateResponse.status).toBe(200);
       |                                         ^
    589|       expect(regenerateResponse.body.backupCodes).toHaveLength(10);
    590| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[66/199]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should return error if MFA not enabled
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:612:31
    610|         .set("Authorization", `Bearer ${loginResponse.body.token}`);
    611| 
    612|       expect(response.status).toBe(400);
       |                               ^
    613|       expect(response.body.message).toContain("not enabled");
    614|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[67/199]Î“Ã„Â»

 FAIL  tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #7: Delete organization > should prevent deletion if org owns assets
AssertionError: promise resolved "undefined" instead of rejecting

- Expected: 
Error {
  "message": "rejected promise",
}

+ Received: 
undefined

 Î“Â¥Â» tests/integration/organizations-audit-fixes.test.ts:246:7
    244|       await expect(
    245|         organizationService.deleteOrganization(org.id, user1Id)
    246|       ).rejects.toThrow(/owns workflows/i);
       |       ^
    247| 
    248|       // Cleanup

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[68/199]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 1. Required + Show/Hide (Questions) > should NOT block Next when required question is hidden
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:197:31
    195|             // Check visibility
    196|             const isVisible = evaluateVisibilityExpression("show_triggÎ“Ã‡Âª
    197|             expect(isVisible).toBe(false);
       |                               ^
    198| 
    199|             // Required question is hidden, should not block

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[69/199]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 2. Required + Show/Hide (Pages) > should skip hidden required page entirely
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:330:31
    328|             const isVisible = evaluateVisibilityExpression((section2.vÎ“Ã‡Âª
    329| 
    330|             expect(isVisible).toBe(false); // Section 2 should be hiddÎ“Ã‡Âª
       |                               ^
    331| 
    332|             // Get all sections

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[70/199]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 3. Preview/Snapshot/Live Parity > should evaluate visibility consistently across modes
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:445:64
    443|             // Change data
    444|             const data2 = { trigger: false, value: 10 };
    445|             expect(evaluateVisibilityExpression(expr1, data2)).toBe(faÎ“Ã‡Âª
       |                                                                ^
    446|             expect(evaluateVisibilityExpression(expr2, data2)).toBe(trÎ“Ã‡Âª
    447|             expect(evaluateVisibilityExpression(expr3, data2)).toBe(faÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[71/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should list all active sessions for current user
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:53:31
     51|         .set("Authorization", `Bearer ${token}`);
     52| 
     53|       expect(response.status).toBe(200);
       |                               ^
     54|       expect(response.body.sessions).toBeDefined();
     55|       expect(response.body.sessions.length).toBe(3);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[72/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should mark current session correctly
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:85:30
     83|       const token = login2.body.token;
     84|       const cookies = (login2.headers as any)["set-cookie"] as string[Î“Ã‡Âª
     85|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
     86| 
     87|       // List sessions with cookie (should identify current session)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[73/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should exclude revoked sessions
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:120:50
    118|         .update(refreshTokens)
    119|         .set({ revoked: true })
    120|         .where(eq(refreshTokens.id, allTokens[0].id));
       |                                                  ^
    121| 
    122|       // List sessions

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[74/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should order sessions by last used (most recent first)
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:154:36
    152| 
    153|       // Should be ordered by lastUsedAt descending
    154|       for (let i = 1; i < sessions.length; i++) {
       |                                    ^
    155|         const prev = new Date(sessions[i - 1].lastUsedAt);
    156|         const curr = new Date(sessions[i].lastUsedAt);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[75/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should filter sessions by current user only
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:184:37
    182|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    183| 
    184|       expect(response.body.sessions.length).toBe(2);
       |                                     ^
    185|     });
    186| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[76/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:215:40
    213| 
    214|       const sessions = sessionsResponse.body.sessions;
    215|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    216| 
    217|       // Revoke non-current session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[77/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:249:30
    247|       const token = login.body.token;
    248|       const cookies = (login.headers as any)["set-cookie"] as string[];
    249|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    250| 
    251|       // Get sessions

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[78/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking other user's session
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:303:49
    301|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    302| 
    303|       const user1SessionId = user1Sessions.body.sessions[0].id;
       |                                                 ^
    304| 
    305|       // Try to revoke user 1's session as user 2

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[79/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all other sessions
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:329:30
    327|       const token = currentLogin.body.token;
    328|       const cookies = (currentLogin.headers as any)["set-cookie"] as sÎ“Ã‡Âª
    329|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    330| 
    331|       // Revoke all except current

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[80/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should keep current session active
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:380:38
    378|         .set("Cookie", cookie!);
    379| 
    380|       expect(refreshResponse.status).toBe(200);
       |                                      ^
    381|     });
    382| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[81/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should return 400 if no active session found
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:397:31
    395|         .set("Authorization", `Bearer ${token}`);
    396| 
    397|       expect(response.status).toBe(400);
       |                               ^
    398|       expect(response.body.message).toContain("No active session");
    399|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[82/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all trusted devices
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:410:30
    408|       const token = login.body.token;
    409|       const cookies = (login.headers as any)["set-cookie"] as string[];
    410|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    411| 
    412|       // Trust a device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[83/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should handle user with single session gracefully
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/session.management.real.test.ts:456:53
    454|         .set("Authorization", `Bearer ${token}`);
    455| 
    456|       expect(sessionsResponse.body.sessions.length).toBe(1);
       |                                                     ^
    457|     });
    458|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[84/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > Session Security > should not expose sensitive token data
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:493:37
    491|         .set("Authorization", `Bearer ${login.body.token}`);
    492| 
    493|       const session = response.body.sessions[0];
       |                                     ^
    494| 
    495|       // Should NOT include token hash or metadata

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[85/199]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > Session Security > should track session activity timestamps
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:511:37
    509|         .set("Authorization", `Bearer ${login.body.token}`);
    510| 
    511|       const session = response.body.sessions[0];
       |                                     ^
    512| 
    513|       expect(session.createdAt).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[86/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should trust current device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:52:36
     50|         .set("X-Forwarded-For", "192.168.1.100");
     51| 
     52|       expect(trustResponse.status).toBe(200);
       |                                    ^
     53|       expect(trustResponse.body.message).toContain("trusted");
     54|       expect(trustResponse.body.trustedUntil).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[87/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should set trust expiry to 30 days
AssertionError: expected NaN to be 30 // Object.is equality

- Expected
+ Received

- 30
+ NaN

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:92:24
     90|       );
     91| 
     92|       expect(diffDays).toBe(30);
       |                        ^
     93|     });
     94| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[88/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should update expiry if device already trusted
Error: [TEST UTILS] MFA Secret verification failed for 133ca55b43ebbea6eea9e1625e51e01c
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:96:55

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[89/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should list all trusted devices
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:193:31
    191|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    192| 
    193|       expect(response.status).toBe(200);
       |                               ^
    194|       expect(response.body.devices).toBeDefined();
    195|       expect(response.body.devices.length).toBe(2);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[90/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should mark current device
Error: [TEST UTILS] MFA Secret verification failed for 1066ad71228c4f828841e6fbb1faeac2
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:210:55

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[91/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude revoked devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:269:36
    267|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    268| 
    269|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    270|     });
    271| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[92/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude expired devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:302:36
    300|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    301| 
    302|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    303|     });
    304|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[93/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should revoke specific device
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:332:45
    330|         .set("Authorization", `Bearer ${token}`);
    331| 
    332|       const deviceId = devicesResponse.body.devices[0].id;
       |                                             ^
    333| 
    334|       // Revoke device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[94/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should return 404 for non-existent device
AssertionError: expected 401 to be 404 // Object.is equality

- Expected
+ Received

- 404
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:371:31
    369|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    370| 
    371|       expect(response.status).toBe(404);
       |                               ^
    372|     });
    373| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[95/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should prevent revoking other user's device
Error: [TEST UTILS] MFA Secret verification failed for 54e3e72178a8f7436cee24a509275dc6
 Î“Â¥Â» createUserWithMfa tests/helpers/testUtils.ts:182:21
    180|     where: eq(mfaSecrets.userId, userData.userId)
    181|   });
    182|   if (!check) throw new Error(`[TEST UTILS] MFA Secret verification faÎ“Ã‡Âª
       |                     ^
    183|   if (!check.enabled) throw new Error(`[TEST UTILS] MFA Secret enabledÎ“Ã‡Âª
    184|   console.log(`[TEST UTILS] MFA Secret verified for ${userData.userId}Î“Ã‡Âª
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:375:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[96/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should skip MFA for trusted device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:453:42
    451| 
    452|       // Should not require MFA
    453|       expect(secondLoginResponse.status).toBe(200);
       |                                          ^
    454|       expect(secondLoginResponse.body.requiresMfa).toBeUndefined();
    455|       expect(secondLoginResponse.body.token).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[97/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should require MFA for untrusted device
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:485:51
    483| 
    484|       // Should require MFA
    485|       expect(loginFromNewDevice.body.requiresMfa).toBe(true);
       |                                                   ^
    486|     });
    487| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[98/199]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should update lastUsedAt on trusted device login
TypeError: Cannot read properties of undefined (reading 'lastUsedAt')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:512:38
    510|       });
    511| 
    512|       const firstLastUsed = device1!.lastUsedAt;
       |                                      ^
    513| 
    514|       // Wait a bit

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[99/199]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should create a version and populate changelog
Error: Validation failed: Schema Error: id - Required, Schema Error: title - Required, Schema Error: pages.0.title - Required, Schema Error: pages.0.order - Required
 Î“Â¥Â» VersionService.publishVersion server/services/VersionService.ts:287:13
    285| 
    286|     if (!validation.valid && !force) {
    287|       throw new Error(`Validation failed: ${validation.errors.join(', Î“Ã‡Âª
       |             ^
    288|     }
    289| 
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:97:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[100/199]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should track execution lineage via snapshot
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:117:143
    115| 
    116|         // Create Snapshot
    117|         const snapshot = await snapshotService.createSnapshot(workflowÎ“Ã‡Âª
       |                                                                                                                                               ^
    118| 
    119|         expect(snapshot.workflowVersionId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[101/199]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:68:43
     66| 
     67|       // Should be validating immediately
     68|       expect(result.current.isValidating).toBe(true);
       |                                           ^
     69| 
     70|       // Wait for debounce and validation

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[102/199]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:114:38
    112|       );
    113| 
    114|       expect(result.current.isValid).toBe(false);
       |                                      ^
    115|       expect(result.current.errors.length).toBeGreaterThan(0);
    116|       expect(result.current.errors[0].message).toContain('unknown_var'Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[103/199]Î“Ã„Â»

 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
ReferenceError: React is not defined
 Î“Â¥Â» RunsTable client/src/components/runs/RunsTable.tsx:41:3
     39|   };
     40| 
     41|   return (
       |   ^
     42|     <div className="rounded-md border">
     43|       <Table>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[104/199]Î“Ã„Â»

 FAIL  tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
AssertionError: expected 'error' to be 'success' // Object.is equality

Expected: "success"
Received: "error"

 Î“Â¥Â» tests/unit/engine.run-conditions.test.ts:523:29
    521|       const result = await runGraph(input);
    522| 
    523|       expect(result.status).toBe('success');
       |                             ^
    524|       expect(result.trace).toBeDefined();
    525| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[105/199]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should allow access with valid JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 with invalid token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 with expired token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with refresh token cookie (GET only)
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for POST requests (mutation-strict)
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for PUT requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for DELETE requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should allow cookie auth for HEAD requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should prioritize JWT over cookie when both present
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should return 401 when both JWT and cookie are invalid
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should authenticate with JWT if provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Cookie Strategy Security > should only allow safe methods for cookie auth
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Cookie Strategy Security > should ignore cookies when Bearer token present
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach userId to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for invalid token
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:70:14
     68|                 password: testUser.password,
     69|             })
     70|             .expect(200);
       |              ^
     71| 
     72|         userToken = loginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[106/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should generate valid JWT token on successful login
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:54:18
     52|                 .post("/api/auth/register")
     53|                 .send(testUser)
     54|                 .expect(201);
       |                  ^
     55| 
     56|             // Verify email
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[107/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should include correct payload in JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:90:18
     88|                 .post("/api/auth/register")
     89|                 .send(testUser)
     90|                 .expect(201);
       |                  ^
     91| 
     92|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[108/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should set JWT expiry to 15 minutes
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:122:18
    120|                 .post("/api/auth/register")
    121|                 .send(testUser)
    122|                 .expect(201);
       |                  ^
    123| 
    124|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[109/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should accept valid JWT token on protected routes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:153:18
    151|                     password: testUser.password,
    152|                 })
    153|                 .expect(200);
       |                  ^
    154| 
    155|             const meRes = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[110/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should reject request with missing Bearer prefix
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:183:18
    181|                     password: testUser.password,
    182|                 })
    183|                 .expect(200);
       |                  ^
    184| 
    185|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[111/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Expiration > should return token_expired error code for expired tokens
AssertionError: expected { code: 'AUTH_008', Î“Ã‡Âª(3) } to be 'token_expired' // Object.is equality

- Expected: 
"token_expired"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-10T16:39:52.604Z",
}

 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:237:36
    235|                 .expect(401);
    236| 
    237|             expect(res.body.error).toBe("token_expired");
       |                                    ^
    238|         });
    239|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[112/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on PUT requests
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:268:18
    266|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    267|                 .send({ firstName: "Updated" })
    268|                 .expect(200);
       |                  ^
    269| 
    270|             expect(updateRes.body).toBeDefined();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[113/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on DELETE requests
Error: expected 200 "OK", got 204 "No Content"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:285:18
    283|                 .delete(`/api/projects/${projectRes.body.id}`)
    284|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    285|                 .expect(200);
       |                  ^
    286|         });
    287|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:847:12
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[114/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Cookie-to-Token Exchange > should exchange valid session cookie for JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:295:18
    293|                 .post("/api/auth/register")
    294|                 .send(testUser)
    295|                 .expect(201);
       |                  ^
    296| 
    297|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[115/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should prefer Bearer token over cookie when both present
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:330:18
    328|                     email: `user1-${nanoid()}@example.com`,
    329|                 })
    330|                 .expect(201);
       |                  ^
    331| 
    332|             const user2Res = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[116/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should fall back to cookie if Bearer token is invalid
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:358:18
    356|                 .post("/api/auth/register")
    357|                 .send(testUser)
    358|                 .expect(201);
       |                  ^
    359| 
    360|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[117/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should allow GET requests with cookie auth only
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:377:18
    375|                 .post("/api/auth/register")
    376|                 .send(testUser)
    377|                 .expect(201);
       |                  ^
    378| 
    379|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[118/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should reject POST requests with cookie auth only (mutation-strict)
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:406:18
    404|                 .post("/api/auth/register")
    405|                 .send(testUser)
    406|                 .expect(201);
       |                  ^
    407| 
    408|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[119/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should allow anonymous access to public workflows
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:432:18
    430|                     publicLink: `public-${nanoid()}`,
    431|                 })
    432|                 .expect(201);
       |                  ^
    433| 
    434|             // Access without authentication
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[120/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should attach user info if authenticated on optional auth routes
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:451:18
    449|                     publicLink: `optional-${nanoid()}`,
    450|                 })
    451|                 .expect(201);
       |                  ^
    452| 
    453|             // Access with authentication
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[121/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should refresh access token using refresh token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:469:18
    467|                 .post("/api/auth/register")
    468|                 .send(testUser)
    469|                 .expect(201);
       |                  ^
    470| 
    471|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[122/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should rotate refresh token on use
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:503:18
    501|                 .post("/api/auth/register")
    502|                 .send(testUser)
    503|                 .expect(201);
       |                  ^
    504| 
    505|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[123/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should detect token reuse and revoke all user tokens
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:544:18
    542|                 .post("/api/auth/register")
    543|                 .send(testUser)
    544|                 .expect(201);
       |                  ^
    545| 
    546|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[124/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should revoke refresh token on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:595:18
    593|                 .post("/api/auth/register")
    594|                 .send(testUser)
    595|                 .expect(201);
       |                  ^
    596| 
    597|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[125/199]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should clear refresh token cookie on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:628:18
    626|                 .post("/api/auth/register")
    627|                 .send(testUser)
    628|                 .expect(201);
       |                  ^
    629| 
    630|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[126/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/all - Logout All Other Devices > should revoke all sessions except current
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:332:37
    330|         ));
    331| 
    332|       expect(activeSessions.length).toBe(1);
       |                                     ^
    333|       expect(activeSessions[0].token).toBe(hashToken(currentToken));
    334|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[127/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > POST /api/auth/trust-device > should update existing trusted device expiry
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:435:32
    433| 
    434|         // Should still be only one device
    435|         expect(devices.length).toBe(1);
       |                                ^
    436| 
    437|         // Expiry should be updated

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[128/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > DELETE /api/auth/trusted-devices/:deviceId > should revoke a trusted device
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:528:40
    526|           where: eq(trustedDevices.id, device.id),
    527|         });
    528|         expect(updatedDevice?.revoked).toBe(true);
       |                                        ^
    529|       });
    530| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[129/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should update lastUsedAt on token refresh
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:590:31
    588|         ));
    589| 
    590|       expect(sessions.length).toBe(1);
       |                               ^
    591|       expect(sessions[0].lastUsedAt).toBeDefined();
    592|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[130/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should refresh access token with valid refresh token
AssertionError: expected { Î“Ã‡Âª(2) } to match object { token: Any<String>, user: { Î“Ã‡Âª(3) } }
(1 matching property omitted from actual)

- Expected
+ Received

  {
    "token": Any<String>,
    "user": {
      "email": "refresh-test-8_Lq5BxxK8Mv1JdEcNe8q@example.com",
      "id": "S35yJE9LimvOVXHvpSC0B",
-     "role": "owner",
+     "role": "creator",
    },
  }

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:88:29
     86| 
     87|       expect(response.status).toBe(200);
     88|       expect(response.body).toMatchObject({
       |                             ^
     89|         token: expect.any(String),
     90|         user: {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[131/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should rotate refresh token after use
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:126:33
    124|         where: eq(refreshTokens.token, testRefreshToken),
    125|       });
    126|       expect(oldToken?.revoked).toBe(true);
       |                                 ^
    127| 
    128|       // New token should exist and not be revoked

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[132/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should return 401 when user is not found
AssertionError: expected 'Invalid refresh token' to be 'User not found' // Object.is equality

Expected: "User not found"
Received: "Invalid refresh token"

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:206:37
    204| 
    205|       expect(response.status).toBe(401);
    206|       expect(response.body.message).toBe('User not found');
       |                                     ^
    207|     });
    208| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[133/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should update refresh token metadata on rotation
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:226:24
    224|       });
    225| 
    226|       expect(newToken).toBeDefined();
       |                        ^
    227|       expect(newToken?.lastUsedAt).toBeDefined();
    228|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[134/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should include user role information in response
AssertionError: expected { id: 'Q9q5_2Qs8FtCVKXwOZSXC', Î“Ã‡Âª(3) } to match object { id: 'Q9q5_2Qs8FtCVKXwOZSXC', Î“Ã‡Âª(2) }
(1 matching property omitted from actual)

- Expected
+ Received

  {
    "email": "refresh-test-jR37mUYqoxhhozk-VVRCa@example.com",
    "id": "Q9q5_2Qs8FtCVKXwOZSXC",
-   "role": "owner",
+   "role": "creator",
  }

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:290:34
    288| 
    289|       expect(response.status).toBe(200);
    290|       expect(response.body.user).toMatchObject({
       |                                  ^
    291|         id: testUserId,
    292|         email: testUserEmail,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[135/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should create refresh token on login
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:307:31
    305|         });
    306| 
    307|       expect(response.status).toBe(200);
       |                               ^
    308| 
    309|       // Verify refresh token cookie is set

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[136/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should revoke refresh token on logout
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:333:30
    331|         where: eq(refreshTokens.token, testRefreshToken),
    332|       });
    333|       expect(token?.revoked).toBe(true);
       |                              ^
    334| 
    335|       // Verify cookie is cleared

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[137/199]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Security > should validate token ownership
AssertionError: expected undefined to be 'jH0oiuizd866foZOUuudW' // Object.is equality

- Expected: 
"jH0oiuizd866foZOUuudW"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:465:29
    463|       });
    464| 
    465|       expect(token?.userId).toBe(testUserId);
       |                             ^
    466|       expect(token?.userId).not.toBe(otherUser.id);
    467|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[138/199]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should allow access with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with empty Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with malformed Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with wrong token type
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should allow POST with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST with invalid token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should allow PUT with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should reject PUT without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > DELETE Protected Routes > should reject DELETE without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PATCH Protected Routes > should allow PATCH with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PATCH Protected Routes > should reject PATCH without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle Bearer token with extra spaces
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle token with newlines
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle very long invalid token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle empty Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle multiple Authorization headers
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should reject token with SQL injection attempt
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Payload Validation > should reject token with non-existent userId
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > User Context Injection > should inject role into request context
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Mixed Auth Scenarios > should handle request with both Bearer token and cookies
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:76:14
     74|                 password: testUser.password,
     75|             })
     76|             .expect(200);
       |              ^
     77| 
     78|         userToken = loginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[139/199]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > DELETE Protected Routes > should allow DELETE with valid Bearer token
Error: expected 201 "Created", got 403 "Forbidden"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:168:18
    166|                 .set("Authorization", `Bearer ${userToken}`)
    167|                 .send({ name: "Delete Test Project" })
    168|                 .expect(201);
       |                  ^
    169| 
    170|             // Delete it
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[140/199]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Cross-User Authorization > should not allow user to access another user's resources
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:333:18
    331|                     password: user2.password,
    332|                 })
    333|                 .expect(200);
       |                  ^
    334| 
    335|             const user2Token = user2LoginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[141/199]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Mixed Auth Scenarios > should prioritize Bearer token over cookie when both present
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:436:18
    434|                     password: testUser.password,
    435|                 })
    436|                 .expect(200);
       |                  ^
    437| 
    438|             const user2 = {
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[142/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create refresh token on login
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:74:18
     72|                     password: testUser.password,
     73|                 })
     74|                 .expect(200);
       |                  ^
     75| 
     76|             expect(loginRes.headers['set-cookie']).toBeDefined();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[143/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create separate sessions for multiple device logins
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:120:18
    118|                     password: testUser.password,
    119|                 })
    120|                 .expect(200);
       |                  ^
    121| 
    122|             // Login from device 2
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[144/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should list all active sessions for user
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:163:18
    161|                     password: testUser.password,
    162|                 })
    163|                 .expect(200);
       |                  ^
    164| 
    165|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[145/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should mark current session correctly
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:208:18
    206|                     password: testUser.password,
    207|                 })
    208|                 .expect(200);
       |                  ^
    209| 
    210|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[146/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should not include revoked sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:237:18
    235|                     password: testUser.password,
    236|                 })
    237|                 .expect(200);
       |                  ^
    238| 
    239|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[147/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should order sessions by last used (most recent first)
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:282:18
    280|                     password: testUser.password,
    281|                 })
    282|                 .expect(200);
       |                  ^
    283| 
    284|             await new Promise(resolve => setTimeout(resolve, 100));
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[148/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should revoke specific session
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:332:18
    330|                     password: testUser.password,
    331|                 })
    332|                 .expect(200);
       |                  ^
    333| 
    334|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[149/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:373:18
    371|                     password: testUser.password,
    372|                 })
    373|                 .expect(200);
       |                  ^
    374| 
    375|             const sessionsRes = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[150/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should not allow revoking other users sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:417:18
    415|                     password: user2.password,
    416|                 })
    417|                 .expect(200);
       |                  ^
    418| 
    419|             // User1 tries to get user2's sessions
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[151/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should return 404 for non-existent session ID
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:452:18
    450|                     password: testUser.password,
    451|                 })
    452|                 .expect(200);
       |                  ^
    453| 
    454|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[152/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/all > should revoke all sessions except current
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:471:18
    469|                     password: testUser.password,
    470|                 })
    471|                 .expect(200);
       |                  ^
    472| 
    473|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[153/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/all > should revoke all trusted devices
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:523:18
    521|                     password: testUser.password,
    522|                 })
    523|                 .expect(200);
       |                  ^
    524| 
    525|             // Trust device
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[154/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Expiration > should reject refresh token after 30 days
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:564:18
    562|                     password: testUser.password,
    563|                 })
    564|                 .expect(200);
       |                  ^
    565| 
    566|             // Get the refresh token from database (non-revoked only)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[155/199]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Concurrent Session Handling > should handle concurrent token refreshes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:631:18
    629|                     password: testUser.password,
    630|                 })
    631|                 .expect(200);
       |                  ^
    632| 
    633|             const cookies = session.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[156/199]Î“Ã„Â»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Value Formatting > formats boolean values as Yes/No
Error: expect(element).toHaveAttribute("aria-label", "Verified: Yes") // element.getAttribute("aria-label") === "Verified: Yes"

Expected the element to have attribute:
  aria-label="Verified: Yes"
Received:
  aria-label="Verified: true"
 Î“Â¥Â» tests/ui/datavault/EditableCell.test.tsx:342:20
    340| 
    341|       const cell = screen.getByRole('gridcell');
    342|       expect(cell).toHaveAttribute('aria-label', 'Verified: Yes');
       |                    ^
    343|     });
    344| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[157/199]Î“Ã„Â»

 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table name and description
TestingLibraryElementError: Found multiple elements with the text: Test table description

Here are the matching elements:

Ignored nodes: comments, script, style
<p
  class="text-sm text-muted-foreground mb-4 line-clamp-2"
>
  Test table description
</p>

Ignored nodes: comments, script, style
<p
  class="text-sm text-muted-foreground mb-4 line-clamp-2"
>
  Test table description
</p>

(If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

Ignored nodes: comments, script, style
<body>
  <div>
    <div
      class="rounded-lg border bg-card text-card-foreground shadow-sm cursor-pointer hover:shadow-md transition-shadow group relative"
    >
      <div>
        <div
          class="p-4 sm:p-6 flex flex-row items-start justify-between space-y-0 pb-2"
        >
          <div
            class="space-y-1 flex-1 min-w-0 pr-2"
          >
            <div
              class="sm:text-xl md:text-2xl tracking-tight text-lg font-semibold truncate"
            >
              Test Table
            </div>
            <p
              class="text-sm text-muted-foreground mb-4 line-clamp-2"
            >
              Test table description
            </p>
          </div>
          <button
            aria-expanded="false"
            aria-haspopup="menu"
            aria-label="Actions"
            class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity"
            data-state="closed"
            id="radix-:r0:"
            type="button"
          >
            <span
              class="sr-only"
            >
              Open menu
            </span>
            <svg
              class="lucide lucide-ellipsis-vertical h-4 w-4"
              fill="none"
              height="24"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              viewBox="0 0 24 24"
              width="24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                cx="12"
                cy="12"
                r="1"
              />
              <circle
                cx="12"
                cy="5"
                r="1"
              />
              <circle
                cx="12"
                cy="19"
                r="1"
              />
            </svg>
          </button>
        </div>
        <div
          class="p-4 sm:p-6 pt-0"
        >
          <p
            class="text-sm text-muted-foreground mb-4 line-clamp-2"
          >
            Test table description
          </p>
          <div
            class="flex items-center space-x-4 text-xs text-muted-foreground"
          >
            <div
              class="flex items-center"
            >
              <i
                class="fas fa-columns mr-1"
              />
              <span>
                5
                 columns
              </span>
            </div>
            <div
              class="flex items-center"
            >
              <i
                class="fas fa-database mr-1"
              />
              <span>
                42
                 rows
              </span>
            </div>
            <div
              class="flex items-center ml-auto"
            >
              <i
                class="fas fa-clock mr-1"
              />
              <span>
                1/2/2024
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
 Î“Â¥Â» Object.getElementError node_modules/@testing-library/dom/dist/config.js:37:19
 Î“Â¥Â» getElementError node_modules/@testing-library/dom/dist/query-helpers.js:20:35
 Î“Â¥Â» getMultipleElementsFoundError node_modules/@testing-library/dom/dist/query-helpers.js:23:10
 Î“Â¥Â» node_modules/@testing-library/dom/dist/query-helpers.js:55:13
 Î“Â¥Â» node_modules/@testing-library/dom/dist/query-helpers.js:95:19
 Î“Â¥Â» tests/ui/datavault/TableCard.test.tsx:32:19
     30| 
     31|     expect(screen.getByText('Test Table')).toBeInTheDocument();
     32|     expect(screen.getByText('Test table description')).toBeInTheDocumeÎ“Ã‡Âª
       |                   ^
     33|   });
     34| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[158/199]Î“Ã„Â»

 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onDelete when delete button is clicked
TestingLibraryElementError: Unable to find an element with the text: Delete. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

Ignored nodes: comments, script, style
<body>
  <div>
    <div
      class="rounded-lg border bg-card text-card-foreground shadow-sm cursor-pointer hover:shadow-md transition-shadow group relative"
    >
      <div>
        <div
          class="p-4 sm:p-6 flex flex-row items-start justify-between space-y-0 pb-2"
        >
          <div
            class="space-y-1 flex-1 min-w-0 pr-2"
          >
            <div
              class="sm:text-xl md:text-2xl tracking-tight text-lg font-semibold truncate"
            >
              Test Table
            </div>
            <p
              class="text-sm text-muted-foreground mb-4 line-clamp-2"
            >
              Test table description
            </p>
          </div>
          <button
            aria-expanded="false"
            aria-haspopup="menu"
            aria-label="Actions"
            class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 hover:bg-accent hover:text-accent-foreground h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity"
            data-state="closed"
            id="radix-:r8:"
            type="button"
          >
            <span
              class="sr-only"
            >
              Open menu
            </span>
            <svg
              class="lucide lucide-ellipsis-vertical h-4 w-4"
              fill="none"
              height="24"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              viewBox="0 0 24 24"
              width="24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <circle
                cx="12"
                cy="12"
                r="1"
              />
              <circle
                cx="12"
                cy="5"
                r="1"
              />
              <circle
                cx="12"
                cy="19"
                r="1"
              />
            </svg>
          </button>
        </div>
        <div
          class="p-4 sm:p-6 pt-0"
        >
          <p
            class="text-sm text-muted-foreground mb-4 line-clamp-2"
          >
            Test table description
          </p>
          <div
            class="flex items-center space-x-4 text-xs text-muted-foreground"
          >
            <div
              class="flex items-center"
            >
              <i
                class="fas fa-columns mr-1"
              />
              <span>
                5
                 columns
              </span>
            </div>
            <div
              class="flex items-center"
            >
              <i
                class="fas fa-database mr-1"
              />
              <span>
                42
                 rows
              </span>
            </div>
            <div
              class="flex items-center ml-auto"
            >
              <i
                class="fas fa-clock mr-1"
              />
              <span>
                1/2/2024
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
 Î“Â¥Â» Object.getElementError node_modules/@testing-library/dom/dist/config.js:37:19
 Î“Â¥Â» node_modules/@testing-library/dom/dist/query-helpers.js:76:38
 Î“Â¥Â» node_modules/@testing-library/dom/dist/query-helpers.js:52:17
 Î“Â¥Â» node_modules/@testing-library/dom/dist/query-helpers.js:95:19
 Î“Â¥Â» tests/ui/datavault/TableCard.test.tsx:79:33
     77| 
     78|     // Click delete
     79|     const deleteButton = screen.getByText('Delete');
       |                                 ^
     80|     fireEvent.click(deleteButton);
     81| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[159/199]Î“Ã„Â»


[2m Test Files [22m [1m[31m31 failed[39m[22m[2m | [22m[1m[32m123 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (155)[39m
[2m      Tests [22m [1m[31m197 failed[39m[22m[2m | [22m[1m[32m2325 passed[39m[22m[2m | [22m[33m27 skipped[39m[90m (2549)[39m
[2m   Start at [22m 10:39:32
[2m   Duration [22m 84.12s[2m (transform 53.87s, setup 53.03s, import 353.64s, tests 691.12s, environment 23.32s)[22m

