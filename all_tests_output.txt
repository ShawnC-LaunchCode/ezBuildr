npm warn Unknown project config "puppeteer_skip_download". This will stop working in the next major version of npm.

> ezbuildr@1.0.0 test
> vitest run --coverage

 DEPRECATED  `test.poolOptions` was removed in Vitest 4. All previous `poolOptions` are now top-level options. Please, refer to the migration guide: https://vitest.dev/guide/migration#pool-rework

[1m[46m RUN [49m[22m [36mv4.0.16 [39m[90mC:/Users/scoot/poll/VaultLogic[39m
      [2mCoverage enabled with [22m[33mv8[39m

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/AuthService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "dbInitPromise" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:107:34
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820235419,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767820235419,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1212,"responseTokens":90,"totalTokens":1302,"durationMs":1,"estimatedCostUSD":0.01482,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820235422,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":5,"msg":"AI workflow generation failed"}
{"level":30,"time":1767820235435,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767820235436,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":49,"totalTokens":1250,"durationMs":1,"estimatedCostUSD":0.013479999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820235436,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767820235458,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767820235458,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":68,"totalTokens":1269,"durationMs":0,"estimatedCostUSD":0.01405,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820235459,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767820235472,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767820235472,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":89,"totalTokens":1290,"durationMs":0,"estimatedCostUSD":0.014679999999999999,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820235473,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767820235479,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":40,"time":1767820235480,"env":"test","module":"ai-service","attempt":0,"waitMs":1000,"msg":"Rate limit hit, retrying..."}
{"level":40,"time":1767820236408,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
{"level":40,"time":1767820236483,"env":"test","module":"ai-service","attempt":1,"waitMs":2000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767820236529,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820236550,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820236550,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820236563,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820236575,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820236582,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820236592,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820236605,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820236597,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820236599,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820236603,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #1: Project transfer cascades runs ownership[2m > [22m[2mshould cascade ownership to workflow runs when project is transferred
[22m[39m[isOrgMember] User a5c0d41d-bf32-428e-b662-ac16e47a6e65 IS member of 1f8923bf-b60f-4416-9b50-6a538e3771bd

[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

stderr | tests/integration/trusted.devices.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:279:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 307,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_auto_number, 2950 2950 23, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #2: Invite acceptance race condition[2m > [22m[2mshould prevent double-acceptance via transaction
[22m[39m[isOrgMember] User 0bf693d0-297a-493d-807e-f4435e06e8f3 is NOT member of 1f8923bf-b60f-4416-9b50-6a538e3771bd (Access Denied)

{"level":30,"time":1767820237794,"env":"test","module":"user-credentials-repository","userId":"RQhbiwZZbgAphvJDvmiR1","msg":"User credentials created"}
{"level":30,"time":1767820237842,"env":"test","module":"user-credentials-repository","userId":"We3Rz_QgpStYDifmsPcXO","msg":"User credentials created"}
{"level":40,"time":1767820237931,"env":"test","module":"auth-service","tokenHash":"2baf5dc0c407b181431246e65a7c8d251882041f8d1b229616e8717b7ec3207c","msg":"Security: Unknown refresh token used"}
stderr | tests/integration/mfa.flow.real.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:279:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 307,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_auto_number, 2950 2950 23, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1767820238037,"env":"test","module":"auth-routes","userId":"We3Rz_QgpStYDifmsPcXO","sessionCount":2,"msg":"Listed active sessions"}
{"level":30,"time":1767820238289,"env":"test","module":"user-credentials-repository","userId":"i9nWrKDaqTkGV4_88X1Xj","msg":"User credentials created"}
{"level":30,"time":1767820238299,"env":"test","module":"user-credentials-repository","userId":"d239867c-fed6-4326-b0b6-11155f3839cc","msg":"User credentials created"}
{"level":30,"time":1767820238317,"env":"test","module":"user-credentials-repository","userId":"b966eef5-3267-4909-837a-3ff932c47694","msg":"User credentials created"}
{"level":30,"time":1767820238373,"env":"test","module":"user-credentials-repository","userId":"XPUMfm6KIt_PDIA4tbu1L","msg":"User credentials created"}
{"level":30,"time":1767820238406,"env":"test","module":"email-queue","jobId":"db9f93d7-2962-4ea7-b081-df771a3d9ff3","to":"test-1767820237857-rcg2hn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820238417,"env":"test","module":"email-queue","jobId":"a6e8982d-3ed0-4d0e-ab45-af219d54f399","to":"test-1767820237876-8oxuz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820238462,"env":"test","module":"auth-routes","userId":"d239867c-fed6-4326-b0b6-11155f3839cc","email":"test-1767820237857-rcg2hn@example.com","msg":"User registered"}
{"level":30,"time":1767820238473,"env":"test","module":"auth-routes","userId":"b966eef5-3267-4909-837a-3ff932c47694","email":"test-1767820237876-8oxuz@example.com","msg":"User registered"}
{"level":30,"time":1767820238478,"env":"test","module":"auth-routes","userId":"XPUMfm6KIt_PDIA4tbu1L","sessionCount":1,"msg":"Listed active sessions"}
{"level":40,"time":1767820238483,"env":"test","module":"ai-service","attempt":2,"waitMs":4000,"msg":"Rate limit hit, retrying..."}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #3: Invite email failure rollback[2m > [22m[2mshould not create invite if email fails
[22m[39m[isOrgMember] User 7446fe6c-cbf3-41e2-805f-cd39d5ac2aa7 is NOT member of 1f8923bf-b60f-4416-9b50-6a538e3771bd (Access Denied)

{"level":50,"time":1767820238744,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820238812,"env":"test","module":"user-credentials-repository","userId":"vlVYxLdyAWMpA0lrLuEvj","msg":"User credentials created"}
{"level":30,"time":1767820238927,"env":"test","module":"auth-routes","userId":"vlVYxLdyAWMpA0lrLuEvj","sessionCount":0,"msg":"Listed active sessions"}
{"level":30,"time":1767820238970,"env":"test","module":"user-credentials-repository","userId":"xJ9nRLHHMzektRxkE6BfR","msg":"User credentials created"}
{"level":50,"time":1767820239007,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #5: Expired invites[2m > [22m[2mshould allow re-invite after invite expires
[22m[39m[isOrgMember] User 4dc9226f-05a9-4fb7-8785-d9470cbfedf0 is NOT member of 1f8923bf-b60f-4416-9b50-6a538e3771bd (Access Denied)

{"level":50,"time":1767820239113,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767820239127,"env":"test","module":"mfa-service","userId":"abbe915cabd62cef2ac4837cf25c20de","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820239127,"env":"test","module":"auth-routes","userId":"abbe915cabd62cef2ac4837cf25c20de","msg":"MFA verification failed during login"}
{"level":50,"time":1767820239133,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820239253,"env":"test","module":"user-credentials-repository","userId":"V4KDAYl5B2zpUMJevmnYi","msg":"User credentials created"}
{"level":50,"time":1767820239260,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820239267,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820239355,"env":"test","module":"user-credentials-repository","userId":"mQwEZDLwqdjgT8AOuMOV0","msg":"User credentials created"}
{"level":30,"time":1767820239360,"env":"test","module":"auth-routes","userId":"V4KDAYl5B2zpUMJevmnYi","sessionCount":0,"msg":"Listed active sessions"}
{"level":50,"time":1767820239381,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts[2m > [22m[2mAuthService[2m > [22m[2mJWT Token Management[2m > [22m[2mverifyToken()[2m > [22m[2mshould throw error for invalid token signature
[22m[39mDEBUG: verifyToken threw: Invalid or malformed token InvalidTokenError

{"level":40,"time":1767820239463,"env":"test","module":"auth-service","tokenHash":"2fe6f7ff0fa9bd1ee1eb2b4de4567a52a13546270f31f9607e884393806b0e0c","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #5: Expired invites[2m > [22m[2mshould allow re-invite after invite expires
[22m[39m[isOrgMember] User 4dc9226f-05a9-4fb7-8785-d9470cbfedf0 is NOT member of 1f8923bf-b60f-4416-9b50-6a538e3771bd (Access Denied)

{"level":50,"time":1767820239645,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820239655,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820239686,"env":"test","module":"user-credentials-repository","userId":"bxuUkNVib2ucAKg8xpC9y","msg":"User credentials created"}
{"level":30,"time":1767820239714,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767820239720,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
{"level":40,"time":1767820239756,"env":"test","module":"auth-service","tokenHash":"9206c2394794b8fc97fcd896f95e40028ab7a15c10279446c23fbdd4b4ae7a1e","msg":"Security: Unknown refresh token used"}
{"level":40,"time":1767820239758,"env":"test","module":"auth-service","userId":"user-123","tokenHash":"0f45e858fbc4176cdf4e411f88281edefc390ae5afe7df0f44cd9297f0a64580","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":40,"time":1767820239760,"env":"test","module":"auth-service","userId":"user-123","msg":"Security: Expired refresh token used"}
{"level":30,"time":1767820239764,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767820239765,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767820239766,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":30,"time":1767820239767,"env":"test","module":"auth-service","msg":"Cleaned up expired tokens and old login attempts"}
{"level":50,"time":1767820239796,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820239811,"env":"test","module":"user-credentials-repository","userId":"dOxO6fvoTiLIlvGl19gqy","msg":"User credentials created"}
{"level":30,"time":1767820239844,"env":"test","module":"auth-routes","userId":"bxuUkNVib2ucAKg8xpC9y","sessionCount":1,"msg":"Listed active sessions"}
{"level":40,"time":1767820239966,"env":"test","module":"auth-service","tokenHash":"719d4f34fd9de961e8180db389d381f3f2fb25ec3f7287005acb16280bd0a506","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1767820240062,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820240196,"env":"test","module":"user-credentials-repository","userId":"5m01cR0ll1X7sqF8LlCMN","msg":"User credentials created"}
{"level":30,"time":1767820240296,"env":"test","module":"auth-routes","userId":"5m01cR0ll1X7sqF8LlCMN","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1767820240318,"env":"test","module":"user-credentials-repository","userId":"i27mAVyY705quOpTvFkS0","msg":"User credentials created"}
{"level":50,"time":1767820240335,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820240364,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820240370,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820240376,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767820240479,"env":"test","module":"auth-service","tokenHash":"c06eb26f73c4086ec806cdccc187e1628f2752877fefe205d227a98df45091a1","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1767820240550,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820240605,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820240621,"env":"test","module":"user-credentials-repository","userId":"_sYj_GttVdzlekAKp4N9j","msg":"User credentials created"}
{"level":50,"time":1767820240625,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767820240658,"env":"test","module":"mfa-service","userId":"1aab206530d3d3fff5f1dd4c4bdc1dab","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820240659,"env":"test","module":"auth-routes","userId":"1aab206530d3d3fff5f1dd4c4bdc1dab","msg":"MFA verification failed during login"}
{"level":50,"time":1767820240663,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820240720,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820240760,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820240762,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820240803,"env":"test","module":"user-credentials-repository","userId":"J2LToIeQLEB8_KVhF_p-v","msg":"User credentials created"}
{"level":50,"time":1767820240877,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820240952,"env":"test","module":"user-credentials-repository","userId":"cYdng2H16nY3k7ZGhtDKP","msg":"User credentials created"}
{"level":40,"time":1767820240964,"env":"test","module":"auth-service","tokenHash":"14b1117bcb680207f8a24c31295d277b6357eaaff9fd6649ebdbac852fc9fb1f","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1767820240976,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820241143,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820241289,"env":"test","module":"user-credentials-repository","userId":"OVuuXCVLatENU-qVdYNNk","msg":"User credentials created"}
{"level":30,"time":1767820241355,"env":"test","module":"user-credentials-repository","userId":"5c44efcf-95ed-43cb-8eec-311a6d1e32d0","msg":"User credentials created"}
{"level":30,"time":1767820241400,"env":"test","module":"user-credentials-repository","userId":"W4Xaguw94GqRZlvaY69EO","msg":"User credentials created"}
{"level":30,"time":1767820241457,"env":"test","module":"email-queue","jobId":"99fcbf5e-8675-4f75-b733-9934ad6bc541","to":"test-1767820240976-7u11lq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820241510,"env":"test","module":"auth-routes","userId":"5c44efcf-95ed-43cb-8eec-311a6d1e32d0","email":"test-1767820240976-7u11lq@example.com","msg":"User registered"}
{"level":30,"time":1767820241606,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #8: Placeholder user cleanup[2m > [22m[2mshould cleanup placeholder user when invite is revoked
[22m[39m[isOrgMember] User a41dddfe-a3e5-433b-9532-6a895baa462c is NOT member of 1f8923bf-b60f-4416-9b50-6a538e3771bd (Access Denied)

{"level":30,"time":1767820241737,"env":"test","module":"user-credentials-repository","userId":"9AIuieZJaGFpLa_3DMzBG","msg":"User credentials created"}
{"level":50,"time":1767820241742,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820241933,"env":"test","module":"user-credentials-repository","userId":"3kBEnQvAXNBwy1b3Iih9c","msg":"User credentials created"}
{"level":50,"time":1767820242030,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820242045,"env":"test","module":"auth-service","email":"reset@example.com","msg":"Password reset email sent"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

{"level":40,"time":1767820242134,"env":"test","module":"mfa-service","userId":"1dff4c0e623bdf939853b488696467c3","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820242134,"env":"test","module":"auth-routes","userId":"1dff4c0e623bdf939853b488696467c3","msg":"MFA verification failed during login"}
{"level":50,"time":1767820242137,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820242167,"env":"test","module":"user-credentials-repository","userId":"c2S50mC97SNINL8wESiof","msg":"User credentials created"}
{"level":40,"time":1767820242196,"env":"test","module":"auth-service","tokenHash":"2fb72ef9ad43154aaa0dfc00d67f08e8d3cf6ce086f408abd6eee1ae74ec33af","msg":"Security: Unknown refresh token used"}
{"level":50,"time":1767820242218,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820242230,"env":"test","module":"auth-routes","userId":"e5774878b69f271b6619030b3ea7bb27","msg":"User logged in successfully"}
stderr | tests/integration/auth/session.management.integration.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:279:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 307,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_auto_number, 2950 2950 23, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

{"level":30,"time":1767820242235,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767820242236,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":50,"time":1767820242242,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820242251,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.templates-runs.test.ts[2m > [22m[2mTemplates and Runs API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820242251,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts[2m > [22m[2mSession Management Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820242241,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820242242,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820242246,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820242251,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820242251,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820242251,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820242251,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767820242242,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820242243,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820242246,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820242251,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820242251,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820242251,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820242251,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767820242260,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767820242276,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/protected.routes.test.ts[2m > [22m[2mProtected Routes Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820242266,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820242267,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820242271,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820242275,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820242275,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820242275,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820242275,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767820242283,"env":"test","module":"audit-log-service","userId":"e5774878b69f271b6619030b3ea7bb27","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts[2m > [22m[2mOrganization Audit Fixes[2m > [22m[2mFIX #8: Placeholder user cleanup[2m > [22m[2mshould cleanup placeholder user when invite is revoked
[22m[39mCleaned up placeholder user a41dddfe-a3e5-433b-9532-6a895baa462c (no pending invites or memberships)

{"level":50,"time":1767820242482,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767820242483,"env":"test","module":"ai-service","attempt":3,"waitMs":8000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767820242520,"env":"test","module":"user-credentials-repository","userId":"j984X1BbDXDbdz_Cbs2J3","msg":"User credentials created"}
{"level":50,"time":1767820242538,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/middleware/auth.middleware.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820242539,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820242539,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820242540,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767820242541,"env":"test","module":"auth-middleware","path":"/test","msg":"No authorization token provided"}
{"level":50,"time":1767820242543,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mÎ“Â¥Â»[39m tests/unit/middleware/auth.middleware.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 7447[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with valid JWT token [33m 485[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 for missing token[39m[32m 21[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 401 for invalid token[32m 1[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for expired token [33m 525[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should extract token without Bearer prefix [33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with valid token [33m 471[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should proceed without auth when no token provided[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should proceed even with invalid token[32m 0[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with JWT Bearer token [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with refresh token cookie for GET requests [33m 534[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject cookie auth for POST requests [33m 438[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prioritize JWT over cookie when both present [33m 890[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow cookie auth only for safe methods[39m[33m 604[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 401 when no auth provided[32m 1[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with JWT [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should authenticate with cookie for GET [33m 541[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should proceed without auth when none provided[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should proceed even with invalid auth[32m 0[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow token tampering [33m 375[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow cookie auth for mutations (CSRF protection) [33m 428[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject malformed JWT[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle missing authorization header gracefully[32m 0[2mms[22m[39m
{"level":30,"time":1767820242655,"env":"test","module":"user-credentials-repository","userId":"CixFXZJHd1EQ5nKom7Vuk","msg":"User credentials created"}
{"level":50,"time":1767820242658,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820242663,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/services/AuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820242711,"env":"test","module":"user-credentials-repository","userId":"29a78cc9-6332-4272-ac51-3ffb2fa4f763","msg":"User credentials created"}
{"level":30,"time":1767820242736,"env":"test","module":"user-credentials-repository","userId":"f4413c35-475b-4d6a-b554-12cef51909e2","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/unit/services/AuthService.test.ts [2m([22m[2m113 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 7924[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should hash a password using bcrypt with 12 rounds[32m 227[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should generate different hashes for same password [33m 516[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle empty passwords[32m 271[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle long passwords[32m 245[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle unicode characters in password[32m 267[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return true for correct password [33m 513[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return false for incorrect password [33m 436[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should be case-sensitive [33m 449[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle empty password comparison [33m 447[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept valid email addresses[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails longer than 254 characters (RFC 5321)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails shorter than 3 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with consecutive dots[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without @ symbol[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without domain[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with spaces[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails without TLD[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject null or undefined[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject emails with local part longer than 64 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept valid strong passwords[32m 32[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject passwords shorter than 8 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject passwords longer than 128 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject weak passwords with zxcvbn score < 3[32m 7[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should provide helpful feedback for weak passwords[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject password containing user's email[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject password containing user's name[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept strong password even with user inputs provided[32m 4[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept password with exactly 8 characters if strong enough[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept password with exactly 128 characters if strong[32m 100[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return score in result object[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create a valid JWT token for a user[32m 4[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include userId, email, tenantId, and role in token payload[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should set token expiry to 15 minutes by default[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error if JWT_SECRET is not configured[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle null tenantId and role[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify and decode a valid token[32m 2[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error for expired token [33m 1104[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for invalid token signature[39m[32m 12[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for malformed token[39m[32m 2[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should throw error for invalid token[39m[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should extract token from Bearer authorization header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return token if no Bearer prefix[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for undefined header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for empty header[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle Bearer with multiple spaces[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return true for JWT-like tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for non-JWT tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for empty token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for null/undefined[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create a valid portal token for an email[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include email and portal flag in token payload[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should set token expiry to 24 hours[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify and decode a valid portal token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for non-portal token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for token without email[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error for expired portal token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should generate password reset token for existing user[32m 233[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for non-existent user[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should invalidate previous reset tokens[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return userId for valid token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for invalid token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for used token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should mark token as used[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should generate verification token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should have 24 hour expiry[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify email with valid token[32m 3[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for invalid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return false for expired token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should delete token after successful verification[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create refresh token with 30-day expiry[32m 8[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should store device metadata[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return userId for valid token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for revoked token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should rotate valid token and return new one[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for unknown token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all tokens on reuse detection[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should return null for expired token[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke specific token[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all tokens for user[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired refresh tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired password reset tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup expired email verification tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should cleanup old login attempts via accountLockoutService[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should use JWT_SECRET if provided[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should warn if JWT_SECRET is less than 32 characters[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject token with modified payload[32m 2[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject token with valid structure but invalid signature[39m[32m 2[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with special characters [33m 481[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle password with only spaces[32m 223[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should handle password with newlines and tabs [33m 443[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject password with null bytes (if validation exists) [33m 449[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email with unicode domain (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email starting with dot (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email ending with dot before @ (security fix)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle email with plus addressing[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle email with subdomain[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject email with invalid TLD (single char)[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should accept email with numeric TLD[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should prevent timing attacks on token validation[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should support full user authentication lifecycle[32m 227[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support complete password reset workflow [33m 438[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should prevent reuse of password reset tokens[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should support multiple valid refresh tokens per user[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should revoke all user tokens on security event[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle database connection failures gracefully[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should handle transaction failures[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should throw error if JWT signing fails[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should hash password in reasonable time (< 500ms)[32m 218[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should compare password in reasonable time (< 500ms) [33m 437[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create JWT token in < 10ms[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should verify JWT token in < 10ms[32m 1[2mms[22m[39m
{"level":50,"time":1767820242758,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820242764,"env":"test","module":"user-credentials-repository","userId":"651a9c0a-6d98-4fce-af34-90b760deec1d","msg":"User credentials created"}
{"level":50,"time":1767820242782,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820242787,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820242814,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767820242815,"env":"test","module":"email-queue","jobId":"b0c9d8ec-6732-4a29-8732-64ab904af8ac","to":"test-dEMm8xy8snwVhlKWSBf5O@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820242831,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts[2m > [22m[2mAuth Middleware Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820242822,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820242822,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820242826,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820242831,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820242831,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820242831,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820242831,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767820242842,"env":"test","module":"email-queue","jobId":"56d1fd43-5f34-4b14-8041-fc35cba56b33","to":"test-41iuyorv1co0FCW42AOLd@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820242862,"env":"test","module":"user-credentials-repository","userId":"3d335b45-b2fd-4df1-9dc0-393f255d67c5","msg":"User credentials created"}
{"level":30,"time":1767820242869,"env":"test","module":"email-queue","jobId":"5699a55d-2ac7-4e57-9fed-0691d608da8a","to":"test-1767820242384-tbaaho@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820242870,"env":"test","module":"auth-routes","userId":"29a78cc9-6332-4272-ac51-3ffb2fa4f763","email":"test-dEMm8xy8snwVhlKWSBf5O@example.com","msg":"User registered"}
{"level":30,"time":1767820242903,"env":"test","module":"auth-routes","userId":"f4413c35-475b-4d6a-b554-12cef51909e2","email":"test-41iuyorv1co0FCW42AOLd@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767820242920,"env":"test","module":"auth-routes","userId":"651a9c0a-6d98-4fce-af34-90b760deec1d","email":"test-1767820242384-tbaaho@example.com","msg":"User registered"}
{"level":30,"time":1767820242971,"env":"test","module":"email-queue","jobId":"11501189-b8c3-44be-958a-0922a6c31994","to":"test-BojvCYlDDagrmRHwivop3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820242982,"env":"test","module":"user-credentials-repository","userId":"tbudY-KWOR94Smc4oQ3zY","msg":"User credentials created"}
{"level":30,"time":1767820243027,"env":"test","module":"auth-routes","userId":"3d335b45-b2fd-4df1-9dc0-393f255d67c5","email":"test-BojvCYlDDagrmRHwivop3@example.com","msg":"User registered"}
{"level":30,"time":1767820243123,"env":"test","module":"user-credentials-repository","userId":"CSQs9ka4Vqph1Kn8adEzp","msg":"User credentials created"}
stderr | tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflows_creator_id_users_id_fk" on table "workflows"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/organizations-audit-fixes.test.ts:70:7 {
  length: 336,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(a5c0d41d-bf32-428e-b662-ac16e47a6e65) is still referenced from table "workflows".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflows',
  column: undefined,
  dataType: undefined,
  constraint: 'workflows_creator_id_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/organizations-audit-fixes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/organizations-audit-fixes.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 8080[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should cascade ownership to workflow runs when project is transferred [33m 1163[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent double-acceptance via transaction [33m 930[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not create invite if email fails [33m 517[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow re-invite after invite expires [33m 1087[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow last admin to delete empty organization [33m 612[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent deletion if org owns assets[39m[33m 857[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should cleanup placeholder user when invite is revoked [33m 1053[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should fail fast on non-existent org [33m 469[2mms[22m[39m
{"level":40,"time":1767820243240,"env":"test","module":"auth-service","tokenHash":"54fe1b9661c75189b6fd10fe6e1971c922972b41baf9041b68a1ae21f64f9ae9","msg":"Security: Unknown refresh token used"}
{"level":30,"time":1767820243305,"env":"test","module":"auth-routes","userId":"tbudY-KWOR94Smc4oQ3zY","msg":"All other sessions revoked"}
{"level":30,"time":1767820243339,"env":"test","module":"user-credentials-repository","userId":"c0a7b8ff-1b7b-45ab-8cdd-0539373a1f5c","msg":"User credentials created"}
{"level":30,"time":1767820243360,"env":"test","module":"audit-log-service","userId":"tbudY-KWOR94Smc4oQ3zY","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767820243445,"env":"test","module":"email-queue","jobId":"4e34d688-8592-421c-b199-b3ba72ad1928","to":"test-EiNTRySsFkMJALqEr4q74@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820243485,"env":"test","module":"user-credentials-repository","userId":"c69f6aec-b372-47ee-9159-c27b3d2fbd94","msg":"User credentials created"}
{"level":30,"time":1767820243486,"env":"test","module":"user-credentials-repository","userId":"bbe4e221-6686-480c-8044-43e2a59364a9","msg":"User credentials created"}
{"level":30,"time":1767820243500,"env":"test","module":"auth-routes","userId":"c0a7b8ff-1b7b-45ab-8cdd-0539373a1f5c","email":"test-EiNTRySsFkMJALqEr4q74@example.com","msg":"User registered"}
{"level":30,"time":1767820243567,"env":"test","module":"user-credentials-repository","userId":"P0PyeFiCJl8bKXB6NnEix","msg":"User credentials created"}
{"level":30,"time":1767820243590,"env":"test","module":"email-queue","jobId":"e4cbc3fc-8c99-4ed1-9c86-c6978dc3f607","to":"protected-test-BcqO-Z6FDSYT210mF89gV@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820243594,"env":"test","module":"email-queue","jobId":"99018100-bb6b-4897-adc9-32b29e7d0865","to":"session-test-lAEMj3uASDMVGipxYAHZR@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820243646,"env":"test","module":"auth-routes","userId":"c69f6aec-b372-47ee-9159-c27b3d2fbd94","email":"session-test-lAEMj3uASDMVGipxYAHZR@example.com","msg":"User registered"}
{"level":30,"time":1767820243647,"env":"test","module":"auth-routes","userId":"bbe4e221-6686-480c-8044-43e2a59364a9","email":"protected-test-BcqO-Z6FDSYT210mF89gV@example.com","msg":"User registered"}
{"level":40,"time":1767820243675,"env":"test","module":"auth-service","tokenHash":"1657056998c766dab1f1d30c9efed55f99c701af6faf5f16b103e54e6432cb66","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1767820243738,"env":"test","module":"user-credentials-repository","userId":"ffKmAdIv5ZLido2Bn043p","msg":"User credentials created"}
{"level":50,"time":1767820243864,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820243868,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820243875,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820243880,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820243906,"env":"test","module":"auth-routes","userId":"f6077210fd213af29b396bc5a57bf946","msg":"User logged in successfully"}
{"level":30,"time":1767820243952,"env":"test","module":"auth-routes","userId":"ffKmAdIv5ZLido2Bn043p","msg":"All other sessions revoked"}
{"level":30,"time":1767820243957,"env":"test","module":"audit-log-service","userId":"f6077210fd213af29b396bc5a57bf946","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820243976,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820243997,"env":"test","module":"user-credentials-repository","userId":"OEXyxj6kZ3_QRmeyOM25E","msg":"User credentials created"}
{"level":30,"time":1767820244003,"env":"test","module":"audit-log-service","userId":"ffKmAdIv5ZLido2Bn043p","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":50,"time":1767820244021,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767820244057,"env":"test","module":"user-credentials-repository","userId":"0552c1c7-15fc-4a1d-bc5c-7865676fcb23","msg":"User credentials created"}
{"level":50,"time":1767820244069,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820244098,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"qpdf --decrypt \"C:\\Users\\scoot\\AppData\\Local\\Temp\\locked-1767820244069.pdf\" \"C:\\Users\\scoot\\AppData\\Local\\Temp\\unlocked-1767820244069.pdf\"","stdout":"","stderr":"'qpdf' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"Failed to unlock PDF with qpdf"}
{"level":40,"time":1767820244098,"env":"test","msg":"Returning original PDF buffer due to unlock failure"}
{"level":50,"time":1767820244100,"env":"test","error":{},"msg":"Failed to extract PDF fields"}
{"level":50,"time":1767820244100,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF processing failed"}
{"level":50,"time":1767820244101,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"b2c92b98-3a48-4bc4-bf34-5ea17ebc7146"},"file":{"fieldname":"file","originalname":"test.pdf","encoding":"7bit","mimetype":"application/pdf","buffer":{"type":"Buffer","data":[37,80,68,70]},"size":4},"msg":"Error creating template"}
{"level":30,"time":1767820244162,"env":"test","module":"email-queue","jobId":"4cc2e76a-d382-4087-a49a-8244af8749f7","to":"middleware-test-ZZfTTKBZYhWNnJSUDrBVx@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767820244179,"env":"test","module":"mfa-service","userId":"387e63b00e0feeb7282f352af869cd67","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820244179,"env":"test","module":"auth-routes","userId":"387e63b00e0feeb7282f352af869cd67","msg":"MFA verification failed during login"}
{"level":50,"time":1767820244184,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820244212,"env":"test","error":{"error":{"code":"VALIDATION_ERROR","message":""}},"body":{"name":"Test Template"},"params":{"projectId":"b2c92b98-3a48-4bc4-bf34-5ea17ebc7146"},"msg":"Error creating template"}
{"level":30,"time":1767820244213,"env":"test","module":"auth-routes","userId":"0552c1c7-15fc-4a1d-bc5c-7865676fcb23","email":"middleware-test-ZZfTTKBZYhWNnJSUDrBVx@example.com","msg":"User registered"}
{"level":50,"time":1767820244334,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820244377,"env":"test","module":"user-credentials-repository","userId":"b0e9f4a0-4b17-4d2a-83b3-ea8e8c66ad6d","msg":"User credentials created"}
{"level":30,"time":1767820244392,"env":"test","module":"user-credentials-repository","userId":"eqjJ2iHYr5acSnYNQvw_K","msg":"User credentials created"}
{"level":30,"time":1767820244414,"env":"test","module":"user-credentials-repository","userId":"a151e91c-8eb6-43dd-8fb8-98d75724c69f","msg":"User credentials created"}
{"level":50,"time":1767820244445,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820244490,"env":"test","module":"email-queue","jobId":"ac84e7e1-7a3e-4443-9269-82bff4a8257c","to":"protected-test-aHBz2EclpNqy3dtg4ptXF@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820244517,"env":"test","module":"email-queue","jobId":"87badbb6-6498-4caf-95bd-08d0f40b8415","to":"session-test-zeuc3W0TXur2OUtcB-5ba@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820244543,"env":"test","module":"auth-routes","userId":"b0e9f4a0-4b17-4d2a-83b3-ea8e8c66ad6d","email":"protected-test-aHBz2EclpNqy3dtg4ptXF@example.com","msg":"User registered"}
{"level":50,"time":1767820244545,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767820244555,"env":"test","module":"mfa-service","userId":"387e63b00e0feeb7282f352af869cd67","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820244555,"env":"test","module":"auth-routes","userId":"387e63b00e0feeb7282f352af869cd67","msg":"MFA verification failed during login"}
{"level":50,"time":1767820244559,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767820244573,"env":"test","module":"auth-routes","userId":"a151e91c-8eb6-43dd-8fb8-98d75724c69f","email":"session-test-zeuc3W0TXur2OUtcB-5ba@example.com","msg":"User registered"}
{"level":30,"time":1767820244609,"env":"test","module":"auth-routes","userId":"OEXyxj6kZ3_QRmeyOM25E","msg":"User logged in successfully"}
{"level":30,"time":1767820244621,"env":"test","module":"auth-routes","userId":"f70b1cd5b342be685d75bed17c5c83bc","msg":"User logged in successfully"}
{"level":30,"time":1767820244660,"env":"test","module":"audit-log-service","userId":"OEXyxj6kZ3_QRmeyOM25E","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820244672,"env":"test","module":"audit-log-service","userId":"f70b1cd5b342be685d75bed17c5c83bc","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820244707,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820244712,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820244723,"env":"test","module":"user-credentials-repository","userId":"yakIXe0cL1WhIcI8WuOKW","msg":"User credentials created"}
{"level":50,"time":1767820244727,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820244864,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820244959,"env":"test","module":"user-credentials-repository","userId":"ecf8d9ae-8846-458c-9cd8-442787a06544","msg":"User credentials created"}
{"level":30,"time":1767820244980,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":40,"time":1767820244995,"env":"test","module":"mfa-service","userId":"387e63b00e0feeb7282f352af869cd67","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820244995,"env":"test","module":"auth-routes","userId":"387e63b00e0feeb7282f352af869cd67","msg":"MFA verification failed during login"}
{"level":50,"time":1767820245000,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820245068,"env":"test","module":"email-queue","jobId":"efb582ae-9fd8-4bee-a44f-9c7a3e767f84","to":"middleware-test-845eSbO-bRUVcvq2hF2z_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820245096,"env":"test","module":"user-credentials-repository","userId":"o-gq99f9L5xxfvZotO67A","msg":"User credentials created"}
{"level":30,"time":1767820245121,"env":"test","module":"user-credentials-repository","userId":"cDT-a1z5g5bmvM6aiERB0","msg":"User credentials created"}
{"level":30,"time":1767820245121,"env":"test","module":"auth-routes","userId":"ecf8d9ae-8846-458c-9cd8-442787a06544","email":"middleware-test-845eSbO-bRUVcvq2hF2z_@example.com","msg":"User registered"}
{"level":30,"time":1767820245133,"env":"test","module":"auth-routes","userId":"b0e9f4a0-4b17-4d2a-83b3-ea8e8c66ad6d","msg":"User logged in successfully"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820245192,"env":"test","module":"audit-log-service","userId":"b0e9f4a0-4b17-4d2a-83b3-ea8e8c66ad6d","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820245196,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820245219,"env":"test","module":"auth-routes","userId":"caae93fbe9de5d6c20e54530682449f1","msg":"User logged in successfully"}
{"level":30,"time":1767820245225,"env":"test","module":"auth-routes","userId":"cDT-a1z5g5bmvM6aiERB0","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":30,"time":1767820245230,"env":"test","module":"auth-routes","userId":"a151e91c-8eb6-43dd-8fb8-98d75724c69f","msg":"User logged in successfully"}
{"level":30,"time":1767820245270,"env":"test","module":"audit-log-service","userId":"caae93fbe9de5d6c20e54530682449f1","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820245283,"env":"test","module":"audit-log-service","userId":"a151e91c-8eb6-43dd-8fb8-98d75724c69f","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820245352,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820245441,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820245588,"env":"test","module":"user-credentials-repository","userId":"xHHRqcCnXO8EOZ2lSuliO","msg":"User credentials created"}
{"level":30,"time":1767820245588,"env":"test","module":"user-credentials-repository","userId":"f3e2b3a4-5155-4aed-906f-80df46b0239f","msg":"User credentials created"}
{"level":30,"time":1767820245619,"env":"test","module":"user-credentials-repository","userId":"RTWzmeabHJ-XYQCLYFnUO","msg":"User credentials created"}
{"level":30,"time":1767820245699,"env":"test","module":"email-queue","jobId":"b83dc097-5f07-4e63-8984-be6ce73534a6","to":"protected-test-WhT4UJHaIrlnxMEoltVi4@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820245728,"env":"test","module":"auth-routes","userId":"RTWzmeabHJ-XYQCLYFnUO","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Device marked as trusted"}
{"level":30,"time":1767820245738,"env":"test","module":"user-credentials-repository","userId":"1c0493f2-0b72-4e53-b3dc-1ed8586120e0","msg":"User credentials created"}
{"level":30,"time":1767820245752,"env":"test","module":"auth-routes","userId":"f3e2b3a4-5155-4aed-906f-80df46b0239f","email":"protected-test-WhT4UJHaIrlnxMEoltVi4@example.com","msg":"User registered"}
{"level":30,"time":1767820245786,"env":"test","module":"mfa-service","userId":"caae93fbe9de5d6c20e54530682449f1","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767820245787,"env":"test","module":"mfa-service","userId":"caae93fbe9de5d6c20e54530682449f1","msg":"Generated TOTP secret"}
{"level":30,"time":1767820245787,"env":"test","module":"auth-routes","userId":"caae93fbe9de5d6c20e54530682449f1","msg":"MFA setup initiated"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820245843,"env":"test","module":"user-credentials-repository","userId":"d6d2d1dd-7f0c-4713-b108-19174be1ebc9","msg":"User credentials created"}
{"level":30,"time":1767820245845,"env":"test","module":"email-queue","jobId":"77828806-fa5e-440e-bdde-e09185688146","to":"session-test-axUh_LJjF11-Qb5hQb87V@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820245887,"env":"test","module":"auth-routes","userId":"RTWzmeabHJ-XYQCLYFnUO","deviceFingerprint":"0c304ba4c86647b5f5daea2958cadcf6d04bf27326f1c319a59264ba7ace843b","msg":"Trusted device expiry updated"}
{"level":30,"time":1767820245900,"env":"test","module":"auth-routes","userId":"1c0493f2-0b72-4e53-b3dc-1ed8586120e0","email":"session-test-axUh_LJjF11-Qb5hQb87V@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820245956,"env":"test","module":"email-queue","jobId":"95786e66-6672-499d-a9be-734dcdbc85cb","to":"middleware-test-c8_OfkcLCzub68KW-689d@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820245972,"env":"test","module":"user-credentials-repository","userId":"Wi8OZD3ZMz_zM9UR4afAa","msg":"User credentials created"}
{"level":30,"time":1767820246007,"env":"test","module":"auth-routes","userId":"d6d2d1dd-7f0c-4713-b108-19174be1ebc9","email":"middleware-test-c8_OfkcLCzub68KW-689d@example.com","msg":"User registered"}
{"level":50,"time":1767820246077,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820246159,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820246270,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820246282,"env":"test","module":"user-credentials-repository","userId":"IUcYt22fSZnrBGDEj9ySq","msg":"User credentials created"}
{"level":30,"time":1767820246396,"env":"test","module":"auth-routes","userId":"IUcYt22fSZnrBGDEj9ySq","deviceCount":2,"msg":"Listed trusted devices"}
{"level":50,"time":1767820246396,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820246412,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820246430,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820246476,"env":"test","module":"user-credentials-repository","userId":"1a85ec47-9349-4eb7-9412-f8ce05d0f32b","msg":"User credentials created"}
{"level":30,"time":1767820246513,"env":"test","module":"user-credentials-repository","userId":"tNrghJQP6nxPaiBWEcbg4","msg":"User credentials created"}
{"level":40,"time":1767820246520,"env":"test","module":"mfa-service","userId":"a3457194b30387938ced979da275d2b3","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820246520,"env":"test","module":"auth-routes","userId":"a3457194b30387938ced979da275d2b3","msg":"MFA verification failed during login"}
{"level":50,"time":1767820246524,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820246528,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820246561,"env":"test","module":"auth-routes","userId":"d6d2d1dd-7f0c-4713-b108-19174be1ebc9","msg":"User logged in successfully"}
{"level":30,"time":1767820246580,"env":"test","module":"email-queue","jobId":"44dc96be-18b3-44fe-b769-a91d15501051","to":"protected-test-p5qCJfS_qRfLp-K_Y4i7D@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820246616,"env":"test","module":"audit-log-service","userId":"d6d2d1dd-7f0c-4713-b108-19174be1ebc9","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820246620,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820246635,"env":"test","module":"auth-routes","userId":"1a85ec47-9349-4eb7-9412-f8ce05d0f32b","email":"protected-test-p5qCJfS_qRfLp-K_Y4i7D@example.com","msg":"User registered"}
{"level":30,"time":1767820246660,"env":"test","module":"user-credentials-repository","userId":"060f402f-3ea8-4eda-a1df-f24a58355426","msg":"User credentials created"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":50,"time":1767820246685,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":50,"time":1767820246691,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:41:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
The above error occurred in the <RunsTable> component:

    at RunsTable (C:/Users/scoot/poll/VaultLogic/client/src/components/runs/RunsTable.tsx:18:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1767820246722,"env":"test","module":"user-credentials-repository","userId":"gU1LwOws8UQqsv0cdCakQ","msg":"User credentials created"}
{"level":30,"time":1767820246766,"env":"test","module":"email-queue","jobId":"b9976ea4-4a28-4a43-9e8c-aee182d8e517","to":"session-test-OaRVEIBHPVGGCebjOxWm1@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820246774,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820246818,"env":"test","module":"auth-routes","userId":"060f402f-3ea8-4eda-a1df-f24a58355426","email":"session-test-OaRVEIBHPVGGCebjOxWm1@example.com","msg":"User registered"}
{"level":30,"time":1767820246831,"env":"test","module":"auth-routes","userId":"gU1LwOws8UQqsv0cdCakQ","deviceCount":0,"msg":"Listed trusted devices"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > reverts value on save error
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:204:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":30,"time":1767820246929,"env":"test","module":"email-queue","jobId":"e293c8dc-96da-4396-9237-1ecd70ce2691","to":"test-1767820246328-ugfhv@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820246929,"env":"test","module":"auth-service","email":"test-1767820246328-ugfhv@example.com","msg":"Password reset email sent"}
{"level":50,"time":1767820246949,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Error Handling > displays error indicator on save failure
Failed to save cell: Error: Network error
    at C:/Users/scoot/poll/VaultLogic/tests/ui/datavault/EditableCell.test.tsx:220:36
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37
    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)
    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)
    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)

{"level":30,"time":1767820247019,"env":"test","module":"user-credentials-repository","userId":"94dc9b09-4c76-4d26-8601-790ae4b1412c","msg":"User credentials created"}
{"level":50,"time":1767820247093,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820247098,"env":"test","module":"user-credentials-repository","userId":"ws6wsKmX4-nm7_2iQXVsL","msg":"User credentials created"}
{"level":30,"time":1767820247127,"env":"test","module":"email-queue","jobId":"42c569cd-4810-4302-b966-3ede4356a8ef","to":"middleware-test-_Wm_BlJONt4r0fbEtMVDQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820247159,"env":"test","module":"user-credentials-repository","userId":"QcjEecd47X-B89e-PQyWN","msg":"User credentials created"}
{"level":30,"time":1767820247181,"env":"test","module":"auth-routes","userId":"94dc9b09-4c76-4d26-8601-790ae4b1412c","email":"middleware-test-_Wm_BlJONt4r0fbEtMVDQ@example.com","msg":"User registered"}
{"level":50,"time":1767820247191,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820247242,"env":"test","module":"email-queue","jobId":"bc3fd11a-de68-4c11-a751-bd926f3ead7f","to":"test-1767820246328-ugfhv@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820247242,"env":"test","module":"auth-service","email":"test-1767820246328-ugfhv@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767820247348,"env":"test","module":"user-credentials-repository","userId":"3815ad37-3de6-4f8f-bd54-dac1b531e7cd","msg":"User credentials created"}
{"level":50,"time":1767820247380,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820247454,"env":"test","module":"email-queue","jobId":"e42d1204-8699-405a-8b19-a5c4b0c6103f","to":"protected-test-vDiZosZPayx67WJ0MHFY3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820247498,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820247511,"env":"test","module":"auth-routes","userId":"3815ad37-3de6-4f8f-bd54-dac1b531e7cd","email":"protected-test-vDiZosZPayx67WJ0MHFY3@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820247608,"env":"test","module":"user-credentials-repository","userId":"4db6044c-ad55-42b2-a276-b86555bb163a","msg":"User credentials created"}
{"level":30,"time":1767820247612,"env":"test","module":"user-credentials-repository","userId":"5FxI7mP7rU9QxyUJIrOqn","msg":"User credentials created"}
[90mstdout[2m | tests/ui/runs.components.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820247644,"env":"test","module":"user-credentials-repository","error":{},"userId":"42f59aaea2aed032f2558946a7ab6a88","msg":"Failed to update user password"}
{"level":50,"time":1767820247644,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
 [31mÎ“Â¥Â»[39m tests/ui/runs.components.test.tsx [2m([22m[2m19 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 2255[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should render runs table with correct columns[39m[32m 31[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should render run data correctly[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show success badge for successful runs[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show error badge for failed runs[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should format duration correctly[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show download options for successful runs[39m[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should render all filter controls[32m 105[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should call onChange when status filter changes [33m 439[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should call onChange when search is submitted[32m 85[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show clear filters button when filters are active[32m 25[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should clear all filters when clear button is clicked[32m 32[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should render all trace entries[32m 53[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show executed badge for executed nodes[32m 24[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show skipped badge for skipped nodes[32m 17[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should display conditions and their results[32m 23[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should display error messages[32m 17[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should toggle show skipped nodes[32m 31[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should expand outputs delta when clicked[32m 40[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should copy trace as JSON[32m 27[2mms[22m[39m
{"level":30,"time":1767820247718,"env":"test","module":"email-queue","jobId":"117518a0-980f-4bfd-b008-187d3a0841a6","to":"session-test-GHgcHtwyFNkrr87RJLYoN@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820247774,"env":"test","module":"auth-routes","userId":"4db6044c-ad55-42b2-a276-b86555bb163a","email":"session-test-GHgcHtwyFNkrr87RJLYoN@example.com","msg":"User registered"}
{"level":50,"time":1767820247842,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820247889,"env":"test","module":"user-credentials-repository","userId":"88666d23-5851-4fee-9e69-312a10d4f6de","msg":"User credentials created"}
{"level":50,"time":1767820247926,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820247946,"env":"test","module":"user-credentials-repository","userId":"8KZVFJW91eJhIwqqIOR7k","msg":"User credentials created"}
{"level":30,"time":1767820247997,"env":"test","module":"email-queue","jobId":"08167565-29b8-43b2-99a0-d7416547349c","to":"middleware-test-V_KD1sCgY45OWA0VQJ5-a@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767820248039,"env":"test","module":"mfa-service","userId":"5eaf68b52447fd376dfea790492f4abf","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820248039,"env":"test","module":"auth-routes","userId":"5eaf68b52447fd376dfea790492f4abf","msg":"MFA verification failed during login"}
{"level":50,"time":1767820248043,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820248050,"env":"test","module":"auth-routes","userId":"88666d23-5851-4fee-9e69-312a10d4f6de","email":"middleware-test-V_KD1sCgY45OWA0VQJ5-a@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":50,"time":1767820248106,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820248146,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820248146,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "runs_created_by_users_id_fk" on table "runs"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.templates-runs.test.ts:83:5 {
  length: 311,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(29a78cc9-6332-4272-ac51-3ffb2fa4f763) is still referenced from table "runs".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'runs',
  column: undefined,
  dataType: undefined,
  constraint: 'runs_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.templates-runs.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820248168,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820248231,"env":"test","module":"user-credentials-repository","userId":"2e7c4aed-4cca-4217-884a-01f9bbbfa4bd","msg":"User credentials created"}
{"level":40,"time":1767820248269,"env":"test","module":"mfa-service","userId":"7141316272d195b038d30c7660997bf5","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820248269,"env":"test","module":"auth-routes","userId":"7141316272d195b038d30c7660997bf5","msg":"MFA verification failed during login"}
{"level":30,"time":1767820248290,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767820248311,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts[2m > [22m[2mJWT Authentication Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820248298,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820248298,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820248304,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820248310,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820248310,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820248311,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820248311,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767820248344,"env":"test","module":"email-queue","jobId":"5b679a23-6059-4f3e-ba37-ab5d245abc27","to":"protected-test-tuWl-FLiICoDulobjlrEd@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820248373,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820248398,"env":"test","module":"user-credentials-repository","userId":"vMpaEGemYU0WATXTdo6Ij","msg":"User credentials created"}
{"level":30,"time":1767820248398,"env":"test","module":"auth-routes","userId":"2e7c4aed-4cca-4217-884a-01f9bbbfa4bd","email":"protected-test-tuWl-FLiICoDulobjlrEd@example.com","msg":"User registered"}
 [31mÎ“Â¥Â»[39m tests/integration/api.templates-runs.test.ts [2m([22m[2m15 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 6690[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should create template with file upload[32m 173[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject non-docx files[39m[32m 143[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject without file[32m 109[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list templates [33m 331[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should get template by ID[32m 279[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should extract placeholders[32m 280[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update template name [33m 321[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should delete template [33m 432[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should execute workflow[32m 283[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should include logs in debug mode[32m 273[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should reject without required permission[39m[32m 8[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list runs [33m 391[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should filter by workflowId [33m 377[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get run by ID [33m 429[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get run logs [33m 485[2mms[22m[39m
{"level":50,"time":1767820248460,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820248466,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ui/datavault/EditableCell.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820248541,"env":"test","module":"user-credentials-repository","userId":"47f6fb63-1824-49c1-b414-88ec8e18edb1","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/ui/datavault/EditableCell.test.tsx [2m([22m[2m29 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 4038[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders value in display mode initially[32m 40[2mms[22m[39m
       [32mÎ“Â£Ã´[39m shows double-click hint on hover[32m 161[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not show hint for read-only cells[32m 22[2mms[22m[39m
       [32mÎ“Â£Ã´[39m includes proper ARIA label with column name and value[32m 22[2mms[22m[39m
       [32mÎ“Â£Ã´[39m indicates read-only status in ARIA label[32m 21[2mms[22m[39m
       [32mÎ“Â£Ã´[39m is focusable when editable[32m 21[2mms[22m[39m
       [32mÎ“Â£Ã´[39m is not focusable when read-only[32m 19[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on double-click[32m 56[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on Enter key press[32m 49[2mms[22m[39m
       [32mÎ“Â£Ã´[39m enters edit mode on Space key press[32m 46[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not enter edit mode when read-only[32m 18[2mms[22m[39m
       [32mÎ“Â£Ã´[39m focuses and selects input text on edit mode entry[32m 36[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves on blur[32m 117[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves on Enter key press[32m 102[2mms[22m[39m
       [32mÎ“Â£Ã´[39m does not save if value unchanged[32m 55[2mms[22m[39m
       [32mÎ“Â£Ã´[39m cancels edit on Escape key press[32m 98[2mms[22m[39m
       [32mÎ“Â£Ã´[39m reverts value on save error[32m 103[2mms[22m[39m
       [32mÎ“Â£Ã´[39m displays error indicator on save failure[32m 111[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders checkbox for boolean type[32m 45[2mms[22m[39m
       [32mÎ“Â£Ã´[39m saves immediately on checkbox change[32m 44[2mms[22m[39m
       [32mÎ“Â£Ã´[39m disables checkbox when read-only[32m 36[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m shows loading spinner when saving checkbox[39m[33m 1045[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders number input for number type[32m 55[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders email input for email type[32m 53[2mms[22m[39m
       [32mÎ“Â£Ã´[39m renders url input for url type[32m 53[2mms[22m[39m
       [32mÎ“Â£Ã´[39m includes placeholder text in edit mode[32m 54[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m formats date values for display[39m[32m 47[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m formats boolean values as Yes/No[39m[32m 19[2mms[22m[39m
       [32mÎ“Â£Ã´[39m handles null values gracefully[32m 18[2mms[22m[39m
{"level":30,"time":1767820248597,"env":"test","module":"user-credentials-repository","userId":"bedac8fb-8863-404c-a5e8-13ebde38a185","msg":"User credentials created"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767820248643,"env":"test","module":"email-queue","jobId":"8615df67-db88-4fd3-bf83-9aeb2f7c84f4","to":"session-test-csQpv6u2JRh-5_Zyrr9H_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820248695,"env":"test","module":"auth-routes","userId":"47f6fb63-1824-49c1-b414-88ec8e18edb1","email":"session-test-csQpv6u2JRh-5_Zyrr9H_@example.com","msg":"User registered"}
{"level":30,"time":1767820248703,"env":"test","module":"email-queue","jobId":"74c5122d-24ca-445b-805d-c308143325f4","to":"test-1767820248212-34ry8@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820248719,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820248725,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820248753,"env":"test","module":"auth-routes","userId":"bedac8fb-8863-404c-a5e8-13ebde38a185","email":"test-1767820248212-34ry8@example.com","msg":"User registered"}
{"level":30,"time":1767820248769,"env":"test","module":"user-credentials-repository","userId":"874fae8a-d199-492e-a6ba-c17aefaf4d4b","msg":"User credentials created"}
[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820248818,"env":"test","module":"user-credentials-repository","userId":"912f1a29-6f40-4fcc-a11d-cd84cf3dfa59","msg":"User credentials created"}
{"level":30,"time":1767820248838,"env":"test","module":"user-credentials-repository","userId":"Mj-2pNoMtkFin9NNIxWbK","msg":"User credentials created"}
{"level":30,"time":1767820248879,"env":"test","module":"email-queue","jobId":"c92dc392-f0ad-42aa-ad96-7e407dfa0641","to":"middleware-test-fZKwtKnPup88v-tCnDG1M@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820248921,"env":"test","module":"email-queue","jobId":"023a0e29-be08-4a09-a60b-0c851c373818","to":"test-MSNYNi_QwRWIxhQYukte7@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820248934,"env":"test","module":"email-queue","jobId":"581b5bc0-fe92-42db-8c90-85d7674ccdea","to":"test-1767820248065-wc6ium@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820248934,"env":"test","module":"auth-routes","userId":"874fae8a-d199-492e-a6ba-c17aefaf4d4b","email":"middleware-test-fZKwtKnPup88v-tCnDG1M@example.com","msg":"User registered"}
{"level":30,"time":1767820248934,"env":"test","module":"auth-service","email":"test-1767820248065-wc6ium@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767820248976,"env":"test","module":"auth-routes","userId":"912f1a29-6f40-4fcc-a11d-cd84cf3dfa59","email":"test-MSNYNi_QwRWIxhQYukte7@example.com","msg":"User registered"}
{"level":50,"time":1767820249025,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820249056,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820249117,"env":"test","module":"user-credentials-repository","userId":"3e4208a0-96e2-4327-813f-2f74e3b2f70e","msg":"User credentials created"}
{"level":30,"time":1767820249225,"env":"test","module":"email-queue","jobId":"6631463f-a95d-44fa-88c1-1e18deb81d53","to":"protected-test-wnpMdBI-t2hd6swmorjGr@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820249237,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820249243,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820249246,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820249250,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820249276,"env":"test","module":"auth-routes","userId":"3e4208a0-96e2-4327-813f-2f74e3b2f70e","email":"protected-test-wnpMdBI-t2hd6swmorjGr@example.com","msg":"User registered"}
{"level":50,"time":1767820249325,"env":"test","module":"user-credentials-repository","error":{},"userId":"403f28c3e385771429ea61566631f4dd","msg":"Failed to update user password"}
{"level":50,"time":1767820249325,"env":"test","module":"auth-routes","error":{},"msg":"Reset password error"}
{"level":50,"time":1767820249332,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth/oauth2.sessions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820249416,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820249424,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820249453,"env":"test","module":"user-credentials-repository","userId":"7f97e68a-d082-47d6-9bba-b0226edea543","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.sessions.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 12727[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list all active sessions for current user [33m 535[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark current session as current [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array when user has no active sessions [33m 451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include expired sessions [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not include revoked sessions [33m 484[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should parse device name from user agent [33m 452[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 328[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke a specific session[39m[33m 436[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent session [33m 343[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 430[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking another user's session[39m[33m 490[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 333[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all sessions except current[39m[33m 757[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all trusted devices [33m 641[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 when no active session found [33m 340[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 331[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should mark current device as trusted[39m[33m 555[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update existing trusted device expiry [33m 662[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list all trusted devices [33m 451[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should not include revoked devices [33m 435[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should revoke a trusted device[39m[33m 437[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent device [33m 348[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track IP address for sessions[39m[33m 440[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track user agent for sessions[39m[33m 448[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update lastUsedAt on token refresh [33m 805[2mms[22m[39m
{"level":50,"time":1767820249526,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820249558,"env":"test","module":"email-queue","jobId":"d39fb9df-15b3-42b6-b9c8-6bf873c06b17","to":"session-test-WvhrgqQYvhr8H4ggzrWLW@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820249610,"env":"test","module":"auth-routes","userId":"7f97e68a-d082-47d6-9bba-b0226edea543","email":"session-test-WvhrgqQYvhr8H4ggzrWLW@example.com","msg":"User registered"}
{"level":50,"time":1767820249610,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767820249642,"env":"test","module":"mfa-service","userId":"630b557ea72a3dcfe5e94374c50e8b5e","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820249642,"env":"test","module":"auth-routes","userId":"630b557ea72a3dcfe5e94374c50e8b5e","msg":"MFA verification failed during login"}
{"level":50,"time":1767820249647,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820249649,"env":"test","module":"user-credentials-repository","userId":"150eba99-7eb7-4af7-a50b-4e05eec9376e","msg":"User credentials created"}
{"level":50,"time":1767820249661,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820249703,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820249746,"env":"test","module":"auth-routes","userId":"7a0fa4bd1189e1eebb0abeabd4849b24","msg":"User logged in successfully"}
{"level":30,"time":1767820249759,"env":"test","module":"email-queue","jobId":"0a57186b-73d7-4006-a820-1bb3c89208c3","to":"middleware-test-0J5PksXEO6pBzwODJjgq7@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767820249770,"env":"test","module":"mfa-service","userId":"2b7db06b36d1e5751dc1f3b4c3fbffe4","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820249770,"env":"test","module":"auth-routes","userId":"2b7db06b36d1e5751dc1f3b4c3fbffe4","msg":"MFA verification failed during login"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767820249803,"env":"test","module":"audit-log-service","userId":"7a0fa4bd1189e1eebb0abeabd4849b24","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820249818,"env":"test","module":"auth-routes","userId":"150eba99-7eb7-4af7-a50b-4e05eec9376e","email":"middleware-test-0J5PksXEO6pBzwODJjgq7@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767820249917,"env":"test","module":"auth-routes","userId":"7a0fa4bd1189e1eebb0abeabd4849b24","sessionCount":0,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":50,"time":1767820249986,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820250045,"env":"test","module":"user-credentials-repository","userId":"4127e361-7343-4071-9f75-6f07325fc893","msg":"User credentials created"}
{"level":50,"time":1767820250153,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820250153,"env":"test","module":"email-queue","jobId":"b5c9575b-64fa-459b-a68a-07c66b4c63ed","to":"protected-test-KQS-OEfP1k-ScJG0QUTM6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820250206,"env":"test","module":"auth-routes","userId":"4127e361-7343-4071-9f75-6f07325fc893","email":"protected-test-KQS-OEfP1k-ScJG0QUTM6@example.com","msg":"User registered"}
{"level":40,"time":1767820250356,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767820250383,"env":"test","module":"user-credentials-repository","userId":"a0a7525c-2aa0-49b3-adf1-56c83f110402","msg":"User credentials created"}
{"level":40,"time":1767820250484,"env":"test","module":"ai-service","attempt":4,"waitMs":16000,"msg":"Rate limit hit, retrying..."}
{"level":30,"time":1767820250488,"env":"test","module":"email-queue","jobId":"2de9a6dd-a9c2-45ee-91ab-2498af85b585","to":"session-test-PeDa8qOZskv-8c--Bo2LM@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767820250529,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820250530,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820250539,"env":"test","module":"auth-routes","userId":"a0a7525c-2aa0-49b3-adf1-56c83f110402","email":"session-test-PeDa8qOZskv-8c--Bo2LM@example.com","msg":"User registered"}
{"level":30,"time":1767820250547,"env":"test","module":"user-credentials-repository","userId":"6ce050fb-920c-4136-af7e-de11ac496c88","msg":"User credentials created"}
{"level":50,"time":1767820250559,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820250559,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":50,"time":1767820250646,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820250650,"env":"test","module":"email-queue","jobId":"ab8bdb30-ee0c-44c8-9cbc-58647b679de2","to":"middleware-test-wdPAcjVq8xbKabrTdZSyw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767820250686,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767820250698,"env":"test","module":"auth-routes","userId":"6ce050fb-920c-4136-af7e-de11ac496c88","email":"middleware-test-wdPAcjVq8xbKabrTdZSyw@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820250919,"env":"test","module":"user-credentials-repository","userId":"405bd22d-ba24-4251-a24f-ff38a48cf293","msg":"User credentials created"}
[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820251022,"env":"test","module":"email-queue","jobId":"0de394c8-3238-4ef9-bf4a-34f1b4ea405e","to":"protected-test-CK8p0-n0Qs4D28f3BISrv@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820251035,"env":"test","module":"user-credentials-repository","userId":"65296ef2-a535-4c61-ac81-c1428fd535e5","msg":"User credentials created"}
{"level":30,"time":1767820251040,"env":"test","module":"auth-routes","userId":"dceb4462adf2b51cee37c4b818539d9c","msg":"User logged in successfully"}
{"level":40,"time":1767820251059,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":30,"time":1767820251077,"env":"test","module":"auth-routes","userId":"405bd22d-ba24-4251-a24f-ff38a48cf293","email":"protected-test-CK8p0-n0Qs4D28f3BISrv@example.com","msg":"User registered"}
{"level":50,"time":1767820251089,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820251093,"env":"test","module":"audit-log-service","userId":"dceb4462adf2b51cee37c4b818539d9c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820251140,"env":"test","module":"email-queue","jobId":"1462e1e0-333a-418a-b695-5a7f234fba85","to":"session-test-7Fs1g0H2iLPpcuigDSso5@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820251168,"env":"test","module":"auth-routes","userId":"ab4b050cd37d5e6accb965f274865144","msg":"User logged in successfully"}
{"level":30,"time":1767820251195,"env":"test","module":"auth-routes","userId":"65296ef2-a535-4c61-ac81-c1428fd535e5","email":"session-test-7Fs1g0H2iLPpcuigDSso5@example.com","msg":"User registered"}
{"level":40,"time":1767820251196,"env":"test","module":"mfa-service","userId":"7673906e52aeac3af88cf58c9f521b49","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820251196,"env":"test","module":"auth-routes","userId":"7673906e52aeac3af88cf58c9f521b49","msg":"MFA verification failed during login"}
{"level":50,"time":1767820251200,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820251204,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820251220,"env":"test","module":"audit-log-service","userId":"ab4b050cd37d5e6accb965f274865144","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820251228,"env":"test","module":"auth-routes","userId":"6ce050fb-920c-4136-af7e-de11ac496c88","msg":"User logged in successfully"}
{"level":30,"time":1767820251282,"env":"test","module":"audit-log-service","userId":"6ce050fb-920c-4136-af7e-de11ac496c88","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1767820251399,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":40,"time":1767820251428,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767820251480,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767820251480,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767820251480,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767820251480,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767820251481,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767820251481,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
{"level":40,"time":1767820251482,"env":"test","msg":"Unknown condition expression format, defaulting to visible"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should debounce validation calls
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/regression-REG-1.test.ts:79:13 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(4f21dca5-a9a5-4a3e-99a8-b16565657ab1) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/regression-REG-1.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/regression-REG-1.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 2784[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should block Next when required visible question is empty [33m 336[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should NOT block Next when required question is hidden[39m[33m 325[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should block when required becomes visible and is empty [33m 322[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip hidden required page entirely[39m[33m 373[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce required on visible page [33m 420[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should evaluate visibility consistently across modes[39m[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle malformed visibility expression gracefully[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle missing variable in visibility expression[32m 0[2mms[22m[39m
{"level":50,"time":1767820251567,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820251593,"env":"test","module":"mfa-service","userId":"dceb4462adf2b51cee37c4b818539d9c","count":10,"msg":"Stored backup codes"}
{"level":30,"time":1767820251593,"env":"test","module":"mfa-service","userId":"dceb4462adf2b51cee37c4b818539d9c","msg":"Generated TOTP secret"}
{"level":30,"time":1767820251593,"env":"test","module":"auth-routes","userId":"dceb4462adf2b51cee37c4b818539d9c","msg":"MFA setup initiated"}
{"level":50,"time":1767820251612,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820251634,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820251661,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should not validate when workflowId or nodeId is missing
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render database settings page with breadcrumbs
The above error occurred in the <DatabaseSettingsPage> component:

    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:28:3)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render DatabaseSettings component with database data
The above error occurred in the <DatabaseSettingsPage> component:

    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:28:3)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should display database name in header
The above error occurred in the <DatabaseSettingsPage> component:

    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:28:3)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render sidebar
The above error occurred in the <DatabaseSettingsPage> component:

    at DatabaseSettingsPage (C:/Users/scoot/poll/VaultLogic/client/src/pages/datavault/DatabaseSettingsPage.tsx:28:3)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

[90mstdout[2m | tests/ui/datavault/DatabaseSettingsPage.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820251787,"env":"test","module":"user-credentials-repository","userId":"fa25da27-4727-4c69-b2e1-7e85e8cc6e9c","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [31mÎ“Â¥Â»[39m tests/ui/datavault/DatabaseSettingsPage.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 1289[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render database settings page with breadcrumbs[39m[32m 29[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should show loading state[39m[32m 3[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should show not found state when database does not exist[39m[32m 2[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render DatabaseSettings component with database data[39m[32m 6[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should navigate back when back button is clicked[39m[32m 11[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should display database name in header[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render sidebar[39m[32m 5[2mms[22m[39m
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate helper functions in expressions
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767820251900,"env":"test","module":"email-queue","jobId":"c5082124-039d-4f81-90bc-fe0aa8910b4d","to":"protected-test-ult_6BDlF-7aoMITgpxva@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767820251956,"env":"test","module":"auth-routes","userId":"fa25da27-4727-4c69-b2e1-7e85e8cc6e9c","email":"protected-test-ult_6BDlF-7aoMITgpxva@example.com","msg":"User registered"}
{"level":30,"time":1767820251958,"env":"test","module":"user-credentials-repository","userId":"3e82e13c-66ca-4a69-b8fe-04a0856c0044","msg":"User credentials created"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should validate complex expressions with multiple helpers
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767820252060,"env":"test","module":"email-queue","jobId":"f9886dd8-dc60-446a-a772-aee92376328d","to":"session-test-Ez7Tam4_FbU1qqlMQJ59c@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820252075,"env":"test","module":"user-credentials-repository","userId":"7aaec855-8d56-4fbd-9a70-a7085f3c62ed","msg":"User credentials created"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression validation integration > should handle syntax errors
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":30,"time":1767820252114,"env":"test","module":"auth-routes","userId":"3e82e13c-66ca-4a69-b8fe-04a0856c0044","email":"session-test-Ez7Tam4_FbU1qqlMQJ59c@example.com","msg":"User registered"}
{"level":30,"time":1767820252185,"env":"test","module":"email-queue","jobId":"fbd10a48-082c-4cb8-b681-f112e8948fc3","to":"middleware-test-8332juW_3TkVSQhKSSC9b@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820252209,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767820252238,"env":"test","module":"auth-routes","userId":"7aaec855-8d56-4fbd-9a70-a7085f3c62ed","email":"middleware-test-8332juW_3TkVSQhKSSC9b@example.com","msg":"User registered"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1767820252270,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
stderr | tests/ui/expression-editor.test.tsx > Expression Editor Hooks > Expression Editor component behavior > should update validation when expression changes
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (C:\Users\scoot\poll\VaultLogic\node_modules\@testing-library\react\dist\pure.js:328:5)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
    at C:/Users/scoot/poll/VaultLogic/tests/ui/expression-editor.test.tsx:19:13

{"level":50,"time":1767820252422,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/auth/jwt.authentication.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820252481,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820252569,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/expression-editor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820252612,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mÎ“Â¥Â»[39m tests/ui/expression-editor.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 2520[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with null validation result[32m 19[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate expression after debounce[39m[32m 11[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return validation errors for invalid expression[39m[32m 158[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should debounce validation calls[32m 157[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should not validate when workflowId or nodeId is missing[32m 155[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate helper functions in expressions[32m 153[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate complex expressions with multiple helpers[32m 106[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle syntax errors[32m 157[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle empty expressions[32m 2[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update validation when expression changes [33m 307[2mms[22m[39m
{"level":30,"time":1767820252664,"env":"test","module":"user-credentials-repository","userId":"80431eb4-0c9d-4bb3-b3f5-ae1148781388","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/integration/auth/jwt.authentication.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m20 failed[39m[2m)[22m[33m 4937[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate valid JWT token on successful login[39m[32m 16[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include correct payload in JWT token[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set JWT expiry to 15 minutes[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept valid JWT token on protected routes[39m[32m 174[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject request without authorization header[32m 4[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject request with malformed token[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject request with missing Bearer prefix[39m[32m 170[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject token with invalid signature[32m 8[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired JWT token [33m 1106[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return token_expired error code for expired tokens[39m[33m 1110[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should authenticate with Bearer token in Authorization header[32m 110[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should work with Bearer token on POST requests[32m 110[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should work with Bearer token on PUT requests[39m[32m 61[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should work with Bearer token on DELETE requests[39m[32m 276[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exchange valid session cookie for JWT token[39m[32m 7[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should reject token exchange without valid cookie[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prefer Bearer token over cookie when both present[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fall back to cookie if Bearer token is invalid[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow GET requests with cookie auth only[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST requests with cookie auth only (mutation-strict)[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow anonymous access to public workflows[39m[32m 59[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach user info if authenticated on optional auth routes[39m[32m 60[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token using refresh token[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token on use[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should detect token reuse and revoke all user tokens[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke refresh token on logout[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should clear refresh token cookie on logout[39m[32m 6[2mms[22m[39m
{"level":40,"time":1767820252729,"env":"test","module":"mfa-service","userId":"49044e9a8d535f88c75a2ac88f371dad","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820252729,"env":"test","module":"auth-routes","userId":"49044e9a8d535f88c75a2ac88f371dad","msg":"MFA verification failed during login"}
{"level":50,"time":1767820252733,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820252750,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820252775,"env":"test","module":"email-queue","jobId":"43a1296e-7419-4921-b781-7e9557b0b6e6","to":"protected-test-8E3Q-FOPl4d6lGpEd_Z5_@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820252825,"env":"test","module":"auth-routes","userId":"80431eb4-0c9d-4bb3-b3f5-ae1148781388","email":"protected-test-8E3Q-FOPl4d6lGpEd_Z5_@example.com","msg":"User registered"}
{"level":30,"time":1767820252892,"env":"test","module":"user-credentials-repository","userId":"fCUPm4ZzKg6ZHfhLg41Pt","msg":"User credentials created"}
{"level":30,"time":1767820252907,"env":"test","module":"user-credentials-repository","userId":"05966c3d-0386-4580-be7f-20f1685172d0","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767820252960,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820252971,"env":"test","module":"auth-routes","userId":"3bf23cbcc16c6d96676f44a66adda4c8","msg":"User logged in successfully"}
{"level":50,"time":1767820252976,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820252981,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820252985,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820252989,"env":"test","module":"user-credentials-repository","userId":"a0048fa8-8652-4fc7-afaa-ba7f139fec3b","msg":"User credentials created"}
{"level":50,"time":1767820253001,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253006,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253011,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253010,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820253011,"env":"test","module":"email-queue","jobId":"b05d304c-c074-436b-909d-a80a1c8c9b51","to":"session-test-Bt4ObEvODa5NGRJO_syGw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820253014,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253016,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253021,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253026,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820253027,"env":"test","module":"audit-log-service","userId":"3bf23cbcc16c6d96676f44a66adda4c8","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820253031,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253035,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253040,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253045,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253051,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253056,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253061,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820253067,"env":"test","module":"auth-routes","userId":"05966c3d-0386-4580-be7f-20f1685172d0","email":"session-test-Bt4ObEvODa5NGRJO_syGw@example.com","msg":"User registered"}
{"level":30,"time":1767820253093,"env":"test","module":"email-queue","jobId":"231cabea-d43d-41b8-b434-0ff5d9047761","to":"middleware-test-Iwj628TRUOs0_fRtfWGgX@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":50,"time":1767820253120,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820253146,"env":"test","module":"auth-routes","userId":"a0048fa8-8652-4fc7-afaa-ba7f139fec3b","email":"middleware-test-Iwj628TRUOs0_fRtfWGgX@example.com","msg":"User registered"}
{"level":50,"time":1767820253158,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820253174,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253179,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253184,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253188,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820253295,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820253299,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820253382,"env":"test","module":"user-credentials-repository","userId":"lxks4pSnDAD_lb9s0IYX7","msg":"User credentials created"}
[90mstdout[2m | tests/integration/datavault.permissions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767820253489,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mÎ“Â¥Â»[39m tests/integration/datavault.permissions.test.ts [2m([22m[2m22 tests[22m[2m | [22m[31m22 failed[39m[2m)[22m[33m 1673[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to read table[39m[32m 25[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow writer to read table[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow reader to read table[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny non-member from reading table[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to update table[39m[32m 15[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from updating table[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from updating table[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from deleting table[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from deleting table[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny non-member from deleting table[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to view permissions[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from viewing permissions[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny reader from viewing permissions[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to grant permissions[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to update existing permission (upsert)[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from granting permissions[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent modifying table owner permissions[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow owner to revoke permissions[39m[32m 60[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deny writer from revoking permissions[39m[32m 54[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce owner includes write and read[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce write includes read but not owner[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enforce read is read-only[39m[32m 4[2mms[22m[39m
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820253560,"env":"test","module":"user-credentials-repository","userId":"ad545646-a256-4bcb-a0db-7e8f0a4d3025","msg":"User credentials created"}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820253582,"env":"test","module":"user-credentials-repository","userId":"1f0ae74f-9f82-464d-b508-65021fb9dcfb","msg":"User credentials created"}
{"level":30,"time":1767820253670,"env":"test","module":"email-queue","jobId":"84bb0dfc-11d5-449e-b6d0-790627f5f5af","to":"protected-test-4CGjl_nzgxL9PHzyeA0dz@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820253688,"env":"test","module":"email-queue","jobId":"c543fbbb-9627-4f0f-b342-189678e41df7","to":"user2-KS-iPrtvwdakfWTfeSKob@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1767820253714,"env":"test","module":"auth-service","tokenHash":"cb02bfa1a6a724da90fe3024e5d1d1954fc91770c6c1801e18fc4ebf25816c2f","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mMOCK SETUP DONE. Mock questions: [
  {
    id: [32m'q1'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q1'[39m,
    order: [33m0[39m,
    isVirtual: [33mfalse[39m,
    alias: [32m'show'[39m,
    visibleIf: [1mnull[22m
  },
  {
    id: [32m'q2'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q2'[39m,
    order: [33m1[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: { op: [32m'equals'[39m, left: [36m[Object][39m, right: [36m[Object][39m }
  },
  {
    id: [32m'q3'[39m,
    sectionId: [32m'section1'[39m,
    title: [32m'Q3'[39m,
    order: [33m2[39m,
    isVirtual: [33mfalse[39m,
    visibleIf: [1mnull[22m
  }
]
Calling getVisibleQuestionCount...

[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts[2m > [22m[2mIntakeQuestionVisibilityService[2m > [22m[2mHelper methods[2m > [22m[2mshould get visible question count
[22m[39mCOUNT RESULT: [33m0[39m
Mock called times: [33m1[39m
Mock last call args: [ [ [32m'section1'[39m ] ]

{"level":30,"time":1767820253727,"env":"test","module":"auth-routes","userId":"ad545646-a256-4bcb-a0db-7e8f0a4d3025","email":"protected-test-4CGjl_nzgxL9PHzyeA0dz@example.com","msg":"User registered"}
{"level":50,"time":1767820253738,"env":"test","module":"intake-question-visibility","error":{},"questionId":"q1","condition":{"op":"invalid","left":null,"right":null},"msg":"Error evaluating visibleIf condition"}
{"level":30,"time":1767820253740,"env":"test","module":"auth-routes","userId":"1f0ae74f-9f82-464d-b508-65021fb9dcfb","email":"user2-KS-iPrtvwdakfWTfeSKob@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/intakeQuestionVisibility.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/services/intakeQuestionVisibility.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1444[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return all questions as visible when no conditions[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should exclude virtual steps from visibility evaluation[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should maintain question order[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should hide questions when visibleIf is false[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should show questions when visibleIf is true[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle complex visibleIf conditions[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle OR conditions[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle NOT conditions[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should include visible required questions in validation[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should skip hidden questions in validation[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should check if question is visible[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should get visible question count[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should clear values for hidden questions[39m[32m 8[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should not clear values for visible questions[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should warn if required question has visibility condition[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should warn if virtual step has visibility condition[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return no warnings for valid configuration[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should default to visible on condition evaluation error[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle questions that depend on each other[39m[32m 8[2mms[22m[39m
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820253902,"env":"test","module":"user-credentials-repository","userId":"a96732a2-11dc-4333-afac-22574f7faaea","msg":"User credentials created"}
{"level":50,"time":1767820253949,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820254009,"env":"test","module":"email-queue","jobId":"110f084f-9958-48d0-9476-80fc9aef1c11","to":"middleware-test-7tFat9f_oujaRg1tATI9-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820254037,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820254041,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820254042,"env":"test","module":"user-credentials-repository","userId":"W2aX-Y9vfh5wlKy-XJaZ8","msg":"User credentials created"}
{"level":50,"time":1767820254047,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820254054,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820254062,"env":"test","module":"auth-routes","userId":"a96732a2-11dc-4333-afac-22574f7faaea","email":"middleware-test-7tFat9f_oujaRg1tATI9-@example.com","msg":"User registered"}
{"level":50,"time":1767820254216,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820254327,"env":"test","module":"auth-routes","userId":"a29f683c9560266636f1967ff0447e86","msg":"User logged in successfully"}
{"level":30,"time":1767820254365,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1767820254366,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1767820254368,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1767820254383,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1767820254383,"env":"test","module":"audit-log-service","userId":"a29f683c9560266636f1967ff0447e86","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820254426,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
stderr | tests/unit/client/choice-utils.test.ts > choice-utils > handles missing content gracefully
[generateOptionsFromList] Invalid list data: null

[90mstdout[2m | tests/unit/client/choice-utils.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820254459,"env":"test","module":"user-credentials-repository","userId":"2cdda88c-5426-4f52-b23f-18802f744207","msg":"User credentials created"}
{"level":30,"time":1767820254470,"env":"test","module":"user-credentials-repository","userId":"909834f6-1939-486d-8f17-2cefd8b6d602","msg":"User credentials created"}
{"level":30,"time":1767820254468,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK initialized successfully"}
{"level":30,"time":1767820254469,"env":"test","module":"telemetry","msg":"Prometheus metrics initialized"}
{"level":30,"time":1767820254469,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":40,"time":1767820254475,"env":"test","module":"metrics-routes","ip":"::ffff:127.0.0.1","msg":"Unauthorized metrics access attempt"}
{"level":30,"time":1767820254484,"env":"test","module":"telemetry","msg":"OpenTelemetry SDK shut down successfully"}
[90mstdout[2m | tests/integration/metrics.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820254491,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mÎ“Â¥Â»[39m tests/unit/client/choice-utils.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1314[2mms[22m[39m
     [32mÎ“Â£Ã´[39m generates options with basic mapping[32m 4[2mms[22m[39m
     [32mÎ“Â£Ã´[39m sorts by label asc[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m sorts by label desc[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m dedupes by label[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m dedupes by value (alias)[32m 1[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m uses label template with column names[39m[32m 9[2mms[22m[39m
     [32mÎ“Â£Ã´[39m handles missing content gracefully[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m includes blank option at the top[32m 1[2mms[22m[39m
     [32mÎ“Â£Ã´[39m sorts by specific column asc[32m 0[2mms[22m[39m
     [32mÎ“Â£Ã´[39m sorts by specific column desc[32m 0[2mms[22m[39m
{"level":30,"time":1767820254557,"env":"test","module":"user-credentials-repository","userId":"yFMSCRv527MTnsetoe5mi","msg":"User credentials created"}
{"level":30,"time":1767820254562,"env":"test","module":"email-queue","jobId":"8340d1ec-445e-496a-96aa-775b87d9693c","to":"session-test-9QF4e1Za7Dji5cOYxxXee@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31mÎ“Â¥Â»[39m tests/integration/metrics.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1467[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should expose /metrics endpoint[39m[32m 144[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should protect /metrics if API key is set[32m 58[2mms[22m[39m
{"level":30,"time":1767820254576,"env":"test","module":"email-queue","jobId":"af9522d8-c37b-4c6e-9820-8e0bcfe1d03b","to":"protected-test-dVtDE2yGTPctkfuQfoC0a@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820254598,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767820254618,"env":"test","module":"auth-routes","userId":"2cdda88c-5426-4f52-b23f-18802f744207","email":"session-test-9QF4e1Za7Dji5cOYxxXee@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/services/AIService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820254600,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767820254600,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":66,"totalTokens":878,"durationMs":1,"estimatedCostUSD":0.00010760000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820254603,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"},"duration":4,"msg":"AI workflow revision failed"}
{"level":50,"time":1767820254604,"env":"test","module":"ai-service","duration":7,"error":{"code":"VALIDATION_ERROR","details":{"originalError":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"}},"troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"msg":"AI workflow revision failed"}
{"level":30,"time":1767820254616,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767820254616,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767820254616,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":812,"responseTokens":45,"totalTokens":857,"durationMs":0,"estimatedCostUSD":0.00009920000000000001,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820254616,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"},"duration":0,"msg":"AI workflow revision failed"}
{"level":50,"time":1767820254617,"env":"test","module":"ai-service","duration":1,"error":{"code":"VALIDATION_ERROR","details":{"originalError":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["updatedWorkflow","title"],"message":"Required"}],"name":"ZodError"}},"troubleshooting":"â‰¡Æ’Ã¶Âº Troubleshooting Steps:\n1. The AI response structure doesn't match our expected format\n2. This may indicate:\n   - A breaking change in the AI model behavior\n   - The model is struggling with the complexity of the request\n3. Try simplifying your workflow or request\n4. If this persists, please report this issue with the workflow details"},"msg":"AI workflow revision failed"}
{"level":30,"time":1767820254618,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"sectionCount":0,"msg":"Attempting single-shot workflow revision"}
{"level":30,"time":1767820254618,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767820254619,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":1,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1767820254619,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1767820254619,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1767820254620,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":2,"msg":"AI workflow revision failed"}
{"level":40,"time":1767820254620,"env":"test","module":"ai-service","estimatedInputTokens":18,"estimatedOutputTokens":36,"actualOutputTokens":4,"responseLength":13,"msg":"Single-shot revision truncated - automatically retrying with chunking"}
{"level":30,"time":1767820254620,"env":"test","module":"ai-service","event":"ai_request_started","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"maxTokens":8192,"msg":"AI request started"}
{"level":30,"time":1767820254620,"env":"test","module":"ai-service","event":"ai_request_success","provider":"gemini","model":"gemini-2.0-flash-exp","taskType":"workflow_revision","promptTokens":811,"responseTokens":4,"totalTokens":815,"durationMs":0,"estimatedCostUSD":0.0000827,"attempts":1,"msg":"AI request succeeded"}
{"level":40,"time":1767820254621,"env":"test","module":"ai-service","lastChar":"N","last50":"I am not JSON","msg":"Response does not end with closing brace/bracket"}
{"level":50,"time":1767820254621,"env":"test","module":"ai-service","responseLength":13,"estimatedTokens":4,"responseSuffix":"I am not JSON","msg":"Detected truncated AI response - workflow too large for single-shot revision"}
{"level":50,"time":1767820254621,"env":"test","module":"ai-service","error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"duration":1,"msg":"AI workflow revision failed"}
{"level":50,"time":1767820254621,"env":"test","module":"ai-service","duration":3,"error":{"code":"RESPONSE_TRUNCATED","estimatedTokens":4,"responseLength":13},"msg":"AI workflow revision failed"}
{"level":30,"time":1767820254631,"env":"test","module":"auth-routes","userId":"909834f6-1939-486d-8f17-2cefd8b6d602","email":"protected-test-dVtDE2yGTPctkfuQfoC0a@example.com","msg":"User registered"}
{"level":30,"time":1767820254662,"env":"test","module":"auth-routes","userId":"7693f18ae53bd6d5507388702f4d3153","msg":"User logged in successfully"}
{"level":30,"time":1767820254668,"env":"test","module":"auth-routes","userId":"a96732a2-11dc-4333-afac-22574f7faaea","msg":"User logged in successfully"}
 [31mÎ“Â¥Â»[39m tests/unit/services/AIService.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1352[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m reviseWorkflow should parse valid JSON response correctly[39m[32m 20[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m reviseWorkflow should handle JSON markdown code blocks[39m[32m 3[2mms[22m[39m
     [32mÎ“Â£Ã´[39m reviseWorkflow should throw on invalid JSON[32m 5[2mms[22m[39m
{"level":30,"time":1767820254717,"env":"test","module":"audit-log-service","userId":"7693f18ae53bd6d5507388702f4d3153","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820254723,"env":"test","module":"audit-log-service","userId":"a96732a2-11dc-4333-afac-22574f7faaea","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820254728,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820254767,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820254903,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820254922,"env":"test","module":"auth-routes","userId":"a29f683c9560266636f1967ff0447e86","msg":"User logged in successfully"}
{"level":50,"time":1767820254962,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820254972,"env":"test","module":"audit-log-service","userId":"a29f683c9560266636f1967ff0447e86","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820254984,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820254985,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820254991,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/auth.flows.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1767820255021,"env":"test","module":"mfa-service","userId":"1645db717aae0dea4aac8a241cdb2c54","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820255022,"env":"test","module":"auth-routes","userId":"1645db717aae0dea4aac8a241cdb2c54","msg":"MFA verification failed during login"}
{"level":50,"time":1767820255027,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820255032,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820255041,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

 [31mÎ“Â¥Â»[39m tests/integration/auth.flows.real.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m10 failed[39m[2m)[22m[33m 18379[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete registration, verify email, then login[39m[33m 1343[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should lock account after 5 failed attempts, then unlock after waiting[39m[33m 2388[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should record all login attempts[39m[33m 1665[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete MFA setup and login with TOTP[39m[33m 1073[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with backup code when TOTP unavailable[39m[33m 2009[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete full password reset flow[39m[33m 1754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should invalidate all sessions after password reset [33m 1817[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token on each use[39m[33m 1100[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should detect and prevent refresh token reuse (token theft)[39m[33m 1051[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions[39m[33m 1687[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1693[2mms[22m[39m
{"level":30,"time":1767820255140,"env":"test","module":"user-credentials-repository","userId":"beebbe7d-4e3c-4818-bd3c-327ea174719a","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767820255212,"env":"test","module":"user-credentials-repository","userId":"jPJ-znXqV6mIz3g_Oq8b1","msg":"User credentials created"}
{"level":50,"time":1767820255237,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820255244,"env":"test","module":"email-queue","jobId":"4b35f0e9-aa8a-4273-bfca-8a3e8d8cf51b","to":"middleware-test-cy8mDz2fVBdwkMVwqPvUn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820255299,"env":"test","module":"auth-routes","userId":"beebbe7d-4e3c-4818-bd3c-327ea174719a","email":"middleware-test-cy8mDz2fVBdwkMVwqPvUn@example.com","msg":"User registered"}
{"level":50,"time":1767820255321,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820255436,"env":"test","module":"user-credentials-repository","userId":"49f24d79-921b-40a7-a706-931a73377545","msg":"User credentials created"}
{"level":30,"time":1767820255465,"env":"test","module":"user-credentials-repository","userId":"08e6ba76-3e09-4737-942a-ed704e230750","msg":"User credentials created"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":50,"time":1767820255513,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820255549,"env":"test","module":"email-queue","jobId":"86d7d8c2-21eb-40ff-ba11-afb524aa7849","to":"protected-test-R56ioaVBJdK7QkB7zc1Fi@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820255574,"env":"test","module":"email-queue","jobId":"567e6974-dd79-49d6-b5a1-2609822baa2c","to":"session-test-51L-NsO7EncolOJZb80H0@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820255602,"env":"test","module":"auth-routes","userId":"49f24d79-921b-40a7-a706-931a73377545","email":"protected-test-R56ioaVBJdK7QkB7zc1Fi@example.com","msg":"User registered"}
{"level":30,"time":1767820255625,"env":"test","module":"auth-routes","userId":"08e6ba76-3e09-4737-942a-ed704e230750","email":"session-test-51L-NsO7EncolOJZb80H0@example.com","msg":"User registered"}
{"level":50,"time":1767820255638,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820255649,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

{"level":40,"time":1767820255758,"env":"test","module":"mfa-service","userId":"ad09b4a93a1ea05b411b35ce25efc3ef","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820255810,"env":"test","module":"mfa-service","userId":"ad09b4a93a1ea05b411b35ce25efc3ef","msg":"No unused backup codes available"}
{"level":40,"time":1767820255810,"env":"test","module":"auth-routes","userId":"ad09b4a93a1ea05b411b35ce25efc3ef","msg":"MFA verification failed during login"}
{"level":30,"time":1767820255839,"env":"test","module":"user-credentials-repository","userId":"wzRqb_iwsYEJZfACrvj8i","msg":"User credentials created"}
{"level":50,"time":1767820255923,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767820256002,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820256024,"env":"test","module":"user-credentials-repository","userId":"c7965fc9-df37-447c-b5b6-1e898008f713","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820256130,"env":"test","module":"email-queue","jobId":"94ad303b-6cf6-431d-8b15-47c0581528a0","to":"middleware-test-EKX7COPCEM83X-8OGf6K6@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820256184,"env":"test","module":"auth-routes","userId":"c7965fc9-df37-447c-b5b6-1e898008f713","email":"middleware-test-EKX7COPCEM83X-8OGf6K6@example.com","msg":"User registered"}
[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820256325,"env":"test","module":"user-credentials-repository","userId":"f3d1f10c-8f8b-436e-b525-9600990d1692","msg":"User credentials created"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820256411,"env":"test","module":"user-credentials-repository","userId":"322677c8-57bc-43d7-89c1-447ebae579c5","msg":"User credentials created"}
{"level":30,"time":1767820256431,"env":"test","module":"email-queue","jobId":"f39a9181-4a10-45a2-80a2-fac3819c226e","to":"protected-test-Twi5teOj95WpG3h25ChEE@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820256470,"env":"test","module":"user-credentials-repository","userId":"sf8CgjTadQw8jkpe1ILh1","msg":"User credentials created"}
{"level":30,"time":1767820256490,"env":"test","module":"auth-routes","userId":"f3d1f10c-8f8b-436e-b525-9600990d1692","email":"protected-test-Twi5teOj95WpG3h25ChEE@example.com","msg":"User registered"}
{"level":50,"time":1767820256498,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820256498,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820256516,"env":"test","module":"email-queue","jobId":"902cd7bd-5306-4a9f-b0cc-6c6d2e94c529","to":"session-test-5gqkD4-aZYwkFk6Z3FE2p@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767820256573,"env":"test","module":"auth-routes","userId":"322677c8-57bc-43d7-89c1-447ebae579c5","email":"session-test-5gqkD4-aZYwkFk6Z3FE2p@example.com","msg":"User registered"}
{"level":40,"time":1767820256609,"env":"test","module":"mfa-service","userId":"a4cdb293426e65c8881f15934c152d38","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820256609,"env":"test","module":"auth-routes","userId":"a4cdb293426e65c8881f15934c152d38","msg":"MFA verification failed during login"}
{"level":50,"time":1767820256615,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/integration/auth/oauth2.token-refresh.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820256821,"env":"test","module":"auth-routes","userId":"9e04f453a171ee4e672b5fbdd9aa5bba","msg":"User logged in successfully"}
{"level":50,"time":1767820256878,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820256877,"env":"test","module":"audit-log-service","userId":"9e04f453a171ee4e672b5fbdd9aa5bba","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/intakeNavigation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820256888,"env":"test","module":"user-credentials-repository","userId":"1a6b6af8-7c39-44f7-8a21-c723b369e34e","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.token-refresh.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 20214[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should refresh access token with valid refresh token[39m[33m 497[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should rotate refresh token after use[39m[33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when refresh token is missing [33m 394[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid refresh token [33m 433[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for expired refresh token [33m 503[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for revoked refresh token [33m 513[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when user is not found[39m[33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update refresh token metadata on rotation [33m 643[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle concurrent refresh token requests (token reuse detection) [33m 590[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set secure cookie in production [33m 584[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set proper cookie attributes[39m[33m 458[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should include user role information in response[39m[33m 434[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create refresh token on login [33m 1037[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke refresh token on logout[39m[33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle logout without refresh token gracefully [33m 390[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support multiple active refresh tokens per user [33m 536[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all user tokens on password reset [33m 597[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use cryptographically strong random tokens [33m 5730[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should hash refresh tokens before storing in database [33m 543[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent refresh token reuse after rotation [33m 663[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate token ownership[39m[33m 487[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set HttpOnly flag to prevent XSS [33m 634[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set SameSite=Strict to prevent CSRF [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set proper cookie path [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set appropriate expiry (30 days) [33m 616[2mms[22m[39m
 [31mÎ“Â¥Â»[39m tests/unit/services/intakeNavigation.test.ts [2m([22m[2m17 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 1511[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return all pages in order when no conditions[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle empty workflow[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should calculate correct current page index[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should hide pages when visibleIf is false[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should show pages when visibleIf is true[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle complex visibleIf conditions[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip pages when skipIf is true[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not skip pages when skipIf is false[39m[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply visibleIf before skipIf[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get first page[39m[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return null for first page if all pages hidden[39m[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate page navigability[39m[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should get page sequence[39m[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should default to visible on visibleIf evaluation error[39m[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should default to not skipping on skipIf evaluation error[39m[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should calculate correct progress for multi-page workflow[39m[32m 0[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should adjust progress when pages are skipped[39m[32m 1[2mms[22m[39m
{"level":30,"time":1767820256995,"env":"test","module":"email-queue","jobId":"112b191b-37b5-4d58-ae19-510cd1a1a7be","to":"middleware-test-HP932r-TcAjdkJX6iEGDq@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820257045,"env":"test","module":"auth-routes","userId":"f3d1f10c-8f8b-436e-b525-9600990d1692","msg":"User logged in successfully"}
{"level":30,"time":1767820257047,"env":"test","module":"auth-routes","userId":"1a6b6af8-7c39-44f7-8a21-c723b369e34e","email":"middleware-test-HP932r-TcAjdkJX6iEGDq@example.com","msg":"User registered"}
{"level":30,"time":1767820257076,"env":"test","module":"auth-routes","userId":"8cd5b994c223074194fcb07d4abe52cb","msg":"User logged in successfully"}
{"level":30,"time":1767820257101,"env":"test","module":"audit-log-service","userId":"f3d1f10c-8f8b-436e-b525-9600990d1692","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820257107,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820257129,"env":"test","module":"audit-log-service","userId":"8cd5b994c223074194fcb07d4abe52cb","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820257143,"env":"test","module":"auth-routes","userId":"db9889a2d35ba4181824e374d2619626","msg":"User logged in successfully"}
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table name and description
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table slug
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render column and row counts
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onClick when card is clicked
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onDelete when delete button is clicked
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should show placeholder when description is missing
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:38:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TableCard.test.tsx > TableCard Component > should format dates correctly
The above error occurred in the <TableCard> component:

    at TableCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableCard.tsx:10:22)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

[90mstdout[2m | tests/ui/datavault/TableCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820257192,"env":"test","module":"auth-routes","userId":"322677c8-57bc-43d7-89c1-447ebae579c5","msg":"User logged in successfully"}
{"level":30,"time":1767820257193,"env":"test","module":"audit-log-service","userId":"db9889a2d35ba4181824e374d2619626","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [31mÎ“Â¥Â»[39m tests/ui/datavault/TableCard.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 1497[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render table name and description[39m[32m 26[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render table slug[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render column and row counts[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should call onClick when card is clicked[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should call onDelete when delete button is clicked[39m[32m 3[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should show placeholder when description is missing[39m[32m 4[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should format dates correctly[39m[32m 3[2mms[22m[39m
{"level":30,"time":1767820257246,"env":"test","module":"audit-log-service","userId":"322677c8-57bc-43d7-89c1-447ebae579c5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820257373,"env":"test","module":"auth-routes","userId":"9e04f453a171ee4e672b5fbdd9aa5bba","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/common/Breadcrumbs.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820257408,"env":"test","module":"auth-routes","userId":"322677c8-57bc-43d7-89c1-447ebae579c5","deviceFingerprint":"377ad01217b8c93ca52518d515505c47ab7553fab66d6fddaa60af67802c5a4c","msg":"Device marked as trusted"}
{"level":30,"time":1767820257427,"env":"test","module":"audit-log-service","userId":"9e04f453a171ee4e672b5fbdd9aa5bba","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [31mÎ“Â¥Â»[39m tests/ui/common/Breadcrumbs.test.tsx [2m([22m[2m10 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1641[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render all breadcrumb items[32m 61[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render without home when showHome is false[32m 9[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render icons for items that have them[32m 10[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render links for non-last items with href[32m 9[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render last item without link[32m 26[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should apply custom className[32m 21[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should render chevron separators between items[32m 11[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should handle single item[32m 6[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should handle empty items array with home[32m 8[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should apply font-medium to last item[39m[32m 14[2mms[22m[39m
{"level":40,"time":1767820257492,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/unit/isolatedVmBridge.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1767820257497,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767820257499,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767820257510,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":40,"time":1767820257512,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1767820257540,"env":"test","module":"user-credentials-repository","userId":"a1ee81f1-6727-40d2-9eff-119d14077d07","msg":"User credentials created"}
{"level":30,"time":1767820257569,"env":"test","module":"auth-routes","userId":"322677c8-57bc-43d7-89c1-447ebae579c5","msg":"All other sessions revoked"}
 [31mÎ“Â¥Â»[39m tests/unit/isolatedVmBridge.test.ts [2m([22m[2m5 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 2123[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should execute JS and use simple helpers (string)[32m 10[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should execute JS and use complex helpers (math.sum)[32m 2[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should execute JS and capture console logs[39m[32m 11[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should access context data[32m 3[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should fail on missing helper[32m 6[2mms[22m[39m
{"level":30,"time":1767820257597,"env":"test","module":"auth-routes","userId":"9e04f453a171ee4e672b5fbdd9aa5bba","msg":"All other sessions revoked"}
{"level":30,"time":1767820257626,"env":"test","module":"audit-log-service","userId":"322677c8-57bc-43d7-89c1-447ebae579c5","eventType":"all_sessions_revoked","ipAddress":"::1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767820257631,"env":"test","module":"auth-routes","userId":"1a6b6af8-7c39-44f7-8a21-c723b369e34e","msg":"User logged in successfully"}
{"level":30,"time":1767820257648,"env":"test","module":"email-queue","jobId":"9abf251d-e1ae-4cd4-b941-4250b493d789","to":"protected-test-8dCsxLKsy8f8bexZ5uYkn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820257653,"env":"test","module":"audit-log-service","userId":"9e04f453a171ee4e672b5fbdd9aa5bba","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767820257683,"env":"test","module":"audit-log-service","userId":"1a6b6af8-7c39-44f7-8a21-c723b369e34e","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820257704,"env":"test","module":"auth-routes","userId":"a1ee81f1-6727-40d2-9eff-119d14077d07","email":"protected-test-8dCsxLKsy8f8bexZ5uYkn@example.com","msg":"User registered"}
{"level":30,"time":1767820257736,"env":"test","module":"auth-routes","userId":"322677c8-57bc-43d7-89c1-447ebae579c5","deviceCount":0,"msg":"Listed trusted devices"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":40,"time":1767820257824,"env":"test","module":"auth-service","tokenHash":"da5b0aa96e0c132f2fbaf224c342a827e59a1d60329ae397c0f3eac7a2375d8c","msg":"Security: Unknown refresh token used"}
[90mstdout[2m | tests/integration/ai/workflowEdit.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/ai/workflowEdit.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 1237[2mms[22m[39m
     [2m[90mÎ“Ã¥Ã´[39m[22m should create draft version on successful AI edit
     [2m[90mÎ“Ã¥Ã´[39m[22m should enforce draft mode (revert active workflow to draft)
     [2m[90mÎ“Ã¥Ã´[39m[22m should not create version when no changes detected (checksum match)
     [2m[90mÎ“Ã¥Ã´[39m[22m should reject unauthorized access
     [2m[90mÎ“Ã¥Ã´[39m[22m should reject unsafe DataVault operations
     [2m[90mÎ“Ã¥Ã´[39m[22m should handle multi-operation edits with tempId resolution
     [2m[90mÎ“Ã¥Ã´[39m[22m should create BEFORE and AFTER snapshots
     [2m[90mÎ“Ã¥Ã´[39m[22m should rollback on validation failure
{"level":50,"time":1767820258046,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767820258190,"env":"test","module":"user-credentials-repository","userId":"af4ad2dd-2e47-4f63-b908-85fb9debd304","msg":"User credentials created"}
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render template name and description
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should show "Coming Soon" badge
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render preview columns
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1767820258295,"env":"test","module":"email-queue","jobId":"0f12f049-8a28-421b-8f8e-075fabca375b","to":"session-test-Yh_hib9djkRZ-gJjoQI7K@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should limit preview columns to 5 and show count for remaining
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":30,"time":1767820258347,"env":"test","module":"auth-routes","userId":"af4ad2dd-2e47-4f63-b908-85fb9debd304","email":"session-test-Yh_hib9djkRZ-gJjoQI7K@example.com","msg":"User registered"}
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should handle empty preview columns
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
ReferenceError: React is not defined
    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:19:3)
    at renderWithHooks (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:15486:18)
    at mountIndeterminateComponent (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:20103:13)
    at beginWork (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:21626:16)
    at HTMLUnknownElement.callCallback (C:\Users\scoot\poll\VaultLogic\node_modules\react-dom\cjs\react-dom.development.js:4164:14)
    at HTMLUnknownElement.callTheUserObjectsOperation (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\generated\EventListener.js:26:30)
    at innerInvokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:360:16)
    at invokeEventListeners (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:296:3)
    at HTMLUnknownElementImpl._dispatch (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:243:9)
    at HTMLUnknownElementImpl.dispatchEvent (C:\Users\scoot\poll\VaultLogic\node_modules\jsdom\lib\jsdom\living\events\EventTarget-impl.js:114:17)
stderr | tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should have cursor-not-allowed style
The above error occurred in the <TemplateCard> component:

    at TemplateCard (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TemplateCard.tsx:10:25)

Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.

{"level":50,"time":1767820258354,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/ui/datavault/TemplateCard.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820258367,"env":"test","module":"user-credentials-repository","userId":"98873107-083d-4baa-b1e0-1ea69a75b6a6","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/ui/datavault/TemplateCard.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 1603[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render template name and description[39m[32m 40[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should show "Coming Soon" badge[39m[32m 9[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should render preview columns[39m[32m 57[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should limit preview columns to 5 and show count for remaining[39m[32m 34[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should handle empty preview columns[39m[32m 5[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should have cursor-not-allowed style[39m[32m 5[2mms[22m[39m
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767820258464,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":40,"time":1767820258470,"env":"test","module":"mfa-service","userId":"810b81206cc74fbe8a5475fe287f9afb","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820258471,"env":"test","module":"auth-routes","userId":"810b81206cc74fbe8a5475fe287f9afb","msg":"MFA verification failed during login"}
{"level":50,"time":1767820258477,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820258483,"env":"test","module":"email-queue","jobId":"db96370f-7ac8-458b-b248-5c2d4a0e5b32","to":"middleware-test-f6OObe_N07_15AKC5_MFA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820258490,"env":"test","module":"user-credentials-repository","userId":"d530ec6e-ac21-43e3-b9fe-341f0199c736","msg":"User credentials created"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820258534,"env":"test","module":"auth-routes","userId":"98873107-083d-4baa-b1e0-1ea69a75b6a6","email":"middleware-test-f6OObe_N07_15AKC5_MFA@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":30,"time":1767820258604,"env":"test","module":"email-queue","jobId":"c349ff79-65a0-469e-bd59-5df58282fc94","to":"protected-test-bDqPvq-J-OqvNIMYjo6Dp@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820258658,"env":"test","module":"auth-routes","userId":"d530ec6e-ac21-43e3-b9fe-341f0199c736","email":"protected-test-bDqPvq-J-OqvNIMYjo6Dp@example.com","msg":"User registered"}
{"level":50,"time":1767820258758,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":50,"time":1767820258774,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820258937,"env":"test","module":"user-credentials-repository","userId":"10f0e585-b7ff-446e-bb99-7f8f55dc5daa","msg":"User credentials created"}
{"level":30,"time":1767820258938,"env":"test","module":"mfa-service","userId":"014084504fc81fc315639f793fba76bb","msg":"TOTP verification successful"}
{"level":30,"time":1767820258992,"env":"test","module":"auth-routes","userId":"014084504fc81fc315639f793fba76bb","msg":"MFA login successful"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767820259052,"env":"test","module":"email-queue","jobId":"e1b3dc3e-a51d-427b-8fdf-dc7a4ad632b5","to":"session-test-0Je7_mnfhfCfQvAkEkQ0D@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820259067,"env":"test","module":"auth-routes","userId":"268e52c875d1b299a7265368d1f255e5","msg":"User logged in successfully"}
{"level":30,"time":1767820259107,"env":"test","module":"auth-routes","userId":"10f0e585-b7ff-446e-bb99-7f8f55dc5daa","email":"session-test-0Je7_mnfhfCfQvAkEkQ0D@example.com","msg":"User registered"}
{"level":30,"time":1767820259123,"env":"test","module":"audit-log-service","userId":"268e52c875d1b299a7265368d1f255e5","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820259173,"env":"test","module":"auth-routes","userId":"98873107-083d-4baa-b1e0-1ea69a75b6a6","msg":"User logged in successfully"}
{"level":30,"time":1767820259227,"env":"test","module":"audit-log-service","userId":"98873107-083d-4baa-b1e0-1ea69a75b6a6","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820259232,"env":"test","module":"auth-routes","userId":"dc2bc95e73bf0c7dde8f1c3e0423ac92","msg":"User logged in successfully"}
{"level":30,"time":1767820259265,"env":"test","module":"auth-routes","userId":"d530ec6e-ac21-43e3-b9fe-341f0199c736","msg":"User logged in successfully"}
{"level":30,"time":1767820259284,"env":"test","module":"audit-log-service","userId":"dc2bc95e73bf0c7dde8f1c3e0423ac92","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820259321,"env":"test","module":"audit-log-service","userId":"d530ec6e-ac21-43e3-b9fe-341f0199c736","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820259327,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":50,"time":1767820259478,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820259683,"env":"test","module":"user-credentials-repository","userId":"91dc7fc0-90d5-4431-87bc-515087f7a341","msg":"User credentials created"}
[90mstdout[2m | tests/integration/workflow_versioning.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820259794,"env":"test","module":"user-credentials-repository","userId":"622a4fa3-30bc-490b-8feb-b5baed073e16","msg":"User credentials created"}
{"level":30,"time":1767820259790,"env":"test","module":"email-queue","jobId":"5398612f-f188-485b-9214-95b0e00e79f4","to":"user2-E4SmK1InuGli9kpLXQ6ct@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31mÎ“Â¥Â»[39m tests/integration/workflow_versioning.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1329[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should diff two versions correctly[32m 3[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should create a version and populate changelog[39m[32m 11[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should track execution lineage via snapshot[39m[32m 50[2mms[22m[39m
{"level":30,"time":1767820259847,"env":"test","module":"auth-routes","userId":"91dc7fc0-90d5-4431-87bc-515087f7a341","email":"user2-E4SmK1InuGli9kpLXQ6ct@example.com","msg":"User registered"}
{"level":30,"time":1767820259905,"env":"test","module":"email-queue","jobId":"416538a4-6438-4bfa-9323-eebd575d6922","to":"protected-test-MMpbhLtJsrTiFapWklhGb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820259937,"env":"test","module":"user-credentials-repository","userId":"83116bdd-3719-47ad-94e1-49a0c384f63f","msg":"User credentials created"}
{"level":30,"time":1767820259957,"env":"test","module":"auth-routes","userId":"622a4fa3-30bc-490b-8feb-b5baed073e16","email":"protected-test-MMpbhLtJsrTiFapWklhGb@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820260044,"env":"test","module":"email-queue","jobId":"a4729018-8b5a-47a0-904a-644df7578ac4","to":"session-test-dw3kocgTIzvH5l1OWiLco@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820260097,"env":"test","module":"auth-routes","userId":"83116bdd-3719-47ad-94e1-49a0c384f63f","email":"session-test-dw3kocgTIzvH5l1OWiLco@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":50,"time":1767820260183,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820260218,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":40,"time":1767820260338,"env":"test","module":"mfa-service","userId":"ee64087a79a7f6c7e6b9d8e22fb43081","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820260338,"env":"test","module":"auth-routes","userId":"ee64087a79a7f6c7e6b9d8e22fb43081","msg":"MFA verification failed during login"}
{"level":50,"time":1767820260343,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/schema/collections.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/schema/collections.test.ts [2m([22m[2m34 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1028[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have correct table name[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have required columns[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have correct table name[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have required columns[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have correct table name[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have required columns[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have all expected field types[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should validate valid collection data[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should require tenantId, name, and slug[32m 1[2mms[22m[39m
[31m         [31mâ”œÃ¹[31m should omit id, createdAt, and updatedAt[39m[32m 13[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow description to be null[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should validate valid field data[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should require collectionId, name, slug, and type[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should validate field type enum[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should reject invalid field type[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow options for select types[32m 2[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow defaultValue[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should validate valid record data[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should require tenantId, collectionId, and data[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow empty data object[32m 1[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow createdBy and updatedBy to be null[32m 0[2mms[22m[39m
         [32mÎ“Â£Ã´[39m should allow complex nested data structures[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce unique slug per tenant for collections[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should enforce unique slug per collection for fields[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should cascade delete fields when collection is deleted[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should cascade delete records when collection is deleted[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should cascade delete records when tenant is deleted[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should set null on createdBy/updatedBy when user is deleted[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should support JSONB for field options[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should support JSONB for field default values[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should support JSONB for record data with fieldSlug Î“Ã¥Ã† value mapping[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should correctly infer Collection type[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should correctly infer CollectionField type[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should correctly infer CollectionRecord type[32m 0[2mms[22m[39m
[90mstdout[2m | tests/integration/trusted.devices.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820260463,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820260488,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
 [31mÎ“Â¥Â»[39m tests/integration/trusted.devices.real.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m13 failed[39m[2m)[22m[33m 23807[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should trust current device[39m[33m 1743[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should set trust expiry to 30 days[39m[33m 1522[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update expiry if device already trusted[39m[33m 1578[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 421[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all trusted devices[39m[33m 2338[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current device[39m[33m 1528[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude revoked devices[39m[33m 1578[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude expired devices[39m[33m 1597[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific device[39m[33m 1499[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent device[39m[33m 1530[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking other user's device[39m[33m 2299[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should skip MFA for trusted device[39m[33m 1845[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require MFA for untrusted device[39m[33m 1881[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update lastUsedAt on trusted device login[39m[33m 1642[2mms[22m[39m
{"level":30,"time":1767820260536,"env":"test","module":"auth-routes","userId":"622a4fa3-30bc-490b-8feb-b5baed073e16","msg":"User logged in successfully"}
{"level":30,"time":1767820260592,"env":"test","module":"audit-log-service","userId":"622a4fa3-30bc-490b-8feb-b5baed073e16","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820260597,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820260600,"env":"test","module":"user-credentials-repository","userId":"81809de3-6327-42e6-b90e-f55192450b7f","msg":"User credentials created"}
{"level":50,"time":1767820260618,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820260624,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820260629,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820260707,"env":"test","module":"email-queue","jobId":"63197e43-0f95-4b20-982f-4e831e4a9abc","to":"middleware-test-xqcrf3TdgNPzGxfkh69vb@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":40,"time":1767820260727,"env":"test","module":"mfa-service","userId":"7df18f65ee7e20fdef263ab92c6a187d","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820260727,"env":"test","module":"auth-routes","userId":"7df18f65ee7e20fdef263ab92c6a187d","msg":"MFA verification failed during login"}
{"level":50,"time":1767820260732,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820260760,"env":"test","module":"auth-routes","userId":"81809de3-6327-42e6-b90e-f55192450b7f","email":"middleware-test-xqcrf3TdgNPzGxfkh69vb@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/workflows/runtime-pipelines.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820260831,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820260871,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

 [31mÎ“Â¥Â»[39m tests/integration/workflows/runtime-pipelines.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 1245[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should create DataVault row on workflow completion
       [2m[90mÎ“Ã¥Ã´[39m[22m should execute writebacks via RunService.completeRun()
       [2m[90mÎ“Ã¥Ã´[39m[22m should skip document generation when visibleIf condition is false
       [2m[90mÎ“Ã¥Ã´[39m[22m should generate document when visibleIf condition is true
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767820261009,"env":"test","module":"user-credentials-repository","userId":"28caf21c-14d2-4256-a474-319691c75339","msg":"User credentials created"}
{"level":30,"time":1767820261041,"env":"test","module":"user-credentials-repository","userId":"997f1180-7851-4cd2-adea-7d128016b538","msg":"User credentials created"}
{"level":50,"time":1767820261076,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820261115,"env":"test","module":"email-queue","jobId":"84b04f8e-72bf-41c5-8e83-dc540f1e8807","to":"protected-test-NltD-AIWsziApwr7vQgx-@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820261146,"env":"test","module":"email-queue","jobId":"77d7844f-4ad6-4a21-a6cf-db8e33620491","to":"session-test-OBscEn9veD7gBcheLYnih@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/analytics_service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820261167,"env":"test","module":"auth-routes","userId":"28caf21c-14d2-4256-a474-319691c75339","email":"protected-test-NltD-AIWsziApwr7vQgx-@example.com","msg":"User registered"}
{"level":30,"time":1767820261199,"env":"test","module":"auth-routes","userId":"997f1180-7851-4cd2-adea-7d128016b538","email":"session-test-OBscEn9veD7gBcheLYnih@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

 [31mÎ“Â¥Â»[39m tests/integration/analytics_service.test.ts [2m([22m[2m1 test[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1143[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should generate events and metrics on run completion[39m[32m 65[2mms[22m[39m
[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":50,"time":1767820261491,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820261516,"env":"test","module":"user-credentials-repository","userId":"67259797-b680-4f23-94f6-4843e9ded3d0","msg":"User credentials created"}
{"level":50,"time":1767820261575,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820261620,"env":"test","module":"email-queue","jobId":"879c973e-57fc-4dfc-b5b8-3f9cab008713","to":"middleware-test-2m910A3Lr-qYtBY5cZpDn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth/session.management.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820261672,"env":"test","module":"auth-routes","userId":"67259797-b680-4f23-94f6-4843e9ded3d0","email":"middleware-test-2m910A3Lr-qYtBY5cZpDn@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820261707,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820261843,"env":"test","module":"auth-routes","userId":"dc489cc228dac1b6a5a1b270e317992c","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767820261896,"env":"test","module":"audit-log-service","userId":"dc489cc228dac1b6a5a1b270e317992c","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820261912,"env":"test","module":"user-credentials-repository","userId":"0d876ebf-1e57-4ada-b476-22043210bec1","msg":"User credentials created"}
{"level":30,"time":1767820262012,"env":"test","module":"auth-routes","userId":"c1a108b774cce1da6bc6ee1a987ce39d","msg":"User logged in successfully"}
{"level":30,"time":1767820262025,"env":"test","module":"email-queue","jobId":"708916b0-f1ad-46c6-bd8f-dc8288f5606e","to":"protected-test-a6T_3FJbcCf84umNZ9kFK@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [31mÎ“Â¥Â»[39m tests/integration/auth/session.management.integration.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m15 failed[39m[2m)[22m[33m 20166[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create refresh token on login[39m[33m 936[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should track device metadata in session[39m[33m 1310[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create separate sessions for multiple device logins[39m[33m 936[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions for user[39m[33m 922[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current session correctly[39m[33m 953[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not include revoked sessions[39m[33m 911[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should order sessions by last used (most recent first)[39m[33m 930[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require authentication [33m 659[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 921[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 914[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow revoking other users sessions[39m[33m 1572[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 404 for non-existent session ID[39m[33m 931[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all sessions except current[39m[33m 1017[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke all trusted devices [33m 1736[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require active session [33m 727[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject refresh token after 30 days[39m[33m 1012[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle multiple concurrent logins[39m[33m 1156[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle concurrent token refreshes[39m[33m 941[2mms[22m[39m
{"level":30,"time":1767820262058,"env":"test","module":"auth-routes","userId":"dc489cc228dac1b6a5a1b270e317992c","msg":"All other sessions revoked"}
{"level":30,"time":1767820262062,"env":"test","module":"audit-log-service","userId":"c1a108b774cce1da6bc6ee1a987ce39d","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820262077,"env":"test","module":"auth-routes","userId":"0d876ebf-1e57-4ada-b476-22043210bec1","email":"protected-test-a6T_3FJbcCf84umNZ9kFK@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767820262113,"env":"test","module":"audit-log-service","userId":"dc489cc228dac1b6a5a1b270e317992c","eventType":"all_sessions_revoked","ipAddress":"::ffff:127.0.0.1","hasMetadata":false,"msg":"Security event logged"}
{"level":30,"time":1767820262226,"env":"test","module":"auth-routes","userId":"dc489cc228dac1b6a5a1b270e317992c","sessionCount":1,"msg":"Listed active sessions"}
{"level":30,"time":1767820262284,"env":"test","module":"auth-routes","userId":"67259797-b680-4f23-94f6-4843e9ded3d0","msg":"User logged in successfully"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767820262339,"env":"test","module":"audit-log-service","userId":"67259797-b680-4f23-94f6-4843e9ded3d0","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":40,"time":1767820262344,"env":"test","module":"auth-service","userId":"c1a108b774cce1da6bc6ee1a987ce39d","tokenHash":"84240f03fbad63f3696792647c45a2ab06b925bab1154a851b2c44fd52e53a7f","msg":"Security: REUSED REFRESH TOKEN DETECTED. Revoking all sessions."}
{"level":50,"time":1767820262345,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820262478,"env":"test","module":"auth-routes","userId":"f9daf03c2752d43707d15111c2e840dd","msg":"Login requires MFA verification"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820262524,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767820262561,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/api.ai.revise.test.ts[2m > [22m[2mAI Routes Integration[2m > [22m[2mPOST /api/ai/workflows/revise[2m > [22m[2mshould call AIService.reviseWorkflow with correct parameters
[22m[39mRevise Test Failed: {
  "success": false,
  "message": "Invalid request data",
  "error": "validation_error",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": [
        "currentWorkflow",
        "title"
      ],
      "message": "Required"
    }
  ]
}

{"level":30,"time":1767820262580,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767820262586,"env":"test","module":"ai-controller","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["workflowId"]},{"code":"invalid_type","expected":"object","received":"undefined","path":["currentWorkflow"],"message":"Required"},{"code":"invalid_type","expected":"string","received":"undefined","path":["userInstruction"],"message":"Required"}],"name":"ZodError"},"msg":"Failed to enqueue AI revision job"}
[90mstdout[2m | tests/unit/api.ai.revise.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1767820262589,"env":"test","module":"mfa-service","userId":"f9daf03c2752d43707d15111c2e840dd","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820262589,"env":"test","module":"auth-routes","userId":"f9daf03c2752d43707d15111c2e840dd","msg":"MFA verification failed during login"}
{"level":50,"time":1767820262596,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767820262654,"env":"test","module":"auth-routes","userId":"0d876ebf-1e57-4ada-b476-22043210bec1","msg":"User logged in successfully"}
 [31mÎ“Â¥Â»[39m tests/unit/api.ai.revise.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 896[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should call AIService.reviseWorkflow with correct parameters[39m[32m 61[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 400 for invalid request usage[32m 8[2mms[22m[39m
{"level":30,"time":1767820262709,"env":"test","module":"audit-log-service","userId":"0d876ebf-1e57-4ada-b476-22043210bec1","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820262716,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820262793,"env":"test","module":"user-credentials-repository","userId":"9d75358a-64ff-4eca-801e-c9768794fe6e","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ListTools.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820262902,"env":"test","module":"email-queue","jobId":"83e7f976-e67c-428f-a67f-6f044440982a","to":"middleware-test-XImSGR--19ah1Es77UTv2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820262958,"env":"test","module":"auth-routes","userId":"9d75358a-64ff-4eca-801e-c9768794fe6e","email":"middleware-test-XImSGR--19ah1Es77UTv2@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820263133,"env":"test","module":"user-credentials-repository","userId":"04f73969-a9b7-4f42-ba1e-de58469f52bc","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767820263241,"env":"test","module":"email-queue","jobId":"3b046d67-def2-43d8-9056-d3ee3c114ecd","to":"protected-test-FvVPWo3eIcNSj58R0yh5d@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820263279,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820263292,"env":"test","module":"auth-routes","userId":"04f73969-a9b7-4f42-ba1e-de58469f52bc","email":"protected-test-FvVPWo3eIcNSj58R0yh5d@example.com","msg":"User registered"}
{"level":30,"time":1767820263327,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767820263358,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI logic generation failed"}
stderr | tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/generate-logic > should return generated logic
Logic Test Failed: {
  "success": false,
  "message": "Invalid request data",
  "error": "validation_error",
  "details": [
    {
      "code": "invalid_type",
      "expected": "string",
      "received": "undefined",
      "path": [
        "currentWorkflow",
        "title"
      ],
      "message": "Required"
    }
  ]
}

{"level":30,"time":1767820263378,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767820263384,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI debug logic failed"}
{"level":30,"time":1767820263388,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":50,"time":1767820263395,"env":"test","module":"ai-controller","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["currentWorkflow","title"],"message":"Required"}],"name":"ZodError"},"msg":"AI visualize logic failed"}
[90mstdout[2m | tests/unit/api.ai.logic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/api.ai.logic.test.ts [2m([22m[2m3 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 881[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return generated logic[39m[32m 54[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return debug issues[39m[32m 11[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return graph data[39m[32m 12[2mms[22m[39m
{"level":30,"time":1767820263586,"env":"test","module":"auth-routes","userId":"89d42f42d3d147945286499946164350","msg":"User logged in successfully"}
{"level":50,"time":1767820263589,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"filtered_users","filters":{"combinator":"and","rules":[{"fieldPath":"city","op":"equals","valueSource":"const","value":"NYC"}]}},"msg":"List tools block failed"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":50,"time":1767820263619,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820263638,"env":"test","module":"audit-log-service","userId":"89d42f42d3d147945286499946164350","eventType":"login_success","ipAddress":"192.168.1.100","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/ListTools.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820263602,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"senior_users","filters":{"combinator":"and","rules":[{"fieldPath":"age","op":"greater_than","valueSource":"const","value":30}]}},"msg":"List tools block failed"}
{"level":50,"time":1767820263604,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"active_nyc","filters":{"combinator":"and","rules":[{"fieldPath":"city","op":"equals","valueSource":"const","value":"NYC"},{"fieldPath":"active","op":"equals","valueSource":"const","value":true}]}},"msg":"List tools block failed"}
{"level":50,"time":1767820263605,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"young_or_sf","filters":{"combinator":"or","rules":[{"fieldPath":"age","op":"less_than","valueSource":"const","value":28},{"fieldPath":"city","op":"equals","valueSource":"const","value":"SF"}]}},"msg":"List tools block failed"}
{"level":50,"time":1767820263608,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"age","direction":"asc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767820263609,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"name","direction":"desc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767820263611,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"sorted_users","sort":[{"fieldPath":"city","direction":"asc"},{"fieldPath":"age","direction":"desc"}]},"msg":"List tools block failed"}
{"level":50,"time":1767820263613,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"limited_users","limit":3},"msg":"List tools block failed"}
{"level":50,"time":1767820263614,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"offset_users","offset":2},"msg":"List tools block failed"}
{"level":50,"time":1767820263630,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"paged_users","offset":1,"limit":2},"msg":"List tools block failed"}
{"level":50,"time":1767820263632,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"name_age_only","select":["name","age"]},"msg":"List tools block failed"}
{"level":50,"time":1767820263633,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"unique_cities","dedupe":{"fieldPath":"city"}},"msg":"List tools block failed"}
{"level":50,"time":1767820263635,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"all_users","outputs":{"countVar":"user_count"}},"msg":"List tools block failed"}
{"level":50,"time":1767820263636,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"all_users","sort":[{"fieldPath":"age","direction":"asc"}],"outputs":{"firstVar":"youngest_user"}},"msg":"List tools block failed"}
{"level":50,"time":1767820263639,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"processed_users","filters":{"combinator":"and","rules":[{"fieldPath":"active","op":"equals","valueSource":"const","value":true}]},"sort":[{"fieldPath":"age","direction":"desc"}],"offset":0,"limit":2,"select":["name","age"],"outputs":{"countVar":"active_count","firstVar":"oldest_active"}},"msg":"List tools block failed"}
{"level":50,"time":1767820263640,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"users_list","outputListVar":"filtered_users","filters":{"combinator":"and","rules":[{"fieldPath":"age","op":"greater_than","valueSource":"const","value":30}]}},"msg":"List tools block failed"}
{"level":40,"time":1767820263641,"env":"test","sourceListVar":"nonexistent_list","inputKey":"nonexistent_list","msg":"Input list not found, treating as empty array"}
{"level":50,"time":1767820263642,"env":"test","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\server\\services\\BlockRunner.ts"]},"config":{"sourceListVar":"simple_array","outputListVar":"sorted_array","sort":[{"fieldPath":"score","direction":"desc"}]},"msg":"List tools block failed"}
[90mstdout[2m | tests/unit/services/StepService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/services/StepService.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 822[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should create a step with auto-incrementing order[39m[32m 19[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should create step with order 1 if section is empty[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate alias uniqueness before creating[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should allow creating step with null alias[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if section not found[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should verify workflow ownership[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should update step successfully[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate alias uniqueness when updating alias[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should allow updating step without changing alias[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if step not found[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if step does not belong to workflow[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should delete step successfully[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if step not found[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error if step does not belong to workflow[32m 1[2mms[22m[39m
 [31mÎ“Â¥Â»[39m tests/ListTools.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m17 failed[39m[2m)[22m[33m 866[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter rows by equals condition[39m[32m 15[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter with greater_than operator[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter with AND combinator[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter with OR combinator[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should sort by single key ascending[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should sort by single key descending[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should sort by multiple keys[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply limit[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply offset[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply offset and limit together[39m[32m 16[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should select specific columns[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should deduplicate by field[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should output count variable[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should output first row variable[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply all operations in sequence[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle empty input list[39m[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle missing source list[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle plain arrays[39m[32m 1[2mms[22m[39m
{"level":30,"time":1767820263719,"env":"test","module":"user-credentials-repository","userId":"14b0f495-c29d-4254-9168-e7d2f2b46148","msg":"User credentials created"}
{"level":30,"time":1767820263751,"env":"test","module":"auth-routes","userId":"89d42f42d3d147945286499946164350","sessionCount":1,"msg":"Listed active sessions"}
stderr | tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should generate execution trace with lineage
[DEBUG Question] Node q1 executed. Key: userName, Value: Alice. Context keys: 3

{"level":30,"time":1767820263824,"env":"test","module":"email-queue","jobId":"d8afadba-7a53-490e-800a-bdddce715491","to":"middleware-test-xEfWQRHtjCYWsXqtCF7yP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/debugging/Lineage.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820263864,"env":"test","module":"email-queue","jobId":"7f57cb43-382e-4bd5-ab6f-dff7334f7083","to":"test-1767820263241-kgipck@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820263864,"env":"test","module":"auth-service","email":"test-1767820263241-kgipck@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767820263889,"env":"test","module":"auth-routes","userId":"14b0f495-c29d-4254-9168-e7d2f2b46148","email":"middleware-test-xEfWQRHtjCYWsXqtCF7yP@example.com","msg":"User registered"}
 [31mÎ“Â¥Â»[39m tests/unit/debugging/Lineage.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 806[2mms[22m[39m
     [32mÎ“Â£Ã´[39m should generate execution trace with lineage[32m 16[2mms[22m[39m
[31m     [31mâ”œÃ¹[31m should track skipped blocks in trace[39m[32m 8[2mms[22m[39m
{"level":30,"time":1767820264049,"env":"test","module":"user-credentials-repository","userId":"1498cd3e-5a46-4cfe-a51a-2af943dfee9a","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

{"level":30,"time":1767820264155,"env":"test","module":"email-queue","jobId":"73e15a18-443c-4638-b84c-07c7ed9f40ac","to":"protected-test-Q9o8OoNq7GRYQ_c_A5MYm@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767820264210,"env":"test","module":"auth-routes","userId":"1498cd3e-5a46-4cfe-a51a-2af943dfee9a","email":"protected-test-Q9o8OoNq7GRYQ_c_A5MYm@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/auth/portal.authentication.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820264333,"env":"test","module":"auth-routes","userId":"87c2f378c885f056401f45029914af94","msg":"Login requires MFA verification"}
stderr | tests/unit/writes/WriteRunner.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Migrations failed (non-fatal if DB exists): TypeError: Cannot read properties of undefined (reading 'migrate')
    at Module.migrate (file:///C:/Users/scoot/poll/VaultLogic/node_modules/drizzle-orm/node-postgres/migrator.js:4:20)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:119:17
    at processTicksAndRejections (node:internal/process/task_queues:103:5)

{"level":30,"time":1767820264342,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[{"columnId":"col-first","value":"{{ firstName }}"},{"columnId":"col-last","value":"Doe"},{"columnId":"col-age","value":"{{ age }}"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767820264354,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"create","columnMappings":[]},"tableId":"table-users","preview":true,"msg":"Starting write execution"}
[90mstdout[2m | tests/unit/writes/WriteRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820264354,"env":"test","module":"write-runner","operation":"write_preview_simulated","values":{},"msg":"Simulating write in preview mode"}
{"level":30,"time":1767820264355,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"test@example.com","columnMappings":[{"columnId":"col-status","value":"Active"}]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":30,"time":1767820264358,"env":"test","module":"write-runner","operation":"write_start","mode":"update","config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"tableId":"table-users","preview":false,"msg":"Starting write execution"}
{"level":50,"time":1767820264358,"env":"test","module":"write-runner","error":{},"config":{"tableId":"table-users","dataSourceId":"ds-native","mode":"update","primaryKeyColumnId":"col-email","primaryKeyValue":"missing@example.com","columnMappings":[]},"msg":"Write execution failed"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [31mÎ“Â¥Â»[39m tests/unit/writes/WriteRunner.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 33[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should resolve values and call createRowWithValues[39m[32m 13[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should simulate write in preview mode[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should find row by PK and update[39m[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return failure result if row not found[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1767820264444,"env":"test","module":"mfa-service","userId":"87c2f378c885f056401f45029914af94","msg":"No enabled MFA secret found for user"}
{"level":40,"time":1767820264444,"env":"test","module":"auth-routes","userId":"87c2f378c885f056401f45029914af94","msg":"MFA verification failed during login"}
{"level":50,"time":1767820264449,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820264483,"env":"test","module":"auth-routes","userId":"14b0f495-c29d-4254-9168-e7d2f2b46148","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/WorkflowPatchService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":50,"time":1767820264537,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820264538,"env":"test","module":"audit-log-service","userId":"14b0f495-c29d-4254-9168-e7d2f2b46148","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
stderr | tests/unit/services/WorkflowPatchService.test.ts
[vitest] The vi.fn() mock did not use 'function' or 'class' in its implementation, see https://vitest.dev/api/vi#vi-spyon for examples.

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":50,"time":1767820264868,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820264873,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820264977,"env":"test","module":"user-credentials-repository","userId":"d3abe56b-9924-4351-9b8f-8967c9ff9747","msg":"User credentials created"}
{"level":50,"time":1767820264983,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820265090,"env":"test","module":"email-queue","jobId":"935ba403-73d5-482a-af22-6bc10ddd36c2","to":"protected-test-zL7RPpXYT7u2dM9LmjIox@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820265142,"env":"test","module":"auth-routes","userId":"d3abe56b-9924-4351-9b8f-8967c9ff9747","email":"protected-test-zL7RPpXYT7u2dM9LmjIox@example.com","msg":"User registered"}
{"level":30,"time":1767820265168,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767820265182,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820265188,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.projects.test.ts[2m > [22m[2mProjects API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820265177,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820265178,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820265182,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820265188,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820265188,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820265188,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820265188,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767820265229,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767820265250,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts[2m > [22m[2mRuns API - DOCX Generation Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820265239,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820265239,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820265244,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820265249,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820265249,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820265250,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820265250,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/api.projects.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820265424,"env":"test","module":"user-credentials-repository","userId":"209694df-ce4d-48b5-9967-fbca83ed59b8","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.runs.docx.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/api.runs.docx.test.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 992[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should execute workflow with template node and generate DOCX
       [2m[90mÎ“Ã¥Ã´[39m[22m should handle missing template data gracefully
       [2m[90mÎ“Ã¥Ã´[39m[22m should download DOCX output from successful run
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for PDF when not generated
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for non-existent run
       [2m[90mÎ“Ã¥Ã´[39m[22m should extract placeholders from uploaded template
{"level":50,"time":1767820265467,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767820265499,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
[90mstdout[2m | tests/unit/ai.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820265499,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"workflow_generation","promptTokens":1201,"responseTokens":6,"totalTokens":1207,"durationMs":0,"estimatedCostUSD":0.01219,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820265499,"env":"test","module":"ai-service","error":{},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1767820265504,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767820265504,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1212,"responseTokens":68,"totalTokens":1280,"durationMs":0,"estimatedCostUSD":0.004656,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820265504,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":0,"msg":"AI workflow generation failed"}
{"level":30,"time":1767820265510,"env":"test","module":"ai-service","event":"ai_request_started","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"maxTokens":8000,"msg":"AI request started"}
{"level":30,"time":1767820265510,"env":"test","module":"ai-service","event":"ai_request_success","provider":"anthropic","model":"claude-3-5-sonnet-20241022","taskType":"workflow_generation","promptTokens":1201,"responseTokens":33,"totalTokens":1234,"durationMs":0,"estimatedCostUSD":0.004098,"attempts":1,"msg":"AI request succeeded"}
{"level":50,"time":1767820265510,"env":"test","module":"ai-service","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["title"],"message":"Required"}],"name":"ZodError"},"duration":1,"msg":"AI workflow generation failed"}
{"level":30,"time":1767820265514,"env":"test","module":"ai-service","event":"ai_request_started","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"maxTokens":4000,"msg":"AI request started"}
{"level":30,"time":1767820265516,"env":"test","module":"ai-service","event":"ai_request_success","provider":"openai","model":"gpt-4-turbo-preview","taskType":"binding_suggestion","promptTokens":258,"responseTokens":44,"totalTokens":302,"durationMs":2,"estimatedCostUSD":0.0039,"attempts":1,"msg":"AI request succeeded"}
{"level":30,"time":1767820265516,"env":"test","module":"ai-service","duration":2,"suggestionsCount":1,"msg":"AI binding suggestion succeeded"}
{"level":30,"time":1767820265538,"env":"test","module":"email-queue","jobId":"bb5f96e6-bf8f-47f5-b58f-48a379bcf2d6","to":"middleware-test-NgMVILR0F42K-k99bg80n@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820265544,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820265550,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820265593,"env":"test","module":"auth-routes","userId":"209694df-ce4d-48b5-9967-fbca83ed59b8","email":"middleware-test-NgMVILR0F42K-k99bg80n@example.com","msg":"User registered"}
 [31mÎ“Â¥Â»[39m tests/unit/ai.service.test.ts [2m([22m[2m11 tests[22m[2m | [22m[31m7 failed[39m[2m)[22m[33m 31754[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with OpenAI configuration[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate a valid workflow from description[39m[32m 18[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate unique section IDs[39m[32m 23[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate unique step IDs[39m[32m 13[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate logic rules reference existing steps[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle rate limit errors[39m[33m 30020[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle JSON parsing errors[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with Anthropic configuration[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate a valid workflow from description[39m[32m 4[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should strip markdown code blocks from Anthropic responses[39m[32m 5[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should generate binding suggestions[32m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

 [31mÎ“Â¥Â»[39m tests/integration/api.projects.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 973[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should create a new project
       [2m[90mÎ“Ã¥Ã´[39m[22m should reject without authentication
       [2m[90mÎ“Ã¥Ã´[39m[22m should reject with invalid data
       [2m[90mÎ“Ã¥Ã´[39m[22m should list projects for tenant
       [2m[90mÎ“Ã¥Ã´[39m[22m should support pagination
       [2m[90mÎ“Ã¥Ã´[39m[22m should get project by ID
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for non-existent project
       [2m[90mÎ“Ã¥Ã´[39m[22m should update project
       [2m[90mÎ“Ã¥Ã´[39m[22m should soft-delete project
       [2m[90mÎ“Ã¥Ã´[39m[22m should not allow cross-tenant access
{"level":30,"time":1767820265744,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820265770,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820265754,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820265754,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820265763,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820265769,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820265769,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820265769,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820265769,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.ai.doc.test.ts[2m > [22m[2mAI Document Assistant API Integration Tests[2m > [22m[2mPOST /api/ai/doc/analyze[2m > [22m[2mshould analyze a DOCX file and return variables
[22m[39mFAIL_STATUS: 500
FAIL_BODY: {}

{"level":50,"time":1767820265911,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820265885,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.ai.doc.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820266023,"env":"test","module":"user-credentials-repository","userId":"a620db22-2ed6-4c8f-b2b5-faf28ae619c5","msg":"User credentials created"}
{"level":30,"time":1767820266129,"env":"test","module":"email-queue","jobId":"e6507550-0a40-478a-9aa1-8b7695144e6e","to":"protected-test-79DgeBQVN6I23sKjCcfAZ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820266187,"env":"test","module":"auth-routes","userId":"a620db22-2ed6-4c8f-b2b5-faf28ae619c5","email":"protected-test-79DgeBQVN6I23sKjCcfAZ@example.com","msg":"User registered"}
{"level":30,"time":1767820266259,"env":"test","module":"auth-routes","userId":"abfcebc05fbdc62a397f7b41ce2c1a53","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

{"level":30,"time":1767820266301,"env":"test","module":"email-queue","jobId":"4c515c02-fc0b-4311-9f39-db5bf0443867","to":"test-1767820265616-d325qx@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820266301,"env":"test","module":"auth-service","email":"test-1767820265616-d325qx@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767820266313,"env":"test","module":"audit-log-service","userId":"abfcebc05fbdc62a397f7b41ce2c1a53","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
 [31mÎ“Â¥Â»[39m tests/integration/api.ai.doc.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1038[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should analyze a DOCX file and return variables[39m[32m 97[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should fail if no file is provided[39m[32m 28[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should suggest mappings between template and workflow variables[32m 79[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return improvement suggestions[32m 8[2mms[22m[39m
{"level":30,"time":1767820266345,"env":"test","module":"user-credentials-repository","userId":"0dd0b87f-5b9c-4034-b3e4-e8e2a48da90c","msg":"User credentials created"}
{"level":30,"time":1767820266423,"env":"test","module":"auth-routes","userId":"abfcebc05fbdc62a397f7b41ce2c1a53","sessionCount":1,"msg":"Listed active sessions"}
[90mstdout[2m | tests/integration/session.management.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820266454,"env":"test","module":"email-queue","jobId":"1c51827b-b432-46f7-904e-67a4cd83f888","to":"middleware-test--AHC9yW6MJziOZZaqhKLY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820266507,"env":"test","module":"auth-routes","userId":"0dd0b87f-5b9c-4034-b3e4-e8e2a48da90c","email":"middleware-test--AHC9yW6MJziOZZaqhKLY@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

 [31mÎ“Â¥Â»[39m tests/integration/session.management.real.test.ts [2m([22m[2m18 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[33m 29793[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should list all active sessions for current user[39m[33m 1655[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should mark current session correctly[39m[33m 1310[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should exclude revoked sessions[39m[33m 1619[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should order sessions by last used (most recent first)[39m[33m 2116[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should filter sessions by current user only[39m[33m 1980[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for unauthenticated request [33m 401[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke specific session[39m[33m 1374[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking current session[39m[33m 1451[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 404 for non-existent session [33m 1356[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent revoking other user's session[39m[33m 1740[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all other sessions[39m[33m 2499[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should keep current session active[39m[33m 2312[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 if no active session found [33m 1521[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke all trusted devices[39m[33m 1142[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle user with single session gracefully [33m 1738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should include device metadata in sessions [33m 1525[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not expose sensitive token data[39m[33m 1122[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track session activity timestamps [33m 1550[2mms[22m[39m
{"level":30,"time":1767820266773,"env":"test","module":"user-credentials-repository","userId":"8480d464364f8a5484572a1771de7053","msg":"User password updated"}
{"level":30,"time":1767820266796,"env":"test","module":"auth-routes","userId":"a620db22-2ed6-4c8f-b2b5-faf28ae619c5","msg":"User logged in successfully"}
{"level":30,"time":1767820266848,"env":"test","module":"audit-log-service","userId":"a620db22-2ed6-4c8f-b2b5-faf28ae619c5","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820266943,"env":"test","module":"audit-log-service","userId":"8480d464364f8a5484572a1771de7053","eventType":"password_reset","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mcreateInvite[2m > [22m[2mshould create placeholder user for non-existent email
[22m[39m[isOrgMember] User d56babe0-d00f-47ab-8279-3d390d4efb54 is NOT member of a5e93e7e-1118-4a40-8e8c-d2e464a9d49a (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767820267100,"env":"test","module":"auth-routes","userId":"0dd0b87f-5b9c-4034-b3e4-e8e2a48da90c","msg":"User logged in successfully"}
{"level":30,"time":1767820267123,"env":"test","module":"auth-routes","userId":"e498736ecbc9029aadce2c45d2ebb2de","msg":"Login requires MFA verification"}
{"level":30,"time":1767820267129,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820267157,"env":"test","module":"audit-log-service","userId":"0dd0b87f-5b9c-4034-b3e4-e8e2a48da90c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/mfa.flow.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/mfa.flow.real.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m16 failed[39m[2m)[22m[33m 30561[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete full MFA setup flow[39m[33m 1255[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject invalid TOTP code during setup[39m[33m 1113[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow MFA setup if already enabled[39m[33m 1360[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should generate unique backup codes[39m[33m 1044[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should store hashed backup codes[39m[33m 1136[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require MFA for enabled users[39m[33m 1429[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should complete MFA login with valid TOTP[39m[33m 1421[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid TOTP during login [33m 1496[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should accept TOTP codes within 60-second window[39m[33m 1501[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should login with valid backup code[39m[33m 1927[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should mark backup code as used [33m 1246[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prevent backup code reuse[39m[33m 1205[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should try TOTP before backup code[39m[33m 1663[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return MFA status for user [33m 1494[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return backup codes count for MFA users[39m[33m 1848[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should disable MFA with password verification[39m[33m 1580[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should require correct password to disable MFA[39m[33m 1863[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should regenerate backup codes[39m[33m 1854[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return error if MFA not enabled[39m[33m 1102[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce MFA for tenant users when required by tenant [33m 1624[2mms[22m[39m
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820267467,"env":"test","module":"user-credentials-repository","userId":"17593e2c-2a53-4761-aef2-b6ee10995bb2","msg":"User credentials created"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767820267515,"env":"test","module":"auth-routes","userId":"8480d464364f8a5484572a1771de7053","msg":"User logged in successfully"}
{"level":50,"time":1767820267540,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820267574,"env":"test","module":"audit-log-service","userId":"8480d464364f8a5484572a1771de7053","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820267579,"env":"test","module":"email-queue","jobId":"746e450f-6fb7-4ada-8a63-b0ae766067b5","to":"protected-test-jLMV-yf9wT-wC1M5cST33@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820267632,"env":"test","module":"auth-routes","userId":"17593e2c-2a53-4761-aef2-b6ee10995bb2","email":"protected-test-jLMV-yf9wT-wC1M5cST33@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767820267986,"env":"test","module":"user-credentials-repository","userId":"0e78d717-db2f-47b5-a404-6b69c7c91773","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mcreateInvite[2m > [22m[2mshould create invite for existing user without creating placeholder
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of 17f18a41-0259-4439-9701-4fdebd6d33b2 (Access Denied)

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820268094,"env":"test","module":"email-queue","jobId":"4e6ede0e-7adc-4e31-a08c-b7bb5dffcc78","to":"middleware-test--xE0wstNKuHLyuI8VRjVI@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767820268114,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820268149,"env":"test","module":"auth-routes","userId":"0e78d717-db2f-47b5-a404-6b69c7c91773","email":"middleware-test--xE0wstNKuHLyuI8VRjVI@example.com","msg":"User registered"}
{"level":30,"time":1767820268211,"env":"test","module":"auth-routes","userId":"17593e2c-2a53-4761-aef2-b6ee10995bb2","msg":"User logged in successfully"}
{"level":30,"time":1767820268268,"env":"test","module":"audit-log-service","userId":"17593e2c-2a53-4761-aef2-b6ee10995bb2","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767820268592,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould transfer user-owned project to org
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of eddf19ed-6df9-41be-a7e1-f6adc5392fda (Access Denied)

{"level":30,"time":1767820268748,"env":"test","module":"user-credentials-repository","userId":"9960ba1d-f1e6-4cef-a776-a1b26c2ccabc","msg":"User credentials created"}
{"level":30,"time":1767820268803,"env":"test","module":"auth-routes","userId":"0e78d717-db2f-47b5-a404-6b69c7c91773","msg":"User logged in successfully"}
{"level":30,"time":1767820268857,"env":"test","module":"email-queue","jobId":"bc350039-8fb5-47e0-acab-438a6f8770bb","to":"user2-lIhcrjak-B-_xpYxKSAbs@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820268858,"env":"test","module":"audit-log-service","userId":"0e78d717-db2f-47b5-a404-6b69c7c91773","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767820268911,"env":"test","module":"auth-routes","userId":"9960ba1d-f1e6-4cef-a776-a1b26c2ccabc","email":"user2-lIhcrjak-B-_xpYxKSAbs@example.com","msg":"User registered"}
{"level":50,"time":1767820268916,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mcreateInvite[2m > [22m[2mshould prevent duplicate pending invites
[22m[39m[isOrgMember] User b8145ee4-76fc-47a6-aa4e-493ced2cf324 is NOT member of bbcee05c-5a7d-42ea-a3e9-b5d3901b4602 (Access Denied)

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767820269241,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820269365,"env":"test","module":"user-credentials-repository","userId":"1ae8bf2b-7136-4636-9975-a3f9e1527632","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould transfer user-owned project to org
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of eddf19ed-6df9-41be-a7e1-f6adc5392fda

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mcreateInvite[2m > [22m[2mshould prevent duplicate pending invites
[22m[39m[isOrgMember] User b8145ee4-76fc-47a6-aa4e-493ced2cf324 is NOT member of bbcee05c-5a7d-42ea-a3e9-b5d3901b4602 (Access Denied)

{"level":30,"time":1767820269475,"env":"test","module":"email-queue","jobId":"143bdc84-f9d5-4d3a-a4c5-110e0251ac49","to":"middleware-test-Hbuirbn2ELbqD9_ixNneV@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820269531,"env":"test","module":"auth-routes","userId":"1ae8bf2b-7136-4636-9975-a3f9e1527632","email":"middleware-test-Hbuirbn2ELbqD9_ixNneV@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820269670,"env":"test","module":"user-credentials-repository","userId":"d521fa80-b7da-44fa-9953-e5e1d1a74428","msg":"User credentials created"}
{"level":30,"time":1767820269736,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820269777,"env":"test","module":"email-queue","jobId":"e8a9162c-45fc-44d9-8682-6bb59fc51dbd","to":"protected-test-eJ_ytc6LF24ggfcD80ik2@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820269835,"env":"test","module":"auth-routes","userId":"d521fa80-b7da-44fa-9953-e5e1d1a74428","email":"protected-test-eJ_ytc6LF24ggfcD80ik2@example.com","msg":"User registered"}
{"level":50,"time":1767820269860,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mcreateInvite[2m > [22m[2mshould prevent inviting existing members
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of 7602ddfd-634d-412b-b32f-2edcd5f2e6a0 (Access Denied)

{"level":50,"time":1767820270154,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820270259,"env":"test","module":"user-credentials-repository","userId":"d4402f58-156f-4420-909d-a12f38f4cb36","msg":"User credentials created"}
[90mstdout[2m | tests/integration/js_helpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 14ff191d-d55b-4aa6-b389-5de9f21e92f3 (Access Denied)

{"level":30,"time":1767820270367,"env":"test","module":"email-queue","jobId":"d36ddeeb-f8c6-475a-8388-61af98d39188","to":"middleware-test-WzbJukTVbQDXgT7iIIHyy@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mcreateInvite[2m > [22m[2mshould prevent inviting existing members
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 IS member of 7602ddfd-634d-412b-b32f-2edcd5f2e6a0

{"level":30,"time":1767820270425,"env":"test","module":"auth-routes","userId":"d4402f58-156f-4420-909d-a12f38f4cb36","email":"middleware-test-WzbJukTVbQDXgT7iIIHyy@example.com","msg":"User registered"}
{"level":30,"time":1767820270499,"env":"test","module":"email-queue","jobId":"8249075a-0d52-4643-b1dc-24f4b16226b3","to":"test-1767820269890-oqg3m@example.com","subject":"Reset Your Password - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820270499,"env":"test","module":"auth-service","email":"test-1767820269890-oqg3m@example.com","msg":"Password reset email sent"}
{"level":30,"time":1767820270559,"env":"test","module":"user-credentials-repository","userId":"d29ada05-10f6-447d-81a1-3ae76dcea749","msg":"User credentials created"}
 [31mÎ“Â¥Â»[39m tests/integration/js_helpers.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 826[2mms[22m[39m
     [2m[90mÎ“Ã¥Ã´[39m[22m should execute a JS block that uses helper functions
{"level":30,"time":1767820270670,"env":"test","module":"email-queue","jobId":"fdc7e332-7c57-4d49-bffd-c0e61e4c7573","to":"protected-test-s0jp0_OmN4AJX5YZ2Rc_Z@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820270728,"env":"test","module":"auth-routes","userId":"d29ada05-10f6-447d-81a1-3ae76dcea749","email":"protected-test-s0jp0_OmN4AJX5YZ2Rc_Z@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.snapshots.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 35a47b0e-4a48-40b6-95bf-96800db3c23b (Access Denied)

[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820270999,"env":"test","module":"auth-routes","userId":"d4402f58-156f-4420-909d-a12f38f4cb36","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820271059,"env":"test","module":"audit-log-service","userId":"d4402f58-156f-4420-909d-a12f38f4cb36","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [31mÎ“Â¥Â»[39m tests/integration/api.snapshots.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 784[2mms[22m[39m
     [2m[90mÎ“Ã¥Ã´[39m[22m should maintain immutability of runs across versions
[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":30,"time":1767820271284,"env":"test","module":"auth-routes","userId":"d29ada05-10f6-447d-81a1-3ae76dcea749","msg":"User logged in successfully"}
{"level":30,"time":1767820271337,"env":"test","module":"audit-log-service","userId":"d29ada05-10f6-447d-81a1-3ae76dcea749","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of fb65cc68-8bc8-4f1f-8727-ab27cd352866 (Access Denied)

[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767820271618,"env":"test","module":"user-credentials-repository","userId":"0a23c714-30f1-4032-8347-720366ca57e7","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of fb65cc68-8bc8-4f1f-8727-ab27cd352866

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mcreateInvite[2m > [22m[2mshould set expiry to 7 days from now
[22m[39m[isOrgMember] User 93e0f5be-a9cd-4fb7-a2c5-433f77aca40b is NOT member of 344d0249-1bb6-42bf-91cb-9c1f7c731a2b (Access Denied)

{"level":30,"time":1767820271728,"env":"test","module":"email-queue","jobId":"635738bb-9d84-47bb-b9e8-15759cffc89f","to":"middleware-test-PJi0uVELlJW0Ua1GJ6bNS@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820271785,"env":"test","module":"auth-routes","userId":"0a23c714-30f1-4032-8347-720366ca57e7","email":"middleware-test-PJi0uVELlJW0Ua1GJ6bNS@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/api.runs.graph.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820271870,"env":"test","module":"user-credentials-repository","userId":"f8957705-9b21-4b16-8220-ed6a39d51afb","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820271976,"env":"test","module":"email-queue","jobId":"0dd41bac-7f7f-4302-944a-866be5893171","to":"protected-test-PgGKj7FEEfJpRqN6OWGhJ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

{"level":30,"time":1767820272027,"env":"test","module":"auth-routes","userId":"f8957705-9b21-4b16-8220-ed6a39d51afb","email":"protected-test-PgGKj7FEEfJpRqN6OWGhJ@example.com","msg":"User registered"}
 [31mÎ“Â¥Â»[39m tests/integration/api.runs.graph.test.ts [2m([22m[2m19 tests[22m[2m | [22m[33m19 skipped[39m[2m)[22m[33m 825[2mms[22m[39m
       [2m[90mÎ“Ã¥Ã´[39m[22m should list all runs with pagination
       [2m[90mÎ“Ã¥Ã´[39m[22m should filter runs by status
       [2m[90mÎ“Ã¥Ã´[39m[22m should filter runs by workflow
       [2m[90mÎ“Ã¥Ã´[39m[22m should filter runs by project
       [2m[90mÎ“Ã¥Ã´[39m[22m should filter runs by date range
       [2m[90mÎ“Ã¥Ã´[39m[22m should search runs by query string
       [2m[90mÎ“Ã¥Ã´[39m[22m should get run by ID with all details
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for non-existent run
       [2m[90mÎ“Ã¥Ã´[39m[22m should get logs for a run
       [2m[90mÎ“Ã¥Ã´[39m[22m should re-run workflow with same inputs
       [2m[90mÎ“Ã¥Ã´[39m[22m should re-run workflow with override inputs
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 for non-existent run
       [2m[90mÎ“Ã¥Ã´[39m[22m should export runs to CSV
       [2m[90mÎ“Ã¥Ã´[39m[22m should export runs with filters applied
       [2m[90mÎ“Ã¥Ã´[39m[22m should compare two runs
       [2m[90mÎ“Ã¥Ã´[39m[22m should identify changed input keys
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 if run A not found
       [2m[90mÎ“Ã¥Ã´[39m[22m should return 404 if run B not found
       [2m[90mÎ“Ã¥Ã´[39m[22m should enforce tenant isolation on runs list
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of b12d9064-17f6-4025-b23b-bd540855a436 (Access Denied)

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of fb65cc68-8bc8-4f1f-8727-ab27cd352866

[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of b12d9064-17f6-4025-b23b-bd540855a436

{"level":30,"time":1767820272334,"env":"test","module":"auth-routes","userId":"0a23c714-30f1-4032-8347-720366ca57e7","msg":"User logged in successfully"}
{"level":30,"time":1767820272360,"env":"test","module":"auth-routes","userId":"ee467e237e22ea7a164dc9ceb713ab95","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mProject Transfer[2m > [22m[2mshould allow org member to transfer org-owned project to another org they belong to
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of fb65cc68-8bc8-4f1f-8727-ab27cd352866

{"level":30,"time":1767820272387,"env":"test","module":"audit-log-service","userId":"0a23c714-30f1-4032-8347-720366ca57e7","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820272414,"env":"test","module":"audit-log-service","userId":"ee467e237e22ea7a164dc9ceb713ab95","eventType":"login_success","ipAddress":"::ffff:127.0.0.1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1767820272446,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820272579,"env":"test","module":"auth-routes","userId":"f8957705-9b21-4b16-8220-ed6a39d51afb","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820272634,"env":"test","module":"audit-log-service","userId":"f8957705-9b21-4b16-8220-ed6a39d51afb","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2macceptInvite[2m > [22m[2mshould accept invite and create membership
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of 15ccd4ed-89fb-48c0-a7a5-17b10680ec34 (Access Denied)

{"level":30,"time":1767820272720,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767820272737,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/api.workflows.test.ts[2m > [22m[2mWorkflows API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820272728,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820272728,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820272732,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820272736,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820272736,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820272737,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820272737,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":30,"time":1767820272822,"env":"test","module":"user-credentials-repository","userId":"943ecb1b-b3d0-4806-a49b-bdaf94153db5","msg":"User credentials created"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767820272927,"env":"test","module":"email-queue","jobId":"3d0d99e7-d29d-4a0f-8b5d-626d6f295243","to":"middleware-test-0B0GMu4pNhHnuJbc8aM0Q@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820272984,"env":"test","module":"auth-routes","userId":"943ecb1b-b3d0-4806-a49b-bdaf94153db5","email":"middleware-test-0B0GMu4pNhHnuJbc8aM0Q@example.com","msg":"User registered"}
{"level":30,"time":1767820273130,"env":"test","module":"user-credentials-repository","userId":"eb77006b-2ac1-4664-8205-6cdcc43e9b76","msg":"User credentials created"}
{"level":30,"time":1767820273214,"env":"test","module":"user-credentials-repository","userId":"37d28176-13b7-4d84-a033-cb3f5b4bb516","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould detach workflow from project when transferring to different owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 49e62fd8-98f2-4cc9-8d66-032daa035dba (Access Denied)

{"level":30,"time":1767820273238,"env":"test","module":"email-queue","jobId":"fea817f6-90c8-48b5-85a0-6a6fa77cb2de","to":"protected-test-nqv5eHiyWwVl30RR8GaMH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820273295,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820273296,"env":"test","module":"auth-routes","userId":"eb77006b-2ac1-4664-8205-6cdcc43e9b76","email":"protected-test-nqv5eHiyWwVl30RR8GaMH@example.com","msg":"User registered"}
{"level":30,"time":1767820273320,"env":"test","module":"email-queue","jobId":"dedb52fd-2cbb-4641-942e-10a958e89f8b","to":"test-T3YZ7XX45YcL5pNIoFJJj@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2macceptInvite[2m > [22m[2mshould accept invite and create membership
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000021 IS member of 15ccd4ed-89fb-48c0-a7a5-17b10680ec34

{"level":50,"time":1767820273378,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820273381,"env":"test","module":"auth-routes","userId":"37d28176-13b7-4d84-a033-cb3f5b4bb516","email":"test-T3YZ7XX45YcL5pNIoFJJj@example.com","msg":"User registered"}
{"level":30,"time":1767820273382,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
{"level":30,"time":1767820273403,"env":"test","msg":"Real-time collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820273391,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820273391,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820273396,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820273402,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820273402,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820273402,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820273402,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 2: Invite member via email
[22m[39m[isOrgMember] User 42c0cf77-3f5b-408f-b078-226f7617dc84 is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

{"level":50,"time":1767820273620,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820273677,"env":"test","module":"user-credentials-repository","userId":"2cf01de5-e404-45d0-ac94-275a9eb3ed4d","msg":"User credentials created"}
{"level":30,"time":1767820273787,"env":"test","module":"email-queue","jobId":"ca673102-63d1-4379-a6bc-aad9ddb7c1e9","to":"middleware-test-3OHCGPDJqbGo_DrnUsgAA@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820273804,"env":"test","module":"auth","email":"testuser@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests
[22m[39mLogin Status: [33m200[39m
Login Body: {
  "message": "Authentication successful",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJnb29nbGUtdXNlci1pZCIsImVtYWlsIjoidGVzdHVzZXJAZXhhbXBsZS5jb20iLCJ0ZW5hbnRJZCI6IjMwNTE5OWU0LTg0YjUtNDJiZS1hZWIzLWI3YTNmMDU0NzljZSIsInJvbGUiOiJhZG1pbiIsInRlbmFudFJvbGUiOiJvd25lciIsImlhdCI6MTc2NzgyMDI3MywiZXhwIjoxNzY3ODIxMTczfQ.2OsvO60ZswyKhTkWA8havfnCH_Pc9RMSXTIWLnMPljA",
  "user": {
    "id": "google-user-id",
    "email": "testuser@example.com",
    "firstName": null,
    "lastName": null,
    "profileImageUrl": null,
    "tenantId": "305199e4-84b5-42be-aeb3-b7a3f05479ce",
    "role": "admin",
    "tenantRole": "owner"
  }
}

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould detach workflow from project when transferring to different owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of 49e62fd8-98f2-4cc9-8d66-032daa035dba

{"level":30,"time":1767820273842,"env":"test","module":"auth-routes","userId":"2cf01de5-e404-45d0-ac94-275a9eb3ed4d","email":"middleware-test-3OHCGPDJqbGo_DrnUsgAA@example.com","msg":"User registered"}
{"level":30,"time":1767820274005,"env":"test","module":"user-credentials-repository","userId":"59207b40-5d5f-4e3e-89ec-e2f565676ce4","msg":"User credentials created"}
{"level":30,"time":1767820274025,"env":"test","module":"auth","email":"other@example.com","msg":"OAuth2 login successful"}
[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests[2m > [22m[2mshould generate basic autonumber without prefix
[22m[39mRow 1 Basic Autonumber: 0001
Row 2 Basic Autonumber: 0002

{"level":30,"time":1767820274115,"env":"test","module":"email-queue","jobId":"852bf3f9-dd66-4f6b-a057-d7c3f6a38f6e","to":"protected-test-uVO1seEtHpRbFnHW1oh5O@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820274167,"env":"test","module":"auth-routes","userId":"59207b40-5d5f-4e3e-89ec-e2f565676ce4","email":"protected-test-uVO1seEtHpRbFnHW1oh5O@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2macceptInvite[2m > [22m[2mshould convert placeholder user to real user on accept
[22m[39m[isOrgMember] User 675efcb9-9db5-43aa-8237-0d5fb0aab7c4 is NOT member of 6aa80ae9-2519-4610-ad8d-9d3b3c3687af (Access Denied)

{"level":50,"time":1767820274174,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":50,"time":1767820274227,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":30,"time":1767820274334,"env":"test","module":"user-credentials-repository","userId":"2300eabf-0ca5-47e9-9c8d-aa8cab965ea0","msg":"User credentials created"}
{"level":30,"time":1767820274452,"env":"test","module":"email-queue","jobId":"61538c59-63e0-42f5-84ba-3bc1050f5290","to":"viewer-cA-fI_2Xkt0zyK6aAP1NY@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":50,"time":1767820274453,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"Failed to render template"}
{"level":50,"time":1767820274482,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820274509,"env":"test","module":"auth-routes","userId":"2300eabf-0ca5-47e9-9c8d-aa8cab965ea0","email":"viewer-cA-fI_2Xkt0zyK6aAP1NY@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820274568,"env":"test","module":"user-credentials-repository","userId":"0bfe9c27-e602-4ffa-a4df-49355d8c68f7","msg":"User credentials created"}
[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould keep workflow in project when transferring to same owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 0fb465d1-e2a8-4057-b1a5-fcd6208eef9c (Access Denied)

{"level":40,"time":1767820274619,"env":"test","module":"rbac-middleware","userId":"2300eabf-0ca5-47e9-9c8d-aa8cab965ea0","userRole":"viewer","permission":"workflow:create","path":"/projects/c1d4e421-b7ba-4cbe-ad1e-66c25e31419c/workflows","msg":"Permission denied"}
{"level":30,"time":1767820274676,"env":"test","module":"email-queue","jobId":"954668d7-3366-417d-9a58-9fe49553083d","to":"middleware-test-P6ldAintYIZy_IdlQiTRP@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould keep workflow in project when transferring to same owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of 0fb465d1-e2a8-4057-b1a5-fcd6208eef9c

{"level":30,"time":1767820274734,"env":"test","module":"auth-routes","userId":"0bfe9c27-e602-4ffa-a4df-49355d8c68f7","email":"middleware-test-P6ldAintYIZy_IdlQiTRP@example.com","msg":"User registered"}
{"level":30,"time":1767820274860,"env":"test","module":"user-credentials-repository","userId":"f434ed6a-6709-4837-a764-31ec13c433f2","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mgetOrganizationMembers[2m > [22m[2mshould return all members of organization
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 is NOT member of 2caad731-4b2e-4bb2-aa07-ba21ee1d342b (Access Denied)

{"level":30,"time":1767820274964,"env":"test","module":"email-queue","jobId":"3ba97d02-6c85-4151-91f9-809e5fa3f470","to":"protected-test-lrWd9U0DYSBKUyZ01Sa6V@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 5: Transfer workflow to organization
[22m[39m[isOrgMember] User 39dbd48e-cad0-4ac0-bba1-1018c6ef4ad6 IS member of 1db2e39a-9a13-4fce-b301-48d312397741

{"level":30,"time":1767820275017,"env":"test","module":"auth-routes","userId":"f434ed6a-6709-4837-a764-31ec13c433f2","email":"protected-test-lrWd9U0DYSBKUyZ01Sa6V@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mgetOrganizationMembers[2m > [22m[2mshould return all members of organization
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000011 IS member of 2caad731-4b2e-4bb2-aa07-ba21ee1d342b

{"level":50,"time":1767820275058,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould keep workflow in project when transferring to same owner
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of 0fb465d1-e2a8-4057-b1a5-fcd6208eef9c

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 6: Org member (user2) can access workflow
[22m[39m[isOrgMember] User 42c0cf77-3f5b-408f-b078-226f7617dc84 IS member of 1db2e39a-9a13-4fce-b301-48d312397741

{"level":50,"time":1767820275341,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820275440,"env":"test","module":"user-credentials-repository","userId":"408dd5f8-2eff-4b28-a85b-667bfc1473df","msg":"User credentials created"}
{"level":30,"time":1767820275525,"env":"test","workflowId":"80df7b52-cee8-4786-881e-38122c07019e","userId":"42c0cf77-3f5b-408f-b078-226f7617dc84","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":30,"time":1767820275549,"env":"test","module":"email-queue","jobId":"5ba55178-17cd-4712-ad89-f13aa74a60b5","to":"middleware-test-STSId4b8pVB5EP1nNv5Uw@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mpromoteMember[2m > [22m[2mshould allow admin to promote member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 is NOT member of b2c25b5d-8aee-4c60-944e-bca3c6ee14f3 (Access Denied)

{"level":30,"time":1767820275603,"env":"test","module":"auth-routes","userId":"408dd5f8-2eff-4b28-a85b-667bfc1473df","email":"middleware-test-STSId4b8pVB5EP1nNv5Uw@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2macceptInvite[2m > [22m[2mshould reject expired invite
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of bced52ae-d9ab-498d-807f-2feb2285a705 (Access Denied)

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 7: Org member (user2) can update workflow
[22m[39m[isOrgMember] User 42c0cf77-3f5b-408f-b078-226f7617dc84 IS member of 1db2e39a-9a13-4fce-b301-48d312397741

{"level":30,"time":1767820275726,"env":"test","module":"user-credentials-repository","userId":"cbc649f8-e819-44fd-9856-06c3641ee660","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mpromoteMember[2m > [22m[2mshould allow admin to promote member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 IS member of b2c25b5d-8aee-4c60-944e-bca3c6ee14f3

{"level":30,"time":1767820275833,"env":"test","module":"email-queue","jobId":"d0d2ad9c-92bb-4ae0-8610-2781a2eb1dd4","to":"protected-test-WjpLws-g8c8NiwxXmPZsn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mpromoteMember[2m > [22m[2mshould allow admin to promote member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000011 IS member of b2c25b5d-8aee-4c60-944e-bca3c6ee14f3

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 8: Org admin (user1) can still access workflow after transfer
[22m[39m[isOrgMember] User 39dbd48e-cad0-4ac0-bba1-1018c6ef4ad6 IS member of 1db2e39a-9a13-4fce-b301-48d312397741

{"level":30,"time":1767820275885,"env":"test","module":"auth-routes","userId":"cbc649f8-e819-44fd-9856-06c3641ee660","email":"protected-test-WjpLws-g8c8NiwxXmPZsn@example.com","msg":"User registered"}
{"level":30,"time":1767820275947,"env":"test","workflowId":"80df7b52-cee8-4786-881e-38122c07019e","userId":"39dbd48e-cad0-4ac0-bba1-1018c6ef4ad6","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mWorkflow Transfer[2m > [22m[2mshould prevent non-member from transferring org workflow
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 4412f74a-f535-49fb-9c85-7b3c12ca3b85 (Access Denied)

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 9: Non-member (user3) CANNOT access org workflow
[22m[39m[isOrgMember] User 9ed41965-bcef-4677-8803-c5e96c565e3c is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

{"level":30,"time":1767820276140,"env":"test","module":"auth-routes","userId":"408dd5f8-2eff-4b28-a85b-667bfc1473df","msg":"User logged in successfully"}
{"level":40,"time":1767820276188,"env":"test","workflowId":"47f57375-50f7-44fc-915c-d60be0ba6651","msg":"No current or pinned version found for workflow, run might be unstable"}
{"level":50,"time":1767820276193,"env":"test","error":{},"msg":"Error creating DataVault row"}
{"level":30,"time":1767820276195,"env":"test","module":"audit-log-service","userId":"408dd5f8-2eff-4b28-a85b-667bfc1473df","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":30,"time":1767820276251,"env":"test","module":"auth-routes","userId":"7629dc9d966b3841f0b59029f50a0d8a","msg":"Login requires MFA verification"}
{"level":30,"time":1767820276359,"env":"test","module":"mfa-service","userId":"7629dc9d966b3841f0b59029f50a0d8a","msg":"TOTP verification successful"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mdemoteMember[2m > [22m[2mshould allow admin to demote other admin
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 is NOT member of c8b58c2b-e74d-4213-a0eb-4435468a9195 (Access Denied)

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 10: Non-member (user3) CANNOT update org workflow
[22m[39m[isOrgMember] User 9ed41965-bcef-4677-8803-c5e96c565e3c is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

{"level":30,"time":1767820276412,"env":"test","module":"auth-routes","userId":"7629dc9d966b3841f0b59029f50a0d8a","msg":"MFA login successful"}
{"level":30,"time":1767820276412,"env":"test","module":"auth-routes","userId":"cbc649f8-e819-44fd-9856-06c3641ee660","msg":"User logged in successfully"}
{"level":30,"time":1767820276467,"env":"test","module":"audit-log-service","userId":"cbc649f8-e819-44fd-9856-06c3641ee660","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mdemoteMember[2m > [22m[2mshould allow admin to demote other admin
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 IS member of c8b58c2b-e74d-4213-a0eb-4435468a9195

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 11: Non-member (user3) CANNOT transfer org workflow
[22m[39m[isOrgMember] User 9ed41965-bcef-4677-8803-c5e96c565e3c is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

{"level":30,"time":1767820276679,"env":"test","module":"user-credentials-repository","userId":"206edbde-b8c3-4f4a-ab4d-043e567036ca","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mdemoteMember[2m > [22m[2mshould allow admin to demote other admin
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000011 IS member of c8b58c2b-e74d-4213-a0eb-4435468a9195

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2macceptInvite[2m > [22m[2mshould reject already accepted invite
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of 30827fda-3312-4dd9-89cf-257c07514317 (Access Denied)

{"level":30,"time":1767820276779,"env":"test","module":"email-queue","jobId":"12c62868-748d-4740-8b6c-5f0a7f81c5dd","to":"middleware-test-WFu_omjqfGNc5Pyy8GMBG@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820276831,"env":"test","module":"auth-routes","userId":"206edbde-b8c3-4f4a-ab4d-043e567036ca","email":"middleware-test-WFu_omjqfGNc5Pyy8GMBG@example.com","msg":"User registered"}
{"level":50,"time":1767820276885,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 14: Remove member from org
[22m[39m[isOrgMember] User 42c0cf77-3f5b-408f-b078-226f7617dc84 IS member of 1db2e39a-9a13-4fce-b301-48d312397741

{"level":50,"time":1767820277164,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820277258,"env":"test","module":"user-credentials-repository","userId":"e644beb4-0010-4b21-b4fa-d4f7cbc301a2","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 15: Removed member (user2) can no longer access workflow
[22m[39m[isOrgMember] User 42c0cf77-3f5b-408f-b078-226f7617dc84 is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

{"level":30,"time":1767820277361,"env":"test","module":"email-queue","jobId":"b4952103-3745-4ce6-b4e5-d50ae21b4c29","to":"protected-test-lPLTMaycZotcoyDeksSCQ@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould transfer database ownership
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 307e9baf-c5cf-4ee8-b54f-5656fd5aee70 (Access Denied)

{"level":30,"time":1767820277414,"env":"test","module":"auth-routes","userId":"e644beb4-0010-4b21-b4fa-d4f7cbc301a2","email":"protected-test-lPLTMaycZotcoyDeksSCQ@example.com","msg":"User registered"}
{"level":30,"time":1767820277553,"env":"test","module":"user-credentials-repository","userId":"ff921a11-ec74-4b6d-8d6e-5897c4dc8ad0","msg":"User credentials created"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 16: Re-add member and verify access restored
[22m[39m[isOrgMember] User 42c0cf77-3f5b-408f-b078-226f7617dc84 is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould transfer database ownership
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of 307e9baf-c5cf-4ee8-b54f-5656fd5aee70

{"level":30,"time":1767820277660,"env":"test","module":"email-queue","jobId":"35211717-bdfa-4039-8b73-2c04c5af0048","to":"middleware-test-Mnbe_cfFC78dgRjjvD9O3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mremoveMember[2m > [22m[2mshould allow admin to remove member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 is NOT member of d1db8195-d7c3-468e-b9a5-72a82e52960e (Access Denied)

{"level":30,"time":1767820277715,"env":"test","module":"auth-routes","userId":"ff921a11-ec74-4b6d-8d6e-5897c4dc8ad0","email":"middleware-test-Mnbe_cfFC78dgRjjvD9O3@example.com","msg":"User registered"}
{"level":50,"time":1767820277755,"env":"test","module":"auth-routes","error":{"name":"InvalidCredentialsError","code":"AUTH_004","statusCode":401,"isOperational":true},"msg":"Login failed"}
{"level":30,"time":1767820277756,"env":"test","module":"write-runner","operation":"write_start","mode":"create","config":{"mode":"create","tableId":"a479e992-9615-476a-8bf4-1836c3428554","dataSourceId":"35a59d57-5e98-45f5-9f54-6000e25e1232","columnMappings":[{"value":"{{78c98589-ba01-47d4-b0c8-d4dfcbfb592e}}","columnId":"5746e1fd-695a-4521-bbe1-4f89f2b3a409"}]},"tableId":"a479e992-9615-476a-8bf4-1836c3428554","preview":false,"msg":"Starting write execution"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mComplete Organization Workflow[2m > [22m[2mStep 16: Re-add member and verify access restored
[22m[39m[isOrgMember] User 42c0cf77-3f5b-408f-b078-226f7617dc84 IS member of 1db2e39a-9a13-4fce-b301-48d312397741

[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mremoveMember[2m > [22m[2mshould allow admin to remove member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 IS member of d1db8195-d7c3-468e-b9a5-72a82e52960e

stderr | tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/protected.routes.test.ts:37:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(f4413c35-475b-4d6a-b554-12cef51909e2) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/auth/protected.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820277876,"env":"test","workflowId":"80df7b52-cee8-4786-881e-38122c07019e","userId":"42c0cf77-3f5b-408f-b078-226f7617dc84","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mremoveMember[2m > [22m[2mshould allow admin to remove member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000011 IS member of d1db8195-d7c3-468e-b9a5-72a82e52960e

 [31mÎ“Â¥Â»[39m tests/integration/auth/protected.routes.test.ts [2m([22m[2m33 tests[22m[2m | [22m[31m25 failed[39m[2m)[22m[33m 36351[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow access with valid Bearer token[39m[33m 898[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject access without Authorization header [33m 1218[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with empty Bearer token[39m[33m 881[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with malformed Authorization header[39m[33m 872[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject access with wrong token type[39m[33m 893[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow POST with valid Bearer token[39m[33m 877[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST without Bearer token[39m[33m 892[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject POST with invalid token[39m[33m 918[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow PUT with valid Bearer token[39m[33m 870[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject PUT without Bearer token[39m[33m 871[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow DELETE with valid Bearer token[39m[33m 888[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject DELETE without Bearer token[39m[33m 889[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow PATCH with valid Bearer token[39m[33m 915[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject PATCH without Bearer token[39m[33m 961[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle Bearer token with extra spaces [33m 1183[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle token with newlines[39m[33m 940[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle very long invalid token [33m 1281[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle empty Authorization header [33m 1270[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle Authorization header with only Bearer[39m[33m 894[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle multiple Authorization headers [33m 1225[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with SQL injection attempt[39m[33m 903[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with XSS attempt[39m[33m 919[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject token with missing userId[39m[33m 929[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject token with non-existent userId [33m 1490[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not allow user to access another user's resources[39m[33m 2285[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should inject userId into request context[39m[33m 913[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should inject tenantId into request context [33m 1294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should inject role into request context [33m 1296[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not apply general rate limiting to authenticated requests[39m[33m 875[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle request with both Bearer token and cookies[39m[33m 862[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prioritize Bearer token over cookie when both present[39m[33m 859[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow unauthenticated access to optional auth routes[39m[33m 1544[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should enhance optional auth routes with user context when authenticated[39m[33m 872[2mms[22m[39m
{"level":40,"time":1767820278101,"env":"test","module":"mfa-service","userId":"83781e7124ff6f594b2f553b5b83c626","msg":"TOTP verification failed"}
{"level":40,"time":1767820278101,"env":"test","module":"auth-routes","userId":"83781e7124ff6f594b2f553b5b83c626","msg":"MFA verification failed during login"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2macceptInvite[2m > [22m[2mshould verify email matches invite
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of 6b6376a8-27f7-4811-87fc-3e660643a764 (Access Denied)

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mEdge Cases and Security[2m > [22m[2mCannot invite same email twice (pending invite exists)
[22m[39m[isOrgMember] User e352baa9-9524-4962-b597-92f897025caa is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

{"level":30,"time":1767820278267,"env":"test","module":"auth-routes","userId":"ff921a11-ec74-4b6d-8d6e-5897c4dc8ad0","msg":"User logged in successfully"}
{"level":30,"time":1767820278320,"env":"test","module":"audit-log-service","userId":"ff921a11-ec74-4b6d-8d6e-5897c4dc8ad0","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820278324,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 6d48ebd8-c4cc-42bf-bdc3-82b74416d1fa (Access Denied)

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of 6d48ebd8-c4cc-42bf-bdc3-82b74416d1fa

[90mstdout[2m | tests/integration/auth.routes.real.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mEdge Cases and Security[2m > [22m[2mCannot invite same email twice (pending invite exists)
[22m[39m[isOrgMember] User e352baa9-9524-4962-b597-92f897025caa is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

 [31mÎ“Â¥Â»[39m tests/integration/auth.routes.real.test.ts [2m([22m[2m26 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 41882[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should register a new user successfully [33m 1497[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for invalid email format [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for weak password [33m 824[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 409 for duplicate email [33m 1399[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set httpOnly refresh token cookie [33m 1353[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should login with valid credentials [33m 1775[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid password [33m 1703[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for non-existent user [33m 993[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 403 for unverified email[39m[33m 1673[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should record failed login attempt [33m 1541[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return requiresMfa=true for MFA-enabled users[39m[33m 1838[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should lock account after 5 failed attempts[39m[33m 2885[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should logout and clear refresh token cookie [33m 1868[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should refresh access token with valid refresh token [33m 2159[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for missing refresh token [33m 845[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should rotate refresh token after use [33m 2210[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should send password reset email for existing user [33m 1466[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not reveal if email exists (security) [33m 920[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reset password with valid token [33m 3330[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for invalid token [33m 915[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 400 for weak new password [33m 1581[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return current user for valid token [33m 1920[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for missing token [33m 851[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 for invalid token [33m 840[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should complete MFA login with valid TOTP code [33m 2209[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should reject invalid MFA code [33m 1682[2mms[22m[39m
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of 6d48ebd8-c4cc-42bf-bdc3-82b74416d1fa

{"level":30,"time":1767820278715,"env":"test","module":"user-credentials-repository","userId":"3d00bdb5-0ddf-4025-afc7-e07c28e6dd27","msg":"User credentials created"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould allow org member to transfer org database
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of 6d48ebd8-c4cc-42bf-bdc3-82b74416d1fa

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts[2m > [22m[2mDataVault Autonumber Integration Tests
[22m[39mError cleaning up table: Error: Table not found
    at DatavaultTablesService.verifyTenantOwnership (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:150:13)
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at DatavaultTablesService.deleteTable (C:/Users/scoot/poll/VaultLogic/server/services/DatavaultTablesService.ts:290:5)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/datavault.autonumber.test.ts:90:9

[90mstdout[2m | tests/integration/datavault.autonumber.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1767820278809,"env":"test","workflowId":"a869a936-fb8e-4ac2-a844-78777e79ace6","msg":"No current or pinned version found for workflow, run might be unstable"}
 [32mÎ“Â£Ã´[39m tests/integration/datavault.autonumber.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 9543[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate basic autonumber without prefix [33m 1161[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate autonumber with prefix [33m 1152[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should generate autonumber with yearly reset format [33m 1154[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should be atomic and prevent race conditions [33m 784[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should prevent manual updates to autonumber values [33m 1545[2mms[22m[39m
{"level":30,"time":1767820278827,"env":"test","module":"email-queue","jobId":"e954202d-03bd-4a16-8caa-163bc1d1072f","to":"middleware-test-1zzB19ydTm3BV-aDTOwQn@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mleaveOrganization[2m > [22m[2mshould allow member to leave organization
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 is NOT member of b4d78f22-b103-4e3a-acbd-751d0d8a4914 (Access Denied)

{"level":30,"time":1767820278883,"env":"test","module":"auth-routes","userId":"3d00bdb5-0ddf-4025-afc7-e07c28e6dd27","email":"middleware-test-1zzB19ydTm3BV-aDTOwQn@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mEdge Cases and Security[2m > [22m[2mCannot accept expired invite
[22m[39m[isOrgMember] User e0d9a589-d447-4457-9816-95c2f5ffa151 is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mleaveOrganization[2m > [22m[2mshould allow member to leave organization
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 IS member of b4d78f22-b103-4e3a-acbd-751d0d8a4914

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould create a note for a row
[22m[39mCreated note: 7151492d-ad20-4354-90c5-a8020ad1a26d tenantId: 305199e4-84b5-42be-aeb3-b7a3f05479ce userId: google-user-id

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mleaveOrganization[2m > [22m[2mshould allow member to leave organization
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000011 IS member of b4d78f22-b103-4e3a-acbd-751d0d8a4914

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

{"level":30,"time":1767820279427,"env":"test","module":"auth-routes","userId":"3d00bdb5-0ddf-4025-afc7-e07c28e6dd27","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 5b63f87b-4a4c-4aaf-8d7c-9fe72fd396de tenantId: 305199e4-84b5-42be-aeb3-b7a3f05479ce userId: google-user-id

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767820279481,"env":"test","module":"audit-log-service","userId":"3d00bdb5-0ddf-4025-afc7-e07c28e6dd27","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820279485,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 0bb77d31-09df-4207-ad7b-c31f17151cf2 (Access Denied)

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould get all notes for a row
[22m[39mCreated note: 97ad2b8d-6c32-4a73-a814-b095f1fcfd5b tenantId: 305199e4-84b5-42be-aeb3-b7a3f05479ce userId: google-user-id

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mEdge Cases and Security[2m > [22m[2mCannot transfer workflow to org user is not a member of
[22m[39m[isOrgMember] User 39dbd48e-cad0-4ac0-bba1-1018c6ef4ad6 IS member of 1db2e39a-9a13-4fce-b301-48d312397741

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mleaveOrganization[2m > [22m[2mshould allow admin to leave organization
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 is NOT member of 1bc88706-0843-4d9e-9cff-1d75d30f74d0 (Access Denied)

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mgetPendingInvitesForUser[2m > [22m[2mshould return pending invites for user email
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of e07060cc-3a3f-40b5-a256-3038c0221d6e (Access Denied)

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mEdge Cases and Security[2m > [22m[2mCannot transfer workflow to org user is not a member of
[22m[39m[isOrgMember] User 39dbd48e-cad0-4ac0-bba1-1018c6ef4ad6 is NOT member of 2ef7e8c7-23d8-43f3-be49-099d1bcb1472 (Access Denied)

[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mleaveOrganization[2m > [22m[2mshould allow admin to leave organization
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000011 IS member of 1bc88706-0843-4d9e-9cff-1d75d30f74d0

{"level":30,"time":1767820279860,"env":"test","module":"user-credentials-repository","userId":"70e95efb-3b84-4a88-ab8e-3dee23ddbf4c","msg":"User credentials created"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767820279973,"env":"test","module":"email-queue","jobId":"1aebaa3d-38e8-4f32-9a5f-625edd5d0ceb","to":"middleware-test-JAe8rKvhNMnj0rphXLLrF@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mDatabase Transfer[2m > [22m[2mshould prevent transfer to org if user is not a member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 is NOT member of 1e265a79-5b6c-45ba-a147-0655a95e527e (Access Denied)

[90mstdout[2m | tests/unit/server/organizationService.test.ts[2m > [22m[2mOrganizationService[2m > [22m[2mleaveOrganization[2m > [22m[2mshould allow admin to leave organization
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000012 IS member of 1bc88706-0843-4d9e-9cff-1d75d30f74d0

{"level":30,"time":1767820280024,"env":"test","module":"auth-routes","userId":"70e95efb-3b84-4a88-ab8e-3dee23ddbf4c","email":"middleware-test-JAe8rKvhNMnj0rphXLLrF@example.com","msg":"User registered"}
{"level":30,"time":1767820280036,"env":"test","workflowId":"a869a936-fb8e-4ac2-a844-78777e79ace6","queryId":"015c48f5-5a3b-4134-9588-237f1837b4ac","outputVar":"my_results","msg":"Executing query block"}
[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mEdge Cases and Security[2m > [22m[2mOnly members can view organization details
[22m[39m[isOrgMember] User 9ed41965-bcef-4677-8803-c5e96c565e3c is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

[90mstdout[2m | tests/integration/organizations-workflow.test.ts[2m > [22m[2mOrganization Workflow Integration Tests[2m > [22m[2mEdge Cases and Security[2m > [22m[2mOnly members can view organization members list
[22m[39m[isOrgMember] User 9ed41965-bcef-4677-8803-c5e96c565e3c is NOT member of 1db2e39a-9a13-4fce-b301-48d312397741 (Access Denied)

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould delete a note
[22m[39mCreated note: f8c8f314-0ab8-4fb9-9483-9e330ce25153 tenantId: 305199e4-84b5-42be-aeb3-b7a3f05479ce userId: google-user-id

[90mstdout[2m | tests/unit/server/organizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/server/organizationService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 8467[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create organization and auto-create admin membership [33m 431[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return all organizations for user [33m 426[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to update organization [33m 474[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should deny non-admin from updating organization [33m 470[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return all members of organization [33m 644[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to promote member [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to demote other admin [33m 857[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent self-demotion [33m 432[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to remove member [33m 789[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent self-removal [33m 427[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow member to leave organization [33m 806[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to leave organization [33m 881[2mms[22m[39m
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2mcanAccessAsset[2m > [22m[2mshould allow access to org-owned asset by org member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000001 IS member of 10000000-0000-0000-0000-000000000001

[90mstdout[2m | tests/unit/services/PdfQueueService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/PdfQueueService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 12379[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enqueue a PDF conversion job [33m 719[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create output with empty storagePath initially [33m 700[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return job status for pending job [33m 702[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return null for non-existent job [33m 646[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should parse attempt count from error field [33m 702[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should convert DOCX to PDF immediately [33m 778[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle conversion errors gracefully [33m 697[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should start and stop service [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not start if already running [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle stop when not running [33m 580[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should process pending jobs when queue is processed [33m 1030[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should process multiple jobs in batch [33m 1314[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing DOCX output gracefully [33m 802[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support enqueue within transaction [33m 799[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support convertImmediate within transaction [33m 737[2mms[22m[39m
[90mstdout[2m | tests/integration/organizations-workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/organizations-workflow.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 8250[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 2: Invite member via email [33m 480[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 3: Accept invite [33m 510[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 4: Create workflow owned by user [33m 475[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 5: Transfer workflow to organization [33m 324[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 6: Org member (user2) can access workflow [33m 412[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Step 16: Re-add member and verify access restored [33m 430[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot invite same email twice (pending invite exists) [33m 759[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot accept expired invite [33m 638[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m Cannot transfer workflow to org user is not a member of [33m 532[2mms[22m[39m
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2mcanAccessAsset[2m > [22m[2mshould deny access to org-owned asset by non-member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000002 is NOT member of 10000000-0000-0000-0000-000000000001 (Access Denied)

[90mstdout[2m | tests/integration/dataBlocks.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820280562,"env":"test","module":"auth-routes","userId":"70e95efb-3b84-4a88-ab8e-3dee23ddbf4c","msg":"User logged in successfully"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767820280615,"env":"test","module":"audit-log-service","userId":"70e95efb-3b84-4a88-ab8e-3dee23ddbf4c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
 [32mÎ“Â£Ã´[39m tests/integration/dataBlocks.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 5994[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should write data to DataVault via WriteBlock [33m 2561[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should query data from DataVault via QueryBlock and use in Logic [33m 1988[2mms[22m[39m
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mgetPendingInvitesForUser[2m > [22m[2mshould not return expired invites
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of e97e443a-a87f-4209-b38e-50510d28b602 (Access Denied)

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould only allow transfer to self when targetOwnerType is user
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of 4e9208d5-fa0e-4c17-b393-a73590987ca3 (Access Denied)

[90mstdout[2m | tests/unit/engine/templateNode.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

 [32mÎ“Â£Ã´[39m tests/unit/engine/templateNode.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 11687[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve template by key from workflowTemplates mapping [33m 738[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if template key not found [33m 593[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should store output in runOutputs table [33m 790[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve template by templateId directly [33m 595[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if templateId not found [33m 600[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use docxRenderer2 by default (v2 engine) [33m 659[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should use legacy engine when engine="legacy" [33m 591[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should generate PDF when toPdf=true [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should default to DOCX when toPdf=false [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should skip execution when condition evaluates to false [33m 524[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should execute when condition evaluates to true [33m 617[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should resolve simple bindings [33m 619[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle binding resolution errors gracefully [33m 537[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should record failed output in runOutputs table [33m 715[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not throw errors (should return error in result) [33m 604[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should deny access to templates from different tenant [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require either templateKey or templateId [33m 537[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mRow Notes[2m > [22m[2mshould not allow deleting notes by other users
[22m[39mCreated note: 808149c8-ea03-4f16-8f54-d2f8255651ae tenantId: 305199e4-84b5-42be-aeb3-b7a3f05479ce userId: google-user-id

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2misOrgMember[2m > [22m[2mshould return true for org member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000001 IS member of 10000000-0000-0000-0000-000000000001

{"level":30,"time":1767820281035,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":50,"time":1767820281142,"env":"test","error":{},"msg":"Error deleting row note"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2misOrgMember[2m > [22m[2mshould return false for non-member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000002 is NOT member of 10000000-0000-0000-0000-000000000001 (Access Denied)

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

{"level":30,"time":1767820281277,"env":"test","workflowId":"2ef7d210-d5f9-4005-b217-0f19e20b6810","userId":"37d28176-13b7-4d84-a033-cb3f5b4bb516","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2misOrgMember[2m > [22m[2mshould return true for org admin
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000001 IS member of 10000000-0000-0000-0000-000000000001

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould allow transfer from user to self (org member transferring org asset to themselves)
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 is NOT member of b91f0202-eac5-47de-a3e0-76a53d3a1cd6 (Access Denied)

[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767820281721,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould allow transfer from user to self (org member transferring org asset to themselves)
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000031 IS member of b91f0202-eac5-47de-a3e0-76a53d3a1cd6

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mgetPendingInvitesForUser[2m > [22m[2mshould not return accepted invites
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of 38b54ca2-f6f3-4a5f-a0f1-1aa02907fb5a (Access Denied)

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould allow transfer from user to self (org member transferring org asset to themselves)
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of b91f0202-eac5-47de-a3e0-76a53d3a1cd6

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts[2m > [22m[2mTransfer Ownership[2m > [22m[2mTransfer Validation[2m > [22m[2mshould allow transfer from user to self (org member transferring org asset to themselves)
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000032 IS member of b91f0202-eac5-47de-a3e0-76a53d3a1cd6

{"level":30,"time":1767820282141,"env":"test","module":"user-credentials-repository","userId":"784794d2-f394-44df-a97c-53f6458ca339","msg":"User credentials created"}
[90mstdout[2m | tests/unit/services/WorkflowTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowTemplateService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 16336[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should throw error if template belongs to different project [33m 607[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should automatically unset other primaries when setting new primary [33m 1096[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should list all templates for workflow version [33m 822[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return empty array for version with no templates [33m 549[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get template mapping by id and version [33m 707[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 537[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get template by key [33m 699[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if key not found [33m 538[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should get primary template for workflow version [33m 809[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should return null when no primary template exists [33m 634[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update mapping key [33m 749[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should update isPrimary flag [33m 817[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if new key already exists [33m 784[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 534[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should unset other primaries when setting isPrimary to true [33m 1097[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should detach template from workflow version [33m 756[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 539[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should set template as primary [33m 1012[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should throw error if mapping not found [33m 558[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should support operations within a transaction [33m 814[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should rollback on transaction error [33m 825[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767820282248,"env":"test","module":"email-queue","jobId":"440110b6-1e5e-4a83-b65b-aa70eaf1615b","to":"middleware-test-ufVM_ck-2e65v1TXoU-Nd@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/unit/repositories/WorkflowTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820282303,"env":"test","module":"auth-routes","userId":"784794d2-f394-44df-a97c-53f6458ca339","email":"middleware-test-ufVM_ck-2e65v1TXoU-Nd@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/WorkflowTemplateRepository.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 14774[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a workflow template mapping [33m 669[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create non-primary mapping by default [33m 657[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find all templates for a workflow version [33m 761[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return empty array for version with no templates [33m 658[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should order by createdAt desc (newest first) [33m 754[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find mapping by workflow version and key [33m 704[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined for non-existent key [33m 666[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find primary template for workflow version [33m 748[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined when no primary template exists [33m 689[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set a template as primary and unset others [33m 911[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle setting primary when none existed before [33m 905[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not delete mapping if workflow version does not match [33m 920[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return true if key exists in workflow version [33m 692[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return false if key does not exist [33m 633[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should exclude specified id when checking existence [33m 710[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return true if key exists on different mapping [33m 771[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update mapping fields [33m 709[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should find mapping by id [33m 710[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return undefined for non-existent id [33m 662[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/server/transferOwnership.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/server/transferOwnership.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 15067[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer user-owned project to org [33m 1694[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1238[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org-owned project to another org they belong to [33m 1661[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should detach workflow from project when transferring to different owner [33m 1374[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should keep workflow in project when transferring to same owner [33m 1428[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent non-member from transferring org workflow [33m 1329[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should transfer database ownership [33m 1014[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow org member to transfer org database [33m 1119[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent transfer to org if user is not a member [33m 1282[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should only allow transfer to self when targetOwnerType is user [33m 881[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow transfer from user to self (org member transferring org asset to themselves) [33m 1194[2mms[22m[39m
{"level":30,"time":1767820282507,"env":"test","workflowId":"b4332f23-a396-4473-9e5c-ebb62c040d7c","userId":"37d28176-13b7-4d84-a033-cb3f5b4bb516","sectionsCount":1,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
{"level":50,"time":1767820282601,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820282876,"env":"test","module":"auth-routes","userId":"784794d2-f394-44df-a97c-53f6458ca339","msg":"User logged in successfully"}
{"level":30,"time":1767820282928,"env":"test","module":"audit-log-service","userId":"784794d2-f394-44df-a97c-53f6458ca339","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820282933,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

{"level":50,"time":1767820283221,"env":"test","error":{},"workflowId":"7377f703-f019-41a2-9712-9550b23d264a","userId":"37d28176-13b7-4d84-a033-cb3f5b4bb516","projectId":"00000000-0000-0000-0000-000000000000","msg":"Error moving workflow"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2mcanCreateWithOwnership[2m > [22m[2mshould allow creating org-owned asset if user is member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000001 IS member of 10000000-0000-0000-0000-000000000001

[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mrevokeInvite[2m > [22m[2mshould allow admin to revoke invite
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of 8e96df09-03d4-46ce-814d-ef2df4d1b8de (Access Denied)

{"level":30,"time":1767820283345,"env":"test","module":"user-credentials-repository","userId":"c1f54bb3-9431-42fe-9018-5be109f6ee5c","msg":"User credentials created"}
{"level":40,"time":1767820283352,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2mcanCreateWithOwnership[2m > [22m[2mshould deny creating org-owned asset if user is not member
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000002 is NOT member of 10000000-0000-0000-0000-000000000001 (Access Denied)

{"level":30,"time":1767820283452,"env":"test","module":"email-queue","jobId":"7d10d47f-41bf-403a-81ff-f97d41b56dee","to":"middleware-test-FEZL0RfKkDBW09TnOERq3@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820283512,"env":"test","module":"auth-routes","userId":"c1f54bb3-9431-42fe-9018-5be109f6ee5c","email":"middleware-test-FEZL0RfKkDBW09TnOERq3@example.com","msg":"User registered"}
{"level":50,"time":1767820283529,"env":"test","module":"auth","err":{"type":"Error","message":"User not found after upsert","stack":"Error: User not found after upsert\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:159:26\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google authentication failed"}
[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767820283669,"env":"test","error":{"length":415,"name":"error","severity":"ERROR","code":"23503","detail":"Key (table_id)=(574b347f-fe26-4d65-ab07-3558234b76b3) is not present in table \"datavault_tables\".","schema":"public","table":"datavault_table_permissions","constraint":"datavault_table_permissions_table_id_datavault_tables_id_fk","file":"ri_triggers.c","line":"2599","routine":"ri_ReportViolation"},"msg":"Error granting table permission"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2mCross-org Access Control[2m > [22m[2mshould not allow member of org1 to access org2-owned assets
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000001 is NOT member of 10000000-0000-0000-0000-000000000002 (Access Denied)

{"level":50,"time":1767820283718,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
{"level":50,"time":1767820283727,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
{"level":50,"time":1767820283727,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token","stack":"Error: Invalid token\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:165:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google authentication failed"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":40,"time":1767820283785,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1767820283785,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google token verification failed"}
{"level":50,"time":1767820283785,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)\n    at C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:155:23"},"msg":"Google authentication failed"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767820283882,"env":"test","error":{},"msg":"Error granting table permission"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts[2m > [22m[2mDataVault v4 Regression Tests[2m > [22m[2mTable Permissions[2m > [22m[2mshould update table permission role
[22m[39mUpdate permission failed: { message: [32m'Access denied - owner permission required'[39m }

[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2mCross-org Access Control[2m > [22m[2mshould allow member of multiple orgs to access all their org assets
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000001 IS member of 10000000-0000-0000-0000-000000000001

{"level":40,"time":1767820283988,"env":"test","module":"enhanced-sandbox","error":{"code":"MODULE_NOT_FOUND","requireStack":["C:\\Users\\scoot\\poll\\VaultLogic\\node_modules\\isolated-vm\\isolated-vm.js"]},"msg":"isolated-vm not found, falling back to node 'vm' module"}
{"level":30,"time":1767820284008,"env":"test","connectionId":"024a9b0e-632b-4103-bc3c-62b7c8391f6c","projectId":"5cfa5d40-8604-4d43-9ef9-4975a647fbf8","name":"Test OAuth2 Connection","type":"oauth2_3leg","msg":"Connection created:"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts[2m > [22m[2mOwnership Access Control[2m > [22m[2mCross-org Access Control[2m > [22m[2mshould allow member of multiple orgs to access all their org assets
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000001 IS member of 10000000-0000-0000-0000-000000000002

[90mstdout[2m | tests/integration/collections.e2e.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820284064,"env":"test","module":"auth-routes","userId":"c1f54bb3-9431-42fe-9018-5be109f6ee5c","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/server/ownershipAccess.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/collections.e2e.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 4403[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create multiple records [33m 439[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820284115,"env":"test","module":"audit-log-service","userId":"c1f54bb3-9431-42fe-9018-5be109f6ee5c","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
{"level":50,"time":1767820284121,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
 [32mÎ“Â£Ã´[39m tests/unit/server/ownershipAccess.test.ts [2m([22m[2m19 tests[22m[2m)[22m[33m 5145[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow member of multiple orgs to access all their org assets [33m 315[2mms[22m[39m
stderr | tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/auth.middleware.integration.test.ts:41:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(c0a7b8ff-1b7b-45ab-8cdd-0539373a1f5c) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/auth/auth.middleware.integration.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820284227,"env":"test","module":"auth","email":"existing@example.com","msg":"OAuth2 login successful"}
{"level":30,"time":1767820284328,"env":"test","msg":"Simulating External Send","destination":"Test Webhook","payload":{"message":"Hello Preview"}}
{"level":50,"time":1767820284372,"env":"test","error":{},"msg":"Error revoking table permission"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts[2m > [22m[2mOrganization Invites[2m > [22m[2mrevokeInvite[2m > [22m[2mshould prevent accepting revoked invite
[22m[39m[isOrgMember] User 00000000-0000-0000-0000-000000000022 is NOT member of 4083d114-a418-4a33-97af-97da9a6dc653 (Access Denied)

 [31mÎ“Â¥Â»[39m tests/integration/auth/auth.middleware.integration.test.ts [2m([22m[2m35 tests[22m[2m | [22m[31m28 failed[39m[2m)[22m[33m 42715[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow access with valid JWT Bearer token[39m[33m 882[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when no token provided[39m[33m 894[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 with invalid token[39m[33m 1186[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 with expired token[39m[33m 871[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should extract token without Bearer prefix[39m[33m 876[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should proceed without authentication if no token provided[39m[33m 876[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach user context if valid token provided[39m[33m 903[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should proceed without auth if invalid token provided[39m[33m 1508[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with JWT Bearer token[39m[33m 908[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with refresh token cookie (GET only)[39m[33m 920[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject cookie auth for POST requests (mutation-strict) [33m 1239[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for PUT requests[39m[33m 909[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject cookie auth for DELETE requests[39m[33m 861[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow cookie auth for HEAD requests [33m 1347[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should prioritize JWT over cookie when both present[39m[33m 2337[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return 401 when no auth provided[39m[33m 893[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return 401 when both JWT and cookie are invalid [33m 1270[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with JWT if provided[39m[33m 933[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should authenticate with cookie if JWT not provided[39m[33m 1704[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should proceed anonymously if no auth provided[39m[33m 929[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should proceed anonymously if both JWT and cookie are invalid[39m[33m 1629[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should only allow safe methods for cookie auth[39m[33m 1377[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should ignore cookies when Bearer token present[39m[33m 943[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate refresh token from cookie [33m 1364[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired refresh token from cookie [33m 1222[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach userId to request[39m[33m 849[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach userEmail to request[39m[33m 879[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should attach tenantId to request[39m[33m 883[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should attach userRole to request [33m 1250[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should lookup tenantId from database if missing from token[39m[33m 856[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent error format for missing token[39m[33m 1161[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent error format for invalid token[39m[33m 1161[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent error format for expired token[39m[33m 2237[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle malformed JWT gracefully [33m 1211[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should handle JWT with wrong algorithm[39m[33m 1189[2mms[22m[39m
{"level":30,"time":1767820284627,"env":"test","module":"user-credentials-repository","userId":"0cba11d2-c9a5-47f7-97ba-ebb86621bf33","msg":"User credentials created"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":40,"time":1767820284676,"env":"test","error":{},"msg":"libreoffice-convert not available, trying system LibreOffice"}
{"level":30,"time":1767820284685,"env":"test","module":"auth","email":"refresh@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1767820284695,"env":"test","error":{},"msg":"Error granting table permission"}
{"level":40,"time":1767820284709,"env":"test","error":{"code":1,"killed":false,"signal":null,"cmd":"libreoffice --headless --convert-to pdf --outdir \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\" \"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs\\simple-template-1767820284654.docx\"","stdout":"","stderr":"'libreoffice' is not recognized as an internal or external command,\r\noperable program or batch file.\r\n"},"msg":"System LibreOffice conversion failed"}
{"level":40,"time":1767820284709,"env":"test","error":{"error":{"code":"INTERNAL_ERROR","message":""}},"msg":"PDF conversion failed"}
[90mstdout[2m | tests/unit/docxRenderer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820284739,"env":"test","module":"email-queue","jobId":"94d9c9c1-6366-4c87-8493-597fdf1a219a","to":"test-workflows-GUBJ03KD8ZQ3i_4HD8eMf@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
 [32mÎ“Â£Ã´[39m tests/unit/docxRenderer.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1640[2mms[22m[39m
{"level":30,"time":1767820284793,"env":"test","module":"auth-routes","userId":"0cba11d2-c9a5-47f7-97ba-ebb86621bf33","email":"test-workflows-GUBJ03KD8ZQ3i_4HD8eMf@example.com","msg":"User registered"}
{"level":30,"time":1767820284859,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/intake.workflow.test.ts[2m > [22m[2mIntake Workflow Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820284884,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1767820284870,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820284871,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820284877,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820284884,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820284884,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820284884,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820284884,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
{"level":50,"time":1767820285013,"env":"test","error":{},"workflowId":"ba64e22f-2b45-4b75-bc83-ca7f527b3fe7","userId":"0cba11d2-c9a5-47f7-97ba-ebb86621bf33","projectId":"44d98024-5168-470a-a957-a69a1c8a3d32","msg":"Error moving workflow"}
[90mstdout[2m | tests/unit/server/organizationInvites.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820285124,"env":"test","module":"auth","email":"idtoken@example.com","msg":"OAuth2 login successful"}
 [32mÎ“Â£Ã´[39m tests/unit/server/organizationInvites.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 19468[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create placeholder user for non-existent email [33m 1037[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create invite for existing user without creating placeholder [33m 969[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent duplicate pending invites [33m 1255[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent inviting existing members [33m 856[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should require admin access to create invite [33m 537[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should set expiry to 7 days from now [33m 1023[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should accept invite and create membership [33m 1477[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should convert placeholder user to real user on accept [33m 1524[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject expired invite [33m 1095[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject already accepted invite [33m 1395[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should verify email matches invite [33m 1021[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject invalid token [33m 527[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return pending invites for user email [33m 1035[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not return expired invites [33m 1111[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not return accepted invites [33m 1421[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should allow admin to revoke invite [33m 1162[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should prevent accepting revoked invite [33m 1162[2mms[22m[39m
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":30,"time":1767820285203,"env":"test","connectionId":"5f0ab4d8-81b4-4171-8d4d-acb1e38fb655","projectId":"5cfa5d40-8604-4d43-9ef9-4975a647fbf8","name":"Status Test Connection","type":"oauth2_3leg","msg":"Connection created:"}
{"level":30,"time":1767820285307,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
{"level":30,"time":1767820285485,"env":"test","module":"user-credentials-repository","userId":"3feab5f6-2c6a-440a-80c5-74a9b41652b6","msg":"User credentials created"}
[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820285567,"env":"test","module":"auth","email":"minimal@example.com","msg":"OAuth2 login successful"}
{"level":50,"time":1767820285586,"env":"test","error":{"issues":[{"validation":"uuid","code":"invalid_string","message":"Invalid uuid","path":["projectId"]}],"name":"ZodError"},"workflowId":"1d723253-9bdc-4612-84cc-c6d69cee0b73","userId":"37d28176-13b7-4d84-a033-cb3f5b4bb516","projectId":"invalid-uuid","msg":"Error moving workflow"}
[90mstdout[2m | tests/integration/variableSafety.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820285601,"env":"test","module":"email-queue","jobId":"462f39fb-e97d-4a7b-ad8a-295f1e048dc0","to":"test--6N-60q_v-XARirI0zXFH@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820285613,"env":"test","msg":"External Send Completed","destination":"Test Webhook","success":true,"status":200}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

{"level":30,"time":1767820285660,"env":"test","module":"auth-routes","userId":"3feab5f6-2c6a-440a-80c5-74a9b41652b6","email":"test--6N-60q_v-XARirI0zXFH@example.com","msg":"User registered"}
 [32mÎ“Â£Ã´[39m tests/integration/variableSafety.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 3681[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m REPRO: ScriptEngine fails to resolve alias 'input_variable' when aliasMap is NOT provided [33m 648[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m ScriptEngine resolves alias 'input_variable' when aliasMap is provided [33m 635[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m REPRO: BlockRunner fails to resolve alias in CreateRecordConfig [33m 656[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m BlockRunner logic resolves alias with aliasMap [33m 666[2mms[22m[39m
{"level":50,"time":1767820285677,"env":"test","module":"auth","err":{"type":"Error","message":"Token verification failed","stack":"Error: Token verification failed\n    at C:/Users/scoot/poll/VaultLogic/tests/integration/auth/oauth2.google.test.ts:425:9\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:145:11\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:915:26\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1243:20\n    at new Promise (<anonymous>)\n    at runWithTimeout (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1209:10)\n    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:37\n    at Traces.$ (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/traces.U4xDYhzZ.js:115:27)\n    at trace (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/test.B8ej_ZHS.js:239:21)\n    at runTest (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@vitest/runner/dist/index.js:1653:12)"},"msg":"Google token verification failed"}
[90mstdout[2m | tests/integration/externalSends.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1767820285735,"env":"test","module":"auth","email":"unverified@example.com","msg":"Email not verified by Google"}
{"level":50,"time":1767820285735,"env":"test","module":"auth","err":{"type":"Error","message":"Email not verified by Google","stack":"Error: Email not verified by Google\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:89:13)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
{"level":50,"time":1767820285787,"env":"test","module":"auth","err":{"type":"Error","message":"Invalid token payload","stack":"Error: Invalid token payload\n    at verifyGoogleToken (C:/Users/scoot/poll/VaultLogic/server/googleAuth.ts:85:25)\n    at processTicksAndRejections (node:internal/process/task_queues:103:5)"},"msg":"Google token verification failed"}
 [32mÎ“Â£Ã´[39m tests/integration/externalSends.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 4063[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m PREVIEW MODE: Should simulate send and NOT call fetch [33m 1462[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m LIVE MODE: Should call fetch with mapped payload [33m 1284[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.google.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.callback.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [31mÎ“Â¥Â»[39m tests/integration/auth/oauth2.google.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 3527[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should successfully authenticate with valid Google ID token[39m[33m 324[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 400 when ID token is missing[32m 66[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 403 when Origin header is invalid[32m 56[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 401 when Google token verification fails[32m 61[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return 401 when email is not verified by Google[32m 58[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update existing user on subsequent logins [33m 499[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create refresh token record in database [33m 458[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should support both "token" and "idToken" fields [33m 383[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should respect rate limiting[32m 58[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should handle missing profile information gracefully [33m 385[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should verify valid Google ID token[32m 54[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error when token verification fails[32m 54[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error when email is not verified[32m 56[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should throw error when payload is null[32m 52[2mms[22m[39m
[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.callback.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 3266[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should initiate OAuth2 3-legged flow and generate authorization URL [33m 358[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should track OAuth2 connection status [33m 389[2mms[22m[39m
{"level":50,"time":1767820286168,"env":"test","error":{"issues":[{"code":"invalid_type","expected":"string","received":"undefined","path":["projectId"],"message":"Required"}],"name":"ZodError"},"workflowId":"ca76ca32-2d66-4bf3-8c7c-432b5d2226fd","userId":"37d28176-13b7-4d84-a033-cb3f5b4bb516","msg":"Error moving workflow"}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":30,"time":1767820287125,"env":"test","module":"user-credentials-repository","userId":"9c3c0614-0f87-4fe1-a322-b24114b9fd22","msg":"User credentials created"}
{"level":30,"time":1767820287163,"env":"test","workflowId":"6279fce0-f75d-4dbd-95b2-e80af2b71662","userId":"3feab5f6-2c6a-440a-80c5-74a9b41652b6","sectionsCount":0,"stepsCount":0,"logicRulesCount":0,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/ui/builder.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/builder.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 1927[2mms[22m[39m
{"level":30,"time":1767820287235,"env":"test","module":"email-queue","jobId":"da25f8c1-d9b6-4f6d-ba07-9076ead003c2","to":"test-workflows-OTExhmuVEpqt6_bHau7Mu@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820287290,"env":"test","module":"auth-routes","userId":"9c3c0614-0f87-4fe1-a322-b24114b9fd22","email":"test-workflows-OTExhmuVEpqt6_bHau7Mu@example.com","msg":"User registered"}
[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820287919,"env":"test","module":"auth-routes","userId":"9c3c0614-0f87-4fe1-a322-b24114b9fd22","msg":"User logged in successfully"}
[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820287977,"env":"test","module":"audit-log-service","userId":"9c3c0614-0f87-4fe1-a322-b24114b9fd22","eventType":"login_success","ipAddress":"::1","hasMetadata":true,"msg":"Security event logged"}
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/captcha.service.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/components/datavault/TableGridView.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/captcha.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[33m 1900[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridView.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 4911[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m loads table schema and rows [33m 726[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m enters edit mode on double click [33m 1021[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m updates cell value on blur [33m 952[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m renders delete button for each row [33m 395[2mms[22m[39m
{"level":30,"time":1767820288233,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767820288371,"env":"test","error":{},"workflowId":"374e53f8-c708-4738-9c85-2d0a583068e2","userId":"37d28176-13b7-4d84-a033-cb3f5b4bb516","projectId":"f9f752d0-7cb6-4ffc-a0f7-c1257bdf3b40","msg":"Error moving workflow"}
[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.workflows.test.ts > Workflows API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.workflows.test.ts:29:5 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(37d28176-13b7-4d84-a033-cb3f5b4bb516) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.workflows.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

stderr | tests/integration/intake.workflow.test.ts > Intake Workflow Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/intake.workflow.test.ts:20:9 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(3feab5f6-2c6a-440a-80c5-74a9b41652b6) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/intake.workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.workflows.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 16522[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a new draft workflow [33m 398[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject without permission [33m 667[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflows [33m 556[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should filter by status [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should search by name [33m 937[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should update draft workflow [33m 735[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow editing published workflow [33m 867[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should publish workflow [33m 765[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list workflow versions [33m 924[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to a project [33m 1390[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should move workflow to Main Folder (projectId = null) [33m 1226[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to non-existent project [33m 662[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without authentication [33m 497[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move of workflow user does not own [33m 1294[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move with invalid projectId format [33m 573[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move without projectId in body [33m 583[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should reject move to project user does not have access to [33m 2203[2mms[22m[39m
[90mstdout[2m | tests/unit/engine/Performance.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [32mÎ“Â£Ã´[39m tests/unit/engine/Performance.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1698[2mms[22m[39m
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/WorkflowChangeAnalyzer.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowChangeAnalyzer.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 2034[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/intake.workflow.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 4671[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow designating a workflow as Intake [33m 1376[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow linking a downstream workflow to an intake workflow [33m 1438[2mms[22m[39m
[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx > TableGridView - Drag & Drop > renders DndContext wrapper
Warning: validateDOMNesting(...): <th> cannot appear as a child of <div>.
    at th
    at SortableColumnHeader (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/SortableColumnHeader.tsx:12:33)
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)
Warning: validateDOMNesting(...): <div> cannot appear as a child of <tr>.
    at div
    at SortableContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:26:23)
    at tr
    at thead
    at table
    at div
    at DndContext (C:/Users/scoot/poll/VaultLogic/tests/unit/components/datavault/TableGridViewDragDrop.test.tsx:18:18)
    at div
    at div
    at TableGridView (C:/Users/scoot/poll/VaultLogic/client/src/components/datavault/TableGridView.tsx:32:26)
    at QueryClientProvider (file:///C:/Users/scoot/poll/VaultLogic/node_modules/@tanstack/react-query/build/modern/QueryClientProvider.js:20:3)

[90mstdout[2m | tests/unit/workflows/validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflows/validation.test.ts [2m([22m[2m66 tests[22m[2m)[22m[33m 2042[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

{"level":50,"time":1767820289608,"env":"test","error":{"issues":[{"received":"invalid_type","code":"invalid_enum_value","options":["text","number","boolean","date","datetime","email","phone","url","json","auto_number","autonumber","reference","select","multiselect"],"path":["type"],"message":"Invalid enum value. Expected 'text' | 'number' | 'boolean' | 'date' | 'datetime' | 'email' | 'phone' | 'url' | 'json' | 'auto_number' | 'autonumber' | 'reference' | 'select' | 'multiselect', received 'invalid_type'"}],"name":"ZodError"},"msg":"Error creating DataVault column"}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/HelperLibrary.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/HelperLibrary.test.ts [2m([22m[2m60 tests[22m[2m)[22m[33m 1781[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/components/datavault/TableGridViewDragDrop.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820290388,"env":"test","error":{},"msg":"Error creating DataVault row"}
 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/TableGridViewDragDrop.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 2794[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m displays columns in order based on orderIndex [33m 568[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

{"level":30,"time":1767820290629,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/ui/blocks/SendDataBlockEditorRouting.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/api.expression-validation.test.ts[2m > [22m[2mExpression Validation API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820290654,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1767820290639,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820290640,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820290646,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820290654,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820290654,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820290654,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820290654,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
[90mstdout[2m | tests/integration/datavault-v4-regression.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataBlockEditorRouting.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 1774[2mms[22m[39m
[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/datavault/ColumnTypeIcon.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/ui/datavault/ColumnTypeIcon.test.tsx [2m([22m[2m27 tests[22m[2m)[22m[33m 1900[2mms[22m[39m
 [31mÎ“Â¥Â»[39m tests/integration/datavault-v4-regression.test.ts [2m([22m[2m23 tests[22m[2m | [22m[31m3 failed[39m[2m)[22m[33m 18053[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a select column with options [33m 540[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a multiselect column with options [33m 479[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate select value against options [33m 1199[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should validate multiselect values as array [33m 936[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an autonumber column with sequence [33m 476[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should format autonumber with prefix [33m 950[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create a note for a row [33m 440[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should get all notes for a row [33m 763[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should delete a note [33m 756[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should not allow deleting notes by other users [33m 629[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should create an API token [33m 378[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should validate API token scopes[32m 215[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should revoke (delete) an API token [33m 649[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should deny access with expired token[32m 216[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should grant table permission [33m 376[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should list table permissions [33m 330[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should update table permission role[39m[33m 585[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should revoke table permission[39m[33m 482[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should enforce RBAC - only owners can manage permissions [33m 322[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should paginate rows efficiently[39m[33m 4634[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should return user-friendly error for invalid column type[32m 287[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return user-friendly error for missing required fields [33m 771[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle network errors gracefully[32m 224[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767820291185,"env":"test","module":"user-credentials-repository","userId":"98bd1185-1ab7-4c3e-967b-ea6153084852","msg":"User credentials created"}
[90mstdout[2m | tests/unit/client/list-choice-options.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/client/list-choice-options.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 2255[2mms[22m[39m
[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":30,"time":1767820291293,"env":"test","module":"email-queue","jobId":"c9c1485c-f779-45b2-b4ff-325c41f5e933","to":"test-XGD-8r8PGBL4LGvqqnnxB@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
{"level":30,"time":1767820291351,"env":"test","module":"auth-routes","userId":"98bd1185-1ab7-4c3e-967b-ea6153084852","email":"test-XGD-8r8PGBL4LGvqqnnxB@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/utils/pagination.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/session.management.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/pagination.test.ts [2m([22m[2m24 tests[22m[2m)[22m[33m 1838[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/session.management.test.ts [2m([22m[2m22 tests[22m[2m)[22m[33m 1724[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth.routes.test.ts [2m([22m[2m41 tests[22m[2m)[22m[33m 1798[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

{"level":50,"time":1767820292293,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/collab.client.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

{"level":50,"time":1767820292473,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
stderr | tests/unit/shared/workflowLogic.test.ts > workflowLogic > evaluateRules > Operators > Unknown operator > should return false and log warning for unknown operator
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/shared/workflowLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/collab.client.test.tsx [2m([22m[2m17 tests[22m[2m)[22m[33m 7765[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should add a comment [33m 745[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should allow comment owner to delete their comment [33m 416[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/workflowLogic.test.ts [2m([22m[2m65 tests[22m[2m)[22m[33m 1822[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820292585,"env":"test","blockId":"dbb8a874-75f7-4a2a-84c5-de7d7176d41c","virtualStepId":"029104c9-7483-48c2-92b4-a991ce028d0c","outputVar":"userList","msg":"Created read table block with virtual step"}
[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":50,"time":1767820292660,"env":"test","module":"auth-middleware","error":{"name":"UnauthorizedError","code":"AUTH_008","statusCode":401,"isOperational":true},"msg":"Hybrid auth error"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.expression-validation.test.ts > Expression Validation API Integration Tests
Cleanup error: error: update or delete on table "users" violates foreign key constraint "workflow_versions_created_by_users_id_fk" on table "workflow_versions"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at Object.cleanup (C:/Users/scoot/poll/VaultLogic/tests/helpers/integrationTestHelper.ts:144:9)
    at C:/Users/scoot/poll/VaultLogic/tests/integration/api.expression-validation.test.ts:75:5 {
  length: 376,
  severity: 'ERROR',
  code: '23503',
  detail: 'Key (id)=(98bd1185-1ab7-4c3e-967b-ea6153084852) is still referenced from table "workflow_versions".',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'public',
  table: 'workflow_versions',
  column: undefined,
  dataType: undefined,
  constraint: 'workflow_versions_created_by_users_id_fk',
  file: 'ri_triggers.c',
  line: '2612',
  routine: 'ri_ReportViolation'
}

[90mstdout[2m | tests/integration/api.expression-validation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/dynamic_options_workflow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.expression-validation.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 2858[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/dynamic_options_workflow.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 5730[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should successfully configure a workflow with Read Table -> Dynamic Choice [33m 449[2mms[22m[39m
[90mstdout[2m | tests/integration/intake.portal.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/intake.portal.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1938[2mms[22m[39m
[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/integration/api.dataSources.native.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: tuple concurrently deleted
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:279:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 90,
  severity: 'ERROR',
  code: 'XX000',
  detail: undefined,
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'heapam.c',
  line: '4518',
  routine: 'simple_heap_update'
}

{"level":30,"time":1767820293503,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.dataSources.native.test.ts[2m > [22m[2mData Sources API - Native Catalog
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820293527,"env":"test","msg":"Real-time collaboration server initialized"}
{"level":30,"time":1767820293513,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820293514,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820293520,"env":"test","module":"documents-routes","msg":"Document routes registered"}
{"level":30,"time":1767820293527,"env":"test","module":"collab-server","msg":"Initializing WebSocket collaboration server"}
{"level":40,"time":1767820293527,"env":"test","module":"collab-persistence","msg":"REDIS_URL not configured, multi-instance collab will not work"}
{"level":30,"time":1767820293527,"env":"test","module":"collab-server","msg":"WebSocket collaboration server attached to main HTTP server path /collab"}
{"level":30,"time":1767820293527,"env":"test","module":"collab-server","msg":"WebSocket collaboration server initialized"}
stderr | tests/unit/shared/validation/Validator.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:279:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 307,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_auto_number, 2950 2950 23, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

[90mstdout[2m | tests/unit/services/RunExecutionCoordinator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/validation/Validator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/RunExecutionCoordinator.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 1767[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/Validator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1899[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/components/datavault/SortableColumnHeader.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/SortableColumnHeader.test.tsx [2m([22m[2m10 tests[22m[2m)[22m[33m 2389[2mms[22m[39m
[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/variableResolver.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/variableResolver.test.ts [2m([22m[2m20 tests[22m[2m)[22m[33m 1844[2mms[22m[39m
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflows/conditionTruthTable.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820294280,"env":"test","module":"user-credentials-repository","userId":"e01fb737-8a2a-4ab3-b79a-a1a8a26f46ab","msg":"User credentials created"}
 [32mÎ“Â£Ã´[39m tests/unit/workflows/conditionTruthTable.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 1873[2mms[22m[39m
{"level":30,"time":1767820294388,"env":"test","module":"email-queue","jobId":"2eb15e6d-c009-4527-9a3a-691b8294dc00","to":"test-U52leT6V_C9qiXgbm3MEN@example.com","subject":"Verify Your Email - ezBuildr","msg":"Email added to queue"}
[90mstdout[2m | tests/integration/api.ai.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820294446,"env":"test","module":"auth-routes","userId":"e01fb737-8a2a-4ab3-b79a-a1a8a26f46ab","email":"test-U52leT6V_C9qiXgbm3MEN@example.com","msg":"User registered"}
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/api.ai.test.ts [2m([22m[2m32 tests[22m[2m)[22m[33m 1954[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/repeater.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/repeater.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1983[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/api.dataSources.native.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/components/datavault/CellRenderer.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [32mÎ“Â£Ã´[39m tests/unit/components/datavault/CellRenderer.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 3370[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m renders boolean value as Yes/No [33m 698[2mms[22m[39m
{"level":40,"time":1767820295474,"env":"test","module":"rbac-middleware","path":"/api/workflows","permission":"workflow:create","msg":"Unauthenticated user attempted to access protected resource"}
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/middleware/rbac.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":40,"time":1767820295479,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permission":"workflow:create","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1767820295480,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"permission":"workflow:view","path":"/api/workflows","msg":"Permission denied"}
{"level":40,"time":1767820295481,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","permissions":["workflow:create","workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (none of required permissions)"}
{"level":40,"time":1767820295483,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","permissions":["workflow:edit","workflow:delete"],"path":"/api/workflows","msg":"Permission denied (missing some required permissions)"}
{"level":40,"time":1767820295485,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1767820295486,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":null,"requiredRoles":["owner"],"path":"/api/admin","msg":"Role check failed"}
{"level":40,"time":1767820295486,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"builder","requiredRoles":["owner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767820295487,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"runner","requiredRoles":["owner","builder"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767820295489,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"viewer","requiredRoles":["owner","builder","runner"],"path":"/api/test","msg":"Role check failed"}
{"level":40,"time":1767820295494,"env":"test","module":"rbac-middleware","path":"/api/test","permission":"workflow:view","msg":"Unauthenticated user attempted to access protected resource"}
{"level":40,"time":1767820295494,"env":"test","module":"rbac-middleware","userId":"user-123","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
{"level":40,"time":1767820295495,"env":"test","module":"rbac-middleware","userId":"user-123","userRole":"invalid-role","permission":"workflow:view","path":"/api/test","msg":"Permission denied"}
 [32mÎ“Â£Ã´[39m tests/unit/middleware/rbac.test.ts [2m([22m[2m44 tests[22m[2m)[22m[33m 1969[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/api.dataSources.native.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 2585[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should list databases and databases' tables in the catalog [33m 391[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxRenderer2.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/docxRenderer2.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 2045[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mÎ“ÃœÃ¡âˆ©â••Ã… Concurrency conflict creating DB functions (attempt 1/3). Retrying...

[90mstdout[2m | tests/ui/blocks/SendDataToTableBlockEditor.test.tsx
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/ui/blocks/SendDataToTableBlockEditor.test.tsx [2m([22m[2m12 tests[22m[2m)[22m[33m 1995[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/validation/PageValidator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/PageValidator.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2014[2mms[22m[39m
{"level":50,"time":1767820296136,"env":"test","status":401,"statusText":"Unauthorized","error":"Invalid client credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767820296137,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296139,"env":"test","data":{"token_type":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1767820296139,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296140,"env":"test","data":{"access_token":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","expires_in":3600},"msg":"Invalid OAuth2 token response"}
{"level":50,"time":1767820296140,"env":"test","error":"Invalid OAuth2 token response: missing access_token or token_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296141,"env":"test","error":"Network error: ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

{"level":50,"time":1767820296252,"env":"test","error":"Invalid credentials","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296253,"env":"test","error":"ECONNREFUSED","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296255,"env":"test","status":400,"statusText":"Bad Request","error":"Invalid grant_type","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767820296255,"env":"test","error":"OAuth2 token request failed: 400 Bad Request","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296257,"env":"test","status":401,"statusText":"Unauthorized","error":"Client authentication failed","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767820296257,"env":"test","error":"OAuth2 token request failed: 401 Unauthorized","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296258,"env":"test","status":403,"statusText":"Forbidden","error":"Access denied","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767820296258,"env":"test","error":"OAuth2 token request failed: 403 Forbidden","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296259,"env":"test","status":500,"statusText":"Internal Server Error","error":"Server error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token request failed"}
{"level":50,"time":1767820296259,"env":"test","error":"OAuth2 token request failed: 500 Internal Server Error","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296260,"env":"test","error":"Unexpected token in JSON","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
{"level":50,"time":1767820296260,"env":"test","error":"Request timeout","tokenUrl":"Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³Î“Ã‡Ã³","msg":"OAuth2 token fetch error"}
[90mstdout[2m | tests/integration/auth/oauth2.client-credentials.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/auth/oauth2.client-credentials.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1977[2mms[22m[39m
[90mstdout[2m | tests/unit/services/docxHelpers.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

 [32mÎ“Â£Ã´[39m tests/unit/services/docxHelpers.test.ts [2m([22m[2m39 tests[22m[2m)[22m[33m 1807[2mms[22m[39m
[90mstdout[2m | tests/unit/WorkflowOptimizationService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/WorkflowOptimizationService.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 1884[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/shared/validation/stepConfigSchemas.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/shared/validation/stepConfigSchemas.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 2514[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/unit/utils/encryption.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/encryption.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 1931[2mms[22m[39m
[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/ScriptEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflow/QueryBlock.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/ScriptEngine.test.ts [2m([22m[2m26 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 1917[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/workflow/QueryBlock.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1957[2mms[22m[39m
[90mstdout[2m | tests/integration/conditions/conditionEvaluation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/conditions/conditionEvaluation.test.ts [2m([22m[2m18 tests[22m[2m)[22m[33m 1925[2mms[22m[39m
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

stderr | tests/unit/services/WorkflowService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/utils/conditionalLogic-simple.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic-simple.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 2151[2mms[22m[39m
stderr | tests/unit/services/MfaService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

stderr | tests/unit/shared/conditionEvaluator.test.ts > conditionEvaluator > Comparison operators > Unknown operator > should default to true and log warning
Unknown operator: unknown_operator

[90mstdout[2m | tests/unit/shared/conditionEvaluator.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

 [32mÎ“Â£Ã´[39m tests/unit/shared/conditionEvaluator.test.ts [2m([22m[2m70 tests[22m[2m)[22m[33m 1919[2mms[22m[39m
[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/mfa.flow.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/mfa.flow.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 1970[2mms[22m[39m
[90mstdout[2m | tests/unit/utils/conditionalLogic.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/utils/conditionalLogic.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 2003[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  suppress all logs with { quiet: true }

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

{"level":30,"time":1767820298868,"env":"test","workflowId":"123e4567-e89b-12d3-a456-426614174000","userId":"user-123","sectionsCount":2,"stepsCount":0,"logicRulesCount":1,"msg":"getWorkflowWithDetails called"}
[90mstdout[2m | tests/unit/services/WorkflowService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/WorkflowService.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1086[2mms[22m[39m
       [33m[2mÎ“Â£Ã´[22m[39m should return workflow if user is the creator [33m 990[2mms[22m[39m
[90mstdout[2m | tests/unit/services/TemplateAnalysisService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine.expr.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine.expr.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 2002[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/TemplateAnalysisService.test.ts [2m([22m[2m27 tests[22m[2m)[22m[33m 2241[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/MfaService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/MfaService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 1632[2mms[22m[39m
         [33m[2mÎ“Â£Ã´[22m[39m should try multiple codes if first doesn't match [33m 331[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

[90mstdout[2m | tests/integration/analytics_preservation.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/repositories/DatavaultColumnsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/analytics_preservation.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1414[2mms[22m[39m
     [33m[2mÎ“Â£Ã´[22m[39m should preserve lifetime user count when a user is deleted [33m 530[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultColumnsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 1068[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

stderr | tests/unit/schema/documentEngine.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): error: duplicate key value violates unique constraint "pg_proc_proname_args_nsp_index"
    at file:///C:/Users/scoot/poll/VaultLogic/node_modules/@neondatabase/serverless/index.mjs:1345:74
    at processTicksAndRejections (node:internal/process/task_queues:103:5)
    at ensureDbFunctions (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:189:3)
    at ensureDbFunctionsWithRetry (C:/Users/scoot/poll/VaultLogic/tests/setup.ts:169:7)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:131:9 {
  length: 320,
  severity: 'ERROR',
  code: '23505',
  detail: 'Key (proname, proargtypes, pronamespace)=(datavault_get_next_autonumber, 2950 2950 2950 25 23 25 25, 2200) already exists.',
  hint: undefined,
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: 'pg_catalog',
  table: 'pg_proc',
  column: undefined,
  dataType: undefined,
  constraint: 'pg_proc_proname_args_nsp_index',
  file: 'nbtinsert.c',
  line: '667',
  routine: '_bt_check_unique'
}

[90mstdout[2m | tests/unit/schema/documentEngine.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/lib/queries/QueryRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

 [32mÎ“Â£Ã´[39m tests/unit/schema/documentEngine.test.ts [2m([22m[2m33 tests[22m[2m)[22m[33m 1080[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/lib/queries/QueryRunner.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 1008[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 911[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DatavaultTablesRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultTablesRepository.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 1077[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  specify custom .env file path with { path: '/custom/path/.env' }

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¹Ã©âˆ©â••Ã… backup and recover secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¤ add secrets lifecycle management: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/DocumentTemplateService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts[2m > [22m[2mDatavaultColumnsService[2m > [22m[2mgetColumns[2m > [22m[2mshould throw 404 if table not found
[22m[39m[DEBUG] Table not found: 660e8400-e29b-41d4-a716-446655440001

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/services/DocumentTemplateService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 887[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultColumnsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultColumnsService.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 1187[2mms[22m[39m
[90mstdout[2m | tests/unit/repositories/DocumentTemplateRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ encrypt with Dotenvx: https://dotenvx.com

{"level":30,"time":1767820302000,"env":"test","module":"metrics-service","msg":"MetricsService initialized"}
 [32mÎ“Â£Ã´[39m tests/unit/repositories/DocumentTemplateRepository.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 1156[2mms[22m[39m
[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/DataSourceService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/services/DataSourceService.test.ts [2m([22m[2m9 tests[22m[2m)[22m[33m 950[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

[90mstdout[2m | tests/unit/services/RecordService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/unit/services/DatavaultTablesService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/RecordService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 844[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultTablesService.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 837[2mms[22m[39m
[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/CollectionFieldService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/services/CollectionFieldService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 863[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¦Ã‘ sync secrets across teammates & machines: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent building .env in docker: https://dotenvx.com/prebuild

[90mstdout[2m | tests/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/services/BrandingService.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 913[2mms[22m[39m
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  enable debug logging with { debug: true }

{"level":40,"time":1767820303598,"env":"test","hookId":"hook-1","hookName":"Hook 1","error":"Test error","msg":"LifecycleHookService: Hook execution failed"}
[90mstdout[2m | tests/unit/LifecycleHookService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":50,"time":1767820303603,"env":"test","error":{},"workflowId":"workflow-1","runId":"run-1","phase":"beforePage","msg":"LifecycleHookService: Failed to execute hooks for phase"}
{"level":30,"time":1767820303611,"env":"test","hookId":"hook-1","workflowId":"workflow-1","phase":"beforePage","msg":"LifecycleHookService: Created lifecycle hook"}
{"level":30,"time":1767820303617,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Updated lifecycle hook"}
{"level":30,"time":1767820303620,"env":"test","hookId":"hook-1","workflowId":"workflow-1","msg":"LifecycleHookService: Deleted lifecycle hook"}
 [32mÎ“Â£Ã´[39m tests/unit/LifecycleHookService.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 926[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Ã¶Ã‰ prevent committing .env to code: https://dotenvx.com/precommit

stderr | tests/unit/external/ExternalSendRunner.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

{"level":30,"time":1767820303915,"env":"test","msg":"External Send Completed","destination":"My Webhook","success":true,"status":200}
[90mstdout[2m | tests/unit/external/ExternalSendRunner.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

{"level":30,"time":1767820303931,"env":"test","msg":"Simulating External Send","destination":"Test","payload":{}}
[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/unit/external/ExternalSendRunner.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 31[2mms[22m[39m
stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip question when condition is false
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q1 executed. Key: has_code, Value: true. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute question when condition is true
[DEBUG Question] Node q2 executed. Key: code, Value: ABC123. Context keys: 5

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should skip compute node when condition is false
[DEBUG Question] Node q1 executed. Key: amount, Value: 0. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should execute compute node when condition is true
[DEBUG Question] Node q1 executed. Key: amount, Value: 100. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q1 executed. Key: has_code, Value: false. Context keys: 4

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Conditional Execution > should handle complex workflow with multiple conditions
[DEBUG Question] Node q3 executed. Key: amount, Value: 1000. Context keys: 5

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should return trace when debug is enabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

stderr | tests/unit/engine.run-conditions.test.ts > Engine - Conditional Execution > Debug Mode > should not return trace when debug is disabled
[DEBUG Question] Node q1 executed. Key: name, Value: John. Context keys: 3

[90mstdout[2m | tests/unit/engine.run-conditions.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

[90mstdout[2m | tests/integration/branding.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/unit/engine.run-conditions.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 965[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/branding.routes.test.ts [2m([22m[2m21 tests[22m[2m)[22m[33m 868[2mms[22m[39m
[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  write to custom object with { processEnv: myObject }

[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

stderr | tests/unit/services/PortalAuthService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

stderr | tests/unit/services/AccountLockoutService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/services/AccountLockoutService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/PortalAuthService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AccountLockoutService.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 42[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/PortalAuthService.test.ts [2m([22m[2m42 tests[22m[2m)[22m[32m 237[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

stderr | tests/unit/services/EmailTemplateMetadataService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/EmailTemplateMetadataService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/EmailTemplateMetadataService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 38[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/services/EmailTemplateMetadataService.test.ts [2m([22m[2m13 tests[22m[2m)[22m[33m 912[2mms[22m[39m
[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã¶Ã¦ add access controls to secrets: https://dotenvx.com/ops

[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  load multiple .env files with { path: ['.env.local', '.env'] }

stderr | tests/unit/services/BrandingService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/BrandingService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/BrandingService.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 37[2mms[22m[39m
[90mstdout[2m | tests/unit/workflow/PreviewExecution.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/workflow/PreviewExecution.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 924[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/integration/datavault.api-tokens.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

stderr | tests/unit/services/DatavaultRowsService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/debug_import.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/services/DatavaultRowsService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“Â£Ã  audit secrets and track compliance: https://dotenvx.com/ops

stderr | tests/unit/services/Guardrail.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultRowsService.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 27[2mms[22m[39m
[90mstdout[2m | tests/unit/services/Guardrail.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/Guardrail.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 19[2mms[22m[39m
stderr | tests/unit/services/DatavaultReferenceColumns.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: â‰¡Æ’Ã´Ã­ add observability to secrets: https://dotenvx.com/ops

 [32mÎ“Â£Ã´[39m tests/integration/datavault.api-tokens.test.ts [2m([22m[2m16 tests[22m[2m)[22m[33m 893[2mms[22m[39m
[90mstdout[2m | tests/unit/services/DatavaultReferenceColumns.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/debug_import.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 870[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/unit/services/DatavaultReferenceColumns.test.ts [2m([22m[2m10 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env -- tip: Î“ÃœÃ–âˆ©â••Ã…  override existing env vars with { override: true }

stderr | tests/unit/repositories/DatavaultRowsRepository.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/repositories/DatavaultRowsRepository.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/repositories/DatavaultRowsRepository.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 26[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.row-notes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

stderr | tests/unit/services/AuditLogService.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/services/AuditLogService.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/services/AuditLogService.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 22[2mms[22m[39m
 [32mÎ“Â£Ã´[39m tests/integration/datavault.row-notes.test.ts [2m([22m[2m12 tests[22m[2m)[22m[33m 869[2mms[22m[39m
stderr | tests/unit/engine/FinalBlockSnapshot.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/engine/FinalBlockSnapshot.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/engine/FinalBlockSnapshot.test.ts [2m([22m[2m3 tests[22m[2m)[22m[32m 20[2mms[22m[39m
stderr | tests/unit/BlockRunner.validate.test.ts
Î“ÃœÃ¡âˆ©â••Ã… Database initialization failed (ignoring for unit tests or mock scenarios): Error: [vitest] No "initializeDatabase" export is defined on the "../../server/db" mock. Did you forget to return it from "vi.mock"?
If you need to partially mock a module, you can use "importOriginal" helper inside:

    at VitestMocker.createError (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:311:17)
    at Object.get (file:///C:/Users/scoot/poll/VaultLogic/node_modules/vitest/dist/chunks/startModuleRunner.DpqpB8k3.js:384:16)
    at C:/Users/scoot/poll/VaultLogic/tests/setup.ts:104:35
    at processTicksAndRejections (node:internal/process/task_queues:103:5) {
  codeFrame: 'vi.mock(import("../../server/db"), async (importOriginal) => {\n' +
    '  const actual = await importOriginal()\n' +
    '  return {\n' +
    '    ...actual,\n' +
    '    // your mocked methods\n' +
    '  }\n' +
    '})'
}

[90mstdout[2m | tests/unit/BlockRunner.validate.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/unit/BlockRunner.validate.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 16[2mms[22m[39m
[90mstdout[2m | tests/integration/datavault.routes.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’ÂºÂ¬ Setting up test environment...

[90mstdout[2m | tests/unit/collab.server.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env -- tip: â‰¡Æ’Â¢Ã¡âˆ©â••Ã…  run anywhere with `dotenvx run -- yourcommand`

[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mÎ“Â£Ã  Database initialized for tests
â‰¡Æ’Ã¶Ã¤ Running test migrations...

 [32mÎ“Â£Ã´[39m tests/integration/datavault.routes.test.ts [2m([22m[2m29 tests[22m[2m)[22m[33m 837[2mms[22m[39m
 [2m[90mÎ“Ã¥Ã´[39m[22m tests/unit/collab.server.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m
{"level":30,"time":1767820307709,"env":"test","module":"metrics-routes","msg":"Metrics endpoint registered at GET /metrics"}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts[2m > [22m[2mPersonalization API Integration Tests
[22m[39m[Routes] E-Signature routes registered at /api/esign

{"level":30,"time":1767820307717,"env":"test","module":"file-routes","outputsDir":"C:\\Users\\scoot\\poll\\VaultLogic\\server\\files\\outputs","msg":"Secure file routes registered"}
{"level":30,"time":1767820307718,"env":"test","module":"ai-routes","msg":"AI workflow generation routes registered"}
{"level":30,"time":1767820307723,"env":"test","module":"documents-routes","msg":"Document routes registered"}
[90mstdout[2m | tests/integration/api.ai.personalization.test.ts
[22m[39mâ‰¡Æ’Âºâ•£ Cleaning up test environment...

 [32mÎ“Â£Ã´[39m tests/integration/api.ai.personalization.test.ts [2m([22m[2m3 tests[22m[2m)[22m[33m 1194[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 11 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/integration/api.projects.test.ts > Projects API Integration Tests
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.projects.test.ts:61:8
     59|         lastName: "User",
     60|       })
     61|       .expect(201);
       |        ^
     62| 
     63|     authToken = registerResponse.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/301]Î“Ã„Â»

 FAIL  tests/integration/api.runs.docx.test.ts > Runs API - DOCX Generation Integration Tests
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.runs.docx.test.ts:110:8
    108|       .post('/api/auth/register')
    109|       .send({ email, password: 'TestPassword123' })
    110|       .expect(201);
       |        ^
    111| 
    112|     authToken = registerResponse.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/301]Î“Ã„Â»

 FAIL  tests/integration/api.runs.graph.test.ts > Stage 8: Runs API Integration Tests
TypeError: actual.getSession is not a function
 Î“Â¥Â» setupAuth tests/integration/api.runs.graph.test.ts:35:24
     33|       ...actual,
     34|       setupAuth: (app: Express) => {
     35|         app.use(actual.getSession());
       |                        ^
     36| 
     37|         // Debug middleware to log cookies and session AND restore reqÎ“Ã‡Âª
 Î“Â¥Â» Module.registerRoutes server/routes.ts:19:9
 Î“Â¥Â» tests/integration/api.runs.graph.test.ts:67:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/301]Î“Ã„Â»

 FAIL  tests/integration/api.snapshots.test.ts > Stage 13: Workflow Snapshots & Versioning
TypeError: actual.getSession is not a function
 Î“Â¥Â» setupAuth tests/integration/api.snapshots.test.ts:28:32
     26|             ...actual,
     27|             setupAuth: (app: Express) => {
     28|                 app.use(actual.getSession());
       |                                ^
     29| 
     30|                 // Debug middleware to log cookies and session AND resÎ“Ã‡Âª
 Î“Â¥Â» Module.registerRoutes server/routes.ts:19:9
 Î“Â¥Â» tests/integration/api.snapshots.test.ts:62:24

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/301]Î“Ã„Â»

 FAIL  tests/integration/js_helpers.test.ts > Detailed Verification: JS Helper Availability
TypeError: actual.getSession is not a function
 Î“Â¥Â» setupAuth tests/integration/js_helpers.test.ts:18:28
     16|         ...actual,
     17|         setupAuth: (app: Express) => {
     18|             app.use(actual.getSession());
       |                            ^
     19|             app.use((req, res, next) => {
     20|                 const r = req as any;
 Î“Â¥Â» Module.registerRoutes server/routes.ts:19:9
 Î“Â¥Â» tests/integration/js_helpers.test.ts:54:15

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/301]Î“Ã„Â»

 FAIL  tests/integration/ai/workflowEdit.test.ts > POST /api/workflows/:workflowId/ai/edit - Integration Test
error: invalid input syntax for type uuid: "test-tenant"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/ai/workflowEdit.test.ts:64:20
     62| 
     63|     // Create test user
     64|     const [user] = await db.insert(users).values({
       |                    ^
     65|       email: 'test@example.com',
     66|       fullName: 'Test User',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management
error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:72:7
     70|   afterAll(async () => {
     71|     if (testTenantId) {
     72|       await db.delete(tenants).where(eq(tenants.id, testTenantId));
       |       ^
     73|     }
     74|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow
error: update or delete on table "users" violates foreign key constraint "audit_logs_user_id_users_id_fk" on table "audit_logs"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:77:7
     75|     // Clean up
     76|     if (testTenantId) {
     77|       await db.delete(tenants).where(eq(tenants.id, testTenantId));
       |       ^
     78|     }
     79|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/301]Î“Ã„Â»

 FAIL  tests/integration/auth/portal.authentication.test.ts [ tests/integration/auth/portal.authentication.test.ts ]
Error: No test suite found in file C:/Users/scoot/poll/VaultLogic/tests/integration/auth/portal.authentication.test.ts
Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/301]Î“Ã„Â»

 FAIL  tests/integration/workflows/runtime-pipelines.test.ts > Runtime Pipelines Integration Tests
error: insert or update on table "projects" violates foreign key constraint "projects_creator_id_users_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» NeonPreparedQuery.execute node_modules/drizzle-orm/neon-serverless/session.js:76:20
 Î“Â¥Â» tests/integration/workflows/runtime-pipelines.test.ts:69:23
     67| 
     68|     // Create test project
     69|     const [project] = await db
       |                       ^
     70|       .insert(projects)
     71|       .values({

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/301]Î“Ã„Â»

 FAIL  tests/integration/workflows/runtime-pipelines.test.ts > Runtime Pipelines Integration Tests
error: syntax error at end of input
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/workflows/runtime-pipelines.test.ts:212:5
    210|     await db.delete(datavaultValues).where(sql`1=1`);
    211|     await db.delete(datavaultRows).where(sql`1=1`);
    212|     await db.delete(datavaultColumns).where(sql`table_id = ${testTableÎ“Ã‡Âª
       |     ^
    213|     await db.delete(datavaultTables).where(sql`id = ${testTableId}`);
    214|     await db.delete(workflowRuns).where(sql`id = ${testRunId}`);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/301]Î“Ã„Â»

 FAIL  tests/unit/services/WorkflowPatchService.test.ts [ tests/unit/services/WorkflowPatchService.test.ts ]
TypeError: () => ({
    createTable: __vite_ssr_import_0__.vi.fn(),
    requirePermission: __vite_ssr_import_0__.vi.fn()
  }) is not a constructor
 Î“Â¥Â» new WorkflowPatchService server/services/WorkflowPatchService.ts:27:36
     25| export class WorkflowPatchService {
     26|   private tempIdMap: Map<string, string> = new Map();
     27|   private datavaultTablesService = new DatavaultTablesService();
       |                                    ^
     28|   private datavaultColumnsService = new DatavaultColumnsService();
     29| 
 Î“Â¥Â» server/services/WorkflowPatchService.ts:773:37
 Î“Â¥Â» tests/unit/services/WorkflowPatchService.test.ts:2:1

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/301]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 289 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter rows by equals condition
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:85:30
     83|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
     84| 
     85|       expect(result.success).toBe(true);
       |                              ^
     86|       expect(result.data?.filtered_users.count).toBe(3);
     87|       expect(result.data?.filtered_users.rows.every((r: any) => r.cityÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with greater_than operator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:116:30
    114|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    115| 
    116|       expect(result.success).toBe(true);
       |                              ^
    117|       expect(result.data?.senior_users.count).toBe(2);
    118|       expect(result.data?.senior_users.rows.every((r: any) => r.age > Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with AND combinator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:148:30
    146|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    147| 
    148|       expect(result.success).toBe(true);
       |                              ^
    149|       expect(result.data?.active_nyc.count).toBe(2);
    150|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Filter Operations > should filter with OR combinator
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:179:30
    177|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    178| 
    179|       expect(result.success).toBe(true);
       |                              ^
    180|       expect(result.data?.young_or_sf.count).toBe(2); // Bob (25) and Î“Ã‡Âª
    181|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by single key ascending
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:208:30
    206|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    207| 
    208|       expect(result.success).toBe(true);
       |                              ^
    209|       const ages = result.data?.sorted_users.rows.map((r: any) => r.agÎ“Ã‡Âª
    210|       expect(ages).toEqual([25, 28, 30, 32, 35]);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by single key descending
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:236:30
    234|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    235| 
    236|       expect(result.success).toBe(true);
       |                              ^
    237|       const names = result.data?.sorted_users.rows.map((r: any) => r.nÎ“Ã‡Âª
    238|       expect(names).toEqual(['Eve', 'Diana', 'Charlie', 'Bob', 'Alice'Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Sort Operations > should sort by multiple keys
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:265:30
    263|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    264| 
    265|       expect(result.success).toBe(true);
       |                              ^
    266|       const rows = result.data?.sorted_users.rows;
    267|       expect(rows[0].city).toBe('LA');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply limit
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:295:30
    293|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    294| 
    295|       expect(result.success).toBe(true);
       |                              ^
    296|       expect(result.data?.limited_users.count).toBe(3);
    297|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[20/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply offset
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:320:30
    318|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    319| 
    320|       expect(result.success).toBe(true);
       |                              ^
    321|       expect(result.data?.offset_users.count).toBe(3);
    322|       expect(result.data?.offset_users.rows[0].name).toBe('Charlie');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[21/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Range Operations > should apply offset and limit together
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:347:30
    345|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    346| 
    347|       expect(result.success).toBe(true);
       |                              ^
    348|       expect(result.data?.paged_users.count).toBe(2);
    349|       expect(result.data?.paged_users.rows[0].name).toBe('Bob');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[22/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Select Operations > should select specific columns
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:376:30
    374|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    375| 
    376|       expect(result.success).toBe(true);
       |                              ^
    377|       const row = result.data?.name_age_only.rows[0];
    378|       expect(row).toHaveProperty('name');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[23/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Dedupe Operations > should deduplicate by field
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:414:30
    412|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    413| 
    414|       expect(result.success).toBe(true);
       |                              ^
    415|       // NYC, LA, SF = 3 unique cities
    416|       expect(result.data?.unique_cities.count).toBe(3);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[24/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Derived Outputs > should output count variable
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:447:30
    445|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    446| 
    447|       expect(result.success).toBe(true);
       |                              ^
    448|       expect(result.data?.user_count).toBe(5);
    449|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[25/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Derived Outputs > should output first row variable
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:475:30
    473|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    474| 
    475|       expect(result.success).toBe(true);
       |                              ^
    476|       expect(result.data?.youngest_user).toBeDefined();
    477|       expect(result.data?.youngest_user.name).toBe('Bob');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[26/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Comprehensive Pipeline > should apply all operations in sequence
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:519:30
    517|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    518| 
    519|       expect(result.success).toBe(true);
       |                              ^
    520|       expect(result.data?.processed_users.count).toBe(2); // Limit of 2
    521|       expect(result.data?.active_count).toBe(2);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[27/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Edge Cases > should handle empty input list
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:567:30
    565|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    566| 
    567|       expect(result.success).toBe(true);
       |                              ^
    568|       expect(result.data?.filtered_users.count).toBe(0);
    569|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[28/301]Î“Ã„Â»

 FAIL  tests/ListTools.test.ts > List Tools Block > Edge Cases > should handle plain arrays
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ListTools.test.ts:621:30
    619|       const result = await (blockRunner as any).executeListToolsBlock(Î“Ã‡Âª
    620| 
    621|       expect(result.success).toBe(true);
       |                              ^
    622|       expect(result.data?.sorted_array.rows[0].score).toBe(90);
    623|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[29/301]Î“Ã„Â»

 FAIL  tests/integration/analytics_service.test.ts > Analytics Service Integration > should generate events and metrics on run completion
Error: Workflow is not active
 Î“Â¥Â» RunAuthResolver.verifyCreateAccess server/services/runs/RunAuthResolver.ts:110:53
    108| 
    109|             if (!workflow) throw new Error('Workflow not found');
    110|             if (workflow.status !== 'active') throw new Error('WorkfloÎ“Ã‡Âª
       |                                                     ^
    111|             if (!workflow.isPublic) throw new Error('Workflow is not pÎ“Ã‡Âª
    112| 
 Î“Â¥Â» RunService.createRun server/services/RunService.ts:202:22
 Î“Â¥Â» tests/integration/analytics_service.test.ts:42:21

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[30/301]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should analyze a DOCX file and return variables
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:143:37
    141|                 } catch (e) { console.log("FAIL_BODY: " + response.texÎ“Ã‡Âª
    142|             }
    143|             expect(response.status).toBe(200);
       |                                     ^
    144| 
    145|             expect(response.body.data).toHaveProperty("variables");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[31/301]Î“Ã„Â»

 FAIL  tests/integration/api.ai.doc.test.ts > AI Document Assistant API Integration Tests > POST /api/ai/doc/analyze > should fail if no file is provided
Error: expected 400 "Bad Request", got 500 "Internal Server Error"
 Î“Â¥Â» tests/integration/api.ai.doc.test.ts:168:18
    166|             await request(baseURL)
    167|                 .post("/api/ai/doc/analyze")
    168|                 .expect(400);
       |                  ^
    169|         });
    170|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[32/301]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Templates API > POST /api/projects/:ctx.projectId/templates > should reject non-docx files
Error: expected 500 "Internal Server Error", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:119:12
    117|           .field("name", "Test Template")
    118|           .attach("file", mockPdf, "test.pdf")
    119|           .expect(500); // Multer rejects before handler
       |            ^
    120|       });
    121| 
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[33/301]Î“Ã„Â»

 FAIL  tests/integration/api.templates-runs.test.ts > Templates and Runs API Integration Tests > Runs API > POST /api/workflows/:id/run > should reject without required permission
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/api.templates-runs.test.ts:289:12
    287|           .post("/api/auth/register")
    288|           .send({ email: viewerEmail, password: "TestPassword123" })
    289|           .expect(201);
       |            ^
    290| 
    291|         await db.update(schema.users)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[34/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Complete Registration Î“Ã¥Ã† Login Flow > should complete registration, verify email, then login
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:55:36
     53|         .send({ email, password });
     54| 
     55|       expect(loginAttempt1.status).toBe(403);
       |                                    ^
     56|       expect(loginAttempt1.body.message || loginAttempt1.body.error).tÎ“Ã‡Âª
     57| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[35/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should lock account after 5 failed attempts, then unlock after waiting
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:110:36
    108|         });
    109| 
    110|       expect(lockedAttempt.status).toBe(423);
       |                                    ^
    111|       expect(lockedAttempt.body.message || lockedAttempt.body.error).tÎ“Ã‡Âª
    112| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[36/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Account Lockout Flow > should record all login attempts
AssertionError: expected +0 to be 3 // Object.is equality

- Expected
+ Received

- 3
+ 0

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:145:31
    143|       });
    144| 
    145|       expect(attempts.length).toBe(3);
       |                               ^
    146|       expect(attempts.filter(a => !a.successful).length).toBe(2);
    147|       expect(attempts.filter(a => a.successful).length).toBe(1);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[37/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should complete MFA setup and login with TOTP
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:167:36
    165|         .set("Authorization", `Bearer ${token}`);
    166| 
    167|       expect(setupResponse.status).toBe(200);
       |                                    ^
    168|       expect(setupResponse.body.qrCodeDataUrl).toBeDefined();
    169|       expect(setupResponse.body.backupCodes).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[38/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > MFA Enrollment and Login Flow > should login with backup code when TOTP unavailable
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:248:52
    246|       });
    247| 
    248|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    249| 
    250|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[39/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Password Reset Flow > should complete full password reset flow
AssertionError: expected 500 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 500

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:332:36
    330|         });
    331| 
    332|       expect(resetResponse.status).toBe(200);
       |                                    ^
    333| 
    334|       // Step 4: Verify old password no longer works

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[40/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should rotate refresh token on each use
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:405:40
    403| 
    404|       let cookies = loginResponse.headers['set-cookie'] as unknown as Î“Ã‡Âª
    405|       let refreshTokenCookie = cookies.find(c => c.startsWith('refreshÎ“Ã‡Âª
       |                                        ^
    406| 
    407|       expect(refreshTokenCookie).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[41/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Token Refresh Flow > should detect and prevent refresh token reuse (token theft)
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:438:44
    436| 
    437|       const cookies = loginResponse.headers['set-cookie'] as unknown aÎ“Ã‡Âª
    438|       const originalRefreshToken = cookies.find(c => c.startsWith('refÎ“Ã‡Âª
       |                                            ^
    439| 
    440|       // Use token once (rotation happens)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[42/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should list all active sessions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:492:39
    490|         .set("Authorization", `Bearer ${token}`);
    491| 
    492|       expect(sessionsResponse.status).toBe(200);
       |                                       ^
    493|       expect(sessionsResponse.body.sessions).toBeDefined();
    494|       expect(sessionsResponse.body.sessions.length).toBeGreaterThanOrEÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[43/301]Î“Ã„Â»

 FAIL  tests/integration/auth.flows.real.test.ts > Auth Flows Integration Tests (REAL) > Session Management Flow > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/auth.flows.real.test.ts:517:40
    515| 
    516|       const sessions = sessionsResponse.body.sessions;
    517|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    518| 
    519|       // Revoke first session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[44/301]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return 403 for unverified email
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:192:31
    190|         .send({ email, password });
    191| 
    192|       expect(response.status).toBe(403);
       |                               ^
    193|       expect(response.body.message || response.body.error).toBeDefinedÎ“Ã‡Âª
    194|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[45/301]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should return requiresMfa=true for MFA-enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:223:31
    221|         .send({ email, password });
    222| 
    223|       expect(response.status).toBe(200);
       |                               ^
    224|       expect(response.body.requiresMfa).toBe(true);
    225|       expect(response.body.userId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[46/301]Î“Ã„Â»

 FAIL  tests/integration/auth.routes.real.test.ts > Auth Routes Integration Tests (REAL) > POST /api/auth/login > should lock account after 5 failed attempts
AssertionError: expected 401 to be 423 // Object.is equality

- Expected
+ Received

- 423
+ 401

 Î“Â¥Â» tests/integration/auth.routes.real.test.ts:250:31
    248|         });
    249| 
    250|       expect(response.status).toBe(423);
       |                               ^
    251|       expect(response.body).toBeDefined();
    252|       expect(response.body.error || response.body.message).toBeDefinedÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[47/301]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should update table permission role
AssertionError: expected 403 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 403

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:637:37
    635|         console.log('Update permission failed:', updateResponse.body);
    636|       }
    637|       expect(updateResponse.status).toBe(201);
       |                                     ^
    638|       expect(updateResponse.body.role).toBe('write');
    639|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[48/301]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Table Permissions > should revoke table permission
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:663:37
    661| 
    662|       // Revoke returns 200 with message
    663|       expect(revokeResponse.status).toBe(200);
       |                                     ^
    664| 
    665|       // Verify permission is deleted

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[49/301]Î“Ã„Â»

 FAIL  tests/integration/datavault-v4-regression.test.ts > DataVault v4 Regression Tests > Grid Performance > should paginate rows efficiently
error: insert or update on table "datavault_rows" violates foreign key constraint "datavault_rows_table_id_datavault_tables_id_fk"
 Î“Â¥Â» node_modules/@neondatabase/serverless/index.mjs:1345:74
 Î“Â¥Â» tests/integration/datavault-v4-regression.test.ts:702:7
    700|         );
    701|       }
    702|       await Promise.all(rowPromises);
       |       ^
    703| 
    704|       // Test pagination

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[50/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow owner to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:154:26
    152|         .set('Cookie', ownerCookie);
    153| 
    154|       expect(res.status).toBe(200);
       |                          ^
    155|       expect(res.body.id).toBe(tableId);
    156|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[51/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow writer to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:163:26
    161|         .set('Cookie', writerCookie);
    162| 
    163|       expect(res.status).toBe(200);
       |                          ^
    164|       expect(res.body.id).toBe(tableId);
    165|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[52/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should allow reader to read table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:172:26
    170|         .set('Cookie', readerCookie);
    171| 
    172|       expect(res.status).toBe(200);
       |                          ^
    173|       expect(res.body.id).toBe(tableId);
    174|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[53/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId > should deny non-member from reading table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:181:26
    179|         .set('Cookie', nonMemberCookie);
    180| 
    181|       expect(res.status).toBe(403);
       |                          ^
    182|       expect(res.body.message).toContain('Access denied');
    183|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[54/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should allow owner to update table
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:193:26
    191|         .send({ description: 'Updated by owner' });
    192| 
    193|       expect(res.status).toBe(200);
       |                          ^
    194|     });
    195| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[55/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should deny writer from updating table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:202:26
    200|         .send({ description: 'Attempt by writer' });
    201| 
    202|       expect(res.status).toBe(403);
       |                          ^
    203|       expect(res.body.message).toContain('Access denied');
    204|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[56/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > PATCH /api/datavault/tables/:tableId > should deny reader from updating table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:212:26
    210|         .send({ description: 'Attempt by reader' });
    211| 
    212|       expect(res.status).toBe(403);
       |                          ^
    213|       expect(res.body.message).toContain('Access denied');
    214|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[57/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny writer from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:223:26
    221|         .set('Cookie', writerCookie);
    222| 
    223|       expect(res.status).toBe(403);
       |                          ^
    224|       expect(res.body.message).toContain('Access denied');
    225|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[58/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny reader from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:232:26
    230|         .set('Cookie', readerCookie);
    231| 
    232|       expect(res.status).toBe(403);
       |                          ^
    233|       expect(res.body.message).toContain('Access denied');
    234|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[59/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/tables/:tableId > should deny non-member from deleting table
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:241:26
    239|         .set('Cookie', nonMemberCookie);
    240| 
    241|       expect(res.status).toBe(403);
       |                          ^
    242|       expect(res.body.message).toContain('Access denied');
    243|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[60/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should allow owner to view permissions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:252:26
    250|         .set('Cookie', ownerCookie);
    251| 
    252|       expect(res.status).toBe(200);
       |                          ^
    253|       expect(Array.isArray(res.body)).toBe(true);
    254|       expect(res.body.length).toBe(2); // writer and reader

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[61/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should deny writer from viewing permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:262:26
    260|         .set('Cookie', writerCookie);
    261| 
    262|       expect(res.status).toBe(403);
       |                          ^
    263|       expect(res.body.message).toContain('Access denied');
    264|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[62/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > GET /api/datavault/tables/:tableId/permissions > should deny reader from viewing permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:271:26
    269|         .set('Cookie', readerCookie);
    270| 
    271|       expect(res.status).toBe(403);
       |                          ^
    272|       expect(res.body.message).toContain('Access denied');
    273|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[63/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should allow owner to grant permissions
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:283:26
    281|         .send({ userId: nonMemberId, role: 'read' });
    282| 
    283|       expect(res.status).toBe(201);
       |                          ^
    284|       expect(res.body.userId).toBe(nonMemberId);
    285|       expect(res.body.role).toBe('read');

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[64/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should allow owner to update existing permission (upsert)
AssertionError: expected 401 to be 201 // Object.is equality

- Expected
+ Received

- 201
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:301:26
    299|         .send({ userId: readerId, role: 'write' }); // Upgrade reader Î“Ã‡Âª
    300| 
    301|       expect(res.status).toBe(201);
       |                          ^
    302|       expect(res.body.role).toBe('write');
    303| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[65/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should deny writer from granting permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:317:26
    315|         .send({ userId: nonMemberId, role: 'read' });
    316| 
    317|       expect(res.status).toBe(403);
       |                          ^
    318|       expect(res.body.message).toContain('Access denied');
    319|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[66/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > POST /api/datavault/tables/:tableId/permissions > should prevent modifying table owner permissions
AssertionError: expected 401 to be 500 // Object.is equality

- Expected
+ Received

- 500
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:327:26
    325|         .send({ userId: ownerId, role: 'read' });
    326| 
    327|       expect(res.status).toBe(500);
       |                          ^
    328|       expect(res.body.message).toContain('Cannot modify permissions foÎ“Ã‡Âª
    329|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[67/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/permissions/:permissionId > should allow owner to revoke permissions
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:347:26
    345|         .set('Cookie', ownerCookie);
    346| 
    347|       expect(res.status).toBe(200);
       |                          ^
    348|       expect(res.body.success).toBe(true);
    349| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[68/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > DELETE /api/datavault/permissions/:permissionId > should deny writer from revoking permissions
AssertionError: expected 401 to be 403 // Object.is equality

- Expected
+ Received

- 403
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:370:26
    368|         .set('Cookie', writerCookie);
    369| 
    370|       expect(res.status).toBe(403);
       |                          ^
    371|       expect(res.body.message).toContain('Access denied');
    372|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[69/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce owner includes write and read
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:381:30
    379|         .get(`/api/datavault/tables/${tableId}`)
    380|         .set('Cookie', ownerCookie);
    381|       expect(readRes.status).toBe(200);
       |                              ^
    382| 
    383|       // Owner can update table

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[70/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce write includes read but not owner
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:396:30
    394|         .get(`/api/datavault/tables/${tableId}`)
    395|         .set('Cookie', writerCookie);
    396|       expect(readRes.status).toBe(200);
       |                              ^
    397| 
    398|       // Writer cannot update table schema

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[71/301]Î“Ã„Â»

 FAIL  tests/integration/datavault.permissions.test.ts > DataVault Table Permissions API (v4 Micro-Phase 6) > Permission hierarchy > should enforce read is read-only
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/datavault.permissions.test.ts:411:30
    409|         .get(`/api/datavault/tables/${tableId}`)
    410|         .set('Cookie', readerCookie);
    411|       expect(readRes.status).toBe(200);
       |                              ^
    412| 
    413|       // Reader cannot update

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[72/301]Î“Ã„Â»

 FAIL  tests/integration/metrics.test.ts > Metrics Integration > should expose /metrics endpoint
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/metrics.test.ts:33:33
     31|         const response = await request(app).get('/metrics');
     32| 
     33|         expect(response.status).toBe(200);
       |                                 ^
     34|         expect(response.headers['content-type']).toContain('text/plainÎ“Ã‡Âª
     35|         // Prometheus metrics usually contain comments like # HELP or Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[73/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should complete full MFA setup flow
TypeError: Cannot read properties of undefined (reading 'mfaEnabled')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:41:47
     39| 
     40|       const token = (loginResponse.body as any).token;
     41|       expect((loginResponse.body as any).user.mfaEnabled).toBe(false);
       |                                               ^
     42| 
     43|       // Step 2: Setup MFA

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[74/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should reject invalid TOTP code during setup
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:117:37
    115|         .send({ token: "000000" }); // Invalid code
    116| 
    117|       expect(verifyResponse.status).toBe(400);
       |                                     ^
    118|       expect(verifyResponse.body.message).toContain("Invalid");
    119| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[75/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should not allow MFA setup if already enabled
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:135:46
    133|         .send({ email, password });
    134| 
    135|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    136| 
    137|       // Can't test setup with MFA user since we can't login without MÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[76/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should generate unique backup codes
AssertionError: expected +0 to be 10 // Object.is equality

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:156:32
    154|       // All codes should be unique
    155|       const uniqueCodes = new Set(backupCodes);
    156|       expect(uniqueCodes.size).toBe(10);
       |                                ^
    157|     });
    158| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[77/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Setup Flow > should store hashed backup codes
AssertionError: expected [] to have a length of 10 but got +0

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:177:27
    175|       });
    176| 
    177|       expect(storedCodes).toHaveLength(10);
       |                           ^
    178| 
    179|       // Hashes should not match plain codes

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[78/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should require MFA for enabled users
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:195:36
    193|         .send({ email, password });
    194| 
    195|       expect(loginResponse.status).toBe(200);
       |                                    ^
    196|       expect(loginResponse.body.requiresMfa).toBe(true);
    197|       expect(loginResponse.body.userId).toBe(userId);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[79/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should complete MFA login with valid TOTP
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:209:46
    207|         .send({ email, password });
    208| 
    209|       expect(loginResponse.body.requiresMfa).toBe(true);
       |                                              ^
    210| 
    211|       // Step 2: Verify MFA

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[80/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Login Flow > should accept TOTP codes within 60-second window
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:264:32
    262|         .send({ userId, token: totpCode });
    263| 
    264|       expect(response1.status).toBe(200);
       |                                ^
    265| 
    266|       // Login again for second test

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[81/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should login with valid backup code
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:305:52
    303|       });
    304| 
    305|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    306| 
    307|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[82/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should prevent backup code reuse
TypeError: Cannot read properties of undefined (reading 'secret')
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:375:52
    373|       });
    374| 
    375|       const totpCode = generateTotpCode(mfaSecret!.secret);
       |                                                    ^
    376| 
    377|       await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[83/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Flow > should try TOTP before backup code
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:430:31
    428| 
    429|       // Should succeed with TOTP (backup code ignored)
    430|       expect(response.status).toBe(200);
       |                               ^
    431|     });
    432|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[84/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Status > should return backup codes count for MFA users
AssertionError: expected +0 to be 10 // Object.is equality

- Expected
+ Received

- 10
+ 0

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:482:56
    480|       expect(statusResponse.status).toBe(200);
    481|       expect(statusResponse.body.mfaEnabled).toBe(true);
    482|       expect(statusResponse.body.backupCodesRemaining).toBe(10);
       |                                                        ^
    483|     });
    484|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[85/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should disable MFA with password verification
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:510:38
    508|         .send({ password });
    509| 
    510|       expect(disableResponse.status).toBe(200);
       |                                      ^
    511| 
    512|       // Verify MFA is disabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[86/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > MFA Disable Flow > should require correct password to disable MFA
AssertionError: the given combination of arguments (undefined and string) is invalid for this assertion. You can use an array, a map, an object, a set, a string, or a weakset instead of a string
 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:557:44
    555| 
    556|       expect(disableResponse.status).toBe(401);
    557|       expect(disableResponse.body.message).toContain("Invalid passwordÎ“Ã‡Âª
       |                                            ^
    558| 
    559|       // MFA should still be enabled

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[87/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should regenerate backup codes
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:588:41
    586|         .set("Authorization", `Bearer ${token}`);
    587| 
    588|       expect(regenerateResponse.status).toBe(200);
       |                                         ^
    589|       expect(regenerateResponse.body.backupCodes).toHaveLength(10);
    590| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[88/301]Î“Ã„Â»

 FAIL  tests/integration/mfa.flow.real.test.ts > MFA Flow Integration Tests (REAL) > Backup Code Regeneration > should return error if MFA not enabled
AssertionError: expected 401 to be 400 // Object.is equality

- Expected
+ Received

- 400
+ 401

 Î“Â¥Â» tests/integration/mfa.flow.real.test.ts:612:31
    610|         .set("Authorization", `Bearer ${loginResponse.body.token}`);
    611| 
    612|       expect(response.status).toBe(400);
       |                               ^
    613|       expect(response.body.message).toContain("not enabled");
    614|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[89/301]Î“Ã„Â»

 FAIL  tests/integration/organizations-audit-fixes.test.ts > Organization Audit Fixes > FIX #7: Delete organization > should prevent deletion if org owns assets
AssertionError: promise resolved "undefined" instead of rejecting

- Expected: 
Error {
  "message": "rejected promise",
}

+ Received: 
undefined

 Î“Â¥Â» tests/integration/organizations-audit-fixes.test.ts:246:7
    244|       await expect(
    245|         organizationService.deleteOrganization(org.id, user1Id)
    246|       ).rejects.toThrow(/owns workflows/i);
       |       ^
    247| 
    248|       // Cleanup

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[90/301]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 1. Required + Show/Hide (Questions) > should NOT block Next when required question is hidden
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:197:31
    195|             // Check visibility
    196|             const isVisible = evaluateVisibilityExpression("show_triggÎ“Ã‡Âª
    197|             expect(isVisible).toBe(false);
       |                               ^
    198| 
    199|             // Required question is hidden, should not block

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[91/301]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 2. Required + Show/Hide (Pages) > should skip hidden required page entirely
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:330:31
    328|             const isVisible = evaluateVisibilityExpression((section2.vÎ“Ã‡Âª
    329| 
    330|             expect(isVisible).toBe(false); // Section 2 should be hiddÎ“Ã‡Âª
       |                               ^
    331| 
    332|             // Get all sections

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[92/301]Î“Ã„Â»

 FAIL  tests/integration/regression-REG-1.test.ts > REG-1: Workflow Logic Regression > 3. Preview/Snapshot/Live Parity > should evaluate visibility consistently across modes
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/integration/regression-REG-1.test.ts:445:64
    443|             // Change data
    444|             const data2 = { trigger: false, value: 10 };
    445|             expect(evaluateVisibilityExpression(expr1, data2)).toBe(faÎ“Ã‡Âª
       |                                                                ^
    446|             expect(evaluateVisibilityExpression(expr2, data2)).toBe(trÎ“Ã‡Âª
    447|             expect(evaluateVisibilityExpression(expr3, data2)).toBe(faÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[93/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should list all active sessions for current user
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:53:31
     51|         .set("Authorization", `Bearer ${token}`);
     52| 
     53|       expect(response.status).toBe(200);
       |                               ^
     54|       expect(response.body.sessions).toBeDefined();
     55|       expect(response.body.sessions.length).toBe(3);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[94/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should mark current session correctly
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:85:30
     83|       const token = login2.body.token;
     84|       const cookies = (login2.headers as any)["set-cookie"] as string[Î“Ã‡Âª
     85|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
     86| 
     87|       // List sessions with cookie (should identify current session)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[95/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should exclude revoked sessions
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:120:50
    118|         .update(refreshTokens)
    119|         .set({ revoked: true })
    120|         .where(eq(refreshTokens.id, allTokens[0].id));
       |                                                  ^
    121| 
    122|       // List sessions

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[96/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should order sessions by last used (most recent first)
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:154:36
    152| 
    153|       // Should be ordered by lastUsedAt descending
    154|       for (let i = 1; i < sessions.length; i++) {
       |                                    ^
    155|         const prev = new Date(sessions[i - 1].lastUsedAt);
    156|         const curr = new Date(sessions[i].lastUsedAt);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[97/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > GET /api/auth/sessions > should filter sessions by current user only
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:184:37
    182|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    183| 
    184|       expect(response.body.sessions.length).toBe(2);
       |                                     ^
    185|     });
    186| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[98/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should revoke specific session
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:215:40
    213| 
    214|       const sessions = sessionsResponse.body.sessions;
    215|       const sessionToRevoke = sessions.find((s: any) => !s.current);
       |                                        ^
    216| 
    217|       // Revoke non-current session

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[99/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:263:54
    261|       // Try to revoke current session
    262|       const revokeResponse = await request(app)
    263|         .delete(`/api/auth/sessions/${currentSession.id}`)
       |                                                      ^
    264|         .set("Authorization", `Bearer ${token}`);
    265| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[100/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/:sessionId > should prevent revoking other user's session
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:303:49
    301|         .set("Authorization", `Bearer ${user1Login.body.token}`);
    302| 
    303|       const user1SessionId = user1Sessions.body.sessions[0].id;
       |                                                 ^
    304| 
    305|       // Try to revoke user 1's session as user 2

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[101/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all other sessions
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:329:30
    327|       const token = currentLogin.body.token;
    328|       const cookies = (currentLogin.headers as any)["set-cookie"] as sÎ“Ã‡Âª
    329|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    330| 
    331|       // Revoke all except current

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[102/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should keep current session active
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/session.management.real.test.ts:380:38
    378|         .set("Cookie", cookie!);
    379| 
    380|       expect(refreshResponse.status).toBe(200);
       |                                      ^
    381|     });
    382| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[103/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > DELETE /api/auth/sessions/all > should revoke all trusted devices
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:410:30
    408|       const token = login.body.token;
    409|       const cookies = (login.headers as any)["set-cookie"] as string[];
    410|       const cookie = cookies.find((c) => c.startsWith("refresh_token="Î“Ã‡Âª
       |                              ^
    411| 
    412|       // Trust a device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[104/301]Î“Ã„Â»

 FAIL  tests/integration/session.management.real.test.ts > Session Management Integration Tests (REAL) > Session Security > should not expose sensitive token data
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/session.management.real.test.ts:493:37
    491|         .set("Authorization", `Bearer ${login.body.token}`);
    492| 
    493|       const session = response.body.sessions[0];
       |                                     ^
    494| 
    495|       // Should NOT include token hash or metadata

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[105/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should trust current device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:52:36
     50|         .set("X-Forwarded-For", "192.168.1.100");
     51| 
     52|       expect(trustResponse.status).toBe(200);
       |                                    ^
     53|       expect(trustResponse.body.message).toContain("trusted");
     54|       expect(trustResponse.body.trustedUntil).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[106/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should set trust expiry to 30 days
AssertionError: expected NaN to be 30 // Object.is equality

- Expected
+ Received

- 30
+ NaN

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:92:24
     90|       );
     91| 
     92|       expect(diffDays).toBe(30);
       |                        ^
     93|     });
     94| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[107/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > POST /api/auth/trust-device > should update expiry if device already trusted
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:132:42
    130| 
    131|       // Should have extended expiry
    132|       expect(secondExpiry > firstExpiry).toBe(true);
       |                                          ^
    133| 
    134|       // Should still only have 1 device record

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[108/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should list all trusted devices
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:193:31
    191|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    192| 
    193|       expect(response.status).toBe(200);
       |                               ^
    194|       expect(response.body.devices).toBeDefined();
    195|       expect(response.body.devices.length).toBe(2);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[109/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should mark current device
TypeError: Cannot read properties of undefined (reading 'find')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:236:51
    234|         .set("X-Forwarded-For", "192.168.1.100");
    235| 
    236|       const currentDevice = response.body.devices.find((d: any) => d.cÎ“Ã‡Âª
       |                                                   ^
    237|       expect(currentDevice).toBeDefined();
    238|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[110/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude revoked devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:269:36
    267|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    268| 
    269|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    270|     });
    271| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[111/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > GET /api/auth/trusted-devices > should exclude expired devices
TypeError: Cannot read properties of undefined (reading 'length')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:302:36
    300|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    301| 
    302|       expect(response.body.devices.length).toBe(0);
       |                                    ^
    303|     });
    304|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[112/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should revoke specific device
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:332:45
    330|         .set("Authorization", `Bearer ${token}`);
    331| 
    332|       const deviceId = devicesResponse.body.devices[0].id;
       |                                             ^
    333| 
    334|       // Revoke device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[113/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should return 404 for non-existent device
AssertionError: expected 401 to be 404 // Object.is equality

- Expected
+ Received

- 404
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:371:31
    369|         .set("Authorization", `Bearer ${mfaLoginResponse.body.token}`);
    370| 
    371|       expect(response.status).toBe(404);
       |                               ^
    372|     });
    373| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[114/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > DELETE /api/auth/trusted-devices/:deviceId > should prevent revoking other user's device
TypeError: Cannot read properties of undefined (reading '0')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:399:43
    397|         .set("Authorization", `Bearer ${mfaLogin1.body.token}`);
    398| 
    399|       const user1DeviceId = devices1.body.devices[0].id;
       |                                           ^
    400| 
    401|       // User 2 tries to revoke user 1's device

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[115/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should skip MFA for trusted device
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:453:42
    451| 
    452|       // Should not require MFA
    453|       expect(secondLoginResponse.status).toBe(200);
       |                                          ^
    454|       expect(secondLoginResponse.body.requiresMfa).toBeUndefined();
    455|       expect(secondLoginResponse.body.token).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[116/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should require MFA for untrusted device
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:485:51
    483| 
    484|       // Should require MFA
    485|       expect(loginFromNewDevice.body.requiresMfa).toBe(true);
       |                                                   ^
    486|     });
    487| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[117/301]Î“Ã„Â»

 FAIL  tests/integration/trusted.devices.real.test.ts > Trusted Devices Integration Tests (REAL) > Device Trust with MFA Login > should update lastUsedAt on trusted device login
TypeError: Cannot read properties of undefined (reading 'lastUsedAt')
 Î“Â¥Â» tests/integration/trusted.devices.real.test.ts:512:38
    510|       });
    511| 
    512|       const firstLastUsed = device1!.lastUsedAt;
       |                                      ^
    513| 
    514|       // Wait a bit

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[118/301]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should create a version and populate changelog
Error: Validation failed: Schema Error: id - Required, Schema Error: title - Required, Schema Error: pages.0.title - Required, Schema Error: pages.0.order - Required
 Î“Â¥Â» VersionService.publishVersion server/services/VersionService.ts:287:13
    285| 
    286|     if (!validation.valid && !force) {
    287|       throw new Error(`Validation failed: ${validation.errors.join(', Î“Ã‡Âª
       |             ^
    288|     }
    289| 
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:97:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[119/301]Î“Ã„Â»

 FAIL  tests/integration/workflow_versioning.test.ts > Workflow Versioning & Lineage > should track execution lineage via snapshot
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/workflow_versioning.test.ts:117:143
    115| 
    116|         // Create Snapshot
    117|         const snapshot = await snapshotService.createSnapshot(workflowÎ“Ã‡Âª
       |                                                                                                                                               ^
    118| 
    119|         expect(snapshot.workflowVersionId).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[120/301]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should validate expression after debounce
AssertionError: expected false to be true // Object.is equality

- Expected
+ Received

- true
+ false

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:68:43
     66| 
     67|       // Should be validating immediately
     68|       expect(result.current.isValidating).toBe(true);
       |                                           ^
     69| 
     70|       // Wait for debounce and validation

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[121/301]Î“Ã„Â»

 FAIL  tests/ui/expression-editor.test.tsx > Expression Editor Hooks > useExpressionValidation > should return validation errors for invalid expression
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/ui/expression-editor.test.tsx:114:38
    112|       );
    113| 
    114|       expect(result.current.isValid).toBe(false);
       |                                      ^
    115|       expect(result.current.errors.length).toBeGreaterThan(0);
    116|       expect(result.current.errors[0].message).toContain('unknown_var'Î“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[122/301]Î“Ã„Â»

 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render runs table with correct columns
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should render run data correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show success badge for successful runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show error badge for failed runs
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should format duration correctly
 FAIL  tests/ui/runs.components.test.tsx > Stage 8: Runs UI Components > RunsTable > should show download options for successful runs
ReferenceError: React is not defined
 Î“Â¥Â» RunsTable client/src/components/runs/RunsTable.tsx:41:3
     39|   };
     40| 
     41|   return (
       |   ^
     42|     <div className="rounded-md border">
     43|       <Table>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[123/301]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should generate a valid workflow from description
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.generateWorkflow server/services/AIService.ts:127:20
 Î“Â¥Â» tests/unit/ai.service.test.ts:86:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[124/301]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate unique section IDs
AssertionError: expected [Function] to throw error including 'Duplicate section IDs' but got 'AI response does not match expected sÎ“Ã‡Âª'

- Expected
+ Received

- Duplicate section IDs
+ AI response does not match expected schema
+
+ â‰¡Æ’Ã¶Âº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Î“Â¥Â» tests/unit/ai.service.test.ts:136:7
    134|       } as any;
    135| 
    136|       await expect(
       |       ^
    137|         openaiService.generateWorkflow({
    138|           description: 'Test',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[125/301]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate unique step IDs
AssertionError: expected [Function] to throw error including 'Duplicate step ID' but got 'AI response does not match expected sÎ“Ã‡Âª'

- Expected
+ Received

- Duplicate step ID
+ AI response does not match expected schema
+
+ â‰¡Æ’Ã¶Âº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Î“Â¥Â» tests/unit/ai.service.test.ts:190:7
    188|       } as any;
    189| 
    190|       await expect(
       |       ^
    191|         openaiService.generateWorkflow({
    192|           description: 'Test',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[126/301]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should validate logic rules reference existing steps
AssertionError: expected [Function] to throw error including 'references non-existent step alias' but got 'AI response does not match expected sÎ“Ã‡Âª'

- Expected
+ Received

- references non-existent step alias
+ AI response does not match expected schema
+
+ â‰¡Æ’Ã¶Âº Troubleshooting Steps:
+ 1. The AI response structure doesn't match our expected format
+ 2. This may indicate:
+    - A breaking change in the AI model behavior
+    - The model is struggling with the complexity of the request
+ 3. Try simplifying your workflow or request
+ 4. If this persists, please report this issue with the workflow details

 Î“Â¥Â» tests/unit/ai.service.test.ts:248:7
    246|       } as any;
    247| 
    248|       await expect(
       |       ^
    249|         openaiService.generateWorkflow({
    250|           description: 'Test',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[127/301]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > OpenAI Provider > should handle rate limit errors
Error: Test timed out in 30000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 Î“Â¥Â» tests/unit/ai.service.test.ts:256:5
    254|     });
    255| 
    256|     it('should handle rate limit errors', async () => {
       |     ^
    257|       const rateLimitError = new Error('Rate limit exceeded');
    258|       // @ts-ignore

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[128/301]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > Anthropic Provider > should generate a valid workflow from description
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.generateWorkflow server/services/AIService.ts:127:20
 Î“Â¥Â» tests/unit/ai.service.test.ts:369:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[129/301]Î“Ã„Â»

 FAIL  tests/unit/ai.service.test.ts > AIService > Anthropic Provider > should strip markdown code blocks from Anthropic responses
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.generateWorkflow server/services/AIService.ts:127:20
 Î“Â¥Â» tests/unit/ai.service.test.ts:409:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[130/301]Î“Ã„Â»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/generate-logic > should return generated logic
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Î“Â¥Â» tests/unit/api.ai.logic.test.ts:89:32
     87|                 if (!res.body || Object.keys(res.body).length === 0) cÎ“Ã‡Âª
     88|             }
     89|             expect(res.status).toBe(200);
       |                                ^
     90|             expect(res.body.success).toBe(true);
     91|             expect(mockGenerateLogic).toHaveBeenCalled();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[131/301]Î“Ã„Â»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/debug-logic > should return debug issues
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Î“Â¥Â» tests/unit/api.ai.logic.test.ts:110:32
    108|                 });
    109| 
    110|             expect(res.status).toBe(200);
       |                                ^
    111|             expect(res.body.success).toBe(true);
    112|             expect(res.body.issues).toHaveLength(1);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[132/301]Î“Ã„Â»

 FAIL  tests/unit/api.ai.logic.test.ts > AI Logic Routes > POST /api/ai/workflows/visualize-logic > should return graph data
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Î“Â¥Â» tests/unit/api.ai.logic.test.ts:129:32
    127|                 });
    128| 
    129|             expect(res.status).toBe(200);
       |                                ^
    130|             expect(res.body.graph.nodes).toHaveLength(1);
    131|         });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[133/301]Î“Ã„Â»

 FAIL  tests/unit/api.ai.revise.test.ts > AI Routes Integration > POST /api/ai/workflows/revise > should call AIService.reviseWorkflow with correct parameters
AssertionError: expected 400 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 400

 Î“Â¥Â» tests/unit/api.ai.revise.test.ts:89:32
     87|                 if (!res.body || Object.keys(res.body).length === 0) cÎ“Ã‡Âª
     88|             }
     89|             expect(res.status).toBe(200);
       |                                ^
     90|             expect(mockReviseWorkflow).toHaveBeenCalledTimes(1);
     91| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[134/301]Î“Ã„Â»

 FAIL  tests/unit/isolatedVmBridge.test.ts > isolated-vm Bridge Verification > should execute JS and capture console logs
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/unit/isolatedVmBridge.test.ts:86:36
     84| 
     85|         expect(result.ok).toBe(true);
     86|         expect(result.consoleLogs).toBeDefined();
       |                                    ^
     87|         // @ts-ignore
     88|         expect(result.consoleLogs[0]).toEqual(["hello log"]);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[135/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should allow access with valid JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 when no token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 with expired token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should extract token without Bearer prefix
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalAuth Middleware > should proceed without authentication if no token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalAuth Middleware > should attach user context if valid token provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with JWT Bearer token
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should authenticate with refresh token cookie (GET only)
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for PUT requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should reject cookie auth for DELETE requests
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should return 401 when no auth provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should authenticate with JWT if provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should proceed anonymously if no auth provided
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Cookie Strategy Security > should ignore cookies when Bearer token present
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach userId to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach userEmail to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should attach tenantId to request
 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > User Context Attachment > should lookup tenantId from database if missing from token
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:70:14
     68|                 password: testUser.password,
     69|             })
     70|             .expect(200);
       |              ^
     71| 
     72|         userToken = loginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[136/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > requireAuth Middleware > should return 401 with invalid token
AssertionError: expected { code: 'AUTH_008', Î“Ã‡Âª(3) } to be 'invalid_token' // Object.is equality

- Expected: 
"invalid_token"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T21:10:46.620Z",
}

 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:100:36
     98|                 .expect(401);
     99| 
    100|             expect(res.body.error).toBe("invalid_token");
       |                                    ^
    101|         });
    102| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[137/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalAuth Middleware > should proceed without auth if invalid token provided
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:189:18
    187|                 .get(`/api/workflows/${workflowRes.body.id}/public`)
    188|                 .set("Authorization", "Bearer invalid-token")
    189|                 .expect(200);
       |                  ^
    190|         });
    191|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[138/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > hybridAuth Middleware > should prioritize JWT over cookie when both present
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:268:18
    266|                     password: user2.password,
    267|                 })
    268|                 .expect(200);
       |                  ^
    269| 
    270|             // Use user1's cookie with user2's Bearer token
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[139/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should authenticate with cookie if JWT not provided
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:328:18
    326|                 .get(`/api/workflows/${workflowRes.body.id}/public`)
    327|                 .set("Cookie", refreshCookie)
    328|                 .expect(200);
       |                  ^
    329|         });
    330| 
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[140/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > optionalHybridAuth Middleware > should proceed anonymously if both JWT and cookie are invalid
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:360:18
    358|                 .set("Authorization", "Bearer invalid-token")
    359|                 .set("Cookie", ["refresh_token=invalid-cookie"])
    360|                 .expect(200);
       |                  ^
    361|         });
    362|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[141/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Cookie Strategy Security > should only allow safe methods for cookie auth
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:370:18
    368|                 .get("/api/auth/me")
    369|                 .set("Cookie", refreshCookie)
    370|                 .expect(200);
       |                  ^
    371| 
    372|             // POST should fail
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[142/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for missing token
AssertionError: expected { success: false, error: { Î“Ã‡Âª(4) } } to have property "message"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:524:30
    522|                 .expect(401);
    523| 
    524|             expect(res.body).toHaveProperty("message");
       |                              ^
    525|             expect(res.body).toHaveProperty("error");
    526|             expect(res.body.error).toBe("unauthorized");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[143/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for invalid token
AssertionError: expected { success: false, error: { Î“Ã‡Âª(4) } } to have property "message"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:535:30
    533|                 .expect(401);
    534| 
    535|             expect(res.body).toHaveProperty("message");
       |                              ^
    536|             expect(res.body).toHaveProperty("error");
    537|             expect(res.body.error).toBe("invalid_token");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[144/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should return consistent error format for expired token
AssertionError: expected { success: false, error: { Î“Ã‡Âª(4) } } to have property "message"
 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:560:30
    558|                 .expect(401);
    559| 
    560|             expect(res.body).toHaveProperty("message");
       |                              ^
    561|             expect(res.body).toHaveProperty("error");
    562|             expect(res.body.error).toBe("token_expired");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[145/301]Î“Ã„Â»

 FAIL  tests/integration/auth/auth.middleware.integration.test.ts > Auth Middleware Integration Tests > Error Handling > should handle JWT with wrong algorithm
AssertionError: expected { code: 'AUTH_008', Î“Ã‡Âª(3) } to be 'invalid_token' // Object.is equality

- Expected: 
"invalid_token"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T21:11:24.121Z",
}

 Î“Â¥Â» tests/integration/auth/auth.middleware.integration.test.ts:592:36
    590|                 .expect(401);
    591| 
    592|             expect(res.body.error).toBe("invalid_token");
       |                                    ^
    593|         });
    594|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[146/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should generate valid JWT token on successful login
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:54:18
     52|                 .post("/api/auth/register")
     53|                 .send(testUser)
     54|                 .expect(201);
       |                  ^
     55| 
     56|             // Verify email
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[147/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should include correct payload in JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:90:18
     88|                 .post("/api/auth/register")
     89|                 .send(testUser)
     90|                 .expect(201);
       |                  ^
     91| 
     92|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[148/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Generation > should set JWT expiry to 15 minutes
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:122:18
    120|                 .post("/api/auth/register")
    121|                 .send(testUser)
    122|                 .expect(201);
       |                  ^
    123| 
    124|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[149/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should accept valid JWT token on protected routes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:153:18
    151|                     password: testUser.password,
    152|                 })
    153|                 .expect(200);
       |                  ^
    154| 
    155|             const meRes = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[150/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Validation > should reject request with missing Bearer prefix
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:183:18
    181|                     password: testUser.password,
    182|                 })
    183|                 .expect(200);
       |                  ^
    184| 
    185|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[151/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > JWT Token Expiration > should return token_expired error code for expired tokens
AssertionError: expected { code: 'AUTH_008', Î“Ã‡Âª(3) } to be 'token_expired' // Object.is equality

- Expected: 
"token_expired"

+ Received: 
{
  "code": "AUTH_008",
  "details": {
    "errorType": "UnauthorizedError",
  },
  "message": "Authentication required",
  "timestamp": "2026-01-07T21:10:51.634Z",
}

 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:237:36
    235|                 .expect(401);
    236| 
    237|             expect(res.body.error).toBe("token_expired");
       |                                    ^
    238|         });
    239|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[152/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on PUT requests
Error: expected 200 "OK", got 404 "Not Found"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:268:18
    266|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    267|                 .send({ firstName: "Updated" })
    268|                 .expect(200);
       |                  ^
    269| 
    270|             expect(updateRes.body).toBeDefined();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[153/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Bearer Token Authentication > should work with Bearer token on DELETE requests
Error: expected 200 "OK", got 204 "No Content"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:285:18
    283|                 .delete(`/api/projects/${projectRes.body.id}`)
    284|                 .set("Authorization", `Bearer ${ctx.authToken}`)
    285|                 .expect(200);
       |                  ^
    286|         });
    287|     });
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:847:12
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/index.js:1102:18

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[154/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Cookie-to-Token Exchange > should exchange valid session cookie for JWT token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:295:18
    293|                 .post("/api/auth/register")
    294|                 .send(testUser)
    295|                 .expect(201);
       |                  ^
    296| 
    297|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[155/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should prefer Bearer token over cookie when both present
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:330:18
    328|                     email: `user1-${nanoid()}@example.com`,
    329|                 })
    330|                 .expect(201);
       |                  ^
    331| 
    332|             const user2Res = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[156/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should fall back to cookie if Bearer token is invalid
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:358:18
    356|                 .post("/api/auth/register")
    357|                 .send(testUser)
    358|                 .expect(201);
       |                  ^
    359| 
    360|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[157/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should allow GET requests with cookie auth only
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:377:18
    375|                 .post("/api/auth/register")
    376|                 .send(testUser)
    377|                 .expect(201);
       |                  ^
    378| 
    379|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[158/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Hybrid Authentication Strategy > should reject POST requests with cookie auth only (mutation-strict)
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:406:18
    404|                 .post("/api/auth/register")
    405|                 .send(testUser)
    406|                 .expect(201);
       |                  ^
    407| 
    408|             const cookies = registerRes.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[159/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should allow anonymous access to public workflows
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:432:18
    430|                     publicLink: `public-${nanoid()}`,
    431|                 })
    432|                 .expect(201);
       |                  ^
    433| 
    434|             // Access without authentication
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[160/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Optional Authentication > should attach user info if authenticated on optional auth routes
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:451:18
    449|                     publicLink: `optional-${nanoid()}`,
    450|                 })
    451|                 .expect(201);
       |                  ^
    452| 
    453|             // Access with authentication
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[161/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should refresh access token using refresh token
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:469:18
    467|                 .post("/api/auth/register")
    468|                 .send(testUser)
    469|                 .expect(201);
       |                  ^
    470| 
    471|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[162/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should rotate refresh token on use
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:503:18
    501|                 .post("/api/auth/register")
    502|                 .send(testUser)
    503|                 .expect(201);
       |                  ^
    504| 
    505|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[163/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Token Refresh Flow > should detect token reuse and revoke all user tokens
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:544:18
    542|                 .post("/api/auth/register")
    543|                 .send(testUser)
    544|                 .expect(201);
       |                  ^
    545| 
    546|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[164/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should revoke refresh token on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:595:18
    593|                 .post("/api/auth/register")
    594|                 .send(testUser)
    595|                 .expect(201);
       |                  ^
    596| 
    597|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[165/301]Î“Ã„Â»

 FAIL  tests/integration/auth/jwt.authentication.test.ts > JWT Authentication Integration Tests > Logout Flow > should clear refresh token cookie on logout
Error: expected 201 "Created", got 400 "Bad Request"
 Î“Â¥Â» tests/integration/auth/jwt.authentication.test.ts:628:18
    626|                 .post("/api/auth/register")
    627|                 .send(testUser)
    628|                 .expect(201);
       |                  ^
    629| 
    630|             await db.update(db.query.users as any)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[166/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.google.test.ts > OAuth2 Google Authentication Flow > POST /api/auth/google - Google OAuth2 Login > should successfully authenticate with valid Google ID token
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.google.test.ts:88:31
     86| 
     87|       // Verify response
     88|       expect(response.status).toBe(200);
       |                               ^
     89|       expect(response.body).toMatchObject({
     90|         message: 'Authentication successful',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[167/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should revoke a specific session
AssertionError: expected undefined to be defined
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:210:29
    208|       });
    209| 
    210|       expect(sessionRecord).toBeDefined();
       |                             ^
    211| 
    212|       const response = await request(app)

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[168/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should prevent revoking current session
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:243:54
    241| 
    242|       const response = await request(app)
    243|         .delete(`/api/auth/sessions/${sessionRecord!.id}`)
       |                                                      ^
    244|         .set('Authorization', `Bearer ${authToken}`)
    245|         .set('Cookie', `refresh_token=${token}`);

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[169/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/:sessionId - Revoke Session > should prevent revoking another user's session
TypeError: Cannot read properties of undefined (reading 'id')
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:275:53
    273|       // Try to revoke other user's session
    274|       const response = await request(app)
    275|         .delete(`/api/auth/sessions/${otherSession!.id}`)
       |                                                     ^
    276|         .set('Authorization', `Bearer ${authToken}`);
    277| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[170/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > DELETE /api/auth/sessions/all - Logout All Other Devices > should revoke all sessions except current
AssertionError: expected +0 to be 1 // Object.is equality

- Expected
+ Received

- 1
+ 0

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:316:37
    314|         ));
    315| 
    316|       expect(activeSessions.length).toBe(1);
       |                                     ^
    317|       expect(activeSessions[0].token).toBe(currentToken);
    318|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[171/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > POST /api/auth/trust-device > should mark current device as trusted
AssertionError: expected 0 to be greater than 0
 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:395:32
    393|           .where(eq(trustedDevices.userId, testUserId));
    394| 
    395|         expect(devices.length).toBeGreaterThan(0);
       |                                ^
    396|       });
    397| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[172/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Trusted Devices Management > DELETE /api/auth/trusted-devices/:deviceId > should revoke a trusted device
AssertionError: expected 404 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 404

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:505:33
    503|           .set('Authorization', `Bearer ${authToken}`);
    504| 
    505|         expect(response.status).toBe(200);
       |                                 ^
    506|         expect(response.body.message).toBe('Device revoked successfullÎ“Ã‡Âª
    507| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[173/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should track IP address for sessions
AssertionError: expected undefined to be '192.168.1.100' // Object.is equality

- Expected: 
"192.168.1.100"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:535:34
    533|       });
    534| 
    535|       expect(session?.ipAddress).toBe('192.168.1.100');
       |                                  ^
    536|     });
    537| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[174/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.sessions.test.ts > OAuth2 Session Management > Session Metadata Tracking > should track user agent for sessions
AssertionError: expected undefined to be 'Mozilla/5.0 (Windows NT 10.0; Win64; Î“Ã‡Âª' // Object.is equality

- Expected: 
"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.sessions.test.ts:549:35
    547| 
    548|       const metadata = session?.metadata as any;
    549|       expect(metadata?.userAgent).toBe(userAgent);
       |                                   ^
    550|     });
    551| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[175/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should refresh access token with valid refresh token
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:87:31
     85|         .set('Cookie', `refresh_token=${testRefreshToken}`);
     86| 
     87|       expect(response.status).toBe(200);
       |                               ^
     88|       expect(response.body).toMatchObject({
     89|         token: expect.any(String),

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[176/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should rotate refresh token after use
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:126:33
    124|         where: eq(refreshTokens.token, testRefreshToken),
    125|       });
    126|       expect(oldToken?.revoked).toBe(true);
       |                                 ^
    127| 
    128|       // New token should exist and not be revoked

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[177/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should return 401 when user is not found
AssertionError: expected 'Invalid refresh token' to be 'User not found' // Object.is equality

Expected: "User not found"
Received: "Invalid refresh token"

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:206:37
    204| 
    205|       expect(response.status).toBe(401);
    206|       expect(response.body.message).toBe('User not found');
       |                                     ^
    207|     });
    208| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[178/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should set proper cookie attributes
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:274:31
    272|         .set('Cookie', `refresh_token=${testRefreshToken}`);
    273| 
    274|       expect(response.status).toBe(200);
       |                               ^
    275| 
    276|       const setCookieHeader = response.headers['set-cookie']?.[0];

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[179/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > POST /api/auth/refresh-token > should include user role information in response
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:289:31
    287|         .set('Cookie', `refresh_token=${testRefreshToken}`);
    288| 
    289|       expect(response.status).toBe(200);
       |                               ^
    290|       expect(response.body.user).toMatchObject({
    291|         id: testUserId,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[180/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Lifecycle > should revoke refresh token on logout
AssertionError: expected undefined to be true // Object.is equality

- Expected: 
true

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:333:30
    331|         where: eq(refreshTokens.token, testRefreshToken),
    332|       });
    333|       expect(token?.revoked).toBe(true);
       |                              ^
    334| 
    335|       // Verify cookie is cleared

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[181/301]Î“Ã„Â»

 FAIL  tests/integration/auth/oauth2.token-refresh.test.ts > OAuth2 Token Refresh Flow > Refresh Token Security > should validate token ownership
AssertionError: expected undefined to be 'W2aX-Y9vfh5wlKy-XJaZ8' // Object.is equality

- Expected: 
"W2aX-Y9vfh5wlKy-XJaZ8"

+ Received: 
undefined

 Î“Â¥Â» tests/integration/auth/oauth2.token-refresh.test.ts:465:29
    463|       });
    464| 
    465|       expect(token?.userId).toBe(testUserId);
       |                             ^
    466|       expect(token?.userId).not.toBe(otherUser.id);
    467|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[182/301]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should allow access with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with empty Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with malformed Authorization header
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > GET Protected Routes > should reject access with wrong token type
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should allow POST with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > POST Protected Routes > should reject POST with invalid token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should allow PUT with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PUT Protected Routes > should reject PUT without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > DELETE Protected Routes > should allow DELETE with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > DELETE Protected Routes > should reject DELETE without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PATCH Protected Routes > should allow PATCH with valid Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > PATCH Protected Routes > should reject PATCH without Bearer token
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle token with newlines
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should handle Authorization header with only Bearer
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should reject token with SQL injection attempt
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Edge Cases > should reject token with XSS attempt
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Token Payload Validation > should reject token with missing userId
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > User Context Injection > should inject userId into request context
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Rate Limiting on Protected Routes > should not apply general rate limiting to authenticated requests
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Mixed Auth Scenarios > should handle request with both Bearer token and cookies
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Mixed Auth Scenarios > should prioritize Bearer token over cookie when both present
 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Optional Auth Routes > should enhance optional auth routes with user context when authenticated
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:66:14
     64|                 password: testUser.password,
     65|             })
     66|             .expect(200);
       |              ^
     67| 
     68|         userToken = loginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[183/301]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Cross-User Authorization > should not allow user to access another user's resources
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:323:18
    321|                     password: user2.password,
    322|                 })
    323|                 .expect(200);
       |                  ^
    324| 
    325|             const user2Token = user2LoginRes.body.token;
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[184/301]Î“Ã„Â»

 FAIL  tests/integration/auth/protected.routes.test.ts > Protected Routes Integration Tests > Optional Auth Routes > should allow unauthenticated access to optional auth routes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/protected.routes.test.ts:475:18
    473|             await request(ctx.baseURL)
    474|                 .get(`/api/workflows/${workflowRes.body.id}/public`)
    475|                 .expect(200);
       |                  ^
    476|         });
    477| 
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[185/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create refresh token on login
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:74:18
     72|                     password: testUser.password,
     73|                 })
     74|                 .expect(200);
       |                  ^
     75| 
     76|             expect(loginRes.headers['set-cookie']).toBeDefined();
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[186/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should track device metadata in session
AssertionError: expected 0 to be greater than 0
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:106:35
    104|             });
    105| 
    106|             expect(tokens.length).toBeGreaterThan(0);
       |                                   ^
    107|             expect(tokens[0].deviceName).toBeDefined();
    108|             expect(tokens[0].ipAddress).toBeDefined();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[187/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Creation and Tracking > should create separate sessions for multiple device logins
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:120:18
    118|                     password: testUser.password,
    119|                 })
    120|                 .expect(200);
       |                  ^
    121| 
    122|             // Login from device 2
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[188/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should list all active sessions for user
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:163:18
    161|                     password: testUser.password,
    162|                 })
    163|                 .expect(200);
       |                  ^
    164| 
    165|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[189/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should mark current session correctly
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:208:18
    206|                     password: testUser.password,
    207|                 })
    208|                 .expect(200);
       |                  ^
    209| 
    210|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[190/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should not include revoked sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:237:18
    235|                     password: testUser.password,
    236|                 })
    237|                 .expect(200);
       |                  ^
    238| 
    239|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[191/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > GET /api/auth/sessions > should order sessions by last used (most recent first)
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:282:18
    280|                     password: testUser.password,
    281|                 })
    282|                 .expect(200);
       |                  ^
    283| 
    284|             await new Promise(resolve => setTimeout(resolve, 100));
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[192/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should revoke specific session
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:332:18
    330|                     password: testUser.password,
    331|                 })
    332|                 .expect(200);
       |                  ^
    333| 
    334|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[193/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should prevent revoking current session
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:373:18
    371|                     password: testUser.password,
    372|                 })
    373|                 .expect(200);
       |                  ^
    374| 
    375|             const sessionsRes = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[194/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should not allow revoking other users sessions
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:417:18
    415|                     password: user2.password,
    416|                 })
    417|                 .expect(200);
       |                  ^
    418| 
    419|             // User1 tries to get user2's sessions
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[195/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/:sessionId > should return 404 for non-existent session ID
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:452:18
    450|                     password: testUser.password,
    451|                 })
    452|                 .expect(200);
       |                  ^
    453| 
    454|             await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[196/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > DELETE /api/auth/sessions/all > should revoke all sessions except current
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:471:18
    469|                     password: testUser.password,
    470|                 })
    471|                 .expect(200);
       |                  ^
    472| 
    473|             const session2 = await request(ctx.baseURL)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[197/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Session Expiration > should reject refresh token after 30 days
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:564:18
    562|                     password: testUser.password,
    563|                 })
    564|                 .expect(200);
       |                  ^
    565| 
    566|             // Get the refresh token from database (non-revoked only)
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[198/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Concurrent Session Handling > should handle multiple concurrent logins
AssertionError: expected 401 to be 200 // Object.is equality

- Expected
+ Received

- 200
+ 401

 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:610:36
    608| 
    609|             logins.forEach(res => {
    610|                 expect(res.status).toBe(200);
       |                                    ^
    611|                 expect(res.body.token).toBeDefined();
    612|             });
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:609:20

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[199/301]Î“Ã„Â»

 FAIL  tests/integration/auth/session.management.integration.test.ts > Session Management Integration Tests > Concurrent Session Handling > should handle concurrent token refreshes
Error: expected 200 "OK", got 401 "Unauthorized"
 Î“Â¥Â» tests/integration/auth/session.management.integration.test.ts:631:18
    629|                     password: testUser.password,
    630|                 })
    631|                 .expect(200);
       |                  ^
    632| 
    633|             const cookies = session.headers['set-cookie'];
 Î“Â¥Â» Test._assertStatus node_modules/supertest/lib/test.js:309:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:365:13
 Î“Â¥Â» Test._assertFunction node_modules/supertest/lib/test.js:342:13
 Î“Â¥Â» Test.assert node_modules/supertest/lib/test.js:195:23
 Î“Â¥Â» localAssert node_modules/supertest/lib/test.js:138:14
 Î“Â¥Â» node_modules/supertest/lib/test.js:156:7
 Î“Â¥Â» Test.Request.callback node_modules/superagent/lib/node/index.js:857:3
 Î“Â¥Â» node_modules/superagent/lib/node/index.js:1102:18
 Î“Â¥Â» IncomingMessage.<anonymous> node_modules/superagent/lib/node/parsers/json.js:21:7

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[200/301]Î“Ã„Â»

 FAIL  tests/ui/common/Breadcrumbs.test.tsx > Breadcrumbs Component > should apply font-medium to last item
Error: expect(element).toHaveClass("font-medium")

Expected the element to have class:
  font-medium
Received:

 Î“Â¥Â» tests/ui/common/Breadcrumbs.test.tsx:101:38
     99| 
    100|     const lastItem = screen.getByText('Test Database');
    101|     expect(lastItem.closest('span')).toHaveClass('font-medium');
       |                                      ^
    102|   });
    103| });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[201/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render database settings page with breadcrumbs
 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render DatabaseSettings component with database data
 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should display database name in header
 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should render sidebar
ReferenceError: React is not defined
 Î“Â¥Â» DatabaseSettingsPage client/src/pages/datavault/DatabaseSettingsPage.tsx:56:3
     54|   }
     55| 
     56|   return (
       |   ^
     57|     <div className="flex h-screen bg-background overflow-hidden">
     58|       <Sidebar />
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[202/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should show loading state
Error: Cannot find module '@/lib/datavault-hooks'
Require stack:
- C:\Users\scoot\poll\VaultLogic\tests\ui\datavault\DatabaseSettingsPage.test.tsx
 Î“Â¥Â» tests/ui/datavault/DatabaseSettingsPage.test.tsx:83:38
     81| 
     82|   it('should show loading state', () => {
     83|     const { useDatavaultDatabase } = require('@/lib/datavault-hooks');
       |                                      ^
     84|     useDatavaultDatabase.mockReturnValue({
     85|       data: null,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[203/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should show not found state when database does not exist
Error: Cannot find module '@/lib/datavault-hooks'
Require stack:
- C:\Users\scoot\poll\VaultLogic\tests\ui\datavault\DatabaseSettingsPage.test.tsx
 Î“Â¥Â» tests/ui/datavault/DatabaseSettingsPage.test.tsx:95:38
     93| 
     94|   it('should show not found state when database does not exist', () =>Î“Ã‡Âª
     95|     const { useDatavaultDatabase } = require('@/lib/datavault-hooks');
       |                                      ^
     96|     useDatavaultDatabase.mockReturnValue({
     97|       data: null,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[204/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/DatabaseSettingsPage.test.tsx > DatabaseSettingsPage > should navigate back when back button is clicked
TypeError: useLocation.mockReturnValue is not a function
 Î“Â¥Â» tests/ui/datavault/DatabaseSettingsPage.test.tsx:120:17
    118|     const mockSetLocation = vi.fn();
    119|     const { useLocation } = require('wouter');
    120|     useLocation.mockReturnValue(['/datavault/databases/db-1/settings',Î“Ã‡Âª
       |                 ^
    121| 
    122|     renderPage();

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[205/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Boolean Type (Checkbox) > shows loading spinner when saving checkbox
Error: expect(received).toBeInTheDocument()

received value must be an HTMLElement or an SVGElement.
Received has type:  Null
Received has value: null

Ignored nodes: comments, script, style
<html>
  <head />
  <body>
    <div>
      <div
        aria-label="Is Active: No"
        class="px-3 py-2 min-h-[40px] flex items-center gap-2 cursor-pointer hover:bg-accent/50"
        role="gridcell"
      >
        <button
          aria-checked="false"
          aria-label="Is Active"
          class="peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground"
          data-state="unchecked"
          role="checkbox"
          type="button"
          value="on"
        />
      </div>
    </div>
  </body>
</html>
 Î“Â¥Â» tests/ui/datavault/EditableCell.test.tsx:279:77
    277| 
    278|       await waitFor(() => {
    279|         expect(screen.getByRole('gridcell').querySelector('.animate-spÎ“Ã‡Âª
       |                                                                             ^
    280|       });
    281| 
 Î“Â¥Â» runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:47:12
 Î“Â¥Â» checkCallback node_modules/@testing-library/dom/dist/wait-for.js:124:77
 Î“Â¥Â» Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:118:16

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[206/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Value Formatting > formats date values for display
AssertionError: expected '1/14/2000' to contain '1/15/2000'

Expected: "1/15/2000"
Received: "1/14/2000"

 Î“Â¥Â» tests/ui/datavault/EditableCell.test.tsx:334:32
    332| 
    333|       const cell = screen.getByRole('gridcell');
    334|       expect(cell.textContent).toContain('1/15/2000');
       |                                ^
    335|     });
    336| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[207/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/EditableCell.test.tsx > EditableCell Component > Value Formatting > formats boolean values as Yes/No
Error: expect(element).toHaveAttribute("aria-label", "Verified: Yes") // element.getAttribute("aria-label") === "Verified: Yes"

Expected the element to have attribute:
  aria-label="Verified: Yes"
Received:
  aria-label="Verified: true"
 Î“Â¥Â» tests/ui/datavault/EditableCell.test.tsx:342:20
    340| 
    341|       const cell = screen.getByRole('gridcell');
    342|       expect(cell).toHaveAttribute('aria-label', 'Verified: Yes');
       |                    ^
    343|     });
    344| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[208/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table name and description
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render table slug
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should render column and row counts
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onClick when card is clicked
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should call onDelete when delete button is clicked
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should show placeholder when description is missing
 FAIL  tests/ui/datavault/TableCard.test.tsx > TableCard Component > should format dates correctly
ReferenceError: React is not defined
 Î“Â¥Â» TableCard client/src/components/datavault/TableCard.tsx:38:3
     36|   };
     37| 
     38|   return (
       |   ^
     39|     <Card className="cursor-pointer hover:shadow-md transition-shadow Î“Ã‡Âª
     40|       <div onClick={onClick}>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[209/301]Î“Ã„Â»

 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render template name and description
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should show "Coming Soon" badge
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should render preview columns
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should limit preview columns to 5 and show count for remaining
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should handle empty preview columns
 FAIL  tests/ui/datavault/TemplateCard.test.tsx > TemplateCard Component > should have cursor-not-allowed style
ReferenceError: React is not defined
 Î“Â¥Â» TemplateCard client/src/components/datavault/TemplateCard.tsx:19:3
     17| 
     18| export function TemplateCard({ name, description, icon, previewColumnsÎ“Ã‡Âª
     19|   return (
       |   ^
     20|     <TooltipProvider>
     21|       <Tooltip>
 Î“Â¥Â» renderWithHooks node_modules/react-dom/cjs/react-dom.development.js:15486:18
 Î“Â¥Â» mountIndeterminateComponent node_modules/react-dom/cjs/react-dom.development.js:20103:13
 Î“Â¥Â» beginWork node_modules/react-dom/cjs/react-dom.development.js:21626:16
 Î“Â¥Â» beginWork$1 node_modules/react-dom/cjs/react-dom.development.js:27465:14
 Î“Â¥Â» performUnitOfWork node_modules/react-dom/cjs/react-dom.development.js:26599:12
 Î“Â¥Â» workLoopSync node_modules/react-dom/cjs/react-dom.development.js:26505:5
 Î“Â¥Â» renderRootSync node_modules/react-dom/cjs/react-dom.development.js:26473:7
 Î“Â¥Â» recoverFromConcurrentError node_modules/react-dom/cjs/react-dom.development.js:25889:20
 Î“Â¥Â» performConcurrentWorkOnRoot node_modules/react-dom/cjs/react-dom.development.js:25789:22

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[210/301]Î“Ã„Â»

 FAIL  tests/unit/client/choice-utils.test.ts > choice-utils > uses label template with column names
AssertionError: expected ' ()' to be 'Alice (Admin)' // Object.is equality

Expected: "Alice (Admin)"
Received: " ()"

 Î“Â¥Â» tests/unit/client/choice-utils.test.ts:116:31
    114|         };
    115|         const opts = generateOptionsFromList(mockList, config);
    116|         expect(opts[0].label).toBe("Alice (Admin)");
       |                               ^
    117|         expect(opts[1].label).toBe("Bob (User)");
    118|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[211/301]Î“Ã„Â»

 FAIL  tests/unit/debugging/Lineage.test.ts > Debug & Lineage > should track skipped blocks in trace
AssertionError: expected 'condition false' to be 'condition evaluated to false' // Object.is equality

Expected: "condition evaluated to false"
Received: "condition false"

 Î“Â¥Â» tests/unit/debugging/Lineage.test.ts:133:36
    131| 
    132|         expect(step.status).toBe('skipped');
    133|         expect(step.skippedReason).toBe('condition evaluated to false'Î“Ã‡Âª
       |                                    ^
    134|         expect(result.executionTrace!.variableLineage['skippedVar']).tÎ“Ã‡Âª
    135|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[212/301]Î“Ã„Â»

 FAIL  tests/unit/middleware/auth.middleware.test.ts > Auth Middleware > requireAuth > should return 401 for missing token
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{Î“Ã‡Âª} ]

Received: 

  1st vi.fn() call:

  [
-   ObjectContaining {
-     "error": "missing_token",
+   {
+     "error": {
+       "code": "AUTH_008",
+       "details": {
+         "errorType": "UnauthorizedError",
+       },
        "message": "Authentication required",
+       "timestamp": "2026-01-07T21:10:36.409Z",
+     },
+     "success": false,
    },
  ]


Number of calls: 1

 Î“Â¥Â» tests/unit/middleware/auth.middleware.test.ts:74:24
     72|       expect(mockNext).not.toHaveBeenCalled();
     73|       expect(statusMock).toHaveBeenCalledWith(401);
     74|       expect(jsonMock).toHaveBeenCalledWith(
       |                        ^
     75|         expect.objectContaining({
     76|           message: 'Authentication required',

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[213/301]Î“Ã„Â»

 FAIL  tests/unit/middleware/auth.middleware.test.ts > Auth Middleware > hybridAuth > should allow cookie auth only for safe methods
AssertionError: expected "vi.fn()" to be called at least once
 Î“Â¥Â» tests/unit/middleware/auth.middleware.test.ts:259:22
    257| 
    258|         await hybridAuth(req as unknown as Request, res as unknown as Î“Ã‡Âª
    259|         expect(next).toHaveBeenCalled();
       |                      ^
    260|       }
    261| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[214/301]Î“Ã„Â»

 FAIL  tests/unit/schema/collections.test.ts > Collections Schema > Insert Schemas > insertCollectionSchema > should omit id, createdAt, and updatedAt
AssertionError: expected true to be false // Object.is equality

- Expected
+ Received

- false
+ true

 Î“Â¥Â» tests/unit/schema/collections.test.ts:139:32
    137|         const result = insertCollectionSchema.safeParse(dataWithOmitteÎ“Ã‡Âª
    138|         // Should be invalid because id, createdAt, updatedAt are omitÎ“Ã‡Âª
    139|         expect(result.success).toBe(false);
       |                                ^
    140|       });
    141| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[215/301]Î“Ã„Â»

 FAIL  tests/unit/services/AIService.test.ts > AIService Unit Tests > reviseWorkflow should parse valid JSON response correctly
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.reviseWorkflowSingleShot server/services/AIService.ts:1418:20
 Î“Â¥Â» AIService.reviseWorkflow server/services/AIService.ts:1298:16
 Î“Â¥Â» tests/unit/services/AIService.test.ts:61:24

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[216/301]Î“Ã„Â»

 FAIL  tests/unit/services/AIService.test.ts > AIService Unit Tests > reviseWorkflow should handle JSON markdown code blocks
Error: AI response does not match expected schema

â‰¡Æ’Ã¶Âº Troubleshooting Steps:
1. The AI response structure doesn't match our expected format
2. This may indicate:
   - A breaking change in the AI model behavior
   - The model is struggling with the complexity of the request
3. Try simplifying your workflow or request
4. If this persists, please report this issue with the workflow details
 Î“Â¥Â» AIService.createError server/services/AIService.ts:1059:19
    1057|     const fullMessage = troubleshootingHints ? `${message}\n\n${troublÎ“Ã‡Âª
    1058| 
    1059|     const error = new Error(fullMessage) as any;
       |                   ^
    1060|     error.code = code;
    1061|     error.details = details;
 Î“Â¥Â» AIService.reviseWorkflowSingleShot server/services/AIService.ts:1418:20
 Î“Â¥Â» AIService.reviseWorkflow server/services/AIService.ts:1298:16
 Î“Â¥Â» tests/unit/services/AIService.test.ts:95:24

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[217/301]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for invalid token signature
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:514:62
    512|         }
    513| 
    514|         expect(() => authService.verifyToken(tamperedToken)).toThrow("Î“Ã‡Âª
       |                                                              ^
    515|       });
    516| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[218/301]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for malformed token
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:518:68
    516| 
    517|       it("should throw error for malformed token", () => {
    518|         expect(() => authService.verifyToken("not.a.valid.token")).toTÎ“Ã‡Âª
       |                                                                    ^
    519|       });
    520| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[219/301]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > JWT Token Management > verifyToken() > should throw error for invalid token
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:523:64
    521|       it("should throw error for invalid token", () => {
    522|         // Test with a malformed token
    523|         expect(() => authService.verifyToken("invalid.token")).toThrowÎ“Ã‡Âª
       |                                                                ^
    524|       });
    525|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[220/301]Î“Ã„Â»

 FAIL  tests/unit/services/AuthService.test.ts > AuthService > Security Edge Cases > Token Manipulation > should reject token with valid structure but invalid signature
AssertionError: expected [Function] to throw error including 'Invalid token' but got 'Invalid or malformed token'

Expected: "Invalid token"
Received: "Invalid or malformed token"

 Î“Â¥Â» tests/unit/services/AuthService.test.ts:1065:58
    1063|         const fakeToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2Î“Ã‡Âª
    1064| 
    1065|         expect(() => authService.verifyToken(fakeToken)).toThrow("InvaÎ“Ã‡Âª
       |                                                          ^
    1066|       });
    1067|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[221/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Basic navigation (no conditions) > should return all pages in order when no conditions
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:49:71
     47|       ];
     48| 
     49|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
     50|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
     51|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[222/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Basic navigation (no conditions) > should handle empty workflow
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:65:71
     63| 
     64|     it('should handle empty workflow', async () => {
     65|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
     66|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
     67|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[223/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Basic navigation (no conditions) > should calculate correct current page index
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:85:71
     83|       ];
     84| 
     85|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
     86|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
     87|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[224/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > visibleIf conditions > should hide pages when visibleIf is false
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:125:71
    123|       ];
    124| 
    125|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    126|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    127|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[225/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > visibleIf conditions > should show pages when visibleIf is true
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:158:71
    156|       ];
    157| 
    158|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    159|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    160|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[226/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > visibleIf conditions > should handle complex visibleIf conditions
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:196:71
    194|       ];
    195| 
    196|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    197|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    198|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[227/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > skipIf conditions > should skip pages when skipIf is true
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:233:71
    231|       ];
    232| 
    233|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    234|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    235|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[228/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > skipIf conditions > should not skip pages when skipIf is false
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:266:71
    264|       ];
    265| 
    266|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    267|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    268|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[229/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Combined visibleIf and skipIf > should apply visibleIf before skipIf
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:306:71
    304|       ];
    305| 
    306|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    307|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    308|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[230/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Helper methods > should get first page
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:343:71
    341|       ];
    342| 
    343|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    344|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    345|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[231/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Helper methods > should return null for first page if all pages hidden
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:367:71
    365|       const mockValues = [{ runId: 'run1', stepId: 'step1', value: falÎ“Ã‡Âª
    366| 
    367|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    368|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    369|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[232/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Helper methods > should validate page navigability
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:392:71
    390|       const mockValues = [{ runId: 'run1', stepId: 'step1', value: falÎ“Ã‡Âª
    391| 
    392|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    393|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    394|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[233/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Helper methods > should get page sequence
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:420:71
    418|       const mockValues = [{ runId: 'run1', stepId: 'step1', value: truÎ“Ã‡Âª
    419| 
    420|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    421|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    422|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[234/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Error handling > should default to visible on visibleIf evaluation error
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:447:71
    445|       ];
    446| 
    447|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    448|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    449|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[235/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Error handling > should default to not skipping on skipIf evaluation error
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:470:71
    468|       ];
    469| 
    470|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    471|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    472|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[236/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Progress calculation > should calculate correct progress for multi-page workflow
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:495:71
    493|       ];
    494| 
    495|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    496|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    497|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[237/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeNavigation.test.ts > IntakeNavigationService > Progress calculation > should adjust progress when pages are skipped
TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')
 Î“Â¥Â» tests/unit/services/intakeNavigation.test.ts:533:71
    531|       const mockValues = [{ runId: 'run1', stepId: 'step1', value: truÎ“Ã‡Âª
    532| 
    533|       vi.mocked(repositories.sectionRepository.findByWorkflowId as anyÎ“Ã‡Âª
       |                                                                       ^
    534|       vi.mocked(repositories.stepRepository.findByWorkflowIdWithAliaseÎ“Ã‡Âª
    535|       vi.mocked(repositories.stepValueRepository.findByRunId as any).mÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[238/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeQuestionVisibility.test.ts > IntakeQuestionVisibilityService > Hidden question value clearing > should clear values for hidden questions
TypeError: this.stepValueRepo.deleteWhere is not a function
 Î“Â¥Â» IntakeQuestionVisibilityService.clearHiddenQuestionValues server/services/IntakeQuestionVisibilityService.ts:339:32
    337|       const { stepValues } = await import("../../shared/schema");
    338| 
    339|       await this.stepValueRepo.deleteWhere(inArray(stepValues.id, idsTÎ“Ã‡Âª
       |                                ^
    340| 
    341|       logger.debug(
 Î“Â¥Â» tests/unit/services/intakeQuestionVisibility.test.ts:425:23

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[239/301]Î“Ã„Â»

 FAIL  tests/unit/services/intakeQuestionVisibility.test.ts > IntakeQuestionVisibilityService > Cascading visibility > should handle questions that depend on each other
AssertionError: expected [ 'q1' ] to deeply equal [ 'q1', 'q2', 'q3' ]

- Expected
+ Received

  [
    "q1",
-   "q2",
-   "q3",
  ]

 Î“Â¥Â» tests/unit/services/intakeQuestionVisibility.test.ts:615:40
    613|       const result2 = await service.evaluatePageQuestions('section1', Î“Ã‡Âª
    614| 
    615|       expect(result2.visibleQuestions).toEqual(['q1', 'q2', 'q3']); //Î“Ã‡Âª
       |                                        ^
    616|     });
    617|   });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[240/301]Î“Ã„Â»

 FAIL  tests/unit/services/StepService.test.ts > StepService > createStep > should create a step with auto-incrementing order
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{Î“Ã‡Âª} ]

Received: 

  1st vi.fn() call:

  [
-   ObjectContaining {
-     "order": 3,
+   {
+     "options": {},
+     "order": 1,
+     "required": false,
      "sectionId": "section-z9gzb6",
+     "title": "New Step",
+     "type": "short_text",
    },
  ]


Number of calls: 1

 Î“Â¥Â» tests/unit/services/StepService.test.ts:65:35
     63| 
     64|       expect(result.order).toBe(3);
     65|       expect(mockStepRepo.create).toHaveBeenCalledWith(
       |                                   ^
     66|         expect.objectContaining({
     67|           sectionId: section.id,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[241/301]Î“Ã„Â»

 FAIL  tests/unit/writes/WriteRunner.test.ts > WriteRunner > Mode: Create > should resolve values and call createRowWithValues
AssertionError: expected "vi.fn()" to be called with arguments: [ ObjectContaining{Î“Ã‡Âª}, Î“Ã‡Âª(1) ]

Number of calls: 0

 Î“Â¥Â» tests/unit/writes/WriteRunner.test.ts:143:65
    141|                 { columnId: "col-age", value: 30 }
    142|             ];
    143|             expect(datavaultRowsRepository.createRowWithValues).toHaveÎ“Ã‡Âª
       |                                                                 ^
    144|                 expect.objectContaining({ tableId: "table-users", tenaÎ“Ã‡Âª
    145|                 expect.arrayContaining([

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[242/301]Î“Ã„Â»

 FAIL  tests/unit/writes/WriteRunner.test.ts > WriteRunner > Mode: Update > should find row by PK and update
AssertionError: expected "vi.fn()" to be called with arguments: [ 'row-existing-1', [ { Î“Ã‡Âª(2) } ] ]

Number of calls: 0

 Î“Â¥Â» tests/unit/writes/WriteRunner.test.ts:192:61
    190|                 "table-users", "col-email", "test@example.com", mockTeÎ“Ã‡Âª
    191|             );
    192|             expect(datavaultRowsRepository.updateRowValues).toHaveBeenÎ“Ã‡Âª
       |                                                             ^
    193|                 "row-existing-1",
    194|                 [{ columnId: "col-status", value: "Active" }]

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[243/301]Î“Ã„Â»


[2m Test Files [22m [1m[31m52 failed[39m[22m[2m | [22m[1m[32m102 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (155)[39m
[2m      Tests [22m [1m[31m289 failed[39m[22m[2m | [22m[1m[32m2179 passed[39m[22m[2m | [22m[33m67 skipped[39m[90m (2535)[39m
[2m   Start at [22m 15:10:31
[2m   Duration [22m 84.52s[2m (transform 32.10s, setup 41.28s, import 261.43s, tests 707.69s, environment 18.04s)[22m

